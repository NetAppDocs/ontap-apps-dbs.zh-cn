<?xml version="1.0" encoding="UTF-8"?>
<blocks>
  <block id="d41d8cd98f00b204e9800998ecf8427e" category="summary"></block>
  <block id="30d965eef5ba25c6b9998ae38270b43e" category="doc">法律声明</block>
  <block id="e9c44bbfd795a5d63d74c6a77afee70d" category="paragraph">法律声明提供对版权声明、商标、专利等的访问。</block>
  <block id="6016a2b341113bf496b719905398ecd2" category="section-title">版权</block>
  <block id="52009bb7ee17227f566cd26a02caee56" category="inline-link-macro"><block ref="52009bb7ee17227f566cd26a02caee56" category="inline-link-rx"></block></block>
  <block id="a1a9afcf552a769c282769271829889a" category="paragraph"><block ref="a1a9afcf552a769c282769271829889a" category="inline-link-macro-rx"></block></block>
  <block id="126a02652da6de02962cf1b654fd6376" category="section-title">商标</block>
  <block id="c4ce4761e466527d26b3e3d5ed1006fd" category="paragraph">NetApp 、 NetApp 徽标和 NetApp 商标页面上列出的标记是 NetApp 、 Inc. 的商标。其他公司和产品名称可能是其各自所有者的商标。</block>
  <block id="f99aa604031e5049799e73b5c3748a98" category="inline-link-macro"><block ref="f99aa604031e5049799e73b5c3748a98" category="inline-link-rx"></block></block>
  <block id="5d545fe5152641e2ebe654e336e520e5" category="paragraph"><block ref="5d545fe5152641e2ebe654e336e520e5" category="inline-link-macro-rx"></block></block>
  <block id="be89498d2f8a22ce47c02ba9795fe2af" category="section-title">专利</block>
  <block id="d0b19d36be2c5f16e9aef46c8a452d3d" category="paragraph">有关 NetApp 拥有的专利的最新列表，请访问：</block>
  <block id="88e5eabd3917048b6927c42496b98f86" category="inline-link-macro"><block ref="88e5eabd3917048b6927c42496b98f86" category="inline-link-rx"></block></block>
  <block id="dd38f906b37d412de7d1c1dcf4cbf31c" category="paragraph"><block ref="dd38f906b37d412de7d1c1dcf4cbf31c" category="inline-link-macro-rx"></block></block>
  <block id="56c34c6410dd45c5cec44149ad0ce037" category="section-title">隐私政策</block>
  <block id="8acb58cbd50ef1b468a020ee0bd351d3" category="inline-link-macro"><block ref="8acb58cbd50ef1b468a020ee0bd351d3" category="inline-link-rx"></block></block>
  <block id="2352c4e1f4d0024ade0869e00e6243f4" category="paragraph"><block ref="2352c4e1f4d0024ade0869e00e6243f4" category="inline-link-macro-rx"></block></block>
  <block id="c0227cef6f07a8cd2ac72f2945b031aa" category="section-title">开放源代码</block>
  <block id="9b73989307c1975dfa4d5e1581e4afe8" category="paragraph">通知文件提供有关 NetApp 软件中使用的第三方版权和许可证的信息。</block>
  <block id="253b40ae359ba25b56231803430c4873" category="section-title">ONTAP</block>
  <block id="856c8958afd787f748a4a025f649154a" category="inline-link-macro">ONTAP 9.13.1的注意事项</block>
  <block id="b22b3b2970d843f99e7e6904bea05207" category="inline-link-macro">ONTAP 9.12.1的通知</block>
  <block id="0358f41254df2d512849db5a04b7e3d4" category="inline-link-macro">ONTAP 9.12.0通知</block>
  <block id="28f1290102a277ef2fd452d558c74219" category="inline-link-macro">ONTAP 9.11.1注意事项</block>
  <block id="57b07f14c8eb4660f94a86d29d53362d" category="inline-link-macro">ONTAP 9.10.1 的通知</block>
  <block id="396712eb9c1644241047ac30619b2b3e" category="inline-link-macro">ONTAP 9.10.0的通知</block>
  <block id="1e6000d4849ef9f3e08d1d9908e9f163" category="inline-link-macro">ONTAP 9.9.1 注意事项</block>
  <block id="6f408b9c999245c7aa32bc9cb1a020f6" category="inline-link-macro">ONTAP 9.8 注意事项</block>
  <block id="04b0bd5b1b4d414fdde93f809162d36d" category="inline-link-macro">ONTAP 9.7通知</block>
  <block id="0c1d7dffcba488555d5eb39b8991e822" category="inline-link-macro">ONTAP 9.6的通知</block>
  <block id="a11ac6880e72412c0f54ae19bea3d191" category="inline-link-macro">ONTAP 9.5通知</block>
  <block id="e49c3c01b15761b5f011d0bd2a0661a3" category="inline-link-macro">ONTAP 9.4通知</block>
  <block id="bf7dcf6467a8a03b05b2d37d31d6eccd" category="inline-link-macro">ONTAP 9.3通知</block>
  <block id="0328352fdfda84af6968462d1a67d3a6" category="inline-link-macro">ONTAP 9.2通知</block>
  <block id="83904100c7d6fe0102e8b2b5bd8ec4bb" category="inline-link-macro">ONTAP 9.1通知</block>
  <block id="9e476387322a5c250893cf9c5c4ce78c" category="doc">策略</block>
  <block id="b9e18a3460bc17eb9ea65b03f0167453" category="paragraph">这在数据库中很常见。已知包含非活动块的数据库也是FabricPool层的候选数据库。例如、供应链管理数据库可能包含历史信息、这些信息在需要时必须可用、但在正常操作期间不会访问。可以使用FabricPool有选择地重新定位非活动块。</block>
  <block id="95e955bbbe5dd9520a6bf45b0d8a9d4c" category="paragraph">例如、使用的FabricPool卷上运行的数据文件<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 90天期限将在性能层上保留前90天访问的任何块。但是、任何在90天内未访问的内容都会重新定位到容量层。在其他情况下、正常应用程序活动会将正确的块保留在正确的层上。例如、如果数据库通常用于定期处理前60天的数据、则要低得多<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 可以设置期限、因为应用程序的自然活动可确保不会过早重新定位块。</block>
  <block id="c33af7c93d461803ceaf8531e861017d" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 对数据库使用策略时应谨慎。许多数据库都定期开展活动、例如季度末流程或重新编制索引操作。如果这些操作的期限大于<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 可能会发生性能问题。例如、如果季度末处理需要1 TB的数据、而这些数据在其他情况下未被触及、则这些数据现在可能位于容量层上。从容量层读取的速度通常非常快、可能不会出现发生原因性能问题、但具体结果取决于对象存储配置。</block>
  <block id="03431a55183cb73a12c1bbc3e1927678" category="paragraph">。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 策略应设置得足够高、以保留性能层上可能需要的文件。例如、如果数据库中可能需要最新60天的数据且性能最佳、则需要设置<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 期限为60天。根据文件的访问模式、也可以实现类似的结果。例如、如果需要最近90天的数据、而应用程序正在访问这90天的数据、则数据将保留在性能层上。设置<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 在数据变得不太活跃后、将立即对数据进行分层。</block>
  <block id="25d9496e96e698b08c4fc713bfc9a5ca" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 要对这些块进行层化、需要使用策略、因为只有<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略会影响活动文件系统中的块。</block>
  <block id="55fad400d892fb6062e67904fa9be485" category="admonition">任何类型的数据访问都会重置热图数据。因此、数据库完整表扫描甚至读取源文件的备份活动都会阻止分层、因为需要分层<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 从未达到阈值。</block>
  <block id="117c4b6bad0236ab23e0fe29aead8aef" category="paragraph">虽然可以选择调整LUN大小来增加容量、但通常最好使用LVM、包括Oracle ASM。存在LVM的一个主要原因是避免调整LUN大小。通过LVM、多个LUN会绑定到一个虚拟存储池中。从该池中划分出来的逻辑卷由LVM管理、并且可以轻松调整大小。另一个优势是、通过在所有可用LUN之间分布给定逻辑卷、可以避免特定驱动器上出现热点。通常、可以通过使用卷管理器将逻辑卷的底层块区重新定位到新LUN来执行透明迁移。</block>
  <block id="4d4855a15e1f9d6fd8f8bdf1668c537e" category="doc">手动强制NVFAIL</block>
  <block id="8772c1c8bed97f5c942657feeb8bfb6f" category="admonition">本节将详细介绍基本ONTAP NVFAIL、以涵盖MetroCluster特定的主题。</block>
  <block id="14d74316044293d1ebd8c5a01ff90055" category="paragraph">使用MetroCluster时、写入操作在至少另一个控制器上登录到本地NVRAM和NVRAM后才会得到确认。此方法可确保硬件故障或断电不会导致传输中I/O丢失如果本地NVRAM发生故障或与其他节点的连接发生故障、则无法再镜像数据。</block>
  <block id="d820d86d09ea05a0de19c3aacbfb72b2" category="paragraph">如果本地NVRAM报告错误、则此节点将关闭。此关闭会导致在使用HA对时故障转移到配对控制器。使用MetroCluster时、行为取决于所选的整体配置、但可能会自动故障转移到远程便签。在任何情况下、数据都不会丢失、因为发生故障的控制器尚未确认写入操作。</block>
  <block id="886174de078cee4595eb8a8d07f81703" category="paragraph">站点间连接故障会阻止NVRAM复制到远程节点、这种情况更为复杂。写入操作不再复制到远程节点、因此、如果控制器发生灾难性错误、可能会导致数据丢失。更重要的是、在这些情况下尝试故障转移到其他节点会导致数据丢失。</block>
  <block id="790ec042c9b89dac2390ea81b9c29a51" category="paragraph">控制因素是NVRAM是否同步。如果NVRAM已同步、则可以安全地进行节点间故障转移、而不会丢失数据。在MetroCluster配置中、如果NVRAM与底层聚合plexes处于同步状态、则可以安全地继续执行切换、而不会丢失数据。</block>
  <block id="3d936bb059b98a2fc7c177d20eb755c9" category="paragraph">除非强制执行故障转移或切换、否则ONTAP不允许在数据不同步时执行故障转移或切换。以这种方式强制更改条件即表示数据可能会留在原始控制器中、并且数据丢失是可以接受的。</block>
  <block id="3d37a3a8ed77bebc986238aedccecbc9" category="paragraph">如果强制执行故障转移或切换、则数据库尤其容易受到损坏的影响、因为数据库在磁盘上维护着更大的内部数据缓存。如果发生强制故障转移或切换、先前确认的更改将被有效丢弃。存储阵列的内容会及时有效地向后跳转、数据库缓存的状态不再反映磁盘上数据的状态。</block>
  <block id="7ad23b7fa394c8666b132d78a58b1987" category="paragraph">为了保护应用程序免受这种情况的影响、ONTAP允许对卷进行配置、以便针对NVRAM故障提供特殊保护。触发此保护机制后、卷将进入名为NVFAIL的状态。此状态会导致I/O错误、发生原因应用程序会关闭以使其不使用陈旧数据。不应丢失数据、因为存储系统上仍存在任何已确认的写入、对于数据库、任何已提交的事务数据都应出现在日志中。</block>
  <block id="99259586124503e22927506a7ed3738d" category="paragraph">通常的后续步骤是、管理员先完全关闭主机、然后再手动将LUN和卷重新联机。虽然这些步骤可能涉及一些工作、但这种方法是确保数据完整性的最安全方法。并非所有数据都需要这种保护、这就是可以逐个卷配置NVFAIL行为的原因。</block>
  <block id="13fbc5a220fe8007dcaea69217bba134" category="paragraph">要强制与分布在各个站点上的应用程序集群(包括VMware、Oracle RAC等)进行切换、最安全的方法是指定<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> 在命令行中。此选项可作为紧急措施使用、以确保所有缓存数据均已转储。如果主机正在使用最初位于发生灾难的站点上的存储资源、则会收到I/O错误或陈旧的文件句柄 <block ref="a3c6541ac12f1f06a81cc9b03e6bd094" prefix="(" category="inline-code"></block>)错误。Oracle数据库崩溃、文件系统要么完全脱机、要么切换到只读模式。</block>
  <block id="dc6683d37e50abd82911fa91c036fbb2" category="paragraph">切换完成后、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 标记、并且LUN需要置于联机状态。完成此活动后、可以重新启动数据库。这些任务可以自动执行、以减少RTO。</block>
  <block id="a2626552f293b2377efe829e69d14daa" category="section-title">dr-force－nvfail</block>
  <block id="f0cc4bbe3d196251009dbe9f0ac42ffc" category="paragraph">作为一般安全措施、请设置<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> 在正常操作期间可能从远程站点访问的所有卷上的标志、表示它们是故障转移之前使用的活动。此设置的结果是、所选远程卷在进入后将不可用<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 切换期间。切换完成后、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 标记、并且LUN必须置于联机状态。完成这些活动后、可以重新启动应用程序。这些任务可以自动执行、以减少RTO。</block>
  <block id="5f6aa76cc0fe886c07f242f921486ef7" category="paragraph">结果类似于使用<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> 用于手动切换的标志。但是、受影响的卷数量可以仅限于那些必须防止应用程序或具有陈旧缓存的操作系统访问的卷。</block>
  <block id="4df566a29b44806612369c0c1f67521b" category="paragraph">对于不使用的环境、有两个关键要求<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> 在应用程序卷上：</block>
  <block id="aaf1cc67bd88c39a71e691d413ded49f" category="list-text">在主站点丢失后、强制切换的发生时间不得超过30秒。</block>
  <block id="7f9cc623e2a11875714cf4bc64f148fd" category="list-text">在执行维护任务期间、或者在SyncMirror plexes或NVRAM复制不同步的任何其他情况下、不得发生切换。第一个要求可通过Tieber4软件来满足、该软件配置为在站点发生故障后30秒内执行切换。此要求并不意味着必须在检测到站点故障后30秒内执行切换。这确实意味着、如果自某个站点确认正常运行后30秒内已过、则不再安全地强制执行切换。</block>
  <block id="0929cc8043c21dcf0163f06424677ede" category="paragraph">如果已知MetroCluster配置不同步、则可以通过禁用所有自动切换功能来部分满足第二项要求。更好的选择是、使用Tiebre机会 解决方案监控NVRAM复制和SyncMirror plexes的运行状况。如果集群未完全同步、则Tieb破碎 机不应触发切换。</block>
  <block id="a168430c68d0310385371eabe149a118" category="paragraph">NetApp MCTB软件无法监控同步状态、因此、如果MetroCluster因任何原因而不同步、则应将其禁用。ClusterLion具有NVRAM监控和丛监控功能、可以将其配置为不触发切换、除非确认MetroCluster系统已完全同步。</block>
  <block id="baba038803e218b2ac3b2688bc2fd5db" category="doc">LUN计数</block>
  <block id="b0e4db975ae00108abe9f47db9be5668" category="paragraph">LUN是ONTAP上的一个虚拟化对象、位于托管聚合中的所有驱动器上。因此、LUN的性能不受其大小的影响、因为无论选择何种大小、LUN都会利用聚合的全部性能潜能。</block>
  <block id="7235d4b71fadc2fe03d09d863c7cdd66" category="paragraph">为了方便起见、客户可能希望使用特定大小的LUN。例如、如果数据库是基于LVM或Oracle ASM磁盘组构建的、其中每个磁盘组包含两个1 TB的LUN、则该磁盘组必须以1 TB为增量进行增长。最好使用八个500 GB的LUN来构建磁盘组、以便可以以较小的增量来增加磁盘组。</block>
  <block id="4b1ffe65479a23391a2c7f9caf467a35" category="paragraph">建议不要建立通用标准LUN大小、因为这样做会使易管理性复杂化。例如、如果数据库或数据存储库的大小介于1 TB到2 TB之间、则100 GB的标准LUN大小可能效果良好、但20 TB的数据库或数据存储库需要200个LUN。这意味着、服务器重新启动时间会更长、需要在各种用户界面中管理更多对象、SnapCenter等产品必须对许多对象执行发现。使用更少、更大的LUN可避免此类问题。</block>
  <block id="4afa3de974c36a09c2055d30989bb405" category="list-text">LUN计数比LUN大小更重要。</block>
  <block id="691c70133d96d57796a9299359666f80" category="list-text">LUN大小主要由LUN计数要求控制。</block>
  <block id="8af9e525c143179b948a11fc382a331e" category="list-text">避免创建超出所需数量的LUN。</block>
  <block id="407b2218ad77513a7e3964f169d07e66" category="paragraph">与LUN大小不同、LUN计数会影响性能。应用程序性能通常取决于通过SCSI层执行并行I/O的能力。因此、两个LUN的性能优于一个LUN。使用Veritas VLVM、Linux LVM2或Oracle ASM等LVM是提高并行性的最简单方法。</block>
  <block id="39143fe6204f383e4ce3bb3b77926455" category="paragraph">虽然对随机I/O非常繁重的100% SSD环境进行的测试表明、LUN数量最多可增加到64个、但一般来说、NetApp客户从LUN数量增加到16个以上所获得的优势微乎其微。</block>
  <block id="9875f7503e59521e91e519abd87f5c9e" category="paragraph">* NetApp建议*：</block>
  <block id="57153ab478a4958250d76ac6bf4e3ac0" category="paragraph">通常、四到十六个LUN足以满足任何给定数据库工作负载的I/O需求。由于主机SCSI实施的限制、如果LUN数量少于四个、则可能会造成性能限制。</block>
  <block id="de932976b195d4755fcbea64295fc7cb" category="doc">主机操作系统设置</block>
  <block id="f62cb371f65c322cd9e17a5c2cecd1c8" category="paragraph">大多数应用程序供应商文档都包含特定的TCP和以太网设置、旨在确保应用程序以最佳状态运行。这些相同的设置通常足以提供基于IP的最佳存储性能。</block>
  <block id="ae7a0bb210cbd1edb935128116a21c55" category="section-title">以太网流量控制</block>
  <block id="a3c15fb208efc85bdfe72c57d56c92b8" category="paragraph">此技术允许客户端请求发送方暂时停止数据传输。这通常是因为接收方无法足够快速地处理传入数据。一次、请求发送方停止传输比让接收方丢弃数据包造成的中断要少、因为缓冲区已满。如今、操作系统中使用的TCP堆栈已不再是这种情况。事实上、流量控制造成的问题比它解决的问题多。</block>
  <block id="950d31923e253d170d6c994801ce7cec" category="paragraph">近年来、以太网流量控制导致的性能问题不断增加。这是因为以太网流量控制在物理层运行。如果网络配置允许任何主机操作系统向存储系统发送以太网流量控制请求、则会导致所有已连接客户端的I/O暂停。由于单个存储控制器为越来越多的客户端提供服务、因此其中一个或多个客户端发送流量控制请求的可能性会增加。在广泛的操作系统虚拟化过程中、客户站点经常会出现此问题。</block>
  <block id="6bfd8563627c68f73c30581843441a74" category="paragraph">NetApp系统上的NIC不应接收流量控制请求。根据网络交换机制造商的不同、实现此结果的方法也会有所不同。在大多数情况下、可以将以太网交换机上的流量控制设置为<block ref="a67b5ddb674c9ca32d9c9e1ca81578ee" prefix=" " category="inline-code"></block> 或<block ref="f4eb0bfa09695eb47ff4f3bd3ca4449d" prefix=" " category="inline-code"></block>，表示流量控制请求不会转发到存储控制器。在其他情况下、存储控制器上的网络连接可能不允许禁用流量控制。在这些情况下、必须将客户端配置为从不发送流量控制请求、方法是更改主机服务器本身的NIC配置或主机服务器所连接的交换机端口。</block>
  <block id="7496f3ff64e30d4732c2c64880faf186" category="admonition">* NetApp建议*确保NetApp存储控制器不接收以太网流量控制数据包。这通常可以通过设置控制器所连接的交换机端口来实现、但某些交换机硬件存在一些限制、可能需要在客户端进行更改。</block>
  <block id="ae6d0fc57efaf02ad7dfdacd3575e315" category="section-title">MTU大小</block>
  <block id="ff13ea04765cd9c9aed7b839f15eb2b4" category="paragraph">事实证明、使用巨型帧可以减少CPU和网络开销、从而在一定程度上提高1 Gb网络的性能、但其优势通常并不明显。</block>
  <block id="ee3f364287a30ef10dfdce2f37d94ed2" category="admonition">* NetApp建议*尽可能实施巨型帧、以实现任何潜在的性能优势并使解决方案适应未来需求。</block>
  <block id="2c6ba27b7ed602a9089da6ad9f762c9a" category="paragraph">在10 Gb网络中使用巨型帧几乎是强制性要求。这是因为大多数10 Gb实施在达到10 Gb标记之前都会达到每秒数据包数限制、而不会出现巨型帧。使用巨型帧可以提高TCP/IP处理的效率、因为它允许操作系统、服务器、NIC和存储系统处理的数据包数量较少、但数量较大。不同NIC的性能提升各不相同、但性能提升幅度很大。</block>
  <block id="a44be1bbfde97e4a64b50282325165e7" category="paragraph">对于巨型帧实施、人们普遍认为所有连接的设备都必须支持巨型帧、并且MTU大小必须端到端匹配、但这种看法并不正确相反、在建立连接时、这两个网络端点会协商双方可接受的最高帧大小。在典型环境中、网络交换机的MTU大小设置为9216、NetApp控制器设置为9000、客户端设置为9000和1514的混合。可以支持9000 MTU的客户端可以使用巨型帧、而只支持1514的客户端可以协商较低的值。</block>
  <block id="a31484167f31e1c3f36f7cea821bc581" category="paragraph">在完全交换的环境中、这种安排的问题很少见。但是、在路由环境中请注意、不会强制任何中间路由器对巨型帧进行分段。</block>
  <block id="c805e9846e6fca449dbe3233cc5dbdf5" category="paragraph">* NetApp建议*配置以下内容：</block>
  <block id="b4446b5ca60d915111af271495bd4c17" category="list-text">巨型帧是需要的、但对于1 Gb以太网(GbE)则不需要巨型帧。</block>
  <block id="5b1ea13ac12a9c8be0d09303f637dba4" category="list-text">要在10GbE和更快的速度下实现最高性能、需要巨型帧。</block>
  <block id="08a8dce78637f5dd14ed052163feb9da" category="section-title">TCP参数</block>
  <block id="1a999618685598bee637262fe589de70" category="paragraph">通常会有三种设置配置不当：TCP时间戳、选择性确认(SACK)和TCP窗口缩放。Internet上的许多过时文档建议禁用其中一个或多个参数以提高性能。这一建议在多年前具有一定的价值、那时CPU功能要低得多、尽可能减少TCP处理开销会有好处。</block>
  <block id="6a594ec6f0bb742c1d2b0f631cf65ba1" category="paragraph">但是、在现代操作系统中、禁用任何这些TCP功能通常不会带来明显的优势、同时还可能会损害性能。在虚拟化网络环境中、性能可能会受到损害、因为要高效处理数据包丢失和网络质量变化、需要使用这些功能。</block>
  <block id="cdc44d05b1633e8a8c7835010c423dd6" category="admonition">*TCP NetApp建议*在主机上启用TCP时间戳、SACK和TCP窗口缩放，在任何当前操作系统中，所有这三个参数都应默认为打开。</block>
  <block id="341d84aa26cb4521474864e04ea2a63b" category="inline-image-macro">错误：缺少图形映像</block>
  <block id="b56265ceb6311e42003e668438136a59" category="section-title">同步复制</block>
  <block id="0cf4a786acebd750bbfdfc4416c89406" category="section-title">存储硬件</block>
  <block id="ea9f3de5dd21190fbc6bca180b2040f1" category="section-title">ONTAP调解器</block>
  <block id="0f54fb931dbdeea735f18a8e73f9eab5" category="doc">利用SyncMirror实现数据保护</block>
  <block id="d7023f86951b6c3c009891a468c3effd" category="paragraph">最简单的一个层面是、同步复制意味着、在确认镜像存储之前、必须对镜像存储的两端进行任何更改。例如、如果数据库正在写入日志、或者VMware子系统正在修补、则写入操作绝不能丢失。作为协议级别、在将写入提交到两个站点上的非易失性介质之前、存储系统不得确认写入。只有这样、才能安全地继续操作、而不会丢失数据。</block>
  <block id="eee4f7a4e0ed3a8646a97bcf3e118fb9" category="paragraph">使用同步复制技术是设计和管理同步复制解决方案的第一步。最重要的注意事项是了解在各种计划内和计划外故障情形下可能发生的情况。并非所有同步复制解决方案都能提供相同的功能。如果您需要的解决方案能够实现零恢复点目标(RPO)、即零数据丢失、则必须考虑所有故障情形。特别是、如果由于站点间连接断开而无法进行复制、则会产生什么预期结果？</block>
  <block id="71554672a088c43ab21c759ddd161928" category="section-title">SyncMirror数据可用性</block>
  <block id="8646bb558f8f18a200cce2f70602627a" category="paragraph">SyncMirror不仅可以在无法访问远程站点时无缝切换出同步模式、还可以在恢复连接后快速重新同步到RPO = 0状态。远程站点上的陈旧数据副本也可以在重新同步期间保留在可用状态、从而确保本地和远程数据副本始终存在。</block>
  <block id="1d12d7a206d9b5337ae6fa442f23d377" category="doc">仅快照</block>
  <block id="64c29f2f2feedeb607ff588b13d9758b" category="paragraph">。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block><block ref="964193481f440d73ce3474a7a09bc3ac" prefix=" " category="inline-code"></block> 仅适用于未与活动文件系统共享的块。实际上、它需要对数据库备份进行层化。创建快照后、块将成为分层的候选块、然后将其覆盖、从而导致块仅存在于快照中。之前的延迟<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 块被视为冷却由控制<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 卷的设置。从ONTAP 9.8开始、此范围为2到183天。</block>
  <block id="ebd9889c847a7a3ddeccd2717ead46f2" category="paragraph">许多数据集的更改率较低、因此此策略节省的空间极少。例如、在ONTAP上观察到的典型数据库每周的更改率小于5%。数据库归档日志可能会占用大量空间、但它们通常仍存在于活动文件系统中、因此不适合在此策略下进行分层。</block>
  <block id="06b9281e396db002010bde1de57262eb" category="section-title">自动</block>
  <block id="ecf602bd5abbd6a605debedbb6c3d4e0" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 层划分策略可将层划分扩展到快照特定的块以及活动文件系统中的块。块被视为冷却之前的延迟由控制<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 卷的设置。从ONTAP 9.8开始、此范围为2到183天。</block>
  <block id="6256ce48698ff0bde6f818679cdfb382" category="paragraph">此方法可启用在中不可用的层选项<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 策略。例如、数据保护策略可能需要保留90天的某些日志文件。如果将冷却期设置为3天、则会将超过3天的任何日志文件从性能层中分层出来。此操作可释放性能层上的大量空间、同时仍允许您查看和管理整个90天的数据。</block>
  <block id="6adf97f83acf6453d4a6a4b1070f3754" category="section-title">无</block>
  <block id="7026ff5c5d4ab3946ff2d86f0e2cca6f" category="paragraph">。<block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix=" " category="inline-code"></block> 分层策略可防止从存储层对任何其他块进行分层、但容量层中的任何数据仍会保留在容量层中、直到被读取为止。如果随后读取该块、则会将其移回并放置在性能层上。</block>
  <block id="d152c7b0939fb6d35fdb0433de0d6369" category="paragraph">使用的主要原因<block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix=" " category="inline-code"></block> 分层策略可防止对块进行分层、但随着时间的推移更改策略可能会很有用。例如、假设某个特定数据集已广泛分层到容量层、但却出现了对全部性能功能的意外需求。可以更改此策略、以防止任何其他分层、并确认随着IO增加而读回的任何块仍保留在性能层中。</block>
  <block id="b1c94ca2fbc3e78fc30069c8d0f01680" category="section-title">全部</block>
  <block id="84826d7e23dfac7549819d5115fdcedd" category="paragraph">。<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 层策略将取代<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 自ONTAP 9.6起的策略。。<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 策略仅应用于数据保护卷、即SnapMirror或NetApp SnapVault目标。。<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 策略的功能相同、但不限于数据保护卷。</block>
  <block id="10d8500e282e8bbacd668af6f773f412" category="paragraph">使用此策略、块将立即视为冷数据块、并有资格立即分层到容量层。</block>
  <block id="ec583de0216b95bc673c84e4ec9356e6" category="paragraph">此策略尤其适用于长期备份。它还可用作分层存储管理(HSM)的一种形式。过去、HSM通常用于将文件的数据块分层到磁带、同时使文件本身在文件系统上保持可见。使用的FabricPool卷<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 通过策略、您可以将文件存储在一个可见且易于管理的位置、但几乎不会占用本地存储层上的空间。</block>
  <block id="79768a069a539d4f130e672a660bf45f" category="doc">分区</block>
  <block id="a0bdb98e8b9da585816478d24278e42f" category="paragraph">一个FC分区不应包含多个启动程序。这种安排最初可能看起来有效、但启动程序之间的串扰最终会影响性能和稳定性。</block>
  <block id="8ef958d9e25538841b306960ab117626" category="paragraph">虽然在极少数情况下、不同供应商的FC目标端口的行为会导致问题、但多目标区域通常被视为安全区域。例如、避免将NetApp和非NetApp存储阵列的目标端口都包含在同一分区中。此外、将NetApp存储系统和磁带设备置于同一分区更容易出现发生原因问题。</block>
  <block id="642223473862db290604321fe2ebe763" category="doc">svms</block>
  <block id="47ea917cf14ad91c68c407f90a7a189d" category="paragraph">SVM (在ONTAP命令行界面中称为Vserver)是存储的基本功能单元、将SVM与VMware ESX服务器上的子系统进行比较非常有用。</block>
  <block id="13ce2622b2cc2118c44d3aae7df8167d" category="paragraph">与存储架构的其他方面一样、SVM和逻辑接口(LIF)设计的最佳选项在很大程度上取决于扩展要求和业务需求。</block>
  <block id="8fb41a27984f0beba2e12fb920a486aa" category="paragraph">目前尚无为ONTAP配置SVM的官方最佳实践。正确的方法取决于管理和安全要求。</block>
  <block id="f4d8541bb6d07f7533a6b5aa6cfb2455" category="paragraph">大多数客户都会运行一个主SVM来满足大多数日常需求、但随后会创建少量SVM来满足特殊需求。例如、您可能希望创建：</block>
  <block id="259908e9e431c0fbb9d425249ceb7930" category="list-text">由专业团队管理的关键业务数据库的SVM</block>
  <block id="0e10f2715884f3538282397d69b2cd00" category="list-text">开发组的SVM、该开发组拥有完全的管理控制权、因此可以独立管理自己的存储</block>
  <block id="7624156e307247e4ea1ec8bf574136a1" category="list-text">用于敏感业务数据(例如人力资源或财务报告数据)的SVM、必须限制管理团队</block>
  <block id="e5e09031843479ef9ef8cbbd4c2f404c" category="inline-link-macro">NetApp Hardware Universe</block>
  <block id="fb012f1e7970d8285bd5d6c5a7f7d523" category="doc">SSD聚合、包括AFF系统</block>
  <block id="cb8e4651c457f71d5788f38eac01471f" category="paragraph">可用空间是指未用于实际数据的任何空间、其中包括聚合本身上的未分配空间以及成分卷中的未使用空间。此外、还必须考虑精简配置。例如、卷可能包含1 TB的LUN、其中实际数据仅利用了50%的空间。在精简配置环境中、这将正确地显示为占用500 GB的空间。但是、在完全配置的环境中、1 TB的全部容量似乎正在使用中。500 GB的未分配空间将被隐藏。实际数据未使用此空间、因此应将此空间计入总可用空间。</block>
  <block id="d3487661d9a0702bd5915d49070f62dc" category="paragraph">对于用于企业级应用程序的存储系统、NetApp建议如下：</block>
  <block id="678e476783bceae80094bcb4c1f32969" category="admonition">* NetApp建议*至少留出10%的可用空间。这包括所有未使用的空间、包括聚合或卷中的可用空间、以及由于使用完全配置而分配但实际数据未使用的任何可用空间。逻辑空间并不重要、问题是可用于数据存储的实际可用物理空间有多少。</block>
  <block id="2171d172d184f1202a686849c85dce91" category="paragraph">建议10%的可用空间非常保守。SSD聚合可以支持利用率更高的工作负载、而不会对性能产生任何影响。但是、随着聚合利用率的提高、如果不仔细监控利用率、用尽空间的风险也会增加。此外、在以99%的容量运行系统时、可能不会影响性能、但可能会导致管理工作、试图在订购额外硬件时阻止系统完全填满、并且可能需要一些时间来采购和安装额外的驱动器。</block>
  <block id="789243e17acb0b134f435d6c4c1350f2" category="section-title">HDD聚合、包括Flash Pool聚合</block>
  <block id="0b0a68e2dedde9c0b9a3ea4276f4b85c" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略是最适合备份数据的策略。这样可以确保在达到冷却阈值时及时分层、而不管这些文件是已删除还是仍位于主文件系统中。将所有可能需要的文件存储在活动文件系统中的一个位置也可以简化管理。没有理由通过搜索快照来查找需要还原的文件。</block>
  <block id="11a75a1257cc68a4a46bc553dabe0c0d" category="paragraph">。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 可以使策略有效、但该策略仅适用于不再位于活动文件系统中的适用场景块。因此、必须先删除NFS或SMB共享上的文件、然后才能对数据进行分层。</block>
  <block id="b4af96e8cea99b56592db816cab30fce" category="paragraph">对于LUN配置、此策略的效率甚至会更低、因为从LUN中删除文件只会从文件系统元数据中删除文件引用。LUN上的实际块将一直保留在原位、直到被覆盖为止。这种情况可能会在删除文件和覆盖块并成为可进行层的候选块之间造成长时间延迟。移动有一些好处<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 块到容量层、但总体而言、FabricPool备份数据管理最适合与结合使用<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略。</block>
  <block id="1c237d1ebcdeff13ae0145c741d9401d" category="admonition">这种方法有助于用户更高效地管理备份所需的空间、但FabricPool本身并不是一种备份技术。将备份文件分层到对象存储可简化管理、因为这些文件在原始存储系统上仍然可见、但对象存储目标中的数据块依赖于原始存储系统。如果源卷丢失、则对象存储数据将不再可用。</block>
  <block id="a19665c8f7c0210f96ad2934ad0ee361" category="paragraph">在ONTAP系统上、存储以4 KB为单位进行组织。一个数据库或文件系统的8 KB块应正好映射到两个4 KB块。如果LUN配置错误使对齐在任一方向上移动1 KB、则每个8 KB块将位于三个不同的4 KB存储块上、而不是两个。这种安排会增加发生原因延迟、并在存储系统中执行发生原因额外的I/O。</block>
  <block id="211a9fe299057fe8665b591dddbac56d" category="paragraph">对齐也会影响LVM架构。如果在整个驱动器设备上定义了逻辑卷组中的物理卷(不创建分区)、则LUN上的第一个4 KB块与存储系统上的第一个4 KB块对齐。这是正确的对齐方式。分区会出现问题、因为它们会移动操作系统使用LUN的起始位置。只要偏移量以4 KB的整数单位移动、LUN就会对齐。</block>
  <block id="e98a692d783d8d778aab49ed4c55e214" category="doc">站点故障保护：NVRAM和MetroCluster</block>
  <block id="186577daf29184ed8a55cf899ba2979c" category="paragraph">MetroCluster通过以下方式扩展NVRAM数据保护：</block>
  <block id="679f5a5873d7d3378cf4b3035fd5cb13" category="list-text">在双节点配置中、NVRAM数据通过交换机间链路(ISL)复制到远程配对节点。</block>
  <block id="00bec98f52b9151dd2e0c760becd4ca8" category="list-text">在HA对配置中、NVRAM数据会同时复制到本地配对节点和远程配对节点。</block>
  <block id="94deccfbf8f798c1661000b27a568b18" category="list-text">写入只有在复制到所有配对项后才会得到确认。此架构通过将NVRAM数据复制到远程配对节点来保护传输中的I/O免受站点故障的影响。驱动器级数据复制不涉及此过程。拥有聚合的控制器负责通过向聚合中的两个plexes写入数据来进行数据复制、但在站点丢失时、仍必须防止传输中I/O丢失。只有当配对控制器必须接管发生故障的控制器时、才会使用复制的NVRAM数据。</block>
  <block id="996aa1ed8a906e55c7f157a1643021b7" category="section-title">站点和磁盘架故障保护：SyncMirror和plexes</block>
  <block id="1c114a932963683e04dc7dece97c15c9" category="paragraph">SyncMirror是一种镜像技术、可增强但不会取代RAID DP或RAID-TEC。它会镜像两个独立RAID组的内容。逻辑配置如下：</block>
  <block id="b4b4f1d65cb5f1370402220b00584e79" category="list-text">驱动器会根据位置配置到两个池中。一个池由站点A上的所有驱动器组成、另一个池由站点B上的所有驱动器组成</block>
  <block id="418f0763b76bff8e324f1afdd5456b49" category="list-text">然后、基于RAID组的镜像集创建一个通用存储池(称为聚合)。从每个站点提取的驱动器数量相等。例如、一个包含20个驱动器的SyncMirror聚合将由站点A的10个驱动器和站点B的10个驱动器组成</block>
  <block id="51bf74357f742acfa0a7cd11ce52ed7f" category="list-text">给定站点上的每组驱动器都会自动配置为一个或多个完全冗余的RAID DP或RAID-TEC组、而不依赖于镜像的使用。在镜像下使用RAID可提供数据保护、即使在站点丢失后也是如此。</block>
  <block id="8a35ad1e53533c7a3a8ff427bda0deb2" category="paragraph"><block ref="8a35ad1e53533c7a3a8ff427bda0deb2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="abf64dbc3ac20af1b4a30150a016ca58" category="paragraph">上图显示了一个示例SyncMirror配置。在控制器上创建了一个包含24个驱动器的聚合、其中12个驱动器来自站点A上分配的磁盘架、12个驱动器来自站点B上分配的磁盘架这些驱动器被分组为两个镜像RAID组。RAID组0在站点A上包含一个6驱动器丛、该丛镜像到站点B上的一个6驱动器丛同样、RAID组1在站点A上包含一个6驱动器丛、该丛镜像到站点B上的6驱动器丛</block>
  <block id="d9945e1dbadc87ba8e52a5e69376005c" category="paragraph">SyncMirror通常用于为MetroCluster系统提供远程镜像、每个站点有一个数据副本。有时、它会用于在单个系统中提供额外的冗余级别。尤其是、它可以提供磁盘架级冗余。驱动器架已包含双电源和控制器、总体比金属板稍多、但在某些情况下、可能需要额外保护。例如、一家NetApp客户为汽车测试期间使用的移动实时分析平台部署了SyncMirror。该系统分为两个物理机架、配有独立的电源和独立的UPS系统。</block>
  <block id="f3495a1e6cf563a617c71164f3b11ca3" category="section-title">冗余故障：NVFAIL</block>
  <block id="c7474a3ed1a224804e4741a256bdd953" category="paragraph">如前文所述、写入操作只有在至少另一个控制器上记录到本地NVRAM和NVRAM后才会得到确认。此方法可确保硬件故障或断电不会导致传输中I/O丢失如果本地NVRAM发生故障或与其他节点的连接发生故障、则无法再镜像数据。</block>
  <block id="4774101e81ea03c43fe20e0d7f2d21d1" category="paragraph">控制因素是NVRAM是否同步。如果NVRAM已同步、则可以安全地进行节点间故障转移、而不会丢失数据。在MetroCluster配置中、如果NVRAM与底层聚合plexes处于同步状态、则可以安全地继续执行切换、而不会丢失数据。</block>
  <block id="03e97c023521445cd70307afabdcf0d5" category="paragraph">如果强制执行故障转移或切换、则数据库和其他应用程序尤其容易受到损坏的影响、因为它们在磁盘上维护着更大的内部数据缓存。如果发生强制故障转移或切换、先前确认的更改将被有效丢弃。存储阵列的内容会及时有效地向后跳转、缓存的状态不再反映磁盘上数据的状态。</block>
  <block id="ff7a32ed70b7df57dd29a3ed75e8c787" category="paragraph">为了防止出现这种情况、ONTAP允许对卷进行配置、以便针对NVRAM故障提供特殊保护。触发此保护机制后、卷将进入名为NVFAIL的状态。此状态会导致发生原因应用程序崩溃的I/O错误。此崩溃会导致应用程序关闭、以便它们不会使用过时数据。数据不应丢失、因为日志中应存在任何已提交的事务数据。通常的后续步骤是、管理员先完全关闭主机、然后再手动将LUN和卷重新联机。虽然这些步骤可能涉及一些工作、但这种方法是确保数据完整性的最安全方法。并非所有数据都需要这种保护、这就是可以逐个卷配置NVFAIL行为的原因。</block>
  <block id="637d4b37868fb7825461df6edd674158" category="section-title">HA对和MetroCluster</block>
  <block id="9d8738f531e6c6a809ba66315beaa2f4" category="paragraph">MetroCluster有两种配置：双节点和HA对。就NVRAM而言、双节点配置与HA对的行为相同。如果发生突然故障、配对节点可以重放NVRAM数据、以确保驱动器一致、并确保未丢失任何已确认的写入。</block>
  <block id="936f4311b16ee4dc74a5564892f8976d" category="paragraph">HA对配置也会将NVRAM复制到本地配对节点。简单的控制器故障会导致配对节点上的NVRAM重放、就像不使用MetroCluster的独立HA对一样。如果站点突然完全丢失、远程站点还具有必要的NVRAM、以使驱动器保持一致并开始提供数据。</block>
  <block id="83b6c3c3018b913ecf1aca67e0daa35e" category="paragraph">MetroCluster的一个重要方面是、在正常运行条件下、远程节点无法访问配对节点数据。每个站点本质上都是一个独立的系统、可以承担相反站点的特性。此过程称为切换、其中包括计划内切换、在此过程中、站点操作会无系统地迁移到相反站点。此外、还包括站点丢失以及在灾难恢复过程中需要手动或自动切换的计划外情况。</block>
  <block id="58504b36cfdfd10d5f2802d7b943a379" category="section-title">切换和切回</block>
  <block id="d505751d1708fb5d57b0e23d089507a9" category="paragraph">术语切换和切回是指在MetroCluster配置中的远程控制器之间过渡卷的过程。此过程仅会对远程节点执行适用场景。如果在四卷配置中使用MetroCluster、则本地节点故障转移与前面所述的接管和恢复过程相同。</block>
  <block id="1127608e73df5ede22b149c8f19fc860" category="section-title">计划内切换和切回</block>
  <block id="a6733335678588619c977608e891e54e" category="paragraph">计划内切换或切回类似于节点之间的接管或交还。此过程包含多个步骤、看起来可能需要几分钟时间、但实际发生的是存储和网络资源的多阶段平稳过渡。控制传输的速度比执行完整命令所需的时间快得多。</block>
  <block id="4bb5647dcff332f0b53819ecd631303c" category="paragraph">接管/交还与切换/切回之间的主要区别在于对FC SAN连接的影响。使用本地接管/备份时、主机会丢失指向本地节点的所有FC路径、并依靠其本机MPIO切换到可用的备用路径。端口不会重新定位。通过切换和切回、控制器上的虚拟FC目标端口将过渡到另一站点。它们实际上暂时不再存在于SAN上、然后重新出现在备用控制器上。</block>
  <block id="0ba902ec3f6ce91c2e801715bb8b96fa" category="section-title">SyncMirror超时</block>
  <block id="9c8a1814b60b84d1aa68fa7bba69138b" category="paragraph">SyncMirror是一种ONTAP镜像技术、可针对磁盘架故障提供保护。如果磁盘架相隔一段距离、则可以实现远程数据保护。</block>
  <block id="68cf36f65a7e56ff3b6c0894be3ed9e8" category="paragraph">SyncMirror不提供通用同步镜像。结果是可用性更好。某些存储系统使用持续的全镜像或无镜像、有时称为Domino模式。这种形式的镜像在应用程序中受到限制、因为如果与远程站点的连接断开、所有写入活动都必须停止。否则、写入将在一个站点上存在、而在另一个站点上不存在。通常、此类环境会配置为在站点间连接丢失的时间较短(例如30秒)时使LUN脱机。</block>
  <block id="84ad4c21def9c355e80ef250d910bfa2" category="paragraph">这种行为适合一小部分环境。但是、大多数应用程序都需要一个解决方案、该系统可以在正常运行条件下提供有保障的同步复制、但可以暂停复制。站点间连接完全断开通常被视为近乎灾难的情况。通常、此类环境会保持联机并提供数据、直到修复连接或正式决定关闭环境以保护数据为止。仅由于远程复制失败而要求自动关闭应用程序的要求并不常见。</block>
  <block id="e3bd381a7bbaee6c741aee230972acf4" category="paragraph">SyncMirror支持同步镜像要求、并具有超时的灵活性。如果与远程控制器和/或丛的连接断开、30秒计时器将开始倒计时。当计数器达到0时、写入I/O处理将继续使用本地数据。数据的远程副本可用、但会及时冻结、直到连接恢复为止。重新同步利用聚合级快照使系统尽快恢复到同步模式。</block>
  <block id="0c919cd6511df6d83b811234b0448374" category="paragraph">值得注意的是、在许多情况下、在应用程序层实施这种通用的全Domino模式或全无Domino模式复制效果更佳。例如、Oracle DataGuard包括最大保护模式、可保证在任何情况下进行长实例复制。如果复制链路出现故障的时间超过可配置的超时时间、数据库将关闭。</block>
  <block id="ba92cbe464cfee8aa12c41e6aecd1071" category="section-title">使用光纤连接MetroCluster自动执行无人看管切换</block>
  <block id="515094655d10031595da776c94b3d710" category="paragraph">自动无人值守切换(Automatic无人值守切换、AUSO)是一项光纤连接的MetroCluster功能、可提供一种跨站点HA形式。如前文所述、MetroCluster有两种类型：每个站点上一个控制器或每个站点上一个HA对。HA选项的主要优势是、计划内或计划外控制器关闭仍可使所有I/O都位于本地。单节点选项的优势在于降低成本、复杂性和基础架构。</block>
  <block id="29d4da26af76b66db3a172a39edf8367" category="paragraph">AUSO的主要价值是提高光纤连接MetroCluster系统的HA功能。每个站点都会监控相反站点的运行状况、如果没有节点可提供数据、则AUSO会导致快速切换。在每个站点只有一个节点的MetroCluster配置中、此方法尤其有用、因为它使配置在可用性方面更接近HA对。</block>
  <block id="6b3a5f7923b2d803fd3b28c255fef420" category="paragraph">AUSO无法在HA对级别提供全面监控。HA对可以提供极高的可用性、因为它包含两根冗余物理缆线、用于节点到节点的直接通信。此外、HA对中的两个节点均可访问冗余环路上的同一组磁盘、从而为一个节点提供另一条路由来监控另一个节点的运行状况。</block>
  <block id="da87dad268507a3523bc38275b1d3fbc" category="paragraph">MetroCluster集群存在于节点间通信和磁盘访问均依赖于站点间网络连接的站点之间。监控集群其余部分的检测信号的能力有限。在另一个站点因网络问题而实际关闭而不是不可用的情况下、AUSO必须区分这种情况。</block>
  <block id="e8e4f55c4203e7fb24d4543a7a0f65da" category="paragraph">因此、如果HA对中的控制器检测到因特定原因(例如系统崩溃)而发生的控制器故障、则该控制器可能会提示接管。如果完全断开连接(有时称为丢失检测信号)、它还会提示接管。</block>
  <block id="91aa4ce36cb243281f3777d66c8f89e0" category="paragraph">只有在原始站点上检测到特定故障时、MetroCluster系统才能安全地执行自动切换。此外、拥有存储系统的控制器必须能够保证磁盘和NVRAM数据保持同步。控制器无法仅因为与源站点断开连接而保证切换的安全性、而源站点仍可正常运行。有关自动执行切换的其他选项、请参见下一节中有关MetroCluster Tieb破碎 机(MCTB)解决方案的信息。</block>
  <block id="8e7705fe4aea384d7f6a99ab6dc0f408" category="section-title">具有光纤连接MetroCluster的MetroCluster Tieb破碎 机</block>
  <block id="897b7698cb343dbc3452e845705ab0f3" category="inline-link">NetApp MetroCluster Tieb破碎 机</block>
  <block id="9c093f14319e8253b8c9b37290597239" category="inline-link">NetApp 支持站点</block>
  <block id="6f29b1849750ceee5eb7f6f02d100e6b" category="paragraph">使用AUSO自动切换也与MCTB兼容。AUSO反应非常迅速、因为它可以检测特定的故障事件、然后仅在NVRAM和SyncMirror plexes处于同步状态时调用切换。</block>
  <block id="6f5c7ae76595eca2ca83c5dd30cd8e9f" category="paragraph">相反、Tieb破碎 机位于远程位置、因此必须等待计时器经过、然后才能宣布站点停机。Tieb破碎 机最终会检测到由AUSO涵盖的那种控制器故障、但通常、在Tieb破碎 机开始工作之前、AUSO已启动切换、并且可能已完成切换。Tieb破碎 机生成的第二个切换命令将被拒绝。</block>
  <block id="7110edd59c3d0f25a584723f6fea26a0" category="paragraph">此外、MCTB可能无法解决导致以下一系列事件的滚动灾难：</block>
  <block id="93d732b784eaf1a323f191e75c10f233" category="list-text">站点之间的连接中断30秒以上。</block>
  <block id="81d4275cc3534a9fa8cfdcdb5172eb94" category="list-text">SyncMirror复制超时、并且会继续在主站点上执行操作、从而使远程副本过时。</block>
  <block id="44441f68631008a941ce92e985131ff9" category="list-text">主站点丢失。结果是主站点上存在未复制的更改。因此、切换可能不受欢迎、原因有很多、其中包括：</block>
  <block id="499527dd40fad77b119b8b33c99cd614" category="list-text">主站点上可能存在关键数据、这些数据最终可能是可恢复的。允许应用程序继续运行的切换将有效地丢弃这些关键数据。</block>
  <block id="86de4e3737e3d871dacf8ffef353fc31" category="list-text">运行正常的站点上的某个应用程序在站点丢失时使用了主站点上的存储资源、此应用程序可能已缓存数据。切换会导致数据版本过时、与缓存不匹配。</block>
  <block id="dbb2a01afe28c8310daf781bb80b795f" category="list-text">运行正常的站点上的某个操作系统在站点丢失时使用了主站点上的存储资源、此操作系统可能已缓存数据。切换会导致数据版本过时、与缓存不匹配。最安全的方法是、将Tieber4配置为在检测到站点故障时发送警报、然后由某人决定是否强制执行切换。可能需要先关闭应用程序和/或操作系统、才能清除缓存的任何数据。此外、还可以使用NVFAIL设置来添加进一步的保护、并帮助简化故障转移过程。</block>
  <block id="ec6b0ea9c511479c118aa0f028f6519d" category="section-title">使用MetroCluster IP的ONTAP调解器</block>
  <block id="991d7d7d7388ccdd87c65ca09aa804f2" category="paragraph">光纤连接的MetroCluster可以直接访问相反站点上的存储设备。这样、一个MetroCluster控制器就可以通过从驱动器中读取检测信号数据来监控其他控制器的运行状况。这样、一个控制器就可以识别另一个控制器的故障并执行切换。</block>
  <block id="db2e932a11478bcf14c75d38e8b9a170" category="paragraph">相比之下、MetroCluster IP架构会通过控制器-控制器连接独占路由所有I/O；无法直接访问远程站点上的存储设备。这会限制控制器检测故障和执行切换的能力。因此、需要将ONTAP调解器作为Tieb破碎 机设备来检测站点丢失并自动执行切换。</block>
  <block id="8004e6d63f487a456290225b74768a6c" category="section-title">使用ClusterLion的虚拟第三站点</block>
  <block id="f1d5a7305654a402a719675fbec810e7" category="paragraph">ClusterLion是一种高级MetroCluster监控设备、可充当虚拟第三站点。通过这种方法、可以在双站点配置中安全地部署MetroCluster、并提供完全自动化的切换功能。此外、ClusterLion还可以执行额外的网络级监控并执行切换后操作。完整文档可从ProLion获得。</block>
  <block id="f8aae92ec17ec82868ef9ffc767dbd03" category="list-text">ClusterLion设备可通过直接连接的以太网和串行缆线监控控制器的运行状况。</block>
  <block id="c5f8963a91e3d8e7ac0abda2eab9f17d" category="list-text">这两个设备通过冗余3G无线连接相互连接。</block>
  <block id="24de16a13a1b584832d19117982cbfa6" category="list-text">ONTAP控制器的电源通过内部继电器供电。如果站点发生故障、包含内部UPS系统的ClusterLion会在调用切换之前断开电源连接。此过程可确保不会出现脑裂情况。</block>
  <block id="b2bcd3c3c555e2e4f27d453de4e0f06d" category="list-text">ClusterLion会在30秒SyncMirror超时时间内执行切换、或者根本不执行切换。</block>
  <block id="390fb5f827a3fbcdc7d05e6e7db03223" category="list-text">除非NVRAM和SyncMirror plexes的状态保持同步、否则ClusterLion不会执行切换。</block>
  <block id="f322f850d55e87946f9660e4ccb1bbb6" category="list-text">由于ClusterLion仅在MetroCluster完全同步时执行切换、因此不需要NVFAIL。此配置允许站点范围的环境(例如扩展Oracle RAC)保持联机、即使在计划外切换期间也是如此。</block>
  <block id="5c132e05fb0e306f56955603619de359" category="list-text">支持包括光纤连接MetroCluster和MetroCluster IP</block>
  <block id="86bcf99dbc3944da56f06b48074d09f6" category="doc">正常运行</block>
  <block id="e48472f7daf781b63506f9e296443027" category="paragraph">在正常操作下、可以从本地副本或远程副本访问LUN。红线表示ALOA公布的优化路径、结果应该是会优先沿着此路径发送IO。</block>
  <block id="e139a585510a502bbf1841cf589f5086" category="section-title">失败</block>
  <block id="7ed516552b652790c92df0bf237264b2" category="paragraph">如果活动镜像副本因计划内或计划外故障转移而变得不可用、则很明显、它将不再可用。但是、远程系统具有同步副本、并且指向远程站点的SAN路径已存在。远程系统能够为该LUN提供IO服务。</block>
  <block id="7388404ef116c3ff812bfd290b094d9e" category="section-title">故障转移</block>
  <block id="997dfe060d2107e84407cfb41e692c54" category="paragraph">故障转移会导致远程副本成为活动副本。这些路径将从"Active/Optimized"(活动/优化)更改为"Active/Optimized"(活动/优化)、并且IO将继续提供服务、而不会丢失数据</block>
  <block id="0493d27e20d11e356e53e0a730b0ad08" category="section-title">修复</block>
  <block id="6d80a3efb80520f47b63dc279e1bea3d" category="section-title">故障恢复</block>
  <block id="d47f47372b9b94d274cceb3638b28845" category="paragraph">如果需要、管理员可以执行故障恢复、并将LUN的活动副本移回原始控制器。</block>
  <block id="0c99cedb6f39d8ac16d5b4c01c162c23" category="paragraph">数据库重做/事务日志记录通常会生成未对齐的I/O、此I/O可能会导致发生原因发出有关ONTAP上LUN错位的警告、从而使人产生误解。</block>
  <block id="b2f7bb8e75b21ee3e883141c6ac1defe" category="paragraph">日志记录会使用不同大小的写入顺序写入日志文件。不与4 KB边界对齐的日志写入操作通常不会出现发生原因性能问题、因为下一个日志写入操作会完成块。因此、ONTAP几乎能够将所有写入作为完整的4 KB块进行处理、即使某些4 KB块中的数据是在两个单独的操作中写入的。</block>
  <block id="0e635e1f8ffad809203304cf41ed45c4" category="inline-link-macro">WAFL对齐验证</block>
  <block id="bf837d24f10c904e697e3c0092da43b9" category="paragraph">使用等实用程序验证对齐情况<block ref="40883add63f1fbabc7fe6158f93c1246" prefix=" " category="inline-code"></block> 或<block ref="1aabac6d068eef6a7bad3fdf50a05cc8" prefix=" " category="inline-code"></block> 可以按定义的块大小生成I/O。可以使用查看存储系统上的I/O对齐统计信息<block ref="446501053769c06c565094b26d26e8ef" prefix=" " category="inline-code"></block> 命令：请参见 <block ref="ebccec7997af507c87f985ec4ccec634" category="inline-link-macro-rx"></block> 有关详细信息 ...</block>
  <block id="b5ffbfb0c082804ad41d0f61c87525ed" category="paragraph">许多应用程序数据集都按日期进行组织、随着数据老化、访问这些数据的可能性通常越来越小。例如、银行可能有一个PDF文件存储库、其中包含五年的客户对账单、但只有最近几个月处于活动状态。FabricPool可用于将旧数据文件重新定位到容量层。冷却期为14天、可确保最近14天的PDF文件仍保留在性能层上。此外、至少每14天读取一次的文件将保持热状态、因此仍保留在性能层上。</block>
  <block id="ed7e2cc7ff107d4b2032fe65cf4e756a" category="paragraph">要实施基于文件的分层方法、您必须拥有已写入且随后未修改的文件。。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 策略应设置得足够高、以便可能需要的文件仍保留在性能层上。例如、如果某个数据集需要最近60天的数据且性能最佳、则需要设置<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 期限为60。根据文件访问模式、也可以实现类似的结果。例如、如果需要最近90天的数据、而应用程序正在访问这90天的数据、则数据将保留在性能层上。通过设置<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 从2开始、当数据变得不太活跃后、您会收到分层提示。</block>
  <block id="8a467b35326e4738b1bd39865c3b21a0" category="admonition">任何类型的数据访问都会重置热图数据。病毒扫描、索引编制甚至是读取源文件的备份活动会阻止分层、因为需要分层<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 从未达到阈值。</block>
  <block id="7a1920d61156abc05a60135aefe8bc67" category="doc">Default</block>
  <block id="5ba46d288640832c345e169b04a7458a" category="paragraph">所有FabricPool卷的初始设置为<block ref="c21f969b5f03d33d43e04f8f136e7682" prefix=" " category="inline-code"></block>，这意味着该行为由`云检索策略控制。`具体行为取决于所使用的层策略。</block>
  <block id="d556a0d2cad80695d1d803ebb49de9cd" category="section-title">读取时</block>
  <block id="7c39eb141ca855e5a211b468bd67636c" category="paragraph">正在设置 ...<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> 到读取时会覆盖默认行为、因此读取任何分层数据都会将该数据返回到性能层。</block>
  <block id="e07df43ea07fecb178484ef278644eb2" category="paragraph">例如、某个卷在下可能已长时间使用不多<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 分层策略和大多数块现在已分层。</block>
  <block id="98c8614a9e0467f220df33a02cf7550a" category="paragraph">如果业务需求发生意外变化、需要重复扫描某些数据以准备特定报告、则可能需要更改<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> to<block ref="0ba0dc933ac714a0bef4467360437336" prefix=" " category="inline-code"></block> 以确保读取的所有数据(包括按顺序读取的数据和随机读取的数据)都返回到性能层。这样可以提高卷的顺序I/O性能。</block>
  <block id="3ea4ba4aadef21fbda74c9b242c99efa" category="section-title">提升</block>
  <block id="cb674c0cbcbaa23bdd3c8e4f6182f865" category="paragraph">提升策略的行为取决于层策略。如果此层策略为<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block>，然后设置<block ref="723c2b1883eb9949dd821267c2d1b5c7" prefix=" " category="inline-code"></block> 在下次分层扫描时从容量层恢复所有块。</block>
  <block id="452d85cc34fd3a4cf55ac61e732239f4" category="paragraph">如果此层策略为<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block>，则返回的唯一块是与活动文件系统关联的块。通常、这不会产生任何影响、因为只有数据块在下进行了分层<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 策略将是专门与快照关联的块。活动文件系统中不会存在分层块。</block>
  <block id="d6269fb1a970b6c261fedbc79464b3dc" category="paragraph">但是、如果卷上的数据是通过卷SnapRestore或文件克隆操作从快照还原的、则活动文件系统现在可能需要一些因仅与快照关联而分层出的块。可能需要临时更改<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> 策略为<block ref="eeefc0add5ccd6e20ac4214923d27fbc" prefix=" " category="inline-code"></block> 以快速检索所有本地所需的块。</block>
  <block id="6e7b34fa59e1bd229b207892956dc41c" category="section-title">从不</block>
  <block id="c45e30a0f86af155e2feb17dd7ba6e44" category="paragraph">请勿从容量层检索块。</block>
  <block id="2d242bb36ec91b32005f9296ff03a912" category="doc">架构</block>
  <block id="ac30d4a74ecef302adab70e9669a4bf2" category="paragraph">FabricPool是一种分层技术、可将块分为热块或冷块、并将其放置在最合适的存储层中。性能层通常位于SSD存储上、并托管热数据块。容量层位于对象存储上、用于托管超酷数据块。对象存储支持包括NetApp StorageGRID、ONTAP S3、Microsoft Azure Blot存储、阿里云对象存储服务、IBM云对象存储、Google云存储和Amazon AWS S3。</block>
  <block id="f9f5fe2f7456d37c955f3291744c93b6" category="paragraph">可以使用多个分层策略来控制块的分类方式、这些策略可以按卷设置、也可以根据需要进行更改。在性能层和容量层之间仅移动数据块。定义LUN和文件系统结构的元数据始终保留在性能层上。因此、可在ONTAP上集中管理。文件和LUN的显示与任何其他ONTAP配置中存储的数据没有任何不同。NetApp AFF或FAS控制器会应用定义的策略将数据移动到相应的层。</block>
  <block id="616ce0475334fe37834d13972a168ca5" category="section-title">对象存储提供程序</block>
  <block id="71e79501cc067e6b35ac3d3e97c940a4" category="paragraph">对象存储协议使用简单的HTTP或HTTPS请求来存储大量数据对象。对对象存储的访问必须可靠、因为从ONTAP进行数据访问取决于请求的及时处理。选项包括Amazon S3 Standard和Infrequent Access选项、以及Microsoft Azure Hot and Cool Blot Storage、IBM Cloud和Google Cloud。不支持Amazon Glacier和Amazon Archive等归档选项、因为检索数据所需的时间可能会超出主机操作系统和应用程序的容错范围。</block>
  <block id="e114e830308285cd9085063fad91662c" category="paragraph">NetApp StorageGRID也受支持、是最佳的企业级解决方案。它是一个高性能、可扩展且高度安全的对象存储系统、可以为FabricPool数据以及越来越可能成为企业应用程序环境一部分的其他对象存储应用程序提供地理冗余。</block>
  <block id="fb318c5cd9ed18c79e1f7a298dd96665" category="paragraph">StorageGRID还可以通过避免许多公有云提供商为从其服务中读取数据而收取的传出费用来降低成本。</block>
  <block id="119d8a1213b5b7cae4bb567153b028cf" category="section-title">数据和元数据</block>
  <block id="b59d6123a3191bd85fe14e57b7a01e11" category="paragraph">请注意、此处的术语"数据"适用场景是指实际数据块、而不是元数据。仅对数据块进行分层、而元数据保留在性能层中。此外、只有读取实际数据块时、数据块的状态才会受到热或冷的影响。仅读取文件的名称、时间戳或所有权元数据并不会影响底层数据块的位置。</block>
  <block id="1414cdc093d39dd56d0b0d20049e17fc" category="section-title">备份</block>
  <block id="e0b766a7a0a7633679ecddd0f78a7390" category="paragraph">虽然FabricPool可以显著减少存储占用空间、但它本身并不是一个备份解决方案。NetApp WAFL元数据始终保留在性能层上。如果灾难性灾难破坏了性能层、则无法使用容量层上的数据创建新环境、因为该环境不包含WAFL元数据。</block>
  <block id="7a25ce12890e524732cb71784b5915ab" category="paragraph">但是、FabricPool可以成为备份策略的一部分。例如、可以为FabricPool配置NetApp SnapMirror复制技术。镜像的每一半都可以与对象存储目标建立自己的连接。结果是生成两个独立的数据副本。主副本由性能层上的块以及容量层中的关联块组成、副本是第二组性能和容量块。</block>
  <block id="82af841589057aa8922b1ac3bb4a28a4" category="doc">压缩</block>
  <block id="e242ff0701d9ed7d8317b32fd762a100" category="paragraph">数据压缩、数据缩减和重复数据删除等空间效率功能旨在增加给定物理存储量所需的逻辑数据量。这样可以降低成本和管理开销。</block>
  <block id="13b992c3d358d786db03341886472c4f" category="paragraph">从较高层面来看、数据压缩是一个数学过程、通过该过程、可以检测数据模式并对其进行编码、从而减少空间需求。相反、重复数据删除会检测实际重复的数据块并删除无关的副本。数据缩减允许多个逻辑数据块共享介质上的同一物理块。</block>
  <block id="786d7cc1b18aa3d9c3e8d3e30865240e" category="paragraph">在全闪存存储系统推出之前、基于阵列的数据压缩的价值有限、因为大多数I/O密集型工作负载都需要大量磁盘轴才能提供可接受的性能。由于驱动器数量众多、存储系统所含容量总是远远超出所需容量。随着固态存储的兴起、这种情况发生了变化。不再需要纯粹为了获得良好的性能而大量过度配置驱动器。存储系统中的驱动器空间可以与实际容量需求相匹配。</block>
  <block id="b207c460d31fea9e1cfab71057e8152c" category="paragraph">与旋转驱动器相比、固态驱动器(SSD)的IOPS功能提高几乎始终可以节省成本、但数据压缩可以通过增加固态介质的有效容量来进一步节省成本。</block>
  <block id="6296c8b7406b90d37edf269f1ea6f6ee" category="section-title">自适应数据压缩</block>
  <block id="1245fef302b5da2c27766d9a98ad358c" category="paragraph">自适应数据压缩已针对企业级工作负载进行了全面测试、未观察到对性能的影响、即使在延迟以微秒为单位的全闪存环境中也是如此。一些客户甚至报告说、使用数据压缩后性能会提高、因为数据会在缓存中保持压缩状态、从而有效地增加了控制器中的可用缓存量。</block>
  <block id="93e0a644c8f1b7f7f378bc071d15d1e9" category="paragraph">ONTAP以4 KB为单位管理物理块。自适应数据压缩使用默认的压缩块大小8 KB、这意味着数据以8 KB单位进行压缩。这与关系数据库最常使用的8 KB块大小匹配。随着将更多数据作为一个单元进行压缩、数据压缩算法的效率也会提高。32 KB压缩块大小比8 KB压缩块单元更节省空间。这确实意味着、使用默认8 KB块大小的自适应数据压缩确实会使效率率略低、但使用更小的数据压缩块大小也会有显著优势。数据库工作负载包含大量覆盖活动。要覆盖经过压缩的32 KB数据块中的8 KB、需要回读整个32 KB逻辑数据、对其进行解压缩、更新所需的8 KB区域、重新压缩、然后将整个32 KB写入驱动器。这对存储系统来说是一项非常昂贵的操作、因此、某些基于较大压缩块大小的竞争存储阵列也会对数据库工作负载的性能造成严重影响。</block>
  <block id="1f9367b7afff301ee24188d35050ae0a" category="section-title">对温度敏感的存储效率</block>
  <block id="02e44d620def629a6c145ccd0d9a0fd3" category="section-title">数据压缩对齐</block>
  <block id="3b6e6c232a02ab9c64199eb9efae012c" category="paragraph">数据库环境中的自适应数据压缩需要在一定程度上考虑数据压缩块对齐问题。对于随机覆盖非常特定的块的数据来说、这样做只是一个问题。这种方法在概念上类似于整体文件系统对齐、即文件系统的起点必须与4 k设备边界对齐、文件系统的块大小必须是4 k的倍数。</block>
  <block id="1d1a594959ec615f56516f5d0f5e8ddb" category="section-title">NFS</block>
  <block id="62a0282d39568be094470486eaf70c4f" category="section-title">SAN</block>
  <block id="14c3c56ff2a98d1a9c47b63a917f67a3" category="section-title">数据缩减</block>
  <block id="0b01f66d49b9df153ee76048de44f6eb" category="paragraph">数据缩减的工作原理是、允许将多个逻辑块存储在物理块中。例如、具有高度可压缩数据(例如文本或部分全满块)的数据库可以从8 KB压缩到1 KB。如果不进行数据缩减、这1 KB的数据仍会占用整个4 KB块。实时数据缩减允许将1 KB的压缩数据与其他压缩数据一起存储在仅1 KB的物理空间中。它不是一种压缩技术；它只是一种在驱动器上分配空间的更高效的方式、因此不会产生任何可检测的性能影响。</block>
  <block id="83f45cad5e6f535ff10e564a526baad0" category="section-title">重复数据删除</block>
  <block id="f591ef30da06841378ee7f595e63a93c" category="paragraph">重复数据删除是指从数据集中删除重复的块大小。例如、如果10个不同文件中存在相同的4 KB块、则重复数据删除会将所有10个文件中的4 KB块重定向到相同的4 KB物理块。结果是、这些数据的效率将提高10：1。</block>
  <block id="699c85c5df1985b2af588f9e6c1ad353" category="paragraph">VMware子系统启动LUN等数据的重复数据删除效果通常非常好、因为它们包含同一操作系统文件的多个副本。我们观察到的效率为100：1甚至更高。</block>
  <block id="9653a3d4907877aae00bb7d39eeec66d" category="paragraph">在少数情况下、使用16 KB和大型块的数据库可节省多达15%的空间。每个块的初始4 KB包含全局唯一标头、而最后4 KB块包含接近唯一的尾部。内部块是重复数据删除的候选数据、但实际上、这几乎完全是由于对置零数据进行重复数据删除。</block>
  <block id="32aeb47267cb2045610b468115f3ae0e" category="section-title">效率和精简配置</block>
  <block id="3381946611f34fb44ad8a38a0c44e0a8" category="paragraph">效率功能是精简配置的一种形式。例如、占用100 GB卷的100 GB LUN可能会压缩到50 GB。由于卷仍为100 GB、因此尚未实现实际节省。必须先减小卷大小、以便节省的空间可用于系统上的其他位置。如果稍后更改100 GB LUN会导致数据的可压缩性降低、则LUN大小会增大、卷可能会填满。</block>
  <block id="38ef8b6f2fc332958c293d93c61d7756" category="paragraph">有些客户更喜欢对特定工作负载使用厚配置、或者通常根据既定的运营和采购实践使用厚配置。</block>
  <block id="0e7c78164adb6d4650ea685a79d8e99e" category="section-title">效率最佳实践</block>
  <block id="ec499ad25fa5a765ba43ec2c87819623" category="section-title">AFF默认值</block>
  <block id="9f7127e69d50bf7b844ff3723b86fbd1" category="section-title">一般建议</block>
  <block id="4922fe547c351d6a121465da036d478e" category="list-text">如果数据不会被覆盖(例如使用备份或数据库事务日志)、则可以通过在较低的冷却期启用TSSE来提高效率。</block>
  <block id="e75fd383e4106eb78482b18896975daf" category="list-text">某些文件可能包含大量不可压缩数据、例如、在应用程序级别已启用数据压缩时、文件已加密。如果出现上述任一情况、请考虑禁用数据压缩、以便在包含可压缩数据的其他卷上执行更高效的操作。</block>
  <block id="64d5def835c194cac8afe4fafded756e" category="doc">Policies—本地快照</block>
  <block id="baa596d0db91317fa83739a95649752e" category="paragraph">FabricPool的初始版本针对备份用例。唯一可以分层的块类型是不再与活动文件系统中的数据关联的块。因此、只能将快照数据块移至容量层。当您需要确保性能不会受到影响时、这仍然是最安全的一种层选项。</block>
  <block id="b21eb7f0b67c3e27e915183638bf92cf" category="paragraph">可通过两种方法将非活动快照块分层到容量层。首先是<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 策略仅针对快照块。虽然<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略包括<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 块、它还会对活动文件系统中的块进行分层。这可能并不可取。</block>
  <block id="eeba990304f236b36a9fec2434c77470" category="paragraph">。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 值应设置为一个时间段、以便在性能层上提供还原期间可能需要的数据。例如、关键生产数据库的大多数还原方案都包括前几天某个时间的还原点。设置A<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 值为3可确保对文件进行任何还原都能使文件立即实现最高性能。活动文件中的所有块仍位于快速存储上、而无需从容量层中恢复。</block>
  <block id="baf531ed01ad56f5614e1a68e8a2e7aa" category="section-title">Policies—复制的快照</block>
  <block id="27e5121a4c75181022e7be2b738339d0" category="paragraph">使用SnapMirror或SnapVault复制的快照仅用于恢复、通常应使用FabricPool<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 策略。使用此策略、可以复制元数据、但所有数据块都会立即发送到容量层、从而实现最高性能。大多数恢复过程都涉及顺序I/O、这本身就很高效。应评估从对象存储目标恢复的时间、但在设计完善的架构中、此恢复过程不需要比从本地数据恢复明显慢。</block>
  <block id="639e481de0ffe002bd83251b26a2540a" category="paragraph">如果复制的数据也要用于克隆、则<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略更合适、使用<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 包含预计在克隆环境中定期使用的数据的价值。例如、数据库的活动工作集可能包括前三天读取或写入的数据、但也可能包括另外6个月的历史数据。如果是、则<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> SnapMirror目标上的策略可使工作集在性能层上可用。</block>
  <block id="ace0bd0c1be3a9e17d9736d93e7a1da2" category="doc">IOPS QoS</block>
  <block id="786ee59e0cdaa09335e12fea3a168653" category="paragraph">具体而言、随着全闪存存储的采用率不断提高、工作负载得以整合。由于旧旋转驱动器技术的IOPS功能有限、依赖旋转介质的存储阵列往往仅支持数量有限的I/O密集型工作负载。早在存储控制器达到其限制之前、一两个高度活跃的数据库就会使底层驱动器饱和。这种情况已经改变。即使是功能最强大的存储控制器、数量相对较少的SSD驱动器的性能也可能会饱和。这意味着、可以充分利用控制器的全部功能、而不必担心随着旋转介质延迟峰值而导致性能突然崩溃。</block>
  <block id="270d79669200ef485add1ecc1833cc94" category="paragraph">作为一个参考示例、一个简单的双节点HA AFF A800系统能够在延迟超过1秒之前提供高达100万次随机IOPS。只有极少数单个工作负载才能达到此级别。要充分利用此AFF A800系统阵列、需要托管多个工作负载、而安全地执行此操作、同时确保可预测性、则需要QoS控制。</block>
  <block id="4dca0c3547523a2e5bd1b8d0e2ff8de5" category="paragraph">ONTAP中有两种类型的服务质量(QoS)：IOPS和带宽。QoS控制可应用于SVM、卷、LUN和文件。</block>
  <block id="3ea539ed2021ba46a3658039e8af419f" category="paragraph">IOPS QoS控制显然基于给定资源的总IOPS、但IOPS QoS的许多方面可能并不直观。最初、一些客户对达到IOPS阈值时延迟明显增加感到很不明白。限制IOPS自然会导致延迟增加。从逻辑上讲、它的功能类似于令牌系统。例如、如果包含数据文件的给定卷具有10000 IOPS限制、则到达的每个I/O都必须先接收令牌才能继续处理。只要在给定的一秒内使用的令牌不超过10000个、就不会出现延迟。如果IO操作必须等待接收其令牌、则此等待将显示为额外的延迟。工作负载越难超过QoS限制、每个IO在队列中等待处理的时间就越长、这在用户看来是延迟越高。</block>
  <block id="34a96885dd7f4501920b13026e7f2cab" category="admonition">对数据库事务/重做日志数据应用QoS控制时要小心。虽然重做日志记录的性能需求通常要比数据文件低很多、但重做日志活动会变得突发。IO会以短暂的脉冲发生、并且似乎适合平均重做IO级别的QoS限制对于实际要求可能过低。结果可能会造成严重的性能限制、因为QoS会与每个重做日志突发事件结合使用。通常、重做和归档日志记录不应受QoS的限制。</block>
  <block id="c79dc76371299e08f4b4ebd609314ca4" category="section-title">带宽QoS</block>
  <block id="b9d5c520039715de9b997c5a69f4aeaa" category="paragraph">并非所有I/O大小都相同。例如、数据库可能会执行大量小块读取、从而导致达到IOPS阈值、 但是、数据库可能还会执行完整的表扫描操作、其中包含非常少量的大型块读取、占用的带宽非常大、但IOPS相对较少。</block>
  <block id="4930ae83bb8dd5e539dc9f7e73c6d74c" category="paragraph">同样、VMware环境可能会在启动期间产生大量随机IOPS、但在外部备份期间执行的IO会更少、但会更大。</block>
  <block id="eabb5a523a77d4521c12622ee9388aa6" category="paragraph">有时、有效管理性能需要IOPS或带宽QoS限制、甚至两者都需要。</block>
  <block id="13dac55a5f26cefab26368ea5a67e29f" category="section-title">最低/有保障的QoS</block>
  <block id="68559688130772c84bb39b2a9ca2c2af" category="paragraph">许多客户都希望解决方案能够提供有保障的QoS、而这种服务质量比看起来更难实现、而且可能会造成大量浪费。例如、如果要将10个数据库放置在10000 IOPS保证下、则需要对系统进行规模估算、以应对所有10个数据库同时以10000 IOPS运行的情形、总共需要100K IOPS。</block>
  <block id="c0938f706c890ea85c86388391ffad22" category="paragraph">最低QoS控制的最佳用途是保护关键工作负载。例如、假设一个ONTAP控制器的最大可能IOPS为50万次、并混合了生产和开发工作负载。您应将最大QoS策略应用于开发工作负载、以防止任何给定数据库独占控制器。然后、您可以对生产工作负载应用最低QoS策略、以确保它们在需要时始终具有所需的可用IOPS。</block>
  <block id="acdda1c20fb3985ce840929f7525c803" category="section-title">自适应 QoS</block>
  <block id="dd5bc58ed6ab031b170a409470d9a763" category="paragraph">自适应服务质量(QoS)是指ONTAP功能、其中服务质量(QoS)限制基于存储对象的容量。它很少用于数据库、因为数据库大小与其性能要求之间通常没有任何关联。大型数据库可能几乎处于无活动状态、而小型数据库则可能是IOPS密集型最高的数据库。</block>
  <block id="eb595833577352045f92d14ac4315ad2" category="paragraph">自适应QoS对于虚拟化数据存储库非常有用、因为此类数据集的IOPS要求往往与数据库的总大小相关。包含1 TB VMDK文件的较新数据存储库所需的性能可能是2 TB数据存储库的一半左右。自适应QoS允许您在数据存储库中填充数据时自动增加QoS限制。</block>
  <block id="23f3d415bb4fe6f99165df604b24da0e" category="paragraph">使用FabricPool对数据集进行分层会导致主存储阵列与对象存储层之间存在依赖关系。有许多对象存储选项可提供不同级别的可用性。请务必了解主存储阵列与对象存储层之间可能断开连接的影响。</block>
  <block id="7e856c11a853d276fd5d6274bf60fafd" category="paragraph">如果向ONTAP发出的I/O需要容量层中的数据、而ONTAP无法访问容量层来检索块、则此I/O最终会超时。此超时的影响取决于所使用的协议。在NFS环境中、ONTAP会根据协议使用EjUKEBOX或EDELAY响应进行响应。某些较早的操作系统可能会将此错误视为错误、但Oracle Direct NFS客户端的当前操作系统和当前修补程序级别会将此错误视为可检取的错误、并继续等待I/O完成。</block>
  <block id="207d9fe0f57910936bfa043248f3afca" category="paragraph">适用场景SAN环境超时时间更短。如果对象存储环境中需要某个块、但该块在两分钟内仍不可访问、则会向主机返回读取错误。ONTAP卷和LUN会保持联机、但主机操作系统可能会将文件系统标记为处于错误状态。</block>
  <block id="c9251835da8df507ca4f6ce02d4216be" category="paragraph">对象存储连接问题<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 策略不太值得关注、因为只有备份数据是分层的。通信问题会使数据恢复速度变慢、但不会影响正在使用的数据。。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 和<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 策略允许对活动LUN中的冷数据进行分层、这意味着对象存储数据检索期间出现错误可能会影响数据库可用性。采用这些策略的SAN部署只能与专为实现高可用性而设计的企业级对象存储和网络连接结合使用。NetApp StorageGRID是一个更好的选择。</block>
  <block id="0f8062f9220efe4f38e7236fe8885379" category="paragraph">大多数关系数据库都在事务日志归档模式下运行、以提供时间点恢复。通过记录事务日志中的更改来提交对数据库的更改、事务日志将保留而不被覆盖。因此、可能需要保留大量归档事务日志。许多其他应用程序工作流也存在类似的例子、这些工作流生成的数据必须保留、但极不可能被访问。</block>
  <block id="229384bbfb1db19c4897d87ba4b9bc2d" category="paragraph">FabricPool通过提供具有集成层的单个解决方案解决了这些问题。文件会存储在通常的位置并始终可访问、但在主阵列上几乎不会占用任何空间。</block>
  <block id="f60aec7aaed8420e09f17a8cfd1d7d37" category="paragraph">使用<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 如果策略设置为几天、则会在性能层上保留最近创建的文件(即近期最可能需要的文件)中的块。然后、旧文件中的数据块将移至容量层。</block>
  <block id="485e24df9e0ebeecf416daa6e5441bba" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 在达到冷却阈值时强制执行提示分层、而不管日志是已删除还是仍位于主文件系统中。将所有可能需要的日志存储在活动文件系统中的一个位置也可以简化管理。没有理由通过搜索快照来查找需要还原的文件。</block>
  <block id="bbe0132696bc482e0ba7a1f293d80083" category="paragraph">某些应用程序(如Microsoft SQL Server)会在备份操作期间会对事务日志文件进行节段、以便日志不再位于活动文件系统中。可以使用节省容量<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 分层策略、但<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略对日志数据没有用处、因为活动文件系统中的日志数据很少会冷却下来。</block>
  <block id="0694b4972669f201ca85f9427a230208" category="doc">MetroCluster可用于3种不同的配置</block>
  <block id="948676ffa8073153cbe404795950ad85" category="list-text">具有IP连接的HA对</block>
  <block id="ef012b81fd45a95681a584a59f8df77e" category="list-text">具有FC连接的HA对</block>
  <block id="6ffec869ba36dff4e093b5ed8bac798a" category="list-text">具有FC连接的单个控制器</block>
  <block id="4767099b22895a8101a1cba45d8cf6e9" category="section-title">MetroCluster IP</block>
  <block id="adc397d87c1a7827f2df9fdd362d5ff7" category="paragraph">HA对MetroCluster IP配置会在每个站点上使用两个或四个节点。与双节点选项相比、此配置选项会增加复杂性和成本、但它具有一个重要优势：站点内冗余。简单的控制器故障不需要通过WAN访问数据。数据访问仍通过备用本地控制器保持在本地。</block>
  <block id="c15560f2ae5432223c591c5f5d9db5c1" category="paragraph">大多数客户选择IP连接是因为基础架构要求更简单。过去、使用暗光纤和FC交换机配置高速跨站点连接通常比较容易、但如今、高速、低延迟IP电路更容易获得。</block>
  <block id="b28c5a429800ea9669a191a402a72b49" category="paragraph">此外、该架构也更加简单、因为只有跨站点连接用于控制器。在FC SAN连接的MetroCluster中、控制器会直接写入另一站点上的驱动器、因此需要更多的SAN连接、交换机和网桥。相反、IP配置中的控制器会通过控制器写入相对的驱动器。</block>
  <block id="457b0075e8f0333975a8e2aaeaceb149" category="inline-link">MetroCluster IP 解决方案架构和设计</block>
  <block id="82aa44c8aa5ebe78f1496c8fc80cb954" category="paragraph">对于追加信息、请参阅ONTAP官方文档和<block ref="03a3c76178d2d43147a2756857a0985e" category="inline-link-rx"></block>。</block>
  <block id="0d2d438a72f6c558744351265fa49a62" category="section-title">HA对FC SAN连接的MetroCluster</block>
  <block id="3e9133ff590581b29a911d9631ab1737" category="paragraph">HA对MetroCluster FC配置会在每个站点上使用两个或四个节点。与双节点选项相比、此配置选项会增加复杂性和成本、但它具有一个重要优势：站点内冗余。简单的控制器故障不需要通过WAN访问数据。数据访问仍通过备用本地控制器保持在本地。</block>
  <block id="4bc2926f030255369db3e4435de5c774" category="paragraph">某些多站点基础架构不是为主动-主动操作而设计的、而是更多地用作主站点和灾难恢复站点。在这种情况下、通常最好使用HA对MetroCluster选项、原因如下：</block>
  <block id="5f49f48dd22b405a813e2ef7cc02e9f8" category="list-text">尽管双节点MetroCluster集群是一个HA系统、但控制器意外故障或计划内维护要求数据服务必须在相反站点联机。如果站点之间的网络连接无法支持所需的带宽、则性能会受到影响。唯一的选择是同时将各种主机操作系统和相关服务故障转移到备用站点。HA对MetroCluster集群可消除此问题、因为丢失控制器会导致在同一站点内进行简单的故障转移。</block>
  <block id="0ce798a4f2e77d6aa1a6e0d718fa8e98" category="list-text">某些网络拓扑不是为跨站点访问而设计的、而是使用不同的子网或隔离的FC SAN。在这些情况下、双节点MetroCluster集群将不再充当HA系统、因为备用控制器无法向对面站点上的服务器提供数据。要提供完全冗余、需要使用高可用性对MetroCluster选项。</block>
  <block id="098fa44ef37572e0f8ea717199ac72e6" category="list-text">如果将双站点基础架构视为一个高可用性基础架构、则适合使用双节点MetroCluster配置。但是、如果系统在站点发生故障后必须长时间运行、则首选HA对、因为它会继续在单个站点中提供HA。</block>
  <block id="ea8bb3e5a357ca97851352f6944342c9" category="section-title">双节点FC SAN连接MetroCluster</block>
  <block id="b759079fef92c80eca80e7349bf84363" category="paragraph">双节点MetroCluster配置仅为每个站点使用一个节点。这种设计比HA对选项更简单、因为需要配置和维护的组件更少。此外、它还降低了布线和FC交换方面的基础架构需求。最后、它还可以降低成本。</block>
  <block id="bcf549481eb36a62594e938bca6a10bb" category="paragraph">这种设计的明显影响是、单个站点上的控制器故障意味着数据可以从另一个站点访问。这种限制不一定是问题。许多企业都拥有多站点数据中心运营、并采用延伸型高速低延迟网络、这些网络本质上充当一个基础架构。在这些情况下、首选配置是双节点版本的MetroCluster。目前、多家服务提供商以PB级的规模使用双节点系统。</block>
  <block id="78558542e724655ba80fc4879399f103" category="section-title">MetroCluster故障恢复能力功能</block>
  <block id="5427d2eb91f25a425f13544e56fb12c4" category="paragraph">MetroCluster 解决方案 中没有单点故障：</block>
  <block id="6a988bf07e73bcbf69f62ce9724dd0f3" category="list-text">每个控制器都有两条通往本地站点上的驱动器架的独立路径。</block>
  <block id="2c98a75e02c6e103b43724f02e99e393" category="list-text">每个控制器都有两条通往远程站点上驱动器架的独立路径。</block>
  <block id="e18f703538cd1f5af3b9185eed57b49b" category="list-text">每个控制器都有两条独立的路径连接到另一站点上的控制器。</block>
  <block id="800ec0ea85a62c2fb192ac2f79ee1d02" category="list-text">在HA对配置中、每个控制器都有两个指向其本地配对节点的路径。</block>
  <block id="a3d7a569ad6ea771a0ad9b995619251b" category="paragraph">总之、可以删除配置中的任何一个组件、而不会影响MetroCluster提供数据的能力。这两个选项在故障恢复能力方面的唯一区别是、发生站点故障后、HA对版本仍然是整体HA存储系统。</block>
  <block id="9b4c3976d453e66a3dd22e2793fc3a8e" category="doc">空间管理</block>
  <block id="e89d3732a2fbc592923c30e54522dcdb" category="paragraph">精简配置有多种形式、是ONTAP为企业级应用程序环境提供的许多功能不可或缺的组成部分。精简配置也与效率技术密切相关、原因相同：效率功能允许存储的逻辑数据比存储系统上的技术数据多。</block>
  <block id="537642ed3bfef7f2bb3e580b3b266bd3" category="paragraph">几乎任何快照使用都涉及精简配置。例如、NetApp存储上的典型10 TB数据库包含大约30天的快照。这种安排会使活动文件系统中显示大约10 TB的数据、并将300 TB专用于快照。总存储量为312 TB、通常占用大约12 TB到15 TB的空间。活动数据库会占用10 TB的空间、其余300 TB的数据仅需要2 TB到5 TB的空间、因为系统仅会存储对原始数据所做的更改。</block>
  <block id="a19609016ad1cb6b7bae7cac796a26a4" category="paragraph">克隆也是精简配置的一个示例。一家主要NetApp客户为一个80 TB数据库创建了40个克隆、以供开发使用。如果使用这些克隆的所有40位开发人员都覆盖了每个数据文件中的每个块、则需要3.2 PB以上的存储。实际上、周转率较低、并且总空间需求接近40 TB、因为驱动器上仅存储更改。</block>
  <block id="2433af6347e4871be5af0f2af0f6bd6e" category="paragraph">对应用程序环境进行精简配置时必须格外小心、因为数据变更率可能会意外增加。例如、如果为数据库表重新编制索引或对VMware子系统应用大规模修补、则快照占用的空间会快速增长。放错位置的备份可能会在很短的时间内写入大量数据。最后、如果文件系统意外用尽可用空间、则很难恢复某些应用程序。</block>
  <block id="5cf4dc4d1ce52ff655ea7f1157a72e2e" category="paragraph">幸运的是、这些风险可以通过仔细配置来解决<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block> 策略。正如其名称所暗示的那样、这些选项使用户能够创建策略、以自动清除快照占用的空间或增加卷以容纳更多数据。有多种选项可供选择、不同客户的需求也会有所不同。</block>
  <block id="6a28738961e6f6e4b57e4dd70c446600" category="inline-link-macro">逻辑存储管理文档</block>
  <block id="01570cb5a3aec2324ab56e318e1de04d" category="paragraph">请参见 <block ref="e69bd75bdb49183ee90588843edb33f4" category="inline-link-macro-rx"></block> 有关这些功能的完整讨论。</block>
  <block id="e10d46632bc86306cf4c22633ee930ab" category="paragraph">仔细规划LVM配置可以提高效率、并最大限度地减少存储配置和LUN大小调整的需求。使用Veritas VLVM或Oracle ASM等LVM时、底层LUN会划分为仅在需要时才使用的块区。例如、如果数据集的大小从2 TB开始、但随着时间的推移可能会增长到10 TB、则可以将此数据集放置在LVM磁盘组中组织的10 TB精简配置LUN上。在创建时、它只会占用2 TB的空间、并且只会在为满足数据增长而分配块区时占用额外空间。只要空间受到监控、此过程就会很安全。</block>
  <block id="66a41fd6fc38c454973e91d92cf0e291" category="section-title">预留百分比</block>
  <block id="e8a206fe65814e0ea465e32487544751" category="paragraph">预留百分比是指卷中LUN在空间效率方面的行为。选项<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 设置为100%时、卷中的所有数据在使用任何数据模式时均可实现100%的周转率、而不会耗尽卷上的空间。</block>
  <block id="a3cd28aef7d0becd57b60187fdc4a24e" category="paragraph">例如、假设数据库位于1 TB卷中的一个250 GB LUN上。创建快照会立即在卷中预留额外的250 GB空间、以保证卷不会因任何原因用尽空间。使用预留百分比通常会造成浪费、因为数据库卷中的每个字节极不可能需要覆盖。没有理由为从未发生的事件预留空间。但是、如果客户无法监控存储系统中的空间消耗、并且必须确保空间永远不会用尽、则需要100%预留百分比才能使用快照。</block>
  <block id="e30fbe8981929fb070a820a213381bab" category="section-title">数据压缩和重复数据删除</block>
  <block id="1b6e4e9a2be031edc6f3da1f559ef884" category="paragraph">数据压缩和重复数据删除都是精简配置的两种形式。例如、50 TB的数据占用空间可能会压缩为30 TB、从而节省20 TB的空间。要使数据压缩产生任何优势、必须将这20 TB中的一部分用于其他数据、或者购买的存储系统必须小于50 TB。这样、存储的数据就会超过存储系统上的技术可用数据。从数据角度来看、数据容量为50 TB、尽管它在驱动器上仅占用30 TB。</block>
  <block id="dbca4bb791f36eac2c11c32f73f2b4ec" category="paragraph">数据集的可压缩性总是有可能发生变化、从而导致实际空间消耗增加。这种消耗量的增加意味着、在监控和使用方面、必须像其他形式的精简配置一样管理数据压缩<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block>。</block>
  <block id="ad241666a88b5414e8c2fe6d1cc1edb0" category="paragraph">有关数据压缩和重复数据删除的详细信息、请参见链接efficiency.html</block>
  <block id="8ecfcadfebb472a089481e8554ebed87" category="section-title">数据压缩和预留百分比</block>
  <block id="4f8fcc146d2e8e712dcd8c56b1684fcc" category="paragraph">数据压缩是一种精简配置形式。预留百分比会影响数据压缩的使用、但需要注意的一点是、空间是在创建快照之前预留的。通常、只有当存在快照时、预留百分比才重要。如果没有快照、则预留百分比并不重要。而数据压缩则不是这种情况。如果在已进行数据压缩的卷上创建了LUN、则ONTAP会保留空间以容纳快照。此行为在配置期间可能会令人困惑、但这是预期行为。</block>
  <block id="e26f8048b4bf60dad827c5a425271361" category="paragraph">例如、假设一个10 GB的卷具有一个5 GB的LUN、该LUN已压缩为2.5 GB、并且没有快照。请考虑以下两种情形：</block>
  <block id="ade18971a2dab7e37335e95d81da0ef1" category="list-text">预留百分比= 100会导致利用率达到7.5 GB</block>
  <block id="1d07b8e7c92488a55301ea201328cf35" category="list-text">预留百分比= 0会导致利用率达到2.5 GB</block>
  <block id="aa410d0e46ec94b6efcf344f0d870c1a" category="paragraph">第一种情形包括：当前数据占用2.5 GB空间、而源在预计快照使用时的周转率为100%时占用5 GB空间。第二种情形不会预留任何额外空间。</block>
  <block id="e79414ad391b126cc9bd53af1624c8de" category="paragraph">虽然这种情况可能看起来令人困惑、但在实践中不太可能遇到。数据压缩意味着精简配置、而在LUN环境中进行精简配置需要预留百分比。压缩的数据始终可以被不可压缩的内容覆盖、这意味着必须对卷进行精简配置、才能进行压缩、从而节省空间。</block>
  <block id="499a10b92cb9ca6b3412d4bf5a91a2b0" category="paragraph">* NetApp建议*采用以下预留配置：</block>
  <block id="7f26e875cee50c1b3baf71a014043794" category="list-text">设置<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 如果已实施基本容量监控、则为0<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block>。</block>
  <block id="675996bd34ec0d8c134215f5be73fb3a" category="list-text">设置<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 如果没有监控能力或在任何情况下都无法排空空间、则为100。</block>
  <block id="8ee38535add58992c14b23a6f7cf8d27" category="doc">LIF类型</block>
  <block id="50d034374ef68094a0f6c8e8d06a77af" category="inline-link-macro">ONTAP网络管理文档</block>
  <block id="fc25025f3f0a2afd42465a55f35c02d0" category="paragraph">本节概述了LIF的主要设计原则。有关更全面的文档、请参见 <block ref="a3e6361e1a52d384f542a2f2d8bc9bb1" category="inline-link-macro-rx"></block>。与数据库架构的其他方面一样、Storage Virtual Machine (SVM、在CLI中称为Vserver)和逻辑接口(LIF)设计的最佳选项在很大程度上取决于扩展要求和业务需求。</block>
  <block id="be0801f7fb241be642bec73b799d45cb" category="paragraph">在制定LIF策略时、请考虑以下主要主题：</block>
  <block id="362c2978dddcf6988ce266d3d60f5beb" category="list-text">*性能。*网络带宽是否足够？</block>
  <block id="cfc88efb72b2c7ea83a4a3d68b760d55" category="list-text">*故障恢复能力。*设计中是否存在单点故障？</block>
  <block id="af02972fd4dc1e949d800731d9518812" category="list-text">*易管理性。*网络能否无干扰地扩展？</block>
  <block id="fdcbadc80d2dd31527cc91cf81fb725d" category="paragraph">这些主题适用于从主机到交换机再到存储系统的端到端解决方案。</block>
  <block id="f45fe079103703d0b315ff2e339728fd" category="inline-link-macro">有关LIF类型的ONTAP文档</block>
  <block id="cc4583278db25277db9ddcd781cbf992" category="paragraph">LIF类型有多种。 <block ref="9d27879d9d2bd4f0f081ffed63159522" category="inline-link-macro-rx"></block> 请提供有关此主题的更完整信息、但从功能角度来看、可以将这些生命周期表分为以下几组：</block>
  <block id="f34a52d788c5a4cf56d7ae8ccb85f8c2" category="list-text">*集群和节点管理Lifs.*用于管理存储集群的Lifs。</block>
  <block id="73ac4e00a9ff3caf31e6df13a6df2f78" category="list-text">* SVM管理LIF.*允许通过REST API或ONTAPI (也称为ZAPI)访问SVM的接口、用于执行创建快照或调整卷大小等功能。SnapManager for Oracle (SMO)等产品必须能够访问SVM管理LIF。</block>
  <block id="b7010e46f4769f638197aa230f448ba0" category="list-text">*数据Lifs.* FC、iSCSI、NVMe/FC、NVMe/TCP、NFS接口 或SMB/CCIFS数据。</block>
  <block id="1eb4f53fa8ee8f0954514a1b9858bf6b" category="admonition">用于NFS流量的数据LIF也可通过从更改防火墙策略来进行管理<block ref="8d777f385d3dfec8815d20f7496026dc" prefix=" " category="inline-code"></block> to<block ref="d724f231a9a7b89757c4394d6622bc47" prefix=" " category="inline-code"></block> 或其他允许HTTP、HTTPS或SSH的策略。此更改可以避免配置每个主机以访问NFS数据LIF和单独的管理LIF、从而简化网络配置。无法为iSCSI和管理流量配置接口、尽管两者都使用IP协议。在iSCSI环境中、需要使用单独的管理LIF。</block>
  <block id="85d465743ad38be108b50648ab283d78" category="section-title">SAN LIF设计</block>
  <block id="8800a54085e1b2987d83537423221cf9" category="paragraph">SAN环境中的LIF设计相对简单、原因之一是：多路径。所有现代SAN实施都允许客户端通过多个独立的网络路径访问数据、并选择最佳访问路径。因此、与LIF设计相关的性能更易于解决、因为SAN客户端会自动在最佳可用路径之间对I/O进行负载平衡。</block>
  <block id="e33c923a4d6280bf6f2b2a982ff74ee3" category="paragraph">如果某个路径不可用、则客户端会自动选择其他路径。由此带来的设计精简性使SAN的生命周期通常更易于管理。这并不意味着SAN环境始终可以更轻松地进行管理、因为SAN存储的许多其他方面都比NFS复杂得多。这只是意味着SAN LIF的设计更简单。</block>
  <block id="9446a98ad14416153cc4d45ab8b531bf" category="section-title">性能</block>
  <block id="141614e246b14131ec01a449d61ed657" category="paragraph">在SAN环境中、LIF性能最重要的考虑因素是带宽。例如、每个节点具有两个16 Gb FC端口的双节点ONTAP AFF集群允许每个节点之间最多32 Gb的带宽。</block>
  <block id="02bc0523497de72834c4c7990e32d155" category="section-title">故障恢复能力</block>
  <block id="01b1d8276ca14813ff4804089a9ac082" category="paragraph">SAN AFF不会在SAN存储系统上进行故障转移。如果SAN LIF因控制器故障转移而失败、则客户端的多路径软件会检测到路径丢失、并将I/O重定向到其他LIF。对于ASA存储系统、将在短暂延迟后对lifs进行故障转移、但这不会中断IO、因为其他控制器上已存在活动路径。执行故障转移过程是为了恢复所有定义端口上的主机访问。</block>
  <block id="b7c94ef25c0629a65f8a1f6ce7014d95" category="section-title">易管理性</block>
  <block id="1325935a6fa0e88cfec45038005f18e3" category="paragraph">在NFS环境中、LIF迁移是一项更为常见的任务、因为LIF迁移通常与在集群中重新定位卷相关联。在HA对中重新定位卷后、无需在SAN环境中迁移LIF。这是因为、在卷移动完成后、ONTAP会向SAN发送有关路径更改的通知、并且SAN客户端会自动重新优化。使用SAN迁移LIF主要与重大物理硬件更改相关。例如、如果需要无中断升级控制器、则会将SAN LIF迁移到新硬件。如果发现FC端口出现故障、则可以将LIF迁移到未使用的端口。</block>
  <block id="dbb887b1373e51dab774976c5a556964" category="section-title">设计建议</block>
  <block id="076872b2444637e6142c3c6f0f157423" category="paragraph">NetApp提出以下建议：</block>
  <block id="d8d6bca7c981c13479781da85883cfef" category="list-text">请勿创建超出所需数量的路径。路径数量过多会使整体管理变得更加复杂、并且某些主机上的路径故障转移可能会出现发生原因问题。此外、对于SAN启动等配置、某些主机存在意外的路径限制。</block>
  <block id="bd662d86fcca370cddf188ff5378fb1b" category="list-text">很少有配置需要一个LUN具有四个以上的路径。如果有两个以上的节点向LUN公布路径、则其价值会受到限制、因为如果拥有LUN的节点及其HA配对节点发生故障、则托管LUN的聚合将无法访问。在这种情况下、在主HA对以外的节点上创建路径毫无用处。</block>
  <block id="8873f044ab7c082f16372e4b8bdc6e03" category="list-text">虽然可以通过选择要包含在FC分区中的端口来管理可见LUN路径的数量、但通常在FC分区中包含所有潜在目标点并在ONTAP级别控制LUN可见性会更容易。</block>
  <block id="0ebc6267761306c4daefb9871a470e4b" category="list-text">在ONTAP 8.3及更高版本中、默认使用选择性LUN映射(SLM)功能。通过SLM、任何新的LUN都会自动从拥有底层聚合的节点以及该节点的HA配对节点公布。这种安排无需创建端口集或配置分区来限制端口可访问性。为了获得最佳性能和故障恢复能力、每个LUN可在所需的最少节点上使用。
*如果必须将LUN迁移到两个控制器之外、则可以使用添加其他节点<block ref="02d0bbdc14988c85bbd7994723f4dd7f" prefix=" " category="inline-code"></block> 命令、以便在新节点上公布LUN。这样会为LUN创建更多SAN路径以进行LUN迁移。但是、主机必须执行发现操作才能使用新路径。</block>
  <block id="cc4b24f288afae5889c6061466dda472" category="list-text">不要过分关注间接流量。在I/O密集型环境中、最好避免间接流量、因为在这种环境中、每微秒的延迟都至关重要、但对于典型工作负载、可见的性能影响可以忽略不计。</block>
  <block id="f54fccb82abaa995eb9f86264f431505" category="section-title">NFS LIF设计</block>
  <block id="e68dee93f11ae71aebd7a1e4c2abfc5a" category="paragraph">与SAN协议不同、NFS定义多个数据路径的能力有限。NFSv4的并行NFS (pNFS)扩展解决了这一限制、但由于以太网速度已达到100 GB甚至超过100 GB、因此添加额外路径很少有价值。</block>
  <block id="391dc675ec3d853200129b799ed5923e" category="section-title">性能和故障恢复能力</block>
  <block id="a0bd34f908e3947aa4aba15382354836" category="paragraph">虽然衡量SAN LIF性能主要是计算所有主路径的总带宽、但要确定NFS LIF性能、需要更深入地了解确切的网络配置。例如、可以将两个10 Gb端口配置为原始物理端口、也可以将其配置为链路聚合控制协议(Link Aggregation Control Protocol、LACP)接口组。如果将其配置为接口组、则可以使用多个负载平衡策略、这些策略的工作方式会有所不同、具体取决于流量是交换流量还是路由流量。最后、Oracle Direct NFS (DNFS)提供了目前在任何操作系统NFS客户端中都不存在的负载平衡配置。</block>
  <block id="e500ca27c6b92454c989d80e0445c359" category="paragraph">与SAN协议不同、NFS文件系统要求在协议层具有故障恢复能力。例如、LUN始终配置为启用多路径、这意味着存储系统可以使用多个冗余通道、每个通道都使用FC协议。另一方面、NFS文件系统取决于单个TCP/IP通道的可用性、该通道只能在物理层进行保护。这种安排就是为什么存在端口故障转移和LACP端口聚合等选项的原因。</block>
  <block id="35926e2ada969ad80fd3b16c0cd7d35a" category="paragraph">在NFS环境中、性能和故障恢复能力均在网络协议层提供。因此，这两个主题是相互交织的，必须一起讨论。</block>
  <block id="84f4a5dfaa9613a469cd783c353a186c" category="section-title">将LIP绑定到端口组</block>
  <block id="44bfb87c11d83c1b91c3589f2081e7ca" category="paragraph">要将LIF绑定到端口组、请将LIF IP地址与一组物理端口相关联。将物理端口聚合在一起的主要方法是LACP。LACP的容错功能相当简单；LACP组中的每个端口都会受到监控、并在发生故障时从端口组中删除。但是、对于LACP在性能方面的工作原理、存在许多误解：</block>
  <block id="19a43026949fb6ef1017a54cf7c94f9b" category="list-text">LACP不要求交换机上的配置与端点匹配。例如、可以为ONTAP配置基于IP的负载平衡、而交换机可以使用基于MAC的负载平衡。</block>
  <block id="86501252b34395de5303a65f5e9943e3" category="list-text">使用LACP连接的每个端点都可以独立选择数据包传输端口、但不能选择用于接收的端口。这意味着、从ONTAP到特定目标的流量会绑定到特定端口、而返回流量可能会到达其他接口。但是、这不会造成发生原因问题。</block>
  <block id="298ca40b99dd3540dcd82ba5537f3f8d" category="list-text">LACP不会始终均匀分布流量。在具有许多NFS客户端的大型环境中、结果通常甚至会使用LACP聚合中的所有端口。但是、环境中的任何一个NFS文件系统都仅限于一个端口的带宽、而不是整个聚合的带宽。</block>
  <block id="d071b5ccd1569aace97a0b4d6c0a71ac" category="list-text">尽管ONTAP上提供了robin-robin LACP策略、但这些策略不会处理从交换机到主机的连接。例如、如果配置中的一个主机上有一个四端口LACP中继、而ONTAP上有一个四端口LACP中继、则仍然只能使用一个端口读取文件系统。虽然ONTAP可以通过所有四个端口传输数据、但目前尚无可通过所有四个端口从交换机发送到主机的交换机技术。仅使用一个。</block>
  <block id="6e9e98dfaea1ca7860606f1fc05e414a" category="paragraph">在包含许多数据库主机的大型环境中、最常见的方法是使用IP负载平衡构建一个包含适当数量10 Gb (或更快)接口的LACP聚合。通过这种方法、只要存在足够多的客户端、ONTAP就可以均匀地使用所有端口。如果配置中的客户端较少、则负载平衡会中断、因为LACP中继不会动态重新分配负载。</block>
  <block id="7815da600ab459d2b05c5792f2271c1a" category="paragraph">建立连接后、特定方向的流量仅会放置在一个端口上。例如、对通过四端口LACP中继连接的NFS文件系统执行完整表扫描的数据库仅通过一个网络接口卡(Network Interface Card、NIC)读取数据。如果在此类环境中只有三个数据库服务器、则这三个服务器都可能从同一端口读取数据、而其他三个端口则处于空闲状态。</block>
  <block id="153f704ea16440133d51b1877af2a657" category="section-title">将Lifs绑定到物理端口</block>
  <block id="70e655aa3c03f840747c5272142b3527" category="paragraph">将LIF绑定到物理端口可以更精细地控制网络配置、因为ONTAP系统上的给定IP地址一次只与一个网络端口相关联。然后、可通过配置故障转移组和故障转移策略来实现故障恢复能力。</block>
  <block id="218f00463f5281b8ead536582c69ac3a" category="section-title">故障转移策略和故障转移组</block>
  <block id="0a53c26a1bc4036c84fc3b4b63542744" category="inline-link-macro">有关故障转移组和策略的ONTAP网络管理文档</block>
  <block id="f29ae31443947c9782482ee9683dbc0e" category="paragraph">故障转移策略和故障转移组控制了在网络中断期间的故障转移。配置选项已随ONTAP的不同版本而发生更改。请参见 <block ref="96c8cd47b667604fb9991ace7d2eff29" category="inline-link-macro-rx"></block> 有关要部署的ONTAP版本的具体详细信息、请参见。</block>
  <block id="0f2f345dd1247ae428cee703c1bf1c84" category="paragraph">ONTAP 8.3及更高版本支持基于广播域管理LIF故障转移。因此、管理员可以定义可访问给定子网的所有端口、并允许ONTAP选择适当的故障转移LIF。某些客户可以使用这种方法、但由于缺乏可预测性、在高速存储网络环境中这种方法存在一些限制。例如、一个环境可以包括用于例行文件系统访问的1 Gb端口和用于数据文件I/O的10 Gb端口如果两种类型的端口都位于同一广播域中、则LIF故障转移可能会导致数据文件I/O从10 Gb端口移动到1 Gb端口。</block>
  <block id="ced0729d57c08312b2b12382f2147d26" category="paragraph">概括地说、请考虑以下做法：</block>
  <block id="57cb6a7ba8acb7faa31cc5219bae83b3" category="list-text">将故障转移组配置为用户定义的组。</block>
  <block id="b444855eccae552d7fb79bf3d31a4f7b" category="list-text">使用存储故障转移(SFR)配对控制器上的端口填充故障转移组、以便在存储故障转移期间、这些LUN跟随聚合。这样可以避免产生间接流量。</block>
  <block id="86c48b21d166ed8e440a07e1d4a0b15d" category="list-text">使用性能特征与原始LIF匹配的故障转移端口。例如、单个10 Gb物理端口上的LIF应包含一个具有单个10 Gb端口的故障转移组。一个四端口LACP LIF应故障转移到另一个四端口LACP LIF。这些端口将是广播域中定义的端口的子集。</block>
  <block id="3e839a73f7dc1262508f23a89628ca2d" category="list-text">将故障转移策略设置为仅SFo-Partner。这样可以确保LIF在故障转移期间跟随聚合。</block>
  <block id="85e82ce4c9842f978fa774c4fe96b14c" category="section-title">自动还原</block>
  <block id="3dc8610f78478640e47688101cecbfad" category="paragraph">设置<block ref="9f1b7141f09f19c4e33409646aef43cf" prefix=" " category="inline-code"></block> 参数。大多数客户倾向于将此参数设置为<block ref="b326b5062b2f0e69046810717534cb09" prefix=" " category="inline-code"></block> 以使LIF还原到其主端口。但是、在某些情况下、客户会将此值设置为`false `so、以便在将LIF返回到其主端口之前可以调查意外故障转移。</block>
  <block id="edf6d4c299bc2890ba63c7eb3ef8b4d2" category="section-title">LIF与卷的比率</block>
  <block id="9c75becef8c432a0152a40c7c037a04c" category="paragraph">一个常见的误解是、卷和NFS Sifs之间必须有1：1的关系。虽然要在集群中的任何位置移动卷而不创建额外的互连流量、都需要使用此配置、但这绝对不是一项要求。必须考虑集群间流量、但仅存在集群间流量并不会造成问题。为ONTAP创建的许多已发布基准主要包括间接I/O</block>
  <block id="2b4ebcd522b07b80d3fd76b301c506e8" category="paragraph">例如、如果某个数据库项目包含的性能关键型数据库数量相对较少、并且总共只需要40个卷、则可能需要采用卷到LIF的1：1策略、这种安排需要40个IP地址。然后、可以将任何卷与关联的LIF一起移动到集群中的任何位置、流量将始终是直接的、即使是微秒级的延迟、也可以最大限度地减少每个源。</block>
  <block id="38bad4911bcdf1117d37eb1195566f8c" category="paragraph">作为一个反例、客户与LI之间的1：1关系可能更易于管理大型托管环境。随着时间的推移、卷可能需要迁移到其他节点、这会对一些间接流量进行发生原因。但是、除非互连交换机上的网络端口饱和、否则不会检测到性能影响。如果存在问题、可以在其他节点上建立新的LIF、并可在下一个维护窗口更新主机、以便从配置中删除间接流量。</block>
  <block id="d75b0d8f723c3e97eaa4ca39630c7420" category="doc">MetroCluster和多个聚合</block>
  <block id="df5855269b493a27a5565dfd9f2584f0" category="list-text">在正常情况下、传入给定控制器的写入会同步镜像到其配对控制器。在NetApp MetroCluster环境中、写入操作也会镜像到远程控制器。写入操作在所有位置的非易失性介质中存储之前、不会向主机应用程序确认。</block>
  <block id="05b60db315aa45e1524b7a6ffa242fa8" category="list-text">存储写入数据的介质称为非易失性内存或NVMEM。它有时也称为非易失性随机存取存储器(NVRAM)、尽管它充当日志、但也可视为写入缓存。在正常操作下、不会读取NVMEM中的数据；该数据仅用于在发生软件或硬件故障时保护数据。将数据写入驱动器后、数据将从系统中的RAM传输、而不是从NVMEM传输。</block>
  <block id="e6dd8b559da6e046f2043043a55faafc" category="list-text">在接管操作期间、高可用性(HA)对中的一个节点会从其配对节点接管操作。切换本质上是相同的、但在IT适用场景 MetroCluster配置中、远程节点接管本地节点的功能。</block>
  <block id="33c0c466972aae7427262e3075a2ed07" category="paragraph">在日常维护操作期间、存储接管或切换操作应该是透明的、而不是在网络路径发生更改时可能会短暂暂停操作。但是、网络连接可能很复杂、容易出错、因此NetApp强烈建议在将存储系统投入生产之前对接管和切换操作进行全面测试。这样做是确保所有网络路径配置正确的唯一方法。在SAN环境中、请仔细检查命令的输出<block ref="41dc2c94e82e1c56ba876085acf5a974" prefix=" " category="inline-code"></block> 确保所有预期的主路径和辅助路径均可用。</block>
  <block id="d33ea1ad1493de23aafd480e95fea159" category="paragraph">发出强制接管或切换命令时必须小心。使用这些选项强制更改存储配置意味着、拥有驱动器的控制器的状态将被忽略、而备用节点将强制接管驱动器。不正确地强制执行接管可能会导致数据丢失或损坏。这是因为强制接管或切换可能会丢弃NVMEM的内容。接管或切换完成后、如果丢失这些数据、则从数据库的角度来看、存储在驱动器上的数据可能会还原到稍旧的状态。</block>
  <block id="c226371d96b605ccff84ad23db0069b8" category="paragraph">很少需要使用普通HA对强制接管。在几乎所有故障情形下、节点都会关闭并通知配对节点、以便进行自动故障转移。在某些边缘情况下、例如、发生滚动故障时、节点之间的互连断开、然后一个控制器断开、此时需要强制接管。在这种情况下、节点之间的镜像会在控制器发生故障之前丢失、这意味着无故障控制器将不再具有正在进行的写入的副本。然后、需要强制执行接管、这意味着数据可能会丢失。</block>
  <block id="418f81f529a577cb711b44adece1376f" category="paragraph">相同的逻辑适用场景会执行MetroCluster切换。在正常情况下、切换几乎是透明的。但是、灾难可能会导致运行正常的站点与灾难站点之间的连接断开。从运行正常的站点的角度来看、问题可能只是站点之间的连接中断、而原始站点可能仍在处理数据。如果节点无法验证主控制器的状态、则只能执行强制切换。</block>
  <block id="ae0c16d397348d8f8fd4e56b08b06c7c" category="paragraph">* NetApp建议*采取以下预防措施：</block>
  <block id="79fd18cb18befbe5c2113757478be193" category="list-text">请格外小心、以免意外强制执行接管或切换。通常、不需要强制执行、强制执行更改可能会导致发生原因数据丢失。</block>
  <block id="26cece11254903c5ba8bfdd8d54ae779" category="list-text">如果需要强制接管或切换、请确保关闭应用程序、卸载所有文件系统并更改逻辑卷管理器(LVM)卷组。必须卸载ASM磁盘组。</block>
  <block id="0b6986eb1285d28a9987ea13adbca358" category="list-text">如果发生强制MetroCluster切换、请将故障节点与所有运行正常的存储资源隔离。有关详细信息、请参见相关ONTAP版本的《MetroCluster管理和灾难恢复指南》。</block>
  <block id="71303adf87737046acd4381c72151278" category="paragraph">MetroCluster是一种同步复制技术、如果连接中断、则会切换到异步模式。这是客户最常见的请求、因为有保障的同步复制意味着站点连接中断会导致数据库I/O完全停止、从而使数据库无法使用。</block>
  <block id="cb791a44ee361703eb7594a7932f57de" category="paragraph">借助MetroCluster、聚合可以在连接恢复后快速重新同步。与其他存储技术不同、MetroCluster不应要求在站点发生故障后进行完整的重新镜像。只需发送增量变更。</block>
  <block id="c1536091d7c1ca33c9dc4dfa8c0852a2" category="paragraph">在跨聚合的数据集中、在滚动灾难场景中需要执行额外的数据恢复步骤的风险很小。具体而言、如果：(a)站点之间的连接中断、(b)连接恢复、(c)聚合达到一种状态、其中一些聚合已同步、而另一些聚合则未同步、 然后(d)主站点丢失、结果是聚合未彼此同步的运行正常的站点。如果发生这种情况、数据集的部分内容会彼此同步、如果不进行恢复、则无法启动应用程序、数据库或数据存储库。如果数据集跨越多个聚合、NetApp强烈建议使用多种可用工具之一利用基于快照的备份来验证在这种异常情况下的快速可恢复性。</block>
  <block id="a42c87064c284490a38efac4bf0b7f7f" category="paragraph">RAID 4、RAID 5、RAID 6、RAID DP和RAID-TEC均使用奇偶校验来确保驱动器故障不会导致数据丢失。与镜像相比、这些RAID选项提供的存储利用率要高得多、但大多数RAID实施都有一个影响写入操作的缺点。在其他RAID实施中完成写入操作可能需要多次驱动器读取才能重新生成奇偶校验数据、此过程通常称为RAID惩罚。</block>
  <block id="3cfcf9a3299db75df9aa0e024ebef965" category="paragraph">但是、ONTAP不会受到这种RAID惩罚。这是因为NetApp WAFL (任意位置写入文件布局)与RAID层集成在一起。写入操作会在RAM中进行聚合、并准备为完整的RAID条带、包括奇偶校验生成。ONTAP无需执行读取即可完成写入、这意味着ONTAP和WAFL可以避免RAID惩罚。重做日志记录等延迟关键型操作的性能不受阻碍、随机数据文件写入不会因需要重新生成奇偶校验而产生任何RAID影响。</block>
  <block id="5ff9a871332f0f82f38d880b68a9874b" category="paragraph">在统计可靠性方面、即使RAID DP也能提供比RAID镜像更好的保护。主要问题是RAID重建期间对驱动器的需求。使用镜像RAID集时、在重建到RAID集中的配对驱动器时、由于驱动器故障而导致数据丢失的风险远高于RAID DP集中三驱动器故障的风险。</block>
  <block id="12c3fe87fd5a746ce8a7cbe25dc1c25b" category="paragraph">在闪存驱动器时代之前、条带化用于帮助克服旋转驱动器的性能限制。例如、如果操作系统需要执行1 MB的读取操作、则从单个驱动器读取1 MB的数据将需要大量的驱动器磁头查找和读取、因为1 MB的传输速度较慢。如果在8个LUN上对1 MB的数据进行条带化、则操作系统可以问题描述并行执行8个128 K读取操作、从而减少完成1 MB传输所需的时间。</block>
  <block id="e337352c3d57672fd08af8ba709b544f" category="paragraph">使用旋转驱动器进行条带化更为困难、因为必须事先知道I/O模式。如果条带化未正确调整为真正的I/O模式、则条带化配置可能会损害性能。使用Oracle数据库、尤其是使用全闪存配置时、条带化更易于配置、并且经验证可显著提高性能。</block>
  <block id="7025652291dc6872022b0f79a2b2be21" category="paragraph">默认情况下、逻辑卷管理器(例如Oracle ASM)会进行条带化、但本机操作系统LVM则不会进行条带化。其中一些会将多个LUN绑定在一起、形成一个串联设备、从而导致数据文件只存在于一个LUN设备上。这会导致热点。其他LVM实施默认使用分布式块区。这与条带化类似、但更粗。卷组中的LUN会被划分为多个大块、称为块区、通常以MB为单位进行测量、然后逻辑卷会分布在这些块区中。结果是、文件的随机I/O应在各个LUN之间分布良好、但顺序I/O操作的效率不如所能达到的高。</block>
  <block id="0c2f3b2ec9d90baa0a0a0b6fb673a113" category="paragraph">性能密集型应用程序I/O几乎始终为(a)基本块大小单位或(b) 1兆字节。</block>
  <block id="804d5b1f06570b4d242be0c2f0c3392c" category="paragraph">条带化配置的主要目标是确保单文件I/O可作为一个单元执行、多块I/O (大小应为1 MB)可在条带化卷中的所有LUN之间均匀并行。这意味着条带大小不能小于数据库块大小、条带大小乘以LUN数量应为1 MB。</block>
  <block id="0598f393baefd05d48b48076cc7df606" category="paragraph">下图显示了三个可能的条带大小和宽度调整选项。选择LUN数量是为了满足上述性能要求、但在所有情况下、单个条带内的总数据均为1 MB。</block>
  <block id="8e52de0d4b03d5fe87dc88da09616c7f" category="inline-link-macro">此处。</block>
  <block id="337c62c6b6eb7319bae58701105e889c" category="doc">分层</block>
  <block id="3493794b3ccb587f71a663f51f4484ef" category="summary">基于ONTAP的PostgreSQL数据库</block>
  <block id="2d3298c651b356a82db5d664ce68e65e" category="doc">本机数据保护</block>
  <block id="31c6611c8e0bd237a3ee51db1728a440" category="paragraph">存储设计的一个主要方面是为PostgreSQL卷启用保护。客户可以使用转储方法或文件系统备份来保护其PostgreSQL数据库。本节介绍备份单个数据库或整个集群的不同方法。</block>
  <block id="9f3265914462c64fd02bc50ab4c9ebe9" category="paragraph">备份PostgreSQL数据有三种方法：</block>
  <block id="6b592c7950245a5a9f54d9424e851e97" category="list-text">SQL Server转储</block>
  <block id="c8b1fc69d12d1da6589e384671c8e82c" category="list-text">文件系统级备份</block>
  <block id="3c25062a0babfa1495dd604698707610" category="list-text">持续归档</block>
  <block id="58c132e2be12705408a7456c6183b617" category="paragraph">SQL Server转储方法的理念是、使用SQL Server命令生成一个文件、当返回到服务器时、该文件可以像转储时那样重新创建数据库。PostgreSQL提供实用程序<block ref="5a5149b2817f30cbb3805307f9cadae4" prefix=" " category="inline-code"></block> 和<block ref="0ead269b3d000482b5a44a1ef4e8cd54" prefix=" " category="inline-code"></block> 用于创建单个和集群级别的备份。这些转储是逻辑转储、不包含可供WAL重放使用的足够信息。</block>
  <block id="1d05b80fc6f199681263e063190e8325" category="paragraph">另一种备份策略是使用文件系统级备份、即管理员直接复制PostgreSQL用于将数据存储在数据库中的文件。此方法在脱机模式下完成：必须关闭数据库或集群。另一种替代方法是使用<block ref="35679fc424d9eec0c30f38459fd9b322" prefix=" " category="inline-code"></block> 对PostgreSQL数据库运行热流备份。</block>
  <block id="10907e7ac5ab6e5235a23898a2331b31" category="doc">基于ONTAP的PostgreSQL数据库</block>
  <block id="841a21e58e7c22a71c07b89a4362d2b6" category="admonition">有关ONTAP和PostgreSQL数据库的本文档将取代先前发布的_TR-4770：《基于ONTAP的PostgreSQL数据库最佳实践》。_</block>
  <block id="9147e5e61a7b9260dec09f3a6eb3e5be" category="doc">快照</block>
  <block id="0b9d99167191c5d9ad23ca07bc6a9b38" category="paragraph">使用PostgreSQL进行基于Snapshot的备份时、需要为数据文件、WAL文件和归档的WAL文件配置快照、以提供完整或时间点恢复。</block>
  <block id="8c6a53edc4449a4cc3983d47ecffa851" category="paragraph">对于PostgreSQL数据库、快照的平均备份时间介于几秒到几分钟之间。此备份速度比快60到100倍<block ref="35679fc424d9eec0c30f38459fd9b322" prefix=" " category="inline-code"></block> 以及其他基于文件系统的备份方法。</block>
  <block id="c798632224ae09152f66f60e0edc757e" category="paragraph">NetApp存储上的快照可以是崩溃状态一致的快照、也可以是应用程序一致的快照。系统会在存储上创建崩溃状态一致的快照、而不会使数据库处于静音状态、而是在数据库处于备份模式时创建应用程序一致的快照。NetApp还可确保后续快照是永久增量备份、以节省存储空间并提高网络效率。</block>
  <block id="d0e369216eeac8de66e915909364970a" category="paragraph">由于快照速度快且不会影响系统性能、因此您可以计划每天创建多个快照、而不是像使用其他流式备份技术那样创建一个每日备份。在需要执行还原和恢复操作时、系统停机时间可通过以下两个主要功能来减少：</block>
  <block id="316eb8adba4d16a34c92eaf9db381b9e" category="list-text">NetApp SnapRestore数据恢复技术意味着只需几秒钟即可执行还原操作。</block>
  <block id="c128c475c12703e37685edd6db8144bc" category="list-text">主动恢复点目标(Recovery Point目标、RPO)意味着、必须应用的数据库日志减少、并且前向恢复也会加快。</block>
  <block id="9b9f26085ff7149d4dbb916b1db0f121" category="paragraph">要备份PostgreSQL、必须确保数据卷同时受到(一致性组) WAL和归档日志的保护。在使用Snapshot技术复制WAL文件时、请确保运行<block ref="a3b8c8ee15ba60bfb2b999195d2b4e7d" prefix=" " category="inline-code"></block> 刷新必须归档的所有WAL条目。如果在还原期间刷新WAL条目、则只需停止数据库、卸载或删除现有数据目录、并对存储执行SnapRestore操作即可。还原完成后、您可以挂载系统并将其恢复到当前状态。对于时间点恢复、您还可以恢复WAL和归档日志；然后PostgreSQL确定最一致的点并自动恢复它。</block>
  <block id="8e8d6187572eace409fee5bf2dbb7cf9" category="paragraph">一致性组是ONTAP中的一项功能、如果在一个实例或包含多个表空间的数据库中挂载了多个卷、则建议使用一致性组。一致性组快照可确保所有卷都分组在一起并受到保护。您可以从ONTAP系统管理器高效管理一致性组、甚至可以克隆一致性组以创建数据库的实例副本、用于测试或开发目的。</block>
  <block id="7e7397a7b79323762c61941fc0e6b5f9" category="doc">数据保护</block>
  <block id="16a49d0bc0249ef3dd42949589a0ed4e" category="doc">表空间</block>
  <block id="d6d544de56c329d9f68bb176c6245e7c" category="paragraph">初始化数据库集群时、系统会自动创建两个表空间。</block>
  <block id="6df924905e21856e4e8b8f936767cdd6" category="paragraph">。<block ref="bd676cbef0d168a62a062c8709af1824" prefix=" " category="inline-code"></block> 表空间用于共享系统目录。。<block ref="3224684b8e7208962a73daeb0bb24110" prefix=" " category="inline-code"></block> 表空间是template1和template0数据库的默认表空间。如果用于初始化集群的分区或卷用尽空间且无法扩展、则可以在其他分区上创建并使用表空间、直到可以重新配置系统为止。</block>
  <block id="364c9d7b9593277eee9477befaf9f66b" category="paragraph">使用率较高的索引可以放置在快速、高可用性的磁盘上、就像固态设备一样。此外、存储很少使用或不影响性能的归档数据的表可以存储在成本较低、速度较慢的磁盘系统上、例如SAS或SATA驱动器。</block>
  <block id="9bfe8d8e1117bd1d4b8597220e3f166e" category="paragraph">表空间是数据库集群的一部分、不能视为数据文件的自主集合。它们依赖于主数据目录中包含的元数据、因此无法连接到其他数据库集群或单独备份。同样、如果丢失表空间(由于文件删除、磁盘故障等原因)、数据库集群可能会变得不可读或无法启动。将表空间放置在临时文件系统(如RAM磁盘)上会危及整个集群的可靠性。</block>
  <block id="7d9573b1ed3543ec6ea42c81830dc27c" category="paragraph">创建表空间后、如果请求用户具有足够的权限、则可以使用任何数据库中的表空间。PostgreSQL使用符号链接来简化表空间的实现。PostgreSQL在中添加一行<block ref="4a926dc6e7549c49a13755513af41e67" prefix=" " category="inline-code"></block> 表(一个全组范围的表)、并为该行分配一个新的对象标识符(OID)。最后、服务器使用OID在集群和给定目录之间创建符号链接。目录<block ref="8e3da386e945c59fb1e1cd1d7a47697c" prefix=" " category="inline-code"></block> 包含指向集群中定义的每个非内置表空间的符号链接。</block>
  <block id="249fd7d68098688fab42436eed51be7d" category="doc">数据库配置</block>
  <block id="8daf26b2c72dd18a89fa89a6b1aa988d" category="paragraph">可以通过多种PostgreSQL调整配置来提高性能。</block>
  <block id="abb3dae412afe5c801e9ab90de71675b" category="paragraph">最常用的参数如下：</block>
  <block id="bfdf741f4acb3dfee6e87075b535610e" category="list-text"><block ref="39d79378db03fed7c5ba62efba38e327" prefix="" category="inline-code"></block>：一次可建立的最大数据库连接数。使用此参数可限制磁盘交换并导致性能下降。根据您的应用程序要求、您还可以针对连接池设置调整此参数。</block>
  <block id="9625e1a6f5d1f695fd1c72401afaa07e" category="list-text"><block ref="904d399f43708a8a5b6d10c1ee3f8356" prefix="" category="inline-code"></block>：提高数据库服务器性能的最简单方法。对于大多数现代硬件、默认值为low。在部署期间、它会设置为系统上可用RAM的大约25%。此参数设置因其在特定数据库实例中的工作方式而异；您可能需要按试用和错误增加和减小值。但是、将其设置为高可能会降低性能。</block>
  <block id="d1960c56572383fc401fec3f0b767cf9" category="list-text"><block ref="5edeed59821790d8bec6d32da26bca4c" prefix="" category="inline-code"></block>:该值告诉PostgreSQL的优化器PostgreSQL有多少内存可用于缓存数据，并帮助确定是否使用索引。值越大、使用索引的可能性就越大。此参数应设置为分配给的内存量<block ref="e15ed0f69e5c2475450b97691d6a2cee" prefix=" " category="inline-code"></block> 加上可用的操作系统缓存容量。此值通常超过系统总内存的50%。</block>
  <block id="508df54f84fc7abb00f3a92937ca3506" category="list-text"><block ref="1edef4d43b06d4deb28010505df5724d" prefix="" category="inline-code"></block>:该参数控制在排序操作和哈希表中使用的内存量。如果您在应用程序中进行大量排序，则可能需要增加内存量，但要小心。它不是系统范围的参数、而是每个操作的参数。如果复杂查询包含多个排序操作、则它会使用多个work _mEM单元内存、多个后端可以同时执行此操作。如果值过大、此查询通常会导致数据库服务器进行交换。此选项以前在早期版本的PostgreSQL中称为Sort_mm。</block>
  <block id="59d9770060aecba84c7e8ed849b5653d" category="list-text"><block ref="65768448b4f275b95af20a317c7355a9" prefix="" category="inline-code"></block>:此参数用于确定在提交事务之前是否应使用fsync()将所有WAL页面同步到磁盘。关闭它有时可以提高写入性能、而打开它可以增强保护、防止在系统崩溃时发生损坏。</block>
  <block id="625a65dd6cef83bac66319bde3894899" category="list-text"><block ref="ff5a06a39dd6824f30a778a51cf7ea69" prefix="" category="inline-code"></block>：检查点进程将已提交的数据转至磁盘。这涉及到磁盘上的大量读/写操作。该值以秒为单位进行设置、较低的值可缩短崩溃恢复时间、增加该值可通过减少检查点调用来减少系统资源的负载。根据应用程序的严重程度、使用情况和数据库可用性、设置checkpoint_timeout的值。</block>
  <block id="309b1036c45e7ad490448925dc4f9597" category="list-text"><block ref="6a5c0586429891e84e05d6ab15088405" prefix="" category="inline-code"></block> 和<block ref="9080796d32078fea7d191100eab64f92" prefix=" " category="inline-code"></block>：这些选项结合使用，可以同时写出多个提交的事务，从而帮助提高性能。如果在提交事务时有多个commit兄弟姐妹对象处于活动状态、则服务器将等待commit delay微秒尝试一次提交多个事务。</block>
  <block id="8d5137ce002c6328c2b5f4f328662e1d" category="list-text"><block ref="fa4ca2cd95c20a44171f964fb8f5fdb9" prefix="" category="inline-code"></block>：为流程配置最佳数量的员工。max_paral_workers对应于可用的CPU数量。根据应用程序设计、查询可能需要较少的工作人员来执行并行操作。最好保持两个参数的值相同、但在测试后调整该值。</block>
  <block id="c8736e7ca19e9096796c624f3030dae5" category="list-text"><block ref="8dda85a5feb6de66d8f5f9a4cbdb0754" prefix="" category="inline-code"></block>：该值控制PostgreSQL查看非顺序磁盘读取的方式。值越高、意味着PostgreSQL更有可能使用顺序扫描而不是索引扫描、这表示您的服务器具有快速磁盘在评估基于计划的优化、清理、索引以更改查询或架构等其他选项后修改此设置。</block>
  <block id="17edf3863f12b7d9480b3336a9fca773" category="list-text"><block ref="709989c844c22473cb8406550423d39a" prefix="" category="inline-code"></block>：此参数用于设置PostgreSQL尝试同时执行的并发磁盘I/O操作的数量。提高此值会增加任何单个PostgreSQL会话尝试并行启动的I/O操作的数量。允许的范围为1到1、000或零、用于禁止发出异步I/O请求。目前、此设置仅影响位图堆扫描。固态驱动器(SSD)和其他基于内存的存储(NVMe)通常可以处理多个并发请求、因此、数百个请求的最大价值可能是。</block>
  <block id="82b38edb10ad73f9645c5d65e73a659b" category="paragraph">有关PostgreSQL配置参数的完整列表、请参见PostgreSQL文档。</block>
  <block id="402fbc243dbef50cd5c8e57ccbdd92f5" category="section-title">吐司</block>
  <block id="0d2b62abb26bd0b4109f5bc967250933" category="paragraph">TOAST表示超大属性存储技术。PostgreSQL使用固定的页面大小(通常为8 KB)、并且不允许元组跨越多个页面。因此、无法直接存储大字段值。当您尝试存储超过此大小的行时、TOAST会将大型列的数据拆分成较小的"部分"、并将其存储在TOAST表中。</block>
  <block id="3f11f21bdc22c3c955c3f0fca39e9bc0" category="paragraph">只有在将结果集发送到客户端时、才会提取已分配属性的大值(如果已选中)。表本身要小得多、并且可以在共享缓冲区缓存中容纳更多行、而不是在没有任何线外存储(TOAST)的情况下。</block>
  <block id="9a311ef6dad816cb7a15c0ab41920ad8" category="section-title">真空</block>
  <block id="385e23b8ebe64dfd0005f6846cc8e85e" category="paragraph">在正常的PostgreSQL操作中，被更新删除或废弃的元组不会从其表中物理删除；它们会一直存在，直到运行真空为止。因此、您必须定期运行真空、尤其是在频繁更新的表上。然后、必须回收占用的空间、供新行重复使用、以避免磁盘空间中断。但是、它不会将空间归还给操作系统。</block>
  <block id="db81319c35b48ed94867775a9a1ce1d7" category="paragraph">页面中的可用空间不会碎片化。真空会重新写入整个数据块、从而高效地填充其余行、并在一页中保留一个连续的可用空间块。</block>
  <block id="8a5c17164c9920590fc057ee01f2fcb3" category="paragraph">相比之下、真空全满会通过写入不含死空间的全新表文件来主动压缩表。此操作可最大程度地减小表大小、但可能需要很长时间。此外、还需要额外的磁盘空间来创建新的表副本、直到操作完成为止。常规真空的目标是避免真空完全发挥作用。此过程不仅可以将表保持在其最小大小、还可以保持磁盘空间的稳定使用状态。</block>
  <block id="61bcd96a2c1f8026527cbf2019d6e9a4" category="doc">初始化</block>
  <block id="f4f9dac58f7c47e819293af5f2dd1177" category="paragraph">您可以使用创建新的数据库集群<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 计划。一个<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 脚本将创建用于定义集群的数据文件、系统表和模板数据库(template0和template1)。</block>
  <block id="b668460552732302350bbb840d57931c" category="paragraph">模板数据库表示一个常用数据库。它包含系统表、标准视图、函数和数据类型的定义。<block ref="3865cf98fe802a965570b4a10a1d894b" prefix=" " category="inline-code"></block> 用作的参数<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 指定数据库集群位置的脚本。</block>
  <block id="8fcd14822a5b94d212898fe3e006526e" category="paragraph">PostgreSQL中的所有数据库对象都由各自的OID在内部管理。表和索引也由各个OID管理。数据库对象及其各自的OID之间的关系存储在相应的系统目录表中、具体取决于对象类型。例如、数据库和堆表的OID存储在中<block ref="d0fcebb608269edbd5d67486884ebed7" prefix=" " category="inline-code"></block> 和`pg_class。您可以通过在PostgreSQL客户端上发出查询来确定这些OID。</block>
  <block id="d0e97e34fe92edd2facd0f7377b6340b" category="paragraph">每个数据库都有自己的表和索引文件、这些表和索引文件的大小限制为1 GB。每个表都有两个关联文件、后缀分别为<block ref="7b9b00c45b01f7b7c6d3a3c8ba2e9275" prefix=" " category="inline-code"></block> 和<block ref="a1d869a79e2f43693a6a416fcbdc2724" prefix=" " category="inline-code"></block>。它们称为可用空间映射和可见性映射。这些文件用于存储有关可用空间容量的信息、并可查看表文件中的每个页面。索引只具有单个可用空间映射、而不具有可见性映射。</block>
  <block id="048a7ed79caf84bb5c725efc5f474911" category="paragraph">。<block ref="c28f4f32219f5ff99fb4b116980b8549" prefix=" " category="inline-code"></block> 目录包含预写日志。预写日志用于提高数据库可靠性和性能。每当您更新表中的某一行时、PostgreSQL都会首先将更改写入预写日志、然后将修改写入实际数据页面到磁盘。。<block ref="f7223cfaa9416056a91e259e326ac5cf" prefix=" " category="inline-code"></block> 目录通常包含多个文件、但initdb仅创建第一个文件。根据需要添加其他文件。每个xlog文件的长度为16 MB。</block>
  <block id="789a6c7dd865d16eb1df122bcc5c9a3a" category="admonition">*如果需要NFSv4功能、NetApp建议*使用NFSv4.1。在NFSv4.1中、NFSv4协议有一些功能增强功能、可提高某些边缘情况下的故障恢复能力。</block>
  <block id="8e86e0aee135afb67c6a1d3d6e0f3306" category="inline-link-macro">NFS传输大小</block>
  <block id="d84b41126744795c4ee82f7b256e7234" category="inline-link-macro">FC SAN</block>
  <block id="2c8c2171fc87c96e58fb40d8714f85cf" category="doc">PostgreSQL架构</block>
  <block id="ee62b4420d426c21a46d892ac084872a" category="paragraph">PostgreSQL是基于客户端和服务器架构的RDBMS。PostgreSQL实例称为数据库集群、它是一组数据库、而不是一组服务器。</block>
  <block id="89c30c326e106773af32af40255b92a8" category="inline-image-macro">错误：未找到图形</block>
  <block id="54c2dd41fd1ad3efa25e80bee0bae549" category="paragraph">PostgreSQL数据库中有三个主要元素：PostMAIN、前端(客户端)和后端客户端向邮件服务器发送请求、并提供IP协议和要连接到的数据库等信息。邮件服务器对连接进行身份验证，并将其传递到后端进程以进行进一步的通信。后端进程执行查询并将结果直接发送到前端(客户端)。</block>
  <block id="9f96e07bbaf7c0237047d6d0f95301a8" category="paragraph">PostgreSQL实例基于多进程模型、而不是多线程模型。它会为不同的作业生成多个进程、每个进程都有自己的功能。主要进程包括客户端进程、WAL写入程序进程、后台写入程序进程和检查指针进程：</block>
  <block id="6aebf901bd4be26a765c56e4133b3798" category="list-text">当客户端(前台)进程向PostgreSQL实例发送读取或写入请求时、它不会直接向磁盘读取或写入数据。它首先将数据缓冲在共享缓冲区和预写日志记录(Write-Ahead Logging、WAL)缓冲区中。</block>
  <block id="458239ee6c634dc5fef96f9dfab275f0" category="list-text">WAL写入程序进程操纵共享缓冲区和WAL缓冲区的内容以写入WAL日志。WAL日志通常是PostgreSQL的事务日志、并按顺序写入。因此、为了缩短数据库的响应时间、PostgreSQL首先写入事务日志并确认客户端。</block>
  <block id="9ec2999256fe568cd596b42e7da2cc39" category="list-text">为了使数据库处于一致状态、后台写入程序进程会定期检查共享缓冲区中是否存在脏页。然后、它会将数据转储到存储在NetApp卷或LUN上的数据文件中。</block>
  <block id="5c852dd8ba7215c01dfde8e98f6c46c6" category="list-text">检查指针进程也会定期运行(比后台进程频率低)、并防止对缓冲区进行任何修改。它会向WAL写入程序进程发出信号、将检查点记录写入并刷新到NetApp磁盘上存储的WAL日志的末尾。它还会向后台写入程序进程发出信号、指示将所有脏页写入磁盘并将其刷新。</block>
  <block id="0a7b1215fd0b9621d4d7300f88b2906c" category="doc">数据保护软件</block>
  <block id="e265011e47d11db43ee112fd2fdc9d5b" category="paragraph">适用于PostgreSQL数据库的NetApp SnapCenter插件与Snapshot和NetApp FlexClone技术相结合、可为您提供以下优势：</block>
  <block id="4dcdaba06a92b8fecfdc823643a71723" category="list-text">快速备份和恢复。</block>
  <block id="aee746a577a1baebdc33197fb5f3a279" category="list-text">节省空间的克隆。</block>
  <block id="b96bb0cd2ebc0389b6670602ac80d983" category="list-text">构建快速有效的灾难恢复系统的能力。</block>
  <block id="9e060ad00fced94f2616dd71fbc49f76" category="paragraph">在以下情况下、您可能更愿意选择NetApp的高级备份合作伙伴、例如Veeam Software和Commvell：</block>
  <block id="0ee17b3b55ea2b0af3d90985bc347775" category="list-text">管理异构环境中的工作负载</block>
  <block id="88fbde7bbe0274fbe9e7ce01c563d03c" category="list-text">将备份存储到云或磁带以供长期保留</block>
  <block id="445e3e0cce7f959696dde65b3be27843" category="list-text">支持多种操作系统版本和类型</block>
  <block id="21c5d67cc22beaf7d7c9c84c8deaabbe" category="paragraph">适用于PostgreSQL的SnapCenter插件是社区支持的插件、安装和文档可从NetApp自动化商店获得。通过SnapCenter、用户可以远程备份数据库、克隆和还原数据。</block>
  <block id="7d334ca369e4a752ec91b1503183f0ed" category="summary">适用于SAP HANA和AnyDB的解决方案</block>
  <block id="1ac73696f4529e3901b0d4e5430365cb" category="doc">SAP HANA和采用AnyDB的SAP</block>
  <block id="2c1b27a986b5e37a810d61f72b23ee4b" category="paragraph">有关配置、管理和自动化SAP解决方案的最佳实践、请参见NetApp SAP解决方案页面。</block>
  <block id="6c92285fa6d3e827b198d120ea3ac674" category="inline-link-macro">此处</block>
  <block id="ee1e67308b27672a8f54eace4c615a98" category="paragraph">请单击 <block ref="c95e4a3e1de9e00fefc4bf8a7ce42893" category="inline-link-macro-rx"></block> 了解更多信息。</block>
  <block id="beb3ca55ed0a53a38a2b97540b05d6e4" category="summary">基于ONTAP的Microsoft SQL Server</block>
  <block id="7636ae91f443b605f05bed59d7d57a02" category="doc">Microsoft SQL Server灾难恢复</block>
  <block id="18c6a681ea46e1ed394e092461bb53ef" category="list-text">将包含SQL Server数据的卷分布在集群中的不同节点上、以允许所有集群节点共享SnapMirror复制活动。此分布可优化节点资源的使用。</block>
  <block id="0a01e6837f5c691536f0b6cbdd0232ec" category="inline-link-macro">TR-4015：《适用于ONTAP 9的SnapMirror配置和最佳实践指南》</block>
  <block id="1cca1a3fad8c6dd7e2dadbd2aa08bf07" category="paragraph">有关SnapMirror的详细信息、请参见 <block ref="64b916f792bad525a069a243c092b62e" category="inline-link-macro-rx"></block>。</block>
  <block id="77641f4a3e4406855e878235cbd89b87" category="doc">CPU配置</block>
  <block id="cf0e2551e639758cc3c4d82df655eccd" category="inline-link-macro">SQL Server 2022：您的现代数据平台</block>
  <block id="809c9e1f6ce0bc82bf42fae361c6f43e" category="paragraph">因此、要使用所有CPU、应使用每个处理器的核心许可证。有关SQL Server许可的详细信息、请参见 <block ref="457abfaf1083b1cbfc49f2783069c6cd" category="inline-link-macro-rx"></block>。</block>
  <block id="cb8d56a3511d402b7355db8502a54c5a" category="section-title">CPU关联性</block>
  <block id="74f896768ee487acfd4c42370c202bed" category="paragraph">SQL Server通过两个选项支持处理器关联性：</block>
  <block id="cb315fb2b62c836ba51357d46f2e8c3f" category="list-text">CPU相关性掩码</block>
  <block id="cb00a2408ea648cf85edfd7dbb23fbe0" category="list-text">相关性I/O掩码</block>
  <block id="49e103832576f4486179df8868372d17" category="section-title">最大平行度(MAXDOP)</block>
  <block id="a99f7ebb3b0f5b0ecea93ed586b2a17d" category="section-title">最大工作线程数</block>
  <block id="aff27140f50a549b1331add8d5025f7e" category="paragraph">最大工作线程数选项有助于在大量客户端连接到SQL Server时优化性能。</block>
  <block id="decd79137325e1efbc7b994f946ea24f" category="paragraph">默认值为0、这允许SQL Server在启动时自动配置工作线程数。这适用于大多数系统。最大工作线程数是一个高级选项、没有经验丰富的数据库管理员(Database Administrator、DBa)的帮助、不得更改。</block>
  <block id="29d04e616d2293c4c7538dd6226feac5" category="section-title">使用SQL Server Management Studio配置最大工作线程数。</block>
  <block id="44dbc82801d84781083ed9e23b63be00" category="list-text">对于&lt;或=最多8个核心：tempdb数据文件=核心数</block>
  <block id="6203fcdbdad10bb603fd00edd2f0fcf5" category="list-text">对于超过8个核心：8个tempdb数据文件</block>
  <block id="0424163d6b24f29436021dfd7072863b" category="paragraph">从SQL Server 2016开始、安装期间会自动检测操作系统可见的CPU核心数、SQL Server会根据该数量计算和配置获得最佳性能所需的tempdb文件数。</block>
  <block id="3b5b2ca12603a36517ce602ffe47361c" category="list-text">NetApp SnapCenter作为备份软件、其中包括：</block>
  <block id="36a92a010308100e1efc10d9eb98c369" category="list-text">适用于 Microsoft Windows 的 SnapCenter 插件</block>
  <block id="ec51578d7d8f930329548bf3d00d7038" category="list-text">适用于SQL Server的SnapCenter插件</block>
  <block id="a6d698a68f555339f6e91957f636ad69" category="list-text">Microsoft SQL Server架构和管理</block>
  <block id="697ea025ecb303d4f40d1bf3a8b4bde0" category="inline-link-macro">NetApp 互操作性表工具（ IMT ）</block>
  <block id="fbd4c4f9516af91c6c3cb5fa35fb5720" category="doc">Microsoft SQL Server存储注意事项</block>
  <block id="3da07c62fca4dd242f7ffcfcf72998be" category="section-title">数据存储设计</block>
  <block id="9e45010900186b3cbbe04f954a6f3562" category="paragraph">对于不使用SnapCenter 执行备份的SQL Server数据库、Microsoft建议将数据和日志文件放置在不同的驱动器上。对于同时更新和请求数据的应用程序、日志文件会占用大量写入资源、而数据文件(取决于您的应用程序)会占用大量读/写资源。对于数据检索、不需要日志文件。因此、可以通过放置在其自己驱动器上的数据文件来满足数据请求。</block>
  <block id="df018ea4abdb71f91802ea1d4fb0fb37" category="inline-link-macro">将数据和日志文件放在不同的驱动器上</block>
  <block id="f2f25c68d67c561be1926b4b06e676b0" category="paragraph">创建新数据库时、Microsoft建议为数据和日志指定单独的驱动器。要在创建数据库后移动文件、必须使数据库脱机。有关Microsoft的更多建议、请参见 <block ref="04fab8828edf0d2e95eff3c4f124b372" category="inline-link-macro-rx"></block>。</block>
  <block id="d5350d8759b1ec84607e47908809058e" category="section-title">聚合</block>
  <block id="77f1d6b9cbcaf3663f6bdd19a821e773" category="list-text">一个大型聚合可以最高效地利用磁盘空间。</block>
  <block id="63d9962fabe500361986d05317bd65a5" category="paragraph">对于高可用性(HA)、请将SQL Server Always On可用性组二级同步副本放在聚合中的一个单独Storage Virtual Machine (SVM)上。为了实现灾难恢复、请将异步副本放置在灾难恢复站点中单独存储集群中的聚合上、并使用NetApp SnapMirror技术复制内容。NetApp建议在聚合中至少留出10%的可用空间、以获得最佳存储性能。</block>
  <block id="c6f01c78bfe0a0a495cb5d3ed77824a9" category="section-title">Volumes</block>
  <block id="17fce39141e6fa457c789ce2c3239b0c" category="section-title">卷设计注意事项</block>
  <block id="d1c9fdbcdbb8521971decf35c6d1c0c8" category="paragraph">在创建数据库卷设计之前、请务必了解SQL Server I/O模式和特征如何根据工作负载以及备份和恢复要求而有所不同。请参见以下适用于灵活卷的NetApp建议：</block>
  <block id="674343739e297abb52c536a453ebaad0" category="list-text">使用NTFS挂载点而不是驱动器盘符、以超过Windows中26个驱动器盘符的限制。使用卷挂载点时、一般建议为卷标签指定与挂载点相同的名称。</block>
  <block id="4176288dbc134524f79476ba4e57e3aa" category="list-text">tempdb是一个系统数据库、SQL Server会使用它作为临时工作空间、尤其是用于I/O密集型DBCC CHECKDB操作。因此、请将此数据库放在具有一组单独磁盘轴的专用卷上。在卷数量是一项挑战的大型环境中、您可以在仔细规划后将tempdb整合到较少的卷中、并将其与其他系统数据库存储在同一个卷中。tempdb的数据保护不是高优先级、因为每次重新启动SQL Server时都会重新创建此数据库。</block>
  <block id="b703a2ceaabee81dd9dfcfb3a4b738ee" category="list-text">确保用户数据库文件和用于存储日志备份的日志目录位于不同的卷上、以防止保留策略在SnapVault技术中使用快照时覆盖这些快照。</block>
  <block id="ae72f885471636cbfd0dbe902ddf24e1" category="list-text">如果使用DiskManager或其他工具创建LUN、请确保在格式化LUN时将分区的分配单元大小设置为64K。</block>
  <block id="ac4782a9243acaaff52164f9e47417d5" category="inline-link-macro">Microsoft Windows和本机MPIO、并遵循适用于现代SAN的ONTAP最佳实践</block>
  <block id="934e206705ddafc720e4a8f25a4acded" category="list-text">请参见 <block ref="95506eaa4fca841adc20747ae4650d10" category="inline-link-macro-rx"></block> 在MPIO属性中将Windows上的多路径支持应用于iSCSI设备。</block>
  <block id="31a8d85b6a44cffc2c7dfc6387696f31" category="section-title">日志目录</block>
  <block id="29766ed5967263787fface0a4ad3396f" category="paragraph">主机日志目录的大小计算如下：
主机日志目录大小=((最大数据库LDF大小x每日日志更改率%) x (快照保留)÷(1 - LUN开销空间%)
主机日志目录规模估算公式假定LUN开销空间为10%</block>
  <block id="31333b887781902e13c263570523ddc1" category="paragraph">将日志目录放在专用卷或LUN上。主机日志目录中的数据量取决于备份的大小以及备份的保留天数。SnapCenter只允许每个SQL Server主机有一个主机日志目录。您可以在SnapCenter --&gt; Host --&gt; Configure Plug-in中配置主机日志目录。</block>
  <block id="e815059019027c04aa969a50787d5b34" category="paragraph">* NetApp建议*对主机日志目录执行以下操作：</block>
  <block id="07ae4edb1ccfbfe1f5da6006c95ee4a9" category="list-text">确保主机日志目录不会被任何可能损坏备份快照数据的其他类型的数据共享。</block>
  <block id="991bd1f492a593453f65c2a23c1f1612" category="list-text">请勿将用户数据库或系统数据库放置在托管挂载点的LUN上。</block>
  <block id="7b01578e73f5081fecdcc6dedf28aa3c" category="list-text">使用SnapCenter向导将数据库迁移到NetApp存储、以便数据库存储在有效位置、从而成功执行SnapCenter备份和还原操作。请注意、迁移过程会造成系统中断、并且在迁移过程中、发生原因会使数据库脱机。</block>
  <block id="b2d0e2f60ee139155b728ef6933efe7c" category="list-text">对于SQL Server的故障转移集群实例(FCIS)、必须满足以下条件：</block>
  <block id="863fda0972208e1e15d0c4a16d6915af" category="list-text">如果您使用的是故障转移集群实例、则主机日志目录LUN必须是与要备份的SQL Server实例位于同一集群组中的集群磁盘资源SnapCenter。</block>
  <block id="ddb1104e1e71caabad3e7639c7675af8" category="list-text">如果您使用的是故障转移集群实例、则必须将用户数据库置于共享LUN上、这些共享LUN是分配给与SQL Server实例关联的集群组的物理磁盘集群资源。</block>
  <block id="bca5f9a18696e080113088282fe481de" category="doc">Microsoft SQL Server内存配置</block>
  <block id="02578ec0e8ce2fbef37ca792fd20c289" category="section-title">最大服务器内存</block>
  <block id="6e345f11e9b2856a7ac40d6cf283606b" category="paragraph">在包含多个SQL Server实例的SQL Server集群上、每个实例可能会争用资源。为每个SQL Server实例设置内存限制有助于保证每个实例的最佳性能。</block>
  <block id="318b34a3511a1be6d179a73303da2077" category="admonition">*RAM NetApp建议*为操作系统至少保留4GB到6GB的内存，以避免出现性能问题。</block>
  <block id="cd151dbdf946ad6bd27e1d55ea1cd029" category="section-title">使用SQL Server Management Studio调整最小和最大服务器内存。</block>
  <block id="998c5e632fa0f987c20c182fc9322f67" category="section-title">非一致内存访问</block>
  <block id="b3b5cd113ed637ebe6cb28eab322307a" category="section-title">索引创建内存</block>
  <block id="631c6718cc62ad33b6e3b3b48d754569" category="paragraph">它控制最初为创建索引而分配的最大RAM量。此选项的默认值为0、这意味着它由SQL Server自动管理。但是，如果在创建索引时遇到困难，请考虑增加此选项的值。</block>
  <block id="8c91aa3f5264c57bd2d2e66bd70f2ad1" category="section-title">每个查询的最小内存</block>
  <block id="181341700086c5e2f2259774b2aaa59c" category="inline-link-macro">页面压缩实施</block>
  <block id="46c6aaf21d639d23d4f297a1f6922d9a" category="paragraph">行压缩会更改数据存储格式。例如、它会将整数和小数更改为可变长度格式、而不是其本机固定长度格式。此外、它还会通过消除空格将固定长度字符串更改为可变长度格式。页面压缩可实现行压缩和另外两种压缩策略(前缀压缩和词典压缩)。有关页面压缩的详细信息、请参见 <block ref="88eab602b149fe360da37498ad5cdeae" category="inline-link-macro-rx"></block>。</block>
  <block id="0d629ff07f9214182fa91977089ff029" category="paragraph">SQL Server 2008及更高版本的企业版、开发人员版和评估版目前支持数据压缩。虽然数据压缩可以由数据库本身执行、但在SQL Server环境中很少会出现这种情况。</block>
  <block id="c6757fbc56df4ba20f0ef165aeb214d0" category="paragraph">下面是管理SQL Server数据文件空间的建议</block>
  <block id="46344e63db1ea2128cc47543b10a0f96" category="list-text">在SQL Server环境中使用精简配置可提高空间利用率、并在使用空间保证功能时降低整体存储需求。</block>
  <block id="924e1b131d6b3a2846efd1a81de8eac1" category="list-text">对最常见的部署配置使用自动增长、因为存储管理员只需要监控聚合中的空间使用量。</block>
  <block id="752d71c042ef775879f6db705ccf6b31" category="section-title">空间回收</block>
  <block id="89f8656e4e33094d6011ef9aaa8fa8de" category="paragraph">可以定期启动空间回收、以恢复LUN中未使用的空间。对于SnapCenter、您可以使用以下PowerShell命令启动空间回收。</block>
  <block id="aa864feb1e600aa376e91ac119da387b" category="paragraph">如果需要运行空间回收、则应在活动较少的时段运行此过程、因为它最初会占用主机上的周期。</block>
  <block id="5c014f8939a89da0166a347a0237cf4f" category="section-title">SnapCenter</block>
  <block id="1567bc0803275089d7cbc1ffc468158c" category="inline-link-macro">TR-4714：《使用NetApp SnapCenter的SQL Server最佳实践指南》</block>
  <block id="17f58c1b5cb5feb5dcaf49ca87298c00" category="paragraph">有关适用于SnapCenter的SQL Server插件的详细信息、请参见 <block ref="c94de7812b9bc9ed76b3c4005974958d" category="inline-link-macro-rx"></block>。</block>
  <block id="91a7baba41dc4b5f958101b261cf179b" category="section-title">使用T-SQL快照保护数据库</block>
  <block id="02e19b2989ebddca9ad3778807bdc426" category="paragraph">以下是备份工作流示例：</block>
  <block id="bd03301405e4dd8f2460ff1788765ac4" category="list-text">使用新的backup group和backup server命令同时对存储卷上的多个数据库执行快照。</block>
  <block id="a3b19be7df3ddff7295558d9934cd9b6" category="list-text">执行完整备份或copy_only完整备份。这些备份也会记录在msdb中。</block>
  <block id="e2d06152222f63515f4b83229cb5444c" category="list-text">在快照完整备份之后、使用通过正常流式传输方法创建的日志备份执行时间点恢复。如果需要、还支持流式差异备份。</block>
  <block id="a7a2496066febda8d325e0964e434481" category="inline-link-macro">了解T-SQL快照的Microsoft文档</block>
  <block id="bf06f3f95c5b653499bb4ac53ba44c95" category="paragraph">要了解更多信息，请参见 <block ref="2ba8392a398067f6d2e5f6e4167e9d00" category="inline-link-macro-rx"></block>。</block>
  <block id="450eb6d84ec721a20f17b7778b24b457" category="doc">Microsoft SQL Server工作负载</block>
  <block id="5306de2e4bff067a10c1c9b5aafe5920" category="paragraph">从理论上讲、SQL Server (64位)支持每个实例32、767个数据库以及524、272 TB的数据库大小、尽管典型安装通常包含多个数据库。但是、SQL Server可以处理的数据库数量取决于负载和硬件。SQL Server实例托管数十个、数百个甚至数千个小型数据库的情况并不少见。</block>
  <block id="9a3f42cec243006996ab4580d3ce5d56" category="paragraph">每个数据库由一个或多个数据文件和一个或多个事务日志文件组成。事务日志存储有关数据库事务以及每个会话所做的所有数据修改的信息。每次修改数据时、SQL Server都会在事务日志中存储足够的信息、以便撤消(回滚)或重做(重放)操作。SQL Server事务日志是SQL Server在数据完整性和稳定性方面声誉的重要组成部分。事务日志对于SQL Server的运行异常、一致性、隔离和持久性(ACID)功能至关重要。一旦对数据页面进行任何更改、SQL Server就会写入事务日志。每个数据操作语言(DML)语句(例如SELECT、INSERT、UPDATE-DELETE)都是一个完整的事务、事务日志可确保执行整个基于集合的操作、从而确保事务的正常运行。</block>
  <block id="cbe6958e46fbab53cdbdb9deb2d75938" category="paragraph">每个数据库都有一个主数据文件、默认情况下、该文件的扩展名为.mdf。此外、每个数据库都可以具有二级数据库文件。默认情况下、这些文件的扩展名为.NDF。</block>
  <block id="811b578b6dfbb4a4ca16ba0c0911e3df" category="paragraph">所有数据库文件都分组到文件组中。文件组是逻辑单元、可简化数据库管理。它们允许在逻辑对象放置和物理数据库文件之间进行隔离。创建数据库对象表时、您可以指定应将其放置在哪个文件组中、而不必担心基础数据文件配置。</block>
  <block id="3ac46c2f04dec9d215efbe44d307a020" category="admonition">* NetApp建议*避免将主文件组用于除系统对象之外的任何其他对象。为用户对象创建单独的文件组或一组文件组可简化数据库管理和灾难恢复、尤其是在大型数据库的情况下。</block>
  <block id="e3fc56c012a5d0c9f92dff9b49bcc80d" category="paragraph">您可以在创建数据库或向现有数据库添加新文件时指定初始文件大小和自动增长参数。SQL Server在选择应将数据写入哪个数据文件时使用比例填充算法。它会将大量数据按比例写入文件中的可用空间。文件中的可用空间越多、它处理的写入就越多。</block>
  <block id="91d249de86b62102d6324849de2360fe" category="admonition">* NetApp建议*单个文件组中的所有文件都具有相同的初始大小和自动增长参数，并且增长大小以MB而不是百分比为单位定义。这有助于比例填充算法均匀地平衡数据文件之间的写入活动。</block>
  <block id="54db492ee9e4d356cc8722d1f4126f77" category="paragraph">SQL Server始终将事务日志零、并且此行为无法更改。但是、您可以通过启用或禁用即时文件初始化来控制数据文件是否置零。启用即时文件初始化有助于加快数据文件增长速度、并减少创建或还原数据库所需的时间。</block>
  <block id="92208bd4d9c6fec3f7c1dedeca62e135" category="paragraph">即时文件初始化会带来较小的安全风险。启用此选项后、数据文件的未分配部分可能包含先前删除的操作系统文件中的信息。数据库管理员可以检查此类数据。</block>
  <block id="2b222ad4000e6e966783fd7bc480180e" category="paragraph">您可以通过向SQL Server启动帐户添加SA_Manage_volume_name权限(也称为"执行卷维护任务")来启用即时文件初始化。您可以在本地安全策略管理应用程序(secpol.msc)下执行此操作、如下图所示。打开"Perform volume Maintenance Task (执行卷维护任务)"权限的属性、并将SQL Server启动帐户添加到其中的用户列表中。</block>
  <block id="c622e0142ed854a10f98fcaa8b3487f8" category="paragraph">要检查权限是否已启用、您可以使用以下示例中的代码。此代码设置了两个跟踪标志、用于强制SQL Server将追加信息写入错误日志、创建小型数据库以及读取日志内容。</block>
  <block id="eba8c32bde087b29aaa1fe0d3bb32ef3" category="paragraph">如果未启用即时文件初始化、则SQL Server错误日志会显示、除了将ldf日志文件置零之外、SQL Server还会将MDF数据文件置零、如以下示例所示。启用即时文件初始化后、它仅显示日志文件置零。</block>
  <block id="37fbf1be337695452699ab9df948aa25" category="paragraph">对性能问题进行故障排除可能非常复杂、因为您必须确定哪个实例是根发生原因。此问题会与操作系统许可证和SQL Server许可证的成本进行权衡。如果应用程序性能至关重要、则强烈建议使用专用实例。</block>
  <block id="c840abede1d1bcf78e7b3e30048c08b1" category="paragraph">Microsoft在服务器级别为每个核心(而不是每个实例)授予SQL Server许可证。因此、为了节省许可成本、数据库管理员尝试尽可能多地安装服务器可以处理的SQL Server实例、这可能会导致以后出现重大性能问题。</block>
  <block id="8a77155b45f0f2313c8ebf3d755463e5" category="admonition">*SQL NetApp建议*尽可能选择专用的SQL Server实例，以获得最佳性能。</block>
  <block id="df7423789cebcf51de121abdae4181c3" category="summary">ONTAP和企业级应用程序</block>
  <block id="eaf36c98b91893b7f79bd5184a23d377" category="doc">Solaris</block>
  <block id="fb04d97697a77a89d0c3f5c09cd9ba47" category="paragraph">特定于Solaris OS的配置主题。</block>
  <block id="eefc332f1bd0a0aa81d0ce222989294f" category="section-title">Solaris NFS挂载选项</block>
  <block id="3e484486d582145f6d93ca5f8c71e228" category="paragraph">下表列出了单个实例的Solaris NFS挂载选项。</block>
  <block id="6622c14ce91b6b9683505626a5eebdd2" category="cell">文件类型</block>
  <block id="f18f8a29d3e2281d374f43c78cf8f0f1" category="cell">挂载选项</block>
  <block id="a45543a64530673135f37ff8f9e95e69" category="cell">ADr主页</block>
  <block id="93a02670f814a2df6c830194a7244ea9" category="cell"><block ref="623bbf58c0b2f552d891a1c276bcc3bc" prefix="" category="inline-code"></block></block>
  <block id="80d52d74fd5c383b43f91575d569b42c" category="cell">控制文件
数据文件
重做日志</block>
  <block id="73cf9d3814b8678439c37316096219b1" category="cell"><block ref="4c899c62e1ffeb12078476828bb54351" prefix="" category="inline-code"></block></block>
  <block id="72d33cb5c8b7ff5f7fd6a894094b0697" category="cell"><block ref="e1f651debac4f720c13ae930ff3ca14a" prefix="" category="inline-code"></block></block>
  <block id="3f490427e0bf55dc5c837e7b0d4c651c" category="cell"><block ref="b9ce73264210e6d0faa4115ce7525610" prefix="" category="inline-code"></block></block>
  <block id="b00b0ab6e8494db1a230bf3da7f42fd6" category="paragraph">的使用<block ref="545e1db0caafaa47ef37ce893c8fb92c" prefix=" " category="inline-code"></block> 经验证、通过消除与获取和释放存储系统锁定相关的延迟、可以显著提高客户环境的性能。在配置了大量服务器以挂载相同文件系统且Oracle配置为挂载这些数据库的环境中、请谨慎使用此选项。尽管这种配置非常少见、但也有少数客户使用。如果某个实例再次意外启动、则可能会发生数据损坏、因为Oracle无法检测到外部服务器上的锁定文件。NFS锁定不会在其他情况下提供保护；与NFS版本3一样、它们仅为建议使用。</block>
  <block id="f480015b57b289b7dad1473ee5c55216" category="paragraph">因为<block ref="545e1db0caafaa47ef37ce893c8fb92c" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 参数是互斥的、这一点很重要<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 中存在<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 文件<block ref="6887bae4cda2d09a283a165c5be3f2b8" prefix=" " category="inline-code"></block> 已使用。如果没有此参数、则会使用主机操作系统缓冲区缓存、并且可能会对性能产生不利影响。</block>
  <block id="5171d5dfdc21b0941b921796638c10a9" category="paragraph">下表列出了Solaris NFS RAC挂载选项。</block>
  <block id="38e4e10abf410c92cd13e9cb4d54ae35" category="cell"><block ref="41a82b9bd64cb001f8913a34614b00d1" prefix="" category="inline-code"></block></block>
  <block id="e72cc50c204d77a1e47f0dcc8ad28a56" category="cell">控制文件
数据文件
重做日志</block>
  <block id="98ee9e91a49f27abbd9dc831afa9fae5" category="cell"><block ref="f3a0fd4a197a2eae60d2ef904e5366f1" prefix="" category="inline-code"></block></block>
  <block id="f93eecf9c582d76d4e14292dc34c79f8" category="cell">CRS/表决</block>
  <block id="42c82995de255264e2a8690c3149c16a" category="cell">专用<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block></block>
  <block id="b71e04a676ec52e65edb52c138f2ad98" category="cell"><block ref="ac15a7c050732bc5169b6c17ce30f859" prefix="" category="inline-code"></block></block>
  <block id="273f714e976e2a709a6abe18d34e4b61" category="cell">共享<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block></block>
  <block id="2052aa052eee25e077178cd737b68f47" category="cell"><block ref="18f533bce293643d1004086db883dd03" prefix="" category="inline-code"></block></block>
  <block id="e9d3beba8b6a40da6f8074236ca3ddbc" category="paragraph">单实例挂载选项与RAC挂载选项之间的主要区别在于添加了<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 挂载选项。这种添加的效果是禁用主机操作系统缓存、从而使RAC集群中的所有实例都能获得一致的数据状态视图。但使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 参数<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 与禁用主机缓存具有相同的效果、但仍需要使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block>。</block>
  <block id="983c4ff0cb78851d95be06277152653f" category="paragraph">原因<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 对于共享为必填项<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是为了提高Oracle密码文件和spfile等文件的一致性。RAC集群中的每个实例都有一个专用<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，则不需要此参数。</block>
  <block id="5a11994cffaa4d0a9c8594d2223e3e96" category="section-title">Solaris UFS挂载选项</block>
  <block id="130c5ffb786e38c2e6648fd53593681a" category="paragraph">NetApp强烈建议使用日志记录挂载选项、以便在Solaris主机崩溃或FC连接中断时保持数据完整性。日志记录挂载选项还会保留Snapshot备份的可用性。</block>
  <block id="516f7006de2e9b1f7f871d961db4a1ca" category="section-title">Solaris ZFS</block>
  <block id="a92c2c52c7360246c6da2b1169e0fa50" category="paragraph">必须仔细安装和配置Solaris ZFS，才能提供最佳性能。</block>
  <block id="c9208a3ad95d5ce3d9e2ba1839426251" category="section-title">mvector</block>
  <block id="bc7e9b3c34345bf9ebe88467d6714f1b" category="paragraph">如果此更改出现任何意外问题、可以通过以root用户身份运行以下命令轻松反转此更改：</block>
  <block id="6ff9f4444ac481652f4412b5e1623846" category="section-title">内核</block>
  <block id="78d06f587305b9e5481c8cf660693a61" category="paragraph">要获得可靠的ZFS性能、需要对Solaris内核进行修补、以防止出现LUN对齐问题。此修复程序是在Solaris 10的修补程序147440-19以及Solaris 11的SRU 10.5中引入的。请仅将Solaris 10及更高版本与ZFS结合使用。</block>
  <block id="db8880d80ab20f2f01a010e5c454f7fb" category="section-title">LUN配置</block>
  <block id="3b296d65c0c37979abe39ac7f6d8e1d8" category="paragraph">要配置LUN、请完成以下步骤：</block>
  <block id="3bdc2a5622b76404f8b0ce2fc774e69a" category="list-text">创建类型为的LUN<block ref="7bee0477f82303aa43de5d78f7b9cb05" prefix=" " category="inline-code"></block>。</block>
  <block id="c06f6c6685c06bb821295b3a6d5e580c" category="list-text">安装指定的相应Host Utility Kit (HUK) <block ref="b5b16f3cdb0eb25a282348ba54f8c677" category="inline-link-macro-rx"></block>。</block>
  <block id="33db73c9b3936cb8eaae825d3101f60c" category="inline-link-macro">最新文档</block>
  <block id="c8646086dca29c1d978ab285faa93709" category="list-text">完全按照所述执行HUK中的说明。基本步骤概述如下、但请参见 <block ref="33574dfffc2cb6d01be0edb6738c51bb" category="inline-link-macro-rx"></block> 正确的操作步骤。</block>
  <block id="6c06455cad171d61eac3593147bd71d6" category="list-text">运行<block ref="3062dc928daa4d85f6e34b6dea110a00" prefix=" " category="inline-code"></block> 实用程序以更新<block ref="d5416d340f5bec1fcb3addb6ae7d059e" prefix=" " category="inline-code"></block> 文件这样可以使SCSI驱动器正确发现ONTAP LUN。</block>
  <block id="7ec6668202fa9a677238143b0445102f" category="list-text">按照提供的说明进行操作<block ref="3062dc928daa4d85f6e34b6dea110a00" prefix=" " category="inline-code"></block> 用于启用多路径输入/输出(MPIO)的实用程序。</block>
  <block id="b53abe6c0013125abea171427b351ccc" category="list-text">重新启动。要在整个系统中识别任何更改、必须执行此步骤。</block>
  <block id="b88caedbe9708683eed783eb534ae5f6" category="list-text">对LUN进行分区并验证它们是否已正确对齐。有关如何直接测试和确认对齐的说明，请参阅“附录B：WAFL对齐验证”。</block>
  <block id="a0c1c26e783204cf713b2e1f0823aab3" category="section-title">zpools</block>
  <block id="c81b8fe4a368c32102406e65fc41a227" category="inline-link-macro">LUN配置</block>
  <block id="869dc3a8daf591c7f33e5bb32a4a63c9" category="paragraph">的值<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 默认为9、表示2^9或512字节。为了获得最佳性能、<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 值必须为12 (2^12=4k)。此值在创建zpool时设置、并且无法更改、这意味着具有的zpool中的数据<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 应通过将数据复制到新创建的zpool来迁移12以外的文件。</block>
  <block id="6a00a2262e030c2656588743cb031710" category="paragraph">创建zpool后、请验证的值<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 然后继续。如果此值不是12、则表示未正确发现LUN。销毁zpool、确认相关Host Utilities文档中显示的所有步骤均已正确执行、然后重新创建zpool。</block>
  <block id="15ec722ce3f6694d12f89aeb5b621941" category="section-title">zpool和Solaris LDom</block>
  <block id="8826ef54a7d108df25ed6921b5129cb6" category="paragraph">Solaris LDOM还要求确保I/O对齐正确。虽然LUN可能会作为4K设备正确地被发现、但LDOM上的虚拟vdsk设备不会继承I/O域中的配置。基于该LUN的vdsk默认为512字节的块。</block>
  <block id="9a984f24f825e4f0bca1f36e11acbca9" category="paragraph">需要一个额外的配置文件。首先、必须为各个LLOM修补Oracle错误27824910、以启用其他配置选项。此修补程序已移植到所有当前使用的Solaris版本中。对LDOM进行修补后、即可按如下所示配置正确对齐的新LUN：</block>
  <block id="e0f306ab540315b015db849b1ae9099e" category="list-text">确定要在新zpool中使用的一个或多个LUN。在此示例中、它是C2D1设备。</block>
  <block id="f469046d419183a7be08ed5a13d2c65e" category="list-text">检索要用于ZFS池的设备的VDC实例：</block>
  <block id="bcaa63dcd5db76bffd8b867e8720a272" category="list-text">编辑<block ref="ebceeaa7b6ce5abf6c8de7177255fef5" prefix=" " category="inline-code"></block>：</block>
  <block id="ec960a08b4666fe258b6e005064378ab" category="paragraph">这意味着为设备实例1分配的块大小为4096。</block>
  <block id="3df4cdc476a0c3a5a930597e9d8da84c" category="paragraph">作为另一个示例、假设需要为vdsk实例1到6配置4K块大小和<block ref="74a491ed941b00d0c9909d488eee67bf" prefix=" " category="inline-code"></block> 内容如下：</block>
  <block id="dfed6d8974f03c5b31f20c9c5c2bbe66" category="list-text">最终版本<block ref="3328fba80b08b36663ffae0684f6c578" prefix=" " category="inline-code"></block> 文件应包含以下内容：</block>
  <block id="764a2caff05993fc0d3eff5de7b225e9" category="cell">小心</block>
  <block id="5c442834a7707cc96719e468c87b2ff6" category="cell">配置vdc.conf并创建vdsk后、必须重新启动LLOM。这一步是不可避免的。块大小更改仅在重新启动后生效。继续进行zpool配置、并确保将ashift正确设置为12、如上所述。</block>
  <block id="2138e0b461ac7e557539bb0b33bde81a" category="section-title">ZFS意图日志(ZIL)</block>
  <block id="5477cebfd480a13008afdd16bea2b3f9" category="paragraph">通常，没有理由在其他设备上查找ZFS意图日志(ZIL)。日志可以与主池共享空间。单独的ZIL主要用于使用在现代存储阵列中缺少写入缓存功能的物理驱动器。</block>
  <block id="26a004aeb043de19f767bd7daa39cf2f" category="section-title">对数偏差</block>
  <block id="07fff183bc4c01bf9bbb21a48b389845" category="paragraph">设置<block ref="26a004aeb043de19f767bd7daa39cf2f" prefix=" " category="inline-code"></block> 用于托管Oracle数据的ZFS文件系统上的参数。</block>
  <block id="ac01fbc5e98d6450f3b565d0617f4a55" category="paragraph">使用此参数可降低整体写入级别。在默认设置下、写入的数据会先提交到ZIL、然后再提交到主存储池。此方法适用于使用普通驱动器配置的配置、该配置包括基于SSD的ZIL设备和用于主存储池的旋转介质。这是因为它允许在可用延迟最低的介质上的单个I/O事务中进行提交。</block>
  <block id="c6cc0f147c42f124079d7fc1a0761886" category="paragraph">如果使用的是具有自身缓存功能的现代存储阵列、则通常不需要使用此方法。在极少数情况下、可能需要将具有单个事务的写入提交到日志中、例如由高度集中且对延迟敏感的随机写入组成的工作负载。写入放大会产生一定的后果、因为记录的数据最终会写入主存储池、从而导致写入活动增加一倍。</block>
  <block id="92b9531657a4ce6a31c623d889a2c55d" category="section-title">直接I/O</block>
  <block id="387f4a4c250ed7a5003f3f6a19abfd1f" category="paragraph">许多应用程序(包括Oracle产品)都可以通过启用直接I/O来绕过主机缓冲区缓存此策略无法按预期用于ZFS文件系统。尽管会绕过主机缓冲区缓存，但ZFS本身仍会继续缓存数据。在使用FIO或SIO等工具执行性能测试时、此操作可能会导致误导性的结果、因为很难预测I/O是到达存储系统还是在操作系统中本地缓存。此操作还会使使用此类综合测试来比较ZFS与其他文件系统的性能变得非常困难。实际上、在实际用户工作负载下、文件系统性能几乎没有差别。</block>
  <block id="ec79b30d56e7bae54aa7efedccc47e93" category="section-title">多个zpool</block>
  <block id="f5aa5b31f0536ddcdb748ae360d91358" category="paragraph">必须在zpool级别对基于ZFS的数据执行基于Snapshot的备份、还原、克隆和归档、并且通常需要多个zpool。zpool类似于LVM磁盘组、应使用相同的规则进行配置。例如、数据库的布局可能最好是将数据文件驻留在上<block ref="f1fb162e58045170396a0ac29d648fa5" prefix=" " category="inline-code"></block> 以及上的归档日志、控制文件和重做日志<block ref="92073f03d18c8eaec3eb5e0908210e1a" prefix=" " category="inline-code"></block>。此方法允许使用标准热备份、其中数据库将置于热备份模式、然后是的快照<block ref="f1fb162e58045170396a0ac29d648fa5" prefix=" " category="inline-code"></block>。然后、数据库将从热备份模式中删除、并强制执行日志归档和的快照<block ref="92073f03d18c8eaec3eb5e0908210e1a" prefix=" " category="inline-code"></block> 已创建。还原操作需要卸载zfs文件系统并使zpool完全脱机、然后执行SnapRestore还原操作。然后、可以将zpool重新联机并恢复数据库。</block>
  <block id="f1110589be196c2310808482067fce1b" category="section-title">filesystemio_options</block>
  <block id="c271ff9f255f2d215054d508448781a3" category="paragraph">Oracle参数<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 与ZFS的工作方式不同。条件<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block> 或<block ref="6887bae4cda2d09a283a165c5be3f2b8" prefix=" " category="inline-code"></block> 使用时、写入操作是同步的、并会绕过操作系统缓冲区缓存、但读取操作会由ZFS进行缓冲。此操作会导致性能分析出现困难、因为I/O有时会被ZFS缓存截获并提供服务、从而使存储延迟和总I/O比看起来要小。</block>
  <block id="b1fd823d262032e04291313f72be9452" category="doc">HP-UX</block>
  <block id="8ec258cd0b6ab050fc478a415a20f2e9" category="section-title">HP-UX NFS挂载选项</block>
  <block id="7c5876d5737071c64af78562fe375386" category="paragraph">下表列出了单个实例的HP-UX NFS挂载选项。</block>
  <block id="9c9fb3cc18a83e4e46165b5c3d4ce8ef" category="cell">控制文件
数据文件
重做日志</block>
  <block id="55b835c747261995c0e1022d234e286d" category="cell"><block ref="fa8766c679857b7d589983df0ab5bcf4" prefix="" category="inline-code"></block></block>
  <block id="189dbd39cabd57c5d2e51714d9a5b85b" category="paragraph">下表列出了RAC的HP-UX NFS挂载选项。</block>
  <block id="fa9da3a6a7ef8986a94c7395577c322f" category="cell"><block ref="8b080dc74532d24847a6163dcc34d93f" prefix="" category="inline-code"></block></block>
  <block id="add42ff64fa5b57e5abeab49d154a9d9" category="cell"><block ref="acdef4af05a9f0c43f72b7c600f04d62" prefix="" category="inline-code"></block></block>
  <block id="c88a7b7f83f761f7fc2979815d210140" category="cell"><block ref="d29d7b7ed8c19a99fe17fd7f3d07ea7b" prefix="" category="inline-code"></block></block>
  <block id="af8831a1b8129b099114c3237a61db88" category="paragraph">单实例挂载选项与RAC挂载选项之间的主要区别在于添加了<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 挂载选项。这种添加的效果是禁用主机操作系统缓存、从而使RAC集群中的所有实例都能获得一致的数据状态视图。但使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 参数<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 与禁用主机缓存具有相同的效果、但仍需要使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block>。</block>
  <block id="b865c6aba24c3f61595471aab993d27c" category="paragraph">原因<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 对于共享为必填项<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是为了提高Oracle密码文件和spfile等文件的一致性。RAC集群中的每个实例都有一个专用<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，则不需要此参数。</block>
  <block id="898311d838a2fa2fa41b4b52a63a7f1d" category="section-title">HP-UX VxFS挂载选项</block>
  <block id="85b4a3d44370909d395ab8af28ff4927" category="paragraph">对于托管Oracle二进制文件的文件系统、请使用以下挂载选项：</block>
  <block id="6630bbc9a901be0d038b2c39e2faf65d" category="paragraph">对于包含数据文件、重做日志、归档日志和控制文件的文件系统、如果HP-UX版本不支持并发I/O、请使用以下挂载选项：</block>
  <block id="ed37730e0f28a631768a396e7898e197" category="paragraph">如果支持并发I/O (VxFS 5.0.1及更高版本或ServiceGuard Storage Management Suite)、请对包含数据文件、重做日志、归档日志和控制文件的文件系统使用以下挂载选项：</block>
  <block id="f51ddb98d92e83609db075add5fba4d8" category="admonition">参数<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 在VxFS环境中尤其重要。Oracle建议在Oracle 10g R1及更高版本中保持此参数未设置、除非另有明确指示。Oracle 8 KB块大小的默认值为128。如果此参数的值强制设置为16或更低、请删除<block ref="a6b02283cba560dcfdea44af66ec792c" prefix=" " category="inline-code"></block> 挂载选项、因为它可能会损坏顺序I/O性能。此步骤会损害性能的其他方面、仅当的值为时才应执行此步骤<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 必须更改默认值。</block>
  <block id="5802d9527a43305e9e1c903bc6b5a721" category="paragraph">特定于使用AFC和ASMlib的Linux操作系统的配置主题</block>
  <block id="2681013be5b0a9063a7ef0a8fe4d31da" category="section-title">ASMlib块大小</block>
  <block id="1943673cc25055e93f0129f2baa8f499" category="paragraph">ASMlib是一个可选的ASM管理库和关联实用程序。其主要价值是能够使用可读标签将LUN或基于NFS的文件标记为ASM资源。</block>
  <block id="51713fdb873939c9c333273947776b8e" category="paragraph">最新版本的ASMlib会检测到一个名为逻辑块/物理块指数(Logical Blocks Per Physical Block Exponent、LBPPBE)的LUN参数。直到最近、ONTAP SCSI目标才报告此值。现在、它将返回一个值、指示首选的块大小为4 KB。这不是块大小的定义、但对于使用LBPPBE的任何应用程序来说、这是一个提示、即可以更高效地处理特定大小的I/O。但是、ASMlib会将LBPPBE解释为块大小、并在创建ASM设备时持久标记ASM标头。</block>
  <block id="65242d5b49071240043eeef598415104" category="paragraph">此过程可能会在许多方面出现发生原因升级和迁移问题、所有这些问题都是由于无法在同一个ASM磁盘组中混用块大小不同的ASMlib设备。</block>
  <block id="ea884eec0628302adc731211dc4e2cc7" category="paragraph">例如、较早的阵列通常报告LBPPBE值为0、或者根本不报告此值。ASMlib会将此数据块大小解释为512字节。较新的阵列会被解释为块大小为4 KB。不能在同一个ASM磁盘组中混用512字节和4 KB设备。这样做会阻止用户使用两个阵列中的LUN或将ASM用作迁移工具来增加ASM磁盘组的大小。在其他情况下、RMAN可能不允许在块大小为512字节的ASM磁盘组与块大小为4 KB的ASM磁盘组之间复制文件。</block>
  <block id="f17ff15b23b87f35906ece98842a080f" category="paragraph">首选解决方案是修补ASMlib。Oracle错误ID为13999609、此修补程序位于oracleasm-support-2.1.8-1及更高版本中。此修补程序允许用户设置参数<block ref="442e2026c8afecc4611b52331b5d0d56" prefix=" " category="inline-code"></block> to<block ref="b326b5062b2f0e69046810717534cb09" prefix=" " category="inline-code"></block> 在中<block ref="92a59ba9a0643a344be2d72cfd504181" prefix=" " category="inline-code"></block> 配置文件。这样做会阻止ASMlib使用LBPPBE参数、这意味着新阵列上的LUN现在可识别为512字节块设备。</block>
  <block id="f140ff6b2b71e70e551e39dacb9561ef" category="admonition">选项不会更改先前由ASMlib标记的LUN上的块大小。例如、如果必须将包含512字节块的ASM磁盘组迁移到报告4 KB块的新存储系统、则可以选择此选项<block ref="442e2026c8afecc4611b52331b5d0d56" prefix=" " category="inline-code"></block> 必须在新LUN标记为ASMlib之前进行设置。  如果设备已标记为oracleasm，则必须先重新格式化，然后再重新添加新的块大小。首先、使用取消配置设备<block ref="41bd8c47b8e640da7bdb5c7dc995d435" prefix=" " category="inline-code"></block>，然后使用清除设备的第一个1GB<block ref="85c2e94baaf4d9c084e19d290907596e" prefix=" " category="inline-code"></block>。最后、如果设备之前已分区、请使用<block ref="9a287d63dabd6fbcbbe1b12344bfe922" prefix=" " category="inline-code"></block> 命令删除陈旧分区或仅重新启动操作系统。</block>
  <block id="75ad83418241561186f96dfed5229aaa" category="paragraph">如果无法修补ASMlib、则可以从配置中删除ASMlib。此更改会造成系统中断、需要取消ASM磁盘的附加服务、并确保<block ref="0802edf7303a95bdecde832bbbe3a89c" prefix=" " category="inline-code"></block> 参数设置正确。但是、这种更改不需要迁移数据。</block>
  <block id="ad9ac4c6d7ed2e11bdcf8c693658a482" category="section-title">ASM筛选驱动器((AFD)块大小</block>
  <block id="de59cd97a61c9f9964a35d2cd8b05c88" category="paragraph">AAutomatic是一个可选的ASM管理库、它将取代ASMlib。从存储角度来看、它与ASMlib非常相似、但它还包括一些其他功能、例如、可以阻止非Oracle I/O、从而降低用户或应用程序错误可能损坏数据的几率。</block>
  <block id="36dc27685773851e52f035f82e3deba2" category="section-title">设备块大小</block>
  <block id="1ef92cf7e561e179d6079cc937b2778a" category="paragraph">与ASMlib一样、ADAD还会读取LUN参数Logical Blocks Per Physical Block Exponent (LBPPBE)、默认情况下会使用物理块大小、而不是逻辑块大小。</block>
  <block id="b95ce6c503801cb15f2f9c0773c58f00" category="paragraph">如果在现有配置中添加了AAutomatic、而ASM设备已格式化为512字节块设备、则可能会出现问题。AAutomatic驱动程序会将LUN识别为4K设备、如果ASM标签与物理设备不匹配、则会阻止访问。同样、迁移也会受到影响、因为不能在同一个ASM磁盘组中混用512字节和4 KB设备。这样做会阻止用户使用两个阵列中的LUN或将ASM用作迁移工具来增加ASM磁盘组的大小。在其他情况下、RMAN可能不允许在块大小为512字节的ASM磁盘组与块大小为4 KB的ASM磁盘组之间复制文件。</block>
  <block id="7ef45d3a7c5fff234bf42bdf549b8339" category="paragraph">解决方案非常简单—AFAS包含一个参数、用于控制它使用的是逻辑块大小还是物理块大小。此全局参数会影响系统上的所有设备。要强制AfD使用逻辑块大小、请设置<block ref="722fc896569f3d455bb5ef8f5b8c3703" prefix=" " category="inline-code"></block> 在中<block ref="dcd5fd81543c5e08e927c54e89acdd40" prefix=" " category="inline-code"></block> 文件</block>
  <block id="47b0d7fc4c27720c4fc326722edad27c" category="section-title">多路径传输大小</block>
  <block id="7c329811bcc7bb2f50005da5a3aff250" category="paragraph">最近的Linux内核更改会强制实施发送到多路径设备的I/O大小限制、而AFD不会遵守这些限制。然后、I/O将被拒绝、从而导致LUN路径脱机。因此、无法安装Oracle Grid、配置ASM或创建数据库。</block>
  <block id="926e4b7a2822a39a07f61474b92e9d8c" category="paragraph">解决方案将在多路径.conf文件中为ONTAP LUN手动指定最大传输长度：</block>
  <block id="3d0c741146f1e8e31bc7d07128ca6e0a" category="admonition">即使当前不存在任何问题、如果使用AWAD来确保未来的Linux升级不会出现意外的发生原因问题、则应设置此参数。</block>
  <block id="d99ae60d37a12f766bc2a1f1c228fb4f" category="section-title">并发I/O</block>
  <block id="0f3eb508f611e203aeffa91d5753648a" category="paragraph">要在IBM AIX上实现最佳性能、需要使用并发I/O如果不使用并发I/O、则性能可能会受到限制、因为AIX会执行序列化的原子I/O、从而产生大量开销。</block>
  <block id="ecdc41fc6a2adf7e41e7277e12eeb805" category="paragraph">最初、NetApp建议使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 挂载选项、用于强制在文件系统上使用并发I/O、但此过程存在缺点、不再需要。自AIX 5.2和Oracle 10gR1推出以来、AIX上的Oracle可以打开单个文件以实现并发IO、而不是强制在整个文件系统上执行并发I/O。</block>
  <block id="445b433b62b675f0ca0bda7acb56d41b" category="paragraph">启用并发I/O的最佳方法是设置<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 参数<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> to<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block>。这样、Oracle就可以打开特定文件、以便用于并发I/O</block>
  <block id="6206c23a0282b18352573158f9a8f9b3" category="paragraph">使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 作为挂载选项、会强制使用并发I/O、这可能会产生负面影响。例如、强制执行并发I/O会在文件系统上禁用预读、这可能会损害Oracle数据库软件之外发生的I/O的性能、例如复制文件和执行磁带备份。此外，Oracle GoldenGate和SAP BR*Tools等产品与不兼容<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 适用于某些Oracle版本的挂载选项。</block>
  <block id="770cb9a1e9321ca3012ecbb9ec65c422" category="list-text">请勿使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 文件系统级别的挂载选项。而是通过使用来启用并发I/O<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block>。</block>
  <block id="872080b7d5ec5585776f1426fb157842" category="list-text">仅使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 如果无法设置、则应设置挂载选项<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block>。</block>
  <block id="0c5d86482201f32acb30cd2f7de3048f" category="section-title">AIX NFS挂载选项</block>
  <block id="1ce07cafb2507c98c8b96ad5f35fb66a" category="paragraph">下表列出了Oracle单实例数据库的AIX NFS挂载选项。</block>
  <block id="9a8f040dae3f0f15b337fe69a85239c0" category="cell"><block ref="86d38d6e2b36f6557e583e005e23d258" prefix="" category="inline-code"></block></block>
  <block id="d45a1a2afa30c30042b28f028fe75953" category="cell"><block ref="915be14765d6133923d803e1221f1513" prefix="" category="inline-code"></block></block>
  <block id="b74f5956b4bcda2de3c82ee97e192ab6" category="paragraph">下表列出了RAC的AIX NFS挂载选项。</block>
  <block id="b547b55ba7f2a20602494777c5426eba" category="cell"><block ref="7e879bda961bd5b7d64d2ef4f5fb7869" prefix="" category="inline-code"></block></block>
  <block id="875abb256654bd3f6da7abcb1bd92f27" category="cell"><block ref="f93eecf9c582d76d4e14292dc34c79f8" prefix="" category="inline-code"></block></block>
  <block id="3ed8fb68917b28af138fb74ccde62e80" category="cell"><block ref="415e8eb8b9fc05cb48e633d31fd04944" prefix="" category="inline-code"></block></block>
  <block id="8102775fe4080f632332ab8d3312311a" category="paragraph">单实例挂载选项与RAC挂载选项之间的主要区别在于添加了<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 挂载选项。这种添加的效果是禁用主机操作系统缓存、从而使RAC集群中的所有实例都能获得一致的数据状态视图。</block>
  <block id="1e3f10dfa324520cb7261c0da5bf6ec7" category="paragraph">但使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 挂载选项和<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 参数<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 与禁用主机缓存具有相同的效果、但仍需要使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block>。<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 对于共享为必填项<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署以提高Oracle密码文件和等文件的一致性<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 参数文件。RAC集群中的每个实例都有一个专用<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，则不需要此参数。</block>
  <block id="5365dd1a92461c9e6cf65017c4a11647" category="section-title">AIX jfs/JFS2挂载选项</block>
  <block id="d7a578263480a2003f05c459a8961298" category="paragraph">下表列出了AIX jfs/jfs2挂载选项。</block>
  <block id="0aabf727ab0a83c5f5d078e8b18445e0" category="cell">默认值</block>
  <block id="e1f651debac4f720c13ae930ff3ca14a" category="cell">ORACLE_HOME</block>
  <block id="27a7ffa293f5a4d2a5bb54354486dece" category="paragraph">使用AIX之前<block ref="b7cc91287fc99a8937a55e79376c6f54" prefix=" " category="inline-code"></block> 在任何环境(包括数据库)中、设备都应检查参数<block ref="9d51746070ef554ad4e93a16de4aed0f" prefix=" " category="inline-code"></block>。此参数不是HBA队列深度、而是与各个的SCSI队列深度相关<block ref="66ad66c6ace8456eae4ca6807552e54b" prefix=" " category="inline-code"></block> 可能太低、无法获得良好性能。测试表明、最佳值为64。</block>
  <block id="bb79f96acbff544ded541446c9c7c894" category="doc">Microsoft Windows</block>
  <block id="14ce2582c2080a7f08fe9249f6565f40" category="paragraph">Oracle支持将Microsoft Windows与Direct NFS客户端结合使用。此功能提供了一条实现NFS管理优势的途径、其中包括跨环境查看文件、动态调整卷大小以及利用成本较低的IP协议。有关使用DNFS在Microsoft Windows上安装和配置数据库的信息、请参见Oracle官方文档。没有特别的最佳做法。</block>
  <block id="f854b764258138b512f30be71e1c7908" category="paragraph">为了获得最佳压缩效率、请确保NTFS文件系统使用8K或更大的分配单元。使用4K分配单元(通常为默认分配单元)会对压缩效率产生负面影响。</block>
  <block id="edc9f0a5a5d57797bf68e37364743831" category="doc">Linux</block>
  <block id="dfc95ed5e895617bbd0d4b1a8bfba8ca" category="paragraph">特定于Linux操作系统的配置主题。</block>
  <block id="5ecd4a6f4aedfdd45cce80a18b1a7942" category="section-title">插槽表</block>
  <block id="2518e65e64213437c921c39a097db167" category="section-title">Linux NFS挂载选项</block>
  <block id="29cd2e6d4fc96e749c4a0e622cad7f50" category="paragraph">下表列出了单个实例的Linux NFS挂载选项。</block>
  <block id="9fafd031075cede0e8a5a796ec45fbff" category="paragraph">下表列出了RAC的Linux NFS挂载选项。</block>
  <block id="f16135915fe2ca5c3b0d660acc0325d3" category="cell"><block ref="4c927b3193f1cd00c7cfd3ac2e7ba8ea" prefix="" category="inline-code"></block></block>
  <block id="fc1ea13514277ff14dc705f62c31c0fc" category="cell"><block ref="4d0511346ac74044d79c9bc297d59b09" prefix="" category="inline-code"></block></block>
  <block id="13c64659680c0bc3603209997cc22225" category="cell">CRS/表决</block>
  <block id="672c5eef2603018159295408f761324b" category="cell"><block ref="26b20bdf0b0e7d3ddef3749a70c17932" prefix="" category="inline-code"></block></block>
  <block id="f7085c7dc406f5b44813ac43c18b80c0" category="paragraph">单实例挂载选项与RAC挂载选项之间的主要区别在于添加了<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 挂载选项。这种添加的效果是禁用主机操作系统缓存、从而使RAC集群中的所有实例都能获得一致的数据状态视图。但使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 参数<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 与禁用主机缓存具有相同的效果、但仍需要使用<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block>。</block>
  <block id="d2537738f34705bc9d100925252c0102" category="paragraph">原因<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 对于共享为必填项<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是为了提高Oracle密码文件和spfile等文件的一致性。RAC集群中的每个实例都有一个专用<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，则不需要此参数。</block>
  <block id="5084019c1051a9937b5ff77568ce579b" category="paragraph">通常、非数据库文件应使用与单实例数据文件相同的选项进行挂载、但特定应用程序可能具有不同的要求。避免使用挂载选项<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 如果可能、因为这些选项会禁用文件系统级预读和缓冲。这可能会发生原因为提取、转换和加载等过程带来严重的性能问题。</block>
  <block id="243de27c01fea05cc58186d2e5ad1ce5" category="section-title">access和getattr</block>
  <block id="59dcf78e97c197a0f240067da57a248f" category="paragraph">一些客户注意到、极高级别的其他IOPS (如访问和getATTR)可能会主导其工作负载。在极端情况下、读取和写入等操作可能只占总数的10%。这是包含使用的任何数据库的正常行为<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 和 / 或<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 在Linux上、因为这些选项会对Linux操作系统执行发生原因操作、以便不断地从存储系统中重新加载文件元数据。访问和getattr等操作是低影响操作、可通过数据库环境中的ONTAP缓存进行处理。不应将其视为真正的IOPS、例如读取和写入、因为它们会对存储系统产生真正的需求。但是、其他这些IOPS确实会产生一些负载、尤其是在RAC环境中。要解决这种情况、请启用DNFS、它会绕过操作系统缓冲区缓存并避免执行这些不必要的元数据操作。</block>
  <block id="041f371e212c70407e145ae9f752a8b4" category="section-title">Linux Direct NFS</block>
  <block id="dd2f3f344f14ae5daf12cb0a817a72e0" category="paragraph">一个额外的挂载选项、称为<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block>如果(a)启用了DNFS、并且(b)在单个服务器上多次挂载源卷(c)并使用嵌套NFS挂载、则需要使用此选项。此配置主要出现在支持SAP应用程序的环境中。例如、NetApp系统上的单个卷的目录可能位于<block ref="9f9f4ccb1fc3afcbfe0cc3f5eac4332c" prefix=" " category="inline-code"></block> 然后、再按<block ref="ac2f9bbcd397d8f6b39e6713658051ea" prefix=" " category="inline-code"></block>。条件<block ref="9f9f4ccb1fc3afcbfe0cc3f5eac4332c" prefix=" " category="inline-code"></block> 挂载于<block ref="9ad16912cc0ba54a259b1a15d233c264" prefix=" " category="inline-code"></block> 和<block ref="ac2f9bbcd397d8f6b39e6713658051ea" prefix=" " category="inline-code"></block> 挂载于<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>的结果是来自同一源的嵌套NFS挂载。</block>
  <block id="14dd7af30f62ec838445a1e167d2aff6" category="section-title">Linux Direct NFS和Oracle RAC</block>
  <block id="c6a209e4ad702c6424efb7d63d76feca" category="paragraph">使用DNFS对于Linux操作系统上的Oracle RAC具有特殊的性能优势、因为Linux没有强制执行直接I/O的方法、而RAC需要执行直接I/O才能在节点间保持一致。作为临时解决策、Linux需要使用<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 挂载选项、此选项会导致操作系统缓存中的文件数据立即过期。而此选项又会强制Linux NFS客户端不断重新读取属性数据、从而会损害延迟并增加存储控制器上的负载。</block>
  <block id="3070cb366c38db327b0cf057d63792c1" category="paragraph">启用DNFS会绕过主机NFS客户端并避免这种损坏。多家客户报告说、在启用DNFS时、RAC集群的性能显著提高、ONTAP负载显著降低(尤其是与其他IOPS相关的负载)。</block>
  <block id="e97ab7f94d503bbec4b013b5b77118c6" category="section-title">Linux Direct NFS和oranfstab文件</block>
  <block id="f63255b70940d25581e0cf5f81dd6cd6" category="paragraph">如果在Linux上使用DNFS和多路径选项、则必须使用多个子网。在其他操作系统上、可以使用建立多个DNFS通道<block ref="54b4c4075463b2e02cd69f5cd139b5b2" prefix=" " category="inline-code"></block> 和<block ref="bbf52a1a57a4eaa83512cab68fd52b70" prefix=" " category="inline-code"></block> 用于在一个子网上配置多个DNFS通道的选项。但是、这在Linux上不能正常工作、可能会导致意外的性能问题。在Linux中、用于DNFS流量的每个NIC都必须位于不同的子网上。</block>
  <block id="6c5cf31ca1af553b1f4a9b99e3cb054c" category="section-title">I/O计划程序</block>
  <block id="49bb1f5f4810e5f3d32dac84bd96005d" category="paragraph">Linux内核允许对块设备的I/O计划方式进行低级控制。各种Linux发行版的默认值差别很大。测试表明、截止日期通常会获得最佳结果、但NOOP有时会稍好一些。性能差异极小、但如果需要从数据库配置中提取尽可能高的性能、请同时测试这两个选项。CFQ是许多配置中的默认设置、它已证明数据库工作负载存在严重的性能问题。</block>
  <block id="38f25b8840d56fc601af1024115764b2" category="paragraph">有关配置I/O计划程序的说明、请参见相关的Linux供应商文档。</block>
  <block id="4150162ad42bffea7bb903b4c7a4ffd9" category="section-title">多路径</block>
  <block id="305482bf1c318f0a9a04f94987db06b2" category="paragraph">某些客户在网络中断期间遇到崩溃、因为多路径守护进程未在其系统上运行。在最新版本的Linux上、操作系统和多路径守护进程的安装过程可能会使这些操作系统容易受到此问题的影响。软件包安装正确、但未配置为在重新启动后自动启动。</block>
  <block id="6fb0bf499bef576f56e0fd6360eba0a6" category="paragraph">例如、RHEL5.5上的多路径守护进程的默认设置可能如下所示：</block>
  <block id="31026ba0b77cbe4c9d44ed6afc859ed6" category="paragraph">可使用以下命令更正此问题：</block>
  <block id="c759a9b7e4db09da8a25fb73d256f6b7" category="section-title">ASM镜像</block>
  <block id="f2f41836b42c08199948378b4a4a6e26" category="paragraph">ASM 镜像可能需要更改 Linux 多路径设置，以使 ASM 能够识别问题并切换到备用故障组。ONTAP 上的大多数 ASM 配置都使用外部冗余，这意味着数据保护由外部阵列提供，并且 ASM 不会镜像数据。某些站点使用正常冗余的 ASM 来提供双向镜像，通常在不同站点之间进行镜像。</block>
  <block id="25f47751ccd5df99e3c25a8eb2a21fc5" category="inline-link-macro">NetApp主机实用程序文档</block>
  <block id="066a79b72a430b074cdc0476b67bbde3" category="paragraph">中显示的Linux设置 <block ref="210658f6fe0d0061c73c19a9a6b263d1" category="inline-link-macro-rx"></block> 包括导致I/O无限期排队的多路径参数这意味着、没有活动路径的LUN设备上的I/O会根据需要等待I/O完成。这通常是可取的、因为Linux主机会根据需要等待很长时间、以便SAN路径更改完成、FC交换机重新启动或存储系统完成故障转移。</block>
  <block id="184ea23c04f24d03fc0123bc6eb30de2" category="paragraph">这种无限制排队行为会导致ASM镜像出现问题、因为ASM必须收到I/O故障、才能在备用LUN上重试I/O。</block>
  <block id="5616945ee545765b51d3fe1871cff4ec" category="paragraph">在Linux中设置以下参数<block ref="9ac80d53ede05256c28cf9e043eb423c" prefix=" " category="inline-code"></block> 用于ASM镜像的ASM LUN文件：</block>
  <block id="49af3bbe0c557480960d217b217502ff" category="paragraph">这些设置会为ASM设备创建120秒超时。超时计算为<block ref="e2f0125c5971e1ce714f86f145386ee3" prefix=" " category="inline-code"></block> *<block ref="9434de34302b4f40887a7277cf35a8fc" prefix=" " category="inline-code"></block> 以秒为单位。在某些情况下、可能需要调整确切的值、但120秒的超时时间对于大多数使用来说应该足以满足要求。具体来说、120秒应允许控制器接管或恢复发生、而不会产生会导致故障组脱机的I/O错误。</block>
  <block id="dbff1dc161f3f1d61258259b3a0b549c" category="paragraph">a较低<block ref="9434de34302b4f40887a7277cf35a8fc" prefix=" " category="inline-code"></block> 值可以缩短ASM切换到备用故障组所需的时间、但这也会增加在控制器接管等维护活动期间发生不必要故障转移的风险。可以通过仔细监控ASM镜像状态来缓解此风险。如果发生不必要的故障转移、并且重新同步执行速度相对较快、则可以快速重新同步镜像。对于追加信息、请参见有关使用的Oracle软件版本的ASM快速镜像重新同步的Oracle文档。</block>
  <block id="ec0b68df6b5a0fdd6d73ac710b9684da" category="section-title">Linux xfs、ext3和ext4挂载选项</block>
  <block id="278230e4238d02fcb49850454e7d79e0" category="admonition">* NetApp建议*使用默认挂载选项。</block>
  <block id="02a5a4d50c5112bb31ff9c94f5b47ce9" category="paragraph">许多基于ONTAP的Oracle客户使用以太网、即NFS、iSCSI、NVMe/TCP的网络协议、尤其是云。</block>
  <block id="8a1870adbe8a237106c32d72660a9c42" category="summary">Oracle数据库的逻辑接口设计</block>
  <block id="f46a94d438563c03413adfec27c6bfda" category="paragraph">Oracle数据库需要访问存储。逻辑接口(Logical Interface、Logical Interface、Logical Interface)是将Storage Virtual Machine (SVM)连接到网络并进而连接到数据库的网络管道。要确保每个数据库工作负载都有足够的带宽、并且故障转移不会导致存储服务丢失、需要正确的LIF设计。</block>
  <block id="f445528d334d486a14570735705e2223" category="summary">适用于Oracle数据库的FC网络配置</block>
  <block id="92cdde4ecc529b9f9379ed2bdb6aae34" category="paragraph">为Oracle数据库配置FC SAN主要是遵循日常SAN最佳实践。</block>
  <block id="9eaca569c6f5ca3388f5613da3aa008c" category="doc">基于ONTAP的Oracle数据库</block>
  <block id="528b35962f1679204260ddef6800eece" category="paragraph">ONTAP专为Oracle数据库而设计。几十年来、ONTAP针对关系数据库I/O的独特需求进行了优化、并专门为满足Oracle数据库的需求而创建了多种ONTAP功能、甚至是应Oracle Inc.本身的要求也是如此。</block>
  <block id="c9f8ef2db64ce19b15d2cc98fbd3d24c" category="admonition">本文档将取代以前发布的技术报告_TR-3633：《基于ONTAP的Oracle数据库》；TR-4591：《Oracle数据保护：备份、恢复、复制》；TR-4592：《基于MetroCluster的Oracle》；以及TR-4534：《将Oracle数据库迁移到NetApp存储系统》_</block>
  <block id="b42ad0517ef7394f97178fb9e1de8d78" category="paragraph">除了ONTAP为数据库环境带来价值的多种可能方式之外、还有各种各样的用户要求、包括数据库大小、性能要求和数据保护需求。NetApp存储的已知部署包括从在VMware ESX下运行的大约6、000个数据库的虚拟化环境到当前大小为996 TB且在不断增长的单实例数据仓库等所有内容。因此、在NetApp存储上配置Oracle数据库的明确最佳实践很少。</block>
  <block id="7bf0493f27e81fe4c3740e773e137a48" category="paragraph">在NetApp存储上运行Oracle数据库的要求可通过两种方式来满足。首先、当存在明确的最佳实践时、我们将专门予以说明。概括地说、我们将根据Oracle存储解决方案架构师的特定业务需求来说明他们必须考虑的许多设计注意事项。</block>
  <block id="633d94718c25247da5772ed6f2b244c9" category="summary">Oracle存储迁移简介</block>
  <block id="08beeb11d62fd51ef2742eae3ee3719f" category="admonition">本文档将取代先前发布的技术报告_TR-4534：《将Oracle数据库迁移到NetApp存储系统》_</block>
  <block id="5f2a4190824fd64be3c8cabeb7dc62ff" category="paragraph">对于新的数据库项目、这不是问题、因为数据库和应用程序环境已构建到位。但是、迁移在业务中断、完成迁移所需的时间、所需的技能组合以及风险最小化方面带来了特殊挑战。</block>
  <block id="a83f1ca5ad00b39773d9e6a26b0e70b2" category="section-title">脚本</block>
  <block id="08293bec81c296b61f4a751175d9caa7" category="paragraph">本文档提供了示例脚本。这些脚本提供了一些示例方法、用于自动执行各个方面的迁移、以降低出现用户错误的几率。这些脚本可以降低对负责迁移的IT人员的总体需求、并加快整个过程。这些脚本全部取自NetApp专业服务和NetApp合作伙伴执行的实际迁移项目。本文档通篇展示了这些参数的用法示例。</block>
  <block id="c28b52826242c7cdffe5f3ae1e917f61" category="paragraph">由于需要更改FC网络配置、外部LUN导入期间不可避免地会发生某些中断。但是、中断的持续时间不必比重新启动数据库环境并更新FC分区以将主机FC连接从外部LUN切换到ONTAP所需的时间长。</block>
  <block id="a2248459756ffc1877beb9b39c77668b" category="paragraph">此过程可概括如下：</block>
  <block id="c9f77905e39abbada6c73a7a3d5f51f8" category="list-text">将外部LUN上的所有LUN活动置于静噪状态。</block>
  <block id="cff6e7c6c4f8dd7e57a0286f28712c58" category="list-text">将主机FC连接重定向到新的ONTAP系统。</block>
  <block id="9fea842823b73e1eb32307ab325f170e" category="list-text">触发导入过程。</block>
  <block id="df814ea2bf92d4f18e72a648e93103a2" category="list-text">重新发现LUN。</block>
  <block id="030a5009bbe6fb141ca5863ab6c59464" category="list-text">重新启动数据库。</block>
  <block id="f3bb22d18791c042e889671ad1963239" category="paragraph">您无需等待迁移过程完成。给定LUN的迁移开始后、该LUN便可在ONTAP上使用、并可在数据复制过程继续期间提供数据。所有读取都会传递到外部LUN、所有写入都会同步写入到两个阵列。复制操作速度非常快、重定向FC流量的开销也非常小、因此对性能的任何影响都应该是瞬时的、并且最小化。如果有问题、您可以延迟重新启动环境、直到迁移过程完成并删除导入关系之后。</block>
  <block id="b19e17ab765f91aa0bc0e7152f13779f" category="section-title">关闭数据库</block>
  <block id="2869cd69e0fec20ba28a42e74afef158" category="paragraph">在此示例中、静音环境的第一步是关闭数据库。</block>
  <block id="e20dab0880a91f5da2ea05170177576d" category="section-title">关闭网格服务</block>
  <block id="89c458e5176d6caf0690f1e61ecb0620" category="paragraph">要迁移的基于SAN的文件系统之一还包括Oracle ASM服务。暂停底层LUN需要卸载文件系统、这反过来意味着停止此文件系统上具有已打开文件的所有进程。</block>
  <block id="49f05bf7da4eacfa4c80bb987443eb5a" category="section-title">卸载文件系统</block>
  <block id="c5a09ac3ff0bb25c97951c7b7f815cd0" category="paragraph">如果所有进程均已关闭、则卸载操作将成功。如果权限被拒绝、则文件系统上必须存在一个具有锁定的进程。。<block ref="ace112f9725b6fa0b702e6b3970b2102" prefix=" " category="inline-code"></block> 命令有助于识别这些进程。</block>
  <block id="765e13ffc3361a9fd6c6088b2603ffbf" category="section-title">停用卷组</block>
  <block id="907e5f35f70dc2f5e4b67da56381bdf4" category="paragraph">卸载给定卷组中的所有文件系统后、可以停用该卷组。</block>
  <block id="ad80f935ccd133a802189e3c2f4421d7" category="section-title">FC网络更改</block>
  <block id="a497da6790d9ab4bb5cce3d04b0efd2e" category="paragraph">现在、可以更新FC分区、以删除主机对外部阵列的所有访问权限、并建立对ONTAP的访问权限。</block>
  <block id="3ef31115a10790468ad841ec2cdf566f" category="section-title">启动导入过程</block>
  <block id="5bc309ef1913ddc70534a0a7135ba938" category="paragraph">要启动LUN导入过程、请运行<block ref="76ffc50817aa4cd6214aa0061339fdf6" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="0a10f1ad4a0b45d384c5771ec0906c4c" category="section-title">监控导入进度</block>
  <block id="9a3a7545f4a7407ec022c4b2271e0c34" category="paragraph">可以使用监控导入操作<block ref="1ab15ef2c245a4434fcea3cc3149f4f4" prefix=" " category="inline-code"></block> 命令：如下图所示、所有20个LUN的导入正在进行中、这意味着现在可以通过ONTAP访问数据、即使数据复制操作仍在进行。</block>
  <block id="d36f98c8a305e33483232e7b5cd90c49" category="inline-link-macro">外部LUN导入—完成</block>
  <block id="a9c97f84ee4958d39ed989b3da7ed0ba" category="paragraph">如果需要联机迁移、请继续在新主目录中重新发现LUN并启动服务。</block>
  <block id="d0369936c6fe8c292874e3bc647893b8" category="section-title">扫描SCSI设备更改</block>
  <block id="6d338faddede649cab4c5b498e8e4379" category="paragraph">在大多数情况下、重新发现新LUN的最简单方法是重新启动主机。这样做会自动删除旧的陈旧设备、正确发现所有新LUN并构建关联的设备、例如多路径设备。此处的示例显示了一个完全联机的流程、用于演示目的。</block>
  <block id="3b493a859f19779c1f7db7d1951785ee" category="paragraph">注意：重新启动主机之前、请确保中的所有条目都已启用<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 此参考迁移的SAN资源已被注释掉。如果不执行此操作、并且LUN访问出现问题、则操作系统可能无法启动。这种情况不会损坏数据。但是、启动到救援模式或类似模式并更正可能会非常不方便<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 以便可以启动操作系统以启用故障排除。</block>
  <block id="9d7b16568eb7edb80492b49cb02d7663" category="paragraph">可以使用重新扫描此示例中使用的Linux版本上的LUN<block ref="b6f75508bf2af141e9de6f862662661e" prefix=" " category="inline-code"></block> 命令：如果命令成功、则输出中应显示每个LUN路径。输出可能难以解释、但如果分区和igrop配置正确、则应显示许多LUN包含<block ref="971c047750d8e3b03c71d24020b3816f" prefix=" " category="inline-code"></block> 供应商字符串。</block>
  <block id="3384aa7c090758ad18028832967b143f" category="section-title">检查多路径设备</block>
  <block id="07a39d42e6d8cc61e0a880e43b83e2a3" category="paragraph">LUN发现过程还会触发多路径设备的重新创建、但已知Linux多路径驱动程序偶尔会出现问题。的输出<block ref="eeb30d005cab1d8c69785a3cd5818f55" prefix=" " category="inline-code"></block> 应进行检查、以验证输出是否如预期。例如、以下输出显示了与关联的多路径设备<block ref="971c047750d8e3b03c71d24020b3816f" prefix=" " category="inline-code"></block> 供应商字符串。每个设备都有四个路径、其中两个路径的优先级为50、两个路径的优先级为10。尽管不同版本的Linux的确切输出可能会有所不同、但此输出看起来与预期一致。</block>
  <block id="efd921479c3d57448954050760c568ca" category="admonition">请参考用于验证的Linux版本的Host Utilities文档<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 设置正确。</block>
  <block id="28751dc1e914a778d11ca0e69613690b" category="section-title">重新激活LVM卷组</block>
  <block id="a66a38e4056f28a310ef6d1fa8bbcc77" category="paragraph">如果已正确发现LVM LUN、则<block ref="5239f542d8edbc4b528b1f362153c0c7" prefix=" " category="inline-code"></block> 命令应成功。这是一个很好的逻辑卷管理器价值示例。更改LUN的WWN甚至序列号并不重要、因为卷组元数据会写入LUN本身。</block>
  <block id="1d374f8de5ba1b82ab4407b8c6efbd0d" category="paragraph">操作系统扫描了LUN、发现写入LUN上的少量数据、将其标识为属于的物理卷<block ref="83b7788c8e4de444d6cd4c69978eaf32" prefix=" " category="inline-code"></block>。然后构建所有必需的设备。只需重新激活卷组即可。</block>
  <block id="1f0285a57b2357507c3b77ce5130b548" category="section-title">重新挂载文件系统</block>
  <block id="a9047d68dc7e99f553b71590cff301d6" category="paragraph">重新激活卷组后、可以在挂载文件系统时保持所有原始数据完好无损。如前文所述、即使数据复制在后端组中仍处于活动状态、文件系统也能完全正常运行。</block>
  <block id="a787d65e2525ac6bc3a6328efe383b5c" category="section-title">重新扫描ASM设备</block>
  <block id="a25bb20f07ed95a633f623678855e8dc" category="paragraph">重新扫描SCSI设备时、应已重新发现ASMlib设备。可以通过重新启动ASMlib并扫描磁盘来联机验证重新发现。</block>
  <block id="37fb12a52b4a5371c12209e89e09b04f" category="admonition">此步骤仅与使用ASMlib的ASM配置相关。</block>
  <block id="6de48f39063d81d53fd0ff3e9938af13" category="paragraph">注意：如果未使用ASMlib、则为<block ref="9c9f766701f811ef6f170c7a3453c53f" prefix=" " category="inline-code"></block> 设备应已自动重新创建。但是、权限可能不正确。如果没有ASMlib、则必须在底层设备上为ASM设置特殊权限。通常通过任一中的特殊条目来完成此操作<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 或<block ref="ab775c875d5f89d991a670444dd32ad2" prefix=" " category="inline-code"></block> 规则、或者可能同时位于这两个规则集中。可能需要更新这些文件、以反映环境中的WWN或序列号变化、从而确保ASM设备仍具有正确的权限。</block>
  <block id="08b33d6af4ec78f99dbbc3533589aafc" category="paragraph">在此示例中、重新启动ASMlib并扫描磁盘会显示与原始环境相同的10个ASM LUN。</block>
  <block id="17c4ae76000d9a79a56195071665af32" category="section-title">重新启动网格服务</block>
  <block id="e8c3dc00e15826e3b77a2d41d7fde92a" category="paragraph">现在LVM和ASM设备已联机且可用、可以重新启动网格服务。</block>
  <block id="934317e45581988a01f54761705ca58a" category="section-title">重新启动数据库</block>
  <block id="41475a737e947d73c674b90e78e246a0" category="paragraph">重新启动网格服务后、可以启动数据库。在尝试启动数据库之前、可能需要等待几分钟、以便ASM服务完全可用。</block>
  <block id="b171714b39ad4102aced4daceef8c678" category="paragraph">从主机角度来看、迁移已完成、但仍会从外部阵列提供I/O、直到删除导入关系为止。</block>
  <block id="f708d001227724fa0a8a3d57aacedb1a" category="paragraph">在删除关系之前、必须确认所有LUN的迁移过程均已完成。</block>
  <block id="85cf20229bc9008553794abdaed507f5" category="section-title">删除导入关系</block>
  <block id="b23ec325eb9c6278cb36e4c45c2c3499" category="paragraph">迁移过程完成后、删除此迁移关系。完成此操作后、I/O将专门从ONTAP上的驱动器提供。</block>
  <block id="40b98b0023a7eea7c432c29e3c44ba7d" category="section-title">取消注册外部LUN</block>
  <block id="5ccc14ae93ba94bd4183439a9f80f6c8" category="paragraph">最后、修改磁盘以删除<block ref="96ea0e5f46787e93e2970a086b47fdb6" prefix=" " category="inline-code"></block> 名称。</block>
  <block id="875bb561ba851d301052704e0ffb70f4" category="summary">通过日志传送实现Oracle迁移</block>
  <block id="e0f9c3b73fe5700df95f30eb98ca4034" category="doc">Oracle日志传送</block>
  <block id="8e42b5809657e127c7e2d24f30bc493e" category="paragraph">使用日志传送进行迁移的目标是、在新位置创建原始数据文件的副本、然后建立将更改传送到新环境的方法。</block>
  <block id="599df5f564506c95624dd78b0b75eeac" category="paragraph">建立日志后、可以自动进行日志传输和重放、以使副本数据库与源数据库大致保持同步。例如、可以计划cron作业：(a)将最新日志复制到新位置、(b)每15分钟重放一次。这样做可以最大程度地减少转换时的中断、因为回写的归档日志不能超过15分钟。</block>
  <block id="41bec1b4ddc17b3367c68a025c0ddfb9" category="paragraph">下面显示的操作步骤本质上也是一个数据库克隆操作。显示的逻辑类似于NetApp SnapManager for Oracle (SMO)和NetApp SnapCenter Oracle插件中的引擎。某些客户已使用脚本或WFA工作流中显示的操作步骤执行自定义克隆操作。虽然此操作步骤比使用SMO或SnapCenter更需要手动操作、但仍可随时编写脚本、ONTAP中的数据管理API进一步简化了此过程。</block>
  <block id="f0616883a5ca70aa97676de436a7fb9e" category="section-title">日志传送-文件系统到文件系统</block>
  <block id="8f922b64f0bc64f6bba1d555a61ee3bb" category="paragraph">此示例演示了将名为waffle的数据库从普通文件系统迁移到位于不同服务器上的另一个普通文件系统的过程。同时、还展示了如何使用SnapMirror快速复制数据文件、但这并不是整个操作步骤不可或缺的一部分。</block>
  <block id="60100e1b826a4b972fc113c391f932e7" category="section-title">创建数据库备份</block>
  <block id="80cf34e10dcfbc5e76c6b2f845f2708d" category="paragraph">第一步是创建数据库备份。具体来说、此操作步骤需要一组数据文件、可用于归档日志重放。</block>
  <block id="0ba29c6a1afacf586b03a26162c72274" category="section-title">environment</block>
  <block id="744a73803cdac4a5067725ca5814a2cf" category="section-title">还原到新环境</block>
  <block id="46228bb2ce31b0d397faad2b805e8a37" category="paragraph">现在、必须在新环境中还原备份。这可以通过多种方式实现、包括Oracle RMAN、从备份应用程序(如NetBackup)还原、或者对处于热备份模式的数据文件执行简单的复制操作。</block>
  <block id="1f255556546f1fdfb53692e41f35eb6c" category="list-text">创建新卷以接收快照数据。从初始化镜像<block ref="937e9fa808ccfe9a4f6b004a2a7caada" prefix=" " category="inline-code"></block> to<block ref="96f9dacb3cb1b1f6f9b4ad02992a1a0e" prefix=" " category="inline-code"></block>。</block>
  <block id="5b1944ec8c0ed933e5b2ea2e3e5fa76e" category="list-text">在SnapMirror设置状态(指示同步已完成)后、请根据所需的快照专门更新镜像。</block>
  <block id="f4d90c6c29b1f76ab9c87a9996c9751e" category="list-text">可以通过查看来验证同步是否成功<block ref="31952c255e722053d4cc3f82921e95db" prefix=" " category="inline-code"></block> 字段。</block>
  <block id="0934c3fcad3065c2a479125e4a80b259" category="list-text">然后、可以断开镜像。</block>
  <block id="fcf1f505b94151a36eba8e1563e7176f" category="list-text">挂载新文件系统。对于基于块的文件系统、具体过程因使用的LVM而异。必须配置FC分区或iSCSI连接。与LUN建立连接后、可以使用Linux等命令<block ref="302c49bbd5bcda5463eb5130804effc1" prefix=" " category="inline-code"></block> 可能需要查找哪些卷组或LUN需要正确配置才能被ASM发现。</block>
  <block id="20c4d1d4163c2463cf15ff7df6424459" category="paragraph">在此示例中、使用的是简单的NFS文件系统。可以直接挂载此文件系统。</block>
  <block id="b2dd88a1f03a5fb4c2e3c0d46f425161" category="section-title">创建控制文件创建模板</block>
  <block id="1c30e11140f1d0a1093bedee34eef1e4" category="paragraph">接下来必须创建控制文件模板。。<block ref="3177841b2335a6640ea3054199830f1c" prefix=" " category="inline-code"></block> 命令用于创建文本命令以重新创建控制文件。在某些情况下、此功能对于从备份还原数据库非常有用、并且通常与执行数据库克隆等任务的脚本结合使用。</block>
  <block id="3f51d58ec72b9d36cb5e0636525130b5" category="list-text">以下命令的输出用于为迁移的数据库重新创建控制文件。</block>
  <block id="cb395c3bf18fd427287caecc9b28058a" category="list-text">创建控制文件后，将文件复制到新服务器。</block>
  <block id="cf5c9046a3617a19c0ccc24e4cf54a33" category="section-title">备份参数文件</block>
  <block id="0d1d1a7db58f3f93ec977733f4909f5d" category="paragraph">在新环境中、还需要一个参数文件。最简单的方法是从当前的spfile或pfile创建一个pfile。在此示例中、源数据库使用的是spfile。</block>
  <block id="051a634cb1e9a53dbf139214e1d24001" category="section-title">创建oratab条目</block>
  <block id="2dabc26c8b55d44e25a184ba2624eed0" category="paragraph">要使oraenv等实用程序正常运行、必须创建oratab条目。要创建oratab条目、请完成以下步骤。</block>
  <block id="87ef75141d237e3b44e8310aad8fcf19" category="section-title">准备目录结构</block>
  <block id="12f833c44c11e6bbd970cc126bce2bcb" category="paragraph">如果所需目录不存在、则必须创建它们、否则数据库启动操作步骤将失败。要准备目录结构、请满足以下最低要求。</block>
  <block id="60225c364a012796a6d886e8cf4ec486" category="section-title">参数文件更新</block>
  <block id="e36ee2d9a95a6b672917862d714af383" category="list-text">要将参数文件复制到新服务器、请运行以下命令。默认位置为<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目录。在这种情况下、pfile可以放置在任何位置。它仅用作迁移过程中的中间步骤。</block>
  <block id="d437a40a59905247cfb39cf9dc9da256" category="list-text">根据需要编辑文件。例如、如果归档日志位置已更改、则必须更改pfile以反映新位置。在此示例中、仅重新定位控制文件、部分目的是在日志和数据文件系统之间分布控制文件。</block>
  <block id="55cc35656c3d28c1b3267c246b397521" category="list-text">编辑完成后、根据此pfile创建一个spfile。</block>
  <block id="a833a03e6af0b969524dcccb8f296f1c" category="section-title">重新创建控制文件</block>
  <block id="74a636ee3a009f08cd5623dc8066dd09" category="paragraph">在上一步中、是的输出<block ref="3177841b2335a6640ea3054199830f1c" prefix=" " category="inline-code"></block> 已复制到新服务器。所需输出的具体部分是<block ref="0ca1fba455d799b9a1cc2440b9ba7043" prefix=" " category="inline-code"></block> 命令：此信息可在标记的部分下的文件中找到<block ref="9fb76d62be749cec8bdd06f46c77bf5b" prefix=" " category="inline-code"></block>。它从行开始<block ref="13ac20c4a96b2ecfd703e831ad722907" prefix=" " category="inline-code"></block> 并应包含该词<block ref="c3c62948f78a7ccaabb9ef2eea80a895" prefix=" " category="inline-code"></block>。以分号(;)字符结尾。</block>
  <block id="bf4b2a006646a8e77166a2a596425074" category="list-text">在此示例操作步骤中、该文件如下所示。</block>
  <block id="a9a27c002ec883341220e267712250a7" category="list-text">根据需要编辑此脚本、以反映各种文件的新位置。例如、某些已知支持高I/O的数据文件可能会重定向到高性能存储层上的文件系统。在其他情况下、更改可能纯粹出于管理员原因、例如、将给定PDB的数据文件隔离到专用卷中。</block>
  <block id="2540fb1670d4f9ee8a704a7eb8d748fe" category="list-text">在此示例中、将显示<block ref="b86df74c6982de8dec7509d039294d7a" prefix=" " category="inline-code"></block> 虽然保持不变、但重做日志会移动到中的新位置<block ref="96bb85ed0fe822778c4e5a821e991ad8" prefix=" " category="inline-code"></block> 而不是与归档登录共享空间<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block>。</block>
  <block id="8d47ad079859f2976fdc7ebf742f768d" category="paragraph">如果任何文件放错位置或参数配置错误、则会生成错误、指示必须修复的问题。数据库已挂载、但尚未打开、无法打开、因为正在使用的数据文件仍标记为处于热备份模式。必须先应用归档日志、以使数据库保持一致。</block>
  <block id="6b7c2d588ac708b58f7ac889090608f6" category="section-title">初始日志复制</block>
  <block id="2db2d3d6001a06d1a027904fa66bc78c" category="paragraph">要使数据文件保持一致、至少需要执行一个日志回复操作。有许多选项可用于重放日志。在某些情况下、可以通过NFS共享原始服务器上的原始归档日志位置、并且可以直接进行日志回复。在其他情况下、必须复制归档日志。</block>
  <block id="5c394e6951584d114c6706d0768e30d7" category="paragraph">例如、一个简单的<block ref="8a444a43bdf534c0c6338bb7809659b3" prefix=" " category="inline-code"></block> 此操作可以将所有当前日志从源服务器复制到迁移服务器：</block>
  <block id="5fdb3158ed28dd3aa90b94556476b781" category="section-title">初始日志重放</block>
  <block id="c2f93ef52583f81f0eba05a39483e2d8" category="paragraph">文件位于归档日志位置后、可以发出命令来重新显示它们<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block> 然后是响应<block ref="e1f2d5134ed2543d38a0de9751cf75d9" prefix=" " category="inline-code"></block> 自动重放所有可用日志。</block>
  <block id="f30a45a22256018185c5d235292e4d5e" category="paragraph">最终归档日志回复报告错误、但这是正常的。日志指示<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 正在查找特定日志文件、但未找到它。原因很可能是日志文件尚不存在。</block>
  <block id="80bea8a60412cace54760b223b2d799e" category="paragraph">如果可以在复制归档日志之前关闭源数据库、则只能执行此步骤一次。归档日志会进行复制和重做、然后、该过程可以直接继续执行转换过程、以复制关键重做日志。</block>
  <block id="1e334141582a9dcb581c9b34ef2df071" category="section-title">增量日志复制和重放</block>
  <block id="5fd2b0bf662c2b1ebdc677ea888536ce" category="paragraph">在大多数情况下、不会立即执行迁移。迁移过程可能需要几天甚至几周才能完成、这意味着必须将日志持续运送到副本数据库并进行重新显示。因此、在转换完成后、必须传输和回显示最少的数据。</block>
  <block id="0c56d82ec6857bcef5475899b9f7b5cc" category="paragraph">这样做可以通过多种方式编写脚本、但更常见的方法之一是使用rsync、这是一个常见的文件复制实用程序。使用此实用程序的最安全方法是将其配置为守护进程。例如、<block ref="b31375af035ed8a698a803a491084f61" prefix=" " category="inline-code"></block> 下面的文件显示了如何创建名为的资源<block ref="260e23541ff372b9bc53b4bd3c0c38ba" prefix=" " category="inline-code"></block> 可通过Oracle用户凭据访问并映射到<block ref="488a4921a81e36fca411e6f13cefbbf2" prefix=" " category="inline-code"></block>。最重要的是、资源设置为只读、这样可以读取生产数据、但不会对其进行更改。</block>
  <block id="eabf1b424989b2c7113ba3a538079afa" category="paragraph">以下命令将新服务器的归档日志目标与rsync资源同步<block ref="260e23541ff372b9bc53b4bd3c0c38ba" prefix=" " category="inline-code"></block> 在原始服务器上。。<block ref="e358efa489f58062f10dd7316b65649e" prefix=" " category="inline-code"></block> 中的参数<block ref="293e33723231f0504effabb52b054a31" prefix=" " category="inline-code"></block> 根据时间戳比较文件列表、并且仅复制新文件。此过程会对新服务器进行增量更新。也可以在cron中计划定期运行此命令。</block>
  <block id="c775c44069da13c8f7ee5c5116e76e36" category="inline-link-macro">重放数据库上的日志</block>
  <block id="c3bf9b2ef3e3ae2ae6a02f7f77cfcbc6" category="paragraph">收到日志后、必须对其进行重新显示。前面的示例显示了如何使用sqlplus手动运行<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block>，一个可以轻松实现自动化的过程。此处显示的示例使用中所述的脚本 <block ref="3e57a2099043fa40c58f1e0d4eed995d" category="inline-link-macro-rx"></block>。这些脚本接受一个参数、用于指定需要重放操作的数据库。这样就可以在多数据库迁移工作中使用相同的脚本。</block>
  <block id="4ea2a6c39b10b3e3076f976f58a861d1" category="section-title">转换</block>
  <block id="5de3f1ba0bbef459baa93f04f63b9ea1" category="paragraph">准备好转换到新环境后、必须执行一次最终同步、其中包括归档日志和重做日志。如果原始重做日志位置尚不已知、则可按如下方式进行标识：</block>
  <block id="677f005cc0f8be0f891df5af72fb5688" category="list-text">关闭源数据库。</block>
  <block id="41b182875e12de118d17b3432cca93fa" category="list-text">使用所需的方法在新服务器上对归档日志执行一次最终同步。</block>
  <block id="37d6d9420cef8230249e7691315f0e13" category="list-text">必须将源重做日志复制到新服务器。在此示例中、重做日志已重新定位到的新目录中<block ref="96bb85ed0fe822778c4e5a821e991ad8" prefix=" " category="inline-code"></block>。</block>
  <block id="d0a5f1380bd67b0d0fd3bc72f22d88f2" category="list-text">在此阶段、新数据库环境包含将其恢复到与源完全相同状态所需的所有文件。归档日志必须最后一次重新显示。</block>
  <block id="c2721157205b2d2e96c656c45ca72992" category="list-text">完成后、必须重做日志。如果消息<block ref="975df7a5099101ffbe47981cd1d37c2c" prefix=" " category="inline-code"></block> 将返回、此过程将成功、数据库将同步并可打开。</block>
  <block id="6acab27c5f334c66f06f3f74bc62d6d8" category="section-title">日志传送- ASM到文件系统</block>
  <block id="a67ffcc8b155bb909a6f8c5d5ba2f334" category="paragraph">此示例演示了如何使用Oracle RMAN迁移数据库。它与前面的文件系统到文件系统日志传送示例非常相似、但主机无法识别ASM上的文件。迁移ASM设备上的数据的唯一方法是重新定位ASM LUN或使用Oracle RMAN执行复制操作。</block>
  <block id="1c51600a778919f7f3abb5b25175220a" category="paragraph">虽然从Oracle ASM复制文件时需要使用RMAN、但RMAN的使用并不限于ASM。RMAN可用于从任何类型的存储迁移到任何其他类型。</block>
  <block id="2cb6a5bfc4a76f651d496cddc685e078" category="paragraph">此示例显示了将名为pancake的数据库从ASM存储重新定位到位于路径不同服务器上的常规文件系统<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 和<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block>。</block>
  <block id="d1d789c37f1c96d0a5de07798c14fcc5" category="paragraph">第一步是为要迁移到备用服务器的数据库创建备份。由于源使用Oracle ASM、因此必须使用RMAN。可以按如下所示执行简单的RMAN备份。此方法会创建一个带标记的备份、稍后可通过RMAN在操作步骤中轻松识别该备份。</block>
  <block id="ed927706d8abc2bbf3a5a8bc55e1e562" category="paragraph">第一个命令用于定义备份的目标类型以及要使用的位置。第二个选项仅启动数据文件的备份。</block>
  <block id="db85d05166dd65559ae5f426b51198e6" category="section-title">备份控制文件</block>
  <block id="a0b95d36955723a82dde7bbe40b6ccb9" category="paragraph">稍后需要在的操作步骤中为备份控制文件<block ref="08de2bfcc2d52d5bc4f3f2dcb97558ad" prefix=" " category="inline-code"></block> 操作。</block>
  <block id="76ff543de72e62217293a1d0ceade0aa" category="paragraph">在新环境中、还需要一个参数文件。最简单的方法是从当前的spfile或pfile创建一个pfile。在此示例中、源数据库使用spfile。</block>
  <block id="d28f3a5b77909b45c50e6c711bef8b60" category="section-title">ASM文件重命名脚本</block>
  <block id="c242730c760d895368557f78141ff8b1" category="paragraph">移动数据库时，控制文件中当前定义的几个文件位置会发生变化。以下脚本将创建一个RMAN脚本、以便于执行此过程。此示例显示了一个数据文件数量非常少的数据库、但数据库通常包含数百甚至数千个数据文件。</block>
  <block id="359b84bcf7447a77b212e844aeaa9d89" category="inline-link-macro">ASM到文件系统名称转换</block>
  <block id="374a1a0facd7c604ac09ed0dca6efb3e" category="paragraph">此脚本可在中找到 <block ref="288325982fd7bee6cf9eb66ad33f6f7a" category="inline-link-macro-rx"></block> 它做了两件事。</block>
  <block id="42787fdca1cf792241ce03151ec7dbd3" category="paragraph">首先、它会创建一个参数来重新定义重做日志位置、该位置称为<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block>。它本质上是一个交替字段的列表。第一个字段是当前重做日志的位置、第二个字段是新服务器上的位置。然后、重复执行此模式。</block>
  <block id="cf444fd96c87609516f0ad8212f41b01" category="paragraph">第二个功能是为数据文件重命名提供模板。该脚本循环显示数据文件、提取名称和文件编号信息、并将其格式化为RMAN脚本。然后、它会对临时文件执行相同的操作。结果是生成一个简单的RMAN脚本、可以根据需要进行编辑、以确保文件还原到所需位置。</block>
  <block id="50614366822786a4f2ee3a5065543634" category="paragraph">捕获此屏幕的输出。。<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block> 参数将按如下所述放置在pfile中。必须相应地编辑RMAN数据文件重命名和重复脚本、才能将数据文件放置在所需位置。在此示例中、它们全部置于中<block ref="36c3572e381980ee1f1343988ae4a955" prefix=" " category="inline-code"></block>。</block>
  <block id="e60cd818b9f7ae02a73d8b3a6ea0a809" category="paragraph">这些脚本几乎已准备就绪、可以执行、但首先必须设置好目录结构。如果所需目录不存在、则必须创建它们、否则数据库启动操作步骤将失败。以下示例反映了最低要求。</block>
  <block id="2f2eed2ed14ba876a017aa9ea9515724" category="paragraph">要使oraenv等实用程序正常运行、需要使用以下命令。</block>
  <block id="f34a9f7c077457a54f8838b55b9fc025" category="section-title">参数更新</block>
  <block id="fd5c3a935e7374f8b1577e73e85ef375" category="paragraph">必须更新保存的pfile、以反映新服务器上的任何路径更改。数据文件路径更改由RMAN复制脚本进行更改、几乎所有数据库都需要对进行更改<block ref="d98137bd230dac4372cf20a2e7839463" prefix=" " category="inline-code"></block> 和<block ref="2d205df7ae2efff1576140524b40b93c" prefix=" " category="inline-code"></block> parameters此外、还可能需要更改审核文件位置以及参数、例如<block ref="40f8833ae28ec69bcc89eb0eba090fe4" prefix=" " category="inline-code"></block> 在ASM之外可能不相关。经验丰富的DBA应在继续操作之前仔细查看建议的变更。</block>
  <block id="b581dd429e9b4c24127b8940ca8e4346" category="paragraph">在此示例中、主要更改包括控制文件位置、日志归档目标以及的添加<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block> 参数。</block>
  <block id="bbba1f65801697ba3abd94d90c83ba71" category="paragraph">确认新参数后、必须将这些参数生效。虽然存在多个选项、但大多数客户都会根据文本pfile创建spfile。</block>
  <block id="3a17a12678d74dabb1032aaf373166d8" category="section-title">启动非挂载</block>
  <block id="a9dc570a0b3161e69edc31f3545cbf22" category="paragraph">复制数据库前的最后一步是启动数据库进程、但不挂载文件。在此步骤中、spfile可能会出现明显问题。如果<block ref="357eedab214bb515c5622e275bc19cdb" prefix=" " category="inline-code"></block> 命令因参数错误而失败、关闭、更正pfile模板、将其重新加载为spfile并重试非常简单。</block>
  <block id="0257eff4bf9bf0cb483f2544fd42f109" category="section-title">复制数据库</block>
  <block id="4632b675c558eda129fe6da4fbbae2b2" category="paragraph">与此过程中的其他步骤相比、将先前的RMAN备份还原到新位置所需的时间更长。必须在不更改数据库ID (DBID)或不重置日志的情况下复制数据库。这样可以防止应用日志、而这是完全同步副本所必需的步骤。</block>
  <block id="06206ea0cdea741420d9f7619503db89" category="paragraph">使用在上一步中创建的脚本、使用RMAN作为aux连接到数据库、并使用问题描述the DUKATE DATABASE命令。</block>
  <block id="5ae45dfed3c4aff7fe4fd6a7e3606cb0" category="paragraph">现在、您必须将更改从源数据库发送到新位置。这样做可能需要多个步骤。最简单的方法是让源数据库上的RMAN将归档日志写出到共享网络连接。如果共享位置不可用、另一种方法是使用RMAN写入本地文件系统、然后使用rcp或rsync复制文件。</block>
  <block id="e355807335e5f05930a748afe1c3b23d" category="paragraph">在此示例中、将显示<block ref="45987b06d5eae35fc3e3487749a9ba27" prefix=" " category="inline-code"></block> 目录是一个NFS共享、可供原始数据库和迁移的数据库使用。</block>
  <block id="49fffa356bcd041918ce24ef714f3f72" category="paragraph">其中一个重要的问题描述是<block ref="6761e3b36547cd115b3966fcbc7192b2" prefix=" " category="inline-code"></block> 条款。备份的磁盘格式为<block ref="9ae0f22d9fa2eac270499e74092af364" prefix=" " category="inline-code"></block>，表示必须使用数据库的线程编号、序列号和激活ID格式。尽管字母不同、但这与匹配<block ref="03e92f2c3a8cae5315f0e42bf6acf436" prefix=" " category="inline-code"></block> 参数。此参数还以线程编号、序列号和激活ID的格式指定归档日志。最终结果是、源上的日志文件备份会采用数据库预期的命名约定。这样做会执行等操作<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 更简单、因为sqlplus可以正确地预测要回显的归档日志的名称。</block>
  <block id="76d77393c7ffc6b0a0edd47ad09afe4d" category="paragraph">文件位于归档日志位置后、可以发出命令来重新显示它们<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block> 然后是响应<block ref="e1f2d5134ed2543d38a0de9751cf75d9" prefix=" " category="inline-code"></block> 自动重放所有可用日志。参数文件当前正在将归档日志定向到<block ref="e421a42fc6f604fcc78707336ed222b9" prefix=" " category="inline-code"></block>，但这与使用RMAN保存日志的位置不匹配。在恢复数据库之前、可以按如下所示临时重定向此位置。</block>
  <block id="0a96a4559ad3ab8c616a12a207e8daca" category="paragraph">最终归档日志回复报告错误、但这是正常的。此错误指示sqlplus正在查找特定日志文件、但未找到该文件。原因很可能是日志文件尚不存在。</block>
  <block id="e2a234d3299b9e66f0756db00c9ee8c7" category="paragraph">在大多数情况下、不会立即执行迁移。迁移过程可能需要几天甚至几周时间才能完成、这意味着必须将日志持续运送到副本数据库并进行重新显示。这样可以确保在转换到达时传输和回调的数据最少。</block>
  <block id="247e1695519da78866726a4dcb2c5252" category="paragraph">可以轻松编写此过程的脚本。例如、可以在原始数据库上计划以下命令、以确保用于日志传送的位置持续更新。</block>
  <block id="3ce19ecb7c874f75b9a46e29abe2012e" category="inline-link-macro">在备用数据库上重放日志</block>
  <block id="469d3082a0f3ad08223ba8fe69bf9311" category="paragraph">收到日志后、必须对其进行重新显示。前面的示例显示了如何使用sqlplus手动运行<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block>，可以轻松实现自动化。此处显示的示例使用中所述的脚本 <block ref="7c7730292e0135c86626e1771f7f02ec" category="inline-link-macro-rx"></block>。该脚本接受一个参数、用于指定需要重放操作的数据库。此过程允许在多数据库迁移工作中使用相同的脚本。</block>
  <block id="15d3442f7626bb62f4b255c7ed5c5098" category="paragraph">准备好转换到新环境后、必须执行一次最终同步。使用常规文件系统时、可以轻松确保迁移的数据库与原始数据库100%同步、因为原始重做日志会被复制和重做。使用ASM无法实现此目的。只能轻松地重新复制归档日志。为了确保不会丢失任何数据、必须谨慎地最终关闭原始数据库。</block>
  <block id="f9952f2469fbec5fc9dca180322ff9ee" category="list-text">首先、必须将数据库静机、以确保不会进行任何更改。此暂停可能包括禁用计划的操作、关闭侦听器和/或关闭应用程序。</block>
  <block id="58fd1c52efcde7151ac264a8f67b14ff" category="list-text">执行此步骤后、大多数数据库配置协议都会创建一个虚拟表、用作关闭标记。</block>
  <block id="442da9ab2cced82a6cbdd112be285bcf" category="list-text">强制进行日志归档、以确保在归档日志中记录虚拟表的创建。为此、请运行以下命令：</block>
  <block id="83fce8a41250d6af49205f9659468351" category="list-text">要复制最后一个归档日志、请运行以下命令。数据库必须可用、但未打开。</block>
  <block id="1b0e887c1394d4617c2a5243da19e44e" category="list-text">要复制归档日志、请运行以下命令：</block>
  <block id="86a7e05acb17098c514dd570b9220302" category="list-text">最后、在新服务器上重放其余归档日志。</block>
  <block id="a430882deb5403e7b4b8061dec17cc80" category="list-text">在此阶段、复制所有数据。数据库已准备好从备用数据库转换为活动操作数据库、然后再打开。</block>
  <block id="077c7bcbf9a94bb62aecadc85045886e" category="list-text">确认是否存在假表、然后将其放下。</block>
  <block id="6130a27b8ec8ccf18e06bb3389b0fbbd" category="section-title">无中断重做日志迁移</block>
  <block id="26c294f993888218237d5f9306bfcfc4" category="paragraph">有时、除了重做日志之外、数据库整体组织正确。发生这种情况的原因有很多、其中最常见的原因是与快照有关。SnapManager for Oracle、SnapCenter和NetApp Snap Creator存储管理框架等产品可以近乎即时地恢复数据库、但前提是您还原数据文件卷的状态。如果重做日志与数据文件共享空间、则无法安全地执行还原、因为它会导致重做日志被销毁、这可能意味着数据丢失。因此、必须重新定位重做日志。</block>
  <block id="2c56f5081b94b926c93c40f4c935a44a" category="paragraph">此操作步骤非常简单、可以无干扰地执行。</block>
  <block id="2986f9fe7ed4aab5aaa64c2ee9fe4841" category="section-title">当前重做日志配置</block>
  <block id="dd786d22c88a5f1fe0c10cfec58c1b44" category="list-text">确定重做日志组的数量及其相应的组编号。</block>
  <block id="3cd0f7a32a4f5ee026702f8125f3dda7" category="list-text">输入重做日志的大小。</block>
  <block id="7c2f6ada37d59f2be0bc1a3ead80f77c" category="section-title">创建新日志</block>
  <block id="106b215e5d87fb1256e47932f2ebf9cf" category="list-text">对于每个重做日志、创建一个大小和成员数量匹配的新组。</block>
  <block id="0851b65f20b98420968e488fc3c0085e" category="list-text">验证新配置。</block>
  <block id="cbccec9e0905e0b7f5cd630a3fa12f64" category="section-title">丢弃旧日志</block>
  <block id="00f63618719701ddae7fc2ff1d406ec2" category="list-text">丢弃旧日志(组1、2和3)。</block>
  <block id="f00c8361a8acc818247282bb6420a8c1" category="list-text">如果遇到错误、导致您无法删除活动日志、请强制切换到下一个日志以释放锁定并强制执行全局检查点。请参见以下此过程的示例。删除位于旧位置的日志文件组2的尝试被拒绝、因为此日志文件中仍有活动数据。</block>
  <block id="5d49a93437a42d2926c8be7eb3c7a56f" category="list-text">日志归档后加上检查点可用于删除日志文件。</block>
  <block id="e3898c187d7edf64fc8e4d4e409fd244" category="list-text">然后从文件系统中删除日志。执行此过程时应格外小心。</block>
  <block id="dacc2a633e9981c9f91e43ac6b59e889" category="paragraph">Oracle数据迁移可在以下三个级别之一进行：数据库、主机或存储阵列。</block>
  <block id="5153193d50d4c628312db2d5bc0132ed" category="paragraph">不同之处在于、整个解决方案的哪个组件负责移动数据：数据库、主机操作系统或存储系统。</block>
  <block id="cc3e73ae592a355b9beb405232d08fe2" category="paragraph">下图显示了一个迁移级别和数据流示例。在数据库级别迁移的情况下、数据会从原始存储系统通过主机层和数据库层移动到新环境中。主机级迁移类似、但数据不会通过应用层、而是使用主机进程写入新位置。最后、对于存储级别迁移、NetApp FAS系统等阵列负责数据移动。</block>
  <block id="204415652114bfb773b51cd76c8c692e" category="paragraph"><block ref="204415652114bfb773b51cd76c8c692e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b059e0e23ffaa8fbd97f681942ce0018" category="paragraph">数据库级迁移通常是指通过备用数据库进行Oracle日志传送、以便在Oracle层完成迁移。主机级迁移可通过主机操作系统配置的本机功能来执行。此配置包括使用cp、tar和Oracle Recovery Manager (RMAN)等命令执行文件复制操作、或者使用逻辑卷管理器(LVM)重新定位文件系统的底层字节。Oracle自动存储管理(Automatic Storage Management、ASM)归类为主机级功能、因为它在数据库应用程序级别以下运行。ASM取代主机上常用的逻辑卷管理器。最后、数据可以在存储阵列级别进行迁移、这意味着可以在操作系统级别以下进行迁移。</block>
  <block id="228d9e0418aa12bae73676a5743558db" category="section-title">规划注意事项</block>
  <block id="ce7eea640cd6ee20e55cbe868f4026e9" category="paragraph">迁移的最佳选择取决于多种因素的组合、包括要迁移的环境的规模、避免停机的需求以及执行迁移所需的整体工作量。大型数据库显然需要更多的时间和精力进行迁移、但这种迁移的复杂性微乎其微。小型数据库可以快速迁移、但是、如果要迁移的数据库有数千个、工作的规模可能会带来复杂性。最后、数据库越大、越有可能成为业务关键型数据库、因此需要在保持备用路径的同时最大限度地减少停机时间。</block>
  <block id="d4b9b19593598d98059aae44d6a7bbe1" category="paragraph">此处将讨论规划迁移策略时的一些注意事项。</block>
  <block id="931c6f2c99380fbd899e3eaa31e97d98" category="section-title">数据大小</block>
  <block id="64e4d570abeebacf6bdcb19dfb73fcae" category="paragraph">要迁移的数据库的大小显然会影响迁移规划、但大小并不一定会影响转换时间。当需要迁移大量数据时、首要考虑因素是带宽。复制操作通常使用高效的顺序I/O来执行保守地估计、假设复制操作可用网络带宽的利用率为50%。例如、一个8 GB FC端口在理论上可以传输大约800 MBps。假设利用率为50%、则可以以大约400 Mbps的速率复制数据库。因此、以这种速率在大约7小时内即可复制一个10 TB的数据库。</block>
  <block id="84a80a048e7abc027dd6bdce55fda9d2" category="inline-link-macro">联机数据文件移动</block>
  <block id="1c169b76761527b28040655a783e50a2" category="section-title">数据库计数</block>
  <block id="da3770c5d6d1215e9f2524b9d7b7c3c5" category="paragraph">在许多情况下、移动大量数据的问题不在于数据大小、而在于支持数据库的配置的复杂性。仅仅知道必须迁移50 TB的数据库是不够的。它可以是一个50 TB的任务关键型数据库、4、000个原有数据库的集合、也可以是生产数据和非生产数据的混合。在某些情况下、大部分数据都由源数据库的克隆组成。这些克隆根本不需要迁移、因为它们可以轻松地重新创建、尤其是在新架构设计为利用NetApp FlexClone卷时。</block>
  <block id="a1739e745a7544d2432b2b990a715817" category="paragraph">对于迁移规划、您必须了解范围内有多少数据库以及必须如何确定这些数据库的优先级。随着数据库数量的增加、堆栈中的首选迁移选项往往会越来越少。例如、使用RMAN可以轻松复制单个数据库、但会短暂中断。这是主机级复制。</block>
  <block id="284723d6a05b50ace5e5b96c761d03ac" category="paragraph">如果有50个数据库、则可能更容易避免设置新的文件系统结构来接收RMAN副本并将数据移动到位。可以通过利用基于主机的LVM迁移将数据从旧LUN重新定位到新LUN来完成此过程。这样、数据库管理员(Database Administrator、DBA)团队就会将职责移交给操作系统团队、因此、数据会相对于数据库透明地进行迁移。文件系统配置保持不变。</block>
  <block id="8e734da04d394519001f47f723341e9d" category="paragraph">最后、如果必须迁移200个服务器中的500个数据库、则可以使用ONTAP外部LUN导入(FLI)功能等基于存储的选项来直接迁移LUN。</block>
  <block id="39f43935349622951e0f392c83b6e736" category="section-title">重新架构要求</block>
  <block id="50f1558a3f9d47464b5d57f9d9d0f9d1" category="paragraph">通常、必须更改数据库文件布局才能利用新存储阵列的功能；但是、情况并非总是如此。例如、EF系列全闪存阵列的功能主要针对SAN性能和SAN可靠性。在大多数情况下、数据库可以迁移到EF系列阵列、而无需考虑数据布局的特殊注意事项。唯一的要求是高IOPS、低延迟和强大的可靠性。尽管存在与RAID配置或动态磁盘池等因素相关的最佳实践、但EF系列项目很少需要对整体存储架构进行任何重大更改才能利用这些功能。</block>
  <block id="0e2c78f7e9948e19ccb1bf2e1b7f0faf" category="paragraph">相比之下、迁移到ONTAP通常需要更多地考虑数据库布局、以确保最终配置实现最大价值。ONTAP本身就可以为数据库环境提供许多功能、即使不需要任何特定的架构工作也是如此。最重要的是、它能够在当前硬件达到使用寿命时无故障迁移到新硬件。一般来说、迁移到ONTAP是您最后一次需要执行的迁移。后续硬件会原位升级、数据会无中断迁移到新介质。</block>
  <block id="ad93bd21d59f2286385dc519fd7e39fb" category="paragraph">通过一些规划、可以获得更多优势。有关快照的使用、最重要的注意事项是。快照是执行近乎即时的备份、还原和克隆操作的基础。作为快照功能的一个示例、已知的最大用途是在6个控制器上的大约250个LUN上运行一个996 TB的数据库。此数据库可以在2分钟内完成备份、在2分钟内完成还原、在15分钟内完成克隆。其他优势包括：能够根据工作负载的变化在集群中移动数据、以及应用服务质量(QoS)控制、以便在多数据库环境中提供稳定一致的良好性能。</block>
  <block id="6b48ce64da84423ce167ffb72f5f9a8b" category="inline-link-macro">Oracle迁移过程概述</block>
  <block id="1311d3b592e4da5950e91965dac1d593" category="paragraph">QoS控制、数据重新定位、快照和克隆等技术几乎适用于任何配置。但是、通常需要考虑一些问题才能获得最大的益处。在某些情况下、数据库存储布局可能需要进行设计更改、才能最大程度地提高对新存储阵列的投资。此类设计更改可能会影响迁移策略、因为基于主机或基于存储的迁移会复制原始数据布局。要完成迁移并提供针对ONTAP优化的数据布局、可能还需要执行其他步骤。中所示的过程 <block ref="d4d5600aaaced44e203002ec1910822d" category="inline-link-macro-rx"></block> 之后、我们将演示一些方法、这些方法不仅可以迁移数据库、还可以轻松地将数据库迁移到最佳最终布局中。</block>
  <block id="1fd9b0a8321228b5b8ad4be85e71cf64" category="section-title">转换时间</block>
  <block id="95b9194d9f06f6f70febc87c071f3050" category="paragraph">应确定转换期间允许的最大服务中断时间。假设整个迁移过程会造成中断、这是一个常见错误。许多任务都可以在任何服务中断开始之前完成、而且许多选项都支持在不中断或中断的情况下完成迁移。即使不可避免地发生中断、您仍必须定义允许的最大服务中断、因为转换时间的持续时间因操作步骤而异操作步骤。</block>
  <block id="9cfeaf56d2fc41c2695a69adf260c3f8" category="section-title">回退路径</block>
  <block id="f493e16f7e2caba820eba88a1c5f82d8" category="paragraph">任何迁移都不是完全无风险的。即使技术运行正常、也始终存在用户错误的可能性。必须考虑与所选迁移路径相关的风险以及迁移失败的后果。例如、Oracle ASM的透明联机存储迁移功能是其主要功能之一、而这种方法是已知最可靠的方法之一。但是、使用此方法可以不可逆地复制数据。如果ASM出现问题的可能性极小、则不存在轻松的回退路径。唯一的选择是还原原始环境或使用ASM将迁移反转回原始LUN。如果原始存储系统能够执行快照类型的备份、则可以通过在该系统上执行此类操作来最大程度地降低风险、但无法消除此类风险。</block>
  <block id="1886f1ab01daa4511ce537d1af675427" category="section-title">排练</block>
  <block id="dd5dac65febd7071311b1ae3be1eca90" category="paragraph">某些迁移过程在执行前必须进行全面验证。迁移和演练转换过程是任务关键型数据库的常见要求、对于这些数据库、迁移必须成功、停机时间必须降至最低。此外、用户验收测试通常会作为迁移后工作的一部分、整个系统只有在这些测试完成后才能恢复生产。</block>
  <block id="7d06b32cdd06d27f7c62fb110d831e60" category="paragraph">如果需要预演、几项ONTAP功能可以使流程更加简单。特别是、快照可以重置测试环境、并快速为数据库环境创建多个节省空间的副本。</block>
  <block id="440a667261bd94f099ef4dde5caf024f" category="summary">迁移单个Oracle数据文件</block>
  <block id="727bb4db430517995ca651c4f57b0c9f" category="doc">数据文件移动</block>
  <block id="fade70b277397e039e100bf0faa98d8e" category="paragraph">单个Oracle数据文件只需使用一个命令即可移动。</block>
  <block id="50c3d56e93d52f122bab9de1f2b35780" category="paragraph">例如、以下命令将数据文件IOPST.dbf从文件系统中移动<block ref="87941c54be03c9785752ea54ac9a2dd4" prefix=" " category="inline-code"></block> 文件系统<block ref="eff8b2f7c4da1cf002bdea257a43fd10" prefix=" " category="inline-code"></block>。</block>
  <block id="53784088a62519d581c3dac4640c41b5" category="paragraph">使用此方法移动数据文件可能会很慢、但通常不会产生足够的I/O、以致会干扰日常数据库工作负载。相比之下、通过ASM重新平衡进行迁移的速度会快得多、但代价是在移动数据时降低整个数据库的运行速度。</block>
  <block id="f92065612dfd409585ca08d95cc7a4dc" category="paragraph">可以通过创建测试数据文件并将其移动来轻松衡量移动数据文件所需的时间。操作所用时间记录在v$session数据中：</block>
  <block id="78fb69ccdf01155db62828d0bc182b84" category="paragraph">在此示例中、移动的文件为数据文件8、该文件大小为21 GB、需要大约6分钟才能完成迁移。所需时间显然取决于存储系统的功能、存储网络以及迁移时发生的整体数据库活动。</block>
  <block id="593b763e01de37a327966ee1abb3f8a2" category="summary">使用主机端存储堆栈迁移Oracle</block>
  <block id="3dc2d5f8d7209bb75e8d67aed68bc5ed" category="paragraph">与数据库级迁移一样、在主机层进行迁移也是一种独立于存储供应商的方法。</block>
  <block id="1686ceaaa0d8fb4f9a8adb5e717b029c" category="paragraph">换言之、有时"只复制文件"是最佳选择。</block>
  <block id="d5732a4ab4c633ceb871cebdbf9ae34f" category="paragraph">虽然这种低技术方法可能看起来过于简单、但它确实具有显著优势、因为无需使用特殊软件、而且在该过程中、原始数据始终保持安全不变。主要限制是、文件复制数据迁移过程会造成系统中断、因为在复制操作开始之前、必须关闭数据库。没有好的方法可以同步文件中的更改、因此、在开始复制之前、必须完全将文件置于静状态。</block>
  <block id="706e7514bb30a289d7ce786a1a5c2ca0" category="paragraph">如果不希望执行复制操作所需的关闭操作、则基于主机的下一个最佳选项是利用逻辑卷管理器(LVM)。存在许多LVM选项、包括Oracle ASM、所有这些选项都具有相似的功能、但也有一些必须考虑的限制。在大多数情况下、可以在不发生停机和中断的情况下完成迁移。</block>
  <block id="f58e97ac8406ca3e8f0bb7a019a81985" category="section-title">文件系统到文件系统复制</block>
  <block id="a08ab728e75c63a41ce7571cb781cda2" category="paragraph">不应低估简单复制操作的有用性。此操作需要在复制过程中停机、但这是一个高度可靠的过程、无需具备有关操作系统、数据库或存储系统的专业知识。此外、它非常安全、因为它不会影响原始数据。通常、系统管理员会将要挂载的源文件系统更改为只读、然后重新启动服务器以确保任何内容都不会损坏当前数据。可以为复制过程编写脚本、以确保其尽可能快地运行、而不会出现用户错误的风险。由于I/O类型是简单的顺序数据传输、因此具有高带宽效率。</block>
  <block id="ba0bd93801872993ce832352dd03b56a" category="paragraph">以下示例演示了安全快速迁移的一个选项。</block>
  <block id="d8cb8bcd239bbe7a2a488c1d68dbe420" category="paragraph">要迁移的环境如下：</block>
  <block id="3ffbdefc66ad1d1e707c1d6820afbdc0" category="list-text">当前文件系统</block>
  <block id="bdc9e98c6b17bb14a7bce916054413ba" category="list-text">新文件系统</block>
  <block id="3b878279a04dc47d60932cb294d96259" category="section-title">概述</block>
  <block id="e76912cd513cc8cbcabc2735b524e814" category="paragraph">数据库可以由数据库管理机构进行迁移、只需关闭数据库并复制文件即可、但如果必须迁移多个数据库、或者最短的停机时间至关重要、则可以轻松编写该过程的脚本。使用脚本还可以降低用户出错的几率。</block>
  <block id="d21aae9692f3b1d4e53fd73131414b93" category="paragraph">显示的示例脚本可自动执行以下操作：</block>
  <block id="66909ae9d06bad444f5a059b8ee2cd41" category="list-text">正在关闭数据库</block>
  <block id="ae737f3f8c04ccbefa99b2bbf87dccc2" category="list-text">将现有文件系统转换为只读状态</block>
  <block id="1dd90b7b28cbd03687df6538c66ff494" category="list-text">将源文件系统中的所有数据复制到目标文件系统、从而保留所有文件权限</block>
  <block id="741341be7809d7f5765b2352e6ab0aab" category="list-text">卸载新旧文件系统</block>
  <block id="7465bc030ca3fe236bcf3ecdf8aaebe4" category="list-text">使用与先前文件系统相同的路径重新挂载新文件系统</block>
  <block id="8c4271e6faf2cea4cfc8e5b7108d8ee9" category="section-title">操作步骤</block>
  <block id="b273f8d4284bd1f58cfbafe8065af9fa" category="list-text">关闭数据库。</block>
  <block id="67eadd4b70772835f318e6d3027e4308" category="inline-link-macro">将文件系统转换为只读</block>
  <block id="474aae6515223cc3ba71074c9d5abcae" category="list-text">将文件系统转换为只读。可以使用脚本更快地完成此操作、如所示 <block ref="2d6e37849c641071fe1cf71ac348d28c" category="inline-link-macro-rx"></block>。</block>
  <block id="4879ec77723fce4974f8ae2a7f87121a" category="list-text">确认文件系统现在为只读。</block>
  <block id="c91e7f5dba3c873d0978f4892bf8b3f2" category="list-text">将文件系统内容与同步<block ref="89a4551b0f29c1a652648b1cb8747021" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="91e702884985853b8a7091ed5f2beceb" category="inline-link-macro">替换文件系统</block>
  <block id="ea27cab9fe7b891870e0ce59aa34e853" category="list-text">卸载旧文件系统并重新定位复制的数据。可以使用脚本更快地完成此操作、如所示 <block ref="fa3b775593af4f3de8972aced258710d" category="inline-link-macro-rx"></block>。</block>
  <block id="5fe2431acb45422c46eadf66a93851af" category="list-text">确认新文件系统已就位。</block>
  <block id="2d53403ab873059f92ad884eb271e8dc" category="list-text">启动数据库。</block>
  <block id="40351c33ab81b8b374a20fd292057481" category="section-title">完全自动化转换</block>
  <block id="3f70361470a11fb351c83257cd7aa63e" category="paragraph">此示例脚本接受数据库SID的参数、后跟共同分隔的文件系统对。对于上面显示的示例、命令的发出方式如下：</block>
  <block id="5cddd7b314b7ae819e2cfcac85021426" category="paragraph">执行此示例脚本时、此示例脚本将尝试执行以下序列。如果在任何步骤中遇到错误、则会终止：</block>
  <block id="43d4fce7952ee09c0c8df60a17f5ea56" category="list-text">将当前文件系统转换为只读状态。</block>
  <block id="9d53d62d1e6dc69460f47c83e6c1919d" category="list-text">使用以逗号分隔的每对文件系统参数、并将第一个文件系统同步到第二个文件系统。</block>
  <block id="39ff0e6dfa9915344ec96f9e78a27267" category="list-text">卸载先前的文件系统。</block>
  <block id="e220fa2a2806386a64e9860f27372e43" category="list-text">更新<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 文件、如下所示：</block>
  <block id="232c2c4ddd45fc028ae13b58251c5f7e" category="list-text">在创建备份<block ref="9eb56e72a6bb8350a1453c2762d14178" prefix=" " category="inline-code"></block>。</block>
  <block id="d5082ae73767550813688202df21bc4d" category="list-text">注释掉先前和新文件系统的先前条目。</block>
  <block id="b8793b424d1738f1e00e545379867b0d" category="list-text">为使用旧装载点的新文件系统创建一个新条目。</block>
  <block id="29478980f354caa483bc0cfb827c7251" category="list-text">挂载文件系统。</block>
  <block id="a0ec0d8bede7d9d58172084de7d5ce53" category="paragraph">以下文本提供了此脚本的执行示例：</block>
  <block id="350265a378d2cb1183cd51d56f0e5843" category="section-title">Oracle ASM spfile和passwd迁移</block>
  <block id="f37bc722651f2fd86ba4da87f947c4db" category="paragraph">完成涉及ASM的迁移的一个困难是ASM专用的spfile和密码文件。默认情况下、这些关键元数据文件是在定义的第一个ASM磁盘组上创建的。如果必须清空并删除特定ASM磁盘组、则必须重新定位用于管理该ASM实例的spfile和密码文件。</block>
  <block id="88e2a97e52f9854b59ce63e74c4b0cac" category="paragraph">可能需要重新定位这些文件的另一个用例是在部署数据库管理软件(如SnapManager for Oracle或SnapCenter Oracle插件)期间。这些产品的功能之一是、通过还原托管数据文件的ASM LUN的状态来快速还原数据库。执行此操作需要先使ASM磁盘组脱机、然后再执行还原。只要给定数据库的数据文件隔离在专用ASM磁盘组中、就不会出现此问题。</block>
  <block id="24de04443b6bdae76336fcab04ae946c" category="paragraph">如果该磁盘组还包含ASM spfile/passwd文件、则使该磁盘组脱机的唯一方法是关闭整个ASM实例。此过程会造成系统中断、这意味着需要重新定位spfile/passwd文件。</block>
  <block id="a6221bf4332cc966c69066295a843480" category="list-text">数据库SID = TOAST</block>
  <block id="0af0da2831407b8130e7f2fabdfab87d" category="list-text">上的当前数据文件<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block></block>
  <block id="24aa2824a0b52b46b301afdb3af9336f" category="list-text">上的当前日志文件和控制文件<block ref="ad6062251d172504e3b3bed3a8256a5a" prefix=" " category="inline-code"></block></block>
  <block id="bb6de9ea84381f7d01fdd038f104e4ae" category="list-text">新的ASM磁盘组建立为<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block> 和<block ref="5e20ccf28224fc0cc564f9825c208dbd" prefix=" " category="inline-code"></block></block>
  <block id="8b14bd9d310bf8b211c19645576201e3" category="section-title">ASM spfile/passwd文件位置</block>
  <block id="7c7d8dd5d09a73f06678562b66dcdc68" category="paragraph">可以无系统地重新定位这些文件。但是、为了安全起见、NetApp建议关闭数据库环境、以便确保文件已重新定位、并且配置已正确更新。如果服务器上存在多个ASM实例、则必须重复执行此操作步骤。</block>
  <block id="3666b74ddcf77306328ac5d6db94fecd" category="section-title">确定ASM实例</block>
  <block id="9d19a85576af8e1b3dbd78e343a2b022" category="paragraph">根据中记录的数据确定ASM实例<block ref="9da4474b569071bcb2ece1d0bdfe7560" prefix=" " category="inline-code"></block> 文件ASM实例用+符号表示。</block>
  <block id="3fe2dd8cf6f82ac15544fd96f9b59b28" category="paragraph">此服务器上有一个名为+ASM的ASM实例。</block>
  <block id="35a557b0490d5a93931025eaaf712cac" category="section-title">确保所有数据库均已关闭</block>
  <block id="e6b0819ae1eca7d408a097efc2fbf2cf" category="paragraph">唯一可见的SMON进程应该是正在使用的ASM实例的SMON。如果存在另一个SMON进程、则表示数据库仍在运行。</block>
  <block id="97639c779a60f010af01997e2363f4eb" category="paragraph">唯一的SMON进程是ASM实例本身。这意味着没有其他数据库在运行、并且可以安全地继续运行、而不会造成数据库操作中断的风险。</block>
  <block id="a8d157790e55d19378ddbbdfeb675ef8" category="section-title">找到文件</block>
  <block id="12d8c982eb4072e31ac4bfe375193160" category="paragraph">使用确定ASM spfile和密码文件的当前位置<block ref="e258dbf5114b4df07f0d9e72deb386f2" prefix=" " category="inline-code"></block> 和<block ref="bb41cdf6c9bb75ee17856f938070f23d" prefix=" " category="inline-code"></block> 命令</block>
  <block id="bebe64e9d0d4ae3d44b4dfb3583e0109" category="paragraph">这两个文件都位于的底部<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 磁盘组。</block>
  <block id="558f28628ba8ab4cb8420949524832d3" category="section-title">复制文件</block>
  <block id="c0c2c850cb11c5bb52abbd55a9578e54" category="paragraph">使用将文件复制到新的ASM磁盘组<block ref="c0baea639672c84505e661b9e369c68a" prefix=" " category="inline-code"></block> 和<block ref="c7adee97d05083a7b65e4b6953045177" prefix=" " category="inline-code"></block> 命令如果新磁盘组是最近创建的、并且当前为空、则可能需要先挂载它。</block>
  <block id="3ed2faf3e1299edd7d92d6c4064f1579" category="paragraph">文件现在已从复制<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> to<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block>。</block>
  <block id="1dba5fc559232a8dae45d9f88ed36030" category="section-title">更新ASM实例</block>
  <block id="1fe2cc6cf436a4bcc6bdc41f947a416a" category="paragraph">现在、必须更新ASM实例以反映位置更改。。<block ref="c8b1affa9ec15d0c0e79347905e75d3e" prefix=" " category="inline-code"></block> 和<block ref="73fb08020d8535b4123a8968c596038c" prefix=" " category="inline-code"></block> 命令用于更新启动ASM磁盘组所需的ASM元数据。</block>
  <block id="626759f91a0458b0c068cce8a05a6468" category="section-title">使用更新的文件激活ASM</block>
  <block id="69f08287c6faa04381e5a05f4087abe1" category="paragraph">此时、ASM实例仍会使用这些文件的先前位置。必须重新启动实例、才能强制从文件的新位置重新查看这些文件、并释放对先前文件的锁定。</block>
  <block id="5505cf0c514193b89221f1cef3004c58" category="section-title">删除旧的spfile和密码文件</block>
  <block id="8f2d3ac58be7a91f51d7ce9ffa04e397" category="paragraph">如果已成功执行操作步骤、则先前的文件将不再锁定、现在可以删除。</block>
  <block id="cfca2b2eb0d694e70904ec82f5d1c34e" category="section-title">Oracle ASM到ASM副本</block>
  <block id="12632d520b8d9518b5622ac00dc764a8" category="paragraph">Oracle ASM本质上是一个轻型组合卷管理器和文件系统。由于文件系统不易显示、因此必须使用RMAN执行复制操作。虽然基于副本的迁移过程既安全又简单、但会造成一些中断。可以最大限度地减少中断、但不能完全消除中断。</block>
  <block id="152106ebb2aaa94cc87657d353331189" category="paragraph">如果您希望无中断迁移基于ASM的数据库、最佳选择是利用ASM的功能、在删除旧LUN的同时、将ASM块区重新平衡到新LUN。这样做通常是安全的、不会造成操作中断、但不会提供回退路径。如果遇到功能或性能问题、唯一的选择是将数据迁移回源。</block>
  <block id="81fe23a1ac3b2bb348e579b2c5b0f5d5" category="paragraph">可以通过将数据库复制到新位置而不是移动数据来避免此风险、从而使原始数据保持不变。数据库可以在上线之前在其新位置进行全面测试、如果发现问题、原始数据库可作为回退选项使用。</block>
  <block id="3028182db088e823770b3d02aa0eac9e" category="paragraph">此操作步骤是涉及RMAN的许多选项之一。它支持一个分两步进行的过程、即创建初始备份、然后通过日志重放进行同步。为了最大限度地减少停机时间、需要使用此过程、因为它可以使数据库在初始基线复制期间保持正常运行并提供数据。</block>
  <block id="634f50a6c6f112c46150a301d749dbcb" category="section-title">复制数据库</block>
  <block id="5f0bd85dd65afab1472713e8e034fff7" category="paragraph">Oracle RMAN会为当前位于ASM磁盘组上的源数据库创建一个级别0 (完整)副本<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 到上的新位置<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block>。</block>
  <block id="b51dc519efad4b151a05682b68f4b182" category="section-title">强制执行归档日志切换</block>
  <block id="10793485747151dfa2eaddb0854c84b2" category="paragraph">您必须强制执行归档日志切换、以确保归档日志包含使副本完全一致所需的所有数据。如果不使用此命令、重做日志中可能仍会显示关键数据。</block>
  <block id="c55a88a6b8fdc5972d4e2a4924f93dbf" category="section-title">关闭源数据库</block>
  <block id="9ec82bff06c706f42a8170befdd6cf39" category="paragraph">此步骤会导致中断、因为数据库已关闭并置于访问受限的只读模式。要关闭源数据库、请运行以下命令：</block>
  <block id="6ecf02e1343e82cf0cd95d7303346ff1" category="section-title">控制文件备份</block>
  <block id="e7bc82f6d1381df55ace121dc02368e6" category="paragraph">如果必须中止迁移并还原到原始存储位置、则必须备份控制文件。备份控制文件的副本并非100%必需、但它确实可以使将数据库文件位置重置回原始位置的过程更加轻松。</block>
  <block id="4e7a51f2c1ee60c69cd719d415f5e87a" category="paragraph">当前spfile包含对控制文件在旧ASM磁盘组中当前位置的引用。必须对其进行编辑、编辑中间的pfile版本即可轻松完成编辑。</block>
  <block id="253e30479f86461bc79f2fca58ee4cb1" category="section-title">更新pfile</block>
  <block id="35db8a54b9c7581f0f77b059233cc61b" category="paragraph">更新引用旧ASM磁盘组的所有参数、以反映新ASM磁盘组名称。然后保存更新后的pfile。确保<block ref="5fa1d01559c04dcdb3ba05775712b1ab" prefix=" " category="inline-code"></block> 参数存在。</block>
  <block id="bb607fbd46f48c3a4080ecda83288b69" category="paragraph">在以下示例中、引用了<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 已更改为<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block> 以黄色突出显示。两个关键参数是<block ref="5fa1d01559c04dcdb3ba05775712b1ab" prefix=" " category="inline-code"></block> 用于在正确位置创建任何新文件的参数。</block>
  <block id="5275e85db4d606621d8f074e44b95748" category="section-title">更新init.ora文件</block>
  <block id="17a2b5d1af48f7f8d1511d5372896f7a" category="paragraph">大多数基于ASM的数据库都使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 文件位于中<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目录、即指向ASM磁盘组上的spfile。此文件必须重定向到新ASM磁盘组上的某个位置。</block>
  <block id="6ad274256421918b584abff3b9446b09" category="paragraph">按如下所示更改此文件：</block>
  <block id="b6638505615764c377e2cf2585993fd0" category="section-title">重新创建参数文件</block>
  <block id="52b21c2e6103a3b8d888a4185e21a787" category="paragraph">现在、可以使用已编辑的pfile中的数据填充spfile。</block>
  <block id="37f4738eddd35e77d15af55a40e1ab1c" category="section-title">启动数据库以开始使用新的spfile</block>
  <block id="79f8a930424fe3b21dc30a72791171d4" category="paragraph">启动数据库、确保它现在使用新创建的spfile、并正确记录对系统参数所做的任何进一步更改。</block>
  <block id="231ef0ea12d142611eeea2fdfad67114" category="section-title">还原控制文件</block>
  <block id="33cdbbeabc7f2c647f20b3f8b924307f" category="paragraph">RMAN还可以将RMAN创建的备份控制文件直接还原到新spfile中指定的位置。</block>
  <block id="ce656b7f351ebdc7c599aff6a99e0f2a" category="paragraph">挂载数据库并验证新控制文件的使用情况。</block>
  <block id="fda1e79fe400519496075b7e2871092a" category="section-title">日志重放</block>
  <block id="daaec4441f16b5bac11476d4582a296c" category="paragraph">数据库当前使用旧位置的数据文件。在使用副本之前、必须对其进行同步。初始复制过程经过了一段时间、所做的更改主要记录在归档日志中。这些更改复制如下：</block>
  <block id="fca6726270a94f51cab3142509d32919" category="list-text">执行包含归档日志的RMAN增量备份。</block>
  <block id="8b8a5667b011b5f37163ff4da1004343" category="list-text">重放日志。</block>
  <block id="a9a62e70841c4d06dd16306a85700d36" category="section-title">激活</block>
  <block id="8fecb0145484a35b1d9d5926c945ca30" category="paragraph">恢复的控制文件仍引用原始位置的数据文件、并且还包含复制的数据文件的路径信息。</block>
  <block id="f590db5fdc10f6942f7cd173c0bb578b" category="list-text">要更改活动数据文件、请运行<block ref="7705ebb59373d0b1dfc71d86ef726f93" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="2c5c2b5174eafe321358329636e80f5e" category="paragraph">活动数据文件现在是复制的数据文件、但最终重做日志中可能仍包含更改。</block>
  <block id="fe83c5826bec1aa20e26802fa94a4a0f" category="list-text">要重放所有剩余日志、请运行<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 命令：如果消息<block ref="cef3519da39a73834e89a18ca91951f1" prefix=" " category="inline-code"></block> 显示、表示此过程已成功。</block>
  <block id="15434ad90ad32205a804fe96f265b91d" category="paragraph">此过程仅更改了普通数据文件的位置。临时数据文件必须重命名、但不需要复制、因为它们只是临时文件。数据库当前已关闭、因此临时数据文件中没有活动数据。</block>
  <block id="2a7c5560f8e4ad220c853666c46eb051" category="list-text">要重新定位临时数据文件、请首先确定其位置。</block>
  <block id="10b2632cf9c3bf6568b36f6a37e627c2" category="list-text">使用RMAN命令为每个数据文件设置新名称来重新定位临时数据文件。使用Oracle Managed Files (OMF)时、无需完整名称；ASM磁盘组就足够了。打开数据库后、OMF会链接到ASM磁盘组上的相应位置。要重新定位文件、请运行以下命令：</block>
  <block id="2c592b1e2841899b280deafe27eeefbf" category="section-title">重做日志迁移</block>
  <block id="3f53598059c3bf11ff505ad9dc0d6776" category="paragraph">迁移过程已接近完成、但重做日志仍位于原始ASM磁盘组上。重做日志无法直接重新定位。相反、系统会创建一组新的重做日志并将其添加到配置中、然后是一组旧日志。</block>
  <block id="d54f1c98a924385411a8488657b21dad" category="list-text">对于每个重做日志、使用匹配的配置创建一个新组。如果不使用OMF、则必须指定完整路径。此示例也使用<block ref="c9655c773db3ebd5871fbe76c0e38a52" prefix=" " category="inline-code"></block> parameters如前所示、此参数设置为+NEWLOGS。通过此配置、您可以使用以下命令创建新的联机日志、而无需指定文件位置、甚至无需指定特定ASM磁盘组。</block>
  <block id="3e0c7c8ee841e9919343fe45e3e04f2d" category="list-text">打开数据库。</block>
  <block id="7e4b38db083a404d0d628bdb1ad83311" category="list-text">丢弃旧日志。</block>
  <block id="37e48dd687a01e58ed329feebebf3198" category="list-text">如果遇到错误、导致您无法删除活动日志、请强制切换到下一个日志以释放锁定并强制执行全局检查点。下面显示了一个示例。删除位于旧位置的日志文件组3的尝试被拒绝、因为此日志文件中仍有活动数据。通过检查点后的日志归档、您可以删除日志文件。</block>
  <block id="79d08abfbe5fd73dc85c55cd20ad4974" category="list-text">查看环境以确保所有基于位置的参数均已更新。</block>
  <block id="799f5ce04f1d9cad4455676b2fd908d9" category="list-text">以下脚本演示了如何简化此过程：</block>
  <block id="9867dfc0eee2725f24f86d8114c356a0" category="list-text">如果ASM磁盘组已完全清空、则现在可以使用卸载这些磁盘组<block ref="ae709dc3414219bf2c9c8abc9ff6c67a" prefix=" " category="inline-code"></block>。但是、在许多情况下、属于其他数据库的文件或ASM spfile/passwd文件可能仍存在。</block>
  <block id="49f8dc5754bd205ea0da17521cb89a1f" category="section-title">Oracle ASM到文件系统的副本</block>
  <block id="0f5b1767a58e43cb548226e94441dc07" category="paragraph">Oracle ASM到文件系统副本操作步骤与ASM到ASM副本操作步骤非常相似、但具有类似的优势和限制。主要区别在于使用可见文件系统时与使用ASM磁盘组时不同命令和配置参数的语法。</block>
  <block id="b533404c568b600f9fceddeac9253964" category="paragraph">Oracle RMAN用于为当前位于ASM磁盘组上的源数据库创建级别0 (完整)副本<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 到上的新位置<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block>。</block>
  <block id="f78b0ab71e2863c28dbe331056451135" category="paragraph">要确保归档日志包含使副本完全一致所需的所有数据、需要强制执行归档日志开关。如果不使用此命令、重做日志中可能仍会显示关键数据。要强制执行归档日志切换、请运行以下命令：</block>
  <block id="c37c761fc28428b9ead4533aba9ee148" category="paragraph">此步骤会导致中断、因为数据库已关闭并置于访问受限的只读模式。要关闭源数据库、请运行以下命令：</block>
  <block id="3abd8870d8a333edcaec6a1082520c67" category="paragraph">备份控制文件、以防您必须中止迁移并还原到原始存储位置。备份控制文件的副本并非100%必需、但它确实可以使将数据库文件位置重置回原始位置的过程更加轻松。</block>
  <block id="38825215f02e25ca63ff64387b01c1c2" category="paragraph">应更新引用旧ASM磁盘组的任何参数、在某些情况下、如果这些参数不再相关、则应将其删除。更新它们以反映新的文件系统路径并保存更新后的pfile。确保列出了完整的目标路径。要更新这些参数、请运行以下命令：</block>
  <block id="9d0dce3e570fa0ec18269ca508809401" category="section-title">禁用原始init.ora文件</block>
  <block id="03dda6526778417460fd0bbb7716b373" category="paragraph">此文件位于中<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目录中、通常位于一个pfile中、用作指向ASM磁盘组上spfile的指针。要确保原始spfile不再使用、请对其重命名。但是、请勿将其删除、因为如果必须中止迁移、则需要此文件。</block>
  <block id="6087f741090627369fd114fbc794abc4" category="paragraph">这是spfile重新定位的最后一步。不再使用原始spfile、数据库当前已使用中间文件启动(但未挂载)。此文件的内容可以按如下所示写出到新的spfile位置：</block>
  <block id="3f62847435205b7b2af1bd5aaf1d3277" category="paragraph">您必须启动数据库以释放中间文件上的锁定、并仅使用新的spfile文件启动数据库。启动数据库还可以证明新的spfile位置正确且其数据有效。</block>
  <block id="ea164abfd83078cd71a2f3ba5d237900" category="paragraph">在路径上创建了一个备份控制文件<block ref="7a1a1280501cff0194d8ce6e351f2a2c" prefix=" " category="inline-code"></block> 在操作步骤中的早期版本。新的spfile将控制文件位置定义为 <block ref="b4d54c88ccade13a82dcaf8f7c07cac5" prefix="/" category="inline-code"></block> 和<block ref="cd300fb0386526438b368e7a6d1b8ace" prefix=" " category="inline-code"></block>。但是、这些文件尚不存在。</block>
  <block id="f7ed72e578ca8d23dd45bfa2c0a61ed8" category="list-text">此命令会将控制文件数据还原到spfile中定义的路径。</block>
  <block id="c947c89cb4c7a595782d0be73bbe8cfa" category="list-text">问题描述挂载命令、以便正确发现控制文件并包含有效数据。</block>
  <block id="da4ae71a31a1286600968f8a340fddb2" category="paragraph">以验证<block ref="d98137bd230dac4372cf20a2e7839463" prefix=" " category="inline-code"></block> 参数中、运行以下命令：</block>
  <block id="c25a81770c591c46d6909aae84bf5814" category="paragraph">数据库当前正在使用旧位置的数据文件。必须先同步数据文件、然后才能使用副本。初始复制过程经过了一段时间、所做的更改主要记录在归档日志中。这些更改将通过以下两个步骤进行复制。</block>
  <block id="95ea23a5654037c0ab2a5418478d9da2" category="list-text">重放日志。</block>
  <block id="e726fdb8508ef59abc6d8ef533186382" category="list-text">要更改活动数据文件、请运行<block ref="7705ebb59373d0b1dfc71d86ef726f93" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="7fdba4cfea0e0d298cda23e7f46e40c4" category="list-text">尽管数据文件应完全一致、但要重放联机重做日志中记录的其余更改、需要执行最后一步。使用<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 命令以重放这些更改并使副本与原始副本完全相同。但是、该副本尚未打开。</block>
  <block id="8eb94d53286760da56ca9c892a49cd8b" category="section-title">重新定位临时数据文件</block>
  <block id="a1e7f15bee0eaa976661307aa884fd99" category="list-text">确定原始磁盘组上仍在使用的临时数据文件的位置。</block>
  <block id="89b79c94ceba42d5bc646c1b4b1acd24" category="list-text">要重新定位数据文件、请运行以下命令。如果存在许多临时文件、请使用文本编辑器创建RMAN命令、然后将其剪切并粘贴。</block>
  <block id="81aa65cb154a5f125bbf3ede064d4b3f" category="paragraph">迁移过程已接近完成、但重做日志仍位于原始ASM磁盘组上。重做日志无法直接重新定位。相反、系统会创建一组新的重做日志并将其添加到配置中、然后删除旧日志。</block>
  <block id="6e46687c6cc5deabe53fa42932683c4d" category="list-text">对于每个重做日志、使用与当前重做日志组相同的大小并使用新文件系统位置创建一个新组。</block>
  <block id="22fd48a866ce4d04edb57c15b2fad5da" category="list-text">删除仍位于先前存储上的旧日志文件组。</block>
  <block id="94158400e59555bf69ecd550887bd9f6" category="list-text">如果遇到阻止删除活动日志的错误、请强制切换到下一个日志以释放锁定并强制执行全局检查点。下面显示了一个示例。删除位于旧位置的日志文件组3的尝试被拒绝、因为此日志文件中仍有活动数据。日志归档后加上检查点可以删除日志文件。</block>
  <block id="326770a786c5933416b6a167c854e7b8" category="list-text">以下脚本演示了如何简化此过程。</block>
  <block id="ffdcdc8ee9653232a906773fa11358fd" category="list-text">如果ASM磁盘组已完全清空、则现在可以使用卸载这些磁盘组<block ref="ae709dc3414219bf2c9c8abc9ff6c67a" prefix=" " category="inline-code"></block>。在许多情况下、仍然存在属于其他数据库的文件或ASM spfile/passwd文件。</block>
  <block id="3d8b8f4734039817e35d5fb6993c8d08" category="section-title">数据文件清理操作步骤</block>
  <block id="637607e2203ac522fc9dbc88deb6c36f" category="inline-link-macro">ASM迁移清理</block>
  <block id="18325b8b206963bc1ae6cca25406f942" category="paragraph">迁移过程可能会导致数据文件的语法较长或比较隐秘、具体取决于Oracle RMAN的使用方式。在此处显示的示例中、备份是使用的文件格式执行的<block ref="1da91ad80bcfeb818066022a42cde773" prefix=" " category="inline-code"></block>。<block ref="432459869b7d0085e120ec9454032267" prefix=" " category="inline-code"></block> 指示RMAN应为每个数据文件创建一个默认唯一名称。结果与以下文本中所示结果类似。数据文件的传统名称嵌入在名称中。可以使用中所示的脚本化方法来清除此问题 <block ref="bf0c2c579af181f7d1e4d0267c1385fe" category="inline-link-macro-rx"></block>。</block>
  <block id="5e8488a95f83d2789417a1f3298f2f31" category="section-title">Oracle ASM重新平衡</block>
  <block id="2768938325db3a71a6713959a0f309d9" category="paragraph">如前文所述、可以通过重新平衡过程将Oracle ASM磁盘组透明地迁移到新存储系统。总之、重新平衡过程需要先向现有LUN组添加大小相等的LUN、然后再删除之前的LUN。Oracle ASM会以最佳布局自动将底层数据重新定位到新存储、然后在完成后释放旧LUN。</block>
  <block id="24a638b29b3c55f26c731aa4b9943a52" category="paragraph">迁移过程使用高效的顺序I/O、通常不会发生原因发生任何性能中断、但可以根据需要对迁移速率进行控制。</block>
  <block id="25d06b03dd002ad791b19500c58e9f72" category="section-title">确定要迁移的数据</block>
  <block id="3709d4034873467e8e6ae138da54a443" category="section-title">创建新LUN</block>
  <block id="32176bd565539329eafb96db9447e517" category="paragraph">创建大小相同的新LUN、并根据需要设置用户和组成员资格。LUN应显示为<block ref="bea4821516973214973a70aea8337c38" prefix=" " category="inline-code"></block> 磁盘。</block>
  <block id="6e59535a7b8dd239c67b8d015618f5e1" category="section-title">添加新LUN</block>
  <block id="71f7e1ff1a6e075f8364d083f145b655" category="paragraph">虽然可以同时执行添加和删除操作、但通过两个步骤添加新LUN通常更容易。首先、将新LUN添加到磁盘组。此步骤会将一半的块区从当前ASM LUN迁移到新LUN。</block>
  <block id="7989dfdf722e8bee00001dac817e4833" category="paragraph">重新平衡功率表示数据的传输速率。数量越多、数据传输的并行性就越高。迁移过程采用高效的顺序I/O操作来执行、这些操作不太可能会出现发生原因性能问题。但是、如果需要、可以使用调整正在进行的迁移的重新平衡能力<block ref="e20ea7dfbbe351f6a5275d7adc71efbd" prefix=" " category="inline-code"></block> 命令：典型迁移使用的值为5。</block>
  <block id="2b69f08c262a142b3fb0868f4d31ab4f" category="section-title">监控操作</block>
  <block id="a5097a0967c777285f74d63bf0cc26a1" category="paragraph">可以通过多种方式监控和管理重新平衡操作。在此示例中、我们使用了以下命令。</block>
  <block id="5d68829c11bdb5ae7a50b847bb126d44" category="paragraph">迁移完成后、不会报告重新平衡操作。</block>
  <block id="957310262614cddc1992368d2d0b14b3" category="section-title">丢弃旧LUN</block>
  <block id="260c16583c8eb689202ed5b4a44708b1" category="paragraph">迁移现已完成一半。可能需要执行一些基本性能测试、以确保环境运行状况良好。确认后、可以通过删除旧LUN来重新定位其余数据。请注意、这不会导致立即释放LUN。删除操作会通知Oracle ASM先重新定位块区、然后再释放LUN。</block>
  <block id="90423249814011b02ba06afd9fb2d617" category="paragraph">可以通过多种方式监控和管理重新平衡操作。在此示例中、我们使用了以下命令：</block>
  <block id="1544b3a52519b3856f1f7d1e704cb56f" category="section-title">删除旧LUN</block>
  <block id="983d704730b30910fc03d3ed444278f0" category="paragraph">在从磁盘组中删除旧LUN之前、应对标头状态执行一次最终检查。从ASM释放LUN后、该LUN不再具有列出的名称、而标头状态将列为<block ref="e2ffc99cf675f5f0f1a3456438551a9a" prefix=" " category="inline-code"></block>。这表示可以从系统中安全删除这些LUN。</block>
  <block id="22a67c375eff91d37f2363ea69b0c41f" category="section-title">LVM迁移</block>
  <block id="d52f83c78118c243801797ba9b795b72" category="paragraph">此处提供的操作步骤显示了对名为的卷组执行基于LVM的迁移的原则<block ref="ec2db4422261eae02091227fb9e53c88" prefix=" " category="inline-code"></block>。这些示例取自Linux LVM、但这些原则同样适用于AIX、HP-UX和VLVM。具体命令可能有所不同。</block>
  <block id="64a375907ede7a86c9e8a1b4b142f22e" category="list-text">确定中当前的LUN<block ref="ec2db4422261eae02091227fb9e53c88" prefix=" " category="inline-code"></block> 卷组。</block>
  <block id="0ae75856dd12545cdd98b8cad5c12ad8" category="list-text">创建物理大小相同或略大的新LUN、并将其定义为物理卷。</block>
  <block id="2426fa707e9d362c711977b79acd65bb" category="list-text">将新卷添加到卷组。</block>
  <block id="02443ebd7f86c3a688a1e3466d3f106a" category="list-text">问题描述<block ref="8167c9a6bd495f7ed235364201039099" prefix=" " category="inline-code"></block> 命令将每个当前LUN的块区重新定位到新LUN。。<block ref="1b464374742cfda0167b82bc6f9462f1" prefix=" " category="inline-code"></block> 参数用于监控操作的进度。</block>
  <block id="ce4a174d56245f6ba5b8808527919921" category="list-text">此过程完成后、使用从卷组中删除旧LUN<block ref="3a4d1e7b0af1cf3d80e419c09d238535" prefix=" " category="inline-code"></block> 命令：如果成功、现在可以从系统中安全地删除此LUN。</block>
  <block id="599a80136f745b38f35077e1c7eb020e" category="summary">Oracle迁移过程</block>
  <block id="329ffa7a9038afa62748f87628b749d5" category="paragraph">Oracle迁移数据库可以执行许多过程。选择合适的解决方案取决于您的业务需求。</block>
  <block id="48a2d08de8943e7ca4718c02e6b791b6" category="paragraph">在许多情况下、系统管理员和数据库管理员都有自己的首选方法来重新定位物理卷数据、镜像和脱机或利用Oracle RMAN复制数据。</block>
  <block id="79d01f6e7efcfef7db530c0b3c5ea516" category="paragraph">这些过程主要是为不熟悉某些可用选项的IT员工提供的指导。此外、这些过程还说明了每种迁移方法的任务、时间要求和技能要求。这样、NetApp和合作伙伴专业服务或IT管理人员等其他方就可以更充分地了解每个操作步骤的要求。</block>
  <block id="5604c71a7d9ae37df511cc85052c1894" category="paragraph">制定迁移策略没有单一的最佳实践。创建计划需要首先了解可用性选项、然后选择最适合业务需求的方法。下图显示了客户的基本注意事项和典型结论、但并非普遍适用于所有情况。</block>
  <block id="fa2e72668f7d48694bef3ba5474e3967" category="paragraph">例如、一个步骤可提高数据库总大小的问题描述。下一步取决于数据库是大于还是小于1 TB。建议的步骤就是根据典型客户实践提出的建议。大多数客户不会使用DataGuard复制小型数据库、但有些客户可能会使用。由于所需时间较长、大多数客户不会尝试复制50 TB的数据库、但有些客户可能有足够大的维护窗口来执行此类操作。</block>
  <block id="e38af1623479eee6cfe1782df43819d3" category="paragraph">Oracle 12cR1及更高版本可在数据库保持联机状态时移动数据文件。此外、它还适用于不同的文件系统类型。例如、可以将数据文件从xfs文件系统重新定位到ASM。由于需要执行的单个数据文件移动操作的数量众多、因此通常不会大规模使用此方法、但对于数据文件较少的小型数据库、这是一个值得考虑的选项。</block>
  <block id="5972a038819f045814401b2baea9ee09" category="paragraph">此外、对于迁移现有数据库的部分内容来说、只需移动数据文件是一个很好的选择。例如、活动较少的数据文件可以重新定位到更经济高效的存储、例如FabricPool卷、该卷可以将空闲块存储在对象存储中。</block>
  <block id="fcdd0d9eae6df775f1bdc52f950a0160" category="section-title">数据库级迁移</block>
  <block id="2b619622b2b8505c335acc8be3a2c3fd" category="paragraph">数据库级别的迁移意味着允许数据库重新定位数据。具体而言、这意味着日志传送。RMAN和ASM等技术是Oracle产品、但出于迁移目的、它们在主机级别运行、在主机级别复制文件和管理卷。</block>
  <block id="1048000638cc5357b8b2b36ab55cbc5a" category="section-title">日志传送</block>
  <block id="36f7294e33f88b462199b92362434684" category="paragraph">数据库级迁移的基础是Oracle归档日志、其中包含数据库更改的日志。大多数情况下、归档日志是备份和恢复策略的一部分。恢复过程首先会还原数据库、然后重播放一个或多个归档日志、以使数据库达到所需状态。这种基本技术也可用于执行迁移、操作中断极少甚至不会中断。更重要的是、此技术支持迁移、同时保持原始数据库不变、并保留一条回退路径。</block>
  <block id="d43de5ded302797939b76670bc488b51" category="paragraph">迁移过程从将数据库备份还原到二级服务器开始。您可以通过多种方式执行此操作、但大多数客户都使用其常规备份应用程序来还原数据文件。还原数据文件后、用户将建立日志传送方法。目标是为主数据库生成的归档日志创建一个持续源、并在还原的数据库中重放这些日志、以使它们接近相同的状态。转换时间到后、源数据库将完全关闭、最终归档日志(在某些情况下、重做日志)将被复制并重排。重做日志也要予以考虑、这一点非常重要、因为它们可能包含已提交的某些最终事务。</block>
  <block id="f6fc42763ddbd981d5803ee6676dc7c3" category="paragraph">在传输和回显示这些日志后、两个数据库将保持一致。此时、大多数客户都会执行一些基本测试。如果在迁移过程中发生任何错误、则日志重放应报告错误并失败。仍然建议根据已知查询或应用程序驱动型活动执行一些快速测试、以验证配置是否最佳。在关闭初始数据库之前创建一个最终测试表、以验证迁移的数据库中是否存在该表、这也是一种常见做法。此步骤可确保在最终日志同步期间不会发生任何错误。</block>
  <block id="d8e9d23b4beb4db3da15d77542782747" category="paragraph">可以针对原始数据库配置简单的日志传送迁移、这对于任务关键型数据库尤其有用。源数据库不需要更改配置、迁移环境的还原和初始配置对生产操作没有影响。配置日志传送后、它会对生产服务器提出一些I/O需求。但是、日志传送包含对归档日志的简单顺序读取、这不太可能对生产数据库性能产生任何影响。</block>
  <block id="2c31403002a9f424c6ef56460c6b3715" category="paragraph">事实证明、日志传送对于远距离、高变更率的迁移项目特别有用。在一个实例中、一个220 TB的数据库迁移到了大约500英里以外的新位置。更改率极高、而且安全限制阻止了使用网络连接。日志传送是使用磁带和信使执行的。源数据库的副本最初是使用下面概述的过程进行还原的。然后、派送员每周发送一次日志、直至转换时交付最后一组磁带并将日志应用于副本数据库。</block>
  <block id="b8efa655c4deb7af8a24fc241f8b53ff" category="section-title">Oracle DataGuard</block>
  <block id="d3165c4060fc6d19c0a6364e7c4580ee" category="paragraph">在某些情况下、需要一个完整的DataGuard环境。使用术语DataGuard来指代任何日志传送或备用数据库配置是不正确的。Oracle DataGuard是一种用于管理数据库复制的全面框架、但它不是一种复制技术。在迁移过程中、完整的DataGuard环境的主要优势是可以从一个数据库透明地切换到另一个数据库。此外、如果发现问题(例如新环境的性能或网络连接问题描述)、Dataguard还可以透明地切回原始数据库。完全配置的DataGuard环境不仅需要配置数据库层、还需要配置应用程序、以便应用程序能够检测到主数据库位置的更改。一般来说、不需要使用DataGuard完成迁移、但一些客户在内部拥有丰富的DataGuard专业知识、并已依赖它来执行迁移工作。</block>
  <block id="f17c0a1ce359c1a6665412f89234bf41" category="section-title">重新构建</block>
  <block id="ece8d784e248d63091fc0d248cdeebc3" category="paragraph">如前文所述、利用存储阵列的高级功能有时需要更改数据库布局。此外、存储协议的更改(例如从ASM迁移到NFS文件系统)也必然会更改文件系统布局。</block>
  <block id="71843fb61639ed5fe216bfebc85af16f" category="paragraph">日志传送方法(包括DataGuard)的主要优势之一是、复制目标不必与源匹配。使用日志传送方法从ASM迁移到常规文件系统时没有问题、反之亦然。可以在目标位置更改数据文件的精确布局、以优化可插拔数据库(PDB)技术的使用、或者有选择地对某些文件设置QoS控制。换言之、基于日志传送的迁移过程可让您轻松安全地优化数据库存储布局。</block>
  <block id="f00ec1b23f539163f4c748a85e49e2dd" category="section-title">服务器资源</block>
  <block id="76c5d43a72d856a95b0eed94694ae696" category="paragraph">数据库级迁移的一个限制是需要另一台服务器。可以通过两种方式使用第二台服务器：</block>
  <block id="6cb133f8b5045ef30c17e96ab281749e" category="list-text">您可以使用第二台服务器作为数据库的永久新主目录。</block>
  <block id="f5133929790fe62dbc76a73db4c88544" category="list-text">您可以使用第二个服务器作为临时暂存服务器。完成向新存储阵列的数据迁移并进行测试后、LUN或NFS文件系统将与暂存服务器断开连接、并重新连接到原始服务器。</block>
  <block id="48a00ba9881b62c610201cd833ee9c88" category="paragraph">第一种选择最简单、但在需要非常强大的服务器的超大型环境中使用它可能并不可行。第二个选项需要额外的工作才能将文件系统重新定位回原始位置。这可能是一个简单的操作、其中会使用NFS作为存储协议、因为文件系统可以从暂存服务器上卸载、然后重新挂载到原始服务器上。</block>
  <block id="c223252c2d577984b75caddbd1dff9dc" category="paragraph">基于块的文件系统需要额外的工作才能更新FC分区或iSCSI启动程序。使用大多数逻辑卷管理器(包括ASM)时、系统会自动检测LUN、并在原始服务器上提供这些LUN后将其置于联机状态。但是、某些文件系统和LVM实施可能需要更多的工作才能导出和导入数据。确切的操作步骤可能有所不同、但通常很容易建立一个简单、可重复的操作步骤来完成迁移并将数据重新归位到原始服务器上。</block>
  <block id="2d22ab8be3661ce5dfd8c9910d1cc003" category="paragraph">虽然可以在单个服务器环境中设置日志传送和复制数据库、但新实例必须具有不同的进程SID才能重放日志。可以使用不同的SID临时启动另一组进程ID下的数据库、并在以后进行更改。但是、这样做可能会导致许多复杂的管理活动、并使数据库环境面临用户错误的风险。</block>
  <block id="2660e825d3a58f68aeec49e1c749f477" category="section-title">主机级迁移</block>
  <block id="fae5bb68519bf78c1b3711566283f4ef" category="paragraph">在主机级别迁移数据意味着使用主机操作系统和相关实用程序完成迁移。此过程包括复制数据的任何实用程序、包括Oracle RMAN和Oracle ASM。</block>
  <block id="01070e0746a412afd171ccf162d3a170" category="section-title">数据复制</block>
  <block id="180e717e34d5e4bd2991c47960d00f51" category="paragraph">不应低估简单复制操作的价值。现代网络基础架构可以按每秒千兆字节的速率移动数据、文件复制操作基于高效的顺序读写I/O与日志传送相比、主机复制操作不可避免地会造成更多中断、但迁移不仅仅是数据移动。它通常包括对网络连接、数据库重新启动时间以及迁移后测试的更改。</block>
  <block id="750e04d167938f35054d1c30fd06af58" category="paragraph">复制数据所需的实际时间可能不多。此外、复制操作会保留有保障的回退路径、因为原始数据不会受到影响。如果在迁移过程中遇到任何问题、可以重新激活包含原始数据的原始文件系统。</block>
  <block id="5a3572c65171e06d99a4e055f9d35d32" category="section-title">重新平台化</block>
  <block id="d123cc133e4de7ab3a4b1a5af3bf37a7" category="paragraph">重新平台是指CPU类型的变化。将数据库从传统Solaris、AIX或HP-UX平台迁移到x86 Linux时、由于CPU架构发生更改、必须重新格式化数据。SPARC、IA64和POWER CPU称为大的恩第处理器、而x86和x86_64架构称为小恩第处理器。因此、根据所使用的处理器、Oracle数据文件中的某些数据的顺序会有所不同。</block>
  <block id="6a03806f9c4b1f0048478bab7863fd2c" category="paragraph">过去、客户一直使用DataPump跨平台复制数据。数据缓冲是一种实用程序、用于创建特殊类型的逻辑数据导出、可以在目标数据库中更快地导入。由于DataPump会为数据创建一个逻辑副本、因此会将处理器数据存储单的依赖关系置于身后。某些客户仍在使用数据缓冲区进行回滚、但Oracle 11g提供了一个速度更快的选项：跨平台可传输表空间。这种高级允许将表空间转换为不同的在位的字符格式。这是一种物理转换、其性能优于DataPump导出、DataPump导出必须先将物理字节转换为逻辑数据、然后再转换回物理字节。</block>
  <block id="713bf8ff4ea4c4ece861f3345e15e3ea" category="paragraph">有关DataPump和可传输表空间的完整讨论不在NetApp文档的讨论范围内、但NetApp根据我们在使用新CPU架构向新存储阵列日志迁移期间为客户提供帮助的经验提供了一些建议：</block>
  <block id="86b0ebca28354c7f55b4cc2fe79bee0e" category="list-text">如果正在使用DataPump、则应在测试环境中测量完成迁移所需的时间。客户有时会对完成迁移所需的时间感到惊讶。这种意外的额外停机可能会导致发生原因中断。</block>
  <block id="8a592f25a72fd6f3718b1b01869ade30" category="list-text">许多客户误以为跨平台可传输表空间不需要数据转换。如果使用具有不同ENDE的CPU、则为RMAN<block ref="31168275dcaac634489082b54c4c66d0" prefix=" " category="inline-code"></block> 必须事先对数据文件执行操作。这不是瞬时操作。在某些情况下、可以通过在不同数据文件上运行多个线程来加快转换过程、但无法避免该转换过程。</block>
  <block id="db7b3f86f4c9a2a6a76adac81614c03b" category="section-title">逻辑卷管理器驱动的迁移</block>
  <block id="86586aa50b0df80a7c68bcd3e86c8606" category="paragraph">LVM的工作原理是、创建一组LUN (由一个或多个LUN组成)并将其拆分为通常称为块区的小单元。然后、块区池将用作源、用于创建从本质上进行虚拟化的逻辑卷。此虚拟化层可通过多种方式提供价值：</block>
  <block id="68d083c44669b8b20f0421b0389c6ded" category="list-text">逻辑卷可以使用从多个LUN中绘制的块区。在逻辑卷上创建文件系统时、该文件系统可以使用所有LUN的全部性能功能。此外、它还可以均匀加载卷组中的所有LUN、从而提供更具可预测性的性能。</block>
  <block id="10d1e748082641ce33e82f457cabcbe7" category="list-text">可以通过添加和在某些情况下删除块区来调整逻辑卷的大小。在逻辑卷上调整文件系统大小通常不会造成中断。</block>
  <block id="5efed6e7bf2fda8321882aff35768721" category="list-text">通过移动底层块区、可以无干扰地迁移逻辑卷。</block>
  <block id="96371ba57b3d2f331cc9bd7b5e34708b" category="paragraph">使用LVM进行迁移的工作方式有两种：移动块区或镜像/取消块区镜像。LVM迁移使用高效的大型块顺序I/O、很少会产生任何性能问题。如果这确实成为问题描述、通常可以选择限制I/O速率。这样做不仅会增加完成迁移所需的时间、还会减轻主机和存储系统的I/O负担。</block>
  <block id="28084a93e6570f55c3923991e269816e" category="section-title">镜像和镜像</block>
  <block id="f5b05967100f74bb14ae26d5021ef4e3" category="paragraph">某些卷管理器(如AIX LVM)允许用户指定每个块区的副本数、并控制托管每个副本的设备。迁移的方法是：创建一个现有逻辑卷、将底层块区镜像到新卷、等待副本同步、然后删除旧副本。如果需要回退路径、则可以在删除镜像副本之前创建原始数据的快照。或者、也可以在强制删除包含的镜像副本之前短暂关闭服务器以屏蔽原始LUN。这样做会将数据的可恢复副本保留在其原始位置。</block>
  <block id="7151373ff69a9fafa4a579b40282beeb" category="section-title">块区迁移</block>
  <block id="682ba6adb168511d03877bdbf940a0b7" category="paragraph">几乎所有卷管理器都允许迁移块区、有时还存在多个选项。例如、某些卷管理器允许管理员将特定逻辑卷的各个块区从旧存储重新定位到新存储。Linux LVM2等卷管理器提供<block ref="8167c9a6bd495f7ed235364201039099" prefix=" " category="inline-code"></block> 命令、用于将指定LUN设备上的所有块区重新定位到新LUN。清空旧LUN后、可以将其删除。</block>
  <block id="8c232bd157fb78062260d11e1ec3fc2c" category="admonition">操作面临的主要风险是从配置中删除未使用的旧LUN。更改FC分区和删除陈旧的LUN设备时必须格外小心。</block>
  <block id="41175a8b2053bedbf868e340edf92f55" category="section-title">Oracle自动存储管理</block>
  <block id="dce3f0c1b1c85aaee6448197054602d1" category="paragraph">Oracle ASM是逻辑卷管理器和文件系统的组合。从较高层面来看、Oracle ASM会获取一组LUN、将其划分为多个小的分配单元、并将其呈现为一个称为ASM磁盘组的卷。ASM还可以通过设置冗余级别来镜像磁盘组。卷可以是未镜像(外部冗余)、镜像(正常冗余)或三向镜像(高冗余)。配置冗余级别时必须小心、因为创建后无法更改。</block>
  <block id="d0ac5c14a6207835f733f4366345089d" category="paragraph">ASM还提供文件系统功能。尽管文件系统不会直接从主机中显示、但Oracle数据库可以在ASM磁盘组上创建、移动和删除文件和目录。此外、还可以使用asmcmd实用程序来导航此结构。</block>
  <block id="e72c9da30cbec4daedddc9b6e6fdf03b" category="paragraph">与其他LVM实施方式一样、Oracle ASM通过在所有可用LUN之间对每个文件的I/O进行条带化和负载平衡来优化I/O性能。其次、可以重新定位底层块区、以便调整ASM磁盘组的大小以及进行迁移。Oracle ASM可通过重新平衡操作自动执行此过程。新的LUN将添加到ASM磁盘组、而旧的LUN将被丢弃、这将触发块区重新定位、并随后将清空的LUN从磁盘组中删除。此过程是经验证的迁移方法之一、ASM在提供透明迁移方面的可靠性可能是其最重要的功能。</block>
  <block id="d4ad443888b51ec4e13912c45da68f76" category="admonition">由于Oracle ASM的镜像级别是固定的、因此不能与镜像和镜像迁移方法结合使用。</block>
  <block id="048429277e643e20907317612c1f3318" category="section-title">存储级别迁移</block>
  <block id="623bb7ffbb3730716ea39b5086d26f18" category="paragraph">存储级别迁移是指在应用程序和操作系统级别以下执行迁移。过去、这有时意味着需要使用专用设备在网络级别复制LUN、但这些功能现在已在ONTAP本机提供。</block>
  <block id="794cb725c5631ad99b5b7c000307f0df" category="section-title">SnapMirror</block>
  <block id="963ce762febea70d619f1fd5c114d85c" category="paragraph">几乎可以使用NetApp SnapMirror数据复制软件在NetApp系统之间执行数据库迁移。此过程涉及到为要迁移的卷设置镜像关系、允许这些卷进行同步、然后等待转换窗口。到达后、源数据库将关闭、并执行一次最终镜像更新、同时镜像将断开。然后、可以通过挂载包含的NFS文件系统目录或发现包含的LUN并启动数据库来准备好使用副本卷。</block>
  <block id="1871452e5ea7e53152b5c874a12a890b" category="paragraph">在单个ONTAP集群中重新定位卷不会视为迁移、而是一项例行操作<block ref="0fc2ecb8aa71bddc595fbc39f593496a" prefix=" " category="inline-code"></block> 操作。SnapMirror用作集群中的数据复制引擎。此过程完全自动化。当卷的属性(例如LUN映射或NFS导出权限)随卷本身一起移动时、无需执行其他迁移步骤。重新定位不会中断主机操作。在某些情况下、必须更新网络访问、以确保以尽可能最高效的方式访问新重新定位的数据、但这些任务也不会造成中断。</block>
  <block id="19fee3ea4b7f4472b5c1853122e8f47b" category="section-title">外部LUN导入(FLI)</block>
  <block id="a73cf458eed5aeff5c15aa5d70298cce" category="paragraph">FLI功能允许运行8.3或更高版本的Data ONTAP系统从另一个存储阵列迁移现有LUN。操作步骤非常简单：ONTAP系统像任何其他SAN主机一样分区到现有存储阵列。然后、Data ONTAP会控制所需的原有LUN并迁移底层数据。此外、导入过程会在迁移数据时使用新卷的效率设置、这意味着可以在迁移过程中对数据进行实时压缩和重复数据删除。</block>
  <block id="0ee4b09881406835f151f103412a2f1e" category="paragraph">首次在Data ONTAP 8.3中实施FLI时、仅允许脱机迁移。虽然传输速度非常快、但这仍意味着在迁移完成之前LUN数据不可用。联机迁移是在Data ONTAP 8.3.1中推出的。此类迁移可使ONTAP在传输过程中提供LUN数据、从而最大限度地减少中断。重新分区主机以通过ONTAP使用LUN时、会发生短暂中断。但是、一旦进行了这些更改、数据就可以再次访问、并且在整个迁移过程中始终可以访问。</block>
  <block id="19d95ee75467fc2f9a06d150cc99d944" category="paragraph">读取I/O会通过ONTAP代理、直到复制操作完成、而写入I/O会同时写入外部LUN和ONTAP LUN。这两个LUN副本将以这种方式保持同步、直到管理员执行完全转换以释放外部LUN且不再复制写入。</block>
  <block id="5caad387757ca99ada41709ce30a31a5" category="paragraph">FLI可与FC结合使用、但如果需要更改为iSCSI、则迁移的LUN可以在迁移完成后轻松地重新映射为iSCSI LUN。</block>
  <block id="7fa6cfc683e0f5f9e3a79f6be14e23f4" category="paragraph">FLI的功能包括自动对齐检测和调整。在此上下文中、术语对齐是指LUN设备上的分区。要获得最佳性能、需要将I/O与4K块对齐。如果将分区放置在非4 k倍数的偏移位置、则会影响性能。</block>
  <block id="7b4ef266729f1ddfbc724cad17af4efc" category="paragraph">对齐的第二个方面无法通过调整分区偏移量(文件系统块大小)来更正。例如，ZFS文件系统通常默认为内部块大小512字节。使用AIX的其他客户偶尔会创建块大小为512字节或1、即1、即1、0 4字节的JFS2文件系统。尽管文件系统可能会与4 k边界对齐、但在该文件系统中创建的文件不会对齐、性能会受到影响。</block>
  <block id="1d6b28ed67b1d554df806b0b5a020711" category="paragraph">在这些情况下、不应使用FLI。尽管迁移后可以访问数据、但结果是文件系统存在严重的性能限制。一般来说、在ONTAP上支持随机覆盖工作负载的任何文件系统都应使用4 k块大小。这主要适用于数据库数据文件和VDI部署等工作负载。可以使用相关的主机操作系统命令来确定块大小。</block>
  <block id="4941562ef813562e0d6aaef673158b99" category="paragraph">例如、在AIX上、可以使用查看块大小<block ref="10c9a985c983a826424b496a708263ec" prefix=" " category="inline-code"></block>。使用Linux、<block ref="ba5265473f00b27178098cc38d3aef24" prefix=" " category="inline-code"></block> 和<block ref="1f8a87190704df357c64a49aee936874" prefix=" " category="inline-code"></block> 可用于<block ref="310201b6353c5f38bc039e0e51b079d3" prefix=" " category="inline-code"></block> 和<block ref="5382133ffbecb9bce9d47f2e44327b16" prefix=" " category="inline-code"></block>。使用<block ref="8cbc6ba7c8bba133ce2bc44780d88742" prefix=" " category="inline-code"></block>，则命令为<block ref="1615297782a0dff59b20451e2ca97ea7" prefix=" " category="inline-code"></block>。</block>
  <block id="033a4cb04b5225e2b7cf966f2ce16598" category="paragraph">用于控制块大小的参数为<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 通常默认为9、表示2^9或512字节。为了获得最佳性能、<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 值必须为12 (2^12=4k)。此值在创建zpool时设置、并且无法更改、这意味着数据zpool具有<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 应通过将数据复制到新创建的zpool来迁移12以外的文件。</block>
  <block id="8bd9661d8c8eb9924c62b8242191af4e" category="paragraph">Oracle ASM没有基本块大小。唯一的要求是构建ASM磁盘的分区必须正确对齐。</block>
  <block id="ea7f7e1e8119ee64585b6173afe720e8" category="section-title">7-模式过渡工具</block>
  <block id="75df51cc2f43b8dde951695f97b838c0" category="paragraph">7-模式过渡工具(7MTT)是一款自动化实用程序、用于将大型7-模式配置迁移到ONTAP。大多数数据库客户发现其他方法更容易、部分原因是他们通常会逐个数据库迁移环境数据库、而不是重新定位整个存储占用空间。此外、数据库通常只是大型存储环境的一部分。因此、数据库通常会单独迁移、然后可以使用7MTT移动其余环境。</block>
  <block id="85fd7dcbc2206c27059ae7f88712154d" category="paragraph">有少数客户拥有专用于复杂数据库环境的存储系统、但数量相当多。这些环境可能包含许多卷、快照和大量配置详细信息、例如导出权限、LUN启动程序组、用户权限和轻型目录访问协议配置。在这种情况下、7MTT的自动化功能可以简化迁移。</block>
  <block id="2c87fbdecbf0dfe299f9f89958d61085" category="paragraph">7MTT可在以下两种模式之一下运行：</block>
  <block id="dc818e71a5519d1b99c7e996cf21fd74" category="list-text">*基于副本的过渡(CBT)。*采用CBT的7MTT可在新环境中从现有7-模式系统设置SnapMirror卷。数据同步后、7MTT会编排转换过程。</block>
  <block id="453bbc96e365e25cc2d091dced3565a6" category="list-text">*无副本过渡(CFT)。*采用CFT的7MTT基于现有7-模式磁盘架的原位转换。不会复制任何数据、现有磁盘架可以重复使用。保留现有数据保护和存储效率配置。</block>
  <block id="16262236c3981cb3310b9320b5a67fd0" category="paragraph">这两种方案之间的主要区别在于、无副本过渡是一种大爆炸方法、在这种方法中、连接到原始7-模式HA对的所有磁盘架都必须重新定位到新环境。无法移动部分磁盘架。基于副本的方法允许移动选定卷。此外、无副本过渡的转换窗口可能会更长、因为重新对磁盘架进行转换和转换元数据需要关联。根据现场经验、NetApp建议留出1小时的时间来重新定位磁盘架并重新为其接通网络、而留出15分钟到2小时的时间来进行元数据转换。</block>
  <block id="795bbfbd054829fad905065087ba2d5a" category="paragraph">从数据库和主机的角度来看、不需要执行任何特殊步骤。更新FC分区并使LUN在ONTAP上可用后、LVM应能够从LUN中读取LVM元数据。此外、卷组已准备就绪、无需执行其他配置步骤。在极少数情况下、环境可能会包含使用先前存储阵列的引用进行硬编码的配置文件。例如、包含的Linux系统<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 必须更新引用给定设备的WWN的规则、以反映FLI所做的更改。</block>
  <block id="9e7ddc2ddefcd6f202fb11a82a80bc7e" category="admonition">有关支持的配置的信息、请参见NetApp兼容性列表。如果您的环境未包括在其中、请与NetApp代表联系以获得帮助。</block>
  <block id="0f5b3758229b3e28c8605b6c42398115" category="paragraph">此示例显示了Linux服务器上托管的ASM和LVM LUN的迁移。FLI在其他操作系统上受支持、尽管主机端命令可能不同、但原则相同、ONTAP过程相同。</block>
  <block id="f1036cd97e461d07351c9df32fc5948d" category="section-title">确定LVM LUN</block>
  <block id="88f7413f9621a816ee3d370703168647" category="paragraph">准备工作的第一步是确定要迁移的LUN。在此处显示的示例中、两个基于SAN的文件系统挂载在上<block ref="572f241ef88fdb17d16eba97133d861f" prefix=" " category="inline-code"></block> 和<block ref="d14bc7787c7396144583e99a7df52f67" prefix=" " category="inline-code"></block>。</block>
  <block id="ecad615a52fda392a9b7c1075d2cb2c5" category="paragraph">可以从设备名称中提取卷组的名称、该名称采用格式(卷组名称)-(逻辑卷名称)。在这种情况下、卷组称为<block ref="bb97320b8c517da828eae4ec543113db" prefix=" " category="inline-code"></block>。</block>
  <block id="b08986bb1757d5ae8de06d523c71803d" category="paragraph">。<block ref="f1e2c495108b111c930735e3a0f9a04e" prefix=" " category="inline-code"></block> 命令可按如下所示来确定支持此卷组的LUN。在这种情况下、包含10个LUN<block ref="bb97320b8c517da828eae4ec543113db" prefix=" " category="inline-code"></block> 卷组。</block>
  <block id="8b47fac6803dfff2e8d2cdad6f297cfa" category="section-title">确定ASM LUN</block>
  <block id="a23d0124954ecdbfe9d0f3aceb9e17a2" category="paragraph">此外、还必须迁移ASM LUN。要以sysasm用户身份从sqlplus获取LUN和LUN路径数、请运行以下命令：</block>
  <block id="918841992da84786f00de7c4c7d83dbf" category="paragraph">当前环境包含20个要迁移的LUN。更新当前SAN、以便ONTAP可以访问当前LUN。尚未迁移数据、但ONTAP必须从当前LUN中读取配置信息、才能为该数据创建新的主目录。</block>
  <block id="5816768a5d83977f34ffa5025c14f430" category="paragraph">至少必须将AF/FAS系统上的一个HBA端口配置为启动程序端口。此外、必须更新FC分区、以便ONTAP可以访问外部存储阵列上的LUN。某些存储阵列配置了LUN屏蔽、用于限制哪些WWN可以访问给定LUN。在这种情况下、还必须更新LUN屏蔽以授予对ONTAP WWN的访问权限。</block>
  <block id="030a992b1340f67584d67ef6230e9adf" category="paragraph">完成此步骤后、ONTAP应能够使用查看外部存储阵列<block ref="d90ba20b63acab53952d68665c50ec47" prefix=" " category="inline-code"></block> 命令：它返回的关键字段是用于标识系统上的外部LUN的前缀。在以下示例中、是外部阵列上的LUN<block ref="25103eba8d70e82b5bd837be0d2f63c4" prefix=" " category="inline-code"></block> 在ONTAP中显示、并使用前缀<block ref="6b35470d99880c4630ed3ca7b4c842e7" prefix=" " category="inline-code"></block>。</block>
  <block id="c1a0f5174323df40a8b659eb65ac5155" category="section-title">确定外部阵列</block>
  <block id="6c1b8919e2e706972b3ec48cb7f014ba" category="section-title">确定外部LUN</block>
  <block id="63841e312d3a8531331e35bd826268d1" category="paragraph">通过传递、可以列出这些LUN<block ref="907702f5103a7823393b8dd296a75c26" prefix=" " category="inline-code"></block> 到<block ref="242f4ce1948273386f8bb487bdd3732f" prefix=" " category="inline-code"></block> 命令：在迁移操作步骤期间、系统会多次引用返回的数据。</block>
  <block id="e5e94f7e2098883f0d621e064b1104f4" category="section-title">将外部阵列LUN注册为候选导入阵列</block>
  <block id="c968ec41c1c0c449b0263962966d8293" category="paragraph">外部LUN最初归类为任何特定的LUN类型。在导入数据之前、必须将LUN标记为外部LUN、从而使其成为导入过程的候选LUN。此步骤可通过将序列号传递到来完成<block ref="93c633f7fa188f1b27df574c0e5e929a" prefix=" " category="inline-code"></block> 命令、如以下示例所示。请注意、此过程仅会将LUN标记为ONTAP中的外部LUN。不会向外部LUN本身写入任何数据。</block>
  <block id="33380a523841f23815f2f83c9de1a628" category="section-title">创建卷以托管迁移的LUN</block>
  <block id="2c2ba8ca6bdd77da1da981b91a3fae4a" category="paragraph">托管迁移的LUN需要一个卷。确切的卷配置取决于利用ONTAP功能的整体计划。在此示例中、ASM LUN放置在一个卷中、而LVM LUN放置在另一个卷中。这样、您就可以将LUN作为独立的组进行管理、以实现分层、创建快照或设置QoS控制等目的。</block>
  <block id="8bc7d64e68e4be8f4908effd57293a2a" category="paragraph">设置<block ref="fb983ebeedc63d8723c0d4aa558a4c02" prefix=" " category="inline-code"></block>。迁移过程中可能会涉及大量的数据周转。因此、如果由于在快照中捕获不需要的数据而意外创建快照、则空间消耗可能会大幅增加。</block>
  <block id="8c0675d07e44f55f1f5aa6d45abe0cdb" category="section-title">创建ONTAP LUN</block>
  <block id="0b799020dac78a5e12a3d1a6400fd0c8" category="paragraph">创建卷后、必须创建新的LUN。通常、创建LUN需要用户指定LUN大小等信息、但在这种情况下、外部磁盘参数会传递到命令。因此、ONTAP会从指定序列号复制当前LUN配置数据。它还会使用LUN几何结构和分区表数据来调整LUN对齐并建立最佳性能。</block>
  <block id="5272a1dc3854f1eddc353c8073234e03" category="paragraph">在此步骤中、必须对照外部阵列交叉引用序列号、以确保正确的外部LUN与正确的新LUN匹配。</block>
  <block id="f6ee70ec9fce7bd34fa5a33d8969fb5e" category="section-title">创建导入关系</block>
  <block id="94700a911b95416221efe4064acbc2ba" category="paragraph">LUN现在已创建、但尚未配置为复制目标。在执行此步骤之前、必须先将LUN置于脱机状态。这一额外步骤旨在保护数据免受用户错误的影响。如果ONTAP允许对联机LUN执行迁移、则会存在一个风险、即因出现输入错误而可能会覆盖活动数据。强制用户首先使LUN脱机这一额外步骤有助于验证是否将正确的目标LUN用作迁移目标。</block>
  <block id="85255e52054af9c6ffd3c4e79c723a34" category="paragraph">LUN脱机后、您可以通过将外部LUN序列号传递到来建立导入关系<block ref="04c2f87857699971f5aedd525e65690a" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="8e3c921431d2b7f66fa0cc85f3ae5c9d" category="paragraph">建立所有导入关系后、可以将LUN重新置于联机状态。</block>
  <block id="ea382cbfdb353cee0cf25eaae9bba150" category="section-title">创建启动程序组</block>
  <block id="152c4728a5fb152525a639439b9d7cb9" category="inline-link-macro">协议转换</block>
  <block id="298a1c3c736859f2cfa3cb8eb1f3fdcc" category="paragraph">在此示例中、创建了一个igrop、其中包含两个WWN、分别对应于主机HBA上的两个可用端口。</block>
  <block id="4f6f03762bfcdc7174cdd30240ce45b3" category="section-title">将新LUN映射到主机</block>
  <block id="c22fee2d07a149be91ae1ae2ada1cb57" category="paragraph">创建igroup后、LUN将映射到定义的igroup。这些LUN仅可供此igrop中包含的WWN使用。在迁移过程的这一阶段、NetApp会假定主机尚未分区到ONTAP。这一点非常重要、因为如果将主机同时分区到外部阵列和新的ONTAP系统、则可能会在每个阵列上发现具有相同序列号的LUN。这种情况可能会导致多路径故障或数据损坏。</block>
  <block id="ecca392290c36269e0489c0b1cf36f50" category="summary">用于自动执行Oracle迁移操作的示例脚本</block>
  <block id="fc53c036602508ed6c2afc18e2fbdf51" category="doc">示例脚本</block>
  <block id="6f78af00b87bcad5d08c95c7b6066ad0" category="paragraph">提供的脚本是如何为各种操作系统和数据库任务编写脚本的示例。它们按原样提供。如果特定操作步骤需要支持、请联系NetApp或NetApp经销商。</block>
  <block id="3146889e40b3ca2b78c56a19178bff84" category="section-title">数据库关闭</block>
  <block id="5b98b9877c0c74dc3a3daf46cf943d3f" category="paragraph">以下Perl脚本仅使用Oracle SID的一个参数、并关闭数据库。它可以作为Oracle用户或root用户运行。</block>
  <block id="7df41a3619af59182fb5df6d1920d11a" category="section-title">数据库启动</block>
  <block id="57249fb9cdac8ddc9ea8843636c4e088" category="section-title">将文件系统转换为只读</block>
  <block id="f2977a22ba44544ca8921e2d75bce435" category="paragraph">以下脚本采用文件系统参数、并尝试卸载它、然后将其重新挂载为只读。在迁移过程中、这样做非常有用、因为在迁移过程中、文件系统必须保持可用性以复制数据、同时必须防止意外损坏。</block>
  <block id="4eac395595a8d266839db0b88fae31e4" category="section-title">替换文件系统</block>
  <block id="988d7030a130298e1641007b5b0aae20" category="paragraph">以下脚本示例用于将一个文件系统替换为另一个文件系统。由于它会编辑`/etc/fstab `文件、因此必须以root用户身份运行。它接受新旧文件系统的一个逗号分隔参数。</block>
  <block id="149c75d086adf78a50a16bcb5e349158" category="list-text">要替换文件系统、请运行以下脚本：</block>
  <block id="67a4c588434c781febb12c165c3e860a" category="paragraph">作为此脚本用法的示例、假设中的数据<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 将迁移到<block ref="27df80f143a5812bda1553d09c712efc" prefix=" " category="inline-code"></block> 和<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block> 将迁移到<block ref="1c988fc7a325635f00f9b55992128a08" prefix=" " category="inline-code"></block>。执行此任务的最简单方法之一是、使用简单的文件复制操作将新设备重新定位回原始装载点。</block>
  <block id="4a3d90c30a5e921650fe8ad0decf4827" category="list-text">假设中存在新旧文件系统<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 文件、如下所示：</block>
  <block id="4588a4e3d2f8d0f7c036f59c1be2163f" category="list-text">运行时、此脚本会卸载当前文件系统并将其替换为新的：</block>
  <block id="2d808cb44231d0a80164567e7220fc44" category="list-text">该脚本还会更新<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 相应地归档。在此处所示的示例中、它包括以下更改：</block>
  <block id="840967a448e36b9efeaacf7673f825aa" category="section-title">自动化数据库迁移</block>
  <block id="1107dd36fe8ba0c18ea8abc8734986e2" category="paragraph">此示例说明了如何使用关闭、启动和文件系统替换脚本来完全自动执行迁移。</block>
  <block id="36881541e7d9c7bced65fcac337ac327" category="section-title">显示文件位置</block>
  <block id="1e9a1acc40d4943a73e6865cdebaf560" category="paragraph">此脚本会收集大量关键数据库参数、并以易于阅读的格式打印这些参数。此脚本在查看数据布局时非常有用。此外、还可以修改此脚本以供其他用途。</block>
  <block id="6172b49b7fdf806b59af0aeef8de71e3" category="section-title">ASM迁移清理</block>
  <block id="dd8d75d6766af495b5442e67eb27d387" category="section-title">ASM到文件系统名称转换</block>
  <block id="abc3fc91423668bb4bd49e6e837fa3e4" category="section-title">重放数据库上的日志</block>
  <block id="cc7b9a518bb2532f61662a9893248133" category="paragraph">此脚本接受处于挂载模式的数据库的Oracle SID的一个参数、并尝试重放所有当前可用的归档日志。</block>
  <block id="2a5bd3a209a1ed33b81c5306780227ce" category="section-title">重放备用数据库上的日志</block>
  <block id="ea7bebed0b4151a9b28acbde55fc0eb3" category="paragraph">此脚本与前面的脚本相同、只是它是为备用数据库设计的。</block>
  <block id="2adcfd589637337984e39e94dd14ae33" category="paragraph">更改用于访问LUN的协议是一项常见要求。</block>
  <block id="38fe6838f11a6023172d11d806adbfcf" category="paragraph">在某些情况下、将数据迁移到云是整体战略的一部分。TCP/IP是云协议、从FC更改为iSCSI可以更轻松地迁移到各种云环境。在其他情况下、iSCSI可能是利用IP SAN降低的成本的理想选择。有时、迁移可能会使用不同的协议作为临时措施。例如、如果外部阵列和基于ONTAP的LUN不能同时位于同一HBA上、则可以使用iSCSI LUN足够长的时间来从旧阵列复制数据。从系统中删除旧LUN后、您可以将其转换回FC。</block>
  <block id="832c81bd0db3ad98a3804ff5ce996a58" category="paragraph">以下操作步骤演示了从FC到iSCSI的转换、但总体原则适用于从iSCSI到FC的反向转换。</block>
  <block id="e21180783b17ea695cf9275fce8a0bc7" category="section-title">安装iSCSI启动程序</block>
  <block id="0e1ddcc32a3ef636c9ca084a3d7706f5" category="paragraph">默认情况下、大多数操作系统都包含软件iSCSI启动程序、但如果未包含、则可以轻松安装。</block>
  <block id="289fe013df899f5f74fb362d4efcdd5d" category="section-title">确定iSCSI启动程序名称</block>
  <block id="8242e97b190184a6c7b8ec96c5662886" category="paragraph">在安装过程中会生成一个唯一的iSCSI启动程序名称。在Linux上、它位于中<block ref="22565a44e8f73044eb2029acbb069639" prefix=" " category="inline-code"></block> 文件此名称用于标识IP SAN上的主机。</block>
  <block id="721a96eb0b922b337fa815839839b328" category="section-title">创建新启动程序组</block>
  <block id="cda1311d977b7b77ad3aebe4a813b3bd" category="paragraph">启动程序组(igroGroup)是ONTAP LUN屏蔽架构的一部分。除非先授予主机访问权限、否则无法访问新创建的LUN。完成此步骤的方法是创建一个igrop、其中列出了需要访问的FC WWN或iSCSI启动程序名称。</block>
  <block id="6548788f050643897f7354b6df4488db" category="paragraph">在此示例中、创建了一个igrop、其中包含Linux主机的iSCSI启动程序。</block>
  <block id="da8490d81c1ef6b559b09c2ab94631d2" category="section-title">关闭环境</block>
  <block id="0bf211160ad57fedca3499176f213b11" category="paragraph">在更改LUN协议之前、必须将LUN完全置于静状态。要转换的LUN之一上的任何数据库都必须关闭、文件系统必须卸载、卷组必须停用。如果使用ASM、请确保已卸载ASM磁盘组并关闭所有网格服务。</block>
  <block id="2ba1c509ee5f5e31f05b24aed2d23054" category="section-title">取消LUN与FC网络的映射</block>
  <block id="2f9e42c479a76dd54d7946c181049dd4" category="paragraph">在LUN完全静置后、从原始FC igrop中删除映射。</block>
  <block id="5f889f52ef85be290c3e5c0211bbb8fa" category="section-title">将LUN重新映射到IP网络</block>
  <block id="4ac84701530b31d8d33d9aa742715d25" category="paragraph">将对每个LUN的访问权限授予新的基于iSCSI的启动程序组。</block>
  <block id="3d59eaa280c8b75d8e997eac2cf5b3e6" category="section-title">发现iSCSI目标</block>
  <block id="981b782c3eacf8b87d8231b887873f03" category="paragraph">iSCSI发现分为两个阶段。第一种方法是发现目标、这与发现LUN不同。。<block ref="f88921f58beaaae5bcb9dffac54bf5ad" prefix=" " category="inline-code"></block> 下面显示的命令用于探测由指定的门户组<block ref="24e12535882a30ad33a21d76d76bd0ff" prefix=" " category="inline-code"></block> 和用于存储提供iSCSI服务的所有IP地址和端口的列表。在这种情况下、有四个IP地址在默认端口3260上提供iSCSI服务。</block>
  <block id="0ab5dd035c7f92f4dce1026744c01604" category="admonition">如果无法访问任何目标IP地址、则此命令可能需要几分钟才能完成。</block>
  <block id="1dba8f39914c5f44e3cb635e7ac7563e" category="section-title">发现iSCSI LUN</block>
  <block id="68307bef4b9dc4071d875a0c2aadd321" category="paragraph">发现iSCSI目标后、重新启动iSCSI服务以发现可用的iSCSI LUN并构建关联设备、例如多路径或ASMlib设备。</block>
  <block id="25d811252f87ae85dda97f2ab9dd1f3a" category="section-title">重新启动环境</block>
  <block id="8a9aae851d31dae8baf96171f114955e" category="paragraph">通过重新激活卷组、重新挂载文件系统、重新启动RAC服务等方式重新启动环境。作为预防措施、NetApp建议您在转换过程完成后重新启动服务器、以确保所有配置文件均正确无误、并且所有陈旧设备均已删除。</block>
  <block id="00f4c8378b0bf837cee4b0aed8886f31" category="paragraph">注意：重新启动主机之前、请确保中的所有条目都已启用<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 此参考迁移的SAN资源已被注释掉。如果未执行此步骤、并且LUN访问出现问题、则可能会导致操作系统无法启动。此问题描述不会损坏数据。但是、启动到救援模式或类似模式并进行更正可能非常不方便<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 以便可以启动操作系统、以便开始故障排除工作。</block>
  <block id="08e3cfb3c3dfa08d34bcbbfe07fe5f28" category="paragraph">安全高效地管理多个Oracle数据库需要有效的QoS策略。原因在于现代存储系统的性能不断提高。</block>
  <block id="3408fe4b6e4b2ed9366356f08e3b9ab0" category="summary">Oracle数据库和存储效率</block>
  <block id="151654fbc652cca26707bd7a060073d3" category="doc">Oracle数据库和ONTAP效率功能</block>
  <block id="4564218d346b0ef8263512ebe659337d" category="paragraph">ONTAP空间效率功能针对Oracle数据库进行了优化。在几乎所有情况下、最佳方法都是保留默认值并启用所有效率功能。</block>
  <block id="794c6d3bb54da92d9a4a4022bc5c4e94" category="summary">RAID和Oracle数据库</block>
  <block id="e959fe6bb794f67f31a0d4e6bc5d5bf4" category="paragraph">RAID是指使用冗余来保护数据不受驱动器丢失的影响。</block>
  <block id="b60b0e7c75501fe2f322675f2e6da6d7" category="paragraph">在配置用于Oracle数据库和其他企业应用程序的NetApp存储时、有时会出现有关RAID级别的问题。有关存储阵列配置的许多传统Oracle最佳实践都包含有关使用RAID镜像和(或)避免使用某些类型的RAID的警告。尽管这些来源可以提供有效的支持、但它们并不适用于RAID 4以及ONTAP中使用的NetApp RAID DP和RAID-TEC技术。</block>
  <block id="6de6bcceac7c1a53ecb774d42b8d5c9a" category="summary">Oracle和ONTAP精简配置</block>
  <block id="26c71bfc140fc9f2d56f83f7aedffd53" category="paragraph">对Oracle数据库进行精简配置需要仔细规划、因为这样会导致在存储系统上配置的空间超过实际可用的空间。这是非常值得的努力、因为如果操作正确、可以显著节省成本并提高易管理性。</block>
  <block id="c9a6446e7a1a2aa2d3d06c76b3dd02ae" category="summary">为Oracle数据库配置SVM</block>
  <block id="eaa6380760494a867d1be23523aaba3e" category="doc">Oracle数据库和Storage Virtual Machine</block>
  <block id="ffa2dec61afa63c15c9906328e62e2e8" category="paragraph">Oracle数据库存储管理集中在Storage Virtual Machine (SVM)上</block>
  <block id="ba0fd7b6bfa61ad7f7ad5326a0934d01" category="summary">要确保Oracle数据库操作不会被这些操作中断、需要了解存储接管和切换功能。此外、如果使用不当、接管和切换操作使用的参数可能会影响数据完整性。</block>
  <block id="999548558d2844d78a3b5f9186c231a4" category="summary">数据库和ONTAP存储容量和可用空间</block>
  <block id="360612d74cdd78953036946ec943f795" category="paragraph">要使用可预测、可管理的高性能企业存储管理数据库或其他企业应用程序、需要在驱动器上留出一些可用空间来管理数据和元数据。所需的可用空间量取决于使用的驱动器类型和业务流程。</block>
  <block id="d3cc759510a3aba837fc8efeb2e24b91" category="doc">db_file_multiblock_read_count</block>
  <block id="32faf0a922da10425f2be9f86a5f5e18" category="paragraph">。<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 参数用于控制Oracle在顺序I/O期间单次操作读取的Oracle数据库块的最大数量</block>
  <block id="36cb03af3dc688208e0e94fda31ca7a4" category="paragraph">但是、此参数不会影响Oracle在任何和所有读取操作期间读取的块数、也不会影响随机I/O只有顺序I/O的块大小会受到影响。</block>
  <block id="2565c992b3732464484104f4c846d9b4" category="paragraph">Oracle建议用户不要设置此参数。这样可以使数据库软件自动设置最佳值。这通常意味着、将此参数设置为一个可产生1 MB I/O大小的值。例如、读取1 MB的8 KB块需要读取128个块、因此、此参数的默认值为128。</block>
  <block id="0fd26e725a6c1a81508e013094776e2c" category="paragraph">NetApp在客户站点发现的大多数数据库性能问题都与此参数的设置不正确有关。在Oracle版本8和9中更改此值有充分的理由。因此、参数可能会在不为人所用的情况下出现在中<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 文件、因为数据库已原位升级到Oracle 10及更高版本。与默认值128相比、原有设置8或16会严重损害顺序I/O性能。</block>
  <block id="3f594bb922365c7a9f095f44822fa22e" category="admonition">* NetApp建议*设置<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 参数不应出现在中<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 文件NetApp从未遇到过更改此参数可提高性能的情况、但在许多情况下、它会明显损坏顺序I/O吞吐量。</block>
  <block id="0eec903bb9d87349e379892ca99ef9ec" category="paragraph">Oracle RAC是一款集群软件产品、它具有多种类型的内部检测信号进程、用于监控集群的运行状况。</block>
  <block id="7c13d022c9fda6e792c4349a043a6c74" category="inline-link-macro">MissCount</block>
  <block id="bab4ae46619fcbbb84e3375ef205e61c" category="admonition">中的信息 <block ref="9cd17d807316d35ef47b12cbecab4ec8" category="inline-link-macro-rx"></block> 第节介绍了有关使用网络存储的Oracle RAC环境的重要信息、在许多情况下、需要更改默认Oracle RAC设置、以确保RAC集群在网络路径更改和存储故障转移/切换操作后不会受到影响。</block>
  <block id="0494651671c3dc7f1ccdf99a4368a2cf" category="section-title">磁盘超时</block>
  <block id="1973cfff3b7c6d828ede9d420b8481b5" category="paragraph">与存储相关的主RAC参数是<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。此参数用于控制表决文件I/O必须完成的阈值。如果<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 超过此参数后、RAC节点将从集群中逐出。此参数的默认值为200。此值对于标准存储接管和回用过程应足够。</block>
  <block id="4aa33fc988e36b9531d36da80d35ec2f" category="paragraph">NetApp强烈建议在将RAC配置投入生产之前对其进行全面测试、因为许多因素会影响接管或恢复。除了完成存储故障转移所需的时间之外、传播链路聚合控制协议(Link Aggregate Control Protocol、LACP)更改也需要额外的时间。此外、SAN多路径软件必须检测到I/O超时、然后在备用路径上重试。如果数据库非常活跃、则在处理表决磁盘I/O之前、必须对大量I/O进行排队和重试。</block>
  <block id="655a10764a0781d26dca3bfb939457b7" category="paragraph">如果无法执行实际的存储接管或恢复、则可以在数据库服务器上执行缆线拉拔测试来模拟这种影响。</block>
  <block id="b2a9e8dd67b2d9a7333cb2c2495c2aa5" category="list-text">退出<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 参数、默认值为200。</block>
  <block id="971a52f4b805c654dd133cf142457c53" category="list-text">始终全面测试RAC配置。</block>
  <block id="cd7a91511dbfbe5c79de12fa7d394dc0" category="paragraph">。<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 参数通常仅影响RAC节点之间的网络检测信号。默认值为30秒。如果网格二进制文件位于存储阵列上或操作系统启动驱动器不在本地、则此参数可能会变得很重要。这包括启动驱动器位于FC SAN上的主机、NFS启动的操作系统以及启动驱动器位于VMDK文件等虚拟化数据存储库上的主机。</block>
  <block id="9c1fd24d7d8e04847dadb944a6643121" category="paragraph">如果存储接管或恢复中断了对启动驱动器的访问、则网格二进制位置或整个操作系统可能会暂时挂起。ONTAP完成存储操作以及操作系统更改路径和恢复I/O所需的时间可能会超过<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 阈值。因此、在恢复与启动LUN或网格二进制文件的连接后、节点会立即被逐出。在大多数情况下、发生逐出和后续重新启动时不会记录任何日志消息来指示重新启动的原因。并非所有配置都会受到影响、因此、请在RAC环境中测试任何SAN启动、NFS启动或基于数据存储库的主机、以便在与启动驱动器的通信中断时RAC保持稳定。</block>
  <block id="2b875dbca82565f3d7e2fa51633bc2c9" category="paragraph">对于非本地启动驱动器或托管的非本地文件系统<block ref="ff4a008470319a22d9cf3d14af485977" prefix=" " category="inline-code"></block> 二进制文件、<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 需要更改才能匹配<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。如果更改了此参数、请执行进一步测试、以确定对RAC行为的任何影响、例如节点故障转移时间。</block>
  <block id="08d7a86ed9292993deaa28bee18d5ce5" category="list-text">离开<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 参数、默认值为30、除非满足以下条件之一：</block>
  <block id="5b46e861366ffd98cd94c26abf2bf550" category="list-text"><block ref="ff4a008470319a22d9cf3d14af485977" prefix="" category="inline-code"></block> 二进制文件位于网络连接驱动器上、包括NFS、iSCSI、FC和基于数据存储库的驱动器。</block>
  <block id="7ace6d79e63cb29c86093526fbddf845" category="list-text">操作系统通过SAN启动。</block>
  <block id="985511d6258bbf659d35bd76e0b0cea1" category="list-text">在这种情况下、请评估影响操作系统或访问的网络中断的影响<block ref="9599929f8663b5e2093f7bc5cb20b0c2" prefix=" " category="inline-code"></block> 文件系统。在某些情况下、此类中断发生原因会使Oracle RAC守护进程发生拖延、从而可能导致出现<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block>基于的超时和逐出。超时默认为27秒、即的值<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 减号<block ref="c9333b0a26b9f9e9fd808e6238d613b0" prefix=" " category="inline-code"></block>。在这种情况下，增加<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 至200以匹配<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。</block>
  <block id="a3f7c31b8d967e0ac9f9dd30fc81c061" category="paragraph">Oracle初始化参数<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 控制异步和直接I/O的使用</block>
  <block id="d1fa3441fd96418a75a509ac2907d644" category="paragraph">与通常的看法相反、异步I/O和直接I/O并不互相排斥。NetApp发现、在客户环境中、此参数经常配置不当、这种配置不当直接导致许多性能问题。</block>
  <block id="0775b72ddf51e2a16e466ee2df8f75ab" category="paragraph">异步I/O意味着可以并行处理Oracle I/O操作。在各种操作系统上提供异步I/O之前、用户配置了大量dbwriter进程并更改了服务器进程配置。使用异步I/O时、操作系统本身会代表数据库软件以高度高效的并行方式执行I/O。此过程不会使数据面临风险、Oracle重做日志记录等关键操作仍会同步执行。</block>
  <block id="6b72950206966c1983e559eb6886ec69" category="paragraph">直接I/O会绕过操作系统缓冲区缓存。UNIX系统上的I/O通常流经操作系统缓冲区缓存。这对于不维护内部缓存的应用程序非常有用、但Oracle在SGA中具有自己的缓冲区缓存。在几乎所有情况下、最好启用直接I/O并将服务器RAM分配给SGA、而不是依赖操作系统缓冲区缓存。Oracle SGA可以更高效地使用内存。此外、当I/O流经操作系统缓冲区时、它会受到额外处理的影响、从而增加了缓存。当低延迟是一项关键要求时、对于写入I/O负载繁重的情况、延迟增加尤为明显。</block>
  <block id="d8590a940a5bb30d8a845f4359f3c779" category="paragraph">的选项<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 是：</block>
  <block id="0aea10c6719256027228a859db38f291" category="list-text">*async.* Oracle将I/O请求提交给操作系统进行处理。此过程允许Oracle执行其他工作、而不是等待I/O完成、从而提高I/O并行处理能力。</block>
  <block id="00cb0cc309682c42b3b936a19a042434" category="list-text">*directio.* Oracle直接对物理文件执行I/O、而不是通过主机操作系统缓存路由I/O。</block>
  <block id="f9941e1b6cc84711e95db0e757efc36a" category="list-text">*无。* Oracle使用同步和缓冲I/O在这种配置中、在共享和专用服务器进程之间进行选择以及dbwriter的数量更重要。</block>
  <block id="f0939ff6231565c83c5c8c9ce1eddc9d" category="list-text">*setall.* Oracle同时使用异步和直接I/O在几乎所有情况下、使用<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block> 最佳。</block>
  <block id="8647b2eaf101a9425f69e6f2e67aeb9d" category="admonition">。<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 参数在DNFS和ASM环境中无效。使用DNFS或ASM会自动导致同时使用异步和直接I/O</block>
  <block id="6dd5604aa0be2956f8b1b41c74fa648e" category="paragraph">某些客户过去遇到过异步I/O问题、尤其是在以前的Red Hat Enterprise Linux 4 (RHEL4)版本中。互联网上的一些过时建议仍然建议避免异步IO、因为信息过时。异步I/O在所有当前操作系统上均保持稳定。如果操作系统没有已知错误、则没有理由禁用它。</block>
  <block id="1ea377466376b194b2d1bfc3ab2fa4c4" category="paragraph">如果数据库一直在使用缓冲I/O、则切换到直接I/O可能还需要更改SGA大小。禁用缓冲的I/O可消除主机操作系统缓存为数据库提供的性能优势。将RAM重新添加到SGA可修复此问题。最终结果应该是I/O性能有所提高。</block>
  <block id="787b3d8b62af05ac3efd1c9ca7a8fc7e" category="paragraph">尽管Oracle SGA使用RAM几乎总是优于操作系统缓冲区缓存、但可能无法确定最佳值。例如、在具有许多间歇性活动Oracle实例的数据库服务器上、最好使用SGA大小非常小的缓冲I/O。这种安排允许所有正在运行的数据库实例灵活地使用操作系统上剩余的可用RAM。这是一种非常少见的情况、但在某些客户站点上也发现过。</block>
  <block id="d4157ab77eb31459bd406aa0f873e20c" category="admonition">* NetApp建议*设置<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> to<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block>但请注意，在某些情况下，丢失主机缓冲区缓存可能需要增加Oracle SGA。</block>
  <block id="f8b42f9efd1a05ede10b0e0c11dfa8b0" category="paragraph">ONTAP在内部使用可变块大小、这意味着可以为Oracle数据库配置所需的任何块大小。但是、文件系统块大小可能会影响性能、在某些情况下、较大的重做块大小可以提高性能。</block>
  <block id="0944aedb4703c4a5e94fb90de9d7a22f" category="section-title">数据文件块大小</block>
  <block id="cc4662c047050e0082701ce6f052dcb7" category="paragraph">某些操作系统可选择文件系统块大小。对于支持Oracle数据文件的文件系统、使用数据压缩时、块大小应为8 KB。如果不需要数据压缩、则可以使用8 KB或4 KB的块大小。</block>
  <block id="e1a001cf8c7e2072c7a44ee65e8fee11" category="paragraph">如果将数据文件放置在具有512字节块的文件系统上、则可能会出现文件错位。LUN和文件系统可能已根据NetApp建议正确对齐、但文件I/O可能错位。这种错位会导致发生原因出现严重的性能问题。</block>
  <block id="9514c8638f798f68108498dd218ec793" category="paragraph">支持重做日志的文件系统所使用的块大小必须是重做块大小的倍数。这通常要求重做日志文件系统和重做日志本身都使用512字节的块大小。</block>
  <block id="cac7d87a1164763b666ca7d02109d153" category="section-title">重做块大小</block>
  <block id="fa06b9584ea36af182742c07894220f0" category="paragraph">在重做率非常高的情况下、4 KB块大小的性能可能会更好、因为重做率较高、可以在更少、更高效的操作中执行I/O。如果重做速率大于50 Mbps、请考虑测试4 KB的块大小。</block>
  <block id="781000593b4913b5625dd5ed9eebe87e" category="paragraph">在块大小为4 KB的文件系统上使用块大小为512字节的重做日志和许多非常小的事务时、客户发现了一些数据库问题。对一个4 KB文件系统块应用多个512字节更改所涉及的开销导致了性能问题、这些问题通过将文件系统更改为使用512字节的块大小得以解决。</block>
  <block id="a02416fde36b174cf1196213fcf1bef6" category="admonition">* NetApp建议*不要更改重做块大小、除非相关客户支持或专业服务组织建议您更改块大小、或者更改基于官方产品文档。</block>
  <block id="65a6ece62f52a5e2ff74baaae821ae86" category="paragraph">灾难恢复是指在发生灾难性事件(例如火灾、导致存储系统甚至整个站点遭到破坏)后恢复数据服务。</block>
  <block id="e168b3b0b2f075f39012df52c5ea3c0a" category="admonition">本文档可替代先前发布的技术报告_TR-4591：《Oracle数据保护》_和_TR-4592：《基于MetroCluster的Oracle》</block>
  <block id="a91982f09e6a0341a90dae002865ea11" category="paragraph">灾难恢复可以通过使用SnapMirror轻松复制数据来实现、当然、许多客户每小时更新一次镜像副本。</block>
  <block id="ad2c5e9521f13e89cd84fdd65ec96c7d" category="paragraph">MetroCluster是指硬件配置中的ONTAP、其中包括低级同步镜像存储和许多附加功能。MetroCluster等集成解决方案简化了当今复杂的横向扩展数据库、应用程序和虚拟化基础架构。它将多个外部数据保护产品和策略替换为一个简单的中央存储阵列。此外、它还可以在一个集群模式存储系统中提供集成的备份、恢复、灾难恢复和高可用性(HA)功能。</block>
  <block id="4278792a47efb1e599476fe07109dca4" category="inline-link-macro">基于MetroCluster的Oracle RAC</block>
  <block id="d12be40db836559c628e8024f5d6ff56" category="paragraph">要了解Oracle数据库在MetroCluster环境中的运行方式、需要对MetroCluster系统的物理设计进行一些说明。</block>
  <block id="5e33c0d8a2417ce5fb6e7a211ad063bb" category="admonition">本文档可替代先前发布的技术报告_TR-4592：《基于MetroCluster的Oracle》</block>
  <block id="37fa92fc2662529308c62c84eb1b38ea" category="paragraph">要了解Oracle数据库如何在MetroCluster环境alsop中运行、需要对MetroCluster系统的逻辑功能进行一些说明。</block>
  <block id="2623b589ddbc1cdb6184ba32aa06e83f" category="inline-link-macro">NVFAIL</block>
  <block id="a4feacea8b05d0f24e5a4612a164a055" category="paragraph">通常的最佳实践仍然适用、如果您的需求仅需要RPO = 0数据保护、则MetroCluster可以满足该需求。但是、大多数客户使用MetroCluster不仅可以实现RROT=0的数据保护、还可以在灾难情形下提高RTO、并在站点维护活动中提供透明的故障转移。</block>
  <block id="3ff8bcf18c694581aa25b0a347508e0f" category="section-title">使用预配置的操作系统进行故障转移</block>
  <block id="442f34633164f1be348a442b2c62d29d" category="list-text">强制执行MetroCluster切换</block>
  <block id="e081e79ea1b1040c51d4a452e46de76d" category="list-text">发现FC LUN (仅限SAN)</block>
  <block id="e60946bf73021e18706a6ac33386b376" category="paragraph">实际激活操作步骤非常简单。LUN发现等命令只需对每个FC端口执行几个命令即可。文件系统挂载只不过是一个<block ref="19822b1b15d9eefc54c07ab49f87b100" prefix=" " category="inline-code"></block> 命令、数据库和ASM均可通过CLI使用一个命令来启动和停止。如果在切换之前灾难恢复站点未使用卷和文件系统、则无需设置<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 卷上。</block>
  <block id="486eed21f55b6fb544db5504294592e6" category="section-title">使用虚拟化操作系统进行故障转移</block>
  <block id="bf65e943f86f26b49698bfdac9b95f81" category="paragraph">数据库环境的故障转移可以扩展到包括操作系统本身。理论上、这种故障转移可以使用启动LUN来完成、但大多数情况下、这种故障转移是通过虚拟化操作系统来完成的。操作步骤类似于以下步骤：</block>
  <block id="7c37589384e83d2b43bba430c18a45aa" category="list-text">挂载托管数据库服务器虚拟机的数据存储库</block>
  <block id="3d4d04d6cdab90b7ca0deb0344f04eec" category="list-text">启动虚拟机</block>
  <block id="c702c387f07bcb4f18482e68d69a155a" category="paragraph">使用MetroCluster系统进行Oracle数据保护的基础是SyncMirror、这是一种性能最高的横向扩展同步镜像技术。</block>
  <block id="9028b52caaa7bdbfb9be779eeb1fe00e" category="summary">采用MetroCluster的Oracle扩展RAC</block>
  <block id="4d4d8a609e5b2ac58e622eb1e90f9e39" category="paragraph">许多客户通过跨站点扩展Oracle RAC集群来优化其RTO、从而形成完全主动-主动配置。整体设计变得更加复杂、因为它必须包括Oracle RAC的仲裁管理。此外、还可以从两个站点访问数据、这意味着强制切换可能会导致使用过时的数据副本。</block>
  <block id="89ffaa1a7d089080e9a1ce912bb8c2d3" category="paragraph">尽管两个站点上都存在数据副本、但只有当前拥有聚合的控制器才能提供数据。因此、对于扩展RAC集群、远程节点必须通过站点到站点连接执行I/O。结果会增加I/O延迟、但这种延迟通常不是问题。RAC互连网络还必须跨站点延伸、这意味着无论如何都需要一个高速、低延迟的网络。如果增加的延迟使发生原因出现问题、则可以主动-被动方式运行集群。然后、需要将I/O密集型操作定向到拥有聚合的控制器本地的RAC节点。然后、远程节点会执行较轻的I/O操作、或者纯粹用作热备用服务器。</block>
  <block id="f441d5fdc388f3419fb87e071534f3ce" category="inline-link-macro">采用ONTAP的Oracle RAC</block>
  <block id="58285fb769eb7fb05ab12d9e0efb3e50" category="section-title">双站点配置</block>
  <block id="af1184f29d838fbfec8d5b5bf5225f66" category="paragraph">双站点扩展RAC配置可以提供主动-主动数据库服务、这些服务可以在许多(并非所有)灾难情形下无系统地经受住。</block>
  <block id="7544489c7854fcae445508015240a865" category="section-title">RAC投票文件</block>
  <block id="8b6e46422f88dab6ea82f2dbcadfc76b" category="paragraph">在MetroCluster上部署扩展RAC时、首要考虑事项应该是仲裁管理。Oracle RAC有两种管理仲裁的机制：磁盘检测信号和网络检测信号。磁盘检测信号可使用表决文件监控存储访问。对于单站点RAC配置、只要底层存储系统提供HA功能、单个表决资源就足够了。</block>
  <block id="fafd618b82d1827eeb8197e1c38722bc" category="paragraph">在早期版本的Oracle中、投票文件放置在物理存储设备上、但在当前版本的Oracle中、投票文件存储在ASM磁盘组中。</block>
  <block id="aeab2391a07321ac474989b9c9047226" category="admonition">NFS支持Oracle RAC。在网格安装过程中、会创建一组ASM进程、以将网格文件使用的NFS位置显示为ASM磁盘组。此过程对最终用户几乎是透明的、安装完成后无需持续进行ASM管理。</block>
  <block id="42aca4aae768d5ec1cb0c50d41b7b8b7" category="paragraph">双站点配置的第一个要求是、确保每个站点始终可以访问一半以上的表决文件、并确保灾难恢复过程不会中断。在表决文件存储在ASM磁盘组中之前、此任务非常简单、但如今管理员需要了解ASM冗余的基本原则。</block>
  <block id="60a723853bb2c173648452baf2199e73" category="paragraph">ASM磁盘组有三个冗余选项<block ref="6a21b6995a068148bbb65c8f949b3fb2" prefix=" " category="inline-code"></block>，<block ref="fea087517c26fadd409bd4b9dc642555" prefix=" " category="inline-code"></block>，和<block ref="8d966b2253a917086c8604959e152243" prefix=" " category="inline-code"></block>。换言之、未镜像、镜像和三向镜像。名为的新选项<block ref="09d2bd168181f1e64c2b1651a80a8aa8" prefix=" " category="inline-code"></block> 也可用、但很少使用。冗余设备的冗余级别和放置位置控制了在故障情形下发生的情况。例如：</block>
  <block id="32cdeb2c0245b51a0b590e6054f03c21" category="list-text">将表决文件放置在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 使用<block ref="6a21b6995a068148bbb65c8f949b3fb2" prefix=" " category="inline-code"></block> 冗余资源可确保在站点间连接断开时逐出一个站点。</block>
  <block id="a549b4f1fc0c2d14bc333c70bbde73dc" category="list-text">将表决文件放置在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 使用<block ref="fea087517c26fadd409bd4b9dc642555" prefix=" " category="inline-code"></block> 每个站点只有一个ASM磁盘的冗余可确保在站点间连接断开时在两个站点上逐出节点、因为两个站点都不会有多数仲裁。</block>
  <block id="c15f1c43a368db0ab3dde90eca52582d" category="list-text">将表决文件放置在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 使用<block ref="8d966b2253a917086c8604959e152243" prefix=" " category="inline-code"></block> 如果一个站点上有两个磁盘、而另一个站点上有一个磁盘、则可以在两个站点均正常运行且可相互访问时执行主动-主动操作。但是、如果单磁盘站点与网络隔离、则该站点将被逐出。</block>
  <block id="478ced47a1ea1d6f0db02af749bfdaec" category="section-title">RAC网络检测信号</block>
  <block id="2432333dc52d6150fb3d58051bc8b0c2" category="paragraph">Oracle RAC网络检测信号可监控集群互连中的节点可访问情况。要保留在集群中、一个节点必须能够与一半以上的其他节点联系。在双站点架构中、此要求会为RAC节点数创建以下选项：</block>
  <block id="3e36a59c8a51ee9cc2cba0e7051ed35f" category="list-text">如果在每个站点上放置相同数量的节点、则会在网络连接断开时在一个站点上执行逐出。</block>
  <block id="4955aede919912b3c62fadbc1039671b" category="list-text">将N个节点放置在一个站点上、而将N+1个节点放置在另一个站点上、可以确保站点间连接断开会导致站点中剩余的网络仲裁节点数量增加、而将节点数量减少。</block>
  <block id="80bd651a66488201c928634689e2e5cc" category="paragraph">在Oracle 12cR2之前的版本中、无法控制站点丢失期间哪一端会发生逐出。如果每个站点的节点数相等、则逐出操作由主节点控制、主节点通常是要启动的第一个RAC节点。</block>
  <block id="d128c05245b2e633856a5061db176b7e" category="paragraph">Oracle 12cR2引入了节点加权功能。通过此功能、管理员可以更好地控制Oracle如何解决脑裂问题。例如、以下命令可为RAC中的特定节点设置首选项：</block>
  <block id="104c5747f0d9dbb47b0d09953c709a8d" category="paragraph">重新启动Oracle高可用性服务后、配置如下所示：</block>
  <block id="693cce334ab6658c73ea67674775156b" category="paragraph">Node<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 现在指定为关键服务器。如果两个RAC节点彼此隔离、<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 不会影响、和<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 被逐出。</block>
  <block id="386839b09451962d03e26b7bbfabce74" category="admonition">有关完整的详细信息、请参见Oracle白皮书《Oracle Clusterware 12c Release 2 Technical Overview》。"</block>
  <block id="11f65689342acc8f71c8014eeb7945ee" category="paragraph">对于12cR2之前的Oracle RAC版本、可通过按如下所示检查CRS日志来识别主节点：</block>
  <block id="c8b8cd80b31dac17fb85459c341042bd" category="paragraph">此日志指示主节点为<block ref="c81e728d9d4c2f636f067f89cc14862c" prefix=" " category="inline-code"></block> 和节点<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> ID为<block ref="c4ca4238a0b923820dcc509a6f75849b" prefix=" " category="inline-code"></block>。这一事实意味着<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 不是主节点。可以使用命令确认主节点的标识<block ref="08e7c60bbf8289a563b25cc033d431f7" prefix=" " category="inline-code"></block>。</block>
  <block id="fdf6179b59d3f4873b042609a5f09bc4" category="paragraph">ID为的节点<block ref="c81e728d9d4c2f636f067f89cc14862c" prefix=" " category="inline-code"></block> 为<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block>，即主节点。在每个站点上具有相同节点数的配置中、站点使用<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 是指在两组因任何原因丢失网络连接时仍可正常运行的站点。</block>
  <block id="f2932b43ad604fa01d57212558608ed6" category="paragraph">标识主节点的日志条目可能会在系统中过期。在这种情况下、可以使用Oracle集群注册表(OCR)备份的时间戳。</block>
  <block id="50cd29958db0c1dcb6505d470f553e54" category="paragraph">此示例显示主节点为<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block>。此外、它还表示主节点与发生了变化<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> to<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 5月4日2：05到21：39之间的某个时间。只有在检查了CRS日志后、才能安全地使用这种标识主节点的方法、因为主节点可能在上次OCR备份后发生更改。如果发生了此更改、则OCR日志中应该会显示此更改。</block>
  <block id="df044a3c3d7f7f244db7c42b347b9a90" category="paragraph">大多数客户都选择一个投票磁盘组来为整个环境提供服务、并在每个站点上选择相同数量的RAC节点。磁盘组应放置在数据库所在的站点上。其结果是、连接断开会导致在远程站点上发生逐出。远程站点将不再具有仲裁、也无法访问数据库文件、但本地站点仍会照常运行。恢复连接后、远程实例可以重新联机。</block>
  <block id="84a24276bfdfbe485b9d961c1a57a830" category="paragraph">发生灾难时、需要执行切换、以使运行正常的站点上的数据库文件和表决磁盘组联机。如果灾难允许AUSO触发切换、则不会触发NVFAIL、因为集群已知处于同步状态、并且存储资源正常联机。此操作速度非常快、应在之前完成<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 期限到期。</block>
  <block id="6244ee13e435dcc768edbc9b0b38b73e" category="paragraph">由于只有两个站点、因此无法使用任何类型的自动外部中断软件、这意味着强制切换必须手动操作。</block>
  <block id="568c8c12fdb7c74f65125732ee717ad3" category="section-title">三站点配置</block>
  <block id="2c7696fb04f52eb5687d059415066fa7" category="paragraph">使用三个站点构建扩展RAC集群更容易。托管MetroCluster系统一半的两个站点也支持数据库工作负载、而第三个站点则充当数据库和MetroCluster系统的断路器。Oracle TiebREAKER配置可能非常简单、只需将ASM磁盘组的一个成员放置在第三个站点上即可进行表决、也可能包括在第三个站点上运行的实例、以确保RAC集群中的节点数为奇数。</block>
  <block id="6265611ca77e9ad52249c5fdd4780da9" category="admonition">有关在扩展RAC配置中使用NFS的重要信息、请参阅Oracle文档中的"Quorum Failure group"(仲裁故障组)。总之、可能需要修改NFS挂载选项以包括软选项、以确保与托管仲裁资源的第三站点断开连接不会挂起主Oracle服务器或Oracle RAC进程。</block>
  <block id="d84d0eea463e72a6e15018c70a45af46" category="doc">Oracle、MetroCluster和NVFAIL</block>
  <block id="9dc6a9986107298da2a22e7c5a3efb00" category="summary">基于MetroCluster的Oracle单个实例</block>
  <block id="f8b28e31633ae72c2971ee8b815ed4af" category="paragraph">如前所述、MetroCluster系统的存在并不一定会增加或更改数据库的任何最佳操作实践。客户MetroCluster系统上当前运行的大多数数据库都是单个实例、并遵循Oracle on ONTAP文档中的建议。</block>
  <block id="f4872c843923dd8d8731ef66462b5a99" category="paragraph">SyncMirror在灾难恢复站点提供数据的同步副本、但要使数据可用、需要使用操作系统和相关应用程序。基本自动化可以显著缩短整个环境的故障转移时间。通常会使用Veritas Cluster Server (VCS)等集群软件产品在各个站点之间创建集群、在许多情况下、可以使用简单的脚本来驱动故障转移过程。</block>
  <block id="c50820a41eb4f23d0a3acc1eeddb391b" category="paragraph">如果主节点丢失、则会将集群软件(或脚本)配置为在备用站点使数据库联机。一种方法是、创建为构成数据库的NFS或SAN资源预先配置的备用服务器。如果主站点发生故障、则集群软件或脚本化备用站点将执行一系列类似以下内容的操作：</block>
  <block id="2a6f458321ddf666cb0c876ee39255f3" category="list-text">挂载文件系统和/或挂载ASM磁盘组</block>
  <block id="3dee93bd9bc9b8b50dcdd2066a86009f" category="list-text">正在启动数据库</block>
  <block id="620515885465a26daea6cc6441403e34" category="paragraph">此方法的主要要求是在远程站点上运行操作系统。它必须预配置Oracle二进制文件、这也意味着必须在主站点和备用站点上执行Oracle修补等任务。或者、也可以将Oracle二进制文件镜像到远程站点、并在声明发生灾难时进行挂载。</block>
  <block id="edb5332feef69c0aa60ea10ed5d31a9f" category="list-text">手动启动数据库或将虚拟机配置为自动启动数据库、例如、ESX集群可以跨越多个站点。发生灾难时、可以在切换后将灾难恢复站点上的虚拟机置于联机状态。只要在发生灾难时托管虚拟化数据库服务器的数据存储库未在使用中、就不需要进行设置<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 在关联卷上。</block>
  <block id="64bba30b717cb45555458da4fed880a1" category="paragraph">几乎每个应用程序都需要数据复制。</block>
  <block id="25fb1fa02f326334533a22c105ad3e69" category="paragraph">在最基本的层面上、复制可以是在异地存储的磁带上进行复制、也可以是应用程序级复制到备用位置。灾难恢复是指在服务发生灾难性丢失时使用这些副本使服务联机。</block>
  <block id="eab6cb3a1168ef2311865e6155b8272c" category="paragraph">ONTAP提供了多种复制选项、可在存储阵列中本机满足各种要求、从而满足各种需求。这些选项可以包括将备份简单地复制到远程站点、甚至可以复制到一个完全自动化的同步解决方案、从而在同一平台上提供灾难恢复和高可用性。</block>
  <block id="32df0c1cabf839652741a56bdaac7def" category="paragraph">适用于应用程序的主要ONTAP复制技术是NetApp SnapMirror和NetApp SyncMirror技术。这些不是附加产品、而是完全集成到ONTAP中、只需添加一个许可证密钥即可激活。存储级别复制也不是唯一的选项。应用程序级复制(例如使用Oracle DataGuard)还可以集成到基于ONTAP的数据保护策略中。</block>
  <block id="a2259fa074bae962e46ca7fc7aa31be1" category="paragraph">正确的选择取决于特定的复制、恢复和保留要求。</block>
  <block id="0d3b37ff5855bf299f3c4a154373c1e2" category="section-title">ONTAP SnapMirror</block>
  <block id="296e89e943f5160d338484b3b705a44e" category="paragraph">SnapMirror是NetApp异步复制解决方案、非常适合保护大型、复杂的动态数据集、例如数据库及其关联应用程序。其关键值如下：</block>
  <block id="d9f36dae2818ace926c4259271530724" category="list-text">*易管理性。* SnapMirror是存储软件的本机组成部分、易于配置和管理。不需要附加产品。复制关系只需几分钟即可建立、并可直接在存储系统上进行管理。</block>
  <block id="8f761eff026903aa0140319f597d1fb0" category="list-text">*精简性。*复制基于FlexVol卷、这些卷是LUN或文件的容器、作为一个一致的组进行复制。</block>
  <block id="8b737d6a9db3de6436966db508cb51d4" category="list-text">*效率。*建立初始复制关系后、仅复制更改。此外、重复数据删除和数据压缩等效率功能也会保留下来、从而进一步减少必须传输到远程站点的数据量。</block>
  <block id="0783dadb67ff77ed26bbfc5d80fa0cbd" category="list-text">*灵活性。*镜像可以暂时断开、以便测试灾难恢复过程、然后可以轻松地重新建立镜像、而无需进行完整的重新镜像。只需应用更改后的数据即可使镜像恢复同步。也可以反转镜像、以便在灾难结束且原始站点恢复使用后快速重新同步。最后、复制数据的读写克隆可用于测试和开发。</block>
  <block id="8a00f09d8937e890f2cfb4d7acf72733" category="paragraph">ONTAP提供多种不同的复制技术、但最灵活的是SnapMirror、这是一种卷到卷异步镜像选项。</block>
  <block id="80c8fae3d0b5dd100cc984d9ba3eced7" category="paragraph">如前所述、FlexVol卷是基于Snapshot的备份和基于SnapRestore的恢复的基本管理单元。FlexVol卷也是基于SnapMirror的复制的基本单元。第一步是建立源卷到目标卷的基线镜像。初始化此镜像关系后、所有后续操作都将仅基于对已更改数据的复制。</block>
  <block id="c1020b1755f65f23643158ce6a4d22cc" category="paragraph">从恢复角度来看、SnapMirror的关键值如下：</block>
  <block id="50bde20b37cd4d57fbff2b95f2f8ec97" category="list-text">SnapMirror操作易于理解、并且可以轻松实现自动化。</block>
  <block id="66162be45733f65fee4abb22e989eb78" category="list-text">只需更新SnapMirror副本即可、只需复制增量更改即可、从而降低了对带宽的需求、并允许更频繁地进行更新。</block>
  <block id="a3b4fbe416387a4991ccaa8b325a68be" category="list-text">SnapMirror具有高度粒度。它基于简单的卷到卷关系、可以创建数百个独立管理的副本并按复制间隔进行复制。复制不需要"一刀切"。</block>
  <block id="4e3785883ef3ccad9938d7e35e493057" category="list-text">镜像方向可以轻松反转、同时保留仅根据更改更新关系的能力。这样、在发生灾难(例如断电)后、主站点恢复正常运行后、便可提供快速故障恢复功能。只需将所做的更改同步回源。</block>
  <block id="8b8325381cf528eff12c1e678a3112f9" category="list-text">镜像可以轻松断开并高效地重新同步、以便预演灾难恢复过程。</block>
  <block id="b1f45b7d95bfc815351fb649fa94b671" category="list-text">在完整块级复制模式下运行的SnapMirror不仅可以复制卷中的数据、还可以复制快照。此功能可在灾难恢复站点上提供数据副本和一组完整备份。</block>
  <block id="ffafd9ae31dee51209961eb2453ac806" category="paragraph">在版本灵活模式下运行的SnapMirror允许复制特定快照、从而允许在主站点和二级站点上使用不同的保留时间。</block>
  <block id="974658d7ac018cb945e78365b0a760fb" category="section-title">SnapMirror 同步</block>
  <block id="ffbf9d0ce29a631b6eae8b22c41ec95e" category="paragraph">SnapMirror同步(SM-S)是对SnapMirror的一项增强功能、可提供RPO = 0的同步复制。它最常用于存储架构、在这些架构中、只有一部分数据需要同步镜像。</block>
  <block id="e8a45c4c0391895df78421904703c933" category="paragraph">SM-S可以在两种略有不同的模式下运行：Sync和StrictSync。</block>
  <block id="15a4e16195fb9d30c5df0e11df5c2166" category="paragraph">在Sync模式下、更改会在确认之前进行复制。这样可以保证RPO为零、只要复制正常运行即可。如果无法复制更改、SM-S可以退出同步模式并允许操作继续。这允许在正常情况下RPO = 0、但如果复制目标不可用、则数据进程不会完全暂停。</block>
  <block id="115455025d4664c0dd6deaaf3c1fc93c" category="paragraph">StrictSync可保证RPO = 0。无法复制更改会导致I/O错误、这通常会导致应用程序关闭。</block>
  <block id="1b1ea0d1ad6e5cfb06253a14fcdcfe71" category="inline-link">TR-4733</block>
  <block id="9ccd61d6efc86cc37743fdff385832e8" category="paragraph">有关SM-S的完整说明、请参见<block ref="4459b84726c651a8047a6486e87e48fb" category="inline-link-rx"></block> 以及ONTAP官方文档。新版本的ONTAP会不断增加功能。</block>
  <block id="6165c4352e1504dbaeef34d0cc50c187" category="section-title">一致性组</block>
  <block id="0651e813e385dbd62a9bca9baee23c6c" category="paragraph">ONTAP允许创建一致性组快照、从9.13.1开始、ONTAP可以将卷组(请记住、ONTAP术语中的卷不是LUN、而是由一个或多个文件或LUN组成的管理容器)复制为一致的组。</block>
  <block id="455c7758003d6ebd974e8858f5ef1d7d" category="paragraph">这样、您就可以复制多卷数据集、并确保所有卷都是交叉一致的。此外、这还允许"中断镜像并开始"灾难恢复操作、而无需执行其他应用程序或数据库恢复步骤。</block>
  <block id="c44a2da164b7b770fce6338a987670ee" category="section-title">MetroCluster和SyncMirror</block>
  <block id="b1a1cfbf3988d8abdfdedaabc1742ae9" category="paragraph">MetroCluster也是一种同步复制解决方案、适用于大规模任务关键型工作负载。复制基于SyncMirror。最简单的一层是、SyncMirror会在两个不同的位置创建两组受RAID保护的完整数据。它们可以位于数据中心内的相邻房间内、也可以相距数公里。</block>
  <block id="89b8adf28db7abb0febecafdca5871ad" category="paragraph">SyncMirror与ONTAP完全集成、在RAID级别以上运行。因此、所有常见的ONTAP功能(例如Snapshot副本、SnapRestore和NetApp FlexClone)均可无缝运行。它仍然是ONTAP、只是增加了一层同步数据镜像。</block>
  <block id="75c677fa68f5d15c17efbf6fd1fe1765" category="paragraph">管理SyncMirror数据的一组ONTAP控制器称为NetApp MetroCluster配置。MetroCluster的主要目的是、在各种典型故障情形和灾难恢复故障情形下、为同步镜像数据提供高可用性访问。</block>
  <block id="af845652f0234e1f71bc37e241ab63dc" category="paragraph">使用MetroCluster和SyncMirror进行数据保护的关键值如下：</block>
  <block id="9ab80c5e33e343c3415c21be433c4447" category="list-text">在正常操作中、SyncMirror可在不同位置之间提供有保障的同步镜像。写入操作只有在两个站点的非易失性介质上存在后才会得到确认。</block>
  <block id="680ccf94624c9f922ed236c8cc0c1af2" category="list-text">如果站点之间的连接发生故障、SyncMirror会自动切换到异步模式、以使主站点始终提供数据、直到连接恢复为止。还原后、它可以高效更新主站点上累积的更改、从而实现快速重新同步。不需要完全重新初始化。</block>
  <block id="c18ec55908c635b68abe8c6edbf6476e" category="paragraph">SnapMirror还与基于SyncMirror的系统完全兼容。例如、主数据库可能运行在分布在两个地理站点的MetroCluster集群上。此数据库还可以将备份作为长期归档复制到第三个站点、或者用于在DevOps环境中创建克隆。</block>
  <block id="3a8111f0b903472ec78531619bf984f6" category="paragraph">Oracle数据库的复制过程与备份过程基本相同。主要要求是、必须将构成可恢复备份的快照复制到远程存储系统。</block>
  <block id="c62b3abab4fdbaf8f0a84e8c3559b5fd" category="paragraph">如前面有关本地数据保护的文档所述、可以使用热备份过程或利用针对快照优化的备份来创建可恢复的备份。</block>
  <block id="3d8f8c6a5c90bcd85a22fbd17390a864" category="inline-link-macro">数据布局</block>
  <block id="f3f227cc5c07a040d61c36679053a58a" category="paragraph">假设数据文件封装在专用卷中、下一个问题是如何管理重做日志、归档日志和控制文件。最简单的方法是将所有这些数据类型放在一个卷中。这样做的好处是、复制的重做日志、归档日志和控制文件可以实现完美同步。不要求恢复不完整或使用备份控制文件、但对于其他可能的恢复场景、可能还需要使用脚本创建备份控制文件。</block>
  <block id="927992cbeccc8211e382c97e81514ef9" category="section-title">双卷布局</block>
  <block id="fe1cf96940a710dc95fd30bbb7533b52" category="paragraph">下图显示了最简单的布局。</block>
  <block id="57f1db4bdf2ce49a98f375d8393f02bf" category="paragraph">这是最常见的方法。从数据库管理角度来看、将重做日志和归档日志的所有副本放在同一个卷上似乎并不常见。但是、如果文件和LUN仍都位于同一个底层驱动器集上、则隔离不会提供太多额外保护。</block>
  <block id="bc46e4831ef5654d084e456c4c544a42" category="section-title">三卷布局</block>
  <block id="f6e969769d9d166122489505d676769b" category="paragraph">有时、由于数据保护问题或需要在控制器之间分布重做日志I/O、需要分离重做日志。如果是、则下图所示的三卷布局将用于复制、同时仍然避免执行不完整的恢复或依赖备份控制文件的任何要求。</block>
  <block id="4957c2feaa2cb72d80a0ab65228ad43f" category="paragraph">这样、可以在源上的一组独立磁盘轴和控制器之间对重做日志和控制文件进行条带化。但是、归档日志以及一组控制文件和重做日志仍可与归档日志同步进行复制。</block>
  <block id="39128da64bc55500b4b11391aa54a011" category="paragraph">在此模型中、不会复制重做日志B卷。</block>
  <block id="c0ce858e99375deac8274c96b7e5d0ee" category="section-title">灾难恢复过程—热备份</block>
  <block id="6993729228512b7e23e3ff3ec9099f33" category="paragraph">要使用热备份执行灾难恢复、请使用以下基本操作步骤：</block>
  <block id="ee68e5b99222bbc29a480fcb0d1d6ee2" category="section-title">前提条件</block>
  <block id="41bde9c586a860264c425700c48bd375" category="list-text">Oracle二进制文件安装在灾难恢复服务器上。</block>
  <block id="cebf7cec81152da2cadffd580d81937f" category="list-text">中列出了数据库实例<block ref="2c0b0433aa1c96a2be6f40d9e71bc6af" prefix=" " category="inline-code"></block>。</block>
  <block id="17f8e5eda67237f2ca94c7dcce3e4022" category="list-text">。<block ref="76a2173be6393254e72ffa4d6df1030a" prefix=" " category="inline-code"></block> 和<block ref="6b2f852f7f63f2e5d4be597bbca97bb6" prefix=" " category="inline-code"></block> 或<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 实例必须位于中<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目录。。</block>
  <block id="645a84975202e30700b572b49a5ee29d" category="section-title">灾难恢复</block>
  <block id="25d18766964d7515e1f5acd893094f6e" category="list-text">中断数据文件和通用日志卷的镜像。</block>
  <block id="8fc655e4752d521563db3bfa138ba62e" category="list-text">将数据文件卷还原到数据文件的最新热备份快照。</block>
  <block id="68a9c75816a16f6d4f7572fe287961bf" category="list-text">如果使用SAN、请激活卷组和/或挂载文件系统。</block>
  <block id="312007510a0f0dc7878d4ed6a7a01554" category="list-text">将归档日志重放至所需位置。</block>
  <block id="e54b793d8bfa83bbb1bd965992c3474e" category="list-text">如果需要完全恢复、则重放当前重做日志。</block>
  <block id="72e5734d53581f86093de5c97d8a3a24" category="paragraph">使用NFS可以显著简化操作步骤、因为数据文件和日志文件的NFS文件系统可以随时挂载到灾难恢复服务器上。镜像中断后、它将变为读/写状态。</block>
  <block id="de4735bc5bbfdcae3d690313c739ad67" category="section-title">灾难恢复过程—针对快照优化的备份</block>
  <block id="6b2b8ef11e5ded8a083372ba49d488d2" category="paragraph">从快照优化的备份中恢复与热备份恢复操作步骤几乎相同、但进行了以下更改：</block>
  <block id="af1e49e7bc2b25ce36bd93df09433fb4" category="list-text">将数据文件卷还原到当前日志卷副本之前创建的快照。</block>
  <block id="5e09669c98226c5d3a748f7e0f0333ad" category="paragraph">这些差异简化了整体恢复操作步骤、因为无需确保在数据库处于热备份模式时在源上正确创建快照。灾难恢复操作步骤基于灾难恢复站点上快照的时间戳。创建快照时数据库的状态并不重要。</block>
  <block id="81d6beef7eaf28bbce692d4b59888f3e" category="section-title">使用热备份快照进行灾难恢复</block>
  <block id="dc711b77f0d6a9c9ccf88b424509440a" category="paragraph">这是一个基于热备份快照复制的灾难恢复策略示例。它还可以作为简单且可扩展的本地备份策略的示例。</block>
  <block id="edaef18e1c956b9284405fd664c4ca4a" category="paragraph">示例数据库位于基本的双卷架构上。<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 包含数据文件和<block ref="894db1fc1592356880976f1b92c3e6a2" prefix=" " category="inline-code"></block> 用于合并的重做日志、归档日志和控制文件。</block>
  <block id="fc0e7b6cd7cd15929987b1429d1c3a7e" category="paragraph">需要两个计划、一个用于每晚数据文件备份、另一个用于日志文件备份。分别称为午夜和15分钟。</block>
  <block id="44c0956347a70c78d2124c1041321049" category="paragraph">然后、在快照策略中使用这些计划<block ref="44dc83cda2d6b3ce99cc25803e824061" prefix=" " category="inline-code"></block> 和<block ref="9b055600529d69c4ae0d2a9408dc7aa3" prefix=" " category="inline-code"></block>，如下所示：</block>
  <block id="180e86b8e3c5049779c98c2c1006bb15" category="paragraph">最后、这些快照策略将应用于卷。</block>
  <block id="2887f2c14c7efbc97d53ac2f914c5657" category="paragraph">此选项用于定义卷的备份计划。数据文件快照在午夜创建并保留60天。日志卷包含72个以15分钟为间隔创建的快照、这些快照的覆盖时间最长可达18小时。</block>
  <block id="e1e5ef0e7100311d950b4ffebe040670" category="paragraph">然后、确保在创建数据文件快照时数据库处于热备份模式。这可通过一个小脚本来完成、该脚本接受一些基本参数、用于在指定SID上启动和停止备份模式。</block>
  <block id="683cdd7abd993faf3ace355cd6870b6f" category="paragraph">此步骤可确保数据库在围绕午夜快照的四分钟窗口内处于热备份模式。</block>
  <block id="ccff7eb3ad0059a184886709c87f4889" category="paragraph">复制到灾难恢复站点的配置如下：</block>
  <block id="42d3752a745fb0cdae528f6cc425b569" category="paragraph">日志卷目标每15分钟更新一次。这样可实现大约15分钟的RPO。根据更新期间必须传输的总数据量、确切的更新间隔略有不同。</block>
  <block id="e272424001d72919ad498e0e9d3c2cc4" category="paragraph">数据文件卷目标每六小时更新一次。这不会影响RPO或RTO。如果需要进行灾难恢复、首先要做的一个步骤是将数据文件卷还原回热备份快照。更新间隔更频繁的目的是使此卷的传输速率保持平稳。如果计划每天更新一次、则必须立即传输当天累积的所有更改。更新频率越高、所做的更改就会在一天中逐渐复制。</block>
  <block id="ce176ff569d716c1fa73d0754aba684b" category="paragraph">如果发生灾难、第一步是中断两个卷的镜像：</block>
  <block id="4b9cdb6e2096c0828aeccd2ee5eecf42" category="paragraph">副本现在为读写副本。下一步是验证日志卷的时间戳。</block>
  <block id="b4d461e48f5be5d08f677045d11e8200" category="paragraph">日志卷的最新副本是3月14日13：30：00。</block>
  <block id="96f75a4b63f4377efdf64d571d71caec" category="paragraph">接下来、确定在日志卷的状态之前创建的热备份快照。这是必需的、因为日志重放过程需要在热备份模式下创建所有归档日志。因此、日志卷副本必须早于热备份映像、否则不会包含所需的日志。</block>
  <block id="d358e4eb10a2f4e0b591e16941d7782c" category="paragraph">最近创建的快照为<block ref="c001e27abf0e66d13790bb8a7e00da54" prefix=" " category="inline-code"></block>。这是数据文件的最新热备份映像、然后按如下所示进行还原：</block>
  <block id="d2037035a976c9be71cf6f372300c8c3" category="paragraph">在此阶段、数据库现已准备好进行恢复。如果是SAN环境、下一步将包括激活卷组和挂载文件系统、这是一个轻松自动化的过程。由于此示例使用的是NFS、因此文件系统已挂载并变为读写状态、在镜像中断后不再需要挂载或激活。</block>
  <block id="2edce22eade45b42bc6b2665057fa082" category="paragraph">现在、可以将数据库恢复到所需的时间点、也可以根据所复制的重做日志副本将其完全恢复。此示例说明了归档日志、控制文件和重做日志卷的组合值。恢复过程显著简化、因为无需依赖备份控制文件或重置日志文件。</block>
  <block id="51f74a82c7125b3b288755b6668091b1" category="section-title">使用针对快照优化的备份进行灾难恢复</block>
  <block id="3680a4757ddad43934237ab6a0ca955c" category="paragraph">使用针对快照优化的备份的灾难恢复操作步骤与热备份灾难恢复操作步骤几乎相同。与热备份快照操作步骤一样、它也是本地备份架构的基本扩展、在该架构中、备份会进行复制以用于灾难恢复。以下示例显示了详细的配置和恢复操作步骤。此示例还说明了热备份与针对快照优化的备份之间的主要差异。</block>
  <block id="330dadae5e2585726f41ed1f90e88f9f" category="paragraph">示例数据库位于基本的双卷架构上。<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 包含数据文件、和<block ref="894db1fc1592356880976f1b92c3e6a2" prefix=" " category="inline-code"></block> 用于合并的重做日志、归档日志和控制文件。</block>
  <block id="1669f47e046ce7e069e9d143f42e025d" category="paragraph">需要两个计划：一个用于每晚数据文件备份、一个用于日志文件备份。分别称为午夜和15分钟。</block>
  <block id="ef4adcab3e9bd572d0670f9f2073c311" category="paragraph">此选项用于控制卷的最终备份计划。快照在午夜创建并保留60天。日志卷包含72个以15分钟为间隔创建的快照、这些快照的覆盖时间最长可达18小时。</block>
  <block id="f9d5149b630a43ff5996adc26c6e1f08" category="paragraph">日志卷目标每15分钟更新一次。这样可以实现大约15分钟的RPO、精确更新间隔略有不同、具体取决于更新期间必须传输的总数据量。</block>
  <block id="992398ebd9e9f825f0aa4415519abdba" category="paragraph">数据文件卷目标每6小时更新一次。这不会影响RPO或RTO。如果需要灾难恢复、则必须先将数据文件卷还原回热备份快照。更新间隔更频繁的目的是使此卷的传输速率保持平稳。如果计划每天更新一次、则必须立即传输当天累积的所有更改。更新频率越高、所做的更改就会在一天中逐渐复制。</block>
  <block id="9e85b8590ac2f9ff5ebc8d1def51ae82" category="paragraph">如果发生灾难、第一步是中断所有卷的镜像：</block>
  <block id="fd2834dcadb39f00eb897fdcdc07a03d" category="paragraph">日志卷的最新副本是3月14日13：30。接下来、确定在日志卷状态之前创建的数据文件快照。这是必需的、因为日志重放过程需要从快照之前到所需恢复点的所有归档日志。</block>
  <block id="810e47566b9cd5aa3b28e6514ec95735" category="paragraph">最近创建的快照为<block ref="c001e27abf0e66d13790bb8a7e00da54" prefix=" " category="inline-code"></block>。还原此快照。</block>
  <block id="87d83a0406ac6622efcdf91c42784ecd" category="paragraph">数据库现在可以恢复了。如果是SAN环境、则可以激活卷组并挂载文件系统、这是一个轻松自动化的过程。但是、此示例使用的是NFS、因此文件系统已挂载并变为读写状态、不再需要在镜像中断后挂载或激活。</block>
  <block id="7a2e97f17454be76b7e522ce612ff961" category="paragraph">现在、可以将数据库恢复到所需的时间点、也可以根据所复制的重做日志副本将其完全恢复。此示例说明了归档日志、控制文件和重做日志卷的组合值。恢复过程显著简化、因为不需要依赖备份控制文件或重置日志文件。</block>
  <block id="5eda890cc07e4b7cd409730d8af8ddc3" category="paragraph">一致性组复制可以像通过SnapMirror计划复制单个卷一样简单。这包括数据文件、控制文件、归档日志和重做日志。每次SnapMirror更新都会在目标站点生成一个新的数据库副本、该副本保持一致、并可通过中断镜像来激活。</block>
  <block id="89cb1432594ce7c25dadf229401874e7" category="paragraph">如果数据库必须跨越多个卷、则需要一致性组快照(CG快照)。</block>
  <block id="f96b125d1bacc785389957041be148e9" category="paragraph">在块级复制模式下与SnapMirror结合使用时、此策略的另一个优势是、可以完全复制源存储系统上的所有快照。除了灾难恢复副本之外、还会复制完整的备份副本。</block>
  <block id="77fda44088666155052f9d4224878cbc" category="summary">Oracle归档日志层</block>
  <block id="8625af69ad0b5f76799d87df777e3c86" category="paragraph">FabricPool最重要的用途或许是提高已知冷数据(如数据库事务日志)的效率。</block>
  <block id="a98d546484d238b37b7e2584ae8d399d" category="summary">Oracle备份层</block>
  <block id="9f409a250e4be99904c9e90259cb747d" category="paragraph">传统应用程序备份包括Oracle Recovery Manager等产品、这些产品可在原始数据库位置之外创建基于文件的备份。</block>
  <block id="4627801bdbb24a1991e64f30a2d80cb1" category="paragraph">ONTAP提供了四个策略、用于控制性能层上的Oracle数据如何成为重新定位到容量层的候选对象。</block>
  <block id="2eea2725f31529888b5e57b36492819f" category="paragraph">虽然FabricPool分层在块级运行、但在某些情况下、可用于提供文件级分层。</block>
  <block id="f935a501eae76f9c13d430bc3879cd0d" category="paragraph">由于FabricPool在块级别工作、因此可能会更改的文件可以部分分层到对象存储、同时也可以部分保留在性能层上。</block>
  <block id="cc4e17c26faf6b70b383529b6215ba0f" category="doc">对象存储访问中断</block>
  <block id="ec35a176f3e7c086273baee0c7f374d5" category="paragraph">要了解FabricPool层如何影响Oracle和其他数据库、需要了解低级别FabricPool架构。</block>
  <block id="6edf1821ddc55278229c2156f42905f0" category="paragraph">分层策略用于控制将哪些Oracle数据库块从性能层分层到容量层。检索策略控制读取已分层的块时发生的情况。</block>
  <block id="d01cbb2be77343ccdb1d3372c4b9891e" category="summary">Oracle数据库LUN大小调整和LUN计数准则</block>
  <block id="51f96d1f8b50084e3a2ddc21ceef8b2f" category="paragraph">要获得Oracle数据库的最佳性能和易管理性、选择最佳LUN大小和要使用的LUN数量至关重要。</block>
  <block id="3d1bd23e74923cdc48fe992d0687809f" category="summary">Oracle数据库和NFS租用和锁定</block>
  <block id="cec6f8a988408ba212798e1cc32658c7" category="paragraph">NFSv3处于无状态。这实际上意味着、NFS服务器(ONTAP)不会跟踪挂载了哪些文件系统、由谁挂载或哪些锁定真正到位。</block>
  <block id="7c96331bd03e63c4eb3505c526b42244" category="paragraph">ONTAP确实具有一些记录挂载尝试的功能、因此您可以了解哪些客户端可能正在访问数据、并且可能存在建议锁定、但该信息并不能保证100%完整。此操作无法完成、因为跟踪NFS客户端状态不是NFSv3标准的一部分。</block>
  <block id="20733ad7135aa0ede95fd8637fe05cf6" category="section-title">NFSv4状态</block>
  <block id="3f7c11f662fc6e07a91179fdf2322ef5" category="paragraph">相反、NFSv4是有状态的。NFSv4服务器可跟踪哪些客户端正在使用哪些文件系统、哪些文件存在、哪些文件和/或文件区域被锁定等 这意味着NFSv4服务器之间需要定期进行通信、以使状态数据保持最新。</block>
  <block id="6f7e4a1e570f45fa3db0b8a0ed80a38f" category="paragraph">NFS服务器所管理的最重要状态是NFSv4锁定和NFSv4租约、它们彼此交织在一起。您需要了解每种方法本身的工作原理、以及它们之间的关系。</block>
  <block id="0d55fd4062f29237d0fb3b7f666fb8eb" category="section-title">NFSv4锁定</block>
  <block id="bf4139ff42e411ae5483e062387b3f70" category="paragraph">对于NFSv3、建议使用锁定。NFS客户端仍可修改或删除"锁定"文件。NFSv3锁定本身不会过期、必须将其删除。这会造成问题。例如、如果您有一个集群应用程序创建了NFSv3锁定、而其中一个节点发生故障、您该怎么办？您可以对运行正常的节点上的应用程序进行编码、以解除锁定、但您如何知道这是安全的？可能是"故障"节点正常运行、但未与集群的其余部分通信？</block>
  <block id="11d1c33ac6b190a233c00cdbdd6a355b" category="paragraph">对于NFSv4、锁定的持续时间有限。只要持有锁定的客户端继续向NFSv4服务器签入、就不允许任何其他客户端获取这些锁定。如果客户端无法签入NFSv4、则锁定最终会被服务器撤消、其他客户端将能够请求并获取锁定。</block>
  <block id="c17985911e0182dc5e96c4d60aadf139" category="section-title">NFSv4租约</block>
  <block id="596bcfef3aaccfe299bb45a969afcaf0" category="paragraph">NFSv4锁定与NFSv4租约关联。当NFSv4客户端与NFSv4服务器建立连接时、它将获得租约。如果客户端获得锁定(锁定类型有多种)、则锁定与租约关联。</block>
  <block id="b5248856b1835e14738aa32e053e30e0" category="paragraph">此租约已定义超时。默认情况下、ONTAP会将超时值设置为30秒：</block>
  <block id="7e2a66190f452806ac1183721a43eaa1" category="paragraph">这意味着、NFSv4客户端需要每30秒与NFSv4服务器签入一次、才能续订其租约。</block>
  <block id="809c552ae0a4d377e87f495b4e3ac62b" category="paragraph">任何活动都会自动续订租约、因此、如果客户端正在执行工作、则无需执行添加操作。如果某个应用程序变得安静并且没有执行实际工作、则需要执行某种保活操作(称为序列)。基本上只是说"我还在这里、请刷新我的租约"。</block>
  <block id="70cb78bb7e91dcafab559f9b72e40bb6" category="paragraph">NFSv3处于无状态。它不需要来自客户端的通信。NFSv4是有状态的、租赁期过后、租约将过期、锁定将被撤消、锁定的文件将提供给其他客户端使用。</block>
  <block id="2ee5d81cfa6306ae71ce534ed9b31431" category="paragraph">借助NFSv3、您可以四处移动网络缆线、重新启动网络交换机、更改配置、并确保不会发生任何不良事件。应用程序通常只需耐心等待网络连接重新工作即可。</block>
  <block id="8900ff182e4197f8eb2acd7d2b7fd902" category="paragraph">使用NFSv4时、您有30秒的时间(除非您已在ONTAP中增加了该参数的值)来完成工作。如果超过此限制、您的租约将超时。通常、这会导致应用程序崩溃。</block>
  <block id="ffa8c7744b3e2d43b18c67aec0fe7743" category="paragraph">例如、如果您有一个Oracle数据库、并且网络连接丢失(有时称为"网络分区")、超过租约超时时间、则数据库将崩溃。</block>
  <block id="33b9897348039594b4b17bf1e1629c74" category="paragraph">下面是一个示例、说明在发生这种情况时Oracle警报日志中会发生什么情况：</block>
  <block id="85608585bf8e790a579c49ba9af705c6" category="paragraph">如果您查看系统日志、应会看到以下几个错误：</block>
  <block id="e19b338de53dada4cf4da3837aaba76d" category="paragraph">日志消息通常是问题的第一个迹象、而不是应用程序冻结。通常、网络中断期间不会显示任何内容、因为尝试访问NFS文件系统的进程和操作系统本身会被阻止。</block>
  <block id="7a3c8c17a9dd10fa565f79e0ebb5bba7" category="paragraph">网络重新正常运行后、将显示这些错误。在上面的示例中、重新建立连接后、操作系统尝试重新获取锁定、但太晚了。租约已过期、锁定已被删除。这会导致错误传播到Oracle层、并在警报日志中显示此消息。根据数据库的版本和配置、这些模式可能会有所不同。</block>
  <block id="4bec5e793e34a5819aefb68e4f65db26" category="paragraph">总之、NFSv3可以承受网络中断、但NFSv4更敏感、并会规定一个明确的租赁期限。</block>
  <block id="069de2d717910b2677190b9a9b5ed1cf" category="paragraph">如果30秒超时不可接受、该怎么办？如果您管理的网络动态变化、交换机重新启动或缆线重新定位会导致网络偶尔中断、该怎么办？您可以选择延长租赁期限、但是否要延长、需要说明NFSv4宽限期。</block>
  <block id="4b84416146795544deb5c9de89187f91" category="section-title">NFSv4宽限期</block>
  <block id="7d98e091c5f7be92cd5fb85b985d8d20" category="paragraph">如果重新启动NFSv3服务器、它几乎可以立即提供IO。它并没有保持任何关于客户的状态。这样、ONTAP接管操作通常看起来接近瞬时。一旦控制器准备好开始提供数据、它就会向网络发送一个ARP、以指示拓扑发生变化。客户端通常会近乎即时地检测到这一点、数据将恢复流动。</block>
  <block id="173d4fd05086441236dbee4710639d10" category="paragraph">但是、NFSv4会短暂暂停。这只是NFSv4工作原理的一部分。</block>
  <block id="21483115213b27583a07dc2ca994671c" category="paragraph">NFSv4服务器需要跟踪租约、锁定以及谁在使用哪些数据。如果NFS服务器发生故障并重新启动、断电片刻或在维护活动期间重新启动、则会导致租用/锁定以及其他客户端信息丢失。在恢复操作之前、服务器需要确定哪个客户端正在使用哪些数据。这就是宽限期的所在。</block>
  <block id="09b6f386094bd895d3c9694f28bfdf65" category="paragraph">如果您突然关闭并重新启动NFSv4服务器。恢复后、尝试恢复IO的客户端将收到一个响应、该响应本质上说："我丢失了租用/锁定信息。是否要重新注册您的锁？" 这是宽限期的开始。在ONTAP上、默认为45秒：</block>
  <block id="e4f8aa90af36d76254e2f02e56232aed" category="paragraph">因此、在重新启动后、控制器将暂停IO、而所有客户端都将回收其租约和锁定。宽限期结束后、服务器将恢复IO操作。</block>
  <block id="bb2b26fdcb4e947cda6f8e38724ecfc9" category="section-title">租赁超时与宽限期</block>
  <block id="c4fb6f7d31d205bc07dbff47d0ae4bb3" category="summary">Oracle Direct NFS</block>
  <block id="1bd6ec1185ba67395dc6f9cd2b458ec8" category="paragraph">Oracle数据库可以通过两种方式使用NFS。</block>
  <block id="96997ca5c577dd19a3ba5f7ff771f27a" category="paragraph">首先、它可以使用通过操作系统中的本机NFS客户端挂载的文件系统。这有时称为内核NFS或kNFS。Oracle数据库挂载和使用NFS文件系统的方式与任何其他应用程序使用NFS文件系统的方式完全相同。</block>
  <block id="95c17c63df7ceea39a175b1d96955bb7" category="paragraph">第二种方法是Oracle Direct NFS (DNFS)。这是在Oracle数据库软件中实施的NFS标准。它不会更改数据库管理程序配置或管理Oracle数据库的方式。只要存储系统本身具有正确的设置、DNFS的使用就应该对DBA团队和最终用户透明。</block>
  <block id="43539d2fca21e5b644484efb94614a7b" category="paragraph">启用了DNFS功能的数据库仍会挂载常见的NFS文件系统。数据库打开后、Oracle数据库将打开一组TCP/IP会话并直接执行NFS操作。</block>
  <block id="26e7ebad3936387b4b3f7c4f5688ef27" category="section-title">直接NFS</block>
  <block id="6d431a52c8a41a7c2335f98e2ae8c454" category="paragraph">Oracle的直接NFS的主要价值是绕过主机NFS客户端、直接在NFS服务器上执行NFS文件操作。要启用此功能、只需更改Oracle磁盘管理器(ODM)库即可。Oracle文档提供了此过程的说明。</block>
  <block id="8401d91735209aeccbe56f33b4e2db73" category="paragraph">使用DNFS可以显著提高I/O性能、并减少主机和存储系统上的负载、因为I/O是以尽可能最高效的方式执行的。</block>
  <block id="b0dedecb00787180a9e0c657cfb278c9" category="paragraph">此外，Oracle DNFS还包括一个*选项*，用于实现网络接口多路径和容错。例如、可以将两个10 Gb接口绑定在一起、以提供20 Gb的带宽。一个接口发生故障会导致在另一个接口上重试I/O。整体操作与FC多路径非常相似。多路径早在几年前就已很常见、当时1 Gb以太网是最常用的标准。10 Gb NIC足以满足大多数Oracle工作负载的需求、但如果需要更多NIC、则可以绑定10 Gb NIC。</block>
  <block id="11e50b3c816105439151db3a3b4fdda3" category="paragraph">使用DNFS时、请务必安装Oracle文档1495104.1中所述的所有修补程序。如果无法安装修补程序、则必须对环境进行评估、以确保该文档中所述的错误不会出现发生原因问题。在某些情况下、无法安装所需的修补程序会导致无法使用DNFS。</block>
  <block id="8f98002fee392ad6151679875de1a7cc" category="paragraph">请勿将DNFS与任何类型的轮叫名称解析结合使用、包括DNS、DDNS、NIS或任何其他方法。其中包括ONTAP中提供的DNS负载平衡功能。当使用DNFS的Oracle数据库将主机名解析为IP地址时、它在后续查找中不得更改。这可能会导致Oracle数据库崩溃并可能导致数据损坏。</block>
  <block id="e80ad3efb180dc2d016b27506b7b24ce" category="section-title">直接NFS和主机文件系统访问</block>
  <block id="4c38a8c0a49e721bf2a378d0b4fb2010" category="paragraph">对于依赖主机上挂载的可见文件系统的应用程序或用户活动、使用DNFS有时可能会出现发生原因问题、因为DNFS客户端会从主机操作系统带外访问文件系统。DNFS客户端可以在不了解操作系统的情况下创建、删除和修改文件。</block>
  <block id="c03389fdb295f2acb079603123e6d0e3" category="paragraph">如果使用单实例数据库的挂载选项、则可以缓存文件和目录属性、这也意味着可以缓存目录的内容。因此、DNFS可以创建文件、在操作系统重新读取目录内容和文件对用户可见之前、存在一个短暂的延迟。这通常不是问题，但在极少数情况下，SAP BR*Tools等实用程序可能会出现问题。如果发生这种情况、请更改挂载选项以使用针对Oracle RAC的建议来解决此问题。此更改会导致禁用所有主机缓存。</block>
  <block id="a370a203383b565c3fb746c1c2e1a64b" category="paragraph">只有在以下情况下才更改挂载选项：(a)使用DNFS；(b)问题是由于文件可见性滞后而导致的。如果未使用DNFS、则在单实例数据库上使用Oracle RAC挂载选项会导致性能下降。</block>
  <block id="22a7a03175addfd9aa5b1fa2c351e833" category="summary">适用于Oracle数据库的NFS配置</block>
  <block id="6cb2edd2369a17890dce007723d98a6f" category="paragraph">NetApp提供企业级NFS存储已超过30年、由于其精简性、随着向基于云的基础架构的推进、其使用量也在不断增长。</block>
  <block id="0f8a941fcc56687ad8e3914162c19a41" category="section-title">NFS版本</block>
  <block id="d0972be450ccf257fb73d4878bce204e" category="paragraph">NetApp必须支持操作系统NFS客户端。</block>
  <block id="7722a2ae10cef9bccea115dfdfe78a99" category="list-text">遵循NFSv3标准的操作系统支持NFSv3。</block>
  <block id="a3550edc6962850398d217f78cc4ad0d" category="list-text">Oracle DNFS客户端支持NFSv3。</block>
  <block id="89c45ebba54478419aa679a7ece8593d" category="list-text">遵循NFSv4标准的所有操作系统均支持NFSv4。</block>
  <block id="471ff51c89daf6e35e8e2b5111039744" category="inline-link-macro">NetApp IMT</block>
  <block id="8594659e8c4292db778973052a30ab86" category="list-text">NFSv4.1和NFSv4.2需要特定的操作系统支持。请参见 <block ref="d98f827de8e80b3365d5f4160c243cdc" category="inline-link-macro-rx"></block> 支持的操作系统。</block>
  <block id="d1eb4c2a4d74705a5aa7945f734eff7c" category="list-text">为NFSv4.1提供Oracle DNFS支持需要Oracle 12.2.0.2或更高版本。</block>
  <block id="d8bacc1a7a9d6baaeb962e367920593b" category="inline-link-macro">NetApp支持表</block>
  <block id="f16dcce07ca44aa38c7ebe3016b981b2" category="admonition">。 <block ref="f1e4f72fb4419d4270270c5ed1e0d9f6" category="inline-link-macro-rx"></block> 对于NFSv3和NFSv4、不包括特定的操作系统。通常支持所有符合RFC的操作系统。在联机IMT中搜索NFSv3或NFSv4支持时、请勿选择特定操作系统、因为不会显示任何匹配项。常规策略隐式支持所有操作系统。</block>
  <block id="26ed9768d6a659a9768842d903d0025f" category="section-title">Linux NFSv3 TCP插槽表</block>
  <block id="c56ec9836fbbd9c0a426a40fc71c265c" category="paragraph">TCP插槽表相当于主机总线适配器(Host Bus Adapter、HBA)队列深度的NFSv3。这些表可控制任何时候都可以处理的NFS操作的数量。默认值通常为16、该值太低、无法实现最佳性能。在较新的Linux内核上会出现相反的问题、这会自动将TCP插槽表限制增加到使NFS服务器充满请求的级别。</block>
  <block id="5270700baa50d07af667096293a27564" category="paragraph">为了获得最佳性能并防止出现性能问题、请调整控制TCP插槽表的内核参数。</block>
  <block id="5b29db1d99e19013580fa375a5f87fa5" category="paragraph">运行<block ref="1a1e44f7a3390ed4647a7d5b7e8b08ed" prefix=" " category="inline-code"></block> 命令、并观察以下参数：</block>
  <block id="8821adf56df4952370cfaa57ccaac68d" category="paragraph">所有Linux系统都应包括<block ref="c5f48b899461d4c2b9ddc0b24ea87744" prefix=" " category="inline-code"></block>，但只有部分包括<block ref="6f72acaebcb9a0de6696aaf3508a6144" prefix=" " category="inline-code"></block>。它们都应设置为128。</block>
  <block id="3a954c4e5e8d5ac3af590651efc5a2cb" category="cell">如果未设置这些参数、可能会对性能产生显著影响。在某些情况下、性能会受到限制、因为Linux操作系统发出的I/O不足在其他情况下、随着Linux操作系统尝试问题描述的I/O数超过可处理的I/O数、I/O时间会增加。</block>
  <block id="837f157b2f309f5415420467f7643e3a" category="section-title">ADr和NFS</block>
  <block id="c0e7bb1383be0bf1268d1d70280bef6d" category="paragraph">一些客户报告了因中的数据量过多而导致的性能问题<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 位置。通常、只有在积累了大量性能数据之后、才会出现此问题。I/O过多的原因未知、但此问题似乎是由Oracle进程反复扫描目标目录以查找更改引起的。</block>
  <block id="99be2ae95d50120a7c33c818afda1834" category="paragraph">卸下<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和 / 或<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 挂载选项允许进行主机操作系统缓存并降低存储I/O级别。</block>
  <block id="8950578c587f9503f949dfc6a274b611" category="admonition">* NetApp建议*不要放置<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 使用的文件系统上的数据<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 或<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 因为可能会出现性能问题。分开<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 如果需要、可将数据迁移到其他挂载点。</block>
  <block id="cdb92b4a73ae99cde4df55c06e20dd3c" category="section-title">NFS-rootonly和mount-rootonly</block>
  <block id="c1f0a21ee026237bef11139a30b07040" category="paragraph">ONTAP包含一个名为的NFS选项<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 用于控制服务器是否接受来自高端口的NFS流量连接。作为一项安全措施、只有root用户才允许使用1024以下的源端口打开TCP/IP连接、因为此类端口通常保留供操作系统使用、而不是供用户进程使用。此限制有助于确保NFS流量来自实际操作系统NFS客户端、而不是模拟NFS客户端的恶意进程。Oracle DNFS客户端是用户空间驱动程序、但该进程以root用户身份运行、因此通常不需要更改的值<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block>。这些连接是从低端口进行的。</block>
  <block id="832b4524bcec11d28ca777ef9cdb4084" category="paragraph">。<block ref="eb6c1a5ecd1e17d4cd46fa5c9d415816" prefix=" " category="inline-code"></block> 仅选件适用场景NFSv3。它控制是否从大于1024的端口接受RPC挂载调用。使用DNFS时、客户端将再次以root身份运行、因此它可以打开1024以下的端口。此参数无效。</block>
  <block id="57c47a1451485bec1ebb060afdf65cb4" category="paragraph">通过NFS 4.0及更高版本打开与DNFS连接的进程不会以root身份运行、因此需要1024以上的端口。。<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 必须将参数设置为disabled、DNFS才能完成连接。</block>
  <block id="4dd73247734d116e5039cc04c4979f2c" category="paragraph">条件<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 处于启用状态、则会在打开DNFS连接的挂载阶段挂起。sqlplus输出类似于：</block>
  <block id="f62d72479920ff0f8dc9a3ca6f301b5d" category="paragraph">可以按如下方式更改此参数：</block>
  <block id="47fc6c6691aed3ba0dbdc66c7896c61b" category="admonition">在极少数情况下、您可能需要将NFS-rootonly和mount-rootonly更改为disabled。如果服务器管理的TCP连接数量非常多、则可能没有低于1024的可用端口、并且操作系统会强制使用更高的端口。要完成连接、需要更改这两个ONTAP参数。</block>
  <block id="10b4eb170fe7bd035f21e7d863796683" category="section-title">NFS导出策略：super用户 和set_id</block>
  <block id="98bfec37486e95443730cc3d462022fb" category="paragraph">如果Oracle二进制文件位于NFS共享上、则导出策略必须包括超级用户和set_id权限。</block>
  <block id="3c0699ba2c56cb17c145bbda5580ed67" category="paragraph">用于用户主目录等通用文件服务的共享NFS导出通常会强制转换root用户。这意味着挂载了文件系统的主机上的root用户发出的请求会重新映射为权限较低的其他用户。这有助于防止特定服务器上的root用户访问共享服务器上的数据、从而保护数据安全。在共享环境中、set_id位也可能存在安全风险。set_id位允许以与调用命令的用户不同的用户身份运行进程。例如、由root用户拥有且具有set_id位的shell脚本以root用户身份运行。如果其他用户可以更改该shell脚本、则任何非root用户都可以通过更新脚本以root用户身份问题描述命令。</block>
  <block id="e341736b7d51c23cb7ef95615832e502" category="paragraph">Oracle二进制文件包含root用户拥有的文件、并使用set_id位。如果在NFS共享上安装了Oracle二进制文件、则导出策略必须包含适当的超级用户和set_id权限。在以下示例中、此规则同时包含这两者<block ref="1efaeada4e3307369aca511f5da0498a" prefix=" " category="inline-code"></block> 和许可<block ref="0baea2f0ae20150db78f58cddac442a9" prefix=" " category="inline-code"></block> 使用系统身份验证的NFS客户端的(root)访问权限。</block>
  <block id="f1a0fa258c785ac546835a1a75017faf" category="section-title">NFSv4/4.1配置</block>
  <block id="52f9ad2e353a42e61d9bf7dd9f59d0cb" category="paragraph">对于大多数应用程序、NFS3和NFSv4之间的差别非常小。应用程序I/O通常非常简单、不会从NFSv4中提供的某些高级功能中显著受益。从数据库存储角度来看、较高版本的NFS不应视为"升级"、而应视为包含其他功能的NFS版本。例如、如果需要Kerberos隐私模式(krb5p)的端到端安全性、则需要NFSv4。</block>
  <block id="a1dc4350330c061ae52050f5a3400e25" category="section-title">NFSv4域</block>
  <block id="c30669603c950b31f6093d8beaf8060a" category="paragraph">有关NFSv4/4.1配置的完整说明不在本文档的讨论范围之内、但一个常见问题是域映射不匹配。从sysadmin的角度来看、NFS文件系统似乎运行正常、但应用程序会报告有关某些文件的权限和/或set_id的错误。在某些情况下、管理员错误地得出结论、认为应用程序二进制文件的权限已损坏、并在实际问题是域名时运行了chown或chmod命令。</block>
  <block id="f0c6c8a632eeaa954640907ee1da277d" category="paragraph">在ONTAP SVM上设置NFSv4域名：</block>
  <block id="97a98ebe6ac1f4a8eaf69158419dd818" category="paragraph">主机上的NFSv4域名在中进行设置<block ref="60969252b5b8391a3378335ae420d2e8" prefix=" " category="inline-code"></block></block>
  <block id="4ade50e8135e817e75aa3086851eaaa8" category="paragraph">域名必须匹配。否则、中将显示类似以下内容的映射错误<block ref="452905a167cf4509fd08acb964fdb20c" prefix=" " category="inline-code"></block>：</block>
  <block id="c0eb73bb35a4c58d87b330cd00f1986a" category="paragraph">应用程序二进制文件(如Oracle数据库二进制文件)包括root用户拥有的具有set_id位的文件、这意味着NFSv4域名不匹配会导致Oracle启动失败、并显示有关名为的文件的所有权或权限的警告<block ref="dd440398b298ff16eb1188ba8afca6df" prefix=" " category="inline-code"></block>，位于中<block ref="002f94d606ac06f290f33a5fcc67b264" prefix=" " category="inline-code"></block> 目录。它应如下所示：</block>
  <block id="21cc6f8790de2a7022b344914915604e" category="paragraph">如果此文件的所有权为mody、则可能存在NFSv4域映射问题。</block>
  <block id="203f1cdb2421d34e9eb7391e03ffcaf6" category="paragraph">要修复此问题、请选中<block ref="60969252b5b8391a3378335ae420d2e8" prefix=" " category="inline-code"></block> 根据ONTAP上的v4-id-domain设置创建文件、并确保它们一致。如果不是、请进行所需的更改、然后运行<block ref="1c7ebfbcaa2681599e41320ed491ca91" prefix=" " category="inline-code"></block>，然后等待片刻，让更改传播。然后、文件所有权应正确识别为root。如果用户尝试运行<block ref="05f0da969f2e0e6ecf3ab445e1e665ad" prefix=" " category="inline-code"></block> 更正NFS域配置之前、可能需要在此文件上运行<block ref="05f0da969f2e0e6ecf3ab445e1e665ad" prefix=" " category="inline-code"></block> 再次重申。</block>
  <block id="748f6387bf49161b9a69b7bfd691dcd2" category="paragraph">如果存在以下任一挂载选项、则会禁用主机缓存：</block>
  <block id="9f75df502ef11eaef4292c94110cb673" category="paragraph">这些设置可能会对软件安装、修补和备份/还原操作的速度产生严重的负面影响。在某些情况下、尤其是对于集群应用程序、由于需要在集群中的所有节点之间实现缓存一致性、因此必然需要使用这些选项。在其他情况下、客户会错误地使用这些参数、从而导致不必要的性能损害。</block>
  <block id="8d23519d53d6611bc42fef8dc4a432df" category="paragraph">许多客户会在安装或修补应用程序二进制文件期间临时删除这些挂载选项。如果用户验证在安装或修补过程中没有其他进程正在使用目标目录、则可以安全地执行此删除。</block>
  <block id="f73bede4039d47664f70de3c2d1f2b46" category="summary">Oracle数据库的LVM条带配置</block>
  <block id="1b5681ffc153e25d2a48ae3f3f01b9f5" category="paragraph">LVM条带化是指在多个LUN之间分布数据。结果是、许多数据库的性能显著提高。</block>
  <block id="358b9a846de3e04b423c68bac9bc6d53" category="summary">LUN与Oracle数据库对齐</block>
  <block id="3e00e4d28b17eedd6f6c2c38233e06a8" category="paragraph">LUN对齐是指针对底层文件系统布局优化I/O。</block>
  <block id="a6c7e85d51ae3b98197ceb3eafa3686a" category="inline-link-macro">效率</block>
  <block id="6e2524d5663b2bdc0c7985fa3e57cc55" category="section-title">未对齐警告</block>
  <block id="79e721357e358d77c4700c25c863fc37" category="inline-link">ONTAP SAN 主机配置</block>
  <block id="268b1da3f1ff11d32e385d0223101718" category="paragraph">Solaris环境中的对齐更为复杂。请参见<block ref="2d33e0364c07dc165b4079892340d4fe" category="inline-link-rx"></block> 有关详细信息 ...</block>
  <block id="6d017248f1e4f0ec7e2cd19d967b6bee" category="cell">在Solaris x86环境中，请格外注意正确对齐，因为大多数配置都有多个分区层。Solaris x86分区片通常位于标准主引导记录分区表之上。</block>
  <block id="b1230060a0220caf9d68d64b9dd85e6f" category="summary">使用Oracle时的NFS传输大小</block>
  <block id="fabe34ed4a5e432f4d1c4f6584956d8d" category="doc">Oracle数据库的NFS传输大小</block>
  <block id="1e207db9a7c8127a6c43c771b89254fb" category="paragraph">默认情况下、ONTAP会将NFS I/O大小限制为64K。</block>
  <block id="72d22e3b9af95e272859e64eb1d82df7" category="paragraph">大多数应用程序和数据库的随机I/O使用的块大小要小得多、远远低于64K的最大值。大型块I/O通常会并行处理、因此最大64K也不会限制获得最大带宽。</block>
  <block id="ebf61afddb34d070825eb696bea48813" category="paragraph">在某些工作负载中、最大64K会产生限制。特别是、如果数据库执行的I/O数量较少但规模较大、则单线程操作(例如备份或恢复操作或数据库完整表扫描)运行速度会更快、效率也会更高。ONTAP的最佳I/O处理大小为256K。</block>
  <block id="b0a5b394f3a29e64573049cda19fbacc" category="paragraph">给定ONTAP SVM的最大传输大小可按如下方式进行更改：</block>
  <block id="b070b82d66be7116d5fd6dfd8172351b" category="cell">请勿将ONTAP上允许的最大传输大小减小到低于当前挂载的NFS文件系统的rsize/wsize值。在某些操作系统中、这可能会导致挂起甚至数据损坏。例如、如果NFS客户端当前设置为rsize/wsize 65536,则ONTAP最大传输大小可以在65536- 1048576之间进行调整,但不会产生任何影响,因为客户端本身是有限的。将最大传输大小减小至65536,可能会损坏可用性或数据。</block>
  <block id="8eb703f2756cafd21dbac4f23c0d6416" category="paragraph">启用实时压缩后、ONTAP可以高效删除写入文件或LUN的置零块。Oracle ASM Recasation Utility (ARU)等实用程序的工作方式是向未使用的ASM块区写入零。</block>
  <block id="9de53c14f2bae0c5d4b6e19be495ee94" category="paragraph">从数据库角度来看、ASM磁盘组包含零、读取这些LUN区域会产生零流、但ONTAP不会将零存储在驱动器上。而是进行简单的元数据更改、以便在内部将LUN的置零区域标记为任何数据为空。</block>
  <block id="06348c6e795160187e298a91b25a37a3" category="paragraph">出于类似的原因、涉及置零数据的性能测试无效、因为零块实际上不会在存储阵列中作为写入进行处理。</block>
  <block id="cee584f1e6223f6dbb73c0d64d599228" category="admonition">使用ARU时、请确保已安装Oracle建议的所有修补程序。</block>
  <block id="17ff263bc6eb701aecb8e79f9ef53efd" category="summary">使用Oracle数据库调整LUN和LVM大小</block>
  <block id="ff15e8b125dae74c1231f09380e48886" category="paragraph">当基于SAN的文件系统达到其容量限制时、可通过两种方法增加可用空间：</block>
  <block id="4182200437c090276a01ad8ca54076b0" category="summary">配置NVFAIL以保护Oracle数据库</block>
  <block id="60e002164f8988e984cf4a95b240f19d" category="doc">Oracle和NVFAIL</block>
  <block id="370bdf5dd39278264774ea595054e243" category="paragraph">NVFAIL是ONTAP中的一项功能、可确保在灾难性故障转移情形下的完整性。</block>
  <block id="80250c1f1d70fc693877be6f22cc134e" category="paragraph">数据库在存储故障转移事件期间容易损坏、因为它们会维护大量内部缓存。如果在发生灾难性事件时需要强制执行ONTAP故障转移或强制执行MetroCluster切换、而不管整体配置的运行状况如何、则先前确认的结果可能会被有效丢弃。存储阵列的内容会及时向后跳转、数据库缓存的状态不再反映磁盘上数据的状态。此不一致性会导致数据损坏。</block>
  <block id="68114defc717054e7e3b02df438cdbe1" category="paragraph">缓存可以在应用程序层或服务器层进行。例如、如果Oracle Real Application Cluster (RAC)配置中的服务器在主站点和远程站点上都处于活动状态、则该配置会在Oracle SGA中缓存数据。如果强制切换操作导致数据丢失、则会使数据库面临损坏的风险、因为存储在SGA中的块可能与磁盘上的块不匹配。</block>
  <block id="162de6d405c04ce8f152f1d246ed9187" category="paragraph">在操作系统文件系统层使用缓存不太明显。装载的NFS文件系统中的块可能会缓存在操作系统中。或者、可以将基于主站点上LUN的集群文件系统挂载到远程站点的服务器上、然后再次缓存数据。在这些情况下、NVRAM故障、强制接管或强制切换可能会导致文件系统损坏。</block>
  <block id="04ca8d9ad570a3bdf1d76e23bc108ae5" category="paragraph">ONTAP通过NVFAIL及其关联设置、保护数据库和操作系统免受这种情况的影响。</block>
  <block id="82ef718f4ebe0c276814ee3d51e33361" category="doc">SnapRestore</block>
  <block id="863696626734d6591db8be57b41c7eec" category="paragraph">NetApp SnapRestore技术可在ONTAP中从快照快速恢复数据。</block>
  <block id="9099b669f87419bc03914f11f5779c60" category="paragraph">当关键数据集不可用时、关键业务运营将中断。磁带可能会中断、甚至从基于磁盘的备份中恢复的速度也可能很慢、无法通过网络传输。SnapRestore通过近乎即时地还原数据集来避免这些问题。即使是PB级数据库、也只需几分钟的时间即可完全还原。</block>
  <block id="b02fb7dec22d0e276ca01cc60b9efb48" category="paragraph">SnapRestore有两种形式：基于文件/LUN和基于卷。</block>
  <block id="520e4b70b10aa2755a82b77e438a510f" category="list-text">单个文件或LUN可以在几秒钟内还原、无论它是2 TB LUN还是4 KB文件。</block>
  <block id="45e8a84fe4ac58c8b30a7bdaf17c0b7f" category="list-text">文件或LUN容器可以在几秒钟内还原、无论数据大小是10 GB还是100 TB。</block>
  <block id="4be4677be8cd434956b9b9af515b971a" category="paragraph">"文件或LUN容器"通常指FlexVol卷。例如、一个卷中可能有10个LUN构成一个LVM磁盘组、或者一个卷可能会存储包含1000个用户的NFS主目录。您可以将整个卷作为一个操作来还原、而不是对每个文件或LUN执行还原操作。此过程还适用于包含多个卷的横向扩展容器、例如FlexGroup或ONTAP一致性组。</block>
  <block id="55abea92d64d6738f9e0ed48799696e7" category="paragraph">ONTAP仅允许对快照数据进行只读访问、但可以使用SnapRestore重新激活这些数据。快照将重新启用为数据的读写视图、从而将数据恢复到先前的状态。SnapRestore可以在卷或文件级别运行。该技术本质上是相同的、但行为略有不同。</block>
  <block id="f10f2af75e2770a8ed3c2fde594e986d" category="section-title">Volume SnapRestore</block>
  <block id="ca9846346bc3b03cdec10f9fff456866" category="paragraph">基于卷的SnapRestore会将整个数据卷返回到先前的状态。此操作不需要移动数据、这意味着还原过程基本上是瞬时的、尽管处理API或CLI操作可能需要几秒钟时间。还原1 GB的数据并不比还原1 PB的数据更复杂、也不会更耗时。这一功能是许多企业客户迁移到ONTAP存储系统的主要原因。即使是最大的数据集、它也能以秒为单位提供一个RTO。</block>
  <block id="627436e77bb011a6a312ae87b12f98ea" category="paragraph">基于卷的SnapRestore的一个缺点是、卷内的更改会随着时间的推移而累积。因此、每个快照和活动文件数据都取决于到那时为止所做的更改。将卷还原到早期状态意味着、系统将会先对数据进行所有后续更改、然后再进行相应的更改。但是、不太明显的是、这包括随后创建的快照。这并不总是可取的。</block>
  <block id="5c956f2c1cfc5b9e5bac32ad1acba314" category="paragraph">例如、数据保留SLA可能指定30天的夜间备份。如果将数据集还原到五天前使用卷SnapRestore创建的快照、则会丢弃前五天创建的所有快照、从而违反SLA。</block>
  <block id="8bf9e697004f47ed6133aef724a8a42c" category="paragraph">有许多选项可用于解决此限制：</block>
  <block id="ad3b75456e625de5fe347fb918f59a22" category="list-text">可以从先前的快照复制数据、而不是对整个卷执行SnapRestore。此方法最适合较小的数据集。</block>
  <block id="90541eb74c7c56cadc2f90ec6fb6f0c0" category="list-text">快照可以克隆、而不是还原。此方法的限制是、源快照是克隆的依赖项。因此、除非同时删除克隆或将其拆分成独立的卷、否则无法将其删除。</block>
  <block id="ab6045d3463c0f68ce2fa405dce9d554" category="list-text">使用基于文件的SnapRestore。</block>
  <block id="7f7599a8b92846b691484dc91e090164" category="section-title">File SnapRestore</block>
  <block id="f03eebe4f07d362dbfe4c1d4e76c724d" category="paragraph">基于文件的SnapRestore是一种基于快照的更精细还原过程。系统会还原单个文件或LUN的状态、而不是还原整个卷的状态。无需删除任何快照、此操作也不会对先前的快照创建任何依赖关系。文件或LUN将立即在活动卷中可用。</block>
  <block id="e432fdcc277fc74a1b2b94cfeec8a7d2" category="paragraph">在对文件或LUN执行SnapRestore还原期间、不需要移动数据。但是、需要进行一些内部元数据更新、以反映文件或LUN中的底层块现在同时位于快照和活动卷中这一事实。此过程不会对性能产生任何影响、但会阻止创建快照、直到创建完成为止。根据所还原文件的总大小、处理速率约为5 Gbps (18 TB/小时)。</block>
  <block id="45c46768a1cb073f0d13245a0dc816f2" category="paragraph">正确的企业级数据保护架构取决于数据保留、可恢复性以及在各种事件期间对中断的承受能力方面的业务要求。</block>
  <block id="46e1b2893bdb002c0ede448cbfe1cb14" category="paragraph">例如、考虑范围内的应用程序、数据库和重要数据集的数量。为单个数据集构建备份策略以确保符合典型SLA要求相当简单、因为无需管理太多对象。随着数据集数量的增加、监控变得更加复杂、管理员可能不得不花费越来越多的时间来解决备份故障。随着环境达到云和服务提供商规模、需要采用完全不同的方法。</block>
  <block id="b70d233428e03d072b1134a97d853ab2" category="paragraph">数据集大小也会影响策略。例如、由于数据集非常小、因此对于使用100 GB数据库进行备份和恢复、有许多选项可供选择。只需使用传统工具从备份介质中复制数据、通常就能提供足够的恢复回路(Recovery)。100 TB数据库通常需要完全不同的策略、除非RTO允许发生多天中断、在这种情况下、可以使用基于副本的传统备份和恢复操作步骤。</block>
  <block id="64848fee9c168231f5d0f13322ed0a87" category="paragraph">最后、备份和恢复过程本身之外还有其他因素。例如、是否存在支持关键生产活动的数据库、从而使恢复成为仅由熟练的数据库管理人员执行的罕见事件？或者、数据库是否属于一个大型开发环境、在该环境中、恢复频繁发生、并由一个通才型IT团队进行管理？</block>
  <block id="e26b57887de9a65c0316a87d49bf6c44" category="section-title">快照是否为备份？</block>
  <block id="c3fd105ab426caff0a0ade2e93476543" category="paragraph">对于将快照用作数据保护策略、一个常见的异议是、"实际"数据和快照数据位于同一个驱动器上。丢失这些驱动器将导致主数据和备份均丢失。</block>
  <block id="12d1adb01d24027626b2a47660fb5b81" category="paragraph">这是一个合理的问题。本地快照用于满足日常备份和恢复需求、在这方面、快照是备份。在NetApp环境中、几乎99%的恢复方案都依靠快照来满足最苛刻的恢复时间要求。</block>
  <block id="fc34c9966c8ecb7307468637d9e79933" category="paragraph">但是、本地快照绝不是唯一的备份策略、这就是NetApp提供SnapMirror复制等技术来快速高效地将快照复制到一组独立驱动器的原因。在采用快照和快照复制功能且架构合理的解决方案中、磁带的使用量可以降至最低、甚至可以每季度归档一次、也可以完全避免。</block>
  <block id="1ea948130a9dbbc02e3a80648a99ff57" category="section-title">一致性组备份</block>
  <block id="9b234a126e57777ab83807827d4e7078" category="paragraph">一致性组备份涉及捕获一个或多个数据集在一个原子时间点的状态。作为数据库示例、这包括所有数据库组件、例如数据文件、日志文件以及与数据库直接关联的其他文件。这几乎适用于所有关系数据库产品、包括Oracle RDBMS、Microsoft SQL Server、SAP HANA、PostgreSQL、 MySQL和MariaDB。使用一致性组备份保护VMware配置的方法与此类似、即在一个原子时间点捕获所有数据存储库、并可能捕获ESX启动LUN。</block>
  <block id="5a1f7038c74e54c08669efa6722f1091" category="paragraph">创建此类一致性组快照本质上是模拟崩溃、因此、此类备份经常称为崩溃状态一致的备份。有时、对恢复方案的支持存在顾虑、但请务必了解、通常不需要恢复操作步骤。当应用程序在还原一致性组备份后启动时、它会执行常规日志恢复过程、文件系统日志重放以及其他任务、以重放备份时传输中的任何I/O。然后、应用程序将照常启动。</block>
  <block id="aebdbddec25f7eba6434244a989fb659" category="paragraph">从本质上说、可以通过这种方式保护任何能够承受电源故障或服务器崩溃而不会损坏数据的应用程序。许多不同供应商提供的同步和异步镜像产品所保护的大量应用程序也证明了这一点。如果主站点突然发生灾难、则副本站点将包含发生灾难时原始环境的一致映像。同样、不需要特殊的恢复操作步骤。</block>
  <block id="e085ffefd89f8fb66260a9720e3fb6f8" category="paragraph">此方法的RPO通常仅限于备份点。一般来说、单卷快照的最小RPO为一小时。例如、48个每小时快照加上另外30天的每晚快照是合理的、不需要保留过多的快照。低于一小时的RPO将更难实现、因此、如果事先未咨询NetApp专业服务以了解环境、扩展和数据保护要求、则不建议这样做。</block>
  <block id="1fe119a790b393b7dd7e79b63f15f52b" category="paragraph">通常、可以以秒为单位测量RTO。应用程序关闭、卷还原、应用程序重新启动。</block>
  <block id="444cd304758b7607c8f7a3f627a5bc1f" category="paragraph">最简单的方法是将所有文件或LUN放在一个卷一致性组中、这样便可直接在ONTAP中计划快照创建。如果数据集必须跨越多个卷、则需要一致性组快照(CG快照)。这可以使用System Manager或还原API调用进行配置、此外、SnapCenter还能够在定义的卷列表上创建简单的一致性组快照。</block>
  <block id="689b0155b42a554594a44cddc736eb67" category="section-title">复制和灾难恢复架构</block>
  <block id="1749d12df3df2319d3eee218a277ff83" category="inline-link-macro">MetroCluster</block>
  <block id="f443592081a2b3ddc55b94abe49ba128" category="paragraph">灾难恢复RPO受可用网络带宽和所保护数据的总大小限制。创建初始基线传输后、更新仅基于更改后的数据、尽管存在例外情况、但更改后的数据在总数据占用空间中所占的百分比通常很低。</block>
  <block id="89e87a831dae60244ba34496d70fd45d" category="paragraph">例如、一个每周变更率为10%的10 TB数据库平均每小时总变更大约为6 GB。如果使用10 Gb连接、则此数据库需要大约6分钟的传输时间。更改率随数据库更改率的波动而变化、但整体更新间隔为15分钟、因此应可实现15分钟RPO。如果有100个此类数据库、则需要600分钟来传输数据。因此、无法实现1小时的RPO。同样、一个大小为100 TB且每周变更率为10%的数据库的副本无法在一小时内可靠地更新。</block>
  <block id="3c886a803aef21f5ac9f7bcea7408cbb" category="paragraph">其他因素可能会影响复制、例如复制开销和并发复制操作数限制。但是、单卷复制策略的整体规划可以基于可用带宽、通常可以实现一小时的复制RPO。低于一小时的RPO将更难实现、只能在咨询NetApp专业服务后执行。在某些情况下、如果站点间网络连接良好、则15分钟是可行的。但是、总体而言、如果需要的RPO低于一小时、则多卷日志重放架构可以获得更好的结果。</block>
  <block id="5e2cbdd214e7a73bca1af8ed5cc04626" category="paragraph">在灾难恢复场景中、具有一致性组复制的恢复时间(从存储角度来看、通常以秒为单位)非常出色。最直接的方法是简单地中断镜像、数据库已准备就绪、可以启动。数据库启动时间通常约为10秒、但包含大量记录事务的大型数据库可能需要几分钟的时间。</block>
  <block id="1c18c939e73ddb1ceee34e8a33079d1a" category="paragraph">确定ROTO的更重要因素不是存储系统、而是运行它的应用程序和主机操作系统。例如、复制的数据可以在一两秒钟内提供、但这仅表示数据。此外、还必须有一个配置正确的操作系统、其中包含可用于数据的应用程序二进制文件。</block>
  <block id="6fab898feea25b9d7fd4477911b90b31" category="paragraph">在某些情况下、客户会提前准备灾难恢复实例、并在操作系统上预先发现存储。在这些情况下、激活灾难恢复方案只需要中断镜像并启动应用程序即可。在其他情况下、操作系统和关联应用程序可能会作为ESX虚拟机磁盘(VMDK)与数据库一起镜像。在这些情况下、RPO取决于客户在自动化方面的投入、以快速启动VMDK、从而可以启动应用程序。</block>
  <block id="c7d5d755b896edf43189fbb020202913" category="paragraph">保留时间部分由快照限制控制。例如、ONTAP中的卷限制为1024个快照。在某些情况下、客户会通过多路复用复制来增加限制。例如、如果需要2000天的备份、则可以将一个源复制到两个卷、并在备用日期进行更新。这需要增加初始所需空间、但与涉及多个完整备份的传统备份系统相比、这种方法的效率要高得多。</block>
  <block id="7ec0f114b69016879106b5018cdf10b9" category="section-title">单卷一致性组</block>
  <block id="cd70f3e596e275fe80fbbe5d7858ce1a" category="paragraph">最简单的方法是将所有文件或LUN放在一个卷一致性组中、这样可以直接在存储系统上计划SnapMirror和SnapVault更新。不需要外部软件。</block>
  <block id="909e8df57072d0b3c6d7d64b11acb571" category="section-title">多卷一致性组</block>
  <block id="c7371eded617935ace6c71a33cfbf3fd" category="paragraph">如果数据库必须跨越多个卷、则需要一致性组快照(CG快照)。如上所述、可以使用System Manager或还原API调用来配置此功能、此外、SnapCenter还能够在定义的卷列表上创建简单的一致性组快照。</block>
  <block id="9c991b38c054d7bec0632efd6667540c" category="paragraph">此外、还需要考虑将多卷一致快照用于灾难恢复的问题。在更新多个卷时、可能会在传输过程中发生灾难。结果将是一组彼此不一致的卷。如果发生这种情况、则必须将某些卷还原到先前的快照状态、以提供崩溃状态一致且可供使用的数据库映像。</block>
  <block id="fad8a5f46ebd89f74383b461e32dd6b9" category="section-title">灾难恢复：激活</block>
  <block id="5ac319591298468b0af89c2c469201f8" category="paragraph">激活灾难恢复副本的过程取决于存储类型。通过NFS、可以在灾难恢复服务器上预挂载文件系统。它们处于只读状态、并在镜像中断后变为读写状态。这样可实现极低的RPO、而且由于需要管理的部件较少、因此整个灾难恢复过程更可靠。</block>
  <block id="b829fc11ff11b57af8d4632d38d7d7e8" category="paragraph">在发生灾难恢复时激活SAN配置会变得更加复杂。最简单的方法通常是临时中断镜像并挂载SAN资源、包括发现LVM配置(包括Oracle自动存储管理[ASM]等应用程序专用功能)以及向/etc/fstab中添加条目等步骤。</block>
  <block id="335a5796fb106a877544d121062534be" category="paragraph">这样、目标服务器就可以识别LUN设备路径、卷组名称和其他设备路径。然后、可以关闭这些资源、然后还原镜像。这样、服务器就会处于可以快速使应用程序联机的状态。激活卷组、挂载文件系统或启动数据库和应用程序的步骤可以轻松实现自动化。</block>
  <block id="b1a175c5f42da29f6c27f4ea29684b63" category="paragraph">必须注意确保灾难恢复环境是最新的。例如、可能会向源服务器添加新的LUN、这意味着必须在目标上预先发现新的LUN、以确保灾难恢复计划按预期运行。</block>
  <block id="90426ba53f908049843b3ea392578d04" category="doc">Oracle灾难恢复</block>
  <block id="2a4fa9d9434561574119e3086112023f" category="paragraph">使用单个快照保护数据文件、归档日志、重做日志和控制文件是一种有效的备份、还原和复制方法。  但是、RPO仅限于备份本身的时间点。它适用于一小时或更长时间的RPO。如果数据库跨越多个卷、则需要使用前面讨论的工具之一创建CG快照。</block>
  <block id="93310f4cebc752304c164f00d67e0bca" category="paragraph">例如、整个数据库可以位于具有以下快照计划的单个卷中：</block>
  <block id="a33821be4b3522d65daed1ec317299f6" category="list-text">72个每小时快照</block>
  <block id="0eea0679ac7bf43c19d603cd78e81de9" category="list-text">30个夜间快照</block>
  <block id="c4546c401776d279c5577011584577fa" category="list-text">12个月快照</block>
  <block id="b63db1b650d128c342617b377baf928a" category="paragraph">这样、在前72小时的滚动期间便可实现1小时的RPO、并可提供额外的每晚和每月备份。还可以在单个卷或一组CG快照中包含多个数据库或应用程序文件、以便在更大的环境中提供一致的备份。</block>
  <block id="686540783626106489734a1990d4930d" category="paragraph">ONTAP旨在最大程度地提高Oracle数据库的可用性。本文档不会介绍完整的ONTAP高可用性功能问题描述。但是、与数据保护一样、在设计数据库基础架构时、基本了解此功能非常重要。</block>
  <block id="b049fcbe8198301adc6bf87634a02845" category="section-title">HA 对</block>
  <block id="1a7c11d1e2d03d3d1b57cff284ebd761" category="paragraph">高可用性的基本单位是HA对。每个对都包含冗余链路、以支持将数据复制到NVRAM。NVRAM不是写入缓存。控制器中的RAM用作写入缓存。NVRAM的用途是临时记录数据、以防止发生意外系统故障。在这方面、它类似于数据库重做日志。</block>
  <block id="cd2e54027dfcfeddd07ddd580db527c0" category="paragraph">NVRAM和数据库重做日志均用于快速存储数据、从而可以尽快提交对数据的更改。直到稍后在ONTAP和大多数数据库平台上的一个称为检查点的过程中、才会更新驱动器(或数据文件)上的永久性数据。在正常操作期间、不会读取NVRAM数据和数据库重做日志。</block>
  <block id="4e044ec0c36e513506c77c0a97d53539" category="paragraph">如果控制器突然出现故障、NVRAM中可能会存储一些尚未写入驱动器的待处理更改。配对控制器会检测到故障、控制驱动器并应用NVRAM中存储的所需更改。</block>
  <block id="310e46747ebab6a43d5a15998f6e2b33" category="section-title">接管和交还</block>
  <block id="1d739263e44469ad28f77fe7329fa78d" category="paragraph">接管和交还是指在HA对中的节点之间转移存储资源职责的过程。接管和返回有两个方面：</block>
  <block id="f2d43d90397aa8140414437eda14febb" category="list-text">管理允许访问驱动器的网络连接</block>
  <block id="6e1c794c81468e3286a23138460bb3fb" category="list-text">驱动器本身的管理</block>
  <block id="89d3f6c60c53a11e16a6756bde03ca00" category="paragraph">支持CIFS和NFS流量的网络接口配置了主位置和故障转移位置。接管包括将网络接口移动到与原始位置位于同一子网的物理接口上的临时主端口。交还包括将网络接口移回其原始位置。可以根据需要调整确切的行为。</block>
  <block id="108018656caf59cc565f1172047dab38" category="paragraph">在接管和回放期间、不会重新定位支持iSCSI和FC等SAN块协议的网络接口。而是应使用包含完整HA对的路径来配置LUN、从而生成主路径和二级路径。</block>
  <block id="80795d5dd590e432b4f5945aba47caf4" category="admonition">此外、还可以配置指向其他控制器的其他路径、以支持在较大集群中的节点之间重新定位数据、但这不是HA过程的一部分。</block>
  <block id="aae63904d16fd1c522dc5ff53eb695b5" category="paragraph">接管和返回的第二个方面是磁盘所有权的传输。具体过程取决于多个因素、包括接管/还原的原因以及发出的命令行选项。目标是尽可能高效地执行操作。虽然整个过程看起来可能需要几分钟时间、但驱动器所有权从一个节点转换到另一个节点的实际时刻通常可以以秒为单位进行衡量。</block>
  <block id="61775b9e8f759f26eafd6b03448d1f30" category="section-title">接管时间</block>
  <block id="3224b51e62790c4ce988d8c1876fb36e" category="paragraph">在接管和备份操作期间、主机I/O会短暂暂停、但在配置正确的环境中、不应发生应用程序中断。I/O延迟的实际过渡过程通常以秒为单位、但主机可能需要更多时间来识别数据路径中的更改并重新提交I/O操作。</block>
  <block id="40f291752a9848bfecb7264cfd9aa8ee" category="paragraph">中断的性质取决于协议：</block>
  <block id="cb44db7841f8fb68230a260c4c68bfe0" category="list-text">在过渡到新物理位置后、支持NFS和CIFS流量的网络接口会向网络发出地址解析协议(Address Resolution Protocol、ARP)请求。这会导致网络交换机更新其介质访问控制(MAC)地址表并恢复处理I/O在计划内接管和移交的情况下、中断通常以秒为单位进行衡量、在许多情况下、无法检测到。某些网络可能较慢、无法完全识别网络路径的变化、而某些操作系统可能会在很短的时间内排队等待大量I/O、必须重试。这会延长恢复I/O所需的时间</block>
  <block id="6a410522094e0b0f874dab5784e81ab8" category="list-text">支持SAN协议的网络接口不会过渡到新位置。主机操作系统必须更改正在使用的一个或多个路径。主机观察到的I/O暂停取决于多个因素。从存储系统角度来看、无法提供I/O的时间段仅为几秒。但是、不同的主机操作系统可能需要额外的时间才能使I/O在重试之前超时。较新的操作系统能够更快地识别路径更改、但较旧的操作系统通常需要长达30秒才能识别更改。</block>
  <block id="cabc4f9cda7d4bfb99181166c863a374" category="paragraph">下表显示了存储系统无法为应用程序环境提供数据的预期接管时间。在任何应用程序环境中都不应出现任何错误、接管应显示为IO处理中的短暂暂停。</block>
  <block id="c8984126713ed072b9cb0a44a162be4d" category="cell">AFF</block>
  <block id="b7b46ce5d1a547db89c0bc615ff272a5" category="cell">ASA</block>
  <block id="ed3467fac861f6a32cd66093ac415805" category="cell">计划内接管</block>
  <block id="57a915dfa0e8469b25c1b8b947f7ee2c" category="cell">15秒</block>
  <block id="cd5dce62294e9a79e9c2165ee0903f5f" category="cell">第个问题</block>
  <block id="cbfdbb11fd5eab0d9fdd078ae66a1c69" category="cell">2-3秒</block>
  <block id="1a066f0304c1d3a279466c70359c5103" category="cell">计划外接管</block>
  <block id="0f4a6e109a34d3483995e427b6581130" category="cell">30秒</block>
  <block id="dbfb054670bc82c6e08a7e101c0f0ef4" category="paragraph">ONTAP中的逻辑数据保护包括三个关键要求：</block>
  <block id="b6cc6762545d78ab663e39c37d172bd2" category="list-text">必须防止数据损坏。</block>
  <block id="e7c7e14f4b6ca1b3ae32b2279243dba6" category="list-text">必须保护数据免受驱动器故障的影响。</block>
  <block id="1168469b387027a850496f6cac9f3529" category="list-text">必须防止对数据所做的更改丢失。</block>
  <block id="864a6ca5da4b36656beba11c90f4c4e5" category="paragraph">以下各节将讨论这三种需求。</block>
  <block id="a05b54004946aa523bfe7c1e92a52f52" category="section-title">网络损坏：校验和</block>
  <block id="ed95581a613a4f19be367c10cd063cc2" category="paragraph">最基本的数据保护级别是校验和、校验和是随数据一起存储的一种特殊错误检测代码。使用校验和(在某些情况下、使用多个校验和)检测网络传输期间的数据损坏。</block>
  <block id="c1343e51090396cf011509389bc0adab" category="paragraph">例如、FC帧包含一种称为循环冗余校验(CRC)的校验和形式、用于确保有效负载在传输过程中不会损坏。发射器会同时发送数据和数据的CRC。FC帧的接收器重新计算已接收数据的CRC、以确保其与已传输的CRC匹配。如果新计算的CRC与附加到帧的CRC不匹配、则数据将损坏、FC帧将被丢弃或拒绝。iSCSI I/O操作包括TCP/IP和以太网层的校验和、并且为了提供额外保护、还可以在SCSI层提供可选的CRC保护。TCP层或IP层会检测到线路上的任何位损坏、从而导致数据包重新传输。与FC一样、SCSI CRC中的错误会导致丢弃或拒绝操作。</block>
  <block id="1f08639c540e47068c16c3ac48ea7bbe" category="section-title">驱动器损坏：校验和</block>
  <block id="c5d50bc8d916a4b26166bbda091cd6d4" category="paragraph">校验和还用于验证存储在驱动器上的数据的完整性。写入驱动器的数据块使用校验和功能进行存储、该功能会产生与原始数据相关的不可预测的数字。从驱动器中读取数据时、将重新计算校验和并将其与存储的校验和进行比较。如果不匹配、则数据已损坏、必须由RAID层进行恢复。</block>
  <block id="8edc44db01815f20f6508db8b5630cfe" category="section-title">数据损坏：写入丢失</block>
  <block id="972eab86b2aecd693914feabc5a3b65c" category="paragraph">最难检测的损坏类型之一是写入丢失或放错位置。确认写入后、必须将其写入到正确位置的介质中。通过使用随数据存储的简单校验和、可以相对容易地检测原位数据损坏。但是、如果只是写入丢失、则先前版本的数据可能仍存在、校验和将是正确的。如果将写入放置在错误的物理位置、则关联的校验和将再次对存储的数据有效、即使写入操作已销毁其他数据。</block>
  <block id="53830741c46fbc560962b086f582e79a" category="paragraph">应对此挑战的解决方案如下：</block>
  <block id="656d064400822ca2ffb25f52c9fc95db" category="list-text">写入操作必须包含元数据、用于指示预期写入位置。</block>
  <block id="37a60b1c7392a26270880a361f85db55" category="list-text">写入操作必须包含某种版本标识符。</block>
  <block id="4275b2e68761baa23b112833facf4ca1" category="paragraph">当ONTAP写入块时、它会包含有关块所属位置的数据。如果后续读取发现某个块、但在位置456发现元数据时、元数据指示该块属于位置123、则表示该写入已放错位置。</block>
  <block id="009b13bf07c7db21c1e4769526e60694" category="paragraph">检测完全丢失的写入操作会更加困难。解释非常复杂、但从本质上说、ONTAP存储元数据的方式是、写入操作会导致更新到驱动器上的两个不同位置。如果写入丢失、则后续读取的数据和关联元数据将显示两个不同的版本标识。这表示驱动器未完成写入。</block>
  <block id="3b04a99c209a31ad69e7865ea94e5c94" category="paragraph">丢失和放错位置的写入损坏极为少见、但随着驱动器不断增长、数据集逐渐扩展到EB级、风险也会增加。支持数据库工作负载的任何存储系统都应包括失写检测。</block>
  <block id="e978ccc010ec4d37148d52e2fbf439dd" category="section-title">驱动器故障：RAID、RAID DP和RAID-TEC</block>
  <block id="a9fffaaf2b1b518afb56ef273736c0c2" category="paragraph">如果发现驱动器上的数据块已损坏、或者整个驱动器发生故障且完全不可用、则必须重新生成数据。这在ONTAP中通过使用奇偶校验驱动器来实现。数据在多个数据驱动器之间进行条带化、然后生成奇偶校验数据。该数据与原始数据分开存储。</block>
  <block id="54abdf00b7122c16619266482eb09f43" category="paragraph">ONTAP最初使用的是RAID 4、该RAID 4会为每组数据驱动器使用一个奇偶校验驱动器。这样、组中的任何一个驱动器都可能发生故障、而不会导致数据丢失。如果奇偶校验驱动器发生故障、则不会损坏任何数据、可以构建新的奇偶校验驱动器。如果一个数据驱动器发生故障、则其余驱动器可与奇偶校验驱动器结合使用来重新生成缺失的数据。</block>
  <block id="6d1ccb512ce2b25e53d90e6d8d459e18" category="paragraph">如果驱动器较小、则两个驱动器同时发生故障的统计几率可以忽略不计。随着驱动器容量的增长、在驱动器发生故障后重建数据所需的时间也会相应增加。这增加了第二个驱动器故障导致数据丢失的时间范围。此外、重建过程会在无故障驱动器上创建大量额外的I/O。随着驱动器老化、导致第二个驱动器故障的额外负载风险也会增加。最后、即使持续使用RAID 4不会增加数据丢失的风险、数据丢失的后果也会更加严重。RAID组发生故障时丢失的数据越多、恢复数据所需的时间就越长、从而延长业务中断时间。</block>
  <block id="caef9e75bcd55d5a9a4ec855b5a6385c" category="paragraph">这些问题促使NetApp开发了NetApp RAID DP技术、这是RAID 6的变体。此解决方案包含两个奇偶校验驱动器、这意味着RAID组中的任何两个驱动器都可能发生故障、而不会造成数据丢失。驱动器的大小持续增长、这最终导致NetApp开发了NetApp RAID-TEC技术、该技术引入了第三个奇偶校验驱动器。</block>
  <block id="704c2697ee323569003b7b7ea203ae0f" category="paragraph">一些历史数据库最佳实践建议使用RAID-10、也称为条带化镜像。这提供的数据保护比RAID DP更少、因为存在多种双磁盘故障情形、而在RAID DP中则没有。</block>
  <block id="3d0147402d7506d1d3a5227fe447427a" category="paragraph">还有一些历史数据库最佳实践表明、出于性能考虑、RAID-10优于RAID-4/5/6选项。这些建议有时会提及RAID惩罚。虽然这些建议通常是正确的、但不适用于在ONTAP中实施RAID。性能问题与奇偶校验重新生成有关。在传统RAID实施中、处理数据库执行的例行随机写入需要多次磁盘读取才能重新生成奇偶校验数据并完成写入。惩罚定义为执行写入操作所需的额外读取IOPS。</block>
  <block id="84ff015d2df40fc0ebb34485173f39e4" category="paragraph">ONTAP不会产生RAID惩罚、因为写入会暂存到内存中、在该内存中会生成奇偶校验、然后作为单个RAID条带写入磁盘。完成写入操作不需要执行任何读取操作。</block>
  <block id="b7fe11ecbd8b434a231195335b4894ac" category="paragraph">总之、与RAID 10相比、RAID DP和RAID-TEC可提供更多的可用容量、更好地防止驱动器故障、并且不会影响性能。</block>
  <block id="e5e0dc0629a299f8e56ebe7de38f49f9" category="section-title">硬件故障保护：NVRAM</block>
  <block id="1db5fde40e489d805029f9d5be6375e7" category="paragraph">任何为数据库工作负载提供服务的存储阵列都必须尽快为写入操作提供服务。此外、必须保护写入操作、使其不会因意外事件(例如断电)而丢失。这意味着任何写入操作都必须安全地存储在至少两个位置。</block>
  <block id="ff540b857af868ec85f8f53ddc1f1bd1" category="paragraph">AFF和FAS系统依靠NVRAM来满足这些要求。写入过程的工作原理如下：</block>
  <block id="049f2df0de743a6be8d3ec69864f234a" category="list-text">入站写入数据存储在RAM中。</block>
  <block id="976be2293c2f4499d079224003644acf" category="list-text">必须对磁盘上的数据所做的更改会记录到本地节点和配对节点上的NVRAM中。NVRAM不是写入缓存、而是类似于数据库重做日志的日志。在正常情况下、不会读取它。它仅用于恢复、例如在I/O处理期间发生电源故障后。</block>
  <block id="8ae87ed4a421bec56e020cd0e83bd748" category="list-text">然后、写入操作会向主机确认。</block>
  <block id="3a7682bcbb490353074b5ee69e18f01c" category="paragraph">从应用程序角度来看、此阶段的写入过程已完成、数据会受到保护、不会丢失、因为数据会存储在两个不同的位置。更改最终会写入磁盘、但从应用程序角度来看、此过程是带外过程、因为它发生在确认写入之后、因此不会影响延迟。此过程再次类似于数据库日志记录。对数据库所做的更改会尽快记录在重做日志中、然后确认已提交更改。数据文件的更新发生得更晚、不会直接影响处理速度。</block>
  <block id="c17f09622da5f1e0064f7b6a65cb8b01" category="paragraph">如果某个控制器发生故障、配对控制器将接管所需磁盘的所有权、并在NVRAM中回显已记录的数据、以恢复发生故障时正在进行的任何I/O操作。</block>
  <block id="24e6592d53b3bd56ed8827d2f51bb1ab" category="section-title">硬件故障保护：NVFAIL</block>
  <block id="7965eb54acae120d25d0c77b012b8f90" category="paragraph">如前文所述、写入操作只有在至少另一个控制器上记录到本地NVRAM和NVRAM后才会得到确认。此方法可确保硬件故障或断电不会导致传输中I/O丢失如果本地NVRAM发生故障或与HA配对节点的连接发生故障、则不会再镜像此传输中的数据。</block>
  <block id="307b6d3e63c12ada7fbcf75cdda0b574" category="paragraph">如果本地NVRAM报告错误、则此节点将关闭。此关闭会导致故障转移到HA配对控制器。由于发生故障的控制器尚未确认写入操作、因此不会丢失任何数据。</block>
  <block id="6e0c6c8fe69a50581a4ac18acb2c04dd" category="paragraph">除非强制执行故障转移、否则ONTAP不允许在数据不同步时进行故障转移。以这种方式强制更改条件即表示数据可能会留在原始控制器中、并且数据丢失是可以接受的。</block>
  <block id="a3961862ed464a06ef6fa4e23935fef2" category="paragraph">如果强制执行故障转移、数据库尤其容易受到损坏的影响、因为数据库会在磁盘上保留大量内部数据缓存。如果发生强制故障转移、先前确认的更改将被有效丢弃。存储阵列的内容会及时有效地向后跳转、数据库缓存的状态不再反映磁盘上数据的状态。</block>
  <block id="b46ce3019d702ee3ece327e5df990be0" category="paragraph">为了保护数据免受这种情况的影响、ONTAP允许对卷进行配置、以便针对NVRAM故障提供特殊保护。触发此保护机制后、卷将进入名为NVFAIL的状态。此状态会导致I/O错误、即发生原因A应用程序会关闭、以使其不使用陈旧数据。数据不应丢失、因为存储阵列上应存在任何已确认的写入。</block>
  <block id="322e1f85910dfc206274f8bd58a54a9d" category="list-text">给定站点上的每组驱动器都会自动配置为一个或多个完全冗余的RAID-DP或RAID-TEC组、而与镜像的使用无关。这样可以提供持续的数据保护、即使在站点丢失后也是如此。</block>
  <block id="dee2dfce5ab0c47301b3c12970a57aa6" category="paragraph">上图显示了一个示例SyncMirror配置。在控制器上创建了一个包含24个驱动器的聚合、其中12个驱动器来自站点A上分配的磁盘架、12个驱动器来自站点B上分配的磁盘架这些驱动器被分组为两个镜像RAID组。RAID组0在站点A上包含一个6驱动器丛、该丛镜像到站点B上的6驱动器丛同样、RAID组1在站点A上包含一个6驱动器丛、该丛镜像到站点B上的6驱动器丛</block>
  <block id="4fbc0abe91c0c1381d0a742f58b4e537" category="paragraph">SyncMirror通常用于为MetroCluster系统提供远程镜像、每个站点有一个数据副本。有时、它会用于在单个系统中提供额外的冗余级别。尤其是、它可以提供磁盘架级冗余。驱动器架已包含双电源和控制器、总体比金属板稍多、但在某些情况下、可能需要额外保护。例如、一家NetApp客户为汽车测试期间使用的移动实时分析平台部署了SyncMirror。该系统分为两个物理机架、由独立UPS系统的独立电源供电。</block>
  <block id="0cac56685de94a3ef0e1fd2bfca0c112" category="paragraph">对于习惯于使用Oracle RMAN流式备份并迁移到基于快照的备份的数据库用户来说、校验和主题特别重要。RMAN的一项功能是、它会在备份操作期间执行完整性检查。尽管此功能具有一定的价值、但其主要优势是用于未在现代存储阵列上使用的数据库。将物理驱动器用于Oracle数据库时、几乎可以肯定、随着驱动器老化、最终会发生损坏、而在真正的存储阵列中、基于阵列的校验和可以解决这一问题。</block>
  <block id="8b7b33533c2b36c157a0a482bdd52a8e" category="paragraph">Oracle数据文件和重做日志架构还旨在提供尽可能高级别的数据完整性、即使在极端情况下也是如此。在最基本的层面上、Oracle块包括对几乎每个I/O进行校验和和和基本逻辑检查如果Oracle未崩溃或使表空间脱机、则数据完好无损。数据完整性检查的程度可以调整、Oracle也可以配置为确认写入。因此、几乎所有崩溃和故障情形都可以恢复、在极少数情况下发生不可恢复的情况时、系统会立即检测到损坏。</block>
  <block id="4066c36b811913c85aa86346e30cee4d" category="paragraph">大多数使用Oracle数据库的NetApp客户在迁移到基于快照的备份之后不再使用RMAN和其他备份产品。在使用SnapCenter执行块级恢复时、仍然可以使用RMAN。但是、在日常工作中、RMAN、NetBackup和其他产品仅偶尔用于创建每月或每季度归档副本。</block>
  <block id="d0cf0e689669c61d564607d2ef7deb79" category="paragraph">有些客户选择运行<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block> 定期对其现有数据库执行完整性检查。NetApp不建议采用这种做法、因为它会产生不必要的I/O负载。如上所述、如果数据库之前未遇到问题、则可能会出现<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block> 检测问题几乎为零、此实用程序会在网络和存储系统上创建非常高的顺序I/O负载。除非有理由认为存在损坏、例如暴露于已知的Oracle错误、否则没有理由运行<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block>。</block>
  <block id="431bbcf828b8d3513280cb1207824991" category="doc">Oracle Storage Snapshot优化的备份</block>
  <block id="c9447fe684870cf68e9cb4f23f44db43" category="paragraph">尽管数据库管理器(操作步骤)对数据库管理器(数据库管理器)比较熟悉、但长期以来、可以使用数据库处于热备份模式时未创建的快照。在恢复期间、需要对Oracle 10g和11g执行额外的手动步骤、才能使数据库保持一致。采用Oracle 12c、<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 和<block ref="075b7d3bd3bbe7767f7ef62f430bc22b" prefix=" " category="inline-code"></block> 包含额外的逻辑、用于重放未处于热备份模式的数据文件备份上的归档日志。</block>
  <block id="5c7dba68615d3fa5c4c90a36dab57bcb" category="paragraph">如前文所述、恢复基于快照的热备份需要两组数据：</block>
  <block id="50a7086972cada154c8164dc1c6b3539" category="list-text">在备份模式下创建的数据文件的快照</block>
  <block id="c72d009669a638aab75c21a28a2101de" category="list-text">数据文件处于热备份模式时生成的归档日志</block>
  <block id="b8de4b1201e5595bc3de878f2bf59d9b" category="paragraph">在恢复期间、数据库会从数据文件读取元数据、以选择恢复所需的归档日志。</block>
  <block id="66ee0a6fd90f3cfab8320e1de1341cbd" category="paragraph">经过存储快照优化的恢复需要略有不同的数据集才能实现相同的结果：</block>
  <block id="6030a1d9761fca3806ef0a0329438071" category="list-text">数据文件的快照、以及用于标识快照创建时间的方法</block>
  <block id="4e822d4c19600b654f176d335c158829" category="list-text">从最近的数据文件检查点到快照的确切时间的归档日志</block>
  <block id="604432b50055c69f34df17a8ed5befb5" category="paragraph">在恢复期间、数据库会从数据文件中读取元数据、以确定所需的最早归档日志。可以执行完全恢复或时间点恢复。执行时间点恢复时、了解数据文件快照的时间至关重要。指定恢复点必须在快照创建时间之后。NetApp建议为快照时间至少添加几分钟、以考虑时钟变化。</block>
  <block id="08bfe39c49a2dc07b08bd2ccd77d8281" category="paragraph">有关完整的详细信息、请参见Oracle 12c文档各个版本中有关"使用存储Snapshot优化进行恢复"主题的Oracle文档。另请参见Oracle文档ID 604683.1、了解有关Oracle第三方快照支持的信息。</block>
  <block id="d22a890163762fcf7a4cb7605c29b7e6" category="section-title">数据布局</block>
  <block id="6a7fc1f74262f6973420f4fc849ba7f7" category="paragraph">最简单的布局是将数据文件隔离到一个或多个专用卷中。它们必须未受任何其他文件类型的污染。这是为了确保数据文件卷可以通过SnapRestore操作快速还原、而不会销毁重要的重做日志、控制文件或归档日志。</block>
  <block id="ff6fb5d2136ab516e182f4b23f45886d" category="paragraph">SAN对专用卷中的数据文件隔离具有类似要求。对于Microsoft Windows等操作系统、一个卷可能包含多个数据文件LUN、每个LUN都具有一个NTFS文件系统。对于其他操作系统、通常也会有一个逻辑卷管理器。例如、对于Oracle ASM、最简单的选择是将磁盘组限制为一个卷、该卷可以作为一个单元进行备份和还原。如果出于性能或容量管理原因需要更多卷、则在新卷上创建更多磁盘组可简化管理。</block>
  <block id="a06956ba6de69aec2dc2b015074e5821" category="paragraph">如果遵循这些准则、则可以直接在ONTAP上计划快照、而无需执行一致性组快照。原因是针对快照优化的备份不需要同时备份数据文件。</block>
  <block id="9e422c12420f1bd8c73e3c0f63da55e9" category="paragraph">如果ASM磁盘组分布在多个卷中、则会出现复杂情况。在这些情况下、必须执行cG-Snapshot、以确保ASM元数据在所有成分卷之间保持一致。</block>
  <block id="7a7969d6a47ed242c25f6a38f2da0e36" category="paragraph">[注]验证ASM spfile和passwd文件是否不在托管数据文件的磁盘组中。这会影响有选择地还原数据文件和仅还原数据文件的能力。</block>
  <block id="12eb3ceede91a01c74368e0fab03dbe4" category="section-title">本地恢复过程—NFS</block>
  <block id="e1a03fcc478ae212f07b5044b11ff369" category="paragraph">此操作步骤可以手动驱动、也可以通过SnapCenter等应用程序驱动。基本操作步骤如下所示：</block>
  <block id="abb0083d6ab87bbe9d906632fea121ae" category="list-text">将数据文件卷恢复到所需还原点之前的快照。</block>
  <block id="3450fe1e1eea00fa55cfb5cb835a3d80" category="paragraph">此操作步骤假定所需的归档日志仍存在于活动文件系统中。否则、必须还原归档日志、或<block ref="075b7d3bd3bbe7767f7ef62f430bc22b" prefix=" " category="inline-code"></block> 或<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 可以定向到中的数据<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 目录。</block>
  <block id="e43e33171833b26f6b024d28cb8b1afd" category="paragraph">此外、对于较小的数据库、最终用户可以直接从中恢复数据文件<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 目录、而无需借助自动化工具或存储管理员来执行SnapRestore命令。</block>
  <block id="097230f6ad5345abbe261eabbf533a68" category="section-title">本地恢复过程—SAN</block>
  <block id="4e3110543ebf2a771c16b3b2101f1f88" category="list-text">将托管数据文件的磁盘组静置。操作步骤因所选的逻辑卷管理器而异。使用ASM时、此过程需要卸载磁盘组。对于Linux、必须卸载文件系统、并停用逻辑卷和卷组。目标是停止要还原的目标卷组上的所有更新。</block>
  <block id="1d0ecd206531f96737f8e8002be4a047" category="list-text">将数据文件磁盘组还原到所需还原点之前的快照。</block>
  <block id="946fe41f610ab658e270a1844c992bcc" category="list-text">重新激活新还原的磁盘组。</block>
  <block id="c21d8f41541fc2a0259e7ea5e51edac3" category="paragraph">此操作步骤假定所需的归档日志仍存在于活动文件系统中。否则、必须通过使归档日志LUN脱机并执行还原来还原归档日志。这也是一个将归档日志划分为专用卷非常有用的示例。如果归档日志与重做日志共享一个卷组、则必须在还原整个LUN集之前将重做日志复制到其他位置、以避免丢失最终记录的事务。</block>
  <block id="3fd5b2a08b3d7c4db29da8590ef6013f" category="section-title">完全恢复示例</block>
  <block id="31679daa394b7091acfd728d940b7322" category="paragraph">假设数据文件已损坏或销毁、需要完全恢复。要执行此操作的操作步骤如下所示：</block>
  <block id="aa09ca247daac25fc18c2633124ca9b6" category="section-title">时间点恢复示例</block>
  <block id="935ff627038d1f5001220c8df7f0e1b9" category="paragraph">整个恢复操作步骤只需一个命令：<block ref="3df448f0a5ec82cac76d91ba14c0fa1d" prefix=" " category="inline-code"></block>。</block>
  <block id="dcd27cf8b8ceae2cd84c898d3c1b9fdb" category="paragraph">如果需要时间点恢复、则快照的时间戳必须已知、并且可按如下方式进行标识：</block>
  <block id="17108ef3ad2e1e613b844beb5f2c6d29" category="paragraph">快照创建时间显示为3月9日和10：10：06。为了安全起见、快照时间增加了一分钟：</block>
  <block id="904b0a17b003c70e398ea85996f0f9ba" category="paragraph">此时将启动恢复。考虑到可能的时钟差异、它指定了10：11：00的快照时间(比记录的时间晚一分钟)和10：44的目标恢复时间。接下来、sqlplus请求所需的归档日志、以达到所需的恢复时间10：44。</block>
  <block id="91f99c5ad04365fb4d00e509963e2a0c" category="admonition">使用使用快照完成数据库恢复<block ref="3df448f0a5ec82cac76d91ba14c0fa1d" prefix=" " category="inline-code"></block> 命令不需要特定的许可、但需要使用进行时间点恢复<block ref="72104026d9850e8c478c23b2e2e4e8e9" prefix=" " category="inline-code"></block> 需要Oracle高级压缩许可证。</block>
  <block id="9173402b63dc5f55506a692258f185e8" category="doc">SnapCenter和其他工具</block>
  <block id="5459c1727c923baa303ff472498dbe97" category="paragraph">在某些情况下、直接在ONTAP上配置这些核心功能即可满足要求、但更复杂的需求则需要一个业务流程层。</block>
  <block id="aeeb3212c35c26d321183e81d4926e57" category="paragraph">SnapCenter是NetApp的旗舰级数据保护产品。从很低的层面来看、它在执行数据库备份的方式上与SnapManager产品类似、但它是从头开始构建的、用于在NetApp存储系统上提供单一管理平台来进行数据保护管理。</block>
  <block id="50780f47f6839d47d60bc4555ee00c3f" category="section-title">REST</block>
  <block id="a0bac638f30c704da8e03aba136da86d" category="paragraph">ONTAP还包含丰富的ESTful API集。这样、第三方供应商就可以创建与ONTAP深度集成的数据保护和其他管理应用程序。此外、希望创建自己的自动化工作流和实用程序的客户也可以轻松使用这种ESTful API。</block>
  <block id="a3b43ae3d4028e3c7ccac3d5720e9fb0" category="paragraph">在备份模式下保护和恢复Oracle数据库需要两组数据。请注意、这不是唯一的Oracle备份选项、但最常见。</block>
  <block id="8e523970ff7c41dba74e723511d14717" category="list-text">备份模式下数据文件的快照</block>
  <block id="deeddf207b1a29c63ae7c1943f90f3d9" category="list-text">数据文件处于备份模式时创建的归档日志</block>
  <block id="fa1229103a2e02a4ed8790098c98f71f" category="paragraph">如果需要完全恢复(包括所有已提交的事务)、则需要第三项：</block>
  <block id="7c11b244c2549a2cc477c134ec4c5635" category="list-text">一组当前的重做日志</block>
  <block id="8522faf14bc9d4ab497945bb48adc870" category="paragraph">可以通过多种方法恢复联机备份。许多客户使用ONTAP命令行界面还原快照、然后使用Oracle RMAN或sqlplus完成恢复。在大型生产环境中、这种情况尤为常见、在这些环境中、数据库还原的概率和频率极低、任何还原操作步骤都由技能娴熟的数据库管理人员来处理。为了实现完全自动化、NetApp SnapCenter等解决方案包括一个具有命令行和图形界面的Oracle插件。</block>
  <block id="f88f41d4801183a5d53a4b71f383d144" category="paragraph">一些大型客户采用了一种更简单的方法、即在主机上配置基本脚本、以便在特定时间将数据库置于备份模式、以便为计划的快照做准备。例如、计划命令<block ref="56f72994c4cc84b13a4c20dab49fea35" prefix=" " category="inline-code"></block> 23：58时、<block ref="84c8391d82cbfe300a9615844e0a167f" prefix=" " category="inline-code"></block> 00：02、然后将快照直接计划在午夜在存储系统上。这样、便形成了一个简单、高度可扩展的备份策略、无需外部软件或许可证。</block>
  <block id="719fbeb74939b8c065321f175de3d222" category="paragraph">最简单的布局是将数据文件隔离到一个或多个专用卷中。它们必须未受任何其他文件类型的污染。这是为了确保数据文件卷可以通过SnapRestore操作快速还原、而不会销毁重要的重做日志、控制文件或归档日志。</block>
  <block id="19156bdcbf322e8e3189909bbb7a69e8" category="paragraph">SAN对专用卷中的数据文件隔离具有类似要求。对于Microsoft Windows等操作系统、一个卷可能包含多个数据文件LUN、每个LUN都具有一个NTFS文件系统。对于其他操作系统、通常会有一个逻辑卷管理器。例如、对于Oracle ASM、最简单的选择是将ASM磁盘组的LUN限制为一个可作为一个单元进行备份和还原的卷。如果出于性能或容量管理原因需要更多卷、则在新卷上创建更多磁盘组可简化管理。</block>
  <block id="993afa8643b7200c5c9e527c24c1d8b2" category="paragraph">如果遵循这些准则、则可以直接在存储系统上计划快照、而无需执行一致性组快照。原因是Oracle备份不需要同时备份数据文件。联机备份操作步骤旨在使数据文件能够持续更新、因为它们会在数小时内缓慢流式传输到磁带。</block>
  <block id="a2ea5ea024e4a68e4d7f4abeca3441a1" category="paragraph">如果使用分布在卷之间的ASM磁盘组、则会出现复杂情况。在这些情况下、必须执行cG-Snapshot、以确保ASM元数据在所有成分卷之间保持一致。</block>
  <block id="0a3ecb97c1b7c97e5075bae0daaa45aa" category="paragraph">*注意：*验证ASM<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 和<block ref="76a2173be6393254e72ffa4d6df1030a" prefix=" " category="inline-code"></block> 文件不在托管数据文件的磁盘组中。这会影响有选择地还原数据文件和仅还原数据文件的能力。</block>
  <block id="2f8a5e254c86a42ebcc8b7d3c84cd22e" category="paragraph">此操作步骤假定所需的归档日志仍存在于活动文件系统中。否则、必须还原归档日志、或者可以将RMAN/sqlplus定向到快照目录中的数据。</block>
  <block id="a67a69f712a877950e94edd27310b40e" category="paragraph">此外、对于较小的数据库、最终用户可以直接从中恢复数据文件<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 目录、而无需自动化工具或存储管理员协助即可执行<block ref="a4c0ce4da6fb04943b499690fb3afd6e" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="6da8ebf3245e4fbe4654e7f92f0330d7" category="list-text">将托管数据文件的磁盘组静置。操作步骤因所选的逻辑卷管理器而异。使用ASM时、此过程需要卸载磁盘组。对于Linux、必须卸载文件系统、并且必须停用逻辑卷和卷组。目标是停止要还原的目标卷组上的所有更新。</block>
  <block id="931ab211ac6773d20c03a998f9f921ce" category="list-text">如果需要完全恢复、请重放所有重做日志。</block>
  <block id="b6575c3fca5eaaa56eeb8e9ce8867f05" category="paragraph">此操作步骤假定所需的归档日志仍存在于活动文件系统中。否则、必须通过使归档日志LUN脱机并执行还原来还原归档日志。这也是一个将归档日志划分为专用卷非常有用的示例。如果归档日志与重做日志共享一个卷组、则必须先将重做日志复制到其他位置、然后才能还原整个一组LUN。此步骤可防止丢失这些最终记录的事务。</block>
  <block id="65fd6f7f97414140b4d6060b743dc645" category="paragraph">这些要求包括恢复速度、允许的最大数据丢失量以及备份保留需求等因素。数据保护计划还必须考虑数据保留和还原方面的各种法规要求。最后、必须考虑不同的数据恢复场景、从因用户或应用程序错误而导致的典型和可预见的恢复到包括站点完全丢失在内的灾难恢复场景。</block>
  <block id="2bd1d35ff88de136066c33905c0fd677" category="paragraph">对数据保护和恢复策略进行微小更改可能会对存储、备份和恢复的整体架构产生显著影响。在开始设计工作之前、必须定义并记录标准、以避免使数据保护架构复杂化。不必要的功能或保护级别会导致不必要的成本和管理开销、而最初被忽视的要求可能会导致项目方向错误或需要在最后一刻更改设计。</block>
  <block id="a60e6b87ede45aef49d8d095435db22b" category="section-title">恢复时间目标</block>
  <block id="3d3b341e14c584d1edcea9fe13619ee1" category="paragraph">恢复时间目标(Recovery Time目标、Recovery Time目标、Recovery Time目标、Recovery Time目标、Recovery Time目标、Recovery Time目标)定义了恢复服务所允许的最长时间。例如、人力资源数据库的RTO可能为24小时、因为虽然在工作日无法访问此数据会非常不便、但业务仍可继续运营。相比之下、支持银行总分类账的数据库将以分钟甚至几秒钟计量的最短时间。RTO不可能为零、因为必须有方法区分实际服务中断和例行事件(例如网络数据包丢失)。但是、RTO接近零是一项典型要求。</block>
  <block id="5a27873285a0397cc06f9f47280c9426" category="section-title">恢复点目标</block>
  <block id="f3ae061e139f47d793058ee596a5243f" category="paragraph">恢复点目标(RPO)定义了可容忍的最大数据丢失。在许多情况下、RPO完全取决于快照或SnapMirror更新的频率。</block>
  <block id="2d68fbd3cefeb34bfd64c8f89caba64d" category="paragraph">在某些情况下、可以通过更频繁地有选择地保护某些数据来提高RPO的主动性。在数据库环境中、RPO通常是指在特定情况下可能丢失多少日志数据的问题。在典型的恢复情形中、如果数据库因产品错误或用户错误而损坏、则RPO应为零、这意味着不会丢失任何数据。恢复操作步骤包括还原数据库文件的早期副本、然后重影日志文件、以使数据库状态达到所需的时间点。此操作所需的日志文件应已位于原始位置。</block>
  <block id="57df8b025934bcd0f7e96bae19cf0688" category="paragraph">在异常情况下、日志数据可能会丢失。例如、意外事件或恶意事件<block ref="4609acba202877f99742342f4195d95e" prefix=" " category="inline-code"></block> 数据库文件的数量可能会导致所有数据被删除。唯一的选择是从备份(包括日志文件)进行还原、而某些数据将不可避免地丢失。在传统备份环境中、要提高RPO、唯一的选择是对日志数据执行重复备份。但是、由于数据会不断移动、而且很难将备份系统作为一项持续运行的服务来维护、因此这一点存在一些限制。高级存储系统的优势之一是能够保护数据免受文件意外或恶意损坏、从而提供更好的RPO、而无需移动数据。</block>
  <block id="3d08c71e26ac92e34925e02570c4bd22" category="paragraph">灾难恢复包括在发生物理灾难时恢复服务所需的IT架构、策略和过程。这可能包括洪水、火灾或有恶意或疏忽意图的人员。</block>
  <block id="78f4e749ec0c6bb2627abbbc00bce296" category="paragraph">灾难恢复不仅仅是一组恢复过程。它是一个完整的过程、可以识别各种风险、定义数据恢复和服务连续性要求、并提供具有相关过程的正确架构。</block>
  <block id="75bcd60b234aba82b5827cd7a5171563" category="paragraph">在确定数据保护要求时、必须区分典型的RPO和RTO要求以及灾难恢复所需的RPO和RTO要求。某些应用程序环境要求RPO为零、RTO接近零、以应对从相对正常的用户错误到破坏数据中心的火灾等数据丢失情形。然而，这种高水平的保护会产生成本和行政后果。</block>
  <block id="756651fea87d05811d7a42451d074b60" category="paragraph">通常、非灾难数据恢复要求应严格、原因有两个。首先、破坏数据的应用程序错误和用户错误是可以预见的、几乎是不可避免的。其次、只要存储系统不被销毁、设计一个能够实现零RPO和低RTO的备份策略不难。没有理由不解决容易补救的重大风险、这就是为什么本地恢复的RPO和RTO目标应该积极主动的原因。</block>
  <block id="cb6faee28dd34d25f06bd0b33abe1c2f" category="paragraph">根据发生灾难的可能性以及相关数据丢失或业务中断的后果、灾难恢复RTO和RPO要求的差别更大。RPO和RTO要求应基于实际业务需求、而不是一般原则。它们必须考虑多种逻辑和物理灾难情形。</block>
  <block id="68f31611fc8a5e6a20793905280a7001" category="section-title">逻辑灾难</block>
  <block id="07f5727077caaf8dedf895542181d26b" category="paragraph">逻辑灾难包括由用户、应用程序或操作系统错误以及软件故障导致的数据损坏。逻辑灾难还可能包括外部人员利用病毒或蠕虫或利用应用程序漏洞进行的恶意攻击。在这些情况下、物理基础架构未损坏、但底层数据不再有效。</block>
  <block id="3cb5ee5f24e42f56ba6dac48b7b046d2" category="paragraph">一种日益常见的逻辑灾难类型称为勒索软件、在这种情况下、攻击向量用于对数据进行加密。加密不会损坏数据、但在向第三方付款之前、加密将使数据不可用。越来越多的企业正成为勒索软件黑客攻击的专门目标。针对这种威胁、NetApp提供防篡改快照、在这些快照中、即使存储管理员也无法在配置的到期日期之前更改受保护的数据。</block>
  <block id="91c87f53ce0a1f416308a67ce119c623" category="section-title">物理灾难</block>
  <block id="79055ca11f54a97d22617a656eab8b9b" category="paragraph">物理灾难包括基础架构的组件发生故障、导致其冗余能力超出范围、从而导致数据丢失或服务长时间丢失。例如、RAID保护可提供磁盘驱动器冗余、而使用HBA可提供FC端口和FC缆线冗余。此类组件的硬件故障是可以预见的、不会影响可用性。</block>
  <block id="3f7c55fe5f35f94cd2c4bd73b9cbb11b" category="paragraph">在企业环境中、通常可以使用冗余组件保护整个站点的基础架构、直到唯一可预见的物理灾难情形是站点完全丢失。灾难恢复规划则取决于站点到站点复制。</block>
  <block id="7f3dd7bdd41f7af6853732a383bbd7e2" category="section-title">同步和异步数据保护</block>
  <block id="c5ac17d5693914368f39b40a07af23d4" category="paragraph">理想情况下、所有数据都会在地理位置分散的站点之间同步复制。由于以下几个原因、此类复制并不总是可行甚至不可能实现：</block>
  <block id="28c59a675d03e1f62a48958bb53ae523" category="list-text">同步复制不可避免地会增加写入延迟、因为必须先将所有更改复制到这两个位置、然后应用程序/数据库才能继续处理。所产生的性能影响有时是不可接受的、从而排除了使用同步镜像的可能性。</block>
  <block id="50a05ceeb998c4dac7e8b5d706fe2029" category="list-text">随着100% SSD存储的采用率不断提高、更有可能注意到额外的写入延迟、因为性能预期包括数十万次IOPS和亚微秒延迟。要充分发挥使用100% SSD的优势、可能需要重新审视灾难恢复策略。</block>
  <block id="04d90fe6288ce6cceba54a2b71e55727" category="list-text">数据集的字节数持续增长、在确保足够的带宽来支持同步复制方面面临着挑战。</block>
  <block id="d3aaae220bd5b3d68dd4ccec3bf78197" category="list-text">数据集的复杂性也在不断增加、在管理大规模同步复制方面也面临着挑战。</block>
  <block id="c3a841e0bfc640f91b0a00c4af8c6f5c" category="list-text">基于云的策略通常涉及更长的复制距离和延迟、进一步排除了同步镜像的使用。</block>
  <block id="7df1515e247dfa2063c433b9339c2d4a" category="paragraph">NetApp提供的解决方案既包括可满足最严苛数据恢复需求的同步复制、也包括可提高性能和灵活性的异步解决方案。此外、NetApp技术还可以与许多第三方复制解决方案(例如Oracle DataGuard)无缝集成</block>
  <block id="4d2c802af835583121763e1a6acc3f9b" category="section-title">保留时间</block>
  <block id="123dbb4c09a5c8fb993a856cf65c9d25" category="paragraph">数据保护策略的最后一个方面是数据保留时间、数据保留时间可能差别很大。</block>
  <block id="d3a424909a8559a2d076e5d9a28d834f" category="list-text">通常要求在主站点上执行14天的夜间备份、在二级站点上执行90天的备份。</block>
  <block id="1d7c2d97c3bfd5ca9489e0ffeb06b150" category="list-text">许多客户创建独立的季度归档、存储在不同的介质上。</block>
  <block id="61ae175e4a0c88c4624184a0cb9b04d2" category="list-text">不断更新的数据库可能不需要历史数据、备份只需保留几天。</block>
  <block id="8bb85c2149e1e808032e7025b0a27b80" category="list-text">根据法规要求、可能需要在365天内恢复到任意事务的时间点。</block>
  <block id="05280349760feacdd6227fb8012e39d7" category="doc">基于Snapshot的备份</block>
  <block id="a4c2aeedbfeeda21f232cbf45be91693" category="paragraph">关键值如下：</block>
  <block id="d06c89cff665ecdde6eded3c9d44cd2b" category="list-text">*精简性。*快照是指特定时间点数据容器内容的只读副本。</block>
  <block id="175888ba89c31a851f719bdd271cae9c" category="list-text">*效率。*创建快照时不需要任何空间。只有在数据发生更改时才会占用空间。</block>
  <block id="d853e9e275a6e58b3a9a56fa641cbb9f" category="list-text">*易管理性。*基于快照的备份策略易于配置和管理、因为快照是存储操作系统的本机部分。如果存储系统已启动、则它可以随时创建备份。</block>
  <block id="b564e5fbab71af776ed54a19d09b268c" category="list-text">*可扩展性。*一个文件和LUN容器最多可保留1024个备份。对于复杂的数据集、可以通过一组一致的快照来保护多个数据容器。</block>
  <block id="7159872a568b97a971b9ea182fb23b7c" category="list-text">无论卷包含1024个快照还是无快照、性能都不受影响。</block>
  <block id="1a54f7e14e6e652bb32b12df22faf387" category="paragraph">虽然许多存储供应商都提供快照技术、但ONTAP中的快照技术是独一无二的、可为企业级应用程序和数据库环境带来显著优势：</block>
  <block id="d77b23e355dc2f65b90fb52ed9a90f9c" category="list-text">Snapshot副本是底层任意位置写入文件布局(Write-Anywhere File Layout、WAFL)的一部分。它们不是附加技术或外部技术。由于存储系统是备份系统、因此可简化管理。</block>
  <block id="8b888e6a2d883c0111428c101532294a" category="list-text">Snapshot副本不会影响性能、但某些边缘情形除外、例如、快照中存储的数据量如此之多、以致于底层存储系统会填满。</block>
  <block id="2283ea50a243a5d1ad551f7d21f39895" category="list-text">术语"一致性组"通常用于指作为一致的数据集合进行管理的一组存储对象。特定ONTAP卷的快照构成一致性组备份。</block>
  <block id="ac72c83a8204d600d567261b41c5488c" category="paragraph">ONTAP快照的扩展能力也优于竞争技术。客户可以存储5个、50个或500个快照、而不会影响性能。卷中当前允许的最大快照数为1024。如果需要额外保留快照、可以选择将快照级联到其他卷。</block>
  <block id="3b7ff39ba50f1bc3f56d38c41ba51855" category="paragraph">因此、保护ONTAP上托管的数据集非常简单、并且具有高度可扩展性。备份不需要移动数据、因此可以根据业务需求定制备份策略、而不是网络传输速率、大量磁带驱动器或磁盘暂存区的限制。</block>
  <block id="55c5bbb3aad88266600eaa1a526406d4" category="paragraph">有关将快照用作数据保护策略的一个常见问题是、"实际"数据和快照数据位于同一个驱动器上。丢失这些驱动器将导致主数据和备份均丢失。</block>
  <block id="68870deb35eeb53373325a314030bd11" category="paragraph">但是、本地快照绝不是唯一的备份策略、这就是NetApp提供SnapMirror和SnapVault复制等技术来快速高效地将快照复制到一组独立驱动器的原因。在采用快照和快照复制功能且架构合理的解决方案中、磁带的使用量可以降至最低、甚至可以每季度归档一次、也可以完全避免。</block>
  <block id="73d3fd255835ca3dc926f59d50223f91" category="paragraph">使用ONTAP Snapshot副本保护数据有多种选择、快照是复制、灾难恢复和克隆等许多其他ONTAP功能的基础。本文档不会介绍有关Snapshot技术的完整问题描述、但以下各节将提供一般概述。</block>
  <block id="7441577327d1d49b71cc2f6403e17e7b" category="paragraph">创建数据集快照的主要方法有两种：</block>
  <block id="b38ba43128207852ef5149e6c578ba89" category="list-text">崩溃状态一致的备份</block>
  <block id="dc64a2f6075820724476e435a1ebd7fa" category="list-text">应用程序一致的备份</block>
  <block id="32561979f55bc68c4f028fd26a9975f6" category="paragraph">当备份点恢复足以满足要求时、主要使用崩溃状态一致的备份。当需要更精细的恢复时、通常需要应用程序一致的备份。</block>
  <block id="367735591e5e6e04c17b7930acb29b7d" category="paragraph">"应用程序一致"中的"一致"一词通常用词不当。例如、将Oracle数据库置于备份模式称为应用程序一致的备份、但数据不会以任何方式保持一致或处于静态。数据在整个备份过程中持续更改。相比之下、大多数MySQL和Microsoft SQL Server备份确实会在执行备份之前将数据置于静噪状态。VMware可能会使某些文件保持一致、也可能不会使其保持一致。</block>
  <block id="ebf90723e7659cb5381545104b618612" category="paragraph">术语"一致性组"是指存储阵列能够将多个存储资源作为一个映像进行管理。例如、一个数据库可能包含10个LUN。阵列必须能够以一致的方式备份、还原和复制这10个LUN。如果LUN的映像在备份时不一致、则无法还原。复制这10个LUN要求所有副本之间完全同步。</block>
  <block id="3f8a43f1defaa984435092f616876545" category="paragraph">在讨论ONTAP时、不经常使用术语"一致性组"、因为一致性一直是ONTAP中卷和聚合架构的基本功能。许多其他存储阵列将LUN或文件系统作为单独的单元进行管理。然后、可以选择将其配置为"一致性组"以实现数据保护、但这是配置中的一个额外步骤。</block>
  <block id="74e816c3c784f5c30c79dca4590d7f59" category="paragraph">ONTAP始终能够捕获一致的本地和复制数据映像。虽然ONTAP系统上的各种卷通常不会正式描述为一致性组、但它们就是一致性组。该卷的快照是一致性组映像、该快照的还原是一致性组还原、SnapMirror和SnapVault均提供一致性组复制。</block>
  <block id="15cc4389a08c3f4748e98622e630ad3e" category="section-title">一致性组快照</block>
  <block id="d286b747757ef3d8d3abac27bfae65f9" category="paragraph">一致性组快照(CG快照)是基本ONTAP快照技术的扩展。标准快照操作会为单个卷中的所有数据创建一致的映像、但有时需要在多个卷甚至多个存储系统之间创建一组一致的快照。这样就会生成一组快照、这些快照的使用方式与仅包含一个卷的快照相同。它们可用于本地数据恢复、为灾难恢复目的进行复制或作为一个一致的单元进行克隆。</block>
  <block id="7c199465bc6344e648e2f73c88131605" category="paragraph">已知的最大CG-Snapsh图 用途是用于大小约为1 PB且跨越12个控制器的数据库环境。在此系统上创建的CG快照已用于备份、恢复和克隆。</block>
  <block id="e5c199b4a97409f33d5caae984957744" category="paragraph">大多数情况下、如果数据集跨越多个卷且必须保留写入顺序、则选定管理软件会自动使用CG快照。在这种情况下、无需了解CG快照的技术详细信息。但是、在某些情况下、复杂的数据保护要求需要对数据保护和复制过程进行详细控制。可以选择自动化工作流或使用自定义脚本来调用CG-Snapshot API。要了解cG-Snapshot的最佳选项和角色、需要对该技术进行更详细的说明。</block>
  <block id="cf3c30ea5c240a8aef02d240f42cdff7" category="paragraph">创建一组CG快照的过程分为两步：</block>
  <block id="f30455406a91bd776afbc88e60b9697e" category="list-text">在所有目标卷上建立写入隔离。</block>
  <block id="c7afe45d94f2fd172a01e851d7f92a2f" category="list-text">在隔离状态下创建这些卷的快照。</block>
  <block id="c464d4671e489eaad9a8cbf0a8086ea9" category="paragraph">写入隔离是按序列建立的。这意味着、在多个卷之间设置隔离过程时、写入I/O会冻结在序列中的第一个卷上、因为它会继续提交到稍后显示的卷。最初、这可能看起来违反了保留写入顺序的要求、但只有在主机上异步发出的适用场景I/O、而不依赖于任何其他写入。</block>
  <block id="688656b1f8644ee299edf7be87a8fc75" category="paragraph">例如、数据库可能会对大量异步数据文件更新进行问题描述、并允许操作系统重新排列I/O、然后根据自己的计划程序配置完成这些更新。无法保证此类I/O的顺序、因为应用程序和操作系统已释放保留写入顺序的要求。</block>
  <block id="599ce07d1bae0fa6169959e2bdb97ada" category="paragraph">作为一个计数器示例、大多数数据库日志记录活动都是同步的。在确认I/O并保留这些写入顺序之前、数据库不会继续进行日志写入。如果日志I/O到达隔离的卷、则不会进行确认、应用程序会阻止进一步写入。同样、文件系统元数据I/O通常是同步的。例如、文件删除操作不能丢失。如果带有xfs文件系统的操作系统删除了某个文件、而更新了xfs文件系统元数据以删除对该文件的引用的I/O则会登录到隔离的卷上、则文件系统活动将暂停。这样可以保证CG快照操作期间文件系统的完整性。</block>
  <block id="0f0c0f05310f9cf257d65bfd936f15c5" category="paragraph">在目标卷之间设置写入隔离后、这些卷便可创建快照了。无需同时创建快照、因为从依赖写入的角度来看、卷的状态是冻结的。为了防止创建CG快照的应用程序出现缺陷、初始写入隔离包括一个可配置的超时时间、在此超时时间内、ONTAP会自动释放隔离并在定义的秒数后恢复写入处理。如果所有快照都是在超时期限到期之前创建的、则生成的一组快照是有效的一致性组。</block>
  <block id="df4925d1c6c3f3258e80ff35ce62b17d" category="section-title">从属写入顺序</block>
  <block id="6c78ee478b93fbb573157b85fb1114db" category="paragraph">从技术角度来看、一致性组的关键在于保留写入顺序、尤其是依赖写入顺序。例如、向10个LUN写入数据的数据库会同时向所有LUN写入数据。许多写入操作是异步发出的、这意味着它们的完成顺序并不重要、实际完成顺序会因操作系统和网络行为而异。</block>
  <block id="69d87c00869001f3f06ad4a1494eac21" category="paragraph">在数据库继续执行其他写入操作之前、磁盘上必须存在某些写入操作。这些关键写入操作称为依赖写入。后续写入I/O取决于磁盘上是否存在这些写入。对这10个LUN执行任何快照、恢复或复制操作都必须确保依赖写入顺序得到保证。文件系统更新是依赖写入顺序写入的另一个示例。必须保留文件系统更改的顺序、否则整个文件系统可能会损坏。</block>
  <block id="74fbae5d0b3c16e1774c5f4dce2c1c36" category="section-title">战略</block>
  <block id="53e858edb9bd9ff3f9ead52cebf5731d" category="paragraph">基于快照的备份有两种主要方法：</block>
  <block id="f87f61f625a005bd32c53f808d235eea" category="list-text">受Snapshot保护的热备份</block>
  <block id="c32eba270db95747b471fd53e203a47b" category="paragraph">崩溃状态一致的Snapshot备份主要在备份点恢复已足够时使用。在某些情况下、可以应用归档日志、但在需要更精细的时间点恢复时、最好使用联机备份。</block>
  <block id="82cc23cd5dc667cc9fb78ff6e76ac15b" category="paragraph">基于快照的联机备份的基本操作步骤如下所示：</block>
  <block id="dbaf4855045e45fbcf678fa4cd1ab2db" category="list-text">将数据库放置在中<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 模式。</block>
  <block id="c3e07fb8aef84ef3d94e3f9d5376c091" category="list-text">为托管数据文件的所有卷创建快照。</block>
  <block id="2d0e58ff1a25bd9fd8a85ad8ce6f2665" category="list-text">退出<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 模式。</block>
  <block id="4196c5674aaa9e4317b2b4c54f94a905" category="list-text">运行命令<block ref="9d2840394bc37850da4e360dbf60c0dc" prefix=" " category="inline-code"></block> 强制日志归档。</block>
  <block id="f2736e795871e2fc2d36addb9436f337" category="list-text">为托管归档日志的所有卷创建快照。</block>
  <block id="f24880a3fe8b242fdd1aba5a2d11196f" category="paragraph">此操作步骤将生成一组快照、其中包含处于备份模式的数据文件以及处于备份模式时生成的关键归档日志。这是恢复数据库的两项要求。为方便起见、还应保护控制文件等文件、但唯一的绝对要求是保护数据文件和归档日志。</block>
  <block id="0c32649da44277db19fcfa3fe4dac28f" category="paragraph">虽然不同的客户可能有非常不同的策略、但几乎所有这些策略最终都基于下面所述的相同原则。</block>
  <block id="88f451afed04f47352987f617f805826" category="section-title">基于Snapshot的恢复</block>
  <block id="c092a9763068c8382be82f9c77bb9658" category="paragraph">在为Oracle数据库设计卷布局时、首先要决定是否使用基于卷的NetApp SnapRestore (VBSR)技术。</block>
  <block id="15a0b8dc4d1b340d403bf6515f7e61b8" category="paragraph">基于卷的SnapRestore可以将卷几乎即时还原到较早的时间点。由于卷上的所有数据均已还原、因此VBSR可能并不适用于所有使用情形。例如、如果整个数据库(包括数据文件、重做日志和归档日志)存储在单个卷上、而此卷通过VBSR还原、则数据会丢失、因为较新的归档日志和重做数据会被丢弃。</block>
  <block id="e63c0ca12b07a654ccadd92527a95c47" category="paragraph">还原不需要VBSR。许多数据库都可以通过使用基于文件的单文件文件系统(Single File SnapRestore、SFSR)进行还原、或者只需将文件从快照复制回活动文件系统即可。</block>
  <block id="b38bd603a952c93872eae2ea858cb15f" category="paragraph">通过以这种方式隔离数据文件、可以将其还原到早期状态、而不会损坏其他文件系统。</block>
  <block id="5755a6275c3ecd99e8159efc58a8ff6c" category="section-title">Snapshot 预留</block>
  <block id="957abb72f2db3a20e0b570a5fa3a1dcc" category="paragraph">对于SAN环境中包含Oracle数据的每个卷、<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 应设置为零、因为在LUN环境中为快照预留空间没有用处。如果预留百分比设置为100、则包含LUN的卷的快照需要该卷中具有足够的可用空间(不包括快照预留)来吸收所有数据的100%周转率。如果预留百分比设置为较低的值、则所需的可用空间量相应较少、但始终不包括Snapshot预留。这意味着会浪费LUN环境中的快照预留空间。</block>
  <block id="d5a06adf11e69f265f3ee3277212764e" category="paragraph">在NFS环境中、有两种选择：</block>
  <block id="7631336a8e2e03f6ac500c145445b2d7" category="list-text">设置<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 基于预期的Snapshot空间消耗。</block>
  <block id="acc4c5d06fc4a9ac93880c9c2d0a6e76" category="list-text">设置<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 将活动空间和快照空间占用情况统一置零并进行管理。</block>
  <block id="44806986c5abfcd6261803f4f75a7b56" category="paragraph">使用第一个选项时、<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 设置为非零值、通常约为20%。然后、此空间将对用户隐藏。但是、此值不会对利用率造成限制。如果预留百分比为20%的数据库的周转率为30%、则快照空间可能会超出预留百分比的界限并占用未预留空间。</block>
  <block id="c8910acb0bfa30f82b423ff09a9710ca" category="paragraph">将预留设置为20%这样的值的主要优势是、验证某些空间始终可用于快照。例如、预留为20%的1 TB卷仅允许数据库管理员(Database Administrator、DBA)存储800 GB数据。此配置可确保至少为快照占用200 GB的空间。</block>
  <block id="be233226a8cb890c0a8bbf041c06ac6b" category="paragraph">时间<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 设置为零时、卷中的所有空间均可供最终用户使用、从而提高可见性。数据库管理员必须了解、如果发现1 TB卷利用快照、则这1 TB空间将在活动数据和Snapshot周转率之间共享。</block>
  <block id="b10efee713968b90d211d08ec8345d20" category="paragraph">最终用户之间没有明确的首选方案一和备选方案二。</block>
  <block id="8112d08173571f2d01372cadea3ea76d" category="section-title">ONTAP和第三方快照</block>
  <block id="0cc082f7cc7618a904f6cde556295cbd" category="paragraph">Oracle文档ID 604683.1介绍了第三方快照支持的要求以及可用于备份和还原操作的多个选项。</block>
  <block id="130a02f8381e6c54b2ea07d2bdaf6f0b" category="paragraph">第三方供应商必须保证公司的快照符合以下要求：</block>
  <block id="97eb59a0f249226523b31dd52d557e00" category="list-text">快照必须与Oracle建议的还原和恢复操作集成。</block>
  <block id="083e9332dc2b6bf064139ac2e670eee9" category="list-text">快照必须在快照点保持数据库崩溃状态一致。</block>
  <block id="9dae8634b638a6949dab0f7eaf7988bd" category="list-text">系统会为快照中的每个文件保留写入顺序。</block>
  <block id="7bc868657652757ca8505ddcd297456f" category="paragraph">ONTAP和NetApp Oracle管理产品符合这些要求。</block>
  <block id="9e19caeb431a5e29a1a63e3cee4b36c9" category="doc">借助ONTAP实现Oracle数据保护</block>
  <block id="848aab87f65bfade12f80d4e864ec046" category="paragraph">企业无法在不访问其数据的情况下运营、有时数据决定了业务。这些数据必须受到保护；但是、数据保护不仅仅是确保备份可用、它还需要快速可靠地执行备份、同时还要安全地存储这些备份。</block>
  <block id="28a0304f97f876b27cf541f4ad9a30d7" category="paragraph">数据保护的另一面是数据恢复。如果无法访问数据、则企业会受到影响、并且可能无法运行、直到数据还原为止。此过程必须快速可靠。最后、必须保护大多数数据库免受灾难的影响、这意味着需要维护数据库的副本。副本必须足够最新。使副本成为一个完全正常运行的数据库还必须快速而简单。</block>
  <block id="3d601b26d05eac41fc6a7eba92fdc8b9" category="admonition">本文档可替代先前发布的技术报告_TR-4591：《Oracle数据保护：备份、恢复和复制》</block>
  <block id="21d28aa03f67eb242b1c95a6a0594ff5" category="section-title">规划</block>
  <block id="355ba59494fea8b20be391a73cc755eb" category="paragraph">准确测试数据库存储性能是一个极其复杂的主题。它需要了解以下问题：</block>
  <block id="b57041cc3b57577b5c21eff44739e3f9" category="list-text">IOPS和吞吐量</block>
  <block id="236e7fd957ada95e8094e302623980d3" category="list-text">前台和后台I/O操作之间的区别</block>
  <block id="902f90cc4ab59808cac5606f767f61c4" category="list-text">延迟对数据库的影响</block>
  <block id="196198dbaa1d1ea17cfc478fbb2f419f" category="list-text">许多操作系统和网络设置也会影响存储性能</block>
  <block id="5ff18eadb2ef3fc20e13bed3e5b61d79" category="paragraph">此外、还需要考虑执行非存储数据库任务。有时、优化存储性能不会带来任何有用的优势、因为存储性能不再是性能的限制因素。</block>
  <block id="32a993d3f497a6dd4392d3348b05ebc3" category="list-text">网络带宽日益成为性能限制的常见来源。例如、旋转磁盘解决方案通常会成为数据库性能的瓶颈、因为I/O延迟非常高。当全闪存阵列消除延迟限制后、障碍往往会转移到网络上。在虚拟化环境和刀片式系统中、这一点尤为明显、因为它们的真正网络连接很难直观地呈现出来。如果由于带宽限制而无法充分利用存储系统本身、则可能会使性能测试复杂化。</block>
  <block id="8caa382fb0f5f7a8279424d306dd003d" category="list-text">由于全闪存阵列的延迟显著缩短、因此通常无法将全闪存阵列与包含旋转磁盘的阵列进行性能比较。测试结果通常没有意义。</block>
  <block id="bc2b8b37bdda467f2ce639ab28bf4646" category="list-text">将峰值IOPS性能与纯闪存阵列进行比较通常不是一项有用的测试、因为数据库不受存储I/O的限制例如、假设一个阵列可以承受50万次随机IOPS、而另一个阵列可以承受30万次随机IOPS。如果数据库将99%的时间花在CPU处理上、则这种差异在实际环境中无关紧要。这些工作负载从不充分利用存储阵列的全部功能。相反、在整合平台中、峰值IOPS功能可能至关重要、在该平台中、存储阵列应加载到其峰值功能。</block>
  <block id="0c2cbb26e6baa58b7d3a3309f95a2786" category="list-text">在任何存储测试中、始终考虑延迟和IOPS。市场上的许多存储阵列都声称IOPS达到了极高水平、但延迟会使这些IOPS在这种水平下毫无用处。全闪存阵列的典型目标为1毫秒标记。更好的测试方法不是测量可能的最大IOPS、而是确定在平均延迟超过1毫秒之前存储阵列可以承受的IOPS数。</block>
  <block id="e6d8362588e550c19912b0f3f0e1a129" category="section-title">Oracle自动工作负载存储库和基准测试</block>
  <block id="d035df494751722dd56d4cf4a8d1f795" category="paragraph">Oracle性能比较的黄金标准是Oracle自动工作负载存储库(Automatic Workload Repository、AWR)报告。</block>
  <block id="95f7e55383674168e90b01b708bc88db" category="paragraph">AWR报告有多种类型。从存储角度来看、是指通过运行生成的报告<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> 命令功能最全面、最有价值、因为它针对特定数据库实例、并包含一些详细的直方图、这些直方图可按延迟细分存储I/O事件。</block>
  <block id="7b79802e5668e6e5b990081db481505d" category="paragraph">比较两个性能阵列时、理想情况下需要在每个阵列上运行相同的工作负载、并生成一个准确针对该工作负载的AWR报告。如果工作负载运行时间非常长、则可以使用一个AWR报告、其中经过的时间包含开始和停止时间、但最好将AWR数据细分为多个报告。例如、如果批处理作业从午夜运行到早上6点、请创建一系列从午夜到凌晨1点、从凌晨1点到凌晨2点的一小时AWR报告、依此类推。</block>
  <block id="e39ecb86ad7d25413ba8ad2976fd3e4a" category="paragraph">在其他情况下、应优化非常短的查询。最佳选择是基于查询开始时创建的AWR快照和查询结束时创建的第二个AWR快照创建AWR报告。否则、数据库服务器应保持安静、以最大限度地减少后台活动、因为后台活动会掩盖正在分析的查询的活动。</block>
  <block id="2fe7152c186ec1b5b0451e13ec8b968b" category="admonition">如果AWR报告不可用、则Oracle statspack报告是一个很好的替代方案。它们包含与AWR报告大部分相同的I/O统计信息。</block>
  <block id="8b8c73ac7e509a897688356d1d283d75" category="section-title">Oracle AWR和故障排除</block>
  <block id="42a92c79ee82f4343e7d65f2f1cf2dd2" category="paragraph">AWR报告也是分析性能问题的最重要工具。</block>
  <block id="ad5387afbab7c506c781c8b12b0a4b24" category="paragraph">与基准测试一样、性能故障排除要求您精确测量特定工作负载。如果可能、请在向NetApp支持中心报告性能问题或与NetApp或合作伙伴客户团队合作购买新的解决方案时提供AWR数据。</block>
  <block id="6471146c0e33e2a8ec8a5c6635c837bc" category="paragraph">提供AWR数据时、请考虑以下要求：</block>
  <block id="5c3ba265890805919f93c246b3f8d2d6" category="list-text">运行<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> 命令以生成报告。输出可以是文本或HTML。</block>
  <block id="25db65f9a36910f3e488a8b7407130de" category="list-text">如果使用Oracle Real Application Clusters (RAC)、请为集群中的每个实例生成AWR报告。</block>
  <block id="96d55341f8208c60720e68b3155f3aa1" category="list-text">确定问题存在的具体时间。AWR报告的最长可接受用时通常为一小时。如果问题持续数小时或涉及多小时操作(例如批处理作业)、请提供多个涵盖要分析的整个期间的一小时AWR报告。</block>
  <block id="4533b15b837909c68a0171d2638494d2" category="list-text">如果可能、将AWR快照间隔调整为15分钟。此设置允许执行更详细的分析。这还需要执行更多的<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> 以提供每15分钟间隔的报告。</block>
  <block id="97eb6d04cc93934c1be4ab95054cd0b0" category="list-text">如果问题是运行时间非常短的查询、请根据操作开始时创建的AWR快照和操作结束时创建的第二个AWR快照提供AWR报告。否则、数据库服务器应保持安静、以最大限度地减少后台活动、因为后台活动会掩盖所分析操作的活动。</block>
  <block id="5186f459ce7d75e587a083bcb7c5927a" category="list-text">如果在特定时间报告了性能问题、但在其他时间未报告、请提供其他证明性能良好的AWR数据以供比较。</block>
  <block id="108a72dad388aa310cc52ee3bac7d1cc" category="section-title">CALIBRAT_IO</block>
  <block id="f1c07dfccef6a6c47a5ccef938e10e3d" category="paragraph">。<block ref="108a72dad388aa310cc52ee3bac7d1cc" prefix=" " category="inline-code"></block> 切勿使用命令测试、比较存储系统或对其进行基准测试。如Oracle文档中所述、此操作步骤会校准存储的I/O功能。</block>
  <block id="872892cce56a2665ad7ceecc44b38166" category="paragraph">校准与基准测试不同。此命令的目的是通过问题描述I/O来帮助校准数据库操作、并通过优化向主机发出的I/O级别来提高其效率。因为执行的I/O类型<block ref="108a72dad388aa310cc52ee3bac7d1cc" prefix=" " category="inline-code"></block> 操作不代表实际的数据库用户I/O、结果不可预测、而且经常甚至无法重现。</block>
  <block id="e66807fad19acd41db50eedff918a4dd" category="section-title">SLOB2</block>
  <block id="0a6192ff5412539c31db2c7a98f408b3" category="inline-link-macro"><block ref="0a6192ff5412539c31db2c7a98f408b3" category="inline-link-rx"></block></block>
  <block id="d1f6fb23f52090ffd944dc54549735b8" category="paragraph">SOLB2 (Song Little Oracle基准)已成为评估数据库性能的首选工具。它由Kevin Clsson开发、可从获取 <block ref="3ccce0719b1965cd915da75778e4e706" category="inline-link-macro-rx"></block>。安装和配置只需几分钟、它会使用实际的Oracle数据库在用户可定义的表空间上生成I/O模式。它是少数几个可以使全闪存阵列的I/O饱和的测试选项之一此外、它还有助于生成低得多的I/O级别、以模拟IOPS低但对延迟敏感的存储工作负载。</block>
  <block id="baffd8ac40ca7b966340e7b257b4c7b4" category="section-title">Swingbench</block>
  <block id="905a59d6f73f4e2aea1dc232a3bcd195" category="paragraph">Swingbench可用于测试数据库性能、但要以对存储造成压力的方式使用Swingbench、则极为困难。NetApp尚未从Swingbench中检测到任何测试产生足够的I/O来为任何AFF阵列带来大量负载。在有限情况下、可以使用订单输入测试(Order Entry Test、OOT)从延迟角度评估存储。如果数据库对特定查询具有已知的延迟依赖关系、则此功能可能会很有用。必须注意确保主机和网络配置正确、以实现全闪存阵列的潜在延迟。</block>
  <block id="e3cf940afa524b20b15c43b20405be77" category="section-title">HammerDB</block>
  <block id="5c9408da71d2ff7554b9fd11add795cf" category="paragraph">HAMmerDB是一款数据库测试工具、用于模拟TPC-C和TPC-H基准测试等。构建一个足够大的数据集可能需要花费大量时间才能正确执行测试、但它可以作为一个有效的工具来评估OLTP和数据仓库应用程序的性能。</block>
  <block id="7e1ad070b7fff621d9d64a71cec87684" category="section-title">猎户座</block>
  <block id="56fedcbec2842fb62a743c5f84311597" category="paragraph">Oracle ORION工具通常与Oracle 9一起使用、但尚未对其进行维护、以确保与各种主机操作系统中的更改兼容。由于与操作系统和存储配置不兼容、因此很少与Oracle 10或Oracle 11结合使用。</block>
  <block id="38622bf572fa7bec2dc7f3915ebd345f" category="paragraph">Oracle重新编写了该工具、默认情况下会随Oracle 12c一起安装。虽然此产品已得到改进、并使用了与实际Oracle数据库相同的许多调用、但它使用的代码路径或I/O行为与Oracle不同。例如、大多数Oracle I/O都是同步执行的、这意味着数据库会暂停、直到I/O完成、因为I/O操作在前台完成。简单地将随机I/O充斥存储系统并不是真正的Oracle I/O、也不提供比较存储阵列或衡量配置更改影响的直接方法。</block>
  <block id="bb68dfada5ca20e256bbd3ffbbfab9e6" category="paragraph">尽管如此、也有一些适用于ORION的用例、例如、对特定主机-网络-存储配置的最大可能性能进行常规测量、或者对存储系统的运行状况进行评估。通过仔细测试、可以设计出可用的ORION测试来比较存储阵列或评估配置更改的影响、前提是这些参数包括考虑IOPS、吞吐量和延迟、并尝试忠实地复制真实的工作负载。</block>
  <block id="6b64090d226d30776368e89b08c7c71b" category="summary">Oracle数据库的WAFL对齐</block>
  <block id="03a35ba2b6191f8cfbd1cca378eefc91" category="doc">Oracle数据库的WAFL对齐验证</block>
  <block id="219900dcd21cee2f958254a708ad36f6" category="paragraph">正确对齐WAFL对于获得良好性能至关重要。尽管ONTAP以4 KB单位管理块、但这并不意味着ONTAP以4 KB单位执行所有操作。事实上、ONTAP支持不同大小的块操作、但底层记帐由WAFL以4 KB单位进行管理。</block>
  <block id="5d3a5c290e14d74acf49b20d15120886" category="paragraph">术语"对齐"是指Oracle I/O与这些4 KB单位的对应关系。要获得最佳性能、需要将一个Oracle 8 KB块驻留在驱动器上的两个4 KB WAFL物理块上。如果块偏移2 KB、则此块位于一个4 KB块的一半、一个单独的完整4 KB块、然后是第三个4 KB块的一半。这种排列会导致性能下降。</block>
  <block id="0073ce99d632b066d5ac09a4ad0cf7fc" category="paragraph">对齐不是NAS文件系统的问题。Oracle数据文件会根据Oracle块的大小与文件开头对齐。因此、8 KB、16 KB和32 KB的块大小始终对齐。所有块操作都会与文件开头偏移、以4 KB为单位。</block>
  <block id="d7f7edd61ab216efc34578584a7d0e7c" category="paragraph">与此相反、LUN通常在开始时包含某种类型的驱动程序标头或文件系统元数据、以创建偏移。在现代操作系统中、对齐很少会成为问题、因为这些操作系统专为可能使用本机4 KB扇区的物理驱动器而设计、这也需要将I/O与4 KB边界对齐以获得最佳性能。</block>
  <block id="38b3d1cd67903560954ad297a92e3de1" category="paragraph">但也有一些例外情况。数据库可能是从未针对4 KB I/O进行优化的旧版操作系统迁移的、或者分区创建期间的用户错误可能导致偏移量大小不以4 KB为单位。</block>
  <block id="612eeadd26ceeace7b043d37f8e24b1f" category="paragraph">以下示例是Linux专用的、但操作步骤可适用于任何操作系统。</block>
  <block id="1d5b772bea21e5e949413e09eedf17de" category="section-title">已对齐</block>
  <block id="594b0fc1af44897ff4b26f2e6b866685" category="paragraph">以下示例显示了对具有单个分区的单个LUN的对齐检查。</block>
  <block id="dc2c18402c86861702fc1d94a6495ac3" category="paragraph">首先、创建使用驱动器上所有可用分区的分区。</block>
  <block id="adff8cc6319e96d2685fd082a5aa043c" category="paragraph">可以使用以下命令以数学方式检查对齐情况：</block>
  <block id="4bc7aba328a710bb7d0935cf830634aa" category="paragraph">输出显示单位为512字节、分区起始单位为32。这是总共32 x 512 = 16、834字节、是4 KB WAFL块的整数倍。此分区已正确对齐。</block>
  <block id="dd343941469b5360af52eb1b94fe5de6" category="paragraph">要验证是否正确对齐、请完成以下步骤：</block>
  <block id="7d84e72acd05d0c93d99e414f5b092b5" category="list-text">确定LUN的通用唯一标识符(UUID)。</block>
  <block id="92af2a93f00a6297c490ba0be5fd7a8a" category="list-text">在ONTAP控制器上输入节点Shell。</block>
  <block id="5274579d5eff6fe6d1e8ecbf54e84993" category="list-text">对第一步中确定的目标UUID启动统计收集。</block>
  <block id="52df0a2ea976123bf02330300b2392e3" category="list-text">执行一些I/O使用非常重要<block ref="3c908d68ba53922b92c5595b72fa011c" prefix=" " category="inline-code"></block> 用于确保I/O是同步的且不缓冲的参数。</block>
  <block id="fac8a5b490ea29eca93ec213d79e6ff2" category="admonition">使用此命令时请格外小心。反转<block ref="39c8942e1038872a822c0dc75eedbde3" prefix=" " category="inline-code"></block> 和<block ref="8bf8854bebe108183caeb845c7676ae4" prefix=" " category="inline-code"></block> 参数会销毁数据。</block>
  <block id="4f7dce34a21e3de727f3e3ad05e6e7d8" category="list-text">停止统计信息并查看对齐直方图。所有I/O都应位于中<block ref="c6bd178b372b0ddd17fff48819badc6a" prefix=" " category="inline-code"></block> 存储分段、表示I/O与4 KB块边界对齐。</block>
  <block id="5df81374c01d1b7c20fe8cb3883117eb" category="section-title">未对齐</block>
  <block id="5ff266dadf965b3c304513f516a13c12" category="paragraph">以下示例显示了未对齐的I/O：</block>
  <block id="25be03b87e6a5d8170ce85b16ea506ab" category="list-text">创建不与4 KB边界对齐的分区。这不是现代操作系统上的默认行为。</block>
  <block id="4adda0e871000c2b13a4faef6ce4e21b" category="paragraph">未对齐情况很明显。I/O大部分落在*中 <block ref="66c8d76cad709856ccec680cab8ab35a" prefix="*" category="inline-code"></block> 存储分段、与预期偏移匹配。创建分区时、该分区会比优化默认值更远地移动到设备中512字节、这意味着直方图偏移512字节。</block>
  <block id="b53cb977228ac351c16dfacc3c427a99" category="paragraph">此外、还可以使用<block ref="20e637b3ddd562732de038fba736c7ee" prefix=" " category="inline-code"></block> 统计信息不为零、这意味着执行的I/O未填满整个4 KB块。</block>
  <block id="d3d92f87c5235ad11c8bc69e85fb2fd0" category="section-title">重做日志记录</block>
  <block id="162b54d51a30629d78e153f8da201780" category="paragraph">此处介绍的过程适用于数据文件。Oracle重做日志和归档日志具有不同的I/O模式。例如、重做日志记录是对单个文件的循环覆盖。如果使用默认的512字节块大小、则写入统计信息如下所示：</block>
  <block id="d36dbaa617441d3308f5a9b50cb6f5ca" category="paragraph">I/O将分布在所有直方图分段中、但这不是性能问题。但是、使用4 KB块大小可能会有利于极高的重做日志记录速率。在这种情况下、需要确保重做日志记录LUN正确对齐。但是、这对于获得良好性能并不像数据文件对齐那样重要。</block>
  <block id="3f9e1e3abd12ad7445baea4b681b9ceb" category="paragraph">如果Oracle数据库服务器崩溃、则在重新启动时、陈旧的NFS锁定可能会出现问题。通过仔细注意服务器上的名称解析配置、可以避免此问题。</block>
  <block id="288ebefc25180862eb0448b786b1b9fc" category="paragraph">出现此问题的原因是、创建锁定和清除锁定使用两种略有不同的名称解析方法。其中涉及两个进程、即网络锁定管理器(Network Lock Manager、NLM)和NFS客户端。NLM使用<block ref="e5caaf154dfeed411b9eec65b903a22a" prefix=" " category="inline-code"></block> 要确定主机名、请使用<block ref="d49331f31f40041ebcee19fca74fd9d4" prefix=" " category="inline-code"></block> 流程使用<block ref="330c4316ae6124616389eb1ca9912f7a" prefix=" " category="inline-code"></block>。这些主机名必须匹配、操作系统才能正确清除陈旧锁定。例如、主机可能正在查找属于的锁定<block ref="c7169a6dd344d0f0a38071a1262e4973" prefix=" " category="inline-code"></block>，但主机已将锁定注册为<block ref="0c32c65f5ac66d0bdb4e63bd5fde7f75" prefix=" " category="inline-code"></block>。条件<block ref="330c4316ae6124616389eb1ca9912f7a" prefix=" " category="inline-code"></block> 返回的值与不相同<block ref="5c020b5bb8d1ce1ace51c2a2f4c06fc2" prefix=" " category="inline-code"></block>，则锁定释放过程未成功。</block>
  <block id="19b9a1f540971d74c69042125bab2abc" category="paragraph">以下示例脚本将验证名称解析是否完全一致：</block>
  <block id="ee04b3fa3b28391874763596275e09c9" category="paragraph">条件<block ref="b64c6f211add16fd66ac17ef14c2a2b4" prefix=" " category="inline-code"></block> 不匹配<block ref="4040592cec1880aa70936989f05e7c31" prefix=" " category="inline-code"></block>，可能是陈旧的锁定。例如、此结果揭示了一个潜在问题：</block>
  <block id="2b500e5914ea5a219ade17dea0808f51" category="paragraph">通常、可以通过更改主机在中的显示顺序来查找解决方案<block ref="ad942c725cd0cae65ca4c63717ec464c" prefix=" " category="inline-code"></block>。例如、假设主机文件包含以下条目：</block>
  <block id="22b58ec1cec48707dfc018e6e216e966" category="paragraph">要解析此问题描述、请更改完全限定域名和短主机名的显示顺序：</block>
  <block id="e357ccd0745db58f22ea5c0947b613ee" category="paragraph"><block ref="330c4316ae6124616389eb1ca9912f7a" prefix="" category="inline-code"></block> 现在返回短<block ref="c7169a6dd344d0f0a38071a1262e4973" prefix=" " category="inline-code"></block> 主机名、与的输出匹配<block ref="4040592cec1880aa70936989f05e7c31" prefix=" " category="inline-code"></block>。因此、锁定会在服务器崩溃后自动清除。</block>
  <block id="ea4c55be196897a16d86999f5c16d582" category="doc">虚拟化</block>
  <block id="9e28dbd7a4f5940eeaf6d3893c5c4b1f" category="section-title">存储表示</block>
  <block id="151ae53a4100e0a6e83bde4d78083f81" category="list-text">由虚拟机上的iSCSI启动程序(而不是虚拟机管理程序)管理的iSCSI LUN</block>
  <block id="36f9cea3dc0f65698a9fbe15460591c1" category="list-text">*可移动性。*当VM拥有其文件系统时、移动Oracle环境的过程将变得更加简单。文件系统可以轻松地在虚拟化和非虚拟化子系统之间移动。</block>
  <block id="f114856edc6cd8d6a9add5ec3f67656f" category="section-title">部分驱动程序</block>
  <block id="beeb10ceee6c9aabe178fb51edea7d22" category="paragraph">为了获得最佳性能、使用完全虚拟化的网络驱动程序至关重要。使用数据存储库时、需要使用一个虚拟化的SCSI驱动程序。与虚拟化驱动程序相比、超虚拟化设备驱动程序可以使子系统更深入地集成到虚拟机管理程序中、而在模拟驱动程序中、虚拟机管理程序会花费更多的CPU时间来模拟物理硬件的行为。</block>
  <block id="7c5996fc15a24ce96b30160b60ac2b96" category="section-title">过量使用RAM</block>
  <block id="5bccdd812c4af1cb5b9e36ddce656b60" category="paragraph">过量使用RAM意味着在不同主机上配置的虚拟化RAM要多于物理硬件上的虚拟化RAM。否则可能会出现发生原因意外的性能问题。对数据库进行虚拟化时、虚拟机管理程序不得将Oracle SGA的底层块交换到存储中。这样做会导致性能结果高度不稳定。</block>
  <block id="ff1d278a485c443dc5d8fc9f10f1a702" category="doc">适用于采用VMware Horizon 7的虚拟桌面基础架构的NetApp HCI —为高级用户提供3D图形功能</block>
  <block id="e3162938e0d7b1bbc74111cc5b5871c5" category="paragraph">TR-4792提供了在由NVIDIA图形处理单元(GPU)和虚拟化软件提供支持的VMware Horizon环境中使用NetApp H615C计算节点处理3D图形工作负载的指导。此外、还提供了对H615C的SPECviewperf 13进行的初步测试的结果。</block>
  <block id="1de37c09602b46db5de57a946efe2768" category="paragraph"><block ref="1de37c09602b46db5de57a946efe2768" category="inline-link-macro-rx"></block></block>
  <block id="93b94e62ad8cb02a1d1a7b0944a5445d" category="summary">本文档讨论适用于 VMware vSphere 的 ONTAP 工具的产品安全性。</block>
  <block id="57a033c33a8be6110be46b2914cc4989" category="doc">将ONTAP 与虚拟卷结合使用</block>
  <block id="21247c4392dc3c243f693dbf5b762553" category="section-title">产品和文档</block>
  <block id="94ef809dc16e728151bda996f8b4f8aa" category="inline-image-macro">ONTAP 工具VASA Provider架构,240</block>
  <block id="d78de3410d86d345a548abdf67aff375" category="paragraph"><block ref="d78de3410d86d345a548abdf67aff375" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5e5421e75636200787a4449a2cdaa1f1" category="section-title">产品安装</block>
  <block id="72333dadacbc964761fb14f718f6d411" category="section-title">产品文档</block>
  <block id="e0644c46fdc2ced2c094f7db15e15a8a" category="paragraph">以下文档可帮助您部署ONTAP 工具。</block>
  <block id="be11c74c1dd7f307bb80183a90dc2067" category="section-title">入门</block>
  <block id="7d0ee6fed10d3d4e5c9ee496729ab519" category="inline-link">发行说明</block>
  <block id="3d7fe3e43f9f24fffe5ed0d546d12f13" category="inline-link">部署 ONTAP 工具</block>
  <block id="a2fa58344be7fbd9a2be0320a8df0f77" category="inline-link">升级 ONTAP 工具</block>
  <block id="21e2a89d708329706ec6ed3fc989a1f6" category="section-title">使用 ONTAP 工具</block>
  <block id="317bbf73ff27c5f981628c8fb83ebf22" category="inline-link">配置基于角色的访问控制</block>
  <block id="641e9457539249e880725760f91d5ee2" category="inline-link">配置高可用性</block>
  <block id="04edeb5424c826c14a69edb777edf395" category="section-title">保护和管理数据存储库</block>
  <block id="dd5138e8a4207a5b2fde43b411a4b5e1" category="section-title">VASA Provider信息板</block>
  <block id="cd47dd01745339787e4c7300389401f2" category="section-title">最佳实践</block>
  <block id="9ae938622297e9d4b14dd0006a8f0bf4" category="paragraph">*限制*</block>
  <block id="b4f52a4fd0b07c9d904b95fc98a1cd45" category="inline-link">配置最大值</block>
  <block id="130b78bfd6c9b050a912fec77e285e3f" category="cell">容量 / 功能</block>
  <block id="72e0ee397942f7233122887584f94b8b" category="paragraph">在vSphere中使用ONTAP vvol非常简单、并且遵循已发布的vSphere方法(请参见适用于您的ESXi版本的VMware文档中的在vSphere存储下使用虚拟卷)。以下是与ONTAP 结合使用时需要考虑的一些其他实践。</block>
  <block id="83583580d98b69cb8317f9b285f3c8df" category="cell">*使用适用于VMware vSphere的UI扩展或REST API的ONTAP 工具来配置vvol数据存储库*和协议端点*</block>
  <block id="e8d5f9dc0bff953a9e59755813c7e8bf" category="cell">*切勿将ONTAP 工具设备或vCenter Server设备(VCSA)存储在其所管理的VVOLs数据存储库中。*</block>
  <block id="ab8d352870fb5334773c7177d3d5dcd1" category="cell">*避免在不同ONTAP 版本之间执行虚拟卷操作。*</block>
  <block id="8b2bcef781b7e1f6d64739147d50aae7" category="cell">VASA Provider的各个版本中支持的存储功能(例如QoS、特性等)发生了变化、其中一些功能取决于ONTAP 版本。在ONTAP 集群中使用不同版本或在具有不同版本的集群之间移动虚拟卷可能会导致意外行为或合规性警报。</block>
  <block id="cd7bf0e1e61341c1aa3fa23401af8a27" category="inline-image-macro">具有四个节点的单个启动程序分区、400</block>
  <block id="51591d05b7e084ba8e5ae7f63172177e" category="inline-link">_TR-4080：《现代SAN ONTAP 9_最佳实践》</block>
  <block id="c1723e6a0e1d3dd28232b33e0cb6e61d" category="inline-link">_TR-4684使用NVMe-oF实施和配置现代SAN</block>
  <block id="ee3cbda1c3c4a14ae024478c7ada6d11" category="cell">*遵循所有协议最佳实践。*</block>
  <block id="6a2c1ac1da51eca0c1a65afffab8dfab" category="inline-image-macro">使用基于NFS v3、500的vvol进行网络配置</block>
  <block id="918febfed3d070cf1250909e5cdcf31d" category="paragraph">本文档介绍了适用于VMware vSphere虚拟卷(vvol)的ONTAP 功能、包括最新的产品信息和用例以及最佳实践和其他可简化部署和减少错误的信息。</block>
  <block id="d30f04665be7a6d9663004b1b5e61a9a" category="paragraph">最佳实践是指南和兼容性列表等其他文档的补充。它们是根据 NetApp 工程师和客户的实验室测试和丰富的现场经验开发的。它们可能不是唯一有效或受支持的实践、但通常是最简单的解决方案、可满足大多数客户的需求。</block>
  <block id="cc713c330b9c4e00d3ed7233bc54a889" category="section-title">虚拟卷(Virtual Volume、Virtual Volume、Virtual Volume)概述</block>
  <block id="cbf0aa9daeb855e4eace1a3bdc474ce2" category="paragraph">需要注意以下几个组件：</block>
  <block id="919601826e1d58bccaaab76d787871d2" category="cell">这是一个软件组件、用于处理VMware vSphere与存储系统之间的通信。对于ONTAP 、VASA Provider在一种称为适用于VMware vSphere的ONTAP 工具(简称ONTAP 工具)的设备中运行。ONTAP 工具还包括一个vCenter插件、一个适用于VMware Site Recovery Manager的存储复制适配器(Storage Replication Adapter、SRA)以及用于构建您自己的自动化的REST API服务器。配置ONTAP 工具并将其注册到vCenter后、几乎不再需要直接与ONTAP 系统交互、因为几乎所有存储需求都可以直接在vCenter UI中进行管理、或者通过REST API自动化进行管理。</block>
  <block id="3b2cd9018385f55c53c9a8b756df8bb5" category="cell">协议端点是ESXi主机和VMware数据存储库之间的I/O代理。ONTAP VASA Provider会自动创建这些LUN、可以是VVOL数据存储库的每个FlexVol卷一个协议端点LUN (大小为4 MB)、也可以是托管此数据存储库中的FlexVol卷的存储节点上的每个NFS接口(NFS挂载点、LIF)一个。ESXi主机直接装载这些协议端点、而不是装载单个VVOLLUN和虚拟磁盘文件。协议端点由VASA Provider自动创建、挂载、卸载和删除、因此无需对这些端点进行管理、同时也无需管理任何必要的接口组或导出策略。</block>
  <block id="71afca0aa1a505ea2ac3ce5a1a681549" category="paragraph">vSphere 8中的新增功能是、在将基于网络结构的NVMe (NVMe-oF)与vvol结合使用时、协议端点的概念在ONTAP 中不再适用。相反、ESXi主机会在第一个虚拟机启动后自动为每个ANA组建立虚拟PE。ONTAP 会自动为数据存储库使用的每个FlexVol 卷创建ANA组。</block>
  <block id="8202498953d2ebcf9968c37a7e47f4f6" category="paragraph">使用NVMe-oF for VVOLs的另一个优势是、VASA Provider不需要任何绑定请求。相反、ESXi主机会根据VPE在内部处理VVOl绑定功能。这样可以减少VVOV绑定风暴影响服务的机会。</block>
  <block id="70532c0374111d897ef1176b34b6396c" category="inline-link">NVMe和虚拟卷</block>
  <block id="50ec55042a7f4e8c2c66219ac096cfb3" category="inline-link">vmware.com</block>
  <block id="113c9d4e642d1ba4cc469267fb7fd0de" category="paragraph">有关详细信息，请参见<block ref="f8d477cd77073d731aafe4f52026608a" category="inline-link-rx"></block> 开启<block ref="1f1565cca975c4a703345d21e7f273b8" category="inline-link-rx"></block></block>
  <block id="2ce0d6ec59cca7e0b6e0bdc389301e63" category="section-title">使用存储策略部署虚拟机</block>
  <block id="e0795f8b847058e171dec5a519757ece" category="image-alt">使用存储策略部署虚拟机</block>
  <block id="941431bc1cecb0ec5e89e78e9a5a96fc" category="section-title">虚拟机存储策略合规性</block>
  <block id="bfd6dec22a6a1724ff1b67f1f289cdfc" category="image-alt">虚拟机存储策略合规性</block>
  <block id="274bc582ca884fc158ea9ac9f79f9067" category="inline-link">ONTAP 产品文档</block>
  <block id="5ca60fe92dec435059ba5acefa4ce2c9" category="paragraph">_有关ONTAP 的详细信息，请参见<block ref="8a9b15dc18a16e0b1acfa438e27f6aa6" category="inline-link-rx"></block>_</block>
  <block id="3dffa984dadf9ff0006ee9cebd3b04b9" category="inline-link">TR-4597</block>
  <block id="d3fb76da5fbbcd6fa32e40910b5b9a47" category="section-title">将ONTAP与虚拟卷结合使用的优势</block>
  <block id="3f4dbd6687bd0d55bf69fe5fdd0137c4" category="list-text">*更智能的配置。*存储系统功能可通过VASAAPI公开、使配置工作流可以利用高级功能、而虚拟机管理员无需了解如何管理存储系统。</block>
  <block id="a13fcc9220d042cae454e9ac073636ca" category="list-text">*配置速度更快。*单个数据存储库可支持不同的存储功能、并根据虚拟机策略自动为虚拟机选择相应的存储功能。</block>
  <block id="eb4c052226108afebf26e670208b9a55" category="list-text">*避免出错。*存储和VM策略是提前制定的、并根据需要应用、而无需在每次配置VM时自定义存储。如果存储功能偏离定义的策略、则会发出合规警报。如前文所述、通过使用SCP、初始配置可预测且可重复、而根据SCP制定VM存储策略可确保准确放置。</block>
  <block id="f9878e32fdf258284c007eaae38773cd" category="section-title">在现代SAN上进行VM粒度管理</block>
  <block id="f61f57f748f5f0b52c7f11f1f1bd43f0" category="section-title">更出色的存储卸载功能</block>
  <block id="911fa02c34dda38cd69be06e524ed9d0" category="inline-link">效率担保</block>
  <block id="a8567b4dc683947384ef2e1dd0fc6ac1" category="section-title">常见的卷使用情形</block>
  <block id="48e535b80538b088fd868fde9372715c" category="paragraph">除了这些优势之外、我们还会看到VVOV存储的以下常见使用情形：</block>
  <block id="441f01ec38e91fad1b235a0e7422a178" category="list-text">*按需配置虚拟机*</block>
  <block id="bd652a918164d8fa5176b5f9b92c2e61" category="list-text">私有云或服务提供商的IaaS。</block>
  <block id="4fbc1141a40f5259e3ab1545de52b1ea" category="list-text">*一流磁盘(FCD)*</block>
  <block id="2511e4e8cbb72027ae20f24008d4b939" category="list-text">*按需配置临时虚拟机*</block>
  <block id="eeb1044cc319a5d53503e45dbf762291" category="list-text">测试/开发实验室</block>
  <block id="858d314810762abccaa7baf230e3dc18" category="list-text">培训环境</block>
  <block id="ab7bbc294bf0f0354980a3014e8f4219" category="section-title">使用卷的常见优势</block>
  <block id="ccd6ea8c57e93a5401d07aab9c60f371" category="paragraph">在充分发挥其优势时(例如在上述使用情形中)、此类卷可提供以下具体改进：</block>
  <block id="1c21847cdc5616af138ba0c03aad7adb" category="list-text">在将TKG与vSphere CSI结合使用时、Vvol是理想的存储技术、可提供由vCenter管理员管理的离散存储类和容量。</block>
  <block id="7e7040600922b2a78715f856613a3c08" category="doc">保护卷</block>
  <block id="de92c927f248723e4668aec459709995" category="section-title">VASA Provider高可用性</block>
  <block id="f4d4cb8868f07cad16bd7de7e36c5201" category="paragraph">NetApp VASA Provider与vCenter插件和REST API服务器(以前称为Virtual Storage Console [VSC])以及Storage Replication Adapter一起作为虚拟设备的一部分运行。如果VASA Provider不可用、则使用vvol的VM将继续运行。但是、无法创建新的vvol数据存储库、也无法创建vvol或将其绑定到vSphere。这意味着、由于vCenter无法请求创建交换vVol、因此无法启动使用vVol的VM。并且正在运行的VM无法使用vMotion迁移到其他主机、因为vvol无法绑定到新主机。</block>
  <block id="3958bf41787d7fcc6a9f8dd9348c947f" category="paragraph">VASA Provider 7.1及更高版本支持一些新功能、可确保服务在需要时可用。它包括用于监控VASA Provider和集成数据库服务的新监视程序进程。如果检测到故障、则会更新日志文件、然后自动重新启动服务。</block>
  <block id="1acc458c695b0d3dfbf588309801fda2" category="paragraph">vSphere管理员必须使用与保护其他任务关键型VM免受软件、主机硬件和网络故障影响相同的可用性功能来配置进一步的保护。要使用这些功能、无需对虚拟设备进行其他配置；只需使用标准vSphere方法进行配置即可。它们已通过测试、并受NetApp支持。</block>
  <block id="ff43afff832597ff45e5abeab2826ccf" category="inline-link">适用于VMware vSphere的ONTAP 工具文档(为ONTAP 工具配置高可用性)</block>
  <block id="d516ca4c9c18446a82d9fc9ee85bd955" category="paragraph">vSphere High Availability可轻松配置为在发生故障时在主机集群中的另一主机上重新启动虚拟机。vSphere Fault Tolvance可通过创建一个持续复制并可随时接管的二级虚拟机来提高可用性。有关这些功能的追加信息 、请参见<block ref="b6d78cbf1d5afb52929c529b32a350ad" category="inline-link-rx"></block>以及VMware vSphere文档(请在ESXi和vCenter Server下查找vSphere可用性)。</block>
  <block id="97ba24d475ff6fdc7743099992cc301f" category="paragraph">ONTAP 工具VASA Provider会自动实时将vvol配置备份到托管ONTAP 系统、其中vvol信息存储在FlexVol 卷元数据中。如果ONTAP 工具设备因任何原因而不可用、您可以轻松快速地部署新设备并导入配置。有关VASA Provider恢复步骤的详细信息、请参见此知识库文章：</block>
  <block id="6799b6ec743f9159edf3b43790210a11" category="inline-link">如何执行VASA Provider灾难恢复—解决方案指南</block>
  <block id="9462790a7557a7eb2fe9daad4b875817" category="paragraph"><block ref="9462790a7557a7eb2fe9daad4b875817" category="inline-link-rx"></block></block>
  <block id="029a7740ecd792264454f9dbe194e980" category="section-title">卷复制</block>
  <block id="c7b26217fd0c9041b6f779a0f669de5c" category="paragraph">许多ONTAP 客户使用NetApp SnapMirror将其传统数据存储库复制到二级存储系统、然后在发生灾难时使用二级系统恢复单个VM或整个站点。在大多数情况下、客户会使用软件工具来管理此问题、例如适用于VMware vSphere的NetApp SnapCenter插件等备份软件产品或VMware Site Recovery Manager等灾难恢复解决方案(以及ONTAP工具中的存储复制适配器)。</block>
  <block id="bc6303e4538280b1b01d45a5f7d20039" category="paragraph">这种对软件工具的要求对于管理vols复制更为重要。虽然某些方面可以通过本机功能进行管理(例如、由VMware管理的vvol快照会卸载到使用快速、高效的文件或LUN克隆的ONTAP)、但通常需要通过业务流程来管理复制和恢复。有关vvol的元数据受ONTAP 和VASA Provider保护、但要在二级站点上使用这些元数据、需要进行额外处理。</block>
  <block id="c6a26835eb364bad22b16cb127b74135" category="paragraph">ONTAP 工具9.7.1与VMware Site Recovery Manager (SRM) 8.3版结合使用、可利用NetApp SnapMirror技术增加对灾难恢复和迁移工作流流程编排的支持。</block>
  <block id="8142fcf496d02a58ce02a17558db863e" category="paragraph">目前、VMware SRM是NetApp支持的唯一适用于vvol的灾难恢复和迁移自动化解决方案 、ONTAP 工具将检查是否存在已向vCenter注册的SRM 8.3或更高版本服务器、然后再允许您启用vvol复制。 虽然可以利用ONTAP 工具REST API创建您自己的服务。</block>
  <block id="7d8e8eced8d8b1a50f20640ffb5d363a" category="section-title">使用SRM进行的卷复制</block>
  <block id="c95aede1de7a41511c9d962deba49054" category="section-title">MetroCluster 支持</block>
  <block id="3f15bb720adb42bd521a2ce1cb3a2974" category="paragraph">虽然ONTAP 工具无法触发MetroCluster 切换、但它支持在统一vSphere Metro Storage Cluster (VMSC)配置中使用NetApp MetroCluster 系统作为Vvol的后备卷。MetroCluster 系统的切换将按常规方式进行。</block>
  <block id="cde16c5ee89c209c821e120caf65bb81" category="paragraph">虽然NetApp SnapMirror业务连续性(SM-BC)也可用作VMSC配置的基础、但Vvol目前不支持它。</block>
  <block id="c859f5cd725cb2d1b163e4b066bede9a" category="paragraph">有关NetApp MetroCluster 的详细信息、请参见以下指南：</block>
  <block id="e5e0fb3ae5564674a6548ade7c601578" category="inline-link">_TR-4689 MetroCluster IP解决方案 架构和设计_</block>
  <block id="e64de4e49a37e62ff7f8c37e859bbeb9" category="paragraph"><block ref="e64de4e49a37e62ff7f8c37e859bbeb9" category="inline-link-rx"></block></block>
  <block id="0229efec9dc9b9a7fdf144b025157176" category="inline-link">_TR-4705 NetApp MetroCluster 解决方案 架构和设计_</block>
  <block id="6aee4b78ffdfaf193918978472d660a7" category="paragraph"><block ref="6aee4b78ffdfaf193918978472d660a7" category="inline-link-rx"></block></block>
  <block id="876341bac548f230eb390348e8b075ad" category="inline-link">_VMware知识库2031038 NetApp MetroCluster 的VMware vSphere支持_</block>
  <block id="5e68486fffeebad2ed145408dc250367" category="paragraph"><block ref="5e68486fffeebad2ed145408dc250367" category="inline-link-rx"></block></block>
  <block id="50c323f7050912164118ba47eab75888" category="section-title">《vCenter Server备份概述》</block>
  <block id="6751e706567f4773c4f3138b4de51a0f" category="paragraph">保护VM有多种方法、例如使用子系统内备份代理、将VM数据文件附加到备份代理或使用定义的API (如VMware VADP)。可以使用相同的机制来保护V卷、许多NetApp合作伙伴都支持VM备份、包括Vvol。</block>
  <block id="416d27c872769e934ac8a49ec98ccb53" category="paragraph">如前文所述、VMware vCenter管理的快照会卸载到节省空间的快速ONTAP 文件/LUN克隆。这些快照可用于快速手动备份、但受vCenter限制、最多不超过32个快照。您可以使用vCenter根据需要创建快照和还原。</block>
  <block id="8f3d5ae5bd7d8922841975ccd84b8526" category="paragraph">从适用于VMware vSphere (SCV) 4.6的SnapCenter 插件开始、如果与ONTAP 工具9.10及更高版本结合使用、则可通过支持SnapMirror和SnapVault 复制的ONTAP FlexVol 卷快照为基于Vvol的VM添加崩溃状态一致的备份和恢复功能。每个卷最多支持1023个快照。SCV还可以使用SnapMirror和镜像存储策略在二级卷上存储更多快照、保留时间更长。</block>
  <block id="1429a9379faa8e82f8b198e93eebdf61" category="paragraph">vSphere 8.0支持是在SCV 4.7中引入的、它使用一个隔离的本地插件架构。vSphere 8.0U1支持已添加到SCV 4.8中、并已完全过渡到新的远程插件架构。</block>
  <block id="de1d77d00dae616276b6ceb6296a18f2" category="section-title">适用于VMware vSphere的vvol Backup with SnapCenter 插件</block>
  <block id="02f41838319aab980999b60967d7fd53" category="paragraph">现在、借助NetApp SnapCenter、您可以基于标记和/或文件夹为Vvol创建资源组、以便为基于Vvol的VM自动利用ONTAP基于FlexVol的快照。这样、您可以定义备份和恢复服务、当VM在环境中动态配置时、这些服务将自动保护VM。</block>
  <block id="4549a2943666c4815098331d30a872da" category="paragraph">适用于VMware vSphere的SnapCenter 插件部署为注册为vCenter扩展的独立设备、可通过vCenter UI或REST API进行管理、以实现备份和恢复服务自动化。</block>
  <block id="26e2418d177df1dddb008e455ce28752" category="section-title">SnapCenter 架构</block>
  <block id="c32197281aa44f57ae568a9a42c7b3b6" category="paragraph">由于其他SnapCenter插件在撰写本文时尚不支持虚拟卷、因此我们将在本文档中重点介绍独立部署模式。</block>
  <block id="6750052f2c0fb06d80a8efd7cb871190" category="paragraph">由于SnapCenter 使用ONTAP FlexVol 快照、因此vSphere不会产生任何开销、也不会像使用vCenter托管快照的传统VM那样对性能造成任何影响。此外、由于选择控制阀的功能通过REST API公开、因此可以使用VMware Aia Automation、Ansable、Terraform等工具以及几乎任何其他能够使用标准REST API的自动化工具轻松创建自动化工作流。</block>
  <block id="0c889d77d71512ceb7241bd0f6d6ca23" category="inline-link">REST API 概述</block>
  <block id="35eab4195b135718da016e20979f9031" category="paragraph">有关 SnapCenter REST API 的信息，请参见<block ref="33852d6f529e96c0b816da3945bcb1e5" category="inline-link-rx"></block></block>
  <block id="4ee2d383554981f4ea8eff4f35db6832" category="inline-link">适用于 VMware vSphere 的 SnapCenter 插件 REST API</block>
  <block id="63ae61e98eec102c39264a819a3c522e" category="paragraph">有关适用于 VMware vSphere 的 SnapCenter 插件 REST API 的信息，请参见<block ref="40a6c7462de67e21480b7a31e406f8f9" category="inline-link-rx"></block></block>
  <block id="bdf03d5c2a7086b6c916dc96d06a0a6c" category="paragraph">以下最佳实践可帮助您充分利用SnapCenter 部署。</block>
  <block id="60af6a4208b610da54a63a7e3658d5a5" category="list-text">SCV同时支持vCenter Server RBAC和ONTAP RBAC、并包括预定义的vCenter角色、这些角色会在注册插件时自动为您创建。您可以阅读有关支持的RBAC类型的更多信息<block ref="a8ef9d6a500bd8288101245a3828ddb1" category="inline-link-rx"></block></block>
  <block id="0ed0835259b5b8c4b0f0910e7bfe2b17" category="list-text">使用vCenter UI使用所述的预定义角色分配特权最低的帐户访问权限<block ref="17b3487f3493b9c198e03f92348bfca0" category="inline-link-rx"></block>。</block>
  <block id="d53326766687d6bc7fa2e28ee177e809" category="list-text">如果在SnapCenter 服务器中使用SCV，则必须分配_SnapCenterAdmin_角色。</block>
  <block id="61ba6cb0b6021c205d41ed7f6fc1eb71" category="list-text">ONTAP RBAC是指用于添加和管理SCV使用的存储系统的用户帐户。ONTAP RBAC不适用于基于虚拟卷的备份。阅读有关ONTAP RBAC和SCV的更多信息<block ref="e4e865178d3962f87ac5cef3d6d68942" category="inline-link-rx"></block>。</block>
  <block id="1c89ba258526186ea0ec98325b61371b" category="list-text">使用SnapMirror将备份数据集复制到另一个系统、以创建源卷的完整副本。如前所述、您还可以使用镜像存储策略长期保留备份数据、而不受源卷快照保留设置的影响。这两种机制都支持使用这两种方法的卷。</block>
  <block id="9792eeb3b91469abf77746b005d82d77" category="list-text">由于SCV还需要适用于VMware vSphere的ONTAP 工具来实现Vvol功能、因此请始终查看NetApp互操作性表工具(IMT)以了解特定版本的兼容性</block>
  <block id="71c989bd68059e2ddfa4200c60b736c7" category="list-text">如果要将vvol复制与VMware SRM结合使用、请注意策略RPO和备份计划</block>
  <block id="604eb779cbb9af378f7bda71633b5b31" category="list-text">使用符合组织定义的恢复点目标(Recovery Point目标、Recovery Point目标、RPO)的保留设置设计备份策略</block>
  <block id="067ff91a08d3ff453b59d81993b96182" category="list-text">在资源组上配置通知设置、以便在备份运行时收到状态通知(请参见下面的图10)</block>
  <block id="c3add00693172bbbb4dd864bf0ad9116" category="section-title">资源组通知选项</block>
  <block id="6eae9510711f8df8f55a15e1761875d9" category="section-title">使用这些文档开始使用选择控制阀</block>
  <block id="235a656535515ab3518937c09836e60d" category="inline-link">了解适用于 VMware vSphere 的 SnapCenter 插件</block>
  <block id="79eb02d2a96cc634df87bec5bd511bbe" category="paragraph"><block ref="79eb02d2a96cc634df87bec5bd511bbe" category="inline-link-rx"></block></block>
  <block id="04e7bb0411c1c8f56ca4fc8000c62ad8" category="inline-link">部署适用于 VMware vSphere 的 SnapCenter 插件</block>
  <block id="d4ba0aa084ae1145248006481c881d29" category="paragraph"><block ref="d4ba0aa084ae1145248006481c881d29" category="inline-link-rx"></block></block>
  <block id="231cf4c70d866b616c21baddaeed0696" category="doc">故障排除</block>
  <block id="9d2169c1c2855b78a7aeaa4f42d27dc7" category="section-title">NetApp 支持站点</block>
  <block id="ed9018b2e8611a3d2c03bb6a205b9715" category="inline-link">适用于 VMware vSphere 的 ONTAP 工具</block>
  <block id="fff460b039580a1bd42725a397b4c8be" category="inline-link">_ NetApp 支持站点 _</block>
  <block id="897515b5a8a03f8d5cbed44fd47ef9f3" category="paragraph"><block ref="897515b5a8a03f8d5cbed44fd47ef9f3" category="inline-link-rx"></block></block>
  <block id="4020fd07f5ee2361dd23956e6a334ffd" category="paragraph">有关其他解决方案 文档、请访问：</block>
  <block id="baf17f6d2396be5fd3676baf863a331f" category="section-title">产品故障排除</block>
  <block id="9d6d7fa1a5253698556ac2b0cda2207d" category="paragraph">ONTAP 工具的各种组件(例如vCenter插件、VASA Provider和Storage Replication Adapter)都记录在NetApp文档库中。但是、每个都有一个单独的知识库子部分、并且可能具有特定的故障排除过程。这些说明解决了使用VASA Provider时可能遇到的最常见问题。</block>
  <block id="ae2a93a809929192ecc7b468f234af84" category="section-title">VASA Provider UI问题</block>
  <block id="92a2b5cb9c6906035c2864fa225e1940" category="inline-link">文章</block>
  <block id="69aecee18a55993c779487758eb051cc" category="paragraph">有时、vCenter vSphere Web Client会遇到与Serenity组件相关的问题、从而导致无法显示适用于ONTAP 的VASA Provider菜单项。请参见部署指南或本知识库中的解决VASA Provider注册问题<block ref="c8979f1604396ce5570d07774ba255f0" category="inline-link-rx"></block>。</block>
  <block id="03cc611b90575ea37b55959adaa1c754" category="section-title">配置卷数据存储库失败</block>
  <block id="281b890be0e8280eea1aebb82de90961" category="paragraph">有时、在创建Vvol数据存储库时、vCenter服务可能会超时。要更正此错误、请重新启动vmware-sps服务、然后使用vCenter菜单("Storage"(存储)&gt;"New DataStorage"(新建数据存储库)重新挂载Vvol数据存储库。此问题将在《管理指南》中的"使用vCenter Server 6.5配置Vvol数据存储库失败"一节中进行介绍。</block>
  <block id="3152add163cd8aaf116a259d85ebf8fb" category="section-title">升级Unified Appliance无法挂载ISO</block>
  <block id="ffaa56a3f5a1157f2eb3955773bb41da" category="paragraph">由于vCenter中的错误、用于将Unified Appliance从一个版本升级到下一个版本的ISO可能无法挂载。如果ISO能够连接到vCenter中的设备、请按照本知识库中的过程进行操作<block ref="9839383ed04f777c0132b57ad0cb14ac" category="inline-link-rx"></block> 以解决此问题。</block>
  <block id="cacba1b456347ce8f32c7f5ed0d81e64" category="doc">部署Virtual Storage</block>
  <block id="3db9849d9f30bfc6e05c4e0b36d28848" category="section-title">将VM从传统数据存储库迁移到Vvol</block>
  <block id="58f2a764a13ec89d3c5ead5343e75637" category="section-title">使用策略管理VM</block>
  <block id="a4332a81dbc3a9888be608dea640cd3d" category="section-title">正在创建VM存储策略</block>
  <block id="7de504873f20af5c8ce6dadd2f79b29a" category="list-text">ONTAP 工具使用当前支持的ONTAP 版本创建单个非共享QoS策略。因此、每个单独的VMDK都将收到自己分配的IOPS。</block>
  <block id="63a33ddbd2c3ccd2daac06020248049f" category="section-title">正在重新应用虚拟机存储策略</block>
  <block id="50b6e1c7f2e81842d993d8ce88acc979" category="summary">ONTAP 支持用于虚拟化的所有主要存储协议，例如 iSCSI ，光纤通道（ FC ），以太网光纤通道（ FCoE ）或适用于 SAN 环境的非易失性光纤通道快速内存（ NVMe/FC ），以及 NFS （ v3 和 v4.1 ）和 SMB 或 S3 （用于子系统连接）。客户可以自由选择最适合其环境的协议，并可以根据需要在一个系统上组合协议。</block>
  <block id="ee8cc65cae83009c275cd4748f4c58ae" category="doc">适用于 ONTAP 的虚拟化工具</block>
  <block id="e08c666b5127e745f8aacbacfce37dcf" category="list-text">*适用于ONTAP 的VASA Provider。*适用于ONTAP 的VASA Provider支持VMware vStorage APIs for Storage Awareness (VASA)框架。它作为适用于 VMware vSphere 的 ONTAP 工具的一部分提供，作为一个虚拟设备，易于部署。VASA Provider 可将 vCenter Server 与 ONTAP 连接起来，以帮助配置和监控 VM 存储。它支持 VMware 虚拟卷（ VVOL ）支持，管理存储功能配置文件和单个 VM VVOL 性能，并提供警报以监控容量和配置文件合规性。</block>
  <block id="a1c13ec555198266776a3a7b904810dd" category="paragraph">下图显示了适用于 vSphere 的 ONTAP 工具。</block>
  <block id="dd55e255500b9ec15305dc69dfa0e15b" category="section-title">适用于 VMware VAAI 的 NFS 插件</block>
  <block id="00cdd3f66e02711548cf72d579ec0df8" category="summary">使用 SnapCenter ，您可以创建可应用于多个作业的备份策略。这些策略可以定义计划，保留，复制和其他功能。它们仍然允许选择虚拟机一致的快照、从而利用虚拟机管理程序在创建VMware快照之前将I/O置于静修状态的功能。</block>
  <block id="f1d1eddd608fe98b6fa2bc3436ce81d0" category="doc">基于存储策略的管理和虚拟卷</block>
  <block id="871db14a81b3510676400538c6f07073" category="paragraph">值得一看的是、这种方法可以帮助您简化虚拟化存储操作、避免大量琐碎的工作。</block>
  <block id="44d75bdf4feecabe2de10427870ae623" category="paragraph">SCP支持为VM的数据Vvol设置最小和/或最大QoS。只有 AFF 系统才支持最低 QoS 。适用于 VMware vSphere 的 ONTAP 工具包含一个信息板，用于显示 ONTAP 系统上 VVol 的 VM 粒度性能和逻辑容量。</block>
  <block id="4240fa68f6d9919e6d039c4038175025" category="paragraph">下图显示了适用于 VMware vSphere 9.8 VVol 的 ONTAP 工具信息板。</block>
  <block id="50e0e66922b3b12510a128829d1fdc70" category="paragraph">定义存储功能配置文件后，可以使用该配置文件来使用存储策略来配置 VM ，以确定其要求。通过 VM 存储策略与数据存储库存储功能配置文件之间的映射， vCenter 可以显示一个兼容数据存储库列表以供选择。这种方法称为基于存储策略的管理。</block>
  <block id="794b6e2fc393d40a552fc58975920cb0" category="paragraph">VASA 提供了查询存储并将一组存储功能返回到 vCenter 的技术。VASA 供应商提供程序可在存储系统 API 和构造与 vCenter 可识别的 VMware API 之间进行转换。适用于ONTAP的NetApp VASA Provider是作为适用于VMware vSphere设备VM的ONTAP工具的一部分提供的、vCenter插件提供了用于配置和管理VVOP数据存储库的界面、并能够定义存储功能配置文件(Storage Capability profile、SCP)。</block>
  <block id="dad160104969c39365dd2cd4c98dd300" category="inline-link">TR-4400</block>
  <block id="bd490c925219bcb312338a370589bf70" category="list-text">一个 VVOL 数据存储库可以在多个集群节点上包含多个 FlexVol 卷。最简单的方法是使用一个数据存储库，即使卷具有不同的功能也是如此。SPBM 可确保为 VM 使用兼容的卷。但是，这些卷都必须属于一个 ONTAP SVM ，并使用一个协议进行访问。对于每个协议，每个节点一个 LIF 就足够了。避免在一个 VVOL 数据存储库中使用多个 ONTAP 版本，因为存储功能可能因版本而异。</block>
  <block id="0cc956d6da91fefae9dad9b2c8c9519b" category="list-text">使用适用于 VMware vSphere 的 ONTAP 工具插件创建和管理 VVOL 数据存储库。除了管理数据存储库及其配置文件之外，它还会根据需要自动创建一个协议端点来访问 VVol 。如果使用 LUN ，请注意， LUN PE 会使用 LUN ID 300 及更高版本进行映射。验证ESXi主机的高级系统设置<block ref="ce913b4e625461a33f54f9e4ac38c2d7" prefix=" " category="inline-code"></block> 允许LUN ID号大于300 (默认值为1、024)。执行此步骤的方法是、在vCenter中选择ESXi主机、然后选择配置选项卡并查找<block ref="ce913b4e625461a33f54f9e4ac38c2d7" prefix=" " category="inline-code"></block> 在高级系统设置列表中。</block>
  <block id="fac85f355a1eb47127ef1b94e7603924" category="list-text">请勿将适用于 VMware vSphere 的 VASA Provider ， vCenter Server （设备或基于 Windows ）或 ONTAP 工具本身安装或迁移到 VVOL 数据存储库中，因为它们相互依赖，因此会限制您在发生断电或其他数据中心中断时对其进行管理的能力。</block>
  <block id="dd76252ea7a50def2a98f218cb1505b4" category="inline-link">知识库文章</block>
  <block id="15ef75dd3d20b8278c16cd01a708e13e" category="list-text">定期备份 VASA Provider 虚拟机。至少每小时为包含VASA Provider的传统数据存储库创建一次快照。有关保护和恢复 VASA Provider 的详细信息，请参见此部分<block ref="9d642870dca1748c69f7aa0b6fb95a89" category="inline-link-rx"></block>。</block>
  <block id="2d2d2e356f9ab117b7d2a58d42cc5988" category="paragraph">下图显示了 VVOL 组件。</block>
  <block id="d3ba101543fc97ba1dd9272c87bf65da" category="doc">虚拟卷（ VVOL ）和基于存储策略的管理（ SPBM ）</block>
  <block id="fda9c21a4aefd4a1f42ad0b195e6ef0a" category="inline-link">TR-4400 ：采用 ONTAP 的 VMware vSphere 虚拟卷</block>
  <block id="61823c0f572643e0ce2e4edcb74cae51" category="paragraph">使用快照快速创建虚拟机或数据存储库的副本而不影响性能、然后使用SnapMirror将其发送到二级系统、以实现长期异地数据保护。这种方法只存储更改后的信息，从而最大限度地减少存储空间和网络带宽。</block>
  <block id="1556ba0bf6ea4783cda0ff40e96f0265" category="paragraph">下图显示了 SnapCenter 部署的一个示例。</block>
  <block id="650062685b0df8284f1b87f62fa3f9f3" category="inline-link">TR-4128</block>
  <block id="92515b597b8c0784d6000b89ee47c5fd" category="doc">统一存储</block>
  <block id="d6154a0901f9ca6bb5d8fb15c113581e" category="paragraph"><block ref="d6154a0901f9ca6bb5d8fb15c113581e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e9e0f5f2c513c7138ea70b4c929d6fef" category="inline-link">存储虚拟化</block>
  <block id="400cc516a4a40acd605aef2cfd4ba4c0" category="doc">VMware Storage Distributed Resource Scheduler</block>
  <block id="e7649bfbacc438bf8e20ba3564db4bdd" category="paragraph">然后，它会在数据存储库集群（也称为 Pod ）中的数据存储库之间无中断地移动虚拟机或 VMDK ，从而选择最佳数据存储库，以便将虚拟机或 VMDK 放置在数据存储库集群中。数据存储库集群是一组相似的数据存储库、从vSphere管理员的角度来看、这些数据存储库会聚合到一个使用单元中。</block>
  <block id="b028cce2007c32457c41f20d2954c0c2" category="paragraph">有关 SDRS 的其他 ONTAP 最佳实践包括：</block>
  <block id="d11eff5be5178b7ba95b06270611ffc8" category="list-text">集群中的所有数据存储库都应使用相同类型的存储（例如 SAS ， SATA 或 SSD ），可以是所有 VMFS 或 NFS 数据存储库，并且具有相同的复制和保护设置。</block>
  <block id="76db7ce67615bbc16da685df79ed0aa9" category="list-text">请考虑在默认（手动）模式下使用 SDRS 。通过此方法，您可以查看建议并决定是否应用这些建议。请注意 VMDK 迁移的以下影响：</block>
  <block id="97f4ed95cb52bb29629002a25cb5039f" category="list-text">在数据存储库之间移动 VMDK 时，通过 ONTAP 克隆或重复数据删除节省的任何空间都将丢失。您可以重新运行重复数据删除以重新获得这些节省。</block>
  <block id="38f492286c3edf236c76e993ce0f0bf2" category="list-text">在SDRS移动VMDK后、NetApp建议在源数据存储库中重新创建快照、因为空间会被移动的VM锁定。</block>
  <block id="09a99cbc4fb85d10c7af970e79032a05" category="list-text">在同一聚合上的数据存储库之间移动 VMDK 没有什么优势， SDRS 无法查看可能共享该聚合的其他工作负载。</block>
  <block id="09b616c445ab7efa8240062532e526e4" category="doc">采用ONTAP的VMware vSphere</block>
  <block id="48e29772cebbf1133d022577e278d5c1" category="admonition">本文档可替代先前发布的技术报告_TR-4597：《适用于ONTAP的VMware vSphere》_</block>
  <block id="bfa7e7fc7c6bf4cc4e4c5c74b09763eb" category="paragraph">最佳实践是指南和兼容性列表等其他文档的补充。它们是根据 NetApp 工程师和客户的实验室测试和丰富的现场经验开发的。它们可能并不是在每个环境中都能使用的唯一受支持的实践，但它们通常是最简单的解决方案，可满足大多数客户的需求。</block>
  <block id="9ed4a475dd3705157a9fed8811f63ce2" category="inline-link">NetApp 互操作性表工具</block>
  <block id="e08175c6fa64cba68719dea85ebd9d34" category="inline-link">VMware 兼容性指南</block>
  <block id="a110ecc6d4ce7014019c560e5fedf572" category="paragraph">成千上万的客户选择ONTAP作为其vSphere存储解决方案的原因有很多、例如、支持SAN和NAS协议的统一存储系统、使用节省空间的快照的强大数据保护功能以及大量可帮助您管理应用程序数据的工具。使用与虚拟机管理程序不同的存储系统，您可以卸载许多功能，并最大程度地提高对 vSphere 主机系统的投资。这种方法不仅可以确保主机资源专注于应用程序工作负载，还可以避免存储操作对应用程序造成随机性能影响。</block>
  <block id="7a61ec7965eebc0b5486cb78f096c770" category="list-text">等等。 * 利用 NetApp AFF A 系列阵列的极致性能，在管理成本的同时加快虚拟化基础架构的运行速度。使用横向扩展 ONTAP 集群享受从维护到升级到完全更换存储系统的无中断运行。利用 NetApp 加密功能保护空闲数据，无需额外付费。通过精细的服务质量功能确保性能满足业务服务级别要求。它们都是行业领先的企业级数据管理软件ONTAP提供的广泛功能的一部分。</block>
  <block id="6104c8ef7be4222a76596ab6a22bb422" category="doc">建议的 ESXi 主机和其他 ONTAP 设置</block>
  <block id="678582eb0cbbe0e063e618d230b63223" category="cell">*主机设置*</block>
  <block id="dfe49b73bd7e747701b49f9ed21ea2d6" category="cell">* NetApp建议值*</block>
  <block id="edceae57d92287f4f6200f94d3259cd0" category="cell">*需要重新启动*</block>
  <block id="dc3a6955a23583876d020db0f6b80d4d" category="cell">* ESXi高级配置*</block>
  <block id="73663d0d00956f0632e4ae75d811d53f" category="cell">VMFS3.HardwareAcceleratedLocking</block>
  <block id="59b1aceaef0203fdc32e11df232b16e6" category="cell">保留默认值(1)</block>
  <block id="bafd7322c6e97d25b6299b5d6fe8920b" category="cell">否</block>
  <block id="1b50110aedae4d8d2043a4eb9beb20af" category="cell">VMFS3.EnableBlockDelete</block>
  <block id="316084648bbafe451240702bd19c6ee9" category="cell">VMFS3.EnableVMFS6Unmap</block>
  <block id="befd90cd01403237f6fdf296822efbee" category="inline-link-macro">VMware vSphere API：阵列集成(VAAI)</block>
  <block id="571cc1d48c6d1ff3cf7e3a54cb035753" category="cell">*NFS设置*</block>
  <block id="c3b49a515dd0046685e06092642aa139" category="cell">Net.TcpipHeapSize</block>
  <block id="875f6b98e20edfecb56f9013d00987f6" category="cell">vSphere 6.0 或更高版本，设置为 32 。
所有其他NFS配置、设置为30</block>
  <block id="93cba07454f06a4a960172bbd6e2a435" category="cell">是的。</block>
  <block id="504e96cc79e7efe30a8271cea152d9d1" category="cell">Net.TcpipHeapMax</block>
  <block id="5f1e7b6431061565550e292d05c73588" category="cell">NFS.MaxVolumes</block>
  <block id="3058676a1cf088aa4a73312ac36f2a58" category="cell">NFS41.MaxVolumes</block>
  <block id="62c07f94c64184ee5d530e4c0917093f" category="cell">vSphere 6.0或更高版本、请设置为256。</block>
  <block id="e18600af98c17fae10fdba0dc89979ed" category="cell">NFS.MaxQueueDepth^1^</block>
  <block id="be7707fa525d0124489c9fe3072f78de" category="cell">vSphere 6.0或更高版本、设置为128</block>
  <block id="18e1fb6924459470760771b20ab0c379" category="cell">nfs.HeartbeatMaxFailures</block>
  <block id="138989cbe5dd3a4997662e0f65c17878" category="cell">对于所有NFS配置、均设置为10</block>
  <block id="1aa26eb281359ba3b9a9a4b83a09ed46" category="cell">nfs.Heartbeat频率</block>
  <block id="7ea6e8664542e3beb1aea10425efb4db" category="cell">对于所有NFS配置、请设置为12</block>
  <block id="eb4182715f8cde98563dc59ea36461d3" category="cell">nfs.HeartbeatTimeout</block>
  <block id="45aa5481fa55802a29a96aefd2f5dab1" category="cell">对于所有NFS配置、设置为5。</block>
  <block id="54a08b15243d9078d3b5a47f8242da6f" category="cell">SUNRPC.MaxConnPerIP</block>
  <block id="c0b3fd5512c2093847f753f398290f30" category="cell">* FC/FCoE 设置 *</block>
  <block id="2e556ad678160413b32dcca55c7d1f5f" category="cell">路径选择策略</block>
  <block id="fb62337a3ef32f4701b639339a4ceb33" category="cell">如果使用采用 ALUA 的 FC 路径，则设置为 RR （轮循）。对于所有其他配置，设置为 FIXED 。
将此值设置为 RR 有助于在所有主动 / 优化路径之间实现负载平衡。
固定值适用于较旧的非 ALUA 配置，有助于防止代理 I/O换言之、它有助于防止I/O流向在7-模式下运行Data ONTAP 的环境中高可用性(HA)对的另一节点</block>
  <block id="117704664d6cada78ac3107380f63d23" category="cell">disk.qFullSampSize</block>
  <block id="0e82e1f81de2159b0e9bee0b7be00dc9" category="cell">对于所有配置，均设置为 32 。
设置此值有助于防止出现 I/O 错误。</block>
  <block id="f66a3c183f0e736240b77f8b755c880e" category="cell">disk.qFullThreshold</block>
  <block id="bdd8c1d08eabb5e1923ed8f0c4b10ba4" category="cell">对于所有配置、均设置为8。
设置此值有助于防止出现 I/O 错误。</block>
  <block id="19c08de7404551288e1274186e039ef4" category="cell">Emulex FC HBA 超时</block>
  <block id="b4dbfc2d52627e923cbb563a31ff756d" category="cell">使用默认值。</block>
  <block id="d46cddda4da7ec11f17472d11df95b68" category="cell">QLogic FC HBA 超时</block>
  <block id="19b5aaf3e2cb86809996ca63a2a416b0" category="cell">* iSCSI 设置 *</block>
  <block id="2aa077454308383f1e82025427cd7362" category="cell">对于所有 iSCSI 路径，设置为 RR （轮循）。
将此值设置为 RR 有助于在所有主动 / 优化路径之间实现负载平衡。</block>
  <block id="0340eb1bcbfc6cd3c62b8a878d8d643b" category="cell">对于所有配置，均设置为 32 。
设置此值有助于防止出现I/O错误</block>
  <block id="891c10448731ad57490b9a932dabfff8" category="inline-link-macro">VMware知识库86331</block>
  <block id="fb55ee99c04280ac638757869929785d" category="paragraph">在创建 ONTAP FlexVol 卷和 LUN 时， ONTAP 工具还会指定某些默认设置：</block>
  <block id="3f7502a5f109d7a73706aba1c0741a4b" category="cell">* ONTAP Tool*</block>
  <block id="485577e97e8efcd504fc8e8b13e613f1" category="cell">*默认设置*</block>
  <block id="5938fe448c8661febcef3f4e779e3adb" category="cell">Snapshot 预留（ -percent-snapshot-space ）</block>
  <block id="cfcd208495d565ef66e7dff9f98764da" category="cell">0</block>
  <block id="7218aec62575561a6de1cae8d5658390" category="cell">预留百分比（ -fractional-reserve ）</block>
  <block id="3a7e09ff0fa38663ffe6d91324ea75d9" category="cell">访问时间更新（ -atime-update ）</block>
  <block id="f8320b26d30ab433c5a54546d21f414c" category="cell">false</block>
  <block id="e93200d5b0d16915bf04236790544b2f" category="cell">最小预读（ -min-readahead ）</block>
  <block id="c877d89702fdd14e51b02028a20c7d07" category="cell">计划快照</block>
  <block id="fd18465573ec21a6218982055981f6b1" category="cell">存储效率</block>
  <block id="00d23a76e43b46dae9ec7aa9dcbebb32" category="cell">enabled</block>
  <block id="f65fd63b63c9e9f25bf6bc141e83de34" category="cell">卷保证</block>
  <block id="c2410aebdf425dabcc65e546e506b03e" category="cell">无（精简配置）</block>
  <block id="f97c03bf3e9580446d70d479f5aad1e0" category="cell">卷自动调整大小</block>
  <block id="d89f4f8b1d7c18847b88b46142f61535" category="cell">grow_shrink</block>
  <block id="ace72ec54e17777d27eb8bdb9d57e782" category="cell">LUN 空间预留</block>
  <block id="b9f5c797ebbf55adccdd8539a65a0241" category="cell">已禁用</block>
  <block id="514aa7792a71ab4ab677eb2385131aae" category="cell">LUN 空间分配</block>
  <block id="dbe1e98b00264bd496095ed5c95f9350" category="section-title">多路径性能设置</block>
  <block id="de9f44b08eec22d6b405acff2c925d56" category="paragraph">虽然当前未使用可用的ONTAP工具进行配置、但NetApp建议使用以下配置选项：</block>
  <block id="01d954fb2edbf283d121f0651b04de83" category="section-title">其他文档</block>
  <block id="40db5019ed68654f4eb2cf21ec5021db" category="inline-link">将VMware vSphere 7.x与ONTAP结合使用</block>
  <block id="30d85838b9488ee908d075559c8978cd" category="inline-link">将VMware vSphere 8.x与ONTAP结合使用</block>
  <block id="000c9205416c1ea85f6841a7ca379c17" category="inline-link">对于NVMe-oF、有关详细信息、请参见适用于采用ONTAP的ESXi 7.x的NVMe-oF主机配置</block>
  <block id="5a27e6dbe6279e323aec51d205b2b455" category="inline-link">对于NVMe-oF、有关详细信息、请参见适用于采用ONTAP的ESXi 8.x的NVMe-oF主机配置</block>
  <block id="99a66df20e19a8e18fae37a7f714750a" category="doc">虚拟机和数据存储库克隆</block>
  <block id="fe12a277656562082ad50b980c227a84" category="paragraph">在 vSphere 中，您可以克隆虚拟机，虚拟磁盘， VVol 或数据存储库。克隆后，通常可以通过自动化过程进一步自定义对象。vSphere 既支持完整副本克隆，也支持链接克隆，在这些克隆中，它可以独立于原始对象跟踪更改。</block>
  <block id="883a97a36ab0c59ec785b03161a1cc32" category="paragraph">链接克隆非常有助于节省空间，但它们会增加 vSphere 为虚拟机处理的 I/O 量，从而影响该虚拟机的性能，甚至整个主机的性能。因此、NetApp客户经常使用基于存储系统的克隆来充分利用这两种环境：高效利用存储和提高性能。</block>
  <block id="17e1a153b5d05c5a642c93ba9ce3c6de" category="paragraph">下图显示了 ONTAP 克隆。</block>
  <block id="d957242cd67db8ffccec78d93c14449d" category="list-text">使用 NetApp vSphere APIs for Storage Awareness （ VASA ） Provider 的 VVOL 。  ONTAP克隆用于支持由vCenter管理的VVol快照、这些快照可节省空间、并且创建和删除这些快照时的I/O影响极小。  此外，还可以使用 vCenter 克隆 VM ，这些 VM 也会卸载到 ONTAP ，无论是在单个数据存储库 / 卷中还是在数据存储库 / 卷之间。</block>
  <block id="f3968368501d882b3969da59138db6e2" category="paragraph">您也可以直接在 ONTAP 中克隆卷或 LUN 以克隆数据存储库。使用 NFS 数据存储库时， FlexClone 技术可以克隆整个卷，并且可以从 ONTAP 导出克隆并由 ESXi 作为另一个数据存储库挂载该克隆。对于 VMFS 数据存储库， ONTAP 可以克隆卷或整个卷中的 LUN ，包括其中的一个或多个 LUN 。包含 VMFS 的 LUN 必须映射到 ESXi 启动程序组（ igroup ），然后由 ESXi 重新签名，才能挂载并用作常规数据存储库。对于某些临时使用情形，可以挂载克隆的 VMFS 而无需重新签名。克隆数据存储库后，可以注册，重新配置和自定义数据存储库中的 VM ，就像它们是单独克隆的 VM 一样。</block>
  <block id="2d506b6088a383ccf08479b0f80c0ff4" category="paragraph">在某些情况下，可以使用其他许可功能来增强克隆功能，例如用于备份的 SnapRestore 或 FlexClone 。这些许可证通常包含在许可证包中，无需额外付费。要执行vVol克隆操作以及支持vVol的受管快照(从虚拟机管理程序卸载到ONTAP)、需要FlexClone许可证。在数据存储库 / 卷中使用 FlexClone 许可证还可以改进某些基于 VAAI 的克隆（创建节省空间的即时副本，而不是块副本）。  此外， SRA 还会使用它来测试灾难恢复副本的恢复，并使用 SnapCenter 来执行克隆操作，以及浏览备份副本以还原单个文件。</block>
  <block id="5dd57c2a315d3af44c2eb40eefc47111" category="doc">网络配置：</block>
  <block id="66507f357c74ee12194270cfe053b98d" category="paragraph">需要考虑以下几点：</block>
  <block id="7c4904daaa282388097ad83bf382e1a5" category="list-text">如果您的网络需要并支持巨型帧，则可以使用巨型帧，尤其是在使用 iSCSI 时。如果使用这些协议，请确保在存储和 ESXi 主机之间的路径中的所有网络设备， VLAN 等上对其进行相同的配置。否则，您可能会看到性能或连接问题。此外，还必须在 ESXi 虚拟交换机， VMkernel 端口以及每个 ONTAP 节点的物理端口或接口组上以相同的方式设置 MTU 。</block>
  <block id="8b6e7f43d1d697e8f99164f0aa2ab1b6" category="inline-link">TR-4182</block>
  <block id="730a8287f758961d602b1b050bbe2751" category="list-text">当 ESXi 和 ONTAP 存储阵列连接到以太网存储网络时， NetApp 建议将这些系统连接到的以太网端口配置为快速生成树协议（ RSTP ）边缘端口或使用 Cisco PortFast 功能。NetApp 建议在使用 Cisco PortFast 功能且为 ESXi 服务器或 ONTAP 存储阵列启用了 802.1Q VLAN 中继的环境中启用生成树 PortFast 中继功能。</block>
  <block id="ac4976538e1fc8726f77afc202561afc" category="list-text">NetApp 建议采用以下链路聚合最佳实践：</block>
  <block id="19d137845c7f6687c99b386dfad0aa97" category="list-text">对连接到ESXi的交换机端口禁用LACP、除非您使用的是配置了LACP的dvSwitches 5.1或更高版本。</block>
  <block id="30254a2bb3e4b3b958b06d08c724e7db" category="list-text">使用LACP为具有IP哈希的动态多模式接口组的ONTAP 存储系统创建链路聚合。</block>
  <block id="d608421cceb8e4c584a2a32d9127879e" category="list-text">在ESXi上使用IP哈希绑定策略。</block>
  <block id="2432030fc6183a1a6c52cf5e93f3e9ae" category="paragraph">下表汇总了网络配置项，并指出了这些设置的应用位置。</block>
  <block id="7d74f3b92b19da5e606d737d339a9679" category="cell">项目</block>
  <block id="1aa66ef3a8e34a7a538960a80d2e1e31" category="cell">ESXi</block>
  <block id="bbc155fb2b111bf61c4f5ff892915e6b" category="cell">交换机</block>
  <block id="6c3a6944a808a7c0bbb6788dbec54a9f" category="cell">Node</block>
  <block id="0b7e67b6cdcf0432b624d53588d520fb" category="cell">SVM</block>
  <block id="75ba8d70e3692ba200f0e0df37b4d2ae" category="cell">IP 地址</block>
  <block id="ee6c0f25c2881cc69947a2ef23be5b8c" category="cell">VMkernel</block>
  <block id="e11f298a5bd5344d2d975b5157c27b69" category="cell">否</block>
  <block id="d6f0876f76c273b8962b749c36153157" category="cell">链路聚合</block>
  <block id="fabd320b3b2249377e53e93099e27657" category="cell">虚拟交换机</block>
  <block id="b1b40427c8eb8d0a083ddb16e250325b" category="cell">否 *</block>
  <block id="9881f82f0dd89588831f9d1682bd5492" category="cell">VLAN</block>
  <block id="5fc0d231160fa9650ea5c877f146bbe6" category="cell">VMkernel 和 VM 端口组</block>
  <block id="39a3e05f380e583ae2887c79c7443f11" category="cell">流量控制</block>
  <block id="220071ab44b426f80ef21f1c552c363c" category="cell">NIC</block>
  <block id="6f2c08412f489e52a17a30217f50b3c1" category="cell">生成树</block>
  <block id="4b1c0df98ba3f3d1681c3c3dbdc97746" category="cell">MTU （适用于巨型帧）</block>
  <block id="7d6feaf896df4a937157d4ee5b91f4e1" category="cell">虚拟交换机和 VMkernel 端口（ 9000 ）</block>
  <block id="0110e50bd8629573701e73a4ba8b056f" category="cell">是（设置为最大值）</block>
  <block id="061ff5255adf00e4ae68469f43a7bf55" category="cell">是（ 9000 ）</block>
  <block id="bcc0e5a3e08cd34e80692195d056b06d" category="cell">故障转移组</block>
  <block id="a4d1a66a448e327c12d3e287098a31d5" category="cell">是（创建）</block>
  <block id="465d5674eb6808b997037470f4dace73" category="cell">是（选择）</block>
  <block id="ba78d695573c8d4f1205452c675fa539" category="paragraph">* SVM LIF连接到具有VLAN、MTU和其他设置的端口、接口组或VLAN接口。但是、这些设置不会在SVM级别进行管理。</block>
  <block id="50ecdab93bf5a2f1bfb4cd8f81b9bd3d" category="paragraph">这些设备具有自己的 IP 地址进行管理，但这些地址不会在 ESXi 存储网络环境中使用。</block>
  <block id="efd0bde36323238fec688b9cdf0c75a3" category="section-title">SAN （ FC ， FCoE ， NVMe/FC ， iSCSI ）， RDM</block>
  <block id="8982d243303f9d1a8c2470b7d55278e6" category="list-text">使用 VMFS 数据存储库</block>
  <block id="9a0098c8c1be287e8d1da1aaf3bd2e59" category="list-text">使用原始设备映射（ RDM ）</block>
  <block id="8466b1e5abb4751e931c5feb1af4e469" category="inline-link">TR-4080</block>
  <block id="4157f0c23fc104508f492dc846f187f3" category="list-text">默认情况下， SLM 处于启用状态。除非使用端口集，否则不需要进行其他配置。</block>
  <block id="ed0e76ed86e852bd7317a09d856ec4e8" category="paragraph">要考虑的其他最佳实践：</block>
  <block id="93586ad57931e0f16fff61cdba9d77df" category="list-text">确保为 ONTAP 集群中每个节点上的每个 SVM 创建一个逻辑接口（ LIF ），以最大程度地提高可用性和移动性。ONTAP SAN 最佳实践是，每个节点使用两个物理端口和 LIF ，每个网络结构使用一个。ALUA 用于解析路径并识别活动优化（直接）路径与活动非优化路径。ALUA 用于 FC ， FCoE 和 iSCSI 。</block>
  <block id="b3cebb7381bddbabb1e950a46d264190" category="list-text">对于 iSCSI 网络，如果存在多个虚拟交换机，请在采用 NIC 绑定的不同网络子网上使用多个 VMkernel 网络接口。您还可以使用连接到多个物理交换机的多个物理 NIC 来提供 HA 并提高吞吐量。下图提供了多路径连接的示例。在 ONTAP 中，使用连接到两个或更多交换机的两个或更多链路配置一个单模式接口组以进行故障转移，或者使用 LACP 或其他具有多模式接口组的链路聚合技术来提供 HA 和链路聚合的优势。</block>
  <block id="2968b9f3c141bf23bc73d0e6e15a174a" category="list-text">如果在ESXi中使用质询握手身份验证协议(Challenge-Handshake Authentication Protocol、CHAP)进行目标身份验证、则还必须在ONTAP中使用命令行界面配置此协议 <block ref="199c9b970eacf1c35d84a383b7ceb210" prefix="(" category="inline-code"></block>)或使用System Manager (在"Storage"&gt;"SVM"&gt;"SVM Settings"(SVM设置)&gt;"Protocols"(协议)&gt;"iSCSI"下编辑"Initiator Security"(启动程序安全性)。</block>
  <block id="d31f2e075df4ca75ca0874fa08f74b12" category="list-text">使用适用于 VMware vSphere 的 ONTAP 工具创建和管理 LUN 和 igroup 。此插件会自动确定服务器的 WWPN 并创建适当的 igroup 。它还会根据最佳实践配置 LUN 并将其映射到正确的 igroup 。</block>
  <block id="de78559e8aed2cd62fbf852f73dc58c2" category="inline-link">物理和虚拟兼容模式</block>
  <block id="905221150fdd103b5241870a0a1f2c42" category="list-text">请谨慎使用VMM、因为它们更难管理、而且它们还会使用路径、如前文所述、这些路径会受到限制。ONTAP LUN 支持这两者<block ref="27e1f8e5a88cfbb2836b083145b004c9" category="inline-link-rx"></block> RDM 。</block>
  <block id="636da39a2033c6179a718983c5ce1222" category="inline-link">《 ONTAP NVMe/FC 主机配置指南》</block>
  <block id="81ef6507a13da5635951bc5b533deb59" category="inline-link">TR-4684.</block>
  <block id="15483b0826bb9a4b11d1c89af2029c5c" category="list-text">有关将 NVMe/FC 与 vSphere 7.0 结合使用的详细信息，请参见此部分<block ref="6b4ed262d14e47ef641cd57b65c32c38" category="inline-link-rx"></block> 和<block ref="7a29b2f31035a451d5b068728d2b79a7" category="inline-link-rx"></block>下图显示了从 vSphere 主机到 ONTAP LUN 的多路径连接。</block>
  <block id="743fa5a7bc7d4ba215b096e34779d298" category="paragraph">将 ONTAP NFS 与 vSphere 结合使用时，建议采用以下最佳实践：</block>
  <block id="ae4c5baa79e370d8f601cc7082f8123e" category="list-text">由于 NFSv3 和 NFSv4.1 之间不会自动转换数据存储库，因此请创建一个新的 NFSv4.1 数据存储库，并使用 Storage vMotion 将 VM 迁移到新数据存储库。</block>
  <block id="bd6cc42f9cd65cca72cbd56d2f4bf43d" category="list-text">RO 访问规则： sys</block>
  <block id="0bbc71e6a4ea49af70dd616d3807e524" category="list-text">匿名UID</block>
  <block id="6670a317619282ec228a9ef492af0a76" category="list-text">NFS 数据存储库卷是从 SVM 的根卷接合的；因此， ESXi 也必须有权访问根卷，才能导航和挂载数据存储库卷。根卷以及嵌套了数据存储库卷接合的任何其他卷的导出策略必须包含一条或多条适用于ESXi服务器的规则、以便为其授予只读访问权限。下面是根卷的示例策略、该策略也使用VAAI插件：</block>
  <block id="8c93fb3ff528165613797962f5a0ed9c" category="list-text">访问协议：NFS (包括nfs3和nfs4)</block>
  <block id="80e6a4f964e826c69c1c62bd5ea67590" category="list-text">RW访问规则：从不(根卷的最佳安全性)</block>
  <block id="f96625174b4a06d13267f9b0a5a96d59" category="list-text">超级用户：sys (使用VAAI的根卷也需要此功能)</block>
  <block id="4c571520a8128d1692fc709ffbfb2b1e" category="list-text">使用适用于 VMware vSphere 的 ONTAP 工具（最重要的最佳实践）：</block>
  <block id="23aa7b9aeed3fba2a1ec43e630313af7" category="list-text">使用此插件为VMware集群创建数据存储库时、请选择集群、而不是单个ESX服务器。选择此选项会将数据存储库自动挂载到集群中的所有主机。</block>
  <block id="928562eb576ed6ae31cb1a149d3e751a" category="list-text">如果不对 VMware vSphere 使用 ONTAP 工具，请对所有服务器或需要额外访问控制的每个服务器集群使用一个导出策略。</block>
  <block id="7bccab0fa4c0864835c645c9fde7ebf6" category="list-text">虽然 ONTAP 提供了一个灵活的卷命名空间结构，可以使用接合在树中排列卷，但这种方法对于 vSphere 来说毫无价值。无论存储的命名空间层次结构如何，它都会在数据存储库的根目录下为每个 VM 创建一个目录。因此，最佳实践是，只需将 vSphere 卷的接合路径挂载到 SVM 的根卷，即适用于 VMware vSphere 的 ONTAP 工具如何配置数据存储库。如果没有嵌套的接合路径，也意味着任何卷都不依赖于根卷以外的任何卷，即使有意使某个卷脱机或销毁该卷，也不会影响指向其他卷的路径。</block>
  <block id="ea6fc1288f1d3b21238d29ff28cb867a" category="list-text">对于 NFS 数据存储库上的 NTFS 分区，块大小为 4k 是可以的。下图显示了从 vSphere 主机到 ONTAP NFS 数据存储库的连接。</block>
  <block id="e54433644e830ed1503561b778e9ded4" category="paragraph">下表列出了 NFS 版本和支持的功能。</block>
  <block id="9fb9dac7513c7ef8452aade8a52ad40d" category="cell">vSphere 功能</block>
  <block id="5b12ee0369243579651edca43ff65c85" category="cell">NFSv3</block>
  <block id="de841868c2911da76b8ae2da9fa3166d" category="cell">NFSv4.1</block>
  <block id="64e3cc476958b05086721cd6070004cf" category="cell">VMotion 和 Storage vMotion</block>
  <block id="05807e454c19f244770adae059b3c330" category="cell">高可用性</block>
  <block id="45a75e44a713fdf94dbf1dbaa0749188" category="cell">容错</block>
  <block id="f1e3446c69e4d87279ff7863482f9dcb" category="cell">DRS</block>
  <block id="6ca09f98e8925b2cb78bbf24eccc0186" category="cell">主机配置文件</block>
  <block id="ec8420797e3b089812499cce4047ded8" category="cell">存储 DRS</block>
  <block id="7c19bf1cbe62a87a42857ef0b4fe22ae" category="cell">存储 I/O 控制</block>
  <block id="56d43ad1a280ada5e16fd2960ae44b32" category="cell">SRM</block>
  <block id="d595c8f30866b71ea121ced5cde66b1d" category="cell">虚拟卷</block>
  <block id="6ad5114acf73f68a85c72f11646920cb" category="cell">硬件加速（ VAAI ）</block>
  <block id="ad37ded9046268d8e5ea7cb253bb5dda" category="cell">Kerberos 身份验证</block>
  <block id="45701e6ef9bc09dca07f8f4abe661dc6" category="cell">是（在 vSphere 6.5 及更高版本中进行了增强，可支持 AES ， krb5i ）</block>
  <block id="76969a36155d2f41fc6cc3bd3faff244" category="cell">多路径支持</block>
  <block id="be0ec3d9251292dd856ea0924ecc6873" category="doc">服务质量（ QoS ）</block>
  <block id="534ecd446aac2f9c809eef9064f44aab" category="paragraph">可以使用 MBps 和 / 或 IOPS 设置对象的 QoS 最大吞吐量限制。如果同时使用这两者，则 ONTAP 会强制实施达到的第一个限制。一个工作负载可以包含多个对象，一个 QoS 策略可以应用于一个或多个工作负载。将一个策略应用于多个工作负载时，这些工作负载将共享此策略的总限制。不支持嵌套对象（例如，卷中的文件不能各自具有自己的策略）。QoS 最小值只能以 IOPS 为单位进行设置。</block>
  <block id="040f184b126879657b253b6d258661d9" category="paragraph">目前，以下工具可用于管理 ONTAP QoS 策略并将其应用于对象：</block>
  <block id="de134183bea5df515a6756a539ce6f18" category="list-text">ONTAP 命令行界面</block>
  <block id="6ad5e0a20f49ad6a370454bb3afc9a9e" category="list-text">ONTAP 系统管理器</block>
  <block id="8e23e05fc0865e950d6a3581e0dd8ce9" category="list-text">OnCommand Workflow Automation</block>
  <block id="5ecb6b24c169667ff1a176768115659e" category="list-text">Active IQ Unified Manager</block>
  <block id="8cc4e713850f67a131e9dbf8b997f61e" category="list-text">适用于 ONTAP 的 NetApp PowerShell 工具包</block>
  <block id="fcdb48d0d22627e4910a8352c80bd87a" category="list-text">适用于 VMware vSphere VASA Provider 的 ONTAP 工具</block>
  <block id="e6defd03e0f49585b6d47614713e97f7" category="paragraph">要将 QoS 策略分配给 NFS 上的 VMDK ，请注意以下准则：</block>
  <block id="2175e0e29bc4b213fa8b9c7afd591b6b" category="list-text">不要将策略应用于其他虚拟机文件、例如虚拟交换文件 <block ref="aa33c3c1850a3f99cec7426e2c411d08" prefix="(" category="inline-code"></block>）。</block>
  <block id="8230e9b5c1e9862fedb2c69f7cc5d3d1" category="list-text">在使用vSphere Web Client查找文件路径("数据存储库"&gt;"文件")时、请注意、它会合并的信息<block ref="f149d7424e10a266ec998ca5b32b81bb" prefix=" " category="inline-code"></block> 和<block ref="4a78be158c13cd6b2dc2100a80bb7070" prefix=" " category="inline-code"></block> 只需显示一个名为的文件<block ref="4a78be158c13cd6b2dc2100a80bb7070" prefix=" " category="inline-code"></block> 但的大小<block ref="f149d7424e10a266ec998ca5b32b81bb" prefix=" " category="inline-code"></block>。添加<block ref="4fc4e556dbb9dcede037ccd80fabd784" prefix=" " category="inline-code"></block> 以获取正确的路径。</block>
  <block id="1d4614aca13104c98d5d8cc2d415b941" category="paragraph">要为 LUN （包括 VMFS 和 RDM ）分配 QoS 策略，可以从适用于 VMware vSphere 的 ONTAP 工具主页上的存储系统菜单获取 ONTAP SVM （显示为 Vserver ）， LUN 路径和序列号。选择存储系统(SVM)、然后选择相关对象&gt; SAN。  使用 ONTAP 工具之一指定 QoS 时，请使用此方法。</block>
  <block id="77bb2ba950959bd3f1c55da523ace0be" category="section-title">ONTAP QoS 和 VMware SIOC</block>
  <block id="5ad234cb2cde4266195252a23ca7d84e" category="cell">属性</block>
  <block id="b8b8d1ba8fa345f03438a90f29af5784" category="cell">ONTAP QoS</block>
  <block id="c2a4cb962db2a4a6782b69864f0e411c" category="cell">VMware SIIOC</block>
  <block id="aa628d5a66888444926b4dc042458200" category="cell">处于活动状态时</block>
  <block id="688b10fcfff927dee65634e3b3636064" category="cell">策略始终处于活动状态</block>
  <block id="a981c4aa67c29ff2d36fc614d8b28808" category="cell">存在争用时处于活动状态（数据存储库延迟超过阈值）</block>
  <block id="f46e64a82c96db56f3d6657d4fb53f00" category="cell">单位类型</block>
  <block id="878b4223bb85b95d8caf0429d9406cd5" category="cell">IOPS ， MBps</block>
  <block id="3e189a34f422a141311dad231f9ad5b5" category="cell">IOPS ，共享</block>
  <block id="7367a0ec46339213625cbc77d56a9572" category="cell">vCenter 或应用程序范围</block>
  <block id="1faff19290bb64ce8ff6bc1220496881" category="cell">多个 vCenter 环境，其他虚拟机管理程序和应用程序</block>
  <block id="1e664a3cc0ab109fcabcc81b488cebb1" category="cell">单个 vCenter 服务器</block>
  <block id="ebccc9f5c939841d86e5382988dfcc47" category="cell">是否在虚拟机上设置 QoS ？</block>
  <block id="cddd0980ce99890d2ea90288f6b03117" category="cell">仅限 NFS 上的 VMDK</block>
  <block id="928629d8a2a889f5274cad9940a06da0" category="cell">NFS 或 VMFS 上的 VMDK</block>
  <block id="305e85b992089534091855224f60cf75" category="cell">是否为 LUN 设置 QoS （ RDM ）？</block>
  <block id="e798014243cf5682e7fb3aaf4ee7cecf" category="cell">是否为 LUN （ VMFS ）设置 QoS ？</block>
  <block id="9cd021ea9d3c88de723fe9a2e50a2380" category="cell">是否为卷（ NFS 数据存储库）设置 QoS ？</block>
  <block id="c352b53c32380efcf4436926da6d0414" category="cell">是否在 SVM （租户）上设置 QoS ？</block>
  <block id="5dad340ee8f9e8fa9b65bf86a9fd5341" category="cell">基于策略的方法？</block>
  <block id="b31c76176f26196c6379a9bcce212d99" category="cell">是；可以由策略中的所有工作负载共享，也可以将其全部应用于策略中的每个工作负载。</block>
  <block id="1ff33557bad923d68973872cacf2e43a" category="cell">是，在 vSphere 6.5 及更高版本中。</block>
  <block id="d5f1465492190ee9d30a09b36f64f4b7" category="cell">需要许可证</block>
  <block id="4cec76d82991abd453484c23f7e3788a" category="cell">随 ONTAP 提供</block>
  <block id="6bb36803f4670824ff9ebdf665654829" category="cell">Enterprise Plus</block>
  <block id="d4d4b5b65bebf236590d70c702a6ba6b" category="paragraph">VMware Storage Distributed Resource Scheduler （ SDRS ）是一项 vSphere 功能，可根据当前 I/O 延迟和空间使用情况将 VM 放置在存储上。然后，它会在数据存储库集群（也称为 Pod ）中的数据存储库之间无中断地移动虚拟机或 VMDK ，从而选择最佳数据存储库，以便将虚拟机或 VMDK 放置在数据存储库集群中。数据存储库集群是一组相似的数据存储库、从vSphere管理员的角度来看、这些数据存储库会聚合到一个使用单元中。</block>
  <block id="0ce8b0e3e0d7dc7f39c62fb74a28b3bf" category="section-title">云迁移和备份</block>
  <block id="4fe11b4a91ff38ec9933009a15dd5b0b" category="paragraph">ONTAP 的另一个优势是广泛支持混合云，将内部私有云中的系统与公有云功能相结合。以下是可与 vSphere 结合使用的一些 NetApp 云解决方案：</block>
  <block id="99c6c4d349151c1f4a6694e424aef741" category="inline-link">为VM存储更多快照</block>
  <block id="01fa297dbdab5aceb83a45a98161efe0" category="list-text">* FabricPool 。 * FabricPool 可为 ONTAP 数据快速轻松地分层。冷块可以迁移到公有云或私有StorageGRID对象存储中的对象存储、并在再次访问ONTAP数据时自动重新调用。或者，使用对象层作为已由 SnapVault 管理的数据的第三级保护。这种方法可以让您做到<block ref="60d027dbb3c3f076cbb70c6b246eb433" category="inline-link-rx"></block> 在主和 / 或二级 ONTAP 存储系统上。</block>
  <block id="1a7072854c9dd945a98f4314b3f77408" category="list-text">* ONTAP Select 。 * 使用 NetApp 软件定义的存储将您的私有云扩展到 Internet 上的远程设施和办公室，您可以在这些设施和办公室使用 ONTAP Select 支持块和文件服务以及您在企业数据中心拥有的相同 vSphere 数据管理功能。</block>
  <block id="af63597853dc0983258c8f86a12aae0b" category="section-title">vSphere 数据加密</block>
  <block id="63a07ab9352c9297cea3894d6cd41c3f" category="paragraph">如今，通过加密保护空闲数据的需求日益增长。虽然最初的关注点是金融和医疗保健信息、但人们越来越关注保护所有信息、无论是存储在文件、数据库中还是其他数据类型中。</block>
  <block id="937a352e0f824ff55e4cd50c8e3b051e" category="paragraph">可以通过多种方法保护在 VMware vSphere 上运行的虚拟化应用程序的数据。一种方法是在子操作系统级别使用虚拟机中的软件保护数据。vSphere 6.5 等较新的虚拟机管理程序现在支持在 VM 级别进行加密，这是另一种替代方案。但是， NetApp 软件加密简单易用，并且具有以下优势：</block>
  <block id="6eda79cc710edc32583cf567b00e7672" category="list-text">* 对虚拟服务器 CPU 没有影响。 * 某些虚拟服务器环境需要为其应用程序提供每个可用的 CPU 周期，但测试表明，使用虚拟机管理程序级别的加密最多需要 5 倍的 CPU 资源。即使加密软件支持英特尔的AES-NI指令集来卸载加密工作负载(就像NetApp软件加密一样)、但由于需要新CPU来与旧服务器不兼容、因此这种方法可能不可行。</block>
  <block id="c216121021de8554d33503ef6616b256" category="list-text">* 对存储效率没有影响。 * 重复数据删除和数据压缩等存储效率技术目前已广泛应用，是经济高效地使用闪存磁盘介质的关键。但是，加密数据通常无法进行重复数据删除或压缩。与其他方法不同， NetApp 硬件和存储加密的运行级别较低，并允许充分利用行业领先的 NetApp 存储效率功能。</block>
  <block id="5f9aa8333f218d1c21e67c8608a48672" category="list-text">* 轻松的数据存储库粒度加密。 * 借助 NetApp 卷加密，每个卷都获得自己的 AES 256 位密钥。如果需要更改，只需使用一个命令即可。如果您有多个租户或需要为不同部门或应用程序证明独立加密，则此方法非常适合。此加密在数据存储库级别进行管理，比管理单个虚拟机要简单得多。</block>
  <block id="c95fa5b56a01e5c1a80c540c1ab1a750" category="paragraph">通过 Active IQ Unified Manager 可以查看虚拟基础架构中的虚拟机，并监控虚拟环境中的存储和性能问题并对其进行故障排除。</block>
  <block id="be75250c2f30870dc1e359b4ade2a767" category="paragraph">ONTAP 上的典型虚拟基础架构部署包含多个组件，这些组件分布在计算层，网络层和存储层上。VM 应用程序中的任何性能滞后都可能是由于各个层的各个组件同时面临的延迟造成的。</block>
  <block id="d1734f6f2e65a1488896f74695db5254" category="paragraph">以下屏幕截图显示了 Active IQ Unified Manager 虚拟机视图。</block>
  <block id="2118336fa447fcc0f213cb8c40c516af" category="paragraph">Unified Manager 以拓扑视图形式呈现虚拟环境的底层子系统，用于确定计算节点，网络或存储是否发生延迟问题描述。此视图还会突出显示导致执行补救步骤和解决底层问题描述时出现性能滞后的特定对象。</block>
  <block id="d8a78b994fcd4e04901203a2e7bc6414" category="paragraph">以下屏幕截图显示了 AIQUM 扩展拓扑。</block>
  <block id="f02207fb26160d7e47cf5ea35d07df03" category="doc">数据存储库和协议</block>
  <block id="a7c815fafe60ae637d38216fa6300395" category="list-text">FCP</block>
  <block id="26bcb9f1cb6f391f4b2c18e676bb458d" category="list-text">NVMe/FC</block>
  <block id="8b7c42123642e2e4ea7dd426aeb2de58" category="list-text">NVMe/TCP</block>
  <block id="e4e1c13bb0b14f6cb7608cbecea948ef" category="list-text">iSCSI</block>
  <block id="f7d773fd2896401c143676940bc001fc" category="list-text">NFS v3</block>
  <block id="0b99b245267ef194ca3b9f6e694b0983" category="list-text">NFS v4.1</block>
  <block id="9da73946f1bc3be4a41898d06c9d2e8b" category="cell">功能 / 功能</block>
  <block id="6151632541dcd80356c6c76b34d69d0c" category="cell">NVMe-oF</block>
  <block id="520d0db389f362bf79ef56ca0af3dcab" category="cell">格式。</block>
  <block id="99a3142584ca8ad0a3afadeaa6f2ef69" category="cell">VMFS 或原始设备映射（ RDM ）</block>
  <block id="26aae26f61844ac20ab7b04ba6f5c515" category="cell">VMFS 或 RDM</block>
  <block id="18263a30df8afc60a733e59c60676ac0" category="cell">VMFS</block>
  <block id="8dc6d0c66219ddb809322c0d248e55e6" category="cell">数据存储库或 LUN 的最大数量</block>
  <block id="aa23f9914ce1939ea7a4d479edfdc915" category="cell">每个主机1024个LUN</block>
  <block id="1af3b27207afc48a363629a315d76b59" category="cell">每个服务器1024个LUN</block>
  <block id="0705fd627c25b5fba17cd9a022ed7d72" category="cell">每个服务器256个命名空间</block>
  <block id="51c0dc217976e27de06e262947947a62" category="cell">最大数据存储库大小</block>
  <block id="856c997f909830b8249756c07dc9452b" category="cell">64 TB</block>
  <block id="b4fb1d41fedaec79072964cbb4d16e3d" category="cell">最大数据存储库文件大小</block>
  <block id="d10549beb2f7bd1e91e5ef8965edd84a" category="cell">62 TB</block>
  <block id="18301e675ce7d51c23071d7b135edbdc" category="cell">使用ONTAP 9.12.1P2及更高版本时为62 TB</block>
  <block id="9aa56a79640231adaec83bc53e59c929" category="cell">每个 LUN 或文件系统的最佳队列深度</block>
  <block id="c7dfde106afbb4e1d55096403af252e0" category="cell">64－256</block>
  <block id="ca6e77250a239af7b4aed9a1ac058825" category="cell">已自动协商</block>
  <block id="edc5121cb9b42a76b718b8ece9d67437" category="paragraph">下表列出了支持的 VMware 存储相关功能。</block>
  <block id="6c1a84b789b54fd42511ce582be94d21" category="cell">VMotion</block>
  <block id="e95b58d02782c970bb339c6cc587ff39" category="cell">存储 vMotion</block>
  <block id="0486e0e3dc3e86859f43b6d8e32b8071" category="cell">VMware HA</block>
  <block id="8be6bd7f20474cbefdd496cb9fd495ca" category="cell">存储分布式资源计划程序（ Storage Distributed Resource Scheduler ， SDRS ）</block>
  <block id="28c2f8ab9cdbf296aa4261bc3c58ba0d" category="cell">虚拟机中的 Microsoft 集群服务（ MSCS ）或故障转移集群</block>
  <block id="aa7f77e663b832d5b0e544c5511e680c" category="cell">不支持</block>
  <block id="aa18abedec09bd4f85e612c307e2eaa6" category="cell">容错</block>
  <block id="17d495427086fa21259b9df40b27e00a" category="cell">精简配置的 VM （虚拟磁盘）</block>
  <block id="4ee7af004efef335d6a14c60ee758f5e" category="cell">是的。
如果不使用VAAI、则此设置是NFS上所有VM的默认设置。</block>
  <block id="13bc264ff420559de4156ec40980a4b9" category="cell">VMware 原生多路径</block>
  <block id="a06819d91a165d0491c5816c54b41234" category="paragraph">下表列出了支持的 ONTAP 存储管理功能。</block>
  <block id="f8d61013f1a3bbf1342f4ced3279c7cf" category="cell">重复数据删除</block>
  <block id="72167540968147afed9deb59f0e9fe00" category="cell">阵列中的节省量</block>
  <block id="9a5473a6abaea16b736f096913a749be" category="cell">数据存储库中的节省量</block>
  <block id="6cd880eabbec3488232c6cba3fbcf998" category="cell">精简配置</block>
  <block id="5caeb11c4ed379b808d7f7cdca7cfbf0" category="cell">数据存储库或 RDM</block>
  <block id="8a5227cc82d14862956938caffc1acf2" category="cell">数据存储库</block>
  <block id="b71ba22dcd42deceac87150206f7bd12" category="cell">调整数据存储库大小</block>
  <block id="c6b792bfd7aac8067d36337e67d11545" category="cell">仅增长</block>
  <block id="29e23534878bb63341e0b689426b7fb0" category="cell">增长，自动增长和缩减</block>
  <block id="76021405cc62a4b8c542e7f65e3d24ed" category="cell">适用于 Windows 和 Linux 应用程序的 SnapCenter 插件（在子系统中）</block>
  <block id="c0b3c629432c82a9e8500242abb35eaf" category="cell">使用适用于 VMware vSphere 的 ONTAP 工具监控和主机配置</block>
  <block id="5a915a8215e9a66bcff0f034e8adff18" category="cell">使用适用于 VMware vSphere 的 ONTAP 工具进行配置</block>
  <block id="6495c7cda42bf1b80bc1c2af6166ef58" category="paragraph">下表列出了支持的备份功能。</block>
  <block id="bf22a1b5bc2b72a75825094826a942de" category="cell">复制的备份支持 SRM</block>
  <block id="60d3f7d9f265eb34e826da352cb545be" category="cell">卷 SnapMirror</block>
  <block id="fabf31a57c142c986c5d88cb089b3d7b" category="cell">VMDK 映像访问</block>
  <block id="d7605580ecad0fcb4528789d74cdcad5" category="cell">vmdk 文件级访问</block>
  <block id="4e3d259d82a536e12c5c9c948b62e26a" category="cell">NDMP 粒度</block>
  <block id="90d45e02e50c81603c36a4e4ad3649d9" category="cell">数据存储库或虚拟机</block>
  <block id="8339c514e73f5cced3b83d504d60441b" category="inline-link">Windows Server 故障转移集群设置</block>
  <block id="54b3e11ce37eaaa9884f4086e72dd2be" category="section-title">选择存储协议</block>
  <block id="0212b4e8bc965dcd8a7ff771dd96bf21" category="paragraph">在考虑选择协议时，以下因素可能会很有用：</block>
  <block id="774f1348caf3e145710073eb634c4fa1" category="list-text">* 易于设置。 * 除了 FC 网络结构的初始配置（额外的交换机以及 HBA 和固件的布线，分区以及互操作性验证）之外，块协议还需要创建和映射 LUN 以及通过子操作系统进行发现和格式化。创建并导出 NFS 卷后，它们将由 ESXi 主机挂载并准备好使用。NFS 没有特殊的硬件资格认定或固件可供管理。</block>
  <block id="530c759326761c6ac026b313985b255f" category="list-text">* 存储空间透明度。 * 在 NFS 环境中，存储利用率通常更容易查看，因为精简配置可以立即实现节省。同样，重复数据删除和克隆节省的空间可立即用于同一数据存储库中的其他虚拟机或其他存储系统卷。NFS 数据存储库中的虚拟机密度通常也会更高，这样可以减少要管理的数据存储库数量，从而节省重复数据删除的空间，并降低管理成本。</block>
  <block id="16ee928b12bc598bf52b0f312879ec95" category="section-title">数据存储库布局</block>
  <block id="8c761039ef4dd69451490b849ace1f82" category="list-text">避免在子操作系统中使用碎片整理实用程序、因为这不会带来任何性能优势、并会影响存储效率和快照空间使用量。此外，还应考虑在子操作系统中关闭虚拟桌面的搜索索引。</block>
  <block id="14abb814748566a24367c4459a54840b" category="list-text">ONTAP 凭借创新的存储效率功能引领行业发展，帮助您充分利用可用磁盘空间。AFF 系统通过默认实时重复数据删除和数据压缩进一步提高了这种效率。数据会在聚合中的所有卷之间进行重复数据删除，因此您无需再将相似的操作系统和类似应用程序分组到一个数据存储库中，即可最大程度地节省空间。</block>
  <block id="446548f2b1301893641e29657fc7fe53" category="inline-link-macro">基于 ONTAP 的 Oracle 数据库</block>
  <block id="6cda576d2fd323c1a728b7ac67d6034f" category="list-text">一级磁盘（或经过改进的虚拟磁盘）支持独立于运行 vSphere 6.5 及更高版本的 VM 的 vCenter 管理磁盘。虽然它们主要由 API 管理，但对于 VVOL 很有用，尤其是在由 OpenStack 或 Kubernetes 工具管理时。ONTAP 以及适用于 VMware vSphere 的 ONTAP 工具均支持这些功能。</block>
  <block id="71318121439b39fdf872bb0bd57494f2" category="section-title">数据存储库和 VM 迁移</block>
  <block id="e8824ce2062c6d1fc536163f7b8940bd" category="paragraph">将 VM 从另一个存储系统上的现有数据存储库迁移到 ONTAP 时，请记住以下一些实践：</block>
  <block id="73b729fbc964c7d78dd90b64aaaeb785" category="list-text">使用 Storage vMotion 将虚拟机的批量移动到 ONTAP 。这种方法不仅不会对正在运行的 VM 造成中断，而且还可以通过实时重复数据删除和数据压缩等 ONTAP 存储效率功能在数据迁移时对其进行处理。请考虑使用 vCenter 功能从清单列表中选择多个 VM ，然后在适当的时间计划迁移（单击操作时使用 Ctrl 键）。</block>
  <block id="9fb2cc2ced88ce872ef16c37d8284360" category="paragraph">此插件还可帮助您在 vSphere 环境中使用其他 ONTAP 工具。您可以通过此插件安装适用于VMware VAAI的NFS插件、以便将副本卸载到ONTAP以执行VM克隆操作、为厚虚拟磁盘文件预留空间以及卸载ONTAP快照。</block>
  <block id="6161d374e9022f89382fd63b4be15aa1" category="section-title">常规网络连接</block>
  <block id="c7949782ad094d3ffc126bee722642a3" category="list-text">使用支持在两个独立交换机机箱上对端口进行链路聚合的交换机、并采用多机箱链路聚合组方法、例如Cisco的虚拟端口通道(vPC)。</block>
  <block id="9dc1904e0c3ace141704b477cd9b345d" category="inline-link">网络管理</block>
  <block id="68ecdb0d7a96e68318a53d12e9fab5b5" category="list-text">使用LACP为具有端口或IP哈希动态多模式接口组的ONTAP存储系统创建链路聚合。请参见<block ref="b87480ad0ff34784c4be1445a72a3aaf" category="inline-link-rx"></block> 以获得进一步指导。</block>
  <block id="3b407fe7c9654197902b1dd26af6dc81" category="list-text">如果对vSphere分布式交换机使用静态链路聚合(例如EtherChannel)和标准vswitch或基于LACP的链路聚合、请在ESXi上使用IP哈希绑定策略。如果未使用链路聚合、请改用"基于源虚拟端口ID路由"。</block>
  <block id="ee1ef6cf0f3971b44eb2abcac958fb8d" category="section-title">FlexGroup 卷</block>
  <block id="dd9bd4a686bdeb1c7f11dc3cd0cda75f" category="paragraph">请考虑以下情形：</block>
  <block id="6b277580cb59b13790b36344e827e22f" category="list-text">您已创建一个包含8个成分卷的新FlexGroup</block>
  <block id="32efd8b10cc3b73c344f4c7e6c4b741e" category="list-text">新FlexGroup的缓存超时设置为160分钟</block>
  <block id="879f959734466d50681eae9b95e7e591" category="paragraph">在这种情况下、要完成的前8个克隆将是完整副本、而不是本地文件克隆。在160秒超时时间到期之前对该VM执行任何其他克隆操作都将使用每个成分卷中的文件克隆引擎以循环方式创建几乎即时的副本、这些副本均匀分布在各个成分卷上。</block>
  <block id="0f98175ace2dd0d56e47961b22b2544b" category="paragraph">如果您无法充分利用FlexGroup缓存、但仍需要快速跨卷克隆、请考虑使用虚拟卷。与使用传统数据存储库相比、使用FlexVol进行跨卷克隆的速度要快得多、并且不依赖于缓存。</block>
  <block id="189aae773e13462525f07e99fcd9e90f" category="inline-link">VAAI：如何对FlexGroup卷使用缓存？</block>
  <block id="ce4df831657d2621e80bbef9271c33cd" category="summary">从传统虚拟设备过渡后， ONTAP 工具可提供大量新功能，更高的限制以及新的 VVOL 支持。</block>
  <block id="116d20fc387d73c8e4a86e7998913947" category="section-title">最新版本的 vSphere 和 Site Recovery Manager</block>
  <block id="7cb1700928c008eb817bc79250cc9002" category="section-title">支持 IPv6</block>
  <block id="ea9aacd1495949730de8eeab11e66459" category="paragraph">现在支持 IPv6 ，但有以下限制：</block>
  <block id="918d32b75f0ab883abba3a8dc0c3ae8d" category="inline-link">互操作性表工具</block>
  <block id="4a4842d7448ef71eb69b013e560b18bb" category="section-title">扩展性更强</block>
  <block id="96cb4d41ca97bd9d3d446984d3170a57" category="paragraph">期待已久的一项新功能是采用 ONTAP 9.5 及更高版本的 SnapMirror 同步（ SM-S ），该功能可为任务关键型应用程序提供卷粒度零 RPO 数据复制解决方案。SM-S 需要使用 ONTAP 工具 9.8 或更高版本。</block>
  <block id="b9832b10a87d0c3793ed3b413ee1d839" category="section-title">REST API 支持</block>
  <block id="e3445c3aa798f5ad98665e33d34dd952" category="paragraph">最佳实践是指南和兼容性工具等其他文档的补充。它们是根据 NetApp 工程师和客户的实验室测试和丰富的现场经验开发的。在某些情况下，建议的最佳实践可能不适合您的环境；但是，它们通常是最简单的解决方案，可满足大多数客户的需求。</block>
  <block id="87a7b114355b836acefe833c497611bb" category="paragraph">借助FlexClone、您可以在云服务提供商的数据中心内执行测试故障转移、存储占用空间接近零。现在，保护您的组织的成本比以往任何时候都低。</block>
  <block id="89fafdb11a7e8cd8abebb1d4df053dad" category="doc">复制拓扑</block>
  <block id="be01acd2f018d38f9446f06b99ee4a2a" category="paragraph">在 ONTAP 9 中，集群管理员可以看到集群的物理组件，但使用集群的应用程序和主机无法直接看到这些物理组件。物理组件提供了一个共享资源池，用于构建逻辑集群资源。应用程序和主机仅通过包含卷和 LIF 的 SVM 访问数据。</block>
  <block id="6f55124e085dbeb640e4cb8ad2c97905" category="list-text">SVM 可以控制跨越集群中多个节点的 LUN 和卷。</block>
  <block id="39d9903201320a83d45d3b36d512f051" category="cell">最佳实践</block>
  <block id="2e4472d35f80aa8b7eca52ae3dd43dc6" category="section-title">支持的 SnapMirror 布局</block>
  <block id="86cf5bd2bdb1b1d67f8f907f41099509" category="section-title">支持的阵列管理器布局</block>
  <block id="1ceb46f3e1c6c7995de4ec5f05601227" category="section-title">不支持的布局</block>
  <block id="3f88384b0d5cdcdc25895c644126c1b0" category="section-title">SnapMirror 级联</block>
  <block id="8bd15e818d377a0a5cf6ebc429555f79" category="section-title">SnapMirror 和 SnapVault</block>
  <block id="7878dfbf4b6ad3bc60d095cf89d79202" category="admonition">NetApp SRA支持<block ref="e7d3e049f94ce3ff8a47f209f012173d" prefix=" " category="inline-code"></block> 策略类型。</block>
  <block id="883e69a285ae2d5fd23c80cd29285804" category="paragraph">SnapVault 是为 ONTAP 8.2 从头开始重建的。虽然以前的 Data ONTAP 7- 模式用户应该发现相似之处，但此版本的 SnapVault 已进行了重大改进。其中一项重大进步是，能够在 SnapVault 传输期间保持主数据的存储效率。</block>
  <block id="9bc21373e0e299579a7ac86dcd4f513d" category="paragraph">一个重要的架构变化是， ONTAP 9 中的 SnapVault 在卷级别进行复制，而不是像 7- 模式 SnapVault 那样在 qtree 级别进行复制。此设置意味着 SnapVault 关系的源必须为卷，并且该卷必须复制到 SnapVault 二级系统上其自身的卷。</block>
  <block id="d447048519c85a2fb3bea0790cd109fb" category="paragraph">在使用SnapVault的环境中、会在主存储系统上创建专门命名的快照。根据所实施的配置、可以通过SnapVault计划或NetApp Active IQ Unified Manager等应用程序在主系统上创建命名快照。然后、在主系统上创建的命名快照会复制到SnapMirror目标、并从该目标存储到SnapVault目标。</block>
  <block id="5bc66b9c84b3f7cc0b375e729376b68d" category="inline-link">TR-4015 《适用于 ONTAP 9 的 SnapMirror 配置最佳实践指南》。</block>
  <block id="657a41cce55646ab17754ac1427970af" category="paragraph">下图显示了 SnapMirror 到 SnapVault 的级联配置。如果 SnapVault 目标位于灾难恢复站点或不受主站点中断影响的三级站点上，则可以重新配置环境，以便在故障转移后继续备份。</block>
  <block id="63fd1f18d5d53fa97fd05a7fd96090b4" category="section-title">在 Site Recovery Manager 环境中使用 qtree</block>
  <block id="345cb3f040f9f7f3f1a4261ed260aa79" category="section-title">FC 和 iSCSI 混合环境</block>
  <block id="a60b166c2b69b4fdfbb733dc2193668a" category="paragraph">借助支持的 SAN 协议（ FC ， FCoE 和 iSCSI ）， ONTAP 9 可提供 LUN 服务，即创建 LUN 并将其映射到连接的主机。由于集群由多个控制器组成，因此，多路径 I/O 可管理多个逻辑路径，并将其连接到任何单个 LUN 。主机上使用非对称逻辑单元访问（ ALUA ），以便选择 LUN 的优化路径并使其处于活动状态以进行数据传输。如果指向任何 LUN 的优化路径发生变化（例如，由于移动了包含 LUN 的卷）， ONTAP 9 会自动识别此更改并无中断地进行调整。如果优化路径不可用， ONTAP 可以无中断地切换到任何其他可用路径。</block>
  <block id="56687c1a324f03f5d1429500efea710e" category="doc">对使用 VVol 复制的 SRM 进行故障排除</block>
  <block id="ef74d715544e3b067a6bec3218ac5044" category="paragraph">在进行故障排除时，了解下面列出的新工作流非常有用：</block>
  <block id="47f0942d341ee10381b2eff35089d75d" category="list-text">queryReplicationPeer ：发现两个故障域之间的复制协议。</block>
  <block id="136a299aae29998a147852cb0cba5b4a" category="list-text">queryFaultDomain ：发现故障域层次结构。</block>
  <block id="c071098c5df923c31f6245e4db2f3861" category="list-text">queryReplicationGroup ：发现源域或目标域中的复制组。</block>
  <block id="792cfe9ad3a3dc8528080a262e92989a" category="list-text">syncReplicationGroup ：同步源和目标之间的数据。</block>
  <block id="39afb1e1e3b180a6230e07bb8571667e" category="list-text">queryPointInTimeReplica ：发现目标上的时间点副本。</block>
  <block id="9fb25fe2ff084dc9ccfb99eaccba7212" category="list-text">testFailoverReplicationGroupStart ：开始测试故障转移。</block>
  <block id="bd4e1dacaca4c37a53b5286b6ae0239d" category="list-text">testFailoverReplicationGroupStop ：结束测试故障转移。</block>
  <block id="887f376a43cf9de1d6e14a8d69e588f6" category="list-text">promoteReplicationGroup ：将当前正在测试的组提升为生产组。</block>
  <block id="17ab16c5c0786ff381e6a085318bad9b" category="list-text">prepareFailoverReplicationGroup ：准备灾难恢复。</block>
  <block id="665dd64ebcc4016bda94e0e8020d8c8e" category="list-text">failoverReplicationGroup ：执行灾难恢复。</block>
  <block id="6936cf00e30b7cd4421225113a023c3e" category="list-text">reverseReplicateGroup ：启动反向复制。</block>
  <block id="61ac8950a043e6998b458d4f8171154c" category="list-text">queryMatchingContainer ：查找可能使用给定策略满足配置请求的容器（以及主机或复制组）。</block>
  <block id="05c9efdc056d2af4640bc441ab61b53a" category="list-text">queryResourceMetadata ：从 VASA 提供程序中发现所有资源的元数据，资源利用率可以作为问题解答返回给 queryMatchingContainer 函数。</block>
  <block id="01fa56986f885c588b1be8c206623de8" category="paragraph">配置 VVOL 复制时，最常见的错误是无法发现 SnapMirror 关系。之所以出现这种情况，是因为卷和 SnapMirror 关系是在 ONTAP 工具的权限范围之外创建的。因此，最佳做法是，在尝试创建复制的 VVOL 数据存储库之前，始终确保 SnapMirror 关系已完全初始化，并且您已在两个站点的 ONTAP 工具中运行重新发现。</block>
  <block id="3e4627f6667f830baceaaf35890b575a" category="summary">要了解有关本文档中所述信息的更多信息，请查看以下文档和 / 或网站：</block>
  <block id="092bf78f9c97ba171b8232ddff585392" category="doc">追加信息</block>
  <block id="7d5b957cd473f6eaf5ad335a9c63c4ff" category="paragraph">要了解有关本文档中所述信息的更多信息，请查看以下文档和 / 或网站：</block>
  <block id="c88037eb28ae3cceb0e32c2cd3c322d7" category="inline-link"><block ref="c88037eb28ae3cceb0e32c2cd3c322d7" category="inline-link-rx"></block></block>
  <block id="c9dd6bad4c7d561872f2e2d498a990bf" category="inline-link">互操作性表工具（ IMT ）</block>
  <block id="1f82b18dcba5f32a085bc502cdd0c6b7" category="summary">借助 ONTAP ， Storage Virtual Machine （ SVM ）的概念可在安全多租户环境中提供严格的分段。</block>
  <block id="7520e12a140ccf3de279fe2fd48889e4" category="doc">部署最佳实践</block>
  <block id="1b4574c516231b685bb37b013b789b06" category="section-title">SMT 的 SVM 布局和分段</block>
  <block id="446e04546ec0567eeeeef8e07368ab40" category="paragraph">借助 ONTAP ， Storage Virtual Machine （ SVM ）的概念可在安全多租户环境中提供严格的分段。一个 SVM 上的 SVM 用户无法从另一个 SVM 访问或管理资源。这样，您就可以利用 ONTAP 技术，为在同一集群上管理自己 SRM 工作流的不同业务单位创建单独的 SVM ，从而提高整体存储效率。</block>
  <block id="f98c1d223f34b2fdaf90eab1a3bc6a25" category="paragraph">请考虑使用 SVM 范围的帐户和 SVM 管理 LIF 管理 ONTAP ，这样不仅可以改进安全控制，还可以提高性能。使用 SVM 范围的连接时，性能本身就会更高，因为处理整个集群中的所有资源（包括物理资源）并不需要 SRA 。相反，它只需要了解抽象到特定 SVM 的逻辑资产。</block>
  <block id="97399fb37deca0d463aa5c7dc8d064a6" category="section-title">管理 ONTAP 9 系统的最佳实践</block>
  <block id="18f8b81b7fb7ea92f333e127583df17c" category="paragraph">如前所述，您可以使用集群或 SVM 范围的凭据和管理 LIF 来管理 ONTAP 集群。为了获得最佳性能、您可能需要考虑在不使用Vvol的情况下使用SVM范围的凭据。但是，在执行此操作时，您应了解一些要求，并且确实会丢失某些功能。</block>
  <block id="6e62430b92a7c5a0b8512436b163a10d" category="list-text">可能不会报告因存储效率而节省的聚合空间。</block>
  <block id="93d86aa51e0909549d1b1210f887aef3" category="list-text">如果支持，则无法更新负载共享镜像。</block>
  <block id="647d380b52e259fe7ed2e2582bc54b27" category="list-text">可能不会在使用 SVM 范围的凭据管理的 ONTAP 系统上执行 EMS 日志记录。</block>
  <block id="c5cd657df037c277c37216b73efb0b08" category="summary">如果可能，请始终使用 ONTAP 工具配置数据存储库和卷。这样可以确保卷，接合路径， LUN ， igroup ，导出策略， 以及其他设置均以兼容的方式进行配置。</block>
  <block id="d3b26e9021e83573a3d2a9050400a33a" category="doc">操作最佳实践</block>
  <block id="4d15db58f26b374b36c283df6b5a5fc1" category="paragraph">通过 SRA 使用基于阵列的复制时， SRM 支持在 ONTAP 9 中使用 iSCSI ，光纤通道和 NFS 版本 3 。对于使用传统或 VVol 数据存储库的 NFS 版本 4.1 ， SRM 不支持基于阵列的复制。</block>
  <block id="61f54ceeb0338787a2ee2d801cbc62cd" category="paragraph">要确认连接，请始终验证您是否可以从目标 ONTAP 集群在灾难恢复站点挂载和卸载新的测试数据存储库。测试要用于数据存储库连接的每个协议。最佳做法是使用 ONTAP 工具创建测试数据存储库，因为它正在按照 SRM 的指示执行所有数据存储库自动化。</block>
  <block id="6d717f70d89096b731dfc63d7a1379e1" category="section-title">关于阵列对</block>
  <block id="2219228418c053eb593ce0a1f318da47" category="paragraph">在 SRM 中配置阵列对时，应始终按照将其添加到 ONTAP 工具的方式在 SRM 中添加这些阵列对，也就是说，它们必须使用相同的用户名，密码和管理 LIF 。此要求可确保 SRA 与阵列正确通信。以下屏幕截图说明了集群在 ONTAP 工具中的显示方式以及如何将其添加到阵列管理器中。</block>
  <block id="3b34135c8c4d2b14ceb7ebf595f00193" category="section-title">关于复制组</block>
  <block id="c727c1020d3128dd7495a6e3e6f23736" category="paragraph">对于复制组，最后要考虑的一点是，每个复制组本身都是一个逻辑一致性组（不要与 SRM 一致性组相混淆）。这是因为卷中的所有 VM 都会使用同一个快照一起传输。因此，如果您的虚拟机必须彼此一致，请考虑将其存储在同一个 FlexVol 中。</block>
  <block id="9f8a350a2113ea4be6b4e5e5112514a3" category="section-title">关于保护组</block>
  <block id="df77671ab2743af7f1d1457c200eb12c" category="paragraph">保护组用于定义从受保护站点一起恢复的组中的 VM 和数据存储库。受保护站点是指在正常稳定状态操作期间，在保护组中配置的 VM 所在的站点。请务必注意，即使 SRM 可能会为一个保护组显示多个阵列管理器，一个保护组也不能跨越多个阵列管理器。因此，您不应将 VM 文件跨越不同 SVM 上的数据存储库。</block>
  <block id="b148467d645c3613c1c7a2607764c515" category="section-title">关于恢复计划</block>
  <block id="fd28cd9834ad3aa213c4fec2881064b5" category="paragraph">恢复计划定义了在同一过程中恢复的保护组。可以在同一恢复计划中配置多个保护组。此外，要为执行恢复计划提供更多选项，可以在多个恢复计划中包含一个保护组。</block>
  <block id="77aa84394124509e5e4006dcfd18789f" category="paragraph">通过恢复计划， SRM 管理员可以定义恢复工作流，方法是将 VM 分配给优先级组，优先级组从 1 （最高）到 5 （最低）不等，默认值为 3 （中等）。在优先级组中，可以为 VM 配置依赖关系。</block>
  <block id="030d749269f8866de516a551b0286001" category="paragraph">NetApp 强烈建议您与应用程序团队合作，了解故障转移场景中所需的操作顺序，并相应地构建恢复计划。</block>
  <block id="cebb1167d3e78885137c837f0abf8026" category="section-title">测试故障转移</block>
  <block id="6ae8acfc86f5df3426d525fb95767506" category="paragraph">NetApp 还建议偶尔确认子系统中的应用程序功能，尤其是在重新配置 VM 存储之后。</block>
  <block id="bd47371bcd8b3d08d6b4b15481b08d93" category="paragraph">执行测试恢复操作时，会在 ESXi 主机上为 VM 创建一个专用测试气泡网络。但是，此网络不会自动连接到任何物理网络适配器，因此不会在 ESXi 主机之间提供连接。为了允许在灾难恢复测试期间不同 ESXi 主机上运行的 VM 之间进行通信，在灾难恢复站点的 ESXi 主机之间创建了一个物理专用网络。要验证测试网络是否为专用网络，可以通过物理方式或使用 VLAN 或 VLAN 标记来隔离测试气泡网络。必须将此网络与生产网络隔离，因为在恢复 VM 后，不能将其放置在 IP 地址可能与实际生产系统冲突的生产网络上。在 SRM 中创建恢复计划时，可以选择创建的测试网络作为测试期间 VM 连接到的专用网络。</block>
  <block id="2be58fc410ddf2ba9c350135a617944a" category="paragraph">验证测试并使其不再需要后，请执行清理操作。运行清理会将受保护的 VM 恢复到其初始状态，并将恢复计划重置为就绪状态。</block>
  <block id="6f07b53963ee80903f0f13654de2cc3a" category="section-title">故障转移注意事项</block>
  <block id="9d33d94019b4a595a1ea232926a4da1b" category="paragraph">除了本指南中所述的操作顺序之外，在对站点进行故障转移时还需要考虑其他几个注意事项。</block>
  <block id="74abdd5cb502cd65bcf1d7ca484ab0c2" category="paragraph">您可能需要应对的一个问题描述是站点之间的网络差异。某些环境可能能够在主站点和灾难恢复站点使用相同的网络 IP 地址。此功能称为延伸型虚拟 LAN （ VLAN ）或延伸型网络设置。其他环境可能要求主站点使用与灾难恢复站点相对的不同网络 IP 地址（例如，在不同的 VLAN 中）。</block>
  <block id="9b8890fe5b1ab29543118b12a7bd0a07" category="inline-link-macro">SRM的NSX-T选项</block>
  <block id="25154023650451d6cc971fc54bff8898" category="paragraph">VMware 提供了多种方法来解决此问题。例如， VMware NSX-T Data Center 等网络虚拟化技术可从操作环境中将整个网络堆栈从第 2 层抽象为第 7 层，从而提供更便携的解决方案。了解更多信息 <block ref="3e6a2bd8e1acf69d423b7944c6543271" category="inline-link-macro-rx"></block>。</block>
  <block id="b56336aa967325217297d8725b64eb0b" category="inline-link-macro">VMware文档</block>
  <block id="d32598436410006707b2ad1d79395f02" category="paragraph">要将 SRM 配置为对多个 VM 应用不同的网络设置，而无需编辑恢复计划中每个 VM 的属性， VMware 提供了一个名为 dr-ip-customizer 的工具。要了解如何使用此实用程序、请参见 <block ref="837c7339284b78d4fd5550c5d0fb1a68" category="inline-link-macro-rx"></block>。</block>
  <block id="3c8c527afa8ce5009c8f707f7fd4fabf" category="section-title">重新保护</block>
  <block id="3b496038cb575fc404f8b0783e570f7a" category="paragraph">恢复后，恢复站点将成为新的生产站点。由于恢复操作中断了 SnapMirror 复制，因此新生产站点不会受到任何未来灾难的影响。最佳实践是，在恢复后立即将新生产站点保护到另一站点。如果原始生产站点正常运行， VMware 管理员可以使用原始生产站点作为新的恢复站点来保护新生产站点，从而有效地反转保护方向。只有在发生非灾难性故障时，才可重新保护。因此，原始 vCenter Server ， ESXi 服务器， SRM 服务器和相应的数据库最终必须可恢复。如果没有可用的保护组和新的恢复计划，则必须创建新的保护组和恢复计划。</block>
  <block id="2bf236f8aceaaff2b305848df524c42e" category="paragraph">从根本上说，故障恢复操作是指方向与以前不同的故障转移。作为最佳实践，在尝试故障恢复或换句话说，故障转移到原始站点之前，您应验证原始站点是否已恢复到可接受的功能级别。如果原始站点仍然受到影响，您应延迟故障恢复，直到故障得到充分修复为止。</block>
  <block id="cb03753531bad31391d7156433b98ae6" category="paragraph">另一个故障恢复最佳实践是，始终在完成重新保护之后以及执行最终故障恢复之前执行测试故障转移。此操作将验证原始站点上的系统是否可以完成此操作。</block>
  <block id="900a3b65ea54b6dcff72ed0d6ac66fdf" category="section-title">重新保护原始站点</block>
  <block id="12d059a2c7519f2e3497b30a71121503" category="paragraph">在故障恢复后运行重新保护实际上会使环境恢复到最初的状态，同时重新运行从生产站点到恢复站点的 SnapMirror 复制。</block>
  <block id="39e5fc9eb192f011ab14dae6c2974c4e" category="list-text">威胁建模。 * 威胁建模的目的是在软件开发生命周期早期发现功能，组件或产品中的安全缺陷。威胁模型是影响应用程序安全性的所有信息的结构化表示。从本质上说，它是从安全性角度来看待应用程序及其环境的。</block>
  <block id="9f16ab3a50bca32d19c4729319035c8d" category="list-text">* 动态应用程序安全测试（ DAST ）。 * 此技术用于检测处于运行状态的应用程序上的易受到攻击的情况。Dast 会测试 Web 应用程序公开的 HTTP 和 HTML 接口。</block>
  <block id="267bed0525e4dab477e4c24ca5a1794e" category="list-text">* 第三方代码货币。 * 作为开源软件（ OSS ）软件开发的一部分，您必须解决可能与产品中包含的任何 OSS 相关的安全漏洞。这是一项持续努力，因为新的 OSS 版本可能会随时报告新发现的漏洞。</block>
  <block id="db7bc87c89c1ee76d313865a32fc0e06" category="list-text">* 漏洞扫描。 * 漏洞扫描的目的是在 NetApp 产品发布给客户之前检测其常见和已知安全漏洞。</block>
  <block id="1a4c104571630526efc77b84e82380fe" category="list-text">* 渗透测试。 * 渗透测试是指评估系统， Web 应用程序或网络以发现攻击者可能利用的安全漏洞的过程。NetApp 的渗透测试（笔测试）由一组经过批准且值得信赖的第三方公司执行。其测试范围包括使用复杂的利用方法或工具对与恶意入侵者或黑客类似的应用程序或软件发起攻击。</block>
  <block id="7e98fc3ea1ec077cfd1727a58e9c9020" category="section-title">产品安全功能</block>
  <block id="dff88c2ef0b49b09246ffd6f9ec55195" category="list-text">默认情况下， * 登录横幅。 * SSH 处于禁用状态，如果从 VM 控制台启用，则仅允许一次性登录。用户在登录提示符中输入用户名后，将显示以下登录横幅：</block>
  <block id="399875025e8e96cc13102a4dd72f2434" category="paragraph">* 警告： * 禁止未经授权访问此系统，并将受到法律的起诉。访问此系统即表示您同意，如果怀疑未经授权使用，您的操作可能会受到监控。</block>
  <block id="2d8330ed99c80a842ffbd1362e038e5e" category="paragraph">用户通过SSH通道完成登录后、将显示以下文本：</block>
  <block id="677528ad13d460c058ac50e8a62092cf" category="list-text">* 基于角色的访问控制（ Role-Based Access Control ， RBAC ）。 * ONTAP 工具与两种类型的 RBAC 控制相关联：</block>
  <block id="ac38773d017495a97d5b88f242578cb8" category="list-text">原生 vCenter Server 特权</block>
  <block id="c2e2fce3a995f59900d7afbbe58683f5" category="inline-link">此链接。</block>
  <block id="31cedac82fef311cb790a12f96897223" category="list-text">vCenter 插件的特定特权。有关详细信息，请参见<block ref="e5f6920797dbff91ef59367270a82669" category="inline-link-rx"></block>。</block>
  <block id="5d32469f8a65b884a8f70abf95fe485a" category="list-text">* 加密通信通道。 * 所有外部通信均使用 TLS 1.2 版通过 HTTPS 进行。</block>
  <block id="600d4f98483fae8e58054f976d7e0c0e" category="list-text">* 最小端口暴露。 * 只有必要的端口在防火墙上处于打开状态。</block>
  <block id="0406f8902379502d1eba01f043c232b7" category="paragraph">下表介绍了打开的端口详细信息。</block>
  <block id="69fc9fe9cbb7709e97a433352aecf77d" category="cell">TCP v4/v6 端口号</block>
  <block id="02674a4ef33e11c879283629996c8ff8" category="cell">方向</block>
  <block id="86408593c34af77fdd90df932f8b5261" category="cell">功能</block>
  <block id="0c95054981de037de06e544a52eb3613" category="cell">8143.</block>
  <block id="a8e6fe5b9e68f30a146cefebaa7edcc3" category="cell">入站</block>
  <block id="d16c4afdc5f340936b747baf91efc843" category="cell">用于 REST API 的 HTTPS 连接</block>
  <block id="5bd529d5b07b647a8863cf71e98d651a" category="cell">8043</block>
  <block id="1f4deeb2f64336d4ff65ea3d2b4ffe2f" category="cell">HTTPS 连接</block>
  <block id="cb4b69eb9bd10da82c15dca2f86a1385" category="cell">9060</block>
  <block id="5852f8019b572f4cdef5bab783fa799f" category="cell">HTTPS 连接
用于基于 https 的 SOAP 连接
必须打开此端口、客户端才能连接到ONTAP工具API服务器。</block>
  <block id="b6d767d2f8ed5d21a44b0e5886680cb9" category="cell">22.</block>
  <block id="f4e339608b243f9b57b78ffaf061b498" category="cell">SSH （默认为禁用）</block>
  <block id="d82d678e9583c1f5f283ec56fbf1abb7" category="cell">9080</block>
  <block id="ef34781e03f49b5db5dd8fa267c4c41b" category="cell">HTTPS 连接— VP 和 SRA —仅从环回进行内部连接</block>
  <block id="a44ba9086b2b83ccf2baf7c678723449" category="cell">9083.</block>
  <block id="fe01ac95967cd8cb5f5b5669b685277a" category="cell">HTTPS 连接— VP 和 SRA
用于基于 https 的 SOAP 连接</block>
  <block id="abea47ba24142ed16b7d8fbf2c740e0d" category="cell">1162.</block>
  <block id="4a0724da5c6f4e4817663ae822550800" category="cell">VP SNMP 陷阱数据包</block>
  <block id="5cce8dede893813f879b873962fb669f" category="cell">1527.</block>
  <block id="91c15b8eb529bf2100c10383d1010a1e" category="cell">仅限内部</block>
  <block id="60135f95267c6e0711bf5a2858dfff2f" category="cell">Derby 数据库端口，仅在此计算机与自身之间，不接受外部连接—仅限内部连接</block>
  <block id="13f3cf8c531952d72e5847c4183e6910" category="cell">443.</block>
  <block id="1ef2b5426b0824e93e33753fa87ddbf5" category="cell">双向</block>
  <block id="e4b8a8d8761aab7733e317b585d5d606" category="cell">用于连接到 ONTAP 集群</block>
  <block id="bf6184406d1e18fffc86ecf770fbb391" category="inline-link">知识库文章</block>
  <block id="fedac49792829de4ff38fcf7a3846faa" category="list-text">* 支持证书颁发机构（ CA ）签名证书。 * 适用于 VMware vSphere 的 ONTAP 工具支持 CA 签名证书。请参见此内容<block ref="0903a062b2072644a9b744a7fece4216" category="inline-link-rx"></block> 有关详细信息 ...</block>
  <block id="9fca19988370da2a459b24505e9d23d5" category="list-text">* 审核日志记录。 * 支持包可以下载，并且非常详细。ONTAP 工具会将所有用户登录和注销活动记录在一个单独的日志文件中。VASA API 调用会记录在专用的 VASA 审核日志（本地 CXF.log ）中。</block>
  <block id="7d60a2806aedd934b75cce55d6693689" category="list-text">* 密码策略。 * 遵循以下密码策略：</block>
  <block id="f82f7513742f08b9d2784923213bdc75" category="list-text">密码不会记录在任何日志文件中。</block>
  <block id="83040c348e071499488a8128db207545" category="list-text">密码不会以纯文本形式传达。</block>
  <block id="bc319862df3312f423a50fece7730db9" category="list-text">密码是在安装过程本身期间配置的。</block>
  <block id="853c2ea85b86882d0ea73b606a9800a4" category="list-text">密码历史记录是一个可配置的参数。</block>
  <block id="b3d3877bc96752ae50a409c72597d47a" category="list-text">密码最短期限设置为 24 小时。</block>
  <block id="fb0bdec50022a37424a405b53da7c9c8" category="list-text">已禁用密码字段的自动完成。</block>
  <block id="3a04f054be8ad983ea82fd5079519810" category="list-text">ONTAP 工具使用 SHA256 哈希对所有存储的凭据信息进行加密。</block>
  <block id="46e61d6e7c848d43ddcede8efd36c3d8" category="doc">SnapCenter插件VMware vSphere</block>
  <block id="ae9e79ac4b60eba67cf1c7508417b42c" category="paragraph">适用于VMware vSphere的NetApp SnapCenter 插件软件工程部门使用以下安全开发活动：</block>
  <block id="b25a1098aff7d0c5ee590f1e1a114bb9" category="list-text">*动态应用程序安全测试(DAST)。*用于检测处于运行状态的应用程序上的易受到攻击的情况的技术。Dast 会测试 Web 应用程序公开的 HTTP 和 HTML 接口。</block>
  <block id="6cc1fee6b4fc48755d78e93170bbed93" category="list-text">*第三方代码货币。*在开发软件和使用开源软件(OSS)的过程中、解决可能与您的产品中所含的OSS相关的安全漏洞非常重要。这是一项持续努力、因为OSS组件的版本可能随时报告新发现的漏洞。</block>
  <block id="87bd0fb9b4198f33535e0e1888a809f5" category="list-text">*渗透测试。*渗透测试是指评估系统、Web应用程序或网络以发现攻击者可能利用的安全漏洞的过程。NetApp 的渗透测试（笔测试）由一组经过批准且值得信赖的第三方公司执行。其测试范围包括使用复杂的利用方法或工具对恶意入侵者或黑客等应用程序或软件发起攻击。</block>
  <block id="e91db3b3278f7bd95cc704d74c5c9597" category="paragraph">适用于VMware vSphere的NetApp SnapCenter 插件在每个版本中都包含以下安全功能：</block>
  <block id="4abd7d1d5d223683d3346671efb7e89c" category="list-text">*限制Shell访问。*默认情况下、SSH处于禁用状态、只有在从VM控制台启用一次性登录后、才允许进行此类登录。</block>
  <block id="8c264fa5ca2c588d960d98bd30cbc897" category="list-text">*登录横幅中显示访问警告。*用户在登录提示符中输入用户名后、将显示以下登录横幅：</block>
  <block id="0d6633ada3a9803e206b2359d859e892" category="paragraph">用户通过SSH通道完成登录后、将显示以下输出：</block>
  <block id="b883bf79639dfce77e395b8458ee69e4" category="list-text">本机vCenter Server特权。</block>
  <block id="721796b1cb3468f0daf819180184d460" category="inline-link">基于角色的访问控制（ Role-Based Access Control ， RBAC ）</block>
  <block id="1d08c46b7567a29be0690a92b9722a58" category="list-text">VMware vCenter插件的特定特权。有关详细信息，请参见<block ref="f351263ad3706bd0a472039400dece78" category="inline-link-rx"></block>。</block>
  <block id="acab4c655c4a7b4db67fc07e22b86222" category="list-text">*加密通信通道。*所有外部通信均使用TLS通过HTTPS进行。</block>
  <block id="47a37e2d5fc8b7c936ad9b2b7a569a08" category="paragraph">下表提供了打开的端口详细信息。</block>
  <block id="10bd16a816f831080065e807daa36a9a" category="cell">TCP v4/v6端口号</block>
  <block id="edf0320adc8658b25ca26be5351b6c4a" category="cell">8144.</block>
  <block id="d4a973e303ec37692cc8923e3148eef7" category="cell">8080</block>
  <block id="2c25c3d66f80eeaa8d6e5a144c6f942e" category="cell">用于OVA GUI的HTTPS连接</block>
  <block id="14b3e670eec63cc0cc456fd904bbfbd9" category="cell">SSH (默认情况下处于禁用状态)</block>
  <block id="16fc18d787294ad5171100e33d05d4e2" category="cell">3306.</block>
  <block id="4cbf9c234f6b34c242a110cb993252bd" category="cell">MySQL (仅限内部连接；默认情况下、外部连接处于禁用状态)</block>
  <block id="29ab4efbdb7c727c81ee1382593bc5e2" category="cell">nginx (数据保护服务)</block>
  <block id="89f152cad33314315b4995ed1ca71535" category="inline-link">如何创建和/或将SSL证书导入到适用于VMware vSphere的SnapCenter 插件(SCV)</block>
  <block id="450adc59e39f23172756ac9369494a2d" category="list-text">*支持证书颁发机构(CA)签名证书。*适用于VMware vSphere的SnapCenter 插件支持CA签名证书的功能。请参见<block ref="9f83d87d5d9f604d96288df21d450fac" category="inline-link-rx"></block>。</block>
  <block id="05a1aa8021df4579874c4eeb8788e5c9" category="list-text">*密码策略。*以下密码策略有效：</block>
  <block id="2c87609dbbc3630573c64e271de8207d" category="list-text">所有凭据信息均使用SHA256哈希进行存储。</block>
  <block id="0f1a6fa0a65f9d5c3c4a16b070104d7a" category="list-text">*基本操作系统映像。*本产品随附Debian基础操作系统、用于OVA、但访问受限且Shell访问已禁用。这样可以减少攻击占用空间。每个SnapCenter 版本基础操作系统都会更新最新的安全修补程序、以最大限度地提高安全性。</block>
  <block id="83cd5867ba912e517fa1100299fd1cf3" category="paragraph">NetApp针对适用于VMware vSphere设备的SnapCenter 插件开发软件功能和安全修补程序、然后将其作为捆绑软件平台发布给客户。由于这些设备包括特定的Linux子操作系统依赖关系以及我们的专有软件、因此NetApp建议您不要更改子操作系统、因为这很可能会影响NetApp设备。这可能会影响NetApp支持此设备的能力。NetApp建议测试和部署我们最新的设备代码版本、因为发布这些代码版本是为了修补任何与安全相关的问题。</block>
  <block id="1bc6cee680286aae1b12889369b7f18a" category="summary">基于ONTAP的MySQL</block>
  <block id="dac8ea4fbfd87a535663c227b91f50e3" category="doc">I/O计划程序</block>
  <block id="215dca219378b291ae287eb076489fdd" category="paragraph">Linux内核允许对块设备的I/O计划方式进行低级控制。</block>
  <block id="dc36d23ef487690f1698c69d9e49cee2" category="paragraph">各种Linux发行版上的默认值差别很大。MySQL建议您使用<block ref="722d122e81cbbe543bd5520bb8678c0e" prefix=" " category="inline-code"></block> 或<block ref="30e482a8ab57cfc19075dece53b0a56b" prefix=" " category="inline-code"></block> 在Linux上具有本机异步I/O (AIO)的I/O计划程序。一般来说、使用NoOps时、NetApp客户和内部测试的结果会更好。</block>
  <block id="6def78482bd1915cb81f0f5c19ee8fe6" category="paragraph">MySQL的InnoDB存储引擎使用Linux上的异步I/O子系统(本机AIO)对数据文件页面执行预读和写入请求。此行为由控制<block ref="2c03186a22d036ce7dad84be5de2f2ce" prefix=" " category="inline-code"></block> 配置选项、默认情况下处于启用状态。使用本机AIO时、I/O计划程序的类型对I/O性能的影响更大。执行基准测试、确定哪个I/O计划程序可以为您的工作负载和环境提供最佳结果。</block>
  <block id="e7b09beaf26efc7d8bee91786cf794b5" category="paragraph">有关配置I/O计划程序的说明、请参见相关的Linux和MySQL文档。</block>
  <block id="6e8775bd755a8835ce86806d669677ea" category="doc">存储配置</block>
  <block id="2f09ac000b4a1808cb795b7bdbb20ecc" category="doc">InnoDB_log_file_size</block>
  <block id="b8674b2897b288ca55b74328df4780b3" category="paragraph">为InnoDB日志文件大小选择合适的大小对于写入操作以及在服务器崩溃后有适当的恢复时间非常重要。</block>
  <block id="b61bad6f7bf48bf9abda0c86c9beed79" category="paragraph">由于登录到该文件的事务太多、因此日志文件大小对于写入操作非常重要。修改记录后、所做的更改不会立即写入表空间。而是将更改记录在日志文件的末尾、并将页面标记为脏。InnoDB使用其日志将随机I/O转换为顺序I/O</block>
  <block id="e87d83a3c0af4df83efb4784b5182f8f" category="paragraph">日志已满时、脏页会按顺序写出到表空间中、以释放日志文件中的空间。例如、假设服务器在事务处理期间崩溃、而写入操作仅记录在日志文件中。在服务器恢复运行之前、它必须经过恢复阶段、在此阶段中、系统将重写记录在日志文件中的更改。日志文件中的条目越多、服务器恢复所需的时间就越长。</block>
  <block id="8321756b7fedf72543a1b0917bf92613" category="paragraph">在此示例中、日志文件大小会影响恢复时间和写入性能。在为日志文件大小选择正确的数字时、请平衡恢复时间与写入性能。通常、128 M到512 M之间的值都很好。</block>
  <block id="598132a821e8cc696fbbae934047d991" category="paragraph">MySQL及其变体(包括MariaDB和Percona MySQL)是世界上最受欢迎的数据库。</block>
  <block id="35701e1bcd40c8e1a520fc33d0e14842" category="doc">INNODB_FLUG_METHOD</block>
  <block id="138738e11d5fda5c496edaa92e32e158" category="paragraph">InnoDB_flush_方法 参数用于指定InnoDB如何打开和刷新日志和数据文件。</block>
  <block id="c262c8cd82b96f69fbbc058d7a35683b" category="section-title">优化</block>
  <block id="d1e67ebe6122765789852eb430c42c75" category="paragraph">在InnoDB优化中、如果适用、设置此参数会调整数据库性能。</block>
  <block id="51ca63a7fb332d4d18e7139ea5787c50" category="paragraph">以下选项用于通过InnoDB转储文件：</block>
  <block id="a9b8d4c72b58a9554274cba7904d47e2" category="list-text"><block ref="e590322920bebc1156ab585bd6597d76" prefix="" category="inline-code"></block>。InnoDB使用<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 系统调用以刷新数据和日志文件。此选项为默认设置。</block>
  <block id="8198b1fd4bf2fafa4f4e8ffb4a8ac900" category="list-text"><block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix="" category="inline-code"></block>。InnoDB使用<block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix=" " category="inline-code"></block> 选项打开并刷新日志文件，并使用fsync()刷新数据文件。InnoDB不使用<block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix=" " category="inline-code"></block> 这是因为在许多UNIX版本上都存在问题。</block>
  <block id="f89f9147df5dde99a7944d2028b59e7e" category="list-text"><block ref="6a334fd488ef92b18584207148410cc4" prefix="" category="inline-code"></block>。InnoDB使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 选项(或<block ref="42d27f470f62deaad644fef8618b59bb" prefix=" " category="inline-code"></block> 在Solaris上)以打开数据文件并使用<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 刷新数据和日志文件。此选项在某些版本的GNU或Linux、FreEBSD,和Solaris上可用。</block>
  <block id="5e90100e134d805a66f8cda2e73f5298" category="list-text"><block ref="d66655d6d13113f23421f282ed1eaeb7" prefix="" category="inline-code"></block>。InnoDB使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 选项；但是、它会跳过<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 系统调用。此选项不适用于某些类型的文件系统(例如XFS)。如果不确定文件系统是否需要<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 系统调用(例如、要保留所有文件元数据)、请使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 选项。</block>
  <block id="c680d437163cc6bab4f9bdb35c3073d0" category="section-title">观察结果</block>
  <block id="907dee0040812e8e7d1fd00b870b5063" category="paragraph">在NetApp实验室测试中、<block ref="e590322920bebc1156ab585bd6597d76" prefix=" " category="inline-code"></block> NFS和SAN上使用了默认选项、与相比、这是一个非常好的性能提升<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block>。将刷新方法用作时<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 通过使用ONTAP、我们发现客户端会以串行方式在4096块的边界处写入大量单字节写入。这些写入会增加网络延迟并降低性能。</block>
  <block id="2f0b9319cf6d59e07ea4b1ef65a12be1" category="doc">open_file_极限 值</block>
  <block id="11e52b21a9795b7dcf947027b0ec5d01" category="paragraph">。<block ref="2f0b9319cf6d59e07ea4b1ef65a12be1" prefix=" " category="inline-code"></block> 参数用于确定操作系统允许myqld打开的文件数。</block>
  <block id="e0732f22b2900006e8fcb6367fd162f7" category="paragraph">运行时此参数的值是系统允许的实际值、可能与服务器启动时指定的值不同。在MySQL无法更改打开文件数量的系统上、此值为0。有效<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 值基于系统启动时指定的值(如果有)和的值<block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix=" " category="inline-code"></block> 和<block ref="023a3b50ddf424c9a1d51984190a0c92" prefix=" " category="inline-code"></block> 使用以下公式：</block>
  <block id="6b840ff0a7667f4642a0844269657fc4" category="list-text">10 +<block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix=" " category="inline-code"></block> + <block ref="023a3b50ddf424c9a1d51984190a0c92" prefix="(" category="inline-code"></block> x 2)</block>
  <block id="d3de183489c20b8efa2947eeff3028d7" category="list-text"><block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix="" category="inline-code"></block> x 5.</block>
  <block id="2c08922fbaba089e7c2982df43fd352a" category="list-text">操作系统限制(如果为正数)</block>
  <block id="8ca153937fcbdf56497ad779a91f31d1" category="list-text">如果操作系统限制为无限大：<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 值在启动时指定；如果无、则为5、000</block>
  <block id="98038bb4026a70f5ee4041522c6eebe4" category="paragraph">服务器将尝试使用这四个值中的最大值来获取文件描述符数量。如果无法获取多个描述符、则服务器会尝试获取系统允许的多个描述符。</block>
  <block id="3ee58d04a0dc9b2551698643e0421005" category="doc">InnoDB_LRU_SCAN_深度</block>
  <block id="29d0f4f8b383d39e73abd11ac73ca28a" category="paragraph">。<block ref="3ee58d04a0dc9b2551698643e0421005" prefix=" " category="inline-code"></block> 参数会影响InnoDB缓冲池的刷新操作的算法和启发式。</block>
  <block id="eeb16232629bd788f0d29c104105bba2" category="paragraph">调整I/O密集型工作负载的性能专家主要关注此参数。对于每个缓冲池实例、此参数用于指定页面清理程序线程应继续扫描的最近最少使用(Least Recently Used、LRU)页面列表中的下限、以查找要刷新的脏页面。此后台操作每秒执行一次。</block>
  <block id="39359bf2914e4e1cf84a9dea580fd20a" category="paragraph">您可以向上或向下调整该值、以最大程度地减少可用页数。不要将该值设置得比所需值高得多、因为扫描会产生显著的性能成本。此外、请考虑在更改缓冲池实例数时调整此参数、因为<block ref="f2c8312d381c16c6c95a727c3f61a4c7" prefix=" " category="inline-code"></block> 定义页面清理程序线程每秒执行的工作量。</block>
  <block id="513a275422fae2456617321a2f3fc0af" category="paragraph">小于默认值的设置适用于大多数工作负载。只有在典型工作负载下具有备用I/O容量时、才应考虑增加此值。相反、如果写入密集型工作负载使I/O容量饱和、请减小该值、尤其是在缓冲池较大的情况下。</block>
  <block id="62812b938ba1113b81bd7f612ad0e6f8" category="doc">InnoDB_buffer_pool_size</block>
  <block id="d7a8b502d05f5e477158eb80c1fb8dae" category="paragraph">InnoDB缓冲池是任何调整活动最重要的部分。</block>
  <block id="5cb6c45d18482180f34ae727b53379fb" category="paragraph">InnoDB在很大程度上依赖于缓冲区池来缓存索引并对数据、自适应哈希索引、插入缓冲区以及内部使用的许多其他数据结构进行分段。缓冲池还会缓冲对数据的更改、以便不必立即对存储执行写入操作、从而提高性能。缓冲池是InnoDB不可或缺的一部分、必须相应地调整其大小。设置缓冲池大小时、请考虑以下因素：</block>
  <block id="03f07291794c3b9cb00d04cb9f30be81" category="list-text">对于仅限InnoDB的专用计算机、请将缓冲池大小设置为可用RAM的80%或更多。</block>
  <block id="7b0119b7fa59f87d23d5c65da456b226" category="list-text">如果它不是MySQL专用服务器、请将大小设置为RAM的50%。</block>
  <block id="a6a9695e1464f5554c0006c55facfadf" category="doc">文件描述符</block>
  <block id="8e222c68dd214db9f8a1b5b572ee6267" category="paragraph">它使用这些表来打开新连接、将表存储在缓存中、创建临时表以解决复杂的查询、以及访问永久性查询。如果myqld无法在需要时打开新文件、则它可能会停止正常运行。此问题描述的一个常见现象是错误24："打开的文件太多"。 可以同时打开的文件描述符myqld的数量由定义<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 在配置文件中设置的选项 <block ref="86d0d007043d911697753b35e2c18f35" prefix="(" category="inline-code"></block>）。但是<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 也取决于操作系统的限制。这种依赖关系使变量的设置变得更加复杂。</block>
  <block id="07561a91f81dfe3c8e4364aac8bdbea4" category="paragraph">MySQL无法设置它<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 选项高于下指定的值<block ref="dd1c6d8164dfd1cee0afa39b177e843b" prefix=" " category="inline-code"></block>。因此、您需要在操作系统级别明确设置这些限制、以使MySQL能够根据需要打开文件。有两种方法可在Linux中检查文件限制：</block>
  <block id="84e705ac120a887df441f4161dc29409" category="list-text">。<block ref="2eabb4efed7dffb32ea1170eab71b798" prefix=" " category="inline-code"></block> Command快速为您提供有关允许或锁定的参数的详细问题描述。运行此命令所做的更改不是永久的、将在系统重新启动后擦除。</block>
  <block id="a4c404dc92855948bc4c007a86091dbe" category="list-text">对进行的更改<block ref="b803f460349bd101b1de260021ef0e60" prefix=" " category="inline-code"></block> 文件是永久文件、不受系统重新启动的影响。</block>
  <block id="cbcab8220d4ffddbdc44f9936125d83d" category="paragraph">确保更改用户myql的硬限制和软限制。以下摘录来自此配置：</block>
  <block id="97dc47f90c600a96fac6642560ffaceb" category="paragraph">同时、在中更新相同的配置<block ref="90f16be5b82ca0aa94088c89fe00b3dd" prefix=" " category="inline-code"></block> 以充分利用打开文件的限制。</block>
  <block id="395ec860c9530814e94538b7121a8319" category="doc">INNODB_FLOG_AT_TRx_Commit</block>
  <block id="2f2c7742844f13de59d435b9099c78cc" category="paragraph">数据发生更改时、更改不会立即写入存储。</block>
  <block id="0b36b8f791a48c7b4692e7df069dabc8" category="paragraph">相反、数据会记录在日志缓冲区中、日志缓冲区是InnoDB分配给缓冲区的内存的一部分、用于缓冲日志文件中记录的更改。在提交事务时、缓冲区已满时或每秒一次(以先发生的事件为准)、InnoDB会将缓冲区转至日志文件。用于控制此过程的配置变量为InnoDB_F冲_LOG_AT_TRx_commit。值选项包括：</block>
  <block id="280a38864b81c14ba3db52801e087ed0" category="list-text">设置时<block ref="cab9a35054c49f0ba619a6e6943f461b" prefix=" " category="inline-code"></block>，InnoDB会将修改后的数据(位于InnoDB缓冲池中)写入日志文件(ib_logfile)，并每秒刷新日志文件(写入存储)。但是、提交事务时、它不会执行任何操作。如果发生电源故障或系统崩溃、则未转储的数据都不可恢复、因为它不会写入日志文件或驱动器。</block>
  <block id="5967bb5566cb7cd8bdb0b372ceb21565" category="list-text">设置时<block ref="1ab7a7611b59147e84a38b6f3e7d9d09" prefix=" " category="inline-code"></block>，则InnoDB会将日志缓冲区写入事务日志，并将每个事务转储到持久存储。例如、对于所有事务提交、InnoDB先写入日志、然后再写入存储。存储速度较慢会对性能产生负面影响；例如、每秒InnoDB事务数会减少。</block>
  <block id="9e9b3a43cb7a1b13c5ee3f6519d7f60e" category="list-text">设置时<block ref="44d4dfee9b1c95f8768bec989cd3baf5" prefix=" " category="inline-code"></block>，InnoDB会在每次提交时将日志缓冲区写入日志文件；但是，它不会将数据写入存储。InnoDB每秒刷新一次数据。即使出现电源故障或系统崩溃、选项2数据也会显示在日志文件中、并且可以恢复。</block>
  <block id="14f3e0328e25aa02b37bd6817a442a58" category="paragraph">如果性能是主要目标、请将该值设置为2。由于InnoDB每秒向驱动器写入一次、而不是每次提交事务、因此性能会显著提高。如果发生电源故障或崩溃、可以从事务日志中恢复数据。</block>
  <block id="4a34cbb1957909093a2e216fc1cd0962" category="paragraph">如果数据安全是主要目标、请将该值设置为1、以便每次提交事务时、InnoDB都会转至驱动器。但是、性能可能会受到影响。</block>
  <block id="53be3047aa6f8a62c640cc8b4d6089c6" category="admonition">* NetApp建议*将InnoDB_F冲_LOG_TRx_commit值设置为2以提高性能。</block>
  <block id="2199371f8380c97ad11a03fba3b501c9" category="doc">InnoDB_IO_Capacity</block>
  <block id="ac165f23bb7435219b226ed6e76c5fa4" category="paragraph">在InnoDB插件中、从MySQL 5.7中添加了一个名为InnoDB_io_Capacity的新参数。</block>
  <block id="b4f38c42ef968074288f239b42e92b7f" category="paragraph">它控制InnoDB执行的最大IOPS数(包括异常页面的转储速率以及插入缓冲区[ibuf]批大小)。InnoDB_IO_Capacity参数可通过InnoDB后台任务(例如从缓冲区池转储页面以及合并更改缓冲区中的数据)设置IOPS上限。</block>
  <block id="9679a08c293f29d9546c42207b09d418" category="paragraph">将InnoDB_IO_Capacity参数设置为系统每秒可执行的大约I/O操作数。理想情况下、应尽可能降低设置值、但不要太低、以免后台活动减慢。如果设置值过高、则会从缓冲池中删除数据、并且插入缓冲区的速度过快、无法缓存、因此无法提供显著优势。</block>
  <block id="668b6acc98c3469094062ed50b43e43a" category="admonition">* NetApp建议*如果通过NFS使用此设置、则分析IOPS (Sysbench/FIO)的测试结果并相应地设置参数。除非您在InnoDB缓冲池中看到的已修改或脏页面多于所需数量、否则请使用可能的最小值进行转储和清除以保持最新。</block>
  <block id="038b11d42ee14bd77b6370c575c63b16" category="admonition">请勿使用极值(如20、000或更多)、除非您已证明较低的值不足以满足工作负载要求。</block>
  <block id="62385f5ceb285bca676cb0561555d719" category="paragraph">InnoDB_IO_Capacity参数用于调节转储速率和相关I/O</block>
  <block id="58d94bb6e53e154e2f4b16efa09f4c0d" category="paragraph">只要I/O和容量需求不超过单个LUN文件系统的限制、就可以将较小的数据库放置在一对标准LUN上。例如、需要大约2K随机IOPS的数据库可以托管在单个LUN上的单个文件系统上。同样、大小仅为100 GB的数据库可以容纳在一个LUN上、而不会产生管理问题。</block>
  <block id="c33bcb4f520265bb106616e844397ffb" category="paragraph">大型数据库需要多个LUN。例如、需要100K IOPS的数据库最有可能至少需要八个LUN。由于驱动器的SCSI通道数量不足、单个LUN将成为瓶颈。同样、在一个10 TB LUN上管理一个10 TB数据库也很困难。逻辑卷管理器旨在将多个LUN的性能和容量功能绑定在一起、以提高性能和易管理性。</block>
  <block id="428e88a1415b00f5eb396829b4bd9a2c" category="paragraph">在这两种情况下、一对ONTAP卷都应足以满足要求。在简单的配置中、数据文件LUN会像日志LUN一样放置在一个专用卷中。使用逻辑卷管理器配置时、数据文件卷组中的所有LUN都将位于一个专用卷中、而日志卷组的LUN将位于另一个专用卷中。</block>
  <block id="e8c31916b755be39cb0a66804a1d8f8b" category="paragraph">*MySQL建议*在SAN上部署NetApp时使用两个文件系统：</block>
  <block id="fe9d8ca2c46747e16ed31f64638e66e6" category="list-text">第一个文件系统存储所有MySQL数据、包括表空间、数据和索引。</block>
  <block id="04d82ed32fa1eeaa6df117c178062441" category="list-text">第二个文件系统存储所有日志(二进制日志、慢速日志和事务日志)。</block>
  <block id="15bcb76b7e8b441c0d2a6e723f70c20c" category="paragraph">以这种方式分隔数据有多种原因、包括：</block>
  <block id="02774797d31a8f1c6d805860038c32a3" category="list-text">数据文件和日志文件的I/O模式不同。如果将它们分开、则可以使用QoS控制提供更多选项。</block>
  <block id="6cab2c793e807e2d0c57f5b0d96505c1" category="list-text">要充分利用Snapshot技术、需要能够独立还原数据文件。将数据文件与日志文件相结合会影响数据文件还原。</block>
  <block id="553ad1f7b6f5cfee021e5cf56e56a289" category="list-text">NetApp SnapMirror技术可用于为数据库提供简单的低RPO灾难恢复功能；但是、它需要为数据文件和日志制定不同的复制计划。</block>
  <block id="ff5f52a69a35dd41da3e3c4b810e4f94" category="admonition">使用此基本的双卷布局可使解决方案适应未来需要、以便在需要时可以使用所有ONTAP功能。</block>
  <block id="7b755794e9de5716b2d6305bd10bee1b" category="paragraph">* NetApp建议*使用ext4文件系统格式化驱动器，因为它具有以下功能：</block>
  <block id="fa92f58d5035dec5e24a787f76504783" category="list-text">日志文件系统(jfs)中使用的块管理功能的扩展方法以及扩展文件系统(xfs)的延迟分配功能。</block>
  <block id="a72d73cde02c10703b72dcae6bc7c812" category="list-text">ext4允许文件系统最多包含1个外部字节(2^60字节)、文件最多包含16个TB (16 * 2^40字节)。相比之下、ext3文件系统仅支持最大文件系统大小16 TB和最大文件大小2 TB。</block>
  <block id="56b4168424fa999bc383d24daf2da4eb" category="list-text">在ext4文件系统中、多块分配(mbALLO每次 操作)会为一个文件分配多个块、而不是像ext3那样逐个分配。此配置可减少多次调用块分配器的开销、并优化内存分配。</block>
  <block id="632635d22b347f0140fb15d0eb0ed09e" category="list-text">虽然XFS是许多Linux分发版的默认设置、但它管理元数据的方式不同、不适用于某些MySQL配置。</block>
  <block id="aff8b2ed0a4719f014e5baeb861ea7d4" category="paragraph">* NetApp建议*在mkfs实用程序中使用4k块大小选项、以便与现有块LUN大小保持一致。</block>
  <block id="0a24d0336b7b0b29a9daa97f88499884" category="paragraph"><block ref="018d13c1d8b9abcae080b8abbc7c2d8b" prefix="" category="inline-code"></block></block>
  <block id="86fc8cb3bf2cae621315896a94b35f67" category="paragraph">NetApp LUN将数据存储在4 KB物理块中、从而生成八个512字节逻辑块。</block>
  <block id="5f441ceabc94de2a9cced94d9f53a2d0" category="paragraph">如果未设置相同的块大小、I/O将无法与物理块正确对齐、并且可能会在RAID组中的两个不同驱动器中写入数据、从而导致延迟。</block>
  <block id="236ac851d05b8822524001920948f23d" category="admonition">请务必对齐I/O、以实现顺畅的读/写操作。但是、如果I/O从逻辑块开始、而逻辑块不是物理块的起始位置、则表示I/O未对齐。只有当I/O操作从逻辑块(即物理块中的第一个逻辑块)开始时、才会对齐。</block>
  <block id="3225a10b07f1580f10dee4abc3779e6c" category="cell">Parameters</block>
  <block id="c82a6100dace2b41087ba6cf99a5976a" category="cell">值</block>
  <block id="b10db909b8fda84e70bf9b308d0938d9" category="cell">256 M</block>
  <block id="c81e728d9d4c2f636f067f89cc14862c" category="cell">2.</block>
  <block id="7ccc31934ae8244d8263d3c09bcee186" category="cell">InnoDB_doublewite</block>
  <block id="e590322920bebc1156ab585bd6597d76" category="cell">同步</block>
  <block id="adb0c1ec32461889a5093441599260eb" category="cell">11g</block>
  <block id="774412967f19ea61d448977ad9749078" category="cell">8192.</block>
  <block id="311887a53ec7390fc383fa2ad813f012" category="cell">InnoDB_buffer_pool_instances</block>
  <block id="c9f0f895fb98ab9159f51fd0297e236d" category="cell">8.</block>
  <block id="1006f82d8df7d2325439b28ea691737c" category="cell">open_file_Limit</block>
  <block id="3c9b5f1cd6a030bcb7bed9eac80589fb" category="cell">65535</block>
  <block id="c9f5a4d3ede4d084dda0a788ed06783c" category="paragraph">要设置本节中所述的参数、必须在MySQL配置文件(my.cnf)中进行更改。NetApp最佳实践是内部测试的结果。</block>
  <block id="6a554ff1dc93539a626e576bf0d28a02" category="paragraph">MySQL数据库容器化正在变得越来越普遍。</block>
  <block id="bcc002a9f2e2ade112438f50a6630498" category="paragraph">底层容器管理几乎始终通过Docker来执行。OpenShift和Kubnetes等容器管理平台使大型容器环境的管理变得更加简单。容器化的优势包括降低成本、因为无需为虚拟机管理程序授予许可证。此外、容器还允许多个数据库彼此隔离运行、同时共享同一个底层内核和操作系统。容器只需几微秒即可完成配置。</block>
  <block id="14d9b10c6196045941347a9e85704b50" category="inline-link-macro">Astra Trident 文档</block>
  <block id="b8c3891a902a70c4f7f774363652f4b4" category="summary">MySQL文件结构</block>
  <block id="5713a921d815fd7d19875846450f8ea8" category="doc">文件结构</block>
  <block id="4955922857da5499a2f1be602a96b0ff" category="paragraph">InnoDB充当存储和MySQL服务器之间的中间层、它将数据存储到驱动器。</block>
  <block id="5d416cf65dd1e2c908bf430f957c89f8" category="paragraph">MySQL I/O分为两类：</block>
  <block id="e8a320970c929abda9ae744b0b9e8f5f" category="list-text">随机文件I/O</block>
  <block id="85430c0aa096ec282f2a14156baa312e" category="list-text">顺序文件I/O</block>
  <block id="b7b9a4c6983139a2673988826094a3cf" category="paragraph">数据文件会随机读取和覆盖、从而导致IOPS较高。因此、建议使用SSD存储。</block>
  <block id="322f79fd77365edecd173807cb429ca2" category="paragraph">重做日志文件和二进制日志文件是事务日志。它们会按顺序写入、因此、您可以通过写入缓存在HDD上获得良好的性能。恢复时会发生顺序读取、但很少会导致性能问题、因为日志文件大小通常小于数据文件、顺序读取比随机读取(发生在数据文件上)速度快。</block>
  <block id="a898d206a27508975fea2e241af2f04e" category="paragraph">双写缓冲区是InnoDB的一项特殊功能。InnoDB首先将已刷新的页面写入双写入缓冲区、然后将这些页面写入数据文件上的正确位置。此过程可防止页面损坏。如果没有双写入缓冲区、则在向驱动器写入的过程中发生电源故障时、页面可能会损坏。由于写入双写入缓冲区是顺序的、因此针对HDD进行了高度优化。恢复时进行顺序读取。</block>
  <block id="363512900e45bc17bdd6edfa50582862" category="paragraph">由于ONTAP NVRAM已提供写入保护、因此不需要双写缓冲。MySQL有一个参数、<block ref="02d3c518a4019ea00e34e16491d826b4" prefix=" " category="inline-code"></block>，禁用双写缓冲区。此功能可以显著提高性能。</block>
  <block id="49a7df723922bddb4df4002b51087a1c" category="paragraph">插入缓冲区也是InnoDB的一项特殊功能。如果内存中不存在非唯一的二级索引块、则InnoDB会将条目插入到插入缓冲区中、以避免随机I/O操作。插入缓冲区会定期合并到数据库中的二级索引树中。插入缓冲区通过将I/O请求合并到同一个块来减少I/O操作的数量；随机I/O操作可以是顺序的。插入缓冲区也针对HDD进行了高度优化。正常操作期间会同时进行顺序写入和读取。</block>
  <block id="6a0190340f27f29279bbfd319800289d" category="paragraph">撤消段是随机I/O导向的。为了保证多版本并发(MVCC)，InnoDB必须在撤消段中注册旧图像。从撤消段读取以前的图像需要随机读取。如果您运行具有可重复读取的长事务(例如、myq_dump—单个事务)或运行长查询、则可能会发生随机读取。因此、在这种情况下、最好在SSD上存储撤消区块。如果只运行短事务或查询、则随机读取不是问题描述。</block>
  <block id="a27e0d4b650aa6db30fdd95b54c94b27" category="paragraph">*由于InnoDB I/O的特性、NetApp建议*采用以下存储设计布局。</block>
  <block id="defc1bfda928f419df5e4af79c98343e" category="list-text">一个卷、用于存储面向MySQL的随机和顺序I/O文件</block>
  <block id="7fd750411093ebd1faa0d99dd2608514" category="list-text">另一个卷、用于存储MySQL的纯顺序I/O导向文件</block>
  <block id="0561a3b014eef0e5125fa63e1626cf57" category="paragraph">此布局还有助于您设计数据保护策略和策略。</block>
  <block id="9166d970028a28a614af39e6286371b7" category="paragraph">您可以使用关闭此参数<block ref="8cafbd8d9096941261e87f4f9152ab92" prefix=" " category="inline-code"></block> 适用于基准测试、或者您更关心最高性能而非数据完整性或可能出现的故障。InnoDB使用一种称为双写的文件转储技术。在将页面写入数据文件之前、InnoDB会将其写入一个称为双写入缓冲区的连续区域。在完成对双写缓冲区的写入和刷新后、InnoDB会将页面写入到其在数据文件中的正确位置。如果操作系统或myqld进程在页面写入期间崩溃、则InnoDB稍后可以在崩溃恢复期间从双写入缓冲区中找到一个良好的页面副本。</block>
  <block id="3dfd4b9a526f8a8cf17021e34638b375" category="admonition">* NetApp建议*禁用双写缓冲区。ONTAP NVRAM具有相同的功能。双重缓冲会不必要地损害性能。</block>
  <block id="0e5e83102103fcdd25af430bf7327034" category="paragraph">MySQL文档建议您在NAS部署中使用NFSv4。</block>
  <block id="ca0d9fdc80b88e73b548638af421788f" category="section-title">ONTAP NFS传输大小</block>
  <block id="efcd0ba3fcbee9896a25804677e70b4b" category="paragraph">默认情况下、ONTAP会将NFS IO大小限制为64K。MySQL数据库的随机IO使用的块大小要小得多、远远低于64K的最大值。大型块IO通常会并行运行、因此最大64K也不是一个限制。</block>
  <block id="4655f686de75b23f16d530ed7351c447" category="paragraph">在某些工作负载中、最大64K会产生限制。特别是、如果数据库执行的IO数量较少而规模较大、则单线程操作(如完整表扫描备份操作)将更快、更高效地运行。具有数据库工作负载的ONTAP的最佳IO处理大小为256 K。下面列出的适用于特定操作系统的NFS挂载选项已相应地从64K更新为256K。</block>
  <block id="3ab93db30f3dded2c8d71859afbb53f6" category="admonition">请勿将ONTAP上允许的最大传输大小减小到低于当前挂载的NFS文件系统的rsize/wsize值。在某些操作系统中、这可能会导致挂起甚至数据损坏。例如、如果NFS客户端当前设置为rsize/wsize 65536,则ONTAP最大传输大小可以在65536- 1048576之间进行调整,但不会产生任何影响,因为客户端本身是有限的。将最大传输大小减小至65536,可能会损坏可用性或数据。</block>
  <block id="5ea0bb5d4dab46d7971fef94ccde9369" category="paragraph">* NetApp建议使用*</block>
  <block id="09c6aa928c90ba68a4e03deadfeaa644" category="paragraph">设置以下NFSv4 fstab (/etc/fstab)设置：</block>
  <block id="0ae3c9648bc2d8c33fa57415604da370" category="paragraph"><block ref="a63a3dc825ff52908de7c9dfcb29ffa5" prefix="" category="inline-code"></block></block>
  <block id="3e0b2c100b093560f63ad57c6849bc8a" category="admonition">NFSv3的一个常见问题描述是断电后锁定的InnoDB日志文件。使用时间或切换日志文件解决了此问题描述。但是、NFSv4具有锁定操作、并可跟踪打开的文件和委派。</block>
  <block id="62e4eb800d20b46085ccb975da78bafe" category="sidebar">ONTAP是许多企业级应用程序和数据库技术的数据管理和数据保护基础。以下几页提供了有关ONTAP以及企业级应用程序和基础架构的最佳实践和实施过程的指导。</block>
  <block id="78898e52fcbdc5337204a384f2456d4f" category="sidebar">Microsoft SQL Server</block>
  <block id="4f60acc41a8bf3fa75e7f74768637787" category="sidebar">Microsoft SQL Server数据保护</block>
  <block id="b8529ff730dcf8dd2178d72de271dc4d" category="sidebar">开源数据库</block>
  <block id="bb9a5a6fadabab849d2e87f0898d7601" category="sidebar">基于ONTAP的MariaDB和MySQL</block>
  <block id="5ad2a11eceac3ebd7cbf3b534ebdb1db" category="sidebar">ONTAP上的PostgreSQL</block>
  <block id="c30dd1a85cf86d95b11c1a08f70130ce" category="sidebar">Oracle 数据库</block>
  <block id="4948dede9f4e7c3dfe48c38f7902f6e5" category="sidebar">基于ONTAP的Oracle</block>
  <block id="d71074394b511143c8d1108e74a81abb" category="sidebar">Oracle数据保护</block>
  <block id="f4d8825927d11df25770df5e00d6a52e" category="sidebar">Oracle迁移</block>
  <block id="86083f3ea21c2385b4f013aae3c57858" category="sidebar">SAP HANA</block>
  <block id="677f2e7e550075f7bbbdac91e0918f2f" category="sidebar">SAP 解决方案</block>
  <block id="1b83f2b1c0b7fb3af048c2a59624fe3b" category="sidebar">采用AFF和FC的SAP HANA</block>
  <block id="6ab3c3f05076d213f0b1feff267607c6" category="sidebar">采用AFF和NFS的SAP HANA</block>
  <block id="56079badd056a19303cc26e6a4fcc7e0" category="sidebar">VMware</block>
  <block id="f07084a11252c9bca97503ea9a627c89" category="sidebar">使用ONTAP的虚拟卷(Virtual Volume、Virtual Volume、Virtual Volume、Virtual Volume)</block>
  <block id="2d90ac09cbf108bddad31dd341f8614e" category="sidebar">采用ONTAP的VMware Site Recovery Manager</block>
  <block id="b0dae11b82e63781abdc8f893c41b3c0" category="sidebar">企业级应用程序</block>
  <block id="999bc6b18351bbe817d26f559ba408ae" category="sidebar">SAP</block>
  <block id="2d2eef88dbdd0c34bde24e2632d9944f" category="sidebar">SAP HANA和AnyDB</block>
  <block id="399bd1ee587245ecac6f39beaa99886f" category="sidebar">PostgreSQL</block>
  <block id="f4f70727dc34561dfde1a3c529b6205c" category="sidebar">设置</block>
  <block id="7d219314ccabde6609510141bb175a6c" category="sidebar">共享实例与专用实例</block>
  <block id="d5363ae19ecaede49e2ced297df7737a" category="sidebar">内存配置</block>
  <block id="500c09aa1bb9af431f2c18348e69bfd0" category="sidebar">tempdb文件</block>
  <block id="4c5d94eb4dc4bff93f6a96a08ab7b244" category="sidebar">数据安全性</block>
  <block id="cf91513c6fc63cebe4b63a6647238d6d" category="sidebar">RAID</block>
  <block id="83db97189c47f7bb4edd879e8756f6e6" category="sidebar">容量限制</block>
  <block id="af81930661b267e8f1e68c4d66e9ee56" category="sidebar">故障转移和切换</block>
  <block id="dfd1f50170457b961c15bb13ad7e3bed" category="sidebar">数据文件和重做块大小</block>
  <block id="49f83bf3a15b8626eb91fde93c6b1788" category="sidebar">Oracle RAC</block>
  <block id="13d80777c8fd43e555c1f5b1b72d7ef0" category="sidebar">主机配置</block>
  <block id="7e6bb0931a72759d39514aa924b420bc" category="sidebar">AIX</block>
  <block id="6bb83af717367dd4a47f75801ae7a2b0" category="sidebar">带有ASMlib和AFC的Linux</block>
  <block id="619615da0f93507e22a6054ef2aea4f1" category="sidebar">逻辑接口</block>
  <block id="aca8e861c6f30fe2d42d0310a387312b" category="sidebar">以太网配置</block>
  <block id="63a5b8bd41978e8124f9ccdfa9063e9e" category="sidebar">FC SAN配置</block>
  <block id="c3f378ef942f6bf228a43aaacc628fea" category="sidebar">LVM拼花</block>
  <block id="254f642527b45bc260048e30704edb39" category="sidebar">Configuration</block>
  <block id="f3a78e25ce9f95fc3c61ccc39f32fb4d" category="sidebar">Oracle Direct NFS （ DNFS ）</block>
  <block id="989cefa74de0e10a575103f446258d99" category="sidebar">NFS租约和锁定</block>
  <block id="0d695ec265a3b0b5e7e32e33ffe4ed22" category="sidebar">NFS缓存</block>
  <block id="eb4d10d6eda7c9266cd36c4eb0a223cf" category="sidebar">ASM Recasation Utility</block>
  <block id="297e2ac2ec0bd88ad598062f4c07ee45" category="sidebar">分层策略</block>
  <block id="9af6f452cd88c83f2bde555de8f93690" category="sidebar">将数据发送到对象存储</block>
  <block id="08af6d4e6b562e2d0b418d7198f5a0f7" category="sidebar">正在从对象存储检索数据</block>
  <block id="02d01636975b3ae0c0ab22368cea8d54" category="sidebar">层策略</block>
  <block id="7fbd108e1fc6910c941094e95a677878" category="sidebar">整个文件</block>
  <block id="eb43c2427eb06b9f561363863b4a4f0b" category="sidebar">部分文件</block>
  <block id="1afe200fa26ba361f59b603b22ad6392" category="sidebar">选择文件</block>
  <block id="448d15345bb99c834095da225c529b8a" category="sidebar">数据可用性</block>
  <block id="5869e10a9dea6d88d61bb10040557f35" category="sidebar">数据完整性</block>
  <block id="7b68149402c05a52968bda6af0435c8a" category="sidebar">基于Snapshot的联机备份</block>
  <block id="49ba0ee205d016d8236db9c1e8c130e5" category="sidebar">Storage Snapshot优化的备份</block>
  <block id="2c6d98297c340e390e0783220b038545" category="sidebar">物理架构</block>
  <block id="13a854bdd11f8f57a0b25c00631f1430" category="sidebar">逻辑架构</block>
  <block id="5e7988aeba0e1d3c15c5c78a0db738d1" category="sidebar">SyncMirror</block>
  <block id="5ba8ee2f32815884475d1f2244ba16a6" category="sidebar">故障情形</block>
  <block id="e31593850dc03f8f10d036df5dc8633b" category="sidebar">Oracle数据库迁移</block>
  <block id="5102abd5a9cc202678054b832caf678d" category="sidebar">过程</block>
  <block id="1495d3ed3ebff783c0f480b583372450" category="sidebar">主机数据复制</block>
  <block id="d81ca5686c955ed50927409eb8c14bb0" category="sidebar">外部LUN导入</block>
  <block id="2fea59b7e470acac5ec1589d504da14e" category="sidebar">完成</block>
  <block id="e9cc85ef98d982c3c3e53d6b82293126" category="sidebar">协议转换</block>
  <block id="fbbd0e8905df3950eca4d1d8f55881ad" category="sidebar">附加说明</block>
  <block id="ac0465a970688dc3c326dcdd8fe2805e" category="sidebar">性能优化和基准测试</block>
  <block id="7cb9c3cd8b9873d39a1fe87c083cd55c" category="sidebar">过时的NFS锁定</block>
  <block id="c0916addb4f26afa58c5a6df4f463fa5" category="sidebar">统一存储</block>
  <block id="c0032c6bab44eeeb6886c7a4aa67cf77" category="sidebar">虚拟化工具</block>
  <block id="1c77ac70000b6804e930748d5df7be5e" category="sidebar">基于虚拟卷和存储策略的管理</block>
  <block id="217601d383b816e6a2548e57b5006f92" category="sidebar">克隆</block>
  <block id="8f2db90dd4a6fbd95ba8f0bc54fd6b27" category="sidebar">QoS</block>
  <block id="09b4a81ec7b05cbacc7cbfa13e006254" category="sidebar">基于存储策略的管理</block>
  <block id="2e8526cbe762cb1b8393d935a3b0bf16" category="sidebar">建议设置</block>
  <block id="10a764f91b59ce3c8931d55c2fd54222" category="sidebar">部署虚拟卷存储</block>
  <block id="30f6724a02fc69093960468c0a2fbcd4" category="sidebar">产品安全性</block>
  <block id="3390e3575b3e341afa2b7172ff5b33a7" category="sidebar">适用于 VMware vSphere 的 SnapCenter 插件</block>
  <block id="62a004b95946bb97541afa471dcca73a" category="sidebar">MySQL</block>
  <block id="7f1a6761f7160e33a32105202e47303b" category="sidebar">容器化</block>
  <block id="bd57f4f74ca087a92a48b23d45753729" category="paragraph">ONTAP 工具的VASA提供程序负责根据已发现的受管ESXi主机启动程序管理ONTAP 中的FCP和iSCSI igrou以及NVMe子系统。但是、它不会与光纤通道交换机集成来管理分区。必须先根据最佳实践进行分区、然后才能进行任何配置。以下是单个启动程序分区到四个ONTAP系统的示例：</block>
  <block id="6b14e3f4a37881185acf7a766f8f6272" category="paragraph">单个启动程序分区：</block>
  <block id="17ccf64e30cb518fd7ca87ce752ad738" category="paragraph"><block ref="17ccf64e30cb518fd7ca87ce752ad738" category="inline-image-macro-rx" type="image"></block></block>
  <block id="58b5cd2a94730c2e044c14891f1e0e87" category="paragraph">有关更多最佳实践、请参见以下文档：</block>
  <block id="fc9e4d789d968936f8ff5ae5a99847e0" category="paragraph"><block ref="fc9e4d789d968936f8ff5ae5a99847e0" category="inline-link-rx"></block></block>
  <block id="d748a2834a7220eef4ec4775a51632f9" category="paragraph"><block ref="d748a2834a7220eef4ec4775a51632f9" category="inline-link-rx"></block></block>
  <block id="80dad10df0d1a031764e7c648c46aa23" category="paragraph">*请考虑使用最大IOPS来控制未知或测试VM。*</block>
  <block id="93e4f73afe8b787b33161ec273ca087f" category="paragraph">最大IOPS首次在VASA Provider 7.1中推出、可用于将未知工作负载的IOPS限制为特定VVOR、以避免对其他更关键的工作负载产生影响。有关性能管理的详细信息、请参见表4。</block>
  <block id="4e0d7e0587bf99c9b7a64a84fd42f6bd" category="paragraph">请参见NetApp和VMware针对您选择的协议提供的其他最佳实践指南。一般而言，除了上述情况外，没有任何其他变化。</block>
  <block id="97f87e9ab1d660463c63beb8745fd9e5" category="paragraph">*使用基于NFS v3*的Vvol的网络配置示例</block>
  <block id="c80b3cc8b5013bd4039769fb0f783e60" category="paragraph"><block ref="c80b3cc8b5013bd4039769fb0f783e60" category="inline-image-macro-rx" type="image"></block></block>
  <block id="dee28dd6d1a9ef7bf399f642fd9d588f" category="section-title">NFS传输大小</block>
  <block id="d8299d00f914e35b80644e5781e47a77" category="paragraph"><block ref="d8299d00f914e35b80644e5781e47a77" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5a656ddcc72bacc3a5900c23edf7a08e" category="paragraph"><block ref="5a656ddcc72bacc3a5900c23edf7a08e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="073ce0a0568adc64d52dd9b1d8c02c54" category="paragraph"><block ref="073ce0a0568adc64d52dd9b1d8c02c54" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3401a9880dfc322da8a56c4d632361f6" category="paragraph"><block ref="3401a9880dfc322da8a56c4d632361f6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="87f823f4f3b4258445d5af029afe5ad9" category="paragraph"><block ref="87f823f4f3b4258445d5af029afe5ad9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9213fe9d391179276ff6c03552486255" category="paragraph"><block ref="9213fe9d391179276ff6c03552486255" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3105b4c0642b9710179c18edcf8e8718" category="paragraph"><block ref="3105b4c0642b9710179c18edcf8e8718" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1a43000eb9893bff7ab7b1ce1d3fd6a8" category="paragraph"><block ref="1a43000eb9893bff7ab7b1ce1d3fd6a8" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4b7a8562c98b8c652bdfb6aa79788222" category="paragraph"><block ref="4b7a8562c98b8c652bdfb6aa79788222" category="inline-image-macro-rx" type="image"></block></block>
  <block id="acce752526553bfa73c92799accd9cb8" category="summary">Oracle数据保护概述</block>
  <block id="deb8cb7644231cae002f5f37c725b86f" category="paragraph">远距离迁移通常需要更具创意的方法、例如中所述的日志传送过程 <block ref="86efe12ea0d3a769a4b7cfc2b6362f49" category="inline-link-macro-rx"></block>。远距离IP网络的带宽很少接近LAN或SAN速度。在一个案例中、NetApp以极高的归档日志生成速率协助远程迁移220 TB数据库。选择的数据传输方法是每天运送磁带、因为这种方法可提供最大可能的带宽。</block>
  <block id="055362c7082175c34483772a43b776cf" category="paragraph">例如、复制一个10 TB数据库通常需要大约7小时才能完成。如果业务需求允许中断七小时、则文件复制是一种简单安全的迁移选项。如果五个小时不可接受、则采用简单的日志传送流程(请参见 <block ref="eee8a7589b6555fc3411165c58a62ca5" category="inline-link-macro-rx"></block>)、只需极少的工作量即可完成设置、从而将转换时间缩短至大约15分钟。在此期间、数据库管理员可以完成此过程。如果15分钟不可接受、则可以通过脚本自动执行最终转换过程、将转换时间缩短为几分钟。您始终可以加快迁移速度、但这样做会耗费时间和精力。转换时间目标应基于业务部门可接受的内容。</block>
  <block id="911e63244fc82405263306a64e535c69" category="paragraph">只能在中的步骤之后创建zpool <block ref="e8673fdb712a2edcdf56742c7eec0045" category="inline-link-macro-rx"></block> 执行。如果操作步骤未正确执行、则可能会因I/O对齐而导致性能严重下降。要在ONTAP上获得最佳性能、需要将I/O与驱动器上的4K边界对齐。在zpool上创建的文件系统使用有效块大小、该大小通过名为的参数进行控制<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block>，可通过运行命令来查看<block ref="1615297782a0dff59b20451e2ca97ea7" prefix=" " category="inline-code"></block>。</block>
  <block id="b2ca9da17ac7a0807fb313343c1ba9cb" category="list-text">创建分区时使用的是33扇区偏移、而不是默认的32扇区偏移。重复中所述的操作步骤 <block ref="6ba0f94fdd8f9504e3fef5712023fb85" category="inline-link-macro-rx"></block>。直方图显示如下：</block>
  <block id="eb7f9a88026c895932f70c650c364132" category="list-text">增加LUN的大小</block>
  <block id="0f11c45e6e7377b9d10a93534d0fa2f3" category="list-text">将LUN添加到现有卷组并增加包含的逻辑卷</block>
  <block id="e4da750cce448393b2597f8f66086894" category="paragraph">启动程序组(igroGroup)是ONTAP LUN屏蔽架构的一部分。除非先授予主机访问权限、否则无法访问新创建的LUN。为此、可创建一个igrop、其中列出应授予访问权限的FC WWN或iSCSI启动程序名称。编写此报告时、只有FC LUN支持FLI。但是、迁移后转换为iSCSI是一项简单的任务、如所示 <block ref="43085dc2a05784d4912331d1ed1db91d" category="inline-link-macro-rx"></block>。</block>
  <block id="525e71fb331412cd820122c3d51d453c" category="paragraph">这样、数据库管理器便可在删除数据后回收存储阵列上的空间。ONTAP会截获零并取消分配LUN中的空间。回收过程速度极快、因为存储系统中不会写入任何数据。</block>
  <block id="14bdf3569ec0024259b2b02c5a668eae" category="paragraph">时间<block ref="7ccc31934ae8244d8263d3c09bcee186" prefix=" " category="inline-code"></block> 处于启用状态(默认值)时、InnoDB会将所有数据存储两次：首先存储到双写入缓冲区、然后存储到实际数据文件。</block>
  <block id="394ad91b4701dbd32675896bed204755" category="sidebar">PostgreSQL的主机配置</block>
  <block id="9852487272d9b2aa9026d0fddc0616fc" category="sidebar">PostgreSQL的存储配置</block>
  <block id="bc237072428e0e4c415160b898946d4c" category="sidebar">PostgreSQL的数据保护</block>
  <block id="3423582eed75b4bd6632c18238fd78e4" category="sidebar">Microsoft SQL Server的数据库配置</block>
  <block id="5a4517368fb2ab5498fc2108c2ea64c5" category="sidebar">Oracle数据库的数据库配置</block>
  <block id="e483c0ecf3a2b1a60f886d4a5ac553ff" category="sidebar">Oracle数据库的主机配置</block>
  <block id="06b078afa802a679ad4694d13a8a2495" category="sidebar">Oracle数据库的网络配置</block>
  <block id="f1991b28c5d48cb53798755acf9dfe62" category="sidebar">Oracle数据库的存储配置</block>
  <block id="ea9cdfcbfcf1906c15b6779f0f327028" category="sidebar">MySQL的数据库配置</block>
  <block id="308f8f580d0248ac023557cfd4b10d83" category="sidebar">MySQL的主机配置</block>
  <block id="830f353b3e6055499fac447b16b0c935" category="sidebar">MySQL的存储配置</block>
  <block id="3106f8f17f2974fe05da16fb0cc50505" category="summary">基于ONTAP使用SAN的PostgreSQL数据库</block>
  <block id="74cacb0c34a37e2859e3b054938a344d" category="doc">使用SAN文件系统的PostgreSQL</block>
  <block id="1758f5c81d60f1a0ac8600fddc99a919" category="paragraph">采用SAN的PostgreSQL数据库通常托管在xfs文件系统上、但如果操作系统供应商支持、则可以使用其他数据库</block>
  <block id="d73e7b56b7baa813a32c521ca074e7c4" category="paragraph">虽然一个LUN通常可支持高达10万次IOPS、但IO密集型数据库通常需要使用带区化LVM。</block>
  <block id="f7cc8c4234952826818ad4d0c2050ac9" category="paragraph">PostgreSQL数据库可以托管在NFSv3或NFSv4文件系统上。最佳选择取决于数据库以外的因素。</block>
  <block id="1482c42acc1dd31ee8496c71a805e73c" category="paragraph">例如、在某些集群环境中、NFSv4锁定行为可能更好。(请参见 <block ref="bc3a7e667477b8b3590fa1451dcb924c" category="inline-link-macro-rx"></block> 了解更多详细信息)</block>
  <block id="9674525687765646f35916d0e569eda9" category="paragraph">否则、数据库功能(包括性能)应接近相同。唯一的要求是使用<block ref="d64a84456adc959f56de6af685d0dadd" prefix=" " category="inline-code"></block> 挂载选项。要确保软超时不会产生不可恢复的IO错误、必须执行此操作。</block>
  <block id="0c6430fad6c643c444b5d6d52b18edb4" category="paragraph">如果选择NFSv4作为协议、NetApp建议使用NFSv4.1。在NFSv4.1中、NFSv4协议有一些功能增强功能、可提高NFSv4.0的故障恢复能力。</block>
  <block id="248212b04c23627e2719e106224d2eb3" category="paragraph">对常规数据库工作负载使用以下挂载选项：</block>
  <block id="9efbdff43e91279291e95690414bec95" category="paragraph">在ONTAP级别增加传输大小后、将使用以下挂载选项：</block>
  <block id="395201f6a339cc4cf6b345e0c259f383" category="section-title">NFSv3 TCP插槽表</block>
  <block id="1f8260aa2c5a5b35bf771c26828d2096" category="paragraph">如果在Linux中使用NFSv3、则正确设置TCP插槽表至关重要。</block>
  <block id="92d0a1aef2134a70d5c0f0279dc22ec6" category="doc">Snapshot 副本</block>
  <block id="0c47b4eb567b018e3d2e5882b88eaca9" category="paragraph">存储快照是目标数据的时间点副本。ONTAP的实施支持设置各种策略、并为每个卷存储多达1024个快照。ONTAP中的快照可节省空间。只有在原始数据集发生更改时、才会占用空间。它们也是只读的。快照可以删除、但不能更改。</block>
  <block id="7986a4827296ca9cd0b991ded9f8a10d" category="paragraph">在某些情况下、可以直接在ONTAP上计划快照。在其他情况下、可能需要SnapCenter等软件来编排应用程序或操作系统操作、然后再创建快照。无论哪种方法最适合您的工作负载、主动快照策略都可以通过频繁、轻松访问从启动LUN到任务关键型数据库的所有备份来确保数据安全。</block>
  <block id="c4bf0f56feeec9a45e973768fbc4f47e" category="section-title">防篡改快照</block>
  <block id="38fef959179f8d3eb79a68a5ce747bdc" category="paragraph">这样可以确保即使侵入者、恶意内部人员甚至勒索软件攻击导致访问ONTAP系统本身、也不会影响备份。如果与频繁的快照计划结合使用、则可以提供极其强大的数据保护、并且RPO非常低。</block>
  <block id="a1f41e52e9ddbd9f87ecd032c237b1c0" category="section-title">SnapMirror 复制</block>
  <block id="18d315ae923785b3f9c5234724b0ab42" category="paragraph">第二个系统还为管理安全性打开了新的选项。例如、某些NetApp客户会隔离主存储系统和二级存储系统的身份验证凭据。没有一个管理用户可以同时访问这两个系统、这意味着恶意管理员无法删除所有数据副本。</block>
  <block id="500569e3cc0764260a592cb176921ca3" category="section-title">Storage Virtual Machine</block>
  <block id="597cb258dd509add7cd999794c60d430" category="paragraph">例如、您可以为关键生产工作负载配置一个SVM、为开发活动配置另一个SVM。然后、您可以限制某些管理员对生产SVM的访问、同时授予开发人员对开发SVM中存储资源的更广泛的控制权限。您可能还需要为财务和人力资源团队提供第三个SVM、以存储非常关键的只读数据。</block>
  <block id="7d0fc71fe28e011ca49b06214469d484" category="section-title">管理RBAC</block>
  <block id="4f0dae2ba2fd11c533349d6ade4f81de" category="paragraph">ONTAP为管理登录提供了功能强大的基于角色的访问控制(Role-Based Access Control、RBAC)。某些管理员可能需要完全集群访问权限、而其他管理员则可能只需要访问某些SVM。高级帮助台人员可能需要增加卷大小的能力。这样、您就可以为管理用户授予执行其工作职责所需的访问权限、而无需执行任何其他操作。此外、您还可以使用不同供应商提供的PKI来保护这些登录、限制对ssh密钥的访问、并强制执行失败登录尝试锁定。</block>
  <block id="852741d2a7fb0a8a1a5dd748dbbd6734" category="section-title">API RBAC</block>
  <block id="bbbea5fec67f15424fa77aa563754c49" category="paragraph">自动化需要API调用、但并非所有工具都需要完全管理访问权限。为了帮助保护自动化系统的安全、还在API级别提供了RBAC。您可以将自动化用户帐户限制为所需的API调用。例如、监控软件不需要更改访问权限、只需要读取访问权限即可。配置存储的工作流不需要删除存储。</block>
  <block id="7604bad489eaec7e27d112c63d3e2936" category="paragraph">通过要求两个不同的管理员(每个管理员都有自己的凭据)批准某些活动、可以进一步实现多"因素"身份验证。其中包括更改登录权限、运行诊断命令和删除数据。</block>
  <block id="b39c0496b44447232912303246b46aaa" category="paragraph">如果预期顺序IO较多、则可以按下一节所述增加NFS传输大小。</block>
  <block id="959e8f746f4ff03f6225b95cf646e65f" category="admonition">本文档将取代先前发布的技术报告_TR-4590：《采用ONTAP的Microsoft SQL Server最佳实践指南》</block>
  <block id="aa131b86ebd9f719bab1aba612ae3c3f" category="list-text">如果恢复计划中的数据存储库数量和保护组数量达到最低、则SRM的性能最佳。因此、您应考虑在受SRM保护的环境中优化虚拟机密度、在这种环境中、应使用最重要的是RTO。</block>
  <block id="afab42482b97a8b43c62320c373ded74" category="list-text">使用Distributed Resource Scheduler (DRS)帮助平衡受保护和恢复ESXi集群上的负载。请记住、如果您计划故障恢复、则在运行重新保护时、先前受保护的集群将成为新的恢复集群。DRS将有助于平衡两个方向的放置。</block>
  <block id="8ed6c5d9143eeb92cf75bb8a08bb7819" category="list-text">如有可能、请避免对SRM使用IP自定义、因为这会增加您的RTO。</block>
  <block id="e2e7245b1b3cf4a13a6b703ead49ebee" category="paragraph">系统会为每个阵列对创建一个阵列管理器。使用 SRM 和 ONTAP 工具，每个阵列配对都在 SVM 的范围内完成，即使您使用的是集群凭据也是如此。这样，您可以根据租户分配给他们管理的 SVM 在租户之间划分灾难恢复工作流。您可以为一个给定集群创建多个阵列管理器、这些阵列管理器可以是非对称的。您可以在不同的 ONTAP 9 集群之间扇出或扇入。例如，可以将集群 1 上的 SVMA 和 SVM-B 复制到集群 2 上的 SVM-C ，集群 3 上的 SVM-D ，反之亦然。</block>
  <block id="4da3f855cd505741909cfd49d743e68e" category="paragraph">通过 SRM ，您还可以在虚拟机恢复后更改其网络配置。此重新配置包括IP地址、网关地址和DNS服务器设置等设置。恢复计划中VM的属性设置中可以指定不同的网络设置、这些设置会在恢复后应用于各个VM。</block>
  <block id="e409450ce49f3558b068c69a77a9623a" category="paragraph">在故障恢复之后、您应与所有利益相关方确认其服务已恢复正常、然后再再次运行重新保护。</block>
  <block id="a42cf9beb4788dddb7d317e05cc08e23" category="sidebar">数据库文件和文件组</block>
  <block id="8858bb6564a2efc189c9183c495ce545" category="sidebar">LUN对齐</block>
  <block id="02bc4ad8a694d41c8b598dfbcb12f069" category="sidebar">LUN计数和LUN大小</block>
  <block id="066f208a93617bd82090d42624ce63cc" category="sidebar">LUN大小调整</block>
  <block id="9eeba6fd02cf3b6d8aee35e0ce9bf8fe" category="sidebar">LVM条带化</block>
  <block id="183bdb28f19bee640319f68825827aea" category="sidebar">RPO、RTO和SLA</block>
  <block id="2172b5d51273924b537842b0db78bfd4" category="sidebar">备份和恢复基础知识</block>
  <block id="3403aac944f3cb6e2d2c7f7d52bc44b9" category="paragraph">随着数据呈指数级增长、企业的数据管理变得更加复杂。这种复杂性会增加许可、运营、支持和维护成本。要降低总体TCO、请考虑使用可靠的高性能后端存储从商用数据库切换到开源数据库。</block>
  <block id="dcac08882e3396bd30210108baa1641d" category="paragraph">ONTAP是理想的平台、因为ONTAP专为数据库而设计。随机IO延迟优化、高级服务质量(Quality of Service、QoS)和基本FlexClone功能等众多功能专为满足数据库工作负载的需求而创建。</block>
  <block id="1429a98a71e16287326edd7fc1f999fd" category="paragraph">无中断升级(包括更换存储)等其他功能可确保关键数据库始终可用。您还可以通过MetroCluster为大型环境实现即时灾难恢复、或者使用SnapMirror主动同步功能选择数据库。</block>
  <block id="8df3fb35ff15e02683bfb1bc7f852c93" category="paragraph">最重要的是、ONTAP提供无与伦比的性能、能够根据您的独特需求调整解决方案的大小。我们的高端系统可以提供超过100万次IOPS、延迟以微秒为单位。但是、如果您只需要10万次IOPS、则可以使用仍运行完全相同存储操作系统的小型控制器来调整存储解决方案的大小。</block>
  <block id="97b4cda00dd31f5be69440f48c4da149" category="summary">使用ONTAP的PostgreSQL数据库配置</block>
  <block id="c4f52498c0db572381512887d7584e53" category="summary">PostgreSQL数据库和存储快照</block>
  <block id="b0792163c858a7c221b236d84619b5ef" category="summary">PostgreSQL数据库NFS与ONTAP</block>
  <block id="189950ed46e5e8b7e92941531a5bb88b" category="doc">使用NFS文件系统的PostgreSQL数据库</block>
  <block id="6cabd4dcf3582d38c441228705da3bda" category="doc">PostgreSQL数据保护</block>
  <block id="383a6a5241ecfc558b9fec1d7cff5239" category="summary">PostgreSQL表空间</block>
  <block id="20d0e2519b3555a0a2927c8914c17280" category="summary">PostgreSQL数据保护软件</block>
  <block id="29e2aec511a8e307ecceacbd86c22f14" category="summary">PostgreSQL初始化参数</block>
  <block id="035ecd1be6cacde993302b440e396bc2" category="paragraph">现在、大多数数据库客户都选择全闪存阵列、这就需要考虑一些额外的注意事项。例如、考虑在双节点AFF A900系统上进行性能测试：</block>
  <block id="33f545d041b93838074263c0efd2e9da" category="list-text">如果读/写比率为80/20、则两个A900节点可以在延迟甚至超过150µs微秒之前提供超过100万次的随机数据库IOPS。这远远超出了大多数数据库当前的性能需求、因此很难预测预期的改进。存储将作为瓶颈在很大程度上被消除。</block>
  <block id="0445195555faac96ebff962dbff126ea" category="summary">MySQL配置参数</block>
  <block id="c0b7708ffcd66fd65a9d2a4801091563" category="paragraph">NetApp建议使用一些重要的MySQL配置参数来获得最佳性能。</block>
  <block id="10eb8b7e75da1815860da31490513841" category="summary">使用NFS的MySQL</block>
  <block id="5249e05857621fbfae51371a73006c44" category="summary">MySQL和NFSv3插槽表</block>
  <block id="d058f95e3a8d4b7b46802139d6b95982" category="paragraph">Linux上的NFSv3性能取决于名为的参数<block ref="453f2cc2326f82af1053f4aa4b75400b" prefix=" " category="inline-code"></block>。</block>
  <block id="bf2bdc980948fb9084a63963398846b2" category="paragraph">ONTAP是MySQL数据库的理想平台、因为ONTAP实际上是为数据库设计的。随机IO延迟优化、高级服务质量(Quality of Service、QoS)和基本FlexClone功能等众多功能专为满足数据库工作负载的需求而创建。</block>
  <block id="1b3804b7e2292e18f5e66d54f7a9fafc" category="paragraph">最重要的是、ONTAP提供无与伦比的性能、能够根据您的独特需求调整解决方案的大小。我们的高端系统可以提供超过100万次IOPS、延迟以微秒为单位、但如果您只需要10万次IOPS、则可以使用仍运行完全相同存储操作系统的较小控制器来调整存储解决方案的大小。</block>
  <block id="1339877637a3f7f59745a00e04f304fd" category="summary">MySQL和InnoDB_log_file_size</block>
  <block id="c1c4e722764621d56a075e42ce48d0c0" category="summary">MySQL和InnoDB_buffer_pool_size</block>
  <block id="ae14ab6d1e5edd0e782d8897d1721eb4" category="summary">MySQL和InnoDB_doblewite</block>
  <block id="689c52e3f5db5d2dafccd7d93cf1abc4" category="summary">MySQL和InnoDB_FLOG_LOG_AT_TRx_COMI</block>
  <block id="639600080c225673dfdfa012fdbd6146" category="summary">MySQL和IO计划程序</block>
  <block id="72985ac51e91797345b2437088a4362e" category="summary">采用SAN的MySQL</block>
  <block id="d5ef0a45fe252b03f538bfd134b168db" category="summary">MySQL和InnoDB_LRU_SCAN_深度</block>
  <block id="df657260453f6ef228ee0ca22dd7a415" category="summary">MySQL容器化</block>
  <block id="2828450fc6669c8df75f937e227996f1" category="doc">MySQL文件描述符</block>
  <block id="9420010a756fb6d3ddeadfa63d2170f6" category="paragraph">要运行、MySQL服务器需要文件描述符、而默认值是不够的。</block>
  <block id="62414a5a9c0e2fc12a8d028ad29164b8" category="summary">MySQL和InnoDB_IO_Capacity</block>
  <block id="6219c45bc8c26437c0b7e1a69d4cbe58" category="summary">MySQL和InnoDB_F冲 方法</block>
  <block id="35d1a5d7b12999ec27f5233dccba043f" category="summary">MySQL和open_file_极限</block>
  <block id="c031febc35017c70bf3b526723756b2a" category="doc">iSCSI和NVMe/TCP</block>
  <block id="4da35d461815e71b97bda03476e89b7b" category="paragraph">使用iSCSI或NVMe/TCP的主机可以直接连接到存储系统并正常运行。原因是路径问题。直接连接到两个不同的存储控制器会产生两条独立的数据流路径。丢失路径、端口或控制器不会阻止使用另一个路径。</block>
  <block id="40715d81cea527f13cdf470773fc3a65" category="paragraph">可以使用直连NFS存储、但有一个重大限制—如果没有大量的脚本编写工作、故障转移将无法正常工作、这是客户的责任。</block>
  <block id="d0b13bfd23c05f64222869de30f81000" category="paragraph">直连NFS存储的无中断故障转移之所以复杂、是因为本地操作系统上会发生路由。例如、假设主机的IP地址为192.168.1.1/24、并且直接连接到IP地址为192.168.1.50/24的ONTAP控制器。在故障转移期间、该192.168.1.50地址可以故障转移到另一个控制器、并且该地址可供主机使用、但主机如何检测到它的存在？原来的192.168.1.1地址仍然位于不再连接到操作系统的主机NIC上。发往192.168.1.50的流量将继续发送到无法运行的网络端口。</block>
  <block id="288a0a5ebbc70fb3b968ec58d36d71ab" category="paragraph">第二个操作系统NIC可配置为19 2.168.1.2、并且能够与故障转移的192.168.1.50地址通信、但本地路由表默认使用一个*且仅一个*地址与192.168.1.0/24子网通信。sysadmin可以创建一个脚本框架、用于检测失败的网络连接并更改本地路由表或启动和关闭接口。确切的操作步骤取决于所使用的操作系统。</block>
  <block id="d6ce8522932df7ae76aa0b963ad9ef7d" category="paragraph">在实践中、NetApp客户确实使用直连NFS、但通常仅适用于故障转移期间IO暂停的工作负载。使用硬挂载时、暂停期间不应出现任何IO错误。在服务还原之前、IO应挂起、可以通过故障恢复或手动干预在主机上的NIC之间移动IP地址。</block>
  <block id="3436a7073ac9f4071820b6720a7789fc" category="section-title">FC直连</block>
  <block id="b7981516813a09695906aa429b07f48f" category="paragraph">不能使用FC协议将主机直接连接到ONTAP存储系统。原因是使用了NPIV。用于向FC网络标识ONTAP FC端口的WWN使用一种称为NPIV的虚拟化类型。连接到ONTAP系统的任何设备都必须能够识别NPIV WWN。目前没有HBA供应商提供可安装在能够支持NPIV目标的主机中的HBA。</block>
  <block id="97db606ac6781989ea3b189d7be28bf2" category="section-title">直连网络</block>
  <block id="d078ae9a339971900f939db9e82f253d" category="paragraph">存储管理员有时倾向于通过从配置中删除网络交换机来简化其基础架构。在某些情况下、可以支持此功能。</block>
  <block id="e817ecc2f82a2b78d828ec8704031da3" category="section-title">直连网络</block>
  <block id="87e6f97c8ec2f31df616ef84401ffaf4" category="paragraph">追加信息 提供了多种故障排除资源。</block>
  <block id="52d04863ac62a6fa67e1b49a31086928" category="paragraph">以下各节概述了VMware SRM和ONTAP存储的最佳操作实践。</block>
  <block id="f24ef4a42850a2b3e3d77e610ae46fee" category="doc">计划内和计划外事件的故障恢复能力</block>
  <block id="4bce11924453ef2ee7e40109f79dc66d" category="paragraph">NetApp MetroCluster和SnapMirror主动同步是功能强大的工具，可提高NetApp硬件和ONTAP®软件的高可用性和无中断运行。</block>
  <block id="d267775072875ddbb24c16a41c22d8a2" category="paragraph">MetroCluster和SnapMirror主动同步提供了三种在发生计划内或计划外事件时保持数据连续性的基本方法：</block>
  <block id="1d3027d09fc1db3087f05f2163af2cb7" category="list-text">冗余组件、用于防止出现单组件故障</block>
  <block id="f3b83f3b77289efe3b53cf537b7b77f5" category="list-text">影响单个控制器的事件的本地HA接管</block>
  <block id="b6ed0cba165f6f9664dc1e57ac3419ec" category="list-text">全面的站点保护—通过将存储和客户端访问从源集群移动到目标集群、快速恢复服务</block>
  <block id="16afcbe8821dfa582521cd62c1ec130d" category="paragraph">这意味着在单个组件发生故障时可以无缝地继续运行、并在更换故障组件后自动恢复为冗余操作。</block>
  <block id="8fab78e8b214cad43d962b802bf568f8" category="paragraph">除单节点集群(通常为软件定义的版本、例如ONTAP Select)之外、所有ONTAP集群都具有称为接管和交还的内置HA功能。集群中的每个控制器都会与另一个控制器配对、形成一个HA对。这些对可确保每个节点在本地连接到存储。</block>
  <block id="83e1749664841043ce8b1e894769a201" category="paragraph">接管是一个自动化过程、其中一个节点接管另一个节点的存储以维护数据服务。相反、恢复过程会恢复正常操作。接管可以是计划内的(例如在执行硬件维护或ONTAP升级时)、也可以是计划外的(因节点崩溃或硬件故障而导致)。</block>
  <block id="0b0403a9258293da1f6a5fc84d24a18e" category="inline-link">HA对管理概述</block>
  <block id="cf654073ce9eb8f38d3f05292ed83cc5" category="paragraph">如果一个站点脱机或作为计划内活动进行站点范围维护、则会使用MetroCluster进行站点切换。另一个站点接管脱机集群的存储资源(磁盘和聚合)的所有权、故障站点上的SVM将联机并在灾难站点上重新启动、从而保留其完整身份、以供客户端和主机访问。</block>
  <block id="823bd5c6c005e340599d915e134d851c" category="summary">VMware vSphere解决方案概述</block>
  <block id="8ba8694e23f6560a60d85c4de549122b" category="section-title">vSphere高可用性</block>
  <block id="15496c3917565cea1f21bbc7e6eba996" category="image-alt">VMSC示意图</block>
  <block id="dcff37ab37f2cb6a72aeb3c30e3ed5aa" category="section-title">主机故障检测</block>
  <block id="73b629afd8ef39d8d0147696412538c8" category="paragraph">根据检测到的故障类型、可能需要对主机上运行的虚拟机进行故障转移。</block>
  <block id="e12cf4015a45ff29f1f84ae1a3ee0390" category="paragraph">在vSphere HA集群中、检测到三种类型的主机故障：</block>
  <block id="4eac346eb6cdd3a1a98ee9bc71ebccaa" category="list-text">故障—主机停止运行。</block>
  <block id="3875a4c584a7715edf4a221ce53d45fc" category="list-text">隔离—主机变为网络隔离。</block>
  <block id="82fba11358d642111efbcf36273159f2" category="list-text">分区-主机与主主机断开网络连接。</block>
  <block id="5f72ceebd161159fe623ff01ac0cf1b4" category="paragraph">主主机监控集群中的从主机。此通信通过每秒交换一次网络检测信号来完成。当主主机停止从从从主机接收这些检测信号时、它会先检查主机活动性、然后再声明主机出现故障。主主机执行的活动性检查用于确定从主机是否正在与某个数据存储库交换检测搏。此外、主主机还会检查该主机是否对发送到其管理IP地址的ICMP ping做出响应、以检测它是仅与其主节点隔离还是与网络完全隔离。它通过对默认网关执行pinging来实现此目的。可以手动指定一个或多个隔离地址、以提高隔离验证的可靠性。</block>
  <block id="5546466ab10e5cbfbc4b286cd60b8b4a" category="section-title">_最佳实践_</block>
  <block id="0456a7ce7bf92fb68980571fdd2defa1" category="paragraph">NetApp建议至少指定两个额外的隔离地址、并且每个地址都是站点本地地址。这将提高隔离验证的可靠性。</block>
  <block id="19c262cd1e1bb07c491e359333f04a29" category="section-title">主机隔离响应</block>
  <block id="620b4ae663a26c98656d1c81bec1a6c2" category="paragraph">在HA启动隔离响应之前、它会首先检查vSphere HA主代理是否拥有包含VM配置文件的数据存储库。否则、主机将不会触发隔离响应、因为没有主节点可重新启动VM。主机将定期检查数据存储库状态、以确定是否由具有主角色的vSphere HA代理声明数据存储库。</block>
  <block id="6bd7b146f345eefac88b336a89aa3754" category="paragraph">如果主机与vSphere HA主主机隔离或分区、并且主主机无法通过检测信号数据存储库或ping进行通信、则可能发生脑裂情况。主节点会声明隔离的主机已停止运行、并在集群中的其他主机上重新启动VM。现在存在脑裂情况、因为虚拟机有两个实例正在运行、其中只有一个实例可以读取或写入虚拟磁盘。现在、可以通过配置虚拟机组件保护(VM Component Protection、VMCP)来避免脑裂情况。</block>
  <block id="df05a421ed8ba49f97f18dc085495ee4" category="section-title">VM组件保护(VMCP)</block>
  <block id="1418d127ee81cc7f3e114029e9ba6856" category="paragraph">vSphere 6中与HA相关的一项增强功能是VMCP。VMCP可针对块(FC、iSCSI、FCoE)和文件存储(NFS)提供增强的保护、使其免受所有路径关闭(APD)和永久设备丢失(PDL)情况的影响。</block>
  <block id="fc35e15d00ef5b037a1a56c77ef3e17c" category="section-title">永久设备丢失(永久设备丢失)(财产和财产</block>
  <block id="6d623de2ea8c5007def6f2349d9ad8b9" category="section-title">所有路径已关闭(APD)</block>
  <block id="f89caca297ba86d190d90ef30c409ccf" category="paragraph">检测到APD情况时、计时器将启动。140秒后、系统将正式声明APD条件、并且设备会标记为APD超时。超过140秒后、HA将开始计算VM故障转移APD延迟中指定的分钟数。指定时间过后、HA将重新启动受影响的虚拟机。您可以根据需要将VMCP配置为以不同方式响应("Disabled (已禁用)"、"VM Events (问题描述事件)"或"Power Off and Restart VM (关闭并重新启动VM)")。</block>
  <block id="580bc3953adcf3e3a20c5497f67f8b2c" category="paragraph">NetApp建议将APD超时后APD恢复的响应配置为已禁用。</block>
  <block id="a067a9a0e98c97f62fba4698bde30edc" category="section-title">适用于NetApp MetroCluster的VMware DRS实施</block>
  <block id="b9e04f46a88c8139fbb91780a2ff9064" category="paragraph">如果为集群创建DRS关联性规则、则可以指定vSphere在虚拟机故障转移期间如何应用该规则。</block>
  <block id="a96c8bab3a450bb828e3093d16f7e32c" category="list-text">VM反关联性规则会强制指定的虚拟机在故障转移操作期间保持分离状态。</block>
  <block id="1fa3a04279011cbc6001c96c0f6f27fb" category="list-text">在故障转移操作期间、VM主机关联性规则会将指定的虚拟机放置在特定主机或已定义主机组的成员上。</block>
  <block id="225e3f7204b6e5bf6cd388af7bb16eb4" category="paragraph">使用VMware DRS中的VM主机关联性规则、可以在站点A和站点B之间进行逻辑隔离、以便VM与配置为给定数据存储库的主读/写控制器的阵列在同一站点的主机上运行。此外、VM主机关联性规则还可以使虚拟机保持在存储本地、从而确保在站点间发生网络故障时虚拟机连接。</block>
  <block id="db03e2255e35df6fa9719c800850c397" category="paragraph">以下是VM主机组和关联性规则的示例。</block>
  <block id="b3c45603f3738ac1e1f8e1e87569c00c" category="section-title">使用NetApp MetroCluster实施VMware存储DRS</block>
  <block id="4669dbcf4d42583b3fae1c79fa228078" category="paragraph">默认情况下、启用了存储DRS的DRS集群会启用存储I/O控制。通过存储I/O控制、管理员可以控制在I/O拥塞期间分配给虚拟机的存储I/O量、这样、在分配I/O资源时、更重要的虚拟机就可以优先于不太重要的虚拟机。</block>
  <block id="f06483bf36a941eebbb2f78a89b6bf68" category="paragraph">存储DRS使用Storage vMotion将虚拟机迁移到数据存储库集群中的不同数据存储库。在NetApp MetroCluster环境中、需要在该站点的数据存储库中控制虚拟机迁移。例如、在站点A的主机上运行的虚拟机A最好在站点A的SVM数据存储库中进行迁移否则、虚拟机将继续运行、但性能会下降、因为虚拟磁盘读/写操作将通过站点间链路从站点B进行。</block>
  <block id="2438f6a80b933cf058ad052d26ac0703" category="paragraph">通过克隆存储对象，您可以快速创建副本以供将来使用，例如配置其他 VM ，备份 / 恢复操作等。</block>
  <block id="1a795345e422d7dbcca8fe38671a9371" category="summary">《VMSC设计和实施准则》。</block>
  <block id="b73deaadc37ea1c7a13ad17af6730c42" category="doc">《VMSC设计和实施准则》</block>
  <block id="3512760e2d3fc1a9dd2116e83bb0cada" category="paragraph">本文档概述了使用ONTAP存储系统的VMSC的设计和实施指南。</block>
  <block id="556669df5b5073ab3d2ddcf638e942d9" category="section-title">NetApp存储配置</block>
  <block id="7f4d4fbe08a8a895671d05c4a82b0c85" category="inline-link">MetroCluster 文档</block>
  <block id="002eb41870df47521a2b59424d251f60" category="inline-link">SnapMirror 业务连续性概述</block>
  <block id="447566f62201eb825a1f6fb7a570873f" category="paragraph">配置MetroCluster后、对其进行管理就像管理传统ONTAP环境一样。您可以使用命令行界面(CLI)、System Manager或Ans得 等各种工具设置Storage Virtual Machine (SVM)。配置SVM后、在集群上创建要用于正常操作的逻辑接口(Logical Interface、Li)、卷和逻辑单元号(Logical Unit Number、LUN)。这些对象将自动通过集群对等网络复制到另一个集群。</block>
  <block id="b5486be95ed9ae2e4681a39cf8fe8041" category="inline-link">一致性组概述</block>
  <block id="57166da54d8751e1ed084f00b3f169e3" category="section-title">创建vSphere HA集群</block>
  <block id="829006223e7bdcfd478d2261f1d5ac40" category="inline-link">如何在docs.vmware.com上的vSphere Client中创建和配置集群</block>
  <block id="2bbae4763835d2e2dd123c1b4b0ae73d" category="paragraph">创建vSphere HA集群是一个多步骤过程、有关详细信息、请参见<block ref="dd51ccd863dd3c9fbca770681f8e68a9" category="inline-link-rx"></block>。简而言之、您必须先创建一个空集群、然后使用vCenter添加主机并指定集群的vSphere HA和其他设置。</block>
  <block id="d50e63b9f70efedde8dc093be8ec12b2" category="inline-link">VMware vSphere Metro Storage Cluster 建议的实践</block>
  <block id="950954623b197b80e3ebb95b0adcc3de" category="paragraph">要配置HA集群、请完成以下步骤：</block>
  <block id="1073102bd8c6cbd17340f2a19043583f" category="list-text">连接到vCenter UI。</block>
  <block id="ebf69ea3a3e34739bde13d589e85ef10" category="list-text">在主机和集群中、浏览到要创建HA集群的数据中心。</block>
  <block id="d8fd85bbc0cd4746e5d80e291696b86c" category="list-text">右键单击数据中心对象、然后选择"New Cluster"(新建集群)。在基础下、确保已启用vSphere DRS和vSphere HA。完成向导。</block>
  <block id="f2c634ca704e26f96be1723db6dda32a" category="image-alt">自动生成的计算机问题描述的屏幕截图</block>
  <block id="f4f59bf1e324854573172ca2b5070d45" category="list-text">选择集群并转到配置选项卡。选择vSphere HA、然后单击编辑。</block>
  <block id="329c69e52a7de6215aa4dbfa19940f2d" category="list-text">在"Host Monitoring"(主机监控)下、选择"Enable Host Monitoring"(启用主机监控)选项。</block>
  <block id="9fc231ac455a53f2fabc59f29ab537ad" category="list-text">仍在故障和响应选项卡上的VM监控下、选择仅VM监控选项或VM和应用程序监控选项。</block>
  <block id="58aea8c81a7e8b8160584574af309fbb" category="list-text">在"Admission Control"(准入控制)下、将HA准入控制选项设置为"Cluster Resource resource"(集群资源预留)；使用50% CPU/MEM。</block>
  <block id="3f059eee365aa5c64c0be1d6dba81d69" category="list-text">选择DRS并单击编辑。</block>
  <block id="7b5f9be03fd1421a9da56c2c7677ad69" category="list-text">除非您的应用程序要求、否则请将自动化级别设置为手动。</block>
  <block id="a8ee10582e28e3623629963a88ff5ec9" category="image-alt">VMSC 3 5.</block>
  <block id="256164bb48582e5267e408f2e67e1939" category="inline-link">docs.vmware.com</block>
  <block id="91fb89f03b846483f7108d3f1bfb0156" category="list-text">启用VM组件保护、请参见<block ref="fc88c93ad20ad804a211f4e6fea63e56" category="inline-link-rx"></block>。</block>
  <block id="d64ed3e9c10229648e069f56e32f4c8e" category="cell">响应</block>
  <block id="f3c1d0e4118d5d9501e1a7aeed19d224" category="cell">主机故障</block>
  <block id="45d583cd5692c76d45e96536edce2a0e" category="cell">重新启动VM</block>
  <block id="1c3a7ae924920b573baede481becd22f" category="cell">主机隔离</block>
  <block id="2e011e74abc75a2823c627b7ee9e22a7" category="cell">具有永久设备丢失(永久设备丢失)的数据存储库</block>
  <block id="49476a1ad365d5f8deb36464de7fe33b" category="cell">关闭并重新启动VM</block>
  <block id="e7bbd35db169028c75e7c8ae655bf6ae" category="cell">所有路径均已关闭的数据存储库(APD)</block>
  <block id="e7480b00a5e3efd904a08ca88804de45" category="cell">子系统不检测信号</block>
  <block id="e8896c595f3effde37ef29d7c6233703" category="cell">重置虚拟机</block>
  <block id="59695df3d45a3a21b8ff0bf57fda6a2b" category="cell">VM重新启动策略</block>
  <block id="a150f56b87fd99bf9bf019f8447ba68b" category="cell">由虚拟机的重要性决定</block>
  <block id="370a480458a8c63a838940f1241e14ee" category="cell">主机隔离响应</block>
  <block id="11f30f9be08cd4f9e500290222ddc552" category="cell">关闭并重新启动VM</block>
  <block id="fb53fafa45c0de9bd41d368c7455c9f1" category="cell">对使用了基于数据存储库的数据存储库的响应</block>
  <block id="d7c3b9f5568eb60f08076b29490afcaf" category="cell">使用APD响应数据存储库</block>
  <block id="423b2d98eae113ae3391aa0b12f11935" category="cell">关闭并重新启动VM (保守)</block>
  <block id="132bbe6dbceb01227dba5ab04db7202b" category="cell">APD的VM故障转移延迟</block>
  <block id="8d15ed7d27d83ed6229a66b1f44b7696" category="cell">3分钟</block>
  <block id="8c7b0644547f0ee3fe537e8ba441566d" category="cell">响应APD恢复并显示APD超时</block>
  <block id="4dea08318b2824f845e9b889a6e17778" category="cell">VM监控敏感度</block>
  <block id="f535a28adc173e28610c129d0dc578ae" category="cell">预设为高</block>
  <block id="83164803a765d1ea1f10d50dfdd26130" category="section-title">配置用于检测信号的存储库</block>
  <block id="22c81b09ec3086b2dce8f68867a221e0" category="paragraph">当管理网络出现故障时、vSphere HA使用数据存储库监控主机和虚拟机。您可以配置vCenter选择检测信号数据存储库的方式。要为数据存储库配置检测信号、请完成以下步骤：</block>
  <block id="64809e5386c9dc53f894f772f27d1b44" category="list-text">在数据存储库检测信号部分中、选择使用指定列表中的数据存储库并根据需要自动完成。</block>
  <block id="fc66ba7317ceb4220dc88aa267db085d" category="list-text">从两个站点中选择要vCenter使用的数据存储库、然后按OK。</block>
  <block id="1d2b14769d080b9214d9e407dfc92a64" category="section-title">配置高级选项</block>
  <block id="a9316d69e5abcfaffc56fc8f5e645412" category="paragraph">如果HA集群中的主机与网络或集群中的其他主机断开连接、则会发生隔离事件。默认情况下、vSphere HA将使用其管理网络的默认网关作为默认隔离地址。但是、您可以为要执行ping操作的主机指定其他隔离地址、以确定是否应触发隔离响应。添加两个可执行ping操作的隔离IP、每个站点一个。请勿使用网关IP。使用的vSphere HA高级设置为"as.isolationaddress"。为此、您可以使用ONTAP或调解器IP地址。</block>
  <block id="eaa1dfe3982e06655ce64e240c139b81" category="paragraph">适用于NetApp MetroCluster的VMware DRS关联</block>
  <block id="e32221c52eb3b0bbeb3ca79aad6c90f6" category="paragraph">在本节中、我们将为MetroCluster环境中每个站点\集群的VM和主机创建DRS组。然后、我们配置VM\Host规则、使VM主机与本地存储资源的关联性保持一致。例如、站点A的VM属于VM组sitea_vm、站点A的主机属于主机组sitea_hosts。接下来、在VM\Host规则中、我们说明site_vm应在sitea_hosts中的主机上运行。</block>
  <block id="5bfa0d712f66aef47f8a2ea582bc0b72" category="list-text">NetApp强烈建议使用规范“*应在组中的主机上运行”，而不是规范“必须在组中的主机上运行”。如果站点A主机发生故障、则需要通过vSphere HA在站点B的主机上重新启动站点A的VM、但后一种规范不允许HA重新启动站点B上的VM、因为这是一条硬规则。前一种规范是一种软规则、在发生HA时会违反该规范、从而实现可用性而非性能。</block>
  <block id="cc6a363013bd2a8c1e05304f1c6abd79" category="inline-link">vSphere监控和性能</block>
  <block id="124de7d2bc72d75be9e481c1cc56ada2" category="section-title">创建DRS主机组</block>
  <block id="0759e9476d3bf1868f88356025adafb2" category="paragraph">要创建特定于站点A和站点B的DRS主机组、请完成以下步骤：</block>
  <block id="a69dff3dd4b284f60243dfd62fa4e57f" category="list-text">在vSphere Web Client中、右键单击清单中的集群、然后选择设置。</block>
  <block id="a130b4af254ead99e9ea83044e54ea1d" category="list-text">单击VM\Host Groups。</block>
  <block id="1bb250fbf1946dd1bd7ad228032f8803" category="list-text">单击添加。</block>
  <block id="62c4d1538f957af2951f2c93ee191d0b" category="list-text">键入组的名称(例如、sitea_hosts)。</block>
  <block id="df22605898fc890edbcb2a126aa202ce" category="list-text">从类型菜单中、选择主机组。</block>
  <block id="57c0028584902f6cee210dcc13bc9745" category="list-text">单击Add、然后从站点A中选择所需主机、然后单击OK。</block>
  <block id="583e6d8c3b1006b0561d4b360e58994f" category="list-text">重复上述步骤、为站点B添加另一个主机组</block>
  <block id="18d0ad44a1e563aaf9f5871e32535a6c" category="list-text">单击确定。</block>
  <block id="154964ee7fc6d3261ec55811b0ff9972" category="section-title">创建DRS VM组</block>
  <block id="40c1eaba5f178f243c57b595b6af4d5e" category="paragraph">要创建特定于站点A和站点B的DRS VM组、请完成以下步骤：</block>
  <block id="9a209a741c26968fc13ed8192523df15" category="list-text">键入组的名称(例如、sitea_VMs.)。</block>
  <block id="f947c7c9f173289b1c2565b3297095f0" category="list-text">从Type菜单中、选择VM Group。</block>
  <block id="40a2a21a084c8d16395113cb79a19ebb" category="list-text">单击添加并从站点A选择所需的VM、然后单击确定。</block>
  <block id="e2e7af699096077fe178ebf021fb2273" category="section-title">创建VM主机规则</block>
  <block id="0a6075f3d3fdbe7c133268face0f5c82" category="paragraph">要创建特定于站点A和站点B的DRS相关性规则、请完成以下步骤：</block>
  <block id="df4f9bcca0ceb7a67ba25d886a18743b" category="list-text">单击VM\Host Rule。</block>
  <block id="876a25c102b5c301814921d1a9c0e625" category="list-text">键入规则的名称(例如、sitea_affinity)。</block>
  <block id="d4b5f57f4e2bd5c357ad9b1fbdc2cf8e" category="list-text">验证是否已选中"Enable Rule (启用规则)"选项。</block>
  <block id="d1169f525bd934df7f1a7e3bcf401997" category="list-text">从类型菜单中、选择虚拟机到主机。</block>
  <block id="77328c16c697ce1d6c036c3f950e7542" category="list-text">选择VM组(例如、sitea_vm)。</block>
  <block id="b36943ce975d4c5c6e9481a4ca396270" category="list-text">选择主机组(例如、sitea_hosts)。</block>
  <block id="32fbcb32cfae9a0656233943c28f7c94" category="list-text">重复上述步骤、为站点B添加另一个VM\Host规则</block>
  <block id="488f70e76f3c9ddf155b693e31c5a1e1" category="paragraph">要为每个站点配置数据存储库集群、请完成以下步骤：</block>
  <block id="1dfbc2b980c0b56a5d9889c6d9a25460" category="list-text">使用vSphere Web Client、浏览到"Storage"(存储)下HA集群所在的数据中心。</block>
  <block id="dfc332b252ad3de167b6a336d7e70d46" category="list-text">右键单击数据中心对象、然后选择"Storage"(存储)&gt;"New Datastore Cluster"(新建数据存储库集群)。</block>
  <block id="829b62dbd6a4923b66591b2bff38ed5b" category="list-text">选择HA集群、然后单击"Next"(下一步)。</block>
  <block id="30fe6cfa0a4c5fb23fccfe149cefc006" category="list-text">选择属于站点A的数据存储库、然后单击下一步。</block>
  <block id="4ea461b22638db4c94aa076d62a2065f" category="list-text">查看选项、然后单击完成。</block>
  <block id="7b79e97caff76847cf350f1197c49953" category="list-text">重复上述步骤以创建站点B数据存储库集群、并验证是否仅选择了站点B的数据存储库。</block>
  <block id="d8f83b09bd6b864f22076c109cfaae66" category="section-title">vCenter Server可用性</block>
  <block id="605b8c1efcf2de9164e5d5425c67bdcd" category="paragraph">您的vCenter Server设备(VCSA)应通过vCenter HA进行保护。通过vCenter HA、您可以在一个主动-被动HA对中部署两个VCSA。每个故障域一个。您可以在上阅读有关vCenter HA的更多信息<block ref="173ca8434bdf39dd0a60efe576d066cd" category="inline-link-rx"></block>。</block>
  <block id="70901a02a148fd2dfc1ff5736f4f5336" category="list-text">将存储网络流量与其他网络分开。可以通过使用专用 VLAN 或单独的存储交换机来实现单独的网络。如果存储网络共享上行链路等物理路径，您可能需要 QoS 或其他上行链路端口来确保带宽充足。请勿将主机直接连接到存储；使用交换机提供冗余路径、并允许VMware HA在没有干预的情况下运行。请参见 <block ref="2d54da766c3f840b00eab5923273fca5" category="inline-link-macro-rx"></block> 适用于追加信息 。</block>
  <block id="59cfc5aaa0678bcb883492b4397c71b8" category="cell">是(ONTAP 9.14.1)</block>
  <block id="a58c81d13cac4e9b37bba2bd7fc3a93d" category="paragraph">VMware行业领先的vSphere虚拟机管理程序可部署为延伸型集群、称为vSphere Metro Storage Cluster (VMSC)。</block>
  <block id="e3224e391e08365c1593c07b9fe99cfa" category="section-title">适用于vSphere环境的持续可用性解决方案</block>
  <block id="d3e911c902a6b066f9c31d471d16fb21" category="paragraph">要在两个站点之间创建VMware HA/DRS集群、需要使用vCenter Server Appliance (VCA)来管理ESXi主机。vSphere管理、vMotion®和虚拟机网络通过两个站点之间的冗余网络进行连接。管理HA/DRS集群的vCenter Server可以连接到两个站点上的ESXi主机、并且应使用vCenter HA进行配置。</block>
  <block id="da76be2bc20d4e043d9a2019b817214f" category="inline-link">如何在vSphere Client中创建和配置集群</block>
  <block id="e02f3e9258a23204655bd512ec53911d" category="paragraph">请参见<block ref="c06ae090600e7aa086edfa28514435e7" category="inline-link-rx"></block> 配置vCenter HA。</block>
  <block id="38910d3dab2318849fd5f1a1dfbe0152" category="inline-link">《VMware存储兼容性指南》</block>
  <block id="838b66b875df1b432ac420a98cba3db6" category="paragraph">如果您需要有关vSphere Metro Storage Cluster设计准则的详细信息、请参阅以下文档：</block>
  <block id="07aaf2aebfd07b8763284018d1ebbf57" category="inline-link">NetApp MetroCluster支持VMware vSphere</block>
  <block id="a4a5fd5b00daf98bd381d80257378acd" category="list-text"><block ref="a4a5fd5b00daf98bd381d80257378acd" category="inline-link-rx"></block></block>
  <block id="c3dc11e39d996a00b095022f4e56583d" category="inline-link">VMware vSphere支持NetApp SnapMirror业务连续性</block>
  <block id="8f675397d9c0ef95aa8b3f0ada9d601a" category="list-text"><block ref="f53214cfd764fa0267c92323be0d7337" category="inline-link-rx"></block> (现在称为SnapMirror活动同步)</block>
  <block id="b553530def78406c0977f70d5e90b9e8" category="list-text">延伸型MetroCluster</block>
  <block id="2d90abe978ed8084d304295ad0a8c8fd" category="list-text">光纤MetroCluster</block>
  <block id="b03023e82bda6a71adc49c4834e3b6ab" category="paragraph">下图展示了延伸型MetroCluster的高层面拓扑图。</block>
  <block id="119be031ef4485d20c7683d291d0e9f6" category="inline-link">MetroCluster 文档</block>
  <block id="ad9122c6d75ebaa024669fde1c0bdfb8" category="paragraph">请参见<block ref="d8a206747dbcec13122724b2aee18957" category="inline-link-rx"></block> 了解MetroCluster的特定设计和部署信息。</block>
  <block id="b47354fcd7d17ab4fbb3283f71677efe" category="paragraph">SnapMirror主动同步也可以通过两种不同的方式进行部署。</block>
  <block id="314084a577b998d8089dff72c98c58b0" category="list-text">非对称</block>
  <block id="b69cd5a82aaf0c524a71d46ec6fdd29c" category="cell">NFS v4.1会话中继需要ONTAP 9.14.1及更高版本</block>
  <block id="d9c9eb44a58ee1ce90daa68527aa8930" category="summary">使用MCC的VMSC的故障情形</block>
  <block id="e7c7574b0826c9074f480de76c889ba8" category="paragraph">以下各节概述了VMSC和NetApp MetroCluster系统的各种故障情形的预期结果。</block>
  <block id="c8a2eebb480fef69e6ed917ea7f7a9d3" category="section-title">单个存储路径故障</block>
  <block id="b99e8e694b032f593bbd01f6205b4a98" category="paragraph">在这种情况下、如果组件(例如HBA端口、网络端口、前端数据交换机端口或FC或以太网缆线)发生故障、ESXi主机会将存储设备的特定路径标记为无活动。如果通过在HB/网络/交换机端口提供故障恢复能力来为存储设备配置多个路径、则ESXi最好执行路径切换。在此期间、虚拟机将保持运行状态、而不会受到影响、因为通过提供存储设备的多个路径、可以确保存储可用性。</block>
  <block id="80fc15dd1deb985234440745e8a78d4c" category="paragraph">在使用NFS/iSCSI卷的环境中、NetApp建议为标准vSwitch中的NFS vmkernel端口至少配置两个网络上行链路、并且在为分布式vSwitch映射NFS vmkernel接口的端口组上配置相同的网络上行链路。NIC绑定可以配置为主动-主动或主动-备用。</block>
  <block id="0c8694e8ef7f8935edbfac605753bc95" category="paragraph">此外、对于iSCSI LUN、必须通过将vmkernel接口绑定到iSCSI网络适配器来配置多路径。有关详细信息、请参阅vSphere存储文档。</block>
  <block id="0fc808fdb968eb089fbc5124c0a8e15a" category="paragraph">在使用光纤通道LUN的环境中、NetApp建议至少配置两个HBA、以确保HHBA/Port级别的故障恢复能力。NetApp还建议配置分区的最佳做法是、为单个目标分区配置单个启动程序。</block>
  <block id="238c3d1c7bf8b5b42237392383a4c7ab" category="paragraph">应使用虚拟存储控制台(VSC)设置多路径策略、因为它会为所有新的和现有的NetApp存储设备设置策略。</block>
  <block id="217811709dfb096c78e73934de01271c" category="section-title">单个ESXi主机故障</block>
  <block id="93bc89a0478478dd84d8159a18f6c1a2" category="image-alt">单个主机故障。</block>
  <block id="15023af3b440b4004f509e961bfe1e30" category="paragraph">在这种情况下、如果ESXi主机发生故障、VMware HA集群中的主节点会检测到主机故障、因为它不再接收网络检测信号。为了确定主机是否确实已关闭或仅为网络分区、主节点会监控数据存储库检测点、如果没有检测点、它会对故障主机的管理IP地址执行屏显操作来执行最终检查。如果所有这些检查均为否定、则主节点会将此主机声明为故障主机、并且在此故障主机上运行的所有虚拟机都会在集群中的无故障主机上重新启动。</block>
  <block id="9a11158d52f71012ae8722b09bf8bf29" category="paragraph">如果已配置DRS VM和主机关联性规则(VM组site_VMs中的VM应运行主机组site_hosts中的主机)、则HA主节点会首先检查站点A上的可用资源如果站点A上没有可用主机、主节点将尝试重新启动站点B主机上的VM</block>
  <block id="7922c92ff860eb0508dc8cc8aae3ffdd" category="paragraph">如果本地站点存在资源限制、则虚拟机可能会在另一站点的ESXi主机上启动。但是、如果将虚拟机迁移回本地站点中任何无故障的ESXi主机时违反了任何规则、则定义的DRS VM和主机关联性规则将会进行更正。如果DRS设置为手动、则NetApp建议调用DRS并应用建议以更正虚拟机放置。</block>
  <block id="387b5a49326be3a47e081682e75e19b4" category="paragraph">在这种情况下、MetroCluster的行为没有变化、所有数据存储库在其各自的站点中仍保持完好。</block>
  <block id="a11ffa7d20dab792fe5aa9c27017493e" category="section-title">ESXi主机隔离</block>
  <block id="17e01652089acd413e26ea89cf98a2b8" category="image-alt">ESXi主机隔离</block>
  <block id="8a4b746274e9d7129602d54434624806" category="paragraph">在这种情况下、如果ESXi主机的管理网络关闭、HA集群中的主节点将不会收到任何检测信号、因此此主机将在网络中隔离。要确定数据存储库是发生故障还是仅被隔离、主节点会开始监控数据存储库检测信号。如果存在、则主节点会声明主机已隔离。根据配置的隔离响应、主机可以选择关闭电源、关闭虚拟机、甚至保持虚拟机处于打开状态。隔离响应的默认间隔为30秒。</block>
  <block id="a070f7923919fed39772c5d3f91bf482" category="section-title">磁盘架故障</block>
  <block id="4f90d34a41c7ebc83024a5e3ca35ff3a" category="image-alt">单个磁盘架故障。</block>
  <block id="1c872dcd4bcebb1d7567f383901dfc0d" category="section-title">单个存储控制器故障</block>
  <block id="68badb604dbd29653979fdc7083cbffe" category="paragraph">在这种情况下、一个站点上的两个存储控制器之一发生故障。由于每个站点都有一个HA对、因此一个节点发生故障会透明地自动触发故障转移到另一个节点。例如、如果节点A1发生故障、其存储和工作负载将自动传输到节点A2。虚拟机不会受到影响、因为所有的plexes都保持可用。第二个站点节点(B1和B2)不受影响。此外、vSphere HA不会执行任何操作、因为集群中的主节点仍将接收网络检测信号。</block>
  <block id="0ac25682ea568511724f2e0819127d89" category="image-alt">单节点故障</block>
  <block id="e7b4c0523308b3fd46189b6ab4867fe5" category="paragraph">如果故障转移是滚动灾难的一部分(节点A1故障转移到A2)、则在后续发生A2故障或站点A完全故障时、站点B可能会发生灾难后切换</block>
  <block id="7b590b52d9f3d4d40cda67758ff92ba1" category="section-title">交换机间链路故障</block>
  <block id="9df08f82abe35d87c6f7c96b18dab755" category="section-title">管理网络发生交换机间链路故障</block>
  <block id="ed0711cbc7a050952e0e370bab079bff" category="image-alt">管理网络发生交换机间链路故障</block>
  <block id="a32c6c77bb8d407cf5825aec175bab4b" category="paragraph">在这种情况下、如果前端主机管理网络的ISL链路发生故障、站点A的ESXi主机将无法与站点B的ESXi主机进行通信这将导致网络分区、因为特定站点上的ESXi主机将无法向HA集群中的主节点发送网络检测点。因此、由于分区、会有两个网段、每个网段中都有一个主节点、用于保护VM免受特定站点中主机故障的影响。</block>
  <block id="628309883a8d1307131d205b200c56ae" category="section-title">存储网络发生交换机间链路故障</block>
  <block id="a9da7e2a43bcea673a22b949355e619d" category="image-alt">存储网络发生交换机间链路故障</block>
  <block id="625db96c5ee1e9b5197b6cb3c1715021" category="paragraph">在这种情况下、如果后端存储网络上的ISL链路发生故障、站点A的主机将无法访问站点B上集群B的存储卷或LUN、反之亦然。定义了VMware DRS规则、以便主机-存储站点关联性有利于虚拟机在站点内运行而不会受到影响。</block>
  <block id="8d9609f32cbee8fa5080f95d71a2a142" category="paragraph">在此期间、虚拟机会在其各自的站点上保持运行状态、并且在此情形下、MetroCluster的行为没有变化。所有数据存储库在其各自的站点中仍保持完好。</block>
  <block id="719831bfdda20be14c04e2b165cce85e" category="paragraph">如果出于某种原因违反了相关性规则(例如、VM1本应从站点A运行、而其磁盘位于本地集群A节点上、但却在站点B的主机上运行)、则可以通过ISL链路远程访问虚拟机的磁盘。由于ISL链路故障、在站点B上运行的VM1将无法向其磁盘写入数据、因为存储卷的路径已关闭、并且该特定虚拟机已关闭。在这些情况下、VMware HA不会执行任何操作、因为主机正在主动发送检测信号。这些虚拟机需要在其各自的站点中手动关闭和启动。下图显示了违反DRS关联性规则的虚拟机。</block>
  <block id="09ba89b1ea49214c15fbf8ea6f129cb0" category="image-alt">违反DRS相关性规则的VM无法在ISL出现故障后写入磁盘</block>
  <block id="49f26967af2ad76cacf7888cbeeb0590" category="section-title">所有交换机间故障或完整数据中心分区</block>
  <block id="bc331d84348670dff6731555166fa378" category="paragraph">在此场景中、两个站点之间的所有ISL链路均已关闭、并且两个站点彼此隔离。如前文所述(例如、管理网络和存储网络出现ISL故障)、虚拟机不会在完全ISL故障时受到影响。</block>
  <block id="3543d47d1f3a8dc6989a32f62ce3ea77" category="image-alt">ISL全部发生故障或数据中心分区完整</block>
  <block id="3a096ef571101010add81b37081d3276" category="paragraph">NetApp建议确定是否有任何虚拟机违反了DRS规则。从远程站点运行的任何虚拟机都将关闭、因为它们将无法访问数据存储库、vSphere HA将在本地站点上重新启动该虚拟机。ISL链路恢复联机后、远程站点上运行的虚拟机将被终止、因为不能存在两个使用相同MAC地址运行的虚拟机实例。</block>
  <block id="87e9384cb464ff9a4ce385fc59a178a2" category="image-alt">VM1违反DRS关联性规则的数据中心分区</block>
  <block id="0951e388ebea20c49e71af25ef84947d" category="section-title">NetApp MetroCluster中的两个网络结构上的交换机间链路均出现故障</block>
  <block id="715cbc6f6bcf5da6b73f10233847d3a1" category="paragraph">在所有ISL关闭后发生的任何写入操作都不会镜像到另一站点。因此、如果在配置处于此状态时发生灾难切换、则会丢失未同步的数据。在这种情况下、需要手动干预才能在切换后进行恢复。如果很可能在很长时间内不会有任何可用的CRL、则管理员可以选择关闭所有数据服务、以避免在发生灾难时需要切换时数据丢失的风险。在至少有一个ISL可用之前、应权衡执行此操作与发生灾难时需要切换的可能性。或者、如果在级联情形下、CRL发生故障、管理员可以在所有链路发生故障之前触发到某个站点的计划内切换。</block>
  <block id="89f375bfe8be0893bf175b89ce754b8e" category="image-alt">NetApp MetroCluster中两个网络结构上的交换机间链路故障。</block>
  <block id="bc813a6fdbbeebf4d230b7e33d8c3a76" category="section-title">对等集群链路故障</block>
  <block id="77130a0b52e4379c6b6667cf7f8e155c" category="image-alt">对等集群链路故障</block>
  <block id="9dc32d7afddc9a265c5c2713db55fc70" category="section-title">站点完全瘫痪</block>
  <block id="d0d6a03c382bc5412f1822e5c97d5142" category="paragraph">在完整站点A发生故障的情况下、站点B的ESXi主机无法从站点A的ESXi主机获取网络检测信号、因为它们已关闭。站点B的HA主节点将验证数据存储库检测点是否不存在、并声明站点A的主机出现故障、然后尝试在站点B中重新启动站点A虚拟机在此期间、存储管理员将执行切换以恢复运行正常的站点上故障节点的服务、从而恢复站点B上站点A的所有存储服务当站点A的卷或LUN在站点B上可用后、HA主代理将尝试在站点B中重新启动站点A的虚拟机</block>
  <block id="23e5761401326cc21bcf9d108b9e3e7f" category="paragraph">如果vSphere HA主代理尝试重新启动虚拟机(包括注册虚拟机并打开虚拟机电源)失败、则会在出现延迟后重试重新启动。重新启动之间的延迟最长可配置为30分钟。vSphere HA尝试这些重新启动的次数最多(默认为六次)。</block>
  <block id="085a4a3eba6c30fa589bfee20eb0c294" category="paragraph">如果站点A已切换、则可以通过故障转移到运行正常的节点来无缝处理其中一个运行正常的站点B节点的后续故障。在这种情况下、四个节点的工作现在仅由一个节点执行。在这种情况下、恢复将包括向本地节点执行一次恢复。然后、在还原站点A后、将执行切回操作以还原配置的稳定状态操作。</block>
  <block id="2b9b713afb0d80ef371a0b55e58366b6" category="image-alt">站点完全瘫痪</block>
  <block id="e6364c2f5314a32cd95be04b4c2112e6" category="paragraph">以下各节概述了将VMware vvol与ONTAP存储结合使用的过程和最佳实践。</block>
  <block id="a9da618400fb93b20c20f5343efaefa7" category="sidebar">采用ONTAP的VMware vSphere Metro Storage Cluster</block>
  <block id="2f58fa882a22b5af5f0741f03abaf611" category="sidebar">采用ONTAP的vSphere Metro存储集群</block>
  <block id="4a884da785a62e8b1758932191ff42de" category="paragraph">对于选择使用虚拟化来管理任务关键型数据库的NetApp客户来说、使用VMware、Oracle OLVM或KVM实现数据库虚拟化的做法越来越普遍。</block>
  <block id="3a8ba1ff8824968961222d6b447b4973" category="section-title">可支持性</block>
  <block id="3231d83af741101eb02b16e5d7a6dffc" category="paragraph">对于Oracle虚拟化支持策略、尤其是VMware产品支持策略、存在许多误解。听说Oracle完全不支持虚拟化、这种情况并不少见。这一概念是不正确的、会导致错失从虚拟化中获益的机会。Oracle文档ID 249212.1讨论了实际要求、客户很少考虑这些要求。</block>
  <block id="722bd611ee4f38780607b400c8a604c0" category="paragraph">如果虚拟化服务器上出现问题、而Oracle支持先前并不知道该问题、则可能会要求客户在物理硬件上重现该问题。运行尖端产品版本的Oracle客户可能不想使用虚拟化、因为可能会出现可支持性问题、但对于使用通用Oracle产品版本的虚拟化客户来说、这种情况并不是现实情况。</block>
  <block id="c8a4476ecddeda66dbd2c354c8fb2c6b" category="paragraph">考虑将数据库虚拟化的客户应根据业务需求制定存储决策。虽然这对于所有IT决策来说都是一个普遍正确的说法、但对于数据库项目来说尤其重要、因为要求的大小和范围差别很大。</block>
  <block id="835ce293f862d9fb74e50f4cf928c56d" category="paragraph">存储表示有三个基本选项：</block>
  <block id="327813abbc0ae1e9d3abe282303bf00c" category="list-text">虚拟机管理程序数据存储库上的虚拟化LUN</block>
  <block id="1a1af5efffda8c766ead9f73fc782e0e" category="list-text">虚拟机挂载的NFS文件系统(而不是基于NFS的数据存储库)</block>
  <block id="f9bf9489147891f7ee7ba15126a27fda" category="list-text">直接设备映射。客户不喜欢VMware VMM、但物理设备通常仍与KVM和OLVM虚拟化直接映射。</block>
  <block id="69b0ac6bf6ea8e1ab4e4fc896294da01" category="paragraph">向虚拟化子系统提供存储的方法通常不会影响性能。主机操作系统、虚拟化网络驱动程序和虚拟机管理程序数据存储库实施均经过高度优化、只要遵循基本最佳实践、通常可以占用虚拟机管理程序与存储系统之间的所有可用FC或IP网络带宽。在某些情况下、使用一种存储表示方法可能比使用另一种存储表示方法更容易获得最佳性能、但最终结果应该是可比的。</block>
  <block id="a2e8fb5328f6558e3a119d8c224a1897" category="paragraph">决定如何向虚拟化子系统提供存储的关键因素是可管理性。方法没有对错之处。最佳方法取决于IT运营需求、技能和偏好。</block>
  <block id="e4919ac0a074fa1bba5303f596a5f591" category="paragraph">需要考虑的因素包括：</block>
  <block id="c422e10bbf04c180f4c47f81ed9a1f7a" category="list-text">*Transparency。*当VM管理其文件系统时，数据库管理员或系统管理员可以更轻松地确定其数据的文件系统源。访问文件系统和LUN的方式与使用物理服务器相同。</block>
  <block id="42de52ad09be3101fc535dea2aedce1d" category="list-text">*一致性。*如果虚拟机拥有其文件系统、则使用或不使用虚拟机管理程序层会影响易管理性。配置、监控、数据保护等过程同样适用于整个资产、包括虚拟化和非虚拟化环境。</block>
  <block id="0562446bc5eefe9a584e23ffb3061cbf" category="paragraph">另一方面、在完全虚拟化的数据中心中、根据上述相同的原理(一致性、使用相同的配置、保护、监控和数据保护过程的能力)、在整个占用空间中使用基于数据存储库的存储可能更好。</block>
  <block id="7269a37b557c66664c0377693f62ec8a" category="list-text">*稳定性和故障排除。*当虚拟机拥有其文件系统时、由于虚拟机上存在整个存储堆栈、因此提供良好、稳定的性能和解决问题会更加简单。虚拟机管理程序的唯一角色是传输FC或IP帧。如果配置中包含数据存储库、则会引入另一组超时、参数、日志文件和潜在错误、从而使配置复杂。</block>
  <block id="c160b6d86853c20a432e2407b82866e6" category="list-text">*受制于供应商。*将数据放入数据存储库后、使用不同的虚拟机管理程序或将数据完全从虚拟化环境中取出将变得非常困难。</block>
  <block id="a42abd01a1e0c89cfa2112dc09378967" category="list-text">*启用Snapshot。*由于带宽相对有限、虚拟化环境中的传统备份过程可能会成为一个问题。例如、四端口10GbE中继可能足以满足许多虚拟化数据库的日常性能需求、但此类中继不足以使用RMAN或其他需要流式传输完整大小数据副本的备份产品执行备份。因此、日益整合的虚拟化环境需要通过存储快照执行备份。这样、无需纯粹为了满足备份窗口中的带宽和CPU要求而过度构建虚拟机管理程序配置。</block>
  <block id="86c36175331b4a95c083fabdcca8b8a0" category="paragraph">使用子系统拥有的文件系统有时可以更轻松地利用基于快照的备份和还原、因为需要保护的存储对象可以更轻松地确定目标。但是、越来越多的虚拟化数据保护产品能够与数据存储库和快照完美集成。在决定如何将存储提供给虚拟化主机之前、应充分考虑备份策略。</block>
  <block id="8c19dda4c4cab5e52edf9463f196b97d" category="section-title">数据存储库条带化</block>
  <block id="8fa77493c52e71f201ccdb67db26446d" category="paragraph">将数据库与数据存储库结合使用时、需要考虑一个与性能相关的关键因素—条带化。</block>
  <block id="53ab623a905e6ec84d908f0b99a8d1c8" category="paragraph">VMFS等数据存储库技术可以跨越多个LUN、但它们不是条带化设备。这些LUN会串联在一起。最终结果可能是LUN热点。例如、典型的Oracle数据库可能具有一个8-LUN ASM磁盘组。所有8个虚拟化LUN均可配置在一个8 LUN VMFS数据存储库上、但无法保证数据将驻留在哪些LUN上。得到的配置可能是所有8个虚拟化LUN都占用VMFS数据存储库中的一个LUN。这将成为性能瓶颈。</block>
  <block id="e6bb99e411f5495b03c1e0a4e75a1434" category="paragraph">通常需要条带化。对于某些虚拟机管理程序(包括KVM)、可以按所述使用LVM条带化来构建数据存储库 <block ref="dd0ff2598ebb26feb9ff73a59186b79f" category="inline-link-macro-rx"></block>。使用VMware时、架构看起来略有不同。每个虚拟化LUN都需要放置在不同的VMFS数据存储库上。</block>
  <block id="506c2c0c7f5b70af3df68c45c46f45a7" category="paragraph">例如：</block>
  <block id="6ec151851a31c86edd358bc49f80908c" category="paragraph"><block ref="6ec151851a31c86edd358bc49f80908c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="70ff2667d6b190dea65bae42217aa310" category="paragraph">这种方法的主要驱动因素不是ONTAP、这是因为一个虚拟机或虚拟机管理程序LUN可并行处理的操作数存在固有限制。一个ONTAP LUN支持的IOPS通常远远超过主机可以请求的IOPS。单个LUN性能限制几乎是主机操作系统的结果。因此、大多数数据库需要4到8个LUN才能满足其性能需求。</block>
  <block id="59f9d8d1b212a8ff6bd3476975e17620" category="paragraph">VMware架构需要仔细规划其架构、以确保此方法不会遇到数据存储库和/或LUN路径最大值。此外、对于每个数据库、不需要一组唯一的VMFS数据存储库。主要需求是确保每个主机都有一组从虚拟化LUN到存储系统本身上后端LUN的干净的4到8 IO路径。在极少数情况下、即使数据存储库数量更多、也可能有利于满足真正的极致性能需求、但所有数据库中通常有95%的数据库需要使用4到8个LUN。在典型的OS/ONTAP /网络配置下、包含8个LUN的单个ONTAP卷最多可支持250、000次随机Oracle块IOPS。</block>
  <block id="7564f732469e12963d8b416572cf4efb" category="section-title">什么是vSphere Metro Storage Cluster？</block>
  <block id="830d984ea50f71fa76636d0524167a3a" category="doc">vSphere数据存储库和协议功能概述</block>
  <block id="cc0f7f705e4495c607aea288505e31bf" category="sidebar">VMSC概述</block>
  <block id="de9a829f775bc333b77fdacbc333f7a1" category="sidebar">vSphere HA解决方案</block>
  <block id="70b29c8dabeb7a16884003c35e163f96" category="sidebar">VMSC设计</block>
  <block id="6c4755219197ce467bf892a552c8663a" category="sidebar">VMSC故障恢复能力</block>
  <block id="13376e3e9b02a56731aa64aeb10947b2" category="sidebar">使用MCC的VMSC场景</block>
  <block id="f0a36f02b824ef55cbd63aa2700a4ec9" category="summary">基于Oracle数据库快照的备份和恢复</block>
  <block id="77243afc69ab08d8277d0e23dda813d9" category="doc">Oracle数据库联机备份</block>
  <block id="4ac7e99e454283880f5bdf93e9d59eb9" category="summary">Oracle数据库完整文件FabricPool层</block>
  <block id="3dd6786160916127fc2f6fc2ec955bbe" category="summary">具有ONTAP零块检测功能的ASM Recasation Utility</block>
  <block id="89c60635365825dfa13d154785577592" category="summary">Oracle和TCP/IP以及以太网配置</block>
  <block id="aaa024a70ffabce1e14fdc1a4b17fe8d" category="doc">Oracle数据库的TCP/IP和以太网配置</block>
  <block id="665de76ea0059ac13982f04e19e74216" category="summary">使用Microsoft Windows的Oracle数据库</block>
  <block id="0d4fbbc8820271a0ce5d46a15e7bf90f" category="paragraph">使用ONTAP在Microsoft Windows上配置Oracle数据库主题。</block>
  <block id="422956aac4f76239935ded6a492144f2" category="summary">ONTAP专为Oracle数据库而设计。了解详情！</block>
  <block id="795da6575a33e265d7d9a5774cd10e6f" category="summary">基于ONTAP的Oracle数据库的一致性组备份</block>
  <block id="33c729820ffa60f55745fa3c259e273c" category="doc">Oracle数据库一致性组备份</block>
  <block id="56abf0735f338713ce53e8cdecd6994e" category="paragraph">要进行最简单的备份、只需将整个Oracle数据库放在一个ONTAP卷中即可</block>
  <block id="190d2bad1c6e231bc18c33e002e663c7" category="summary">Oracle数据库和直连ONTAP连接</block>
  <block id="4a3f422632f7d08bf0e6c05affea24e4" category="summary">采用SyncMirror的Oracle数据库</block>
  <block id="5bbdf1e19bb3f7b70de51a3764fc5f19" category="doc">Oracle数据库存储Snapshot优化备份</block>
  <block id="a962af081661ee46d4ef879de33c841e" category="paragraph">在Oracle 12c发布后、基于Snapshot的备份和恢复变得更加简单、因为无需将数据库置于热备份模式。因此、可以直接在存储系统上计划基于快照的备份、同时仍保留执行完整或时间点恢复的能力。</block>
  <block id="fdf9dde4dc297fff7ac7b3c1458b0dad" category="doc">使用Oracle数据库进行LVM条带化</block>
  <block id="d3c8171a7167ce43c547aac8fdd86cfb" category="doc">Oracle数据文件迁移</block>
  <block id="9718528cb14225785c79e3afc4152efc" category="doc">Oracle数据库LUN大小调整和LUN计数</block>
  <block id="ea7df930bd6bec6222e23d2b3af02a50" category="paragraph">SnapMirror主动同步支持两种类型的存储故障转移操作：计划内和计划外、其工作方式略有不同。管理员手动启动计划内故障转移、以便快速切换到远程站点、而计划外故障转移则由第三个站点上的调解器自动启动。计划内故障转移的主要目的是执行增量修补和升级、执行灾难恢复测试或采用一种正式策略、全年在站点之间切换操作、以证明完全的活动同步功能。</block>
  <block id="f7c8b0ba16967990d91c2ca78d655eaa" category="paragraph">这些图显示了在正常操作、故障转移和故障恢复操作期间发生的情况。为便于说明、它们显示了一个复制的LUN。在实际的SnapMirror活动同步配置中、复制基于卷、其中每个卷包含一个或多个LUN、但为了简化情况、卷层已被删除。</block>
  <block id="cfa86460b638615878bbee89b1b6d4c7" category="paragraph">绿线是活动路径、但可能会产生较长的延迟、因为该路径上的IO需要通过SnapMirror活动同步路径传递。额外的延迟取决于用于SnapMirror活动同步的站点之间的互连速度。</block>
  <block id="22ea45ef5d49a1b807d571799d80613d" category="paragraph">源系统恢复使用后、SnapMirror活动同步可以重新同步复制、但运行的方向相反。现在、配置与起始点基本相同、只是已翻转主动镜像站点。</block>
  <block id="2702e101c97ce9a58738b1a4089319df" category="summary">MetroCluster逻辑架构和Oracle数据库</block>
  <block id="784fdd6bf0ebb9c00eaefafc3f9a9cee" category="doc">RAID和Oracle数据库</block>
  <block id="204d288bf0e9d1ee9912d68d6282d7a9" category="summary">采用AIX的Oracle数据库</block>
  <block id="90b3697759466f587c318ce55df76258" category="doc">使用IBM AIX的Oracle数据库</block>
  <block id="14ab10a24aa8f6c18bfdfd0d8a394dcb" category="paragraph">使用ONTAP的IBM AIX上的Oracle数据库的配置主题。</block>
  <block id="b67d277a8a8f29f7b869c9bdbff5fcd1" category="summary">Oracle数据库和FabricPool检索策略</block>
  <block id="2e34d4efdcf01f27eb9407a010ca1621" category="summary">使用FLI迁移Oracle—转换</block>
  <block id="c5753b0ef1dfc2c724f24235a689d1ab" category="summary">Oracle数据库FabricPool分层策略</block>
  <block id="57d15767e9302dbb67058ed0bd9eebac" category="doc">Oracle数据库和NVFAIL</block>
  <block id="4f03272fa32b53344924740fd30fc52d" category="summary">Oracle数据库与Solaris</block>
  <block id="206960915d76763c590449d5ef03639a" category="summary">基于ONTAP的Oracle数据库和快照的角色</block>
  <block id="4bc550014af4fefad8f4cc8f0827c4b5" category="doc">Oracle数据库和基于快照的备份</block>
  <block id="cf5bc9d838fb937caa7978b4a9b0f98a" category="paragraph">基于ONTAP的Oracle数据库数据保护的基础是NetApp Snapshot技术。</block>
  <block id="ba5a23e78f51c1bcb1b82efbe1797502" category="summary">Oracle数据库参数—db_file_multiblock_read_count</block>
  <block id="ea84db84607112a0d40fca3ff45dfffa" category="summary">使用ONTAP QoS进行Oracle数据库性能管理</block>
  <block id="0af83eb081b1a831789867d7f0867610" category="summary">Oracle数据库管理和自动化工具</block>
  <block id="7c58d5a62a9c29d2a846b210deea95f2" category="paragraph">ONTAP在Oracle数据库环境中的主要价值来自核心ONTAP技术、例如即时Snapshot副本、简单的SnapMirror复制以及高效创建FlexClone卷。</block>
  <block id="591b3149d6cb247a04883c411dab3e24" category="summary">校验和和和和Oracle数据库完整性</block>
  <block id="56f014c6fc8fac3e242c9d2e42c654c0" category="paragraph">ONTAP及其支持的协议包括多项功能、可保护Oracle数据库完整性、包括空闲数据和通过网络传输的数据。</block>
  <block id="31b3368edcb737b712ee02926409c837" category="doc">Oracle数据库、MetroCluster和NVFAIL</block>
  <block id="490e2f530e53cf85f8ce9b052a8336ec" category="paragraph">NVFAIL是ONTAP中的一项通用数据完整性功能、旨在最大限度地提高数据库的数据完整性保护。</block>
  <block id="f2cf6b943d224a732c92223538580ee9" category="doc">基于MetroCluster的Oracle单实例</block>
  <block id="ea1d91c32fcf0f4a1090fd0da341c014" category="paragraph">与其他存储灾难恢复解决方案不同、SnapMirror主动同步可提供非对称平台灵活性。每个站点的硬件不必相同。通过此功能、您可以调整用于支持SnapMirror活动同步的硬件的大小。如果需要支持完整的生产工作负载、远程存储系统可以与主站点完全相同；但是、如果灾难导致I/O减少、则与远程站点上较小的系统相比、可能会更经济高效。</block>
  <block id="3873b13983c66ae61dd877b0443a3828" category="summary">Oracle数据库和一致性组灾难恢复</block>
  <block id="ede2d3fcaec1bb9dcda5a75c90f37368" category="summary">借助基于ONTAP的Oracle数据库最大限度地提高可用性</block>
  <block id="9688c9c1c1d15e2f91a3a5b8e5f14bd4" category="doc">使用ONTAP可获得Oracle数据库</block>
  <block id="44e95a6c3878f189a550b4c0314d3b33" category="paragraph">NetApp知道、数据库中的任务关键型数据最多。</block>
  <block id="7aa93b5fc17b83fc9e4816155f8f59ab" category="summary">Oracle数据库性能测试</block>
  <block id="0b3a030b64747fb3830c79e1ffbef7ee" category="summary">Oracle数据库和对象存储访问中断</block>
  <block id="99a1755be2504777b7e266ed14b33168" category="doc">Oracle数据库和ONTAP控制器故障转移/切换</block>
  <block id="8dbb58cb7fbd4c7db3f14b9674e7d4e6" category="summary">借助SnapRestore快速恢复Oracle数据库</block>
  <block id="fd0d4a1100bcbce28e8252537f7c4ef4" category="summary">Oracle数据库数据保护SLA</block>
  <block id="48130805e35d0c7ab5afbcb71abb1ad0" category="doc">Oracle数据库RTO、RPO和SLA规划</block>
  <block id="f359cd007fda575e70269cac76fab4af" category="paragraph">借助ONTAP、您可以根据业务需求轻松定制Oracle数据库数据保护策略。</block>
  <block id="05f9f35345d8f2164958f3b6b7098fa7" category="summary">Oracle部分文件FabricPool分层</block>
  <block id="48e2495d3eeb1b57ea7d073e06620063" category="doc">通过日志传送实现Oracle数据库迁移</block>
  <block id="2cba4042f0a43491e4ea8f14238ae6e4" category="summary">Oracle和FabricPool快照层</block>
  <block id="6f7b1d0f996b7d49f60586ce7fbeca36" category="doc">采用FabricPool快照层的Oracle</block>
  <block id="35b12c67685c33721c1a59e8b736fd61" category="summary">Oracle数据库的NFS缓存</block>
  <block id="1404b2da267c376dac716bd5455f4ff3" category="summary">使用FLI迁移Oracle—协议转换</block>
  <block id="c37c1629ee55e6d553c16bbab86adbde" category="doc">将Oracle数据库迁移到ONTAP存储系统</block>
  <block id="f1d34b6e878aac7179a735d301e4fb76" category="paragraph">利用新存储平台的功能有一个不可避免的要求：必须将数据放置在新存储系统上。ONTAP简化了迁移过程、包括ONTAP到ONTAP的迁移和升级、外部LUN导入以及直接使用主机操作系统或Oracle数据库软件的过程。</block>
  <block id="b7433f552fcf8a4e34f2ccc357037d4e" category="doc">Oracle数据库主机数据复制</block>
  <block id="1cede70bc6077ecbac9a77b03d1bc6e1" category="summary">针对Oracle数据库的数据保护规划</block>
  <block id="e2bc0913921cafeb725765069883b685" category="paragraph">正确的Oracle数据库数据保护架构取决于数据保留、可恢复性以及各种事件期间中断容错能力方面的业务要求。</block>
  <block id="c0b79db5f258f0c991a383cbdbf001dd" category="inline-link-macro">SnapMirror活动同步</block>
  <block id="8a05777f407870cbc2668230c8117503" category="summary">使用Linux和ASMlib/ASM筛选器驱动程序的Oracle数据库</block>
  <block id="494900ae2c2cdb5abdba3806f4dfaeb0" category="doc">使用ASMLi/AFD的Oracle数据库(ASM筛选器驱动程序)</block>
  <block id="afae47e326854c63cbc85989720416e0" category="summary">使用FLI迁移Oracle—规划</block>
  <block id="85cef7bf4ac9d983cf8e1e11785eeef1" category="summary">使用FLI迁移Oracle—完成</block>
  <block id="0c5284e14535835121effc8afb702b28" category="summary">使用ONTAP进行Oracle数据库灾难恢复</block>
  <block id="2ba21d57ee7f1d78a405b9e80c6aaf6b" category="paragraph">对于大多数客户而言、灾难恢复不仅需要拥有远程数据副本、还需要能够快速利用这些数据。NetApp提供了两种技术来满足这一需求—MetroCluster和SnapMirror主动同步</block>
  <block id="107bcc34799abe752a088be24869419c" category="paragraph">SnapMirror活动同步基于SnapMirror同步。通过MetroCluster、每个ONTAP控制器都负责将其驱动器数据复制到远程位置。使用SnapMirror主动同步时、您实际上拥有两个不同的ONTAP系统、它们会维护LUN数据的独立副本、但会相互协作、为该LUN提供一个实例。从主机角度来看、它是一个LUN实体。</block>
  <block id="50ae143b75fc238e91c09c750cf211c1" category="summary">Oracle数据库参数—filesystemio_options</block>
  <block id="cf451e0aed3c944d3f1c761387762e56" category="summary">使用Linux的Oracle数据库</block>
  <block id="e712ed441aacc4eeecb5656d5493c99c" category="summary">使用HP-UX的Oracle数据库</block>
  <block id="c36ae718fe9d7978c8781b19d0b3dee0" category="paragraph">使用ONTAP在HP-UX上配置Oracle数据库主题。</block>
  <block id="45df37151f6a0fd8a3b55d0423459f82" category="doc">Oracle数据库I/O的LUN对齐</block>
  <block id="857a8adc9eda2d9e197a52323daca558" category="doc">Oracle数据库FabricPool层概述</block>
  <block id="fd73b1ca3b942a1514078a7e59c7433b" category="summary">Oracle数据库和过时的NFSv3锁定</block>
  <block id="102aeb54bf1a69403672f53090c52878" category="summary">通过日志传送实现Oracle数据库灾难恢复</block>
  <block id="d470f5db851ef84aaa776600805af48b" category="summary">Oracle数据库虚拟化简介</block>
  <block id="b8fc1174bb3f1c65475334182829f75e" category="doc">Oracle数据库虚拟化</block>
  <block id="b1b3f70e4333a9dbda75a98ceb78db39" category="summary">MetroCluster物理架构和Oracle数据库</block>
  <block id="250bce9fbefc7872908d9c2708fc753b" category="doc">Oracle数据库备份层</block>
  <block id="4fbe2d000cdf5390ca980149d98eec4d" category="summary">Oracle数据库迁移规划</block>
  <block id="d11e22f56fe0c9dd85597038a25cd80d" category="doc">Oracle数据库和存储容量管理</block>
  <block id="1234e92308935cf0a5a22541f312c541" category="summary">采用SnapMirror和SyncMirror的Oracle数据库</block>
  <block id="a4cdac841b6453db2f51ce52a1303209" category="paragraph">SnapMirror复制和中断的CG SnapMirror关系可保持卷之间的一致性、而SnapMirror同步和SnapMirror活动同步则可保持成分卷之间的一致性。</block>
  <block id="454ff7e5f4a8d37cf6b16b804deca2b6" category="summary">Oracle数据库块大小</block>
  <block id="eed7df980a6ae17f8e0fecdecf0e25f4" category="doc">Oracle迁移操作步骤示例脚本</block>
  <block id="fac6d6b61dd6bd3ee73d5b425bc5a3b7" category="doc">使用Oracle数据库进行精简配置</block>
  <block id="35ebaedc3385b350dff13e0cfa869c9f" category="summary">Oracle RAC超时</block>
  <block id="710cf627a103721a0452cb72494ea742" category="admonition">有关存储效率与预留百分比之间交互的说明、请参见以下有关精简配置的章节。</block>
  <block id="8bc1cc1880ea3a623cb9b80b8cbb7b72" category="paragraph">数据压缩方法有多种。许多数据库都具有自己的数据压缩功能、但在客户环境中很少出现这种情况。原因通常是对压缩数据*进行更改*会对性能造成影响、此外、对于某些应用程序、数据库级数据压缩的许可成本较高。最后、还会对数据库操作产生整体性能影响。为执行数据压缩和解压缩的CPU支付较高的每CPU许可证成本毫无意义、而不是实际的数据库工作。更好的选择是将压缩工作负载分流到存储系统。</block>
  <block id="3e98696b9bb83904c14603458a8c3728" category="admonition">自适应数据压缩使用的块大小最多可以增加到32 KB。这可能会提高存储效率、对于事务日志和备份文件等不活动的文件、如果阵列上存储了大量此类数据、则应考虑使用此方法。在某些情况下、使用16 KB或32 KB块大小的活动数据库也可以通过增加要匹配的自适应数据压缩的块大小来受益。请咨询NetApp或合作伙伴代表、了解这是否适合您的工作负载。</block>
  <block id="0e6f69b7cb8364ed908c411686154808" category="admonition">在流式备份目标上、不应同时使用大于8 KB的数据压缩块大小和重复数据删除。原因是、对备份的数据所做的微小更改会影响32 KB数据压缩窗口。如果窗口发生变化、则生成的压缩数据会在整个文件中有所不同。重复数据删除在数据压缩后进行、这意味着重复数据删除引擎对每个压缩备份的看法不同。如果需要对流式备份进行重复数据删除、则只应使用8 KB块自适应数据压缩。最好使用自适应数据压缩、因为它的块大小较小、不会影响重复数据删除的效率。出于类似的原因、主机端压缩也会影响重复数据删除效率。</block>
  <block id="e8a7060409e1a82af9dacfe72458ffac" category="paragraph">例如、只有当8 KB写入文件与文件系统本身内的8 KB边界对齐时、才会对其进行压缩。这一点意味着它必须位于文件的前8 KB、文件的后8 KB、依此类推。要确保正确对齐、最简单的方法是使用正确的LUN类型、创建的任何分区都应与设备起始位置偏移8K的倍数、并使用数据库块大小的倍数作为文件系统块大小。</block>
  <block id="96738983d52a374cb4a8c958e924836e" category="paragraph">备份或事务日志等数据是跨多个块按顺序写入的操作、所有这些块都会进行压缩。因此、无需考虑对齐。唯一关注的I/O模式是随机覆盖文件。</block>
  <block id="1afe2c0821b67085f9ea2d2deeb2e92a" category="paragraph">数据缩减是一项可提高数据压缩效率的技术。如前文所述、自适应数据压缩本身最多可节省2：1的空间、因为它仅限于在4 KB WAFL块中存储8 KB I/O。块大小越大、压缩方法的效率越高。但是、它们不适用于受到小块覆盖的数据。解压缩32 KB数据单元、更新8 KB部分、重新压缩以及回写驱动器会产生开销。</block>
  <block id="82116b39cd4d0d1920fab1ab4515603b" category="paragraph">节省的资金数额各不相同。已压缩或加密的数据通常无法进一步压缩、因此、数据集无法从数据缩减中受益。相比之下、新初始化的数据文件包含的块元数据和零数据略多、数据压缩率高达80：1。</block>
  <block id="2608473fa5767385d01f256eccbc1cc4" category="paragraph">许多争用资源的阵列都声称可以根据数据库被复制多次的假设对数据库进行重复数据删除。在这方面、也可以使用NetApp重复数据删除、但ONTAP提供了一个更好的选择：NetApp FlexClone技术。最终结果是相同的；系统会为一个数据库创建多个副本、这些副本共享大多数底层物理块。与花时间复制数据库文件并对其进行重复数据删除相比、使用FlexClone的效率要高得多。实际上、它是无重复数据删除、而不是重复数据删除、因为从一开始就不会创建重复数据。</block>
  <block id="7e96c1b651af3f28c27b78807f0310e2" category="paragraph">强烈建议使用精简配置、因为它可以简化管理、同时显著提高可用容量并节省相关成本。原因很简单—数据库环境通常包含大量空空间、大量卷和LUN以及可压缩数据。厚配置会为卷和LUN预留存储空间、以防它们最终达到100%全满并包含100%不可压缩数据。这种情况不大可能发生。通过精简配置、可以回收这些空间并将其用于其他位置、并可以基于存储系统本身进行容量管理、而不是基于许多较小的卷和LUN。</block>
  <block id="f67b854e2d644480b0ec40d7de2b773d" category="paragraph">在纯闪存AFF系统上运行的ONTAP上创建的卷经过精简配置、并启用了所有实时效率功能。尽管数据库通常不会从重复数据删除中受益、并且可能包含不可压缩的数据、但默认设置适用于几乎所有工作负载。ONTAP旨在高效处理所有类型的数据和I/O模式、无论它们是否可节省空间。只有在完全了解原因且有优势的情况下、才应更改默认值。</block>
  <block id="649141c6b8267ea3df10949a853d22cb" category="list-text">不要在数据库备份中同时使用32 KB数据压缩和重复数据删除。请参见一节 <block ref="57ee2712afc5e59236f86db0537b05dc" category="inline-xref-macro-rx"></block> 了解详细信息。</block>
  <block id="5059ada12bae6c7e7fac9338d88301b5" category="doc">Oracle数据库归档日志层</block>
  <block id="4abda684ecc952239d7800547dcf2995" category="sidebar">基于MetroCluster的Oracle SI</block>
  <block id="bdebc59bb8c11012c00a4be61b8bdb5d" category="summary">Microsoft SQL Server实例部署</block>
  <block id="030194212f0e1890126b205fdbcfe852" category="summary">保护ONTAP上的Microsoft SQL Server安全</block>
  <block id="972d09960af01a5f3831f2eac1c75d12" category="summary">使用ONTAP进行Microsoft SQL Server灾难恢复</block>
  <block id="db78788a721b9a9a669c4935d455a593" category="paragraph">企业数据库和应用程序基础架构通常需要进行复制、以防止发生自然灾难或意外业务中断、同时最大限度地减少停机时间。</block>
  <block id="fad02ab7a45b438ba1a4c024b9edb2be" category="paragraph">下面是有关适用于SQL Server的SnapMirror的建议：</block>
  <block id="ff1af055b96eb7cd0f0ab71b2cc80c3d" category="list-text">为保持一致、请勿从控制器计划SnapMirror更新。而是应启用SnapCenter中的SnapMirror更新、以便在完整备份或日志备份完成后更新SnapMirror。</block>
  <block id="60654048dbcae98cde53dc0449c8e47b" category="summary">Microsoft SQL Server存储注意事项</block>
  <block id="71cc52562b241f23c0f5c74c589fc56c" category="paragraph">聚合是NetApp存储配置的最低级别存储容器。互联网上存在一些旧文档、建议将IO分隔到不同的底层驱动器组上。不建议在ONTAP中使用此选项。NetApp已使用数据文件和事务日志文件分开的共享和专用聚合执行了各种I/O工作负载特征化测试。测试表明、一个具有更多RAID组和驱动器的大型聚合可以优化和提高存储性能、并使管理员更易于管理、原因有两个：</block>
  <block id="994dbcbb2492daba25572c539cc12968" category="list-text">一个大型聚合可使所有驱动器的I/O功能对所有文件可用。</block>
  <block id="900188651b4134e36897865047c3fb5b" category="list-text">将卷中的Snapshot预留值设置为零、以便于从操作角度进行监控。</block>
  <block id="27d9533edb3ad60370502d101cd38d2b" category="list-text">禁用快照计划和保留策略。请改用SnapCenter来协调SQL Server数据卷的Snapshot副本。</block>
  <block id="a09a2d9023a555d2d5a72621bf3395b3" category="list-text">将SQL Server系统数据库放在一个专用卷上。</block>
  <block id="7b3c6a2d089eb1b6f8959e7e61a50c07" category="section-title">LUN</block>
  <block id="a2f15f0d2a5091a4b232a8fa89bb43f8" category="paragraph">运行查询时、SQL Server会尝试分配最佳内存量、以便高效运行。</block>
  <block id="a549d3d5e3e6aa1db52e782527a9664d" category="summary">Microsoft SQL Server数据库文件放置</block>
  <block id="329282f5b4d197877079b3b130756d76" category="paragraph">在初始部署阶段、在ONTAP上正确放置SQL Server数据库文件至关重要。这样可以确保最佳性能、空间管理、备份和还原时间、并可根据您的业务需求进行配置。</block>
  <block id="d8969d8106a5ac08f38277a3c0b813dc" category="paragraph">通过将多个数据文件放在文件组中、您可以将负载分布在不同的存储设备上、这有助于提高系统的I/O性能。相反、事务日志不会从多个文件中受益、因为SQL Server会按顺序写入事务日志。</block>
  <block id="bd87ed7f70b7f9173319df18e5b5b751" category="paragraph">每当SQL Server增加文件大小时、它都会用零填充新分配的空间。该进程会阻止所有需要写入相应文件的会话、或者在事务日志增长时生成事务日志记录。</block>
  <block id="7a64f7e9c9b5737a434bdcc8f935c5ce" category="summary">Microsoft SQL Server和ONTAP存储效率</block>
  <block id="9df29e7c756637e30b37f014d02117ef" category="paragraph">SQL Server本身还具有压缩和高效管理数据的功能。SQL Server目前支持两种类型的数据压缩：行压缩和页面压缩。</block>
  <block id="09ddfa236e0fa1173f8d86a5ad0c148f" category="summary">Microsoft SQL Server日志目录</block>
  <block id="cc2c23339c0ad05c5ae1704b4a0ecb37" category="paragraph">日志目录在SQL Server中指定、用于在主机级别存储事务日志备份数据。如果使用SnapCenter备份日志文件、则SnapCenter使用的每个SQL Server主机都必须配置一个主机日志目录、才能执行日志备份。SnapCenter 具有一个数据库存储库、因此与备份、还原或克隆操作相关的元数据存储在一个中央数据库存储库中。</block>
  <block id="59412263456ecc0573b76fe1c40d55fb" category="paragraph">ONTAP为您的Microsoft SQL Server数据库提供企业级安全性和性能解决方案、同时还提供世界一流的工具来管理您的环境。</block>
  <block id="e8b13d430655a3ab009ba8e90e51ce5a" category="paragraph">NetApp假定读者具备以下方面的实践知识：</block>
  <block id="c7f2945182947499933dea6fafeb22d3" category="summary">在ONTAP上放置Microsoft SQL Server tempdb</block>
  <block id="03162932e80c8f83c1ad9e36b16c1dcf" category="summary">Microsoft SQL Server CPU配置</block>
  <block id="074e88cde37f7aba58ac120bbc874e77" category="paragraph">SQL Server许可有两种选择。第一种称为服务器+客户端访问许可证(CAL)模式；第二种是按处理器核心模式。尽管使用server + CAL策略可以访问SQL Server中提供的所有产品功能、但每个插槽的硬件限制为20个CPU核心。即使每个插槽的CPU核心数超过20个的服务器具有SQL Server Enterprise Edition + CAL、应用程序也无法在该实例上一次使用所有这些核心。</block>
  <block id="cc3873d6002920194cf7e9dd493c5863" category="paragraph">除非遇到性能问题、否则您不太可能需要更改处理器关联性默认值、但仍然值得了解它们是什么以及它们的工作原理。</block>
  <block id="4317f0d20ae625ae3139762a94175cbd" category="paragraph">默认情况下、如果选择了按处理器核心许可证、则SQL Server会在查询执行期间使用所有可用的CPU。</block>
  <block id="ff03ad08d7a38270e44c8c74372d0e7c" category="summary">使用SnapCenter和T-SQL命令保护ONTAP上的Microsoft SQL Server数据库。</block>
  <block id="a72812111b6cfc428e19135820c476bc" category="paragraph">SnapCenter是一款适用于企业级应用程序的NetApp数据保护软件。使用适用于SQL Server的SnapCenter插件以及适用于Microsoft Windows的SnapCenter插件管理的操作系统、可以快速轻松地保护SQL Server数据库。</block>
  <block id="62c187efa0cd9f4191b84ae987d522c9" category="paragraph">SQL Server实例可以是独立设置、故障转移集群实例、也可以始终位于可用性组上。这样、可以通过单一管理平台从主副本或二级副本保护、克隆和还原数据库。SnapCenter可以管理内部、云端和混合配置中的SQL Server数据库。此外、还可以在原始主机或备用主机上几分钟内创建数据库副本、以供开发或报告之用。</block>
  <block id="8a3aceb6ed4b21af2f2c00ecb032f75f" category="paragraph">在SQL Server 2022中、Microsoft引入了T-SQL快照、可通过它编写脚本并自动执行备份操作。您可以为快照准备数据库、而不是执行全尺寸副本。数据库备份就绪后、您可以利用ONTAP REST API创建快照。</block>
  <block id="eeeb4e610a7896c1b1f2e2ea9b3f52a0" category="list-text">使用alter命令冻结数据库。这样可以使数据库在底层存储上为一致的快照做好准备。冻结后、您可以解冻数据库并使用backup命令记录快照。</block>
  <block id="fd95362fecccbbb7b017317e8bede3b5" category="admonition">此ONTAP和MySQL数据库文档将取代先前发布的_TR-4722：《基于ONTAP的MySQL数据库最佳实践》。_</block>
  <block id="887757e2405372a0b9e17cc054ab38f3" category="paragraph">SnapRestore之所以能够如此快速高效地工作、是因为快照的性质、从本质上说、快照是一个在特定时间点卷内容的并行只读视图。活动块是可以更改的实际块、而快照是创建快照时构成文件和LUN的块的状态的只读视图。</block>
  <block id="f9b673452d1da030fef3f976bbbbb103" category="paragraph">在此示例中、源数据库位于ONTAP系统上。创建数据库备份的最简单方法是使用快照。数据库将处于热备份模式几秒钟、而处于<block ref="252ce13e6c150af4d3e7eea5fca266bc" prefix=" " category="inline-code"></block> 在托管数据文件的卷上执行此操作。</block>
  <block id="630a571b99791968d41f9caba4a3e39c" category="paragraph">结果是在磁盘上生成一个名为的快照<block ref="a8b3bc9f12cd194b80d404c30e9015ee" prefix=" " category="inline-code"></block> 该映像包含处于热备份模式时的数据文件映像。如果将此快照中的数据与相应的归档日志结合使用以使数据文件保持一致、则可以将此快照中的数据用作还原或克隆的基础。在这种情况下、它会复制到新服务器。</block>
  <block id="96a1129a5a4b32943286cafd5e0ca2e1" category="paragraph">在此示例中、使用SnapMirror将快照热备份复制到新位置。</block>
  <block id="0c4e214451012c456ece194f5465deb2" category="paragraph">SnapCenter包括一些基本功能、例如基于快照的备份和还原、SnapMirror和SnapVault复制、以及大型企业大规模运行所需的其他功能。这些高级功能包括扩展的基于角色的访问控制(Role-Based Access Control、RBAC)功能、可与第三方业务流程产品集成的REST API、对数据库主机上的SnapCenter插件进行无中断集中管理、以及专为云规模环境设计的用户界面。</block>
  <block id="ee4b6ce05339d0d985309ece9b7d4372" category="inline-link-macro">TR-4067：《基于ONTAP的NFS最佳实践》</block>
  <block id="7a3ba6ac400bdd362b5db9daabcefca2" category="paragraph">NFS协议包含多个版本、但要求各不相同。有关使用ONTAP的完整NFS配置问题描述、请参见 <block ref="d594eac583da3f61bc51209142764c76" category="inline-link-macro-rx"></block>。以下各节介绍了一些更关键的要求和常见的用户错误。</block>
  <block id="dabc72adea00cc712e7650b066f1d8c6" category="inline-link">TR-4067：《基于ONTAP的NFS最佳实践》</block>
  <block id="36911cfd2b35ef0ca97dab53c7e045f0" category="paragraph">与简单地将挂载选项从vs=3更改为vs=4.1相比、切换到NFSv4更为复杂。有关使用ONTAP配置NFSv4的更完整说明、包括有关配置操作系统的指导、请参见<block ref="92f446ddde3e320c4e32b449cbe3112d" category="inline-link-rx"></block>。本技术报告的以下各节介绍了使用NFSv4的一些基本要求。</block>
  <block id="a80438f1b3354b284cf31082c45b33b3" category="summary">采用ONTAP的Hyper-V存储基础架构</block>
  <block id="cfbb26e347d5746581822f8046be20c4" category="paragraph">Hyper-V存储基础架构可以托管在ONTAP存储系统上。可以使用NetApp LUN或NetApp CIFS共享为Hyper-V存储VM文件及其磁盘提供存储、如下图所示。</block>
  <block id="25aa60030552ee28c6e802f74d96f111" category="inline-image-macro">基于NetApp的Hyper-V存储基础架构、宽度=624、高度=338</block>
  <block id="818a20c74e71223c5a644895a6dd4095" category="paragraph"><block ref="818a20c74e71223c5a644895a6dd4095" category="inline-image-macro-rx" type="image"></block></block>
  <block id="a9c5672e01a7d0a8e068c2573fbdd4c2" category="section-title">NetApp LUN上的Hyper-V存储</block>
  <block id="1d9f855d005777411eca330fd3c883a1" category="inline-link-macro">在SAN环境中配置</block>
  <block id="d02671c8f4f293bf5688d34f44e5b87b" category="list-text">在Hyper-V服务器计算机上配置NetApp LUN。有关详细信息，请参阅"<block ref="9659d1fb07c4af2143cd165cb4b6822e" category="inline-link-macro-rx"></block>。 "</block>
  <block id="2771a58b129233810f1c389eedd2207f" category="list-text">从Server Manager的Tools部分打开Hyper-V Manager。</block>
  <block id="ee15a170a42b1f37e0d70bf3b367f2ee" category="list-text">选择Hyper-V服务器、然后单击Hyper-V设置。</block>
  <block id="b9cc0276ae5386d0ed5e9ed31ceb340d" category="list-text">指定用于将虚拟机及其磁盘存储为LUN的默认文件夹。这样会将默认路径设置为Hyper-V存储的LUN。如果要明确指定VM的路径、则可以在创建VM期间执行此操作。</block>
  <block id="72feffd29972ad4bc2fb9f5705e60864" category="inline-link-macro">在SMB环境中配置</block>
  <block id="ace87f7890ab6204f4ef6abd0afaf28a" category="paragraph">开始执行本节中列出的步骤之前，请查看"<block ref="f9d723fa339e7968f40a99719593036c" category="inline-link-macro-rx"></block>" 要在NetApp CIFS共享上配置Hyper-V存储、请完成以下步骤：</block>
  <block id="d3f9aa7fc4289533bdeb015bbd645a22" category="list-text">指定用于存储VM及其磁盘的默认文件夹作为CIFS共享。这样会将默认路径设置为Hyper-V存储的CIFS共享。如果要明确指定VM的路径、则可以在创建VM期间执行此操作。</block>
  <block id="a531c67c9d6be93b7864c891efc5480a" category="paragraph">而Hyper-V中的每个虚拟机又可以获得提供给物理主机的NetApp LUN和CIFS共享。此操作步骤与任何物理主机相同。可以使用以下方法为VM配置存储：</block>
  <block id="b7756c6e1b92d15f0367db534aa4fdc2" category="list-text">使用VM中的FC启动程序添加存储LUN</block>
  <block id="dda418820dd5a8b649a681b73da4ba97" category="list-text">使用虚拟机中的iSCSI启动程序添加存储LUN</block>
  <block id="ee0537a6d83f8b83e99ac0b7b3d0af82" category="list-text">向VM添加直通物理磁盘</block>
  <block id="a842c008b079c30c444ab4c9d78524e6" category="list-text">从主机将VHD/VHDX添加到VM</block>
  <block id="50fba9282607c757ab39ad110cd0fde4" category="list-text">当VM及其数据存储在NetApp存储上时、NetApp建议定期在卷级别运行NetApp重复数据删除。如果在CSV或SMB共享上托管相同的VM、则这种做法会显著节省空间。重复数据删除在存储控制器上运行、不会影响主机系统和虚拟机的性能。</block>
  <block id="6b4ecf09c5310b6b905c86b910a57012" category="list-text">NetApp建议取消选中允许管理操作系统共享Hyper-V虚拟交换机的此网络适配器选项。这样会为VM创建一个专用网络。</block>
  <block id="8f20505d01de58b8e00048581d2d7244" category="list-text">如果主机系统配置有多个FC端口并提供给虚拟机、则必须在虚拟机中安装MPIO才能启用多路径。</block>
  <block id="e003acc3eceda748125d4c7bf41052e7" category="list-text">如果在主机上使用MPIO、则无法为该主机配置直通磁盘、因为直通磁盘不支持MPIO。</block>
  <block id="aa7c5f68a034b43fa3bafa90ea6a6c2b" category="list-text">用于VHD/VHDx文件的磁盘应使用64K格式进行分配。</block>
  <block id="5aa08a9ab39b4ff0ad3ec476f9c0a7a9" category="inline-link">Hyper-V虚拟光纤通道概述</block>
  <block id="17d2fe1a1b42dbc4c914a82ff9a06cbf" category="list-text">有关虚拟光纤通道的详细信息、请参见Microsoft<block ref="ffefda586e5fabc71f0e43393b116d4c" category="inline-link-rx"></block> 页面。</block>
  <block id="6736b7040d05d12679268b13fae93377" category="paragraph">借助ODX、可以更快、更高效地在SMB共享内、LUN内以及SMB共享与LUN (如果位于同一卷中)之间复制文件。如果需要在同一个卷中为一个操作系统的黄金映像(VHD/VHDX)创建多个副本、则此方法会更有用。如果同一个黄金映像位于同一个卷中、则创建多个副本所需的时间会显著缩短。ODX还可用于Hyper-V存储实时迁移、用于移动VM存储。</block>
  <block id="53003aec095203ae2075a8150e8ead4e" category="paragraph">如果复制跨卷、则与基于主机的副本相比、性能可能不会显著提高。</block>
  <block id="80f704dacc785527bc57a7851889f8b3" category="paragraph">要在CIFS上启用ODX功能、请在NetApp存储控制器上运行以下命令行界面命令：</block>
  <block id="9c8ee5398727fdb2573f25e0535d686d" category="list-text">为CIFS启用ODX。
#将权限级别设置为诊断
cluster：&gt; set -PRILEGE diagnostic</block>
  <block id="574eac1c36a4e6832136e6cf051cc147" category="list-text">要在SAN上启用ODX功能、请在NetApp存储控制器上运行以下命令行界面命令：
#将权限级别设置为诊断
cluster：&gt; set -PRILEGE diagnostic</block>
  <block id="ea782640f98557c065767874aded89e7" category="list-text">对于CIFS、只有当客户端和存储服务器都支持SMB 3.0和ODX功能时、ODX才可用。</block>
  <block id="c2dca5b1810c92e856cc04f6f2a88586" category="list-text">对于SAN环境、只有当客户端和存储服务器都支持ODX功能时、ODX才可用。</block>
  <block id="f41987326c80680c60b359697adfa4cc" category="inline-link">提高Microsoft远程复制性能</block>
  <block id="fcb65106bb1fd73c88cf9528cb579ed5" category="inline-link">Microsoft卸载数据传输</block>
  <block id="65994fb0563b49bfe0e59359edf5513d" category="paragraph">有关ODX的信息、请参见<block ref="29f9e15a4017cdf9ae06e098a7a28381" category="inline-link-rx"></block> 和<block ref="f884f78ec6d36ebebd3d9fc57e8c3734" category="inline-link-rx"></block> 。</block>
  <block id="20029977789a74e480e6f8d14c07b48a" category="paragraph">故障转移集群可为Hyper-V服务器提供高可用性和可扩展性。故障转移集群是一组独立的Hyper-V服务器、它们协同工作以提高VM的可用性和可扩展性。</block>
  <block id="1b5f8c43b61e9249f3c82e39f9649160" category="section-title">集群共享卷</block>
  <block id="c3e01cf065f02a4feb72ac75d534fa2e" category="paragraph">通过NetApp、故障转移集群中的多个节点可以同时对配置为NTFS或ReFS卷的同一个CSV LUN进行读/写访问。借助CSV、集群角色可以快速从一个节点故障转移到另一个节点、而无需更改驱动器所有权或卸载并重新挂载卷。此外、CSV还可以简化对故障转移集群中可能存在的大量LUN的管理。CSV可提供一个通用的集群模式文件系统、该文件系统位于NTFS或ReFS之上。</block>
  <block id="92f30d2ddb9cc7fbf92029307c6dbe98" category="inline-image-macro">Hyper-V故障转移集群和NetApp、宽度=624、高度=271</block>
  <block id="873c6f06eca771e8f918112aaf233170" category="paragraph"><block ref="873c6f06eca771e8f918112aaf233170" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7c1d777ad1068fcefc91b140eba543bf" category="list-text">NetApp建议关闭iSCSI网络上的集群通信、以防止内部集群通信和CSV流量流经同一网络。</block>
  <block id="b53334a2710cb18a4e717240b312807f" category="list-text">NetApp建议使用冗余网络路径(多个交换机)来提供故障恢复能力和QoS。</block>
  <block id="f251ad17cf6806e0e3667148cda40e43" category="list-text">用于CSV的磁盘必须使用NTFS或ReFS进行分区。使用FAT或FAT32格式化的磁盘不能用于CSV。</block>
  <block id="161432666d89990b3c1112afe633ff8e" category="list-text">用于CSV的磁盘应使用64K格式进行分配。</block>
  <block id="36cf7806cbb55a382b64bd9b65b2939b" category="inline-link-macro">部署Hyper-V集群</block>
  <block id="390167e852a9bfc97d6ed31462a05b2f" category="paragraph">有关部署Hyper-V集群的信息、请参见附录B： <block ref="8a150f92c22920868769b8738759e23d" category="inline-link-macro-rx"></block>。</block>
  <block id="32730f5882545bbe6a81ac49049968f0" category="section-title">Hyper-V实时迁移：迁移虚拟机</block>
  <block id="d7f2f7b4116921a3d8d4b8e5892420a7" category="paragraph">有时、在VM的生命周期内、需要将其移至Windows集群上的其他主机。如果主机的系统资源即将用尽、或者由于维护原因需要重新启动主机、则可能需要执行此操作。同样、可能需要将虚拟机移动到其他LUN或SMB共享。如果现有LUN或共享空间即将用尽或性能低于预期、则可能需要执行此操作。Hyper-V实时迁移可将正在运行的虚拟机从一台物理Hyper-V服务器移至另一台物理Hyper-V服务器、而不会影响虚拟机对用户的可用性。您可以在故障转移集群中的Hyper-V服务器之间或不属于任何集群的独立Hyper-V服务器之间实时迁移虚拟机。</block>
  <block id="92829881718abd402c6c73b34be944da" category="section-title">在一个"已加入的环境中进行实时迁移"</block>
  <block id="e8881f62af8c1495a1f4869b97e95505" category="paragraph">VM可以在集群节点之间无缝移动。VM迁移是瞬时的、因为集群中的所有节点都共享同一个存储、并且可以访问VM及其磁盘。下图显示了集群环境中的实时迁移。</block>
  <block id="8cda6697809dd81e112a12c43f6f89f4" category="inline-image-macro">集群环境中的实时迁移、宽度=580、高度=295</block>
  <block id="d668981cacbbf412643956687c03fc0d" category="paragraph"><block ref="d668981cacbbf412643956687c03fc0d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4797d6b2727c9902e114fa95ed076fc2" category="list-text">为实时迁移流量配置一个专用端口。</block>
  <block id="7c021f26d9ab2ec9934fc24d167ceaa4" category="list-text">拥有专用的主机实时迁移网络、以避免迁移期间出现与网络相关的问题。</block>
  <block id="a725857d2338d476a409fd1fb67b1f56" category="inline-link-macro">附录C：在集群环境中部署Hyper-V实时迁移</block>
  <block id="45f7134e494aae2cba3b60b3fe769caa" category="paragraph">有关在集群环境中部署实时迁移的信息、请参见 <block ref="b584c2d96a6b139fbe05976580afae94" category="inline-link-macro-rx"></block>。</block>
  <block id="07cb5e9c694ee3a8dcc475a38371ad5c" category="paragraph">您可以在两个非集群独立Hyper-V服务器之间实时迁移虚拟机。此过程可以使用共享或无共享实时迁移。</block>
  <block id="87b94a12a79a6dbc08decd540810bb26" category="inline-image-macro">非集群环境中的共享实时迁移、宽度=331、高度=271</block>
  <block id="f442dd66197cc65f49ad8ec9c50e8076" category="paragraph"><block ref="f442dd66197cc65f49ad8ec9c50e8076" category="inline-image-macro-rx" type="image"></block></block>
  <block id="207d1150dff7488c7f8bfafe7036a222" category="list-text">在无共享实时迁移中、每个Hyper-V服务器都有自己的本地存储(可以是SMB共享、LUN或DAS)、并且虚拟机的存储是其Hyper-V服务器的本地存储。实时迁移VM时、VM的存储会通过客户端网络镜像到目标服务器、然后迁移VM。存储在DAS、LUN或SMB/CCIFS共享上的虚拟机可以移动到另一个Hyper-V服务器上的SMB/CCIFS共享、如下图所示。也可以将其移动到LUN、如第二个图所示。</block>
  <block id="8df9231bc9de1239aa92c6a9d1116db4" category="inline-image-macro">无共享在非集群环境中实时迁移到SMB共享、宽度=624、高度=384</block>
  <block id="c6acea552c059bcc9ccb207ad6b8cee1" category="paragraph"><block ref="c6acea552c059bcc9ccb207ad6b8cee1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="559b3e5c1d4ea7b8f3eaf8cbc0e4155e" category="inline-image-macro">在非集群环境中、无共享实时迁移到LUN、宽度=624、高度=384</block>
  <block id="3d0d53528ff4699abb6fab11a6bf756d" category="paragraph"><block ref="3d0d53528ff4699abb6fab11a6bf756d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b19cfe6ea61be3a5ed442a8a975a6406" category="inline-link-macro">附录D：在集群环境之外部署Hyper-V实时迁移</block>
  <block id="b7c375b5c0ef95eecd45b0a4614c2c68" category="paragraph">有关在集群模式环境之外部署实时迁移的信息、请参见 <block ref="52490817f607e6265e62f91bb3c3799a" category="inline-link-macro-rx"></block>。</block>
  <block id="061731a1a3266df0eda8efe87e649dbb" category="section-title">Hyper-V存储实时迁移</block>
  <block id="ecaa2ddd351a3f5a9704aaea9a13abaf" category="paragraph">在虚拟机的生命周期内、您可能需要将虚拟机存储(VHD/VHDX)移至其他LUN或SMB共享。如果现有LUN或共享空间即将用尽或性能低于预期、则可能需要执行此操作。</block>
  <block id="1f976b42d4bb2c18a943d132252997d6" category="paragraph">当前托管VM的LUN或共享可能会用尽空间、重新利用或降低性能。在这种情况下、可以将虚拟机移动到另一个LUN或其他卷、聚合或集群上的共享、而无需停机。如果存储系统具有副本卸载功能、则此过程会更快。默认情况下、对于CIFS和SAN环境、NetApp存储系统会启用副本卸载。</block>
  <block id="bbaae8d50419225b92db654852107b29" category="paragraph">ODX功能可在驻留在远程服务器上的两个目录之间执行完整文件或子文件副本。通过在服务器之间复制数据(如果源文件和目标文件位于同一服务器上、则复制数据也可以复制到同一服务器)来创建副本。创建副本时、客户端不会从源读取数据、也不会写入目标。此过程可减少客户端或服务器对处理器和内存的使用、并最大限度地减少网络I/O带宽。如果在同一个卷中复制、则速度会更快。如果复制跨卷、则与基于主机的副本相比、性能可能不会显著提高。在主机上继续执行复制操作之前、请确认已在存储系统上配置副本卸载设置。</block>
  <block id="843c69ad55fb8bac002321dee51a4770" category="paragraph">从主机启动VM存储实时迁移后、系统将确定源和目标、并将复制活动卸载到存储系统。由于活动由存储系统执行、因此主机CPU、内存或网络的使用率可以忽略不计。</block>
  <block id="27d2fda0da241bb37583fba1af25cd09" category="paragraph">NetApp存储控制器支持以下不同的ODX情形：</block>
  <block id="48a53ae81ff0c821cba0e11bd2383bf3" category="list-text">*IntaSVM.*数据属于同一个SVM：</block>
  <block id="ec3d44fd176b5d51f4f60dff319cea6b" category="list-text">*Intravolume、intrinode。*源文件或LUN和目标文件或LUN位于同一个卷中。复制操作采用FlexClone文件技术执行、这种技术可提供额外的远程复制性能优势。</block>
  <block id="980ca02c9855a39b86e9fbf5acd955b4" category="list-text">*卷间、内部网。*源文件或LUN和目标文件或LUN位于同一节点上的不同卷上。</block>
  <block id="8a4d33d47a803a1796b431a0df5a8016" category="list-text">*卷间、节点间。*源文件或LUN和目标文件或LUN位于不同节点上的不同卷上。</block>
  <block id="81d5c73c98489729a8f91afe4936dbd2" category="list-text">*InterSVM.*数据属于不同的SVM。</block>
  <block id="ea9799ac312b9050a36864c98be8f73f" category="list-text">*卷间、节点间。*源文件或LUN和目标文件或LUN位于不同节点上的不同卷上。</block>
  <block id="3693f5a47e6bfc0762c5b2c174e653be" category="list-text">*集群间。*从ONTAP 9.0开始、SAN环境中的集群间LUN传输也支持ODX。集群间ODE仅支持SAN协议、而不支持SMB。</block>
  <block id="8e459b300b9b5f521f0cc464bc1a7137" category="paragraph">迁移完成后、必须重新配置备份和复制策略、以反映存放VM的新卷。先前创建的任何备份均无法使用。</block>
  <block id="9cabe6ff649f754acc3a863e852828e8" category="paragraph">可以在以下存储类型之间迁移虚拟机存储(VHD/VHDX)：</block>
  <block id="49a63af944b72883bd718eb8c8ff01c8" category="list-text">DAS和SMB共享</block>
  <block id="85fbd1c03217c7c62157aac97d16ecf9" category="list-text">DAS和LUN</block>
  <block id="876c6424f49d57e8be596b8caadf5a61" category="list-text">SMB共享和LUN</block>
  <block id="1518cb86dc78f6083ed8b1d292b87ed8" category="list-text">LUN之间</block>
  <block id="7257cd316393b74da62868c27652c6c0" category="list-text">SMB共享之间</block>
  <block id="17785c3ef4bbda06e9db9c15908dc0c6" category="inline-image-macro">Hyper-V存储实时迁移、宽度=339、高度=352</block>
  <block id="eccf932baf8f6019c69035ea09e26c2c" category="paragraph"><block ref="eccf932baf8f6019c69035ea09e26c2c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="319572d5872182625e2834b8615517f2" category="inline-link-macro">附录E：部署Hyper-V存储实时迁移</block>
  <block id="04a136595cb35e5c42e3ea764e9cd259" category="paragraph">有关部署存储实时迁移的信息、请参见 <block ref="e0d213bcf75379722df0c1b3af5063a2" category="inline-link-macro-rx"></block>。</block>
  <block id="86174aa4d77b1853f72b6e1a6f32c753" category="paragraph">Hyper-V副本可将Hyper-V虚拟机从主站点复制到二级站点上的副本虚拟机、从而为虚拟机提供异步灾难恢复。托管VM的主站点上的Hyper-V服务器称为主服务器；接收复制的VM的二级站点上的Hyper-V服务器称为副本服务器。下图显示了Hyper-V副本示例场景。您可以在故障转移集群中的Hyper-V服务器之间或不属于任何集群的独立Hyper-V服务器之间对虚拟机使用Hyper-V副本。</block>
  <block id="28e90920ae557bd81a8056f93fb4b0ee" category="inline-image-macro">Hyper-V副本、宽度=624、高度=201</block>
  <block id="4fc821418df9e4488323cc70692d5083" category="paragraph"><block ref="4fc821418df9e4488323cc70692d5083" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8c340dc334134096f68b880b42a8692c" category="section-title">Replication</block>
  <block id="b9bce4677e5b3ea1c310fddca6123c9f" category="paragraph">在主服务器上为虚拟机启用Hyper-V副本后、初始复制会在副本服务器上创建一个相同的虚拟机。初始复制完成后、Hyper-V副本会为虚拟机的VHD维护一个日志文件。根据复制频率、日志文件将按相反顺序重载到副本的VHD。此日志以及反向顺序的使用可确保以异步方式存储和复制最新的更改。如果复制未按预期频率进行、则会发出警报。</block>
  <block id="ec9fc8b78968b1d0daadf7598a4e2ab6" category="paragraph">Hyper-V副本支持扩展复制、在此复制中、可以配置二级副本服务器以实现灾难恢复。可以为副本服务器配置辅助副本服务器、使其接收副本VM上的更改。在扩展复制方案中、主服务器上主VM上的更改会复制到副本服务器。然后、所做的更改将复制到扩展副本服务器。只有当主服务器和副本服务器都关闭时、VM才能故障转移到扩展副本服务器。</block>
  <block id="a3f36244dba1d116dac91134dda3b9db" category="paragraph">故障转移不是自动的；必须手动触发该过程。故障转移有三种类型：</block>
  <block id="f8487dcb10cf762a4d3f28da4635bd2a" category="list-text">*测试故障转移。*此类型用于验证副本VM是否可以在副本服务器上成功启动并在副本VM上成功启动。此过程会在故障转移期间创建一个重复的测试VM、不会影响常规生产复制。</block>
  <block id="09f4056fddf2108616fe7bf3194540ba" category="list-text">*计划内故障转移。*此类型用于在计划内停机或预期中断期间对VM进行故障转移。此过程会在主VM上启动、必须先在主服务器上关闭主VM、然后才能运行计划内故障转移。计算机故障转移后、Hyper-V副本将在副本服务器上启动副本虚拟机。</block>
  <block id="0ad8df7e141c378e7ad1debc5721cecf" category="list-text">*计划外故障转移。*发生意外中断时使用此类型。此过程会在副本VM上启动、只有在主计算机出现故障时才应使用。</block>
  <block id="d8afbc541b39d23648c823057cffe3a5" category="section-title">恢复</block>
  <block id="53b169078c7c6ecee01802b49b675c54" category="paragraph">在为VM配置复制时、您可以指定恢复点的数量。恢复点表示可以从复制的计算机恢复数据的时间点。</block>
  <block id="31e96602ee944674a6ee07052bc6552a" category="inline-link-macro">将Hyper-V副本部署到非群组环境中</block>
  <block id="fd09d6344b235cdd2863e5027a2716e8" category="list-text">有关在集群环境之外部署Hyper-V副本的信息，请参阅“<block ref="376f647d5b86bfed7dfffbd7c50e7d1e" category="inline-link-macro-rx"></block>。 "</block>
  <block id="23b6fa788d78e992f84931ddd3cef629" category="inline-link-macro">在一个群组环境中部署Hyper-V副本</block>
  <block id="a3538f75015c27ee42ac1f1c0b535a61" category="list-text">有关在集群环境中部署Hyper-V副本的信息，请参阅“<block ref="e81baea973ee37d0bb61473f872cfb84" category="inline-link-macro-rx"></block>。 "</block>
  <block id="57a0eb5139789611b6b213a5f3fa5412" category="summary">本附录介绍如何在NetApp存储上部署高可用性Hyper-V集群。</block>
  <block id="e286734bc8843e9f46f2812455917ea5" category="paragraph">本附录介绍如何部署Hyper-V集群。</block>
  <block id="fa0edb5816386e7e049e5c77d9cdb367" category="list-text">至少有两个Hyper-V服务器相互连接。</block>
  <block id="a7bad6853c4b367ee245a88ab3195af0" category="list-text">在每个Hyper-V服务器上至少配置一个虚拟交换机。</block>
  <block id="ebdc83ef4c8d2993b67ae667bcb0cd50" category="list-text">故障转移集群功能已在每个Hyper-V服务器上启用。</block>
  <block id="65e98c7fa4c69ce7bd0d182ede13991a" category="list-text">SMB共享或LV用作共享存储、用于存储Hyper-V集群中的虚拟机及其磁盘。</block>
  <block id="22f4b86bcfebce25bb61ddd3ee8d6f7f" category="list-text">存储不应在不同集群之间共享。每个集群只应有一个CSV/CIFS共享。</block>
  <block id="c2377be670723e586c1324a4a12607a5" category="list-text">如果SMB共享用作共享存储、则必须配置SMB共享上的权限、以授予对集群中所有Hyper-V服务器的计算机帐户的访问权限。</block>
  <block id="ea355214fd4bc7c57f471bd92918879b" category="section-title">部署</block>
  <block id="3627e168149dcf185918371a7adb5680" category="list-text">以管理员组成员的身份登录到一个Windows Hyper-V服务器。</block>
  <block id="0cc618f3a272a1fc35b193fc6efa1122" category="list-text">启动服务器管理器**.**</block>
  <block id="f30124a5c887cea53cc6397d6c9e40a6" category="list-text">在工具部分中、单击故障转移集群管理器。</block>
  <block id="54be8be618f1803d7fc1579e2fad9a6c" category="list-text">单击"Create Cluster from Actions"菜单。</block>
  <block id="6bcb4b141d153c7cee9fc6b2633a703c" category="list-text">提供此集群中Hyper-V服务器的详细信息。</block>
  <block id="58ee4cb30b6b0dd4665be3c60c65e0f1" category="list-text">验证集群配置。当系统提示您进行集群配置验证时、选择是、然后选择所需的测试、以验证Hyper-V服务器是否满足加入集群的前提条件。</block>
  <block id="8a2ec0e7f4a4ecb848794b1aba47839b" category="list-text">验证成功后、将启动创建集群向导。在向导中、提供新集群的集群名称和集群IP地址。然后、为Hyper-V服务器创建新的故障转移集群。</block>
  <block id="ce73c2e33e5d228466b28690400c8c14" category="list-text">在故障转移集群管理器中单击新创建的集群并对其进行管理。</block>
  <block id="904aa93ec80c2a5ca93ed8ace0e52220" category="list-text">定义集群要使用的共享存储。它可以是SMB共享或CSV。</block>
  <block id="d69f1a0923232e84331ec6d30315124c" category="list-text">使用SMB共享作为共享存储不需要执行任何特殊步骤。</block>
  <block id="3b045123cc5f216c3aa18614a4cabf45" category="list-text">在NetApp存储控制器上配置CIFS共享。要执行此操作，请参阅"<block ref="f9d723fa339e7968f40a99719593036c" category="inline-link-macro-rx"></block>"。</block>
  <block id="c0edb31f94845e5a1f67d2f79db4408f" category="list-text">要使用CSV作为共享存储、请完成以下步骤：</block>
  <block id="dfd86a662700832b7931201c3abdf13f" category="list-text">在NetApp存储控制器上配置LUN。为此、请参见"在SAN环境中配置"一节。</block>
  <block id="49873862ecc43076ac3a4de327f3efdb" category="list-text">确保故障转移集群中的所有Hyper-V服务器均可识别NetApp LUN。要对故障转移集群中的所有Hyper-V服务器执行此操作、请确保将其启动程序添加到NetApp存储上的启动程序组。此外、请确保发现其LUN并启用MPIO。</block>
  <block id="4fe4609b22418e84ea85667368c2e742" category="list-text">在集群中的任一Hyper-V服务器上、完成以下步骤：</block>
  <block id="de824a62ee353b5481bb4eeb5c13d899" category="list-text">使LUN联机、初始化磁盘、创建一个新的简单卷、然后使用NTFS或ReFS对其进行格式化。</block>
  <block id="340f3a4d7fad2c45eadfe69d5b56ce38" category="list-text">在故障转移集群管理器中、展开集群、展开存储、右键单击磁盘、然后单击添加磁盘。执行此操作会打开将磁盘添加到集群向导、其中会将LUN显示为磁盘。单击确定将LUN添加为磁盘。</block>
  <block id="c473a447596255e12e2e772012c42b17" category="list-text">CSV可同时从故障转移集群的所有Hyper-V服务器的本地位置C：\ClusterStorage\中查看和访问。</block>
  <block id="b735c11dd95d1b42d173adb43b3a1df2" category="list-text">创建高可用性VM：</block>
  <block id="27f977a1c170f87899be67daf203a268" category="list-text">在故障转移集群管理器中、选择并展开先前创建的集群。</block>
  <block id="569f3bea800216a760ac935540b72c1e" category="list-text">单击角色、然后单击操作中的虚拟机。单击新建虚拟机。</block>
  <block id="4380a9c5c56776fad0f4492a0d3c63f5" category="list-text">从虚拟机应驻留的集群中选择节点。</block>
  <block id="a8be7e73ae88a070ad15a4a6f6d515fe" category="list-text">在虚拟机创建向导中、提供共享存储(SMB共享或CSV)作为存储虚拟机及其磁盘的路径。</block>
  <block id="9da4e10b0da989c65844cd59ed2a0991" category="list-text">使用Hyper-V Manager将共享存储(SMB共享或CSV)设置为Hyper-V服务器存储虚拟机及其磁盘的默认路径。</block>
  <block id="064cd683bf50cb65205de6b9298201b3" category="list-text">测试计划外故障转移。停止VM所属服务器上的集群服务。</block>
  <block id="c7bfaead2ee1aea320b1d91da7ba31d7" category="summary">了解NetApp存储和Windows Server环境</block>
  <block id="5c8c98e7f403562b754941b4d0c17f65" category="paragraph">如中所述 <block ref="ba92ae7cf3bb4a058d2b231c16067714" category="inline-link-macro-rx"></block>NetApp存储控制器提供了一个真正统一的架构，支持文件、块和对象协议。其中包括SMB/CCIFS、NFS、NVMe/TCP、NVMe/FC、iSCSI、 FC (FCP)和S3、并创建统一的客户端和主机访问。同一个存储控制器可同时以SAN LUN和文件服务的形式提供块存储服务、如NFS和SMB/CCIFS。ONTAP还可作为全SAN阵列(ASA)使用、它可通过iSCSI和FCP的对称主动-主动多路径功能来优化主机访问、而统一的ONTAP系统则使用非对称主动-主动多路径功能。在这两种模式下、ONTAP都使用ANA进行基于网络结构的NVMe (NVMe-oF)多路径管理。</block>
  <block id="b39d47dbcb48e2064ea0978dea0793ae" category="list-text">在持续可用的SMB 3.0共享上托管的VM</block>
  <block id="be1d5dd432dd053b97f14401fc060813" category="list-text">托管在iSCSI或FC上运行的集群共享卷(CSV) LUN上的VM</block>
  <block id="fc27a7625c9ffb2fe9dd539f1960c978" category="list-text">SMB 3.0共享上的SQL Server数据库</block>
  <block id="658f98073361780ad39f8c0d45eca2f8" category="list-text">基于NVMe-oF、iSCSI或FC的SQL Server数据库</block>
  <block id="d2ed21657f98def30346884514f11cce" category="list-text">其他应用程序工作负载</block>
  <block id="b76d8ce5a4b5758745257d0223494701" category="section-title">ONTAP数据管理</block>
  <block id="37b74b1418c82d2f0f3a093c4da8e7de" category="paragraph">ONTAP是在NetApp存储控制器上运行的管理软件。NetApp存储控制器称为节点、是一种具有处理器、RAM和NVRAM的硬件设备。节点可以连接到SATA、SAS或SSD磁盘驱动器、也可以连接到这些驱动器的组合。</block>
  <block id="4472647bb1219b68f4b76e737a20ce52" category="inline-image-macro">在Windows Server环境中部署NetApp存储、宽度=624、高度=479</block>
  <block id="79ea3c938053f84aab6e3d9a963056f6" category="paragraph"><block ref="79ea3c938053f84aab6e3d9a963056f6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7df39ad25b0e96b5a09cafef15c90e83" category="paragraph">ONTAP SVM是一种逻辑存储服务器、用于提供从一个或多个逻辑接口(LIFs)到LUN和/或NAS命名空间的数据访问。因此、SVM是存储分段的基本单元、可在ONTAP中实现安全多租户。每个SVM都配置为拥有从分配给物理以太网网络或FC目标端口的物理聚合和逻辑接口(LIP)配置的存储卷。</block>
  <block id="ded35f53d6a4c12f9aa23622a273290c" category="paragraph">逻辑磁盘(LUN)或CIFS共享在SVM的卷中创建、并映射到Windows主机和集群、以便为其提供存储空间、如下图所示。SVM与节点无关、并且基于集群；它们可以在集群中的任何位置使用物理资源、例如卷或网络端口。</block>
  <block id="66bfba6c82925242c27d2f07403b627e" category="inline-image-macro">ONTAP Storage Virtual Machine、宽度=572、高度=443</block>
  <block id="9bcb5e161ae4c106ccd0f2dc96989097" category="paragraph"><block ref="9bcb5e161ae4c106ccd0f2dc96989097" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8f64c369fcdc9c990f5540ce53430671" category="paragraph">在SAN和NAS环境中、均可将存储配置到Windows Server。在SAN环境中、存储会作为NetApp卷上LUN的磁盘提供为块存储。在NAS环境中、存储作为文件存储在NetApp卷上的CIFS或SMB共享提供。这些磁盘和共享可按如下所示在Windows Server中应用：</block>
  <block id="8572daf67b8cf4929b8a104909d42a03" category="list-text">用于应用程序工作负载的Windows Server主机存储</block>
  <block id="460622219d2e0a7fe2d7339d37894127" category="list-text">存储、用于存储NAS服务器和容器</block>
  <block id="24148b9d626dc3494e0f1a07f5ddf180" category="list-text">用于单个Hyper-V主机存储VM的存储</block>
  <block id="c9d2a95802a3dc0a7c1033928d3cfc3f" category="list-text">Hyper-V集群的共享存储、采用LV的形式来存储虚拟机</block>
  <block id="76c319d8818e93b50538dff2f4427cbc" category="list-text">SQL Server数据库的存储</block>
  <block id="13a4fb282282699692756c149d94bbbe" category="paragraph">要从Windows Server 2016连接、配置和管理NetApp存储、请使用以下方法之一：</block>
  <block id="81ef8774b45c60d7387b0e91d9c4eb05" category="list-text">*安全外壳(SSH)。*使用Windows Server上的任何SSH客户端运行NetApp命令行界面命令。</block>
  <block id="935df6062271011aad64300fe0f8a6c7" category="list-text">* System Manager.*这是NetApp基于GUI的易管理性产品。</block>
  <block id="85c7991eb4ed1078ecb54aacffe3a3a2" category="list-text">* NetApp PowerShell工具包。*这是NetApp PowerShell工具包、用于自动化和实施自定义脚本和工作流。</block>
  <block id="1fb25b443082bb79703b1237630cd9b6" category="section-title">NetApp PowerShell工具包</block>
  <block id="a5038d870bfecae7a8fb1fb0d8ba892b" category="list-text">NetApp不支持Windows Server存储空间。存储空间仅用于JBOD (即一组磁盘)、不适用于任何类型的RAID (直连存储[DAS]或SAN)。</block>
  <block id="b37ae3efea13417cff3fdb198db41274" category="list-text">ONTAP不支持Windows Server中的集群存储池。</block>
  <block id="436593f3429fec64588705fe44025823" category="list-text">NetApp支持在Windows SAN环境中使用共享虚拟硬盘格式(Virtual Hard Disk Format、VHDX)进行子系统集群。</block>
  <block id="a3a862b96d666cb7005617313f703378" category="list-text">Windows Server不支持使用iSCSI或FC LUN创建存储池。</block>
  <block id="570d38aae09bbf84ba37f9219909a7cb" category="list-text">有关NetApp PowerShell工具包的详细信息、请访问<block ref="12f72d9ce1eab5b7cd58718fecdd145c" category="inline-link-rx"></block>。</block>
  <block id="699f0a44719fb3de5404046fc6caa8af" category="inline-link">TR-4475：《NetApp PowerShell工具包最佳实践指南》</block>
  <block id="532d077f114744273b1a7cd2a4794077" category="list-text">有关NetApp PowerShell工具包最佳实践的信息、请参见<block ref="87b47631a9123c9d2a382039a9ba503e" category="inline-link-rx"></block>。</block>
  <block id="64f3248fbae79dd41841377bf7dd37c6" category="paragraph">以太网网络可以大致分为以下几组：</block>
  <block id="0047d4a23ffec6d4afe912d0a2598e58" category="list-text">VM的客户端网络</block>
  <block id="d6cf6da705ce58c7b649fea1cd43c470" category="list-text">再添加一个存储网络(连接到存储系统的iSCSI或SMB)</block>
  <block id="0d8658721aaab8eb43f9b6d72283b8f8" category="list-text">集群通信网络(集群节点之间的检测信号和其他通信)</block>
  <block id="338c97ec16c135df1c972ba5b92db129" category="list-text">管理网络(用于监控系统并对其进行故障排除)</block>
  <block id="7b6753ef35b59e8866faf1b43b213520" category="list-text">迁移网络(用于主机实时迁移)</block>
  <block id="0f31fc2f15105bd45773e0fe5a33814a" category="list-text">虚拟机复制(Hyper-V副本)</block>
  <block id="11ef3cd9dc7173f009417493a7a51f57" category="list-text">NetApp建议为上述每个功能配置专用物理端口、以实现网络隔离和性能。</block>
  <block id="84f729d0d6ae07e1ea7697e418337328" category="list-text">对于上述每个网络要求(存储要求除外)、可以聚合多个物理网络端口来分布负载或提供容错功能。</block>
  <block id="89831505b6fb0eb3bfb78852c3e8838a" category="list-text">NetApp建议在Hyper-V主机上创建一个专用虚拟交换机、用于在虚拟机中建立子系统存储连接。</block>
  <block id="301b0a1048a669cb6b56215ce25f83d2" category="list-text">确保Hyper-V主机和子系统iSCSI数据路径使用不同的物理端口和虚拟交换机、以实现子系统与主机之间的安全隔离。</block>
  <block id="38d14a6f7d54295d21bfb890bbfac145" category="list-text">NetApp建议避免对iSCSI NIC进行NIC绑定。</block>
  <block id="3b5eab23ccdc37978e26fa584647f2f5" category="list-text">NetApp建议使用在主机上配置的ONTAP多路径输入/输出(Multipath input/output、MPIO)进行存储。</block>
  <block id="6395caf6c767d5f8026b684721c1e27e" category="list-text">如果使用子系统iSCSI启动程序、NetApp建议在子系统VM中使用MPIO。如果使用直通磁盘、则必须避免在子系统中使用MPIO。在这种情况下、只需在主机上安装MPIO即可。</block>
  <block id="55892ded4e0eac09cd2bd256ea8e4f49" category="list-text">NetApp建议不要对分配给存储网络的虚拟交换机应用QoS策略。</block>
  <block id="9e33949565ff57eed3e484a27adca687" category="list-text">NetApp建议不要在物理NIC上使用自动专用IP寻址(Automatic Private IP Addressing、APIPA)、因为APIPA不可路由、并且未在DNS中注册。</block>
  <block id="b06f6cf7b5c4e8ac8117fe6238a15184" category="list-text">NetApp建议为CSV、iSCSI和实时迁移网络启用巨型帧、以提高吞吐量并缩短CPU周期。</block>
  <block id="d34fac956ae63cd93b204c541399ec3f" category="list-text">NetApp建议取消选中允许管理操作系统共享此网络适配器选项、以便Hyper-V虚拟交换机为VM创建专用网络。</block>
  <block id="0d3e51fc3c7ecb31cb6dcf3ea104060c" category="list-text">NetApp建议为实时迁移和iSCSI网络创建冗余网络路径(多个交换机)、以提供故障恢复能力和QoS。</block>
  <block id="72a46482f366b350b6b0215baa631137" category="summary">适用于Microsoft Windows和Hyper-V的其他资源</block>
  <block id="4bb047f8c530785002e490ef17fa725e" category="doc">从何处查找追加信息</block>
  <block id="0650b34324cf33e3bf1ba6d5db9aa14c" category="list-text">Hyper-V在Windows Server +上的新增功能
<block ref="8508224d602483e88bde8402b5d1f2d1" category="inline-link-rx"></block></block>
  <block id="1139a59d4aa15acd59f31d05c5a9d642" category="summary">本附录介绍如何在集群环境之外部署Hyper-V副本。</block>
  <block id="be9cfe5b3b6e5354686be0cb736fe70d" category="list-text">您需要将独立的Hyper-V服务器置于同一或不同的地理位置、用作主服务器和副本服务器。</block>
  <block id="427aef80e259ae74b835c2b646e8fba8" category="list-text">如果使用不同的站点、则必须将每个站点的防火墙配置为允许主服务器和副本服务器之间进行通信。</block>
  <block id="3ac92c1d06a47463c6ea9f2c4289a625" category="list-text">副本服务器必须有足够的空间来存储复制的工作负载。</block>
  <block id="6db575d6d23958eefd722c2559c2ae2b" category="list-text">配置副本服务器。</block>
  <block id="f348eb2699776a23b340068fa13ba378" category="list-text">为了使入站防火墙规则允许传入复制流量、请运行以下PowerShell cmdlet：</block>
  <block id="b3741a0bf4f272b05520af3145ce6b20" category="list-text">在操作中单击Hyper-V设置。</block>
  <block id="0b81c69f5b40344714e859c333f7e46d" category="list-text">单击复制配置并选择启用此计算机作为复本服务器。</block>
  <block id="23e173753ad1fc5a192335afcd91aaa2" category="list-text">在身份验证和端口部分中、选择身份验证方法和端口。</block>
  <block id="c67571ac7fd00493d3ca7147b7756914" category="list-text">在授权和存储部分中、指定用于存储复制的VM和文件的位置。</block>
  <block id="c6f470c780ac40391a73366709e36fae" category="list-text">为主服务器上的VM启用VM复制。VM复制按VM启用、而不是对整个Hyper-V服务器启用。</block>
  <block id="84f81856434a0c817bfd8ec7ba575d63" category="list-text">在Hyper-V Manager中、右键单击某个虚拟机、然后单击启用复制以打开启用复制向导。</block>
  <block id="bb27dca619d145c6538ad523a5c5aec7" category="list-text">提供必须复制VM的副本服务器的名称。</block>
  <block id="368e47c642802a224da6a1e9196c2345" category="list-text">提供身份验证类型以及配置为接收副本服务器上的复制流量的副本服务器端口。</block>
  <block id="df839b9a847de722b03fb6f8db4abd3d" category="list-text">选择要复制的VHD。</block>
  <block id="7e2b2defa62bab724dad332e0efe93d4" category="list-text">选择将更改发送到复本服务器的频率(持续时间)。</block>
  <block id="f1358329d5a84d751f47c4d4e4882286" category="list-text">配置恢复点以指定要在副本服务器上维护的恢复点数量。</block>
  <block id="13bb9737452c217970585237bf9a3c67" category="list-text">选择初始复制方法以指定将VM数据的初始副本传输到副本服务器的方法。</block>
  <block id="e7773df7e8bec8a84ededaaba6cc3b5c" category="list-text">查看摘要、然后单击完成。</block>
  <block id="eaa408dd6135876f9368b7e9e8447340" category="list-text">此过程会在副本服务器上创建VM副本。</block>
  <block id="c6c9686c38a42b00345f77c5ddbe044a" category="list-text">运行测试故障转移、以确保副本VM在副本服务器上正常运行。此测试将在副本服务器上创建一个临时VM。</block>
  <block id="4b07a5223e241d6b4d7935c2282616a5" category="list-text">登录到复本服务器。</block>
  <block id="baaaeb9b824a8922645198d46a10e27a" category="list-text">在Hyper-V Manager中、右键单击副本虚拟机、单击复制、然后单击测试故障转移。</block>
  <block id="b9950331695e861c821d48077fe8b1f1" category="list-text">选择要使用的恢复点。</block>
  <block id="b1d034cdaa7ef0d2bc761b948c78838a" category="list-text">此过程将创建一个同名VM、并附加-Test。</block>
  <block id="8c95c5ef4d5593fe860313c283fab784" category="list-text">验证虚拟机以确保一切正常。</block>
  <block id="e5c73308bdacf8978516ccda5462e80a" category="list-text">故障转移后、如果为副本测试VM选择停止测试故障转移、则会将其删除。</block>
  <block id="c4eacda4a6022cafe1bfc0d735075dce" category="list-text">运行计划内故障转移、将主VM上的最新更改复制到副本VM。</block>
  <block id="7c3c0f256f21e1f117a98a5afa47dd56" category="list-text">登录到主服务器。</block>
  <block id="2d6fd035cbd8062dcc29935ff448420e" category="list-text">关闭要进行故障转移的虚拟机。</block>
  <block id="582c3456f1d3f75fd04a3dfcdb20c132" category="list-text">在Hyper-V Manager中、右键单击已关闭的虚拟机、单击复制、然后单击计划内故障转移。</block>
  <block id="4ed0c56504eba0632689dfc8056e3c49" category="list-text">单击故障转移将最新的VM更改传输到副本服务器。</block>
  <block id="f490046b13ec9105a4adb8f885b5688f" category="list-text">在主VM发生故障时运行计划外故障转移。</block>
  <block id="c01438bcded7cda6d1ee326fa268f93c" category="list-text">在Hyper-V Manager中、右键单击副本虚拟机、单击复制、然后单击故障转移。</block>
  <block id="94faab2d3840f3d8320e20ad4a90e6cd" category="list-text">单击故障转移对虚拟机进行故障转移。</block>
  <block id="4be45953e45cfa5fc987ba108c1e5793" category="summary">本附录介绍如何在集群环境中部署实时迁移。</block>
  <block id="388b92a1de3321595dcfbdc1c67ce749" category="paragraph">要在集群环境中使用实时迁移、请完成以下步骤：</block>
  <block id="b66a6c742469f1d08a2d11bcf4f211ff" category="list-text">在故障转移集群管理器中、选择并展开集群。如果集群不可见、请单击故障转移集群管理器、单击连接到集群并提供集群名称。</block>
  <block id="e3883376513ba0aeb2f3d190d4e0377d" category="list-text">单击"Roles"(角色)、其中列出了集群中的所有可用虚拟机。</block>
  <block id="e164db40505184b94012bbbd4aa4c1a2" category="list-text">右键单击虚拟机、然后单击移动。这样可以为您提供三个选项：</block>
  <block id="6a1e101231f8f4bcd4a75390cc0eddc2" category="list-text">*实时迁移。*您可以手动选择节点、也可以允许集群选择最佳节点。在实时迁移中、集群会将虚拟机使用的内存从当前节点复制到另一个节点。因此、在将虚拟机迁移到另一个节点时、虚拟机所需的内存和状态信息已准备好。此迁移方法几乎是瞬时的、但一次只能实时迁移一个虚拟机。</block>
  <block id="4374953843b8a5507e79ee5145fd88cd" category="list-text">*快速迁移。*您可以手动选择节点或允许集群选择最佳节点。在快速迁移中、集群会将VM使用的内存复制到存储中的磁盘。因此、当VM迁移到另一节点时、另一节点可以快速从磁盘中读取VM所需的内存和状态信息。通过快速迁移、可以同时迁移多个VM。</block>
  <block id="f1321d73ebfb5a92e710d313fd53c21c" category="list-text">*虚拟机存储迁移。*此方法使用移动虚拟机存储向导。使用此向导、您可以选择要将虚拟机磁盘以及其他文件移至另一位置、该位置可以是CSV或SMB共享。</block>
  <block id="36397d251acf4232a7e91edc7ae649c7" category="summary">使用SMB3的适用于Hyper-V的ONTAP NAS存储</block>
  <block id="a06ae7fcee90c7ab1e1321d0dd8b2242" category="paragraph">ONTAP使用SMB3协议为Hyper-V虚拟机提供具有故障恢复能力的高性能NAS存储。</block>
  <block id="2efbb65fec3bad963652820bc484fe59" category="paragraph">使用CIFS协议创建SVM时、CIFS服务器会在Windows Active Directory域中的SVM之上运行。SMB共享可用于主目录以及托管Hyper-V和SQL Server工作负载。ONTAP支持以下SMB 3.0功能：</block>
  <block id="55339f66c60fe6973920932c368d5b51" category="list-text">永久性句柄(持续可用的文件共享)</block>
  <block id="94713d3b3a69a2fd695bffeb252007d3" category="list-text">见证协议</block>
  <block id="adb115272d11e09afdfd8702a652d626" category="list-text">集群客户端故障转移</block>
  <block id="f5025b9fcd1b24276af8ec2da3aa4cd7" category="list-text">横向扩展感知</block>
  <block id="81abcea6e16bc538d9843e8808b2066b" category="list-text">ODX</block>
  <block id="f4ad9c4d51155dbb3fb746c7c497c145" category="list-text">远程VSS</block>
  <block id="56a26f5f5f602966c3a3088fc05c7383" category="paragraph">在Windows Server的NAS环境中使用NetApp存储具有以下要求：</block>
  <block id="5f3a2953a5f6d187ed4babba3c754b95" category="list-text">ONTAP集群具有有效的CIFS许可证。</block>
  <block id="2744237d602ca5ed3f1a6370ed8ebe91" category="list-text">已至少创建一个聚合。</block>
  <block id="89917a1bea2d5c48569d9ed0a9526f74" category="list-text">此时将创建一个数据逻辑接口(LIF)、并且必须为CIFS配置数据LIF。</block>
  <block id="87a2c188e55f400a5936550cc2f91148" category="list-text">存在DNS配置的Windows Active Directory域服务器和域管理员凭据。</block>
  <block id="da920c4d42bb062c9dbfd877c84ef133" category="list-text">NetApp集群中的每个节点都会与Windows域控制器进行时间同步。</block>
  <block id="f04e0c239705cd7c6e249d3ed6991627" category="section-title">Active Directory域控制器</block>
  <block id="2e0bc40db7949b4af757ea11110ae955" category="paragraph">NetApp存储控制器可以加入与Windows Server类似的Active Directory并在其中运行。在创建SVM期间、您可以通过提供域名和名称服务器详细信息来配置DNS。SVM会尝试通过向DNS查询Active Directory/轻型目录访问协议(Lightweight-Directory Access Protocol、LDAP)服务器来搜索Active Directory域控制器、其方式与Windows Server类似。</block>
  <block id="dee2aa3e7614e2fc47c6fbbb5cd123b5" category="paragraph">要使CIFS设置正常工作、NetApp存储控制器必须与Windows域控制器进行时间同步。NetApp建议Windows域控制器与NetApp存储控制器之间的时间偏差不超过五分钟。最佳做法是、为ONTAP集群配置网络时间协议(Network Time Protocol、NTP)服务器、以便与外部时间源同步。要将Windows域控制器配置为NTP服务器、请在ONTAP集群上运行以下命令：</block>
  <block id="2d60b04429a0c7bcf1dc0021d1c01046" category="list-text">创建启用了NAS协议CIFS的新SVM。可以使用以下任一方法创建新的SVM：</block>
  <block id="26ed02718973e705cd69ee6e109400e0" category="list-text">System Manager</block>
  <block id="fc05c3b0a7017fa6841b856230e365bb" category="list-text">NetApp PowerShell工具包</block>
  <block id="bbee3ec15cf30d6e65d6a020f6d4af1e" category="list-text">配置CIFS协议</block>
  <block id="8de4bddcd1cd8e4614e52342eef41752" category="list-text">提供CIFS服务器名称。</block>
  <block id="a817c1f7bf7af809fd90c63b2a8e4447" category="list-text">提供CIFS服务器必须加入的Active Directory。您必须具有域管理员凭据才能将CIFS服务器加入Active Directory。</block>
  <block id="bf8cf0b24d936c2fe2e3681004650bf0" category="list-text">在每个集群节点上为SVM分配带有SVM的许可证。</block>
  <block id="5d77fb569194f93fead7154a8d1d1bc3" category="list-text">在SVM上启动CIFS服务。</block>
  <block id="547edc4d2fb156c3e495e6325eae5a4a" category="list-text">从聚合创建采用NTFS安全模式的卷。</block>
  <block id="1418b945a2d25e4f6514fc52e9d6c7ef" category="list-text">在卷上创建qtree (可选)。</block>
  <block id="f0bbe023b40d4d11ed83d36a68894cae" category="list-text">创建与卷或qtree目录对应的共享、以便可以从Windows Server访问这些共享。如果共享用于Hyper-V存储、请在创建共享期间选择为Hyper-V启用持续可用性。这样可以为文件共享启用高可用性。</block>
  <block id="9ef47a6b1a5d19245750aa732054173a" category="list-text">编辑已创建的共享、并根据需要修改访问此共享的权限。必须配置SMB共享的权限、才能为访问此共享的所有服务器的计算机帐户授予访问权限。</block>
  <block id="053003e418b94e54d509f16e6a5ac54f" category="paragraph">要检测先前使用Windows Server创建的CIFS共享、请完成以下步骤：</block>
  <block id="9eb306535570bd14746bad4f0768684f" category="list-text">以管理员组成员的身份登录到Windows Server。</block>
  <block id="4cac21133029fce3cd01fb6d42f8bedb" category="list-text">转至run.exe并键入为访问此共享而创建的CIFS共享的完整路径。</block>
  <block id="cf48b5bae22bbcd1956b57470865f653" category="list-text">要将共享永久映射到Windows Server、请右键单击此PC、单击映射网络驱动器、然后提供CIFS共享的路径。</block>
  <block id="304c9374426bb10ac275b8d050d77a72" category="list-text">要在Windows Server中打开MMC、请单击Server Manager的Tools部分中的Computer Management。</block>
  <block id="e731a6a9193d81f0140801ba9fb7c316" category="list-text">单击更多操作并连接到另一台计算机、此时将打开选择计算机对话框。</block>
  <block id="92b70da99a18efe7530353abe1820089" category="list-text">输入CIFS服务器的名称或SVM LIF的IP地址以连接到CIFS服务器。</block>
  <block id="2d6dbdc8809506c631cd711d19c21958" category="list-text">展开系统工具和共享文件夹以查看和管理打开的文件、会话和共享。</block>
  <block id="3a38167e840fd7939f34e194afadd957" category="list-text">为了确认在将卷从一个节点移至另一个节点时或在某个节点出现故障时不会出现停机、NetApp建议您在文件共享上启用持续可用性选项。</block>
  <block id="7a98f276625e5966a817f0783982ef86" category="list-text">在为基于SMB的Hyper-V环境配置VM时、NetApp建议您在存储系统上启用副本卸载。这样可以缩短VM的配置时间。</block>
  <block id="8bb66ec4b6ef9437bd1c4c88328028b9" category="list-text">如果存储集群托管多个SMB工作负载、例如SQL Server、Hyper-V和CIFS服务器、则NetApp建议将不同的SMB工作负载托管在不同聚合上的不同SVM上。这种配置非常有用、因为其中每个工作负载都需要具有唯一的存储网络和卷布局。</block>
  <block id="ce424317fa59851e16cfbe4cbac13386" category="list-text">在将VM从一个SMB 3.0共享迁移到另一个共享时、NetApp建议在存储系统上启用CIFS副本卸载功能、以便加快迁移速度。</block>
  <block id="be7159d8a65544f2712c72dc0254f9be" category="list-text">在为SMB环境配置卷时、必须使用NTFS安全模式创建卷。</block>
  <block id="bb17c7edf27266c09bc64edcc1299db5" category="list-text">应相应地设置集群中节点的时间设置。如果NetApp CIFS服务器必须加入Windows Active Directory域、请使用NTP。</block>
  <block id="261b72d9729025ebf489205324a048d5" category="list-text">永久性句柄仅在HA对中的节点之间起作用。</block>
  <block id="e185fb0d3a49c7a3318c954d8aa25c05" category="list-text">见证协议仅在HA对中的节点之间有效。</block>
  <block id="67d7fd26a92bba839041dd45a19cec56" category="list-text">只有Hyper-V和SQL Server工作负载才支持持续可用的文件共享。</block>
  <block id="fa2e04a9f0cdcb5ad0e9f1e5ad1ada82" category="list-text">从ONTAP 9.4开始、支持SMB多通道。</block>
  <block id="f357368b2f195de4f8b4463eed2bf004" category="list-text">不支持RDMA。</block>
  <block id="f55cb235b18bf3d499f9276cd235bfb6" category="list-text">不支持ReFS。</block>
  <block id="fb97dc994a0600d8610daca021159b33" category="paragraph">在NetApp存储控制器上访问CIFS共享上的数据时、纳米服务器不需要额外的客户端软件。</block>
  <block id="2be09e0be799992463b5c9542ce31dd8" category="paragraph">要将文件从到文件复制到CIFS共享、请在远程服务器上运行以下cmdlet：</block>
  <block id="2e0d4f41db110bf64a66493b31c9b168" category="list-text"><block ref="6f88c516ba3d9ab0cd23b81fc43dd697" prefix="" category="inline-code"></block> 是NetApp存储控制器上的CIFS共享。</block>
  <block id="5e017ad7a7df43934bccc7c27031a140" category="list-text">若要将文件复制到"之时"、请运行以下cmdlet：</block>
  <block id="d153ba0c2e04ac16dcece009a842216e" category="paragraph">要复制文件夹的整个内容、请指定文件夹名称、并在cmdlet末尾使用-Recurse参数。</block>
  <block id="c9f4515194bc7b2927aa17b7d9b4aa25" category="summary">如何配置Hyper-V存储实时迁移</block>
  <block id="a49764977574be237e816e868b16bd9e" category="doc">部署Hyper-V存储实时迁移</block>
  <block id="587db979ac1f69c45774cb09d6d6670b" category="paragraph">了解如何配置Hyper-V存储实时迁移</block>
  <block id="0146445d75059a401441fd65f1bae1e0" category="list-text">您必须拥有一个独立的Hyper-V服务器、该服务器必须具有独立的存储(DAS或LUN)或SMB存储(本地或在其他Hyper-V服务器之间共享)。</block>
  <block id="71c2ecf4798ba7bf00669c37826cb55b" category="inline-link-macro">在已加入的环境之外进行实时迁移</block>
  <block id="4a8052295fad176b01067c772f7c7e5d" category="list-text">必须为Hyper-V服务器配置实时迁移。查看中有关部署的部分 <block ref="0e7f526c94c2d5b9ef424b7a8a1c9587" category="inline-link-macro-rx"></block>。</block>
  <block id="43434644e024fa3073cc9c64dba551d0" category="list-text">打开Hyper-V Manager。</block>
  <block id="3999a6e17f16c7f048684f76a1a59e38" category="list-text">右键单击某个虚拟机、然后单击移动。</block>
  <block id="1d838d1a72e03329477d7f4024eec108" category="list-text">选择移动虚拟机的存储。</block>
  <block id="45d2d7245527e5e6e9be62e79d5a46d8" category="list-text">根据您的首选项选择用于移动存储的选项。</block>
  <block id="13d0ba1c0320910efd0d040f2d461527" category="list-text">提供VM项目的新位置。</block>
  <block id="6efadc6e298c560f1699100ac97c7378" category="list-text">查看摘要、然后单击确定以移动虚拟机的存储。</block>
  <block id="b2d949a2d7f46bb1e39037d38eea14e4" category="summary">借助Microsoft Hyper-V提高ONTAP存储效率</block>
  <block id="bd2eab4ffe0ab602b60386dfdd3ef913" category="paragraph">ONTAP为包括Microsoft Hyper-V在内的虚拟化环境提供行业领先的存储效率NetApp还提供存储效率担保计划。</block>
  <block id="e957a0e8016b502f05bb1966b2ec6064" category="paragraph">NetApp重复数据删除的工作原理是、在存储卷级别删除重复块、仅存储一个物理副本、而不管存在多少逻辑副本。因此、重复数据删除会造成该块存在大量副本的假象。重复数据删除会自动删除整个卷中4 KB块级别的重复数据块。此过程可通过减少对磁盘的物理写入次数来恢复存储、从而节省空间并潜在地节省性能。重复数据删除可在Hyper-V环境中节省70%以上的空间。</block>
  <block id="44ee5e4157e5291ffc8bc5d1d9b5959d" category="paragraph">精简配置是一种高效的存储配置方式、因为存储不会预先分配。也就是说、在使用精简配置创建卷或LUN时、存储系统上的空间未使用。在将数据写入LUN或卷之前、此空间会一直保持未使用状态、并且仅会使用存储此数据所需的空间。NetApp建议在卷上启用精简配置并禁用LUN预留。</block>
  <block id="8bc14f0cb78851f59e85c1d447c2c99f" category="section-title">Quality of service</block>
  <block id="8649c492f1adfda9b6ab44990a1a7580" category="paragraph">在企业环境中、存储服务质量(QoS)有助于实现以下目标：</block>
  <block id="ca944817219b4a5d2cb25894ee7bac2d" category="list-text">防止用户工作负载相互影响。</block>
  <block id="1d5819479882e9b1b8133fda618801e5" category="list-text">保护在IT即服务(ITaaS)环境中必须满足特定响应时间的关键应用程序。</block>
  <block id="b06d1116eb0db3e3c8c51d1707dfcf99" category="list-text">防止租户相互影响。</block>
  <block id="1d7dd784ada3e9fe62630025fa82dc80" category="list-text">通过添加每个新租户避免性能下降。</block>
  <block id="3c7577ceba90e087950e69f357ce949b" category="paragraph">使用QoS、您可以限制发送到SVM、灵活卷、LUN或文件的I/O量。I/O可受操作数或原始吞吐量的限制。</block>
  <block id="0ac164a0cdedc812bd371348407d8df2" category="paragraph">下图显示了SVM及其自身的QoS策略强制实施最大吞吐量限制。</block>
  <block id="4cd97525569a4c4f332a1fbadea31367" category="inline-image-macro">具有自己的QoS策略的Storage Virtual Machine、宽度=319、高度=341</block>
  <block id="11751e265ace69b487d325224006c7e5" category="paragraph"><block ref="11751e265ace69b487d325224006c7e5" category="inline-image-macro-rx" type="image"></block></block>
  <block id="42674eda4c194d913efb361684c8b8c6" category="paragraph">要为SVM配置自己的QoS策略和监控策略组、请在ONTAP集群上运行以下命令：</block>
  <block id="2398ac10b8f12f8d175464af41b6cc27" category="summary">了解如何部署Microsoft Windows MicroServer</block>
  <block id="60aa20a9330bfedece833eb6496e61dc" category="doc">部署一个存储管理器</block>
  <block id="751f4ae88fb7c0e83c557b594f24f467" category="paragraph">了解如何部署Microsoft Windows MicroServer。</block>
  <block id="ffd8df9c68fc3e1710ed9dc15dec9225" category="paragraph">要将一个Hyper－V主机部署为一个Hyper－V主机，请完成以下步骤：</block>
  <block id="e93afc2a7bab8945ac834e9f955ab2c8" category="list-text">要创建一个"Vano Server VHD/VHDX"、请完成以下步骤：</block>
  <block id="3b515a3daeec18784951623c4ef02332" category="list-text">通过运行以下PowerShell cmdlet、为作为Hyper-V主机的Hyper Server创建一个vHD。此命令会提示您输入新的HD的管理员密码。</block>
  <block id="2ef6d24f20fa6986cbd70ea844d3e16e" category="list-text">在以下示例中、我们创建了一个启用了故障转移集群的Hyper-V主机功能的"Hyper Server VHD"。此示例将从装载在f：\的ISO创建一个红外服务器VHD。新创建的VHD将放置在运行cmdlet的文件夹中名为纳诺服务器的文件夹中。计算机名称为NanoServer、生成的VHD包含Windows Server的标准版本。</block>
  <block id="7f165cd40e3ab8b56d69cfdf799ebb23" category="list-text">使用cmdlet New-NamoServerImage、配置参数以设置IP地址、子网掩码、默认网关、DNS服务器、域名、 等等。</block>
  <block id="9ba9f17628c7c8e123a1c4d0b154e1e0" category="list-text">在虚拟机或物理主机中使用vHD将Hyper Server部署为Hyper-V主机：</block>
  <block id="7482916c1c66ae16c274920ca01eda80" category="list-text">要在虚拟机上部署、请在Hyper-V Manager中创建一个新虚拟机、并使用步骤3中创建的vHD。</block>
  <block id="8a1f197a1a3903636fe46d151b55f1a4" category="list-text">要在物理主机上部署、请将该虚拟磁盘复制到物理计算机、并将其配置为此新的虚拟磁盘启动。首先、挂载该vHD、运行bcdboot e：\windows (其中、该vHD挂载在E：\下)、卸载该vHD、重新启动物理计算机、然后启动到"ano Server"(数据源)。</block>
  <block id="1a2fbb26db89a11f849f5a17170449b5" category="list-text">将该服务器加入域(可选)：</block>
  <block id="fa966a71fb7e787a036cc8ae2df719c2" category="list-text">登录到域中的任何计算机并运行以下PowerShell cmdlet创建数据Blob：</block>
  <block id="5e83141959914643e6e309d32cb02675" category="list-text">通过在远程计算机上运行以下PowerShell cmdlet、将odjblob文件复制到"No"服务器：</block>
  <block id="9493ca9bfebee08582b48c95f6ad1768" category="list-text">重新启动"The "The "The "The "</block>
  <block id="24d48ec9863eca883370d9e471e7dec1" category="section-title">连接到AO服务器</block>
  <block id="11e7dceca10309920a26c38df3c5f421" category="paragraph">要使用PowerShell远程连接到AO服务器、请完成以下步骤：</block>
  <block id="08d7b9e67b4bbd447b1fa3d9103976e8" category="list-text">通过在远程服务器上运行以下cmdlet、将该客户端添加为远程计算机上的受信任主机：</block>
  <block id="0b1f1a420d35761f550f4a9f3b9e2ecb" category="list-text">如果环境安全、并且您要将要添加为服务器上可信主机的所有主机设置为可信主机、请运行以下命令：</block>
  <block id="06879aa989dffc1c877a92441f72d474" category="list-text">通过在远程服务器上运行以下cmdlet来启动远程会话。出现提示时、请提供该服务器的密码。</block>
  <block id="c5363e6f2cab660a02c04316d65097b5" category="paragraph">要使用GUI管理工具从远程Windows Server远程连接到AO Server、请完成以下命令：</block>
  <block id="d97c0d550aa0ad1af548a89c27d9f7ea" category="list-text">以管理员组成员的身份登录到Windows Server。</block>
  <block id="ff621b1b3a7bcf389fc4c97a55bf9505" category="list-text">要从服务器管理器远程管理一个"栏"、请右键单击"所有服务器"、单击"添加服务器"、提供"栏"信息、然后添加。现在、您可以在服务器列表中看到列出的"办事 项"。选择"Fibre Server"、右键单击它、然后使用提供的各种选项开始对其进行管理。</block>
  <block id="2343c80f9e6b008ea95cc15026c9c094" category="list-text">要远程管理在一台至一台至多台的服务器上运行的服务、请完成以下步骤：</block>
  <block id="1430c8ff3134db821cc65ac53e010d4d" category="list-text">从服务器管理器的工具部分打开服务。</block>
  <block id="358fe30f1157bd64dad7a3aba4e40f94" category="list-text">右键单击"Services (Local)"(服务(本地))。</block>
  <block id="72fa515e487f796b536e03179e63e7db" category="list-text">单击连接到服务器。</block>
  <block id="50ec7cc625733992673123275ff834d6" category="list-text">提供"The "The "为 您提供"详细信息、以查看和管理"The "为 您提供的服务。</block>
  <block id="f322fcdc841439901a45a176928f80e0" category="list-text">如果在Hyper服务器上启用了Hyper-V角色、请完成以下步骤以从Hyper-V Manager远程管理它：</block>
  <block id="14994643f0c569708527514d0405c1e5" category="list-text">右键单击Hyper-V Manager。</block>
  <block id="8e0877f5a8a5d540837664b9de1070ca" category="list-text">单击Connect to Server (连接到服务器)、然后提供有关该服务器的详细信息。现在、可以将该Hyper服务器作为Hyper-V服务器进行管理、以便在其上创建和管理VM。</block>
  <block id="b2c5e9024429f1b7f8581d1747d25fd6" category="list-text">如果已在该服务器上启用故障转移集群角色、请完成以下步骤、以便从故障转移集群管理器远程管理该角色：</block>
  <block id="31b3efaeee0b35b5bde4f1353f947b93" category="list-text">从服务器管理器的"Tools"部分打开故障转移集群管理器。</block>
  <block id="2cb85a898a7a975600dcc1bea85df531" category="list-text">使用该软件执行与集群相关的操作。</block>
  <block id="2810ba8ba9d5e4319af85df66ddf2286" category="summary">采用Hyper-V的ONTAP存储安全性</block>
  <block id="2fae32629d4ef4fc6341f1751b405e45" category="doc">安全性</block>
  <block id="6ca21561032e8c064bc8514ab2e92740" category="paragraph">ONTAP可为Windows操作系统提供安全的存储系统。</block>
  <block id="615e826f5576798f024d7959ccefc794" category="section-title">Windows Defender防病毒</block>
  <block id="2861d3b5f4351fd51979bf98547a050b" category="paragraph">默认情况下，Windows Defender是在Windows Server上安装并启用的反恶意软件。此软件可主动保护Windows Server免受已知恶意软件的影响、并可通过Windows Update定期更新反恶意软件定义。可以使用Windows Defender扫描NetApp LUN和SMB共享。</block>
  <block id="a86f08bae2bbd68aa81b64f748f3ccb8" category="inline-link">Windows Defender概述</block>
  <block id="4b51dd417e2be3fdc9a793c3290e3a63" category="paragraph">有关详细信息、请参见<block ref="d66127569e4d44a2d0a35bc9d20b1ea7" category="inline-link-rx"></block>。</block>
  <block id="ce71fc775b37c52dabd938808de8d0f9" category="section-title">BitLocker</block>
  <block id="8d9091beebb755bb6e68a4f04d3288f6" category="paragraph">BitLocker驱动器加密是一项数据保护功能、从Windows Server 2012开始持续提供。这种加密可保护物理磁盘、LUN和LV。</block>
  <block id="0494cad48bf6f5dd2105391f0426af1a" category="paragraph">启用BitLocker之前、必须将CSV置于维护模式。因此、NetApp建议在CSV上创建VM之前、应先确定与基于BitLocker的安全性相关的决策、以避免停机。</block>
  <block id="e2e4ca1a6c3bcca61ed5ec3ea10c90c0" category="summary">了解如何使用Windows Server故障转移集群部署和配置Hyper-V副本。</block>
  <block id="5674fdbee301f444dd0ca3836c682957" category="list-text">如果使用不同的站点、则必须将每个站点的防火墙配置为允许主集群与副本集群之间进行通信。</block>
  <block id="6cc66ed27b17f9c380f924d533e633d6" category="list-text">副本集群必须具有足够的空间来存储复制的工作负载。</block>
  <block id="ff71768b9e039ee5012c181eb29bdc39" category="list-text">在集群的所有节点上启用防火墙规则。在主集群和副本集群中的所有节点上使用管理员权限运行以下PowerShell cmdlet。</block>
  <block id="ac005fe375c3903e88ed3801a8646b0a" category="list-text">配置副本集群。</block>
  <block id="3a57da55cdc319b0580af329b8776df6" category="list-text">使用NetBIOS名称和IP地址配置Hyper-V副本代理、以用作与用作副本集群的集群的连接点。</block>
  <block id="643ce0b9206c6c138b36b79315a468f2" category="list-text">打开故障转移集群管理器。</block>
  <block id="52243c461a19e74a8e4b64d801979142" category="list-text">展开集群、单击角色、然后单击从操作中配置角色窗格。</block>
  <block id="f87ee1c8e6945b31ba45ee813ea7c124" category="list-text">在选择角色页面中选择Hyper-V副本代理。</block>
  <block id="fdbea454936dca227734d3f978334254" category="list-text">提供要用作集群连接点(客户端访问点)的NetBIOS名称和IP地址。</block>
  <block id="bb8627cc57d25f02546b85f38d97ae04" category="list-text">此过程将创建Hyper-V副本代理角色。验证它是否已成功联机。</block>
  <block id="9b11f91c42607554f82ca0c4a5739d14" category="list-text">配置复制设置。</block>
  <block id="662af7cfca9243c46223a416df05d774" category="list-text">右键单击在前面步骤中创建的副本代理、然后单击复制设置。</block>
  <block id="45375ee44c681920240b13f25bf53d9e" category="list-text">选择启用此群集作为复本服务器。</block>
  <block id="88aeceb8128e3b94092a3e66ac2236db" category="list-text">在授权和存储部分中、选择允许将VM复制到此集群的服务器。此外、指定复制的VM的默认存储位置。</block>
  <block id="3d9241b7079c08f25c850a7d8ac5eebd" category="inline-link-macro">在一个或多个副本之间进行复制</block>
  <block id="3077be518a570235f65497aa5b227e9b" category="paragraph">复制过程与一节中所述的过程类似 <block ref="85d27647a4d4ffb042b0371e9654ea4c" category="inline-link-macro-rx"></block>。</block>
  <block id="f8b7d7bb25e13b6b771e58da1fa078cb" category="summary">在SAN环境中为Windows和Hyper-V配置ONTAP存储</block>
  <block id="24294828f9d26e2b73b5b1e0eda7a2d0" category="paragraph">ONTAP SVM支持块协议iSCSI和FC。使用块协议iSCSI或FC创建SVM时、SVM将分别获得iSCSI限定名称(IQN)或FC全球通用名称(WWN)。此标识符为访问NetApp块存储的主机提供SCSI目标。</block>
  <block id="7f33f1b99e752967fce41fe3dec9f051" category="section-title">在Windows Server上配置NetApp LUN</block>
  <block id="025d3d39bb1937ffe40a12b1917e28b6" category="paragraph">在Windows Server的SAN环境中使用NetApp存储具有以下要求：</block>
  <block id="3e306b32d1acc6cfcca681b93d8d57cd" category="list-text">NetApp集群配置有一个或多个NetApp存储控制器。</block>
  <block id="3e0ea625c6f590606b5242be6455347c" category="list-text">NetApp集群或存储控制器具有有效的iSCSI许可证。</block>
  <block id="5bf7c7c03ed76506f8822badb526f0a8" category="list-text">iSCSI和/或FC配置的端口可用。</block>
  <block id="46434438c1896350bc085c1a67785198" category="list-text">FC分区在FC的FC交换机上执行。</block>
  <block id="1e704db41d570618bd723b41d0db395e" category="list-text">在要使用iSCSI或光纤通道提供数据的每个存储控制器上、SVM的每个以太网网络或光纤通道网络都应具有一个LIF。</block>
  <block id="daa700de515c2e157d34b0e12c154478" category="list-text">创建启用了块协议iSCSI和/或FC的新SVM。可以使用以下任一方法创建新的SVM：</block>
  <block id="ec642b047305fbfe6db973f313768eae" category="list-text">NetApp存储上的命令行界面命令</block>
  <block id="43736124eda42b8dec979b188b9d891b" category="list-text">配置iSCSI和/或FC协议。</block>
  <block id="51dbb9050f89d2c5cbfda6a46bb48963" category="list-text">在SVM上启动iSCSI和/或FC服务。</block>
  <block id="5058f1af8388633f609cadb75a75dc9d" category="paragraph">。</block>
  <block id="80967cdacf7a48c49276c07097765c46" category="list-text">使用SVM SVM创建iSCSI和/或FC端口集。</block>
  <block id="2d59cbd9d3169fc27e47164a0bf60c42" category="list-text">使用创建的端口集为Windows创建iSCSI和/或FC启动程序组。</block>
  <block id="b6efc79e22c0381d9fcc8c3f40ff674f" category="list-text">将启动程序添加到启动程序组。启动程序是iSCSI的IQN和FC的WWPN。可以通过运行PowerShell cmdlet GET－InitiatorPort从Windows Server查询这些参数。</block>
  <block id="ab39c1b30c8045ee5b2419b682b64e5c" category="paragraph">也可以在iSCSI启动程序属性的配置中检查Windows Server上iSCSI的IQN。</block>
  <block id="83f0120a854049de17bd46bb97e5c5fa" category="list-text">使用创建LUN向导创建LUN、并将其与创建的启动程序组关联。</block>
  <block id="186c31b1cbf72f8c54f9c6a0edca1cfe" category="paragraph">Windows Server使用非对称逻辑单元访问(ALUA)扩展MPIO来确定LUN的直接和间接路径。即使SVM拥有的每个LIF都接受其LUN的读/写请求、但在任何给定时刻、实际上只有一个集群节点拥有支持该LUN的磁盘。这会将LUN的可用路径划分为两种类型：直接路径或间接路径、如下图所示。</block>
  <block id="6b08a0deb0bef5f6429e5fb7bab4da29" category="inline-image-macro">SAN环境中的多个路径、宽度=624、高度=232</block>
  <block id="e5106eaf1ca3b8ff0d6a4555b38845de" category="paragraph"><block ref="e5106eaf1ca3b8ff0d6a4555b38845de" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7e6c7f4878b6fa562299bd45be030c4d" category="section-title">MPIO</block>
  <block id="90881f9a41c6c14a994dd6d410b5eae3" category="section-title">启用MPIO</block>
  <block id="1f4614ecf24e855792cb4a72e2ca4a86" category="paragraph">要在Windows Server上启用MPIO、请完成以下步骤：</block>
  <block id="bb35cb72ffe2e8dd1a02cf65b86c6cd3" category="list-text">启动服务器管理器。</block>
  <block id="d580309cd21fec5dd6a0fc9e095dacbe" category="list-text">在管理部分中、单击添加角色和功能。</block>
  <block id="19c0c759d805032bc93817553dbc8ef9" category="list-text">在选择功能页面中、选择多路径I/O</block>
  <block id="63c2082592ff76eac0541130a24e7670" category="section-title">配置MPIO</block>
  <block id="655995aa16b525227f20b4e6b55a22cf" category="paragraph">使用iSCSI协议时、必须在MPIO属性中指示Windows Server对iSCSI设备应用多路径支持。</block>
  <block id="3cdb8cf9c5fe85e070ceba959169e83f" category="paragraph">要在Windows Server上配置MPIO、请完成以下步骤：</block>
  <block id="bd27f39c0a288d0682b789a806d1eec7" category="list-text">以管理员组成员的身份登录到Windows Server。</block>
  <block id="a267872bfc142a132ea159cb0904930f" category="list-text">在Tools部分中、单击MPIO。</block>
  <block id="46205f4b1d4b254565cae2fd6970a3a6" category="list-text">在"Discover Multi-paths"(发现多路径)上的"MPIO Properties"(MPIO属性)中、选择"Add Support for iSCSI Devices"(添加对iSCSI设备的支持)、然后会提示您重新启动计算机。</block>
  <block id="8c372bcf6ff4084f9e072d698d449b18" category="list-text">重新启动Windows Server以查看MPIO属性的MPIO设备部分中列出的MPIO设备。</block>
  <block id="28f21ae88e9953ac3d80686cfb49832b" category="section-title">配置iSCSI</block>
  <block id="a12e2e6108a8b8cb032c190ebe798d79" category="paragraph">要在Windows Server上检测iSCSI块存储、请完成以下步骤：</block>
  <block id="623f636e32ba5729ab907ad3eeeb5adb" category="list-text">在工具部分中、单击iSCSI启动程序。</block>
  <block id="d259349ad54c81b69ffb57d045a7c135" category="list-text">在发现选项卡下、单击发现门户。</block>
  <block id="9055f8c4230cf1268018d9b81d1c30e0" category="list-text">提供与为适用于SAN的NetApp存储协议创建的SVM关联的SVM的IP地址。单击高级、在常规选项卡中配置信息、然后单击确定。</block>
  <block id="56fe767f1eb1a3401bb37455b6e1c804" category="list-text">iSCSI启动程序会自动检测iSCSI目标、并将其列在目标选项卡中。</block>
  <block id="f6357f1aad932cb8ef210a786e72e1e9" category="list-text">在已发现的目标中选择iSCSI目标。单击"Connect"(连接)以打开"Connect to Target"(连接到目标)窗口。</block>
  <block id="28d26404caba20cb28577f61c51a7e1f" category="list-text">您必须创建从Windows Server主机到NetApp存储集群上的目标iSCSI LUN的多个会话。为此，请完成以下步骤：</block>
  <block id="3aef6deb3c61c368bc66313781c8e351" category="list-text">在Connect to Target窗口中、选择Enable MPIO、然后单击Advanced。</block>
  <block id="d754cac9ca73d1113c5fa5908ca2dc97" category="list-text">在常规选项卡下的高级设置中、选择本地适配器作为Microsoft iSCSI启动程序、然后选择启动程序IP和目标门户IP。</block>
  <block id="fdcb9587e9c4d393ea337f94fb0e1f5f" category="list-text">您还必须使用第二条路径进行连接。因此、重复步骤5到步骤8、但这次为第二个路径选择启动程序IP和目标门户IP。</block>
  <block id="cb35c153406b8cdeb5963bd9a0ceb501" category="list-text">在iSCSI属性主窗口的已发现目标中选择iSCSI目标、然后单击属性。</block>
  <block id="2a3977b58760a2b4c9e557175a5e494e" category="list-text">“属性”窗口显示检测到多个会话。选择会话、单击设备、然后单击MPIO以配置负载平衡策略。此时将显示为设备配置的所有路径、并且支持所有负载平衡策略。NetApp通常建议使用子集进行轮循环、并且此设置是启用了ALUA的阵列的默认设置。对于不支持AUA的主动-主动阵列、默认设置为轮由。</block>
  <block id="7b7b8262c038321869fc17ba522bbe07" category="paragraph">要在Windows Server上检测iSCSI或FC块存储、请完成以下步骤：</block>
  <block id="7554b29976a023cca6089775e3a7fd73" category="list-text">单击服务器管理器的工具部分中的计算机管理。</block>
  <block id="b7e726cedaa814db32dbfe4395773cc4" category="list-text">在计算机管理中、单击存储中的磁盘管理部分、然后单击更多操作和重新执行磁盘。这样会显示原始iSCSI LUN。</block>
  <block id="8fd13d2e47a19c784864b40dc7e4621f" category="list-text">单击发现的LUN并使其联机。然后选择使用MBR或GPT分区初始化磁盘。通过提供卷大小和驱动器号来创建一个新的简单卷、并使用FAT、FAT32、NTFS或弹性文件系统(Resilient File System、ReFS)对其进行格式化。</block>
  <block id="31ef353687ab7c0fb280206b2eba67d0" category="list-text">NetApp建议在托管LUN的卷上启用精简配置。</block>
  <block id="de065768c0f0b724b1926b25d92fdcef" category="list-text">为避免多路径问题、NetApp建议对给定LUN使用全部10 Gb会话或全部1 Gb会话。</block>
  <block id="ed4eb5407c23e138e99781446b4170d8" category="list-text">NetApp建议您确认已在存储系统上启用ALOA。默认情况下、ONTAP上会启用AUA。</block>
  <block id="df0f70c4f2bca2f5f0216ab40982d08a" category="list-text">在NetApp LUN映射到的Windows Server主机上、在防火墙设置中为入站启用iSCSI服务(tcp-in)、为出站启用iSCSI服务(tcp-out)。这些设置允许iSCSI流量进出Hyper-V主机和NetApp控制器。</block>
  <block id="defe090ca065bb89790c1a0b2d533ad0" category="section-title">在NetApp服务器上配置LUN</block>
  <block id="a7b1fc24d300b03d303a4e66fd5eaf19" category="inline-link-macro">部署一个存储管理器。</block>
  <block id="c56e09ae358fe6206c8e4059eb76252b" category="paragraph">除了上一节所述的前提条件之外、还必须从"纳 科服务器"端启用存储角色。例如、必须使用-Storage选项来部署到新服务器。若要部署到您的服务器、请参见"<block ref="00a4a5119b1e43564baa188fc895d5ff" category="inline-link-macro-rx"></block>"</block>
  <block id="152dbede177bc5347922fdc2b306adf2" category="paragraph">要在一台NetApp服务器上配置LUN、请完成以下步骤：</block>
  <block id="fe02f402a046a8784957e096b11835e3" category="list-text">按照"<block ref="60e7ef5a283935545371795472ceb490" category="inline-link-macro-rx"></block>。 "</block>
  <block id="1b3c1a51c3603283ec4f7ab199a89ad3" category="list-text">要配置iSCSI、请在NAS服务器上运行以下PowerShell cmdlet：</block>
  <block id="5e885af04f617a09b29600bd064e0a82" category="list-text">将启动程序添加到启动程序组。</block>
  <block id="8a73c7acbdf9fc31a87cebe8de47a176" category="list-text">配置MPIO。</block>
  <block id="8e08d5639ddc5bf9f71aeea2f9df6706" category="list-text">检测块存储。</block>
  <block id="ad04ba98fa2a26c6e2a4f71314b1c4c7" category="section-title">从SAN启动</block>
  <block id="e29512aa6180bca309f145289f08337c" category="paragraph">物理主机(服务器)或Hyper-V虚拟机可以直接从NetApp LUN (而不是其内部硬盘)启动Windows Server操作系统。在从SAN启动方法中、要从中启动的操作系统映像驻留在连接到物理主机或VM的NetApp LUN上。对于物理主机、物理主机的HBA会配置为使用NetApp LUN进行启动。对于VM、NetApp LUN作为直通磁盘连接以进行启动。</block>
  <block id="2cf07cb81d5366158ac32b0d02e3bf39" category="paragraph">使用NetApp FlexClone技术、可以即时克隆具有操作系统映像的启动LUN并将其连接到服务器和VM、以快速提供干净的操作系统映像、如下图所示。</block>
  <block id="e60c0a021a1a11ca0fd66050c818b441" category="inline-image-macro">使用NetApp FlexClone启动LUN、宽度=561、高度=357</block>
  <block id="79f4f54e05eb2f1c2084e0542e66f182" category="paragraph"><block ref="79f4f54e05eb2f1c2084e0542e66f182" category="inline-image-macro-rx" type="image"></block></block>
  <block id="738e6a96e2bf795b59ac62d4827a779e" category="list-text">物理主机(服务器)具有正确的iSCSI或FC HBA。</block>
  <block id="7957c1b3b06b3ca5c17a05da5e59c9ec" category="list-text">您已为支持Windows Server的服务器下载合适的HBA设备驱动程序。</block>
  <block id="1810f78aa22a9972644e65ac2cdad107" category="list-text">服务器具有合适的CD/DVD驱动器或虚拟介质以插入Windows Server ISO映像、并且已下载HBA设备驱动程序。</block>
  <block id="0af744e0f07c6b198e478b2ba83aca3a" category="list-text">在NetApp存储控制器上配置了NetApp iSCSI或FC LUN。</block>
  <block id="30e2bee2ccadbae82d2d5aeddd5b4078" category="paragraph">要为物理主机配置从SAN启动、请完成以下步骤：</block>
  <block id="7d90eb9f56cbfbfe2930a2d651f51f3a" category="list-text">在服务器HBA上启用BootBIOS。</block>
  <block id="034cb1858f7a3762e67e18bff38aa62a" category="list-text">对于iSCSI HBA、请在启动BIOS设置中配置启动程序IP、iSCSI节点名称和适配器启动模式。</block>
  <block id="aeae1f3a4453e2d3e333de58d3f28c4a" category="list-text">在NetApp存储控制器上为iSCSI和/或FC创建启动程序组时、请将服务器HBA启动程序添加到此组中。服务器的HBA启动程序是FC HBA的WWPN或iSCSI HBA的iSCSI节点名称。</block>
  <block id="1ec419dd357b1eacb28eec8cfd657908" category="list-text">在NetApp存储控制器上创建LUN ID为0的LUN、并将其与上一步中创建的启动程序组关联。此LUN用作启动LUN。</block>
  <block id="52ec2612ed3c17b60d5c662122410366" category="list-text">将HBA限制为指向启动LUN的单个路径。在启动LUN上安装Windows Server后、可以添加其他路径来利用多路径功能。</block>
  <block id="0fa69ac9076a9031393e6f5d4aa909d5" category="list-text">使用HBA的BootBIOS实用程序将LUN配置为启动设备。</block>
  <block id="58347d33bbc0409dce93e92c5983619a" category="list-text">重新启动主机并进入主机BIOS实用程序。</block>
  <block id="1b9013d7a416c62e05336b3791451d0d" category="list-text">配置主机BIOS、使启动LUN成为启动顺序中的第一个设备。</block>
  <block id="3472e7b0e2c4389366cf3e0f09f6376d" category="list-text">从Windows Server ISO启动安装设置。</block>
  <block id="8423662d97649ae1012d665b6594f514" category="list-text">当安装程序询问“Where do you want to Install Windows？”时，单击安装屏幕底部的“Load Driver”(加载驱动程序)以启动“Select Driver to Install”(选择要安装的驱动程序)页。提供先前下载的HBA设备驱动程序的路径、然后完成驱动程序的安装。</block>
  <block id="4d0de28cb0fe5a517374a0c7fdaaff27" category="list-text">现在、先前创建的启动LUN必须显示在Windows安装页面上。选择用于在启动LUN上安装Windows Server的启动LUN、然后完成安装。</block>
  <block id="0dbc8e7afe6136a3b34471c047b28f83" category="paragraph">要为VM配置从SAN启动、请完成以下步骤：</block>
  <block id="6af97eac32eef9a62687eac41262ae48" category="list-text">在NetApp存储控制器上为iSCSI或FC创建启动程序组时、请将iSCSI的IQN或Hyper-V服务器FC的WWN添加到控制器中。</block>
  <block id="c18de5a7c8558c6b9b749ea9d61336da" category="list-text">在NetApp存储控制器上创建LUN或LUN克隆、并将其与上一步中创建的启动程序组相关联。这些LUN可用作VM的启动LUN。</block>
  <block id="dac33c93e3d9b5c90a34c39aa579711a" category="list-text">检测Hyper-V服务器上的LUN、使其联机并对其进行初始化。</block>
  <block id="441d10873880501fa764914d0bf1f044" category="list-text">使LUN脱机。</block>
  <block id="0490d2908eb59e831010f6c50ebdf6ea" category="list-text">稍后在连接虚拟硬盘页面上使用附加虚拟硬盘选项创建虚拟机。</block>
  <block id="2b2b3b281225dec976273bad7f4dacf0" category="list-text">将LUN作为直通磁盘添加到VM。</block>
  <block id="ab82d3a85d9187f45c1cac0bd2922647" category="list-text">打开虚拟机设置。</block>
  <block id="d2e03542bea91031de7772d6cb0b7b13" category="list-text">单击IDE Controller 0 (IDE控制器0)、选择Hard Drive (硬盘驱动器)、然后单击Add (添加)。选择"IDE Controller 0"(IDE控制器0)将使此磁盘成为VM的第一个引导设备。</block>
  <block id="1904d13d92aac636b46007dec34eb357" category="list-text">在"Hard Disk"(硬盘)选项中选择"Physical Hard Disk"(物理硬盘)、然后从列表中选择一个磁盘作为直通磁盘。这些磁盘是在前面的步骤中配置的LUN。</block>
  <block id="19e47f17e14687afa5f6c07833dbd7aa" category="list-text">在直通磁盘上安装Windows Server。</block>
  <block id="30f837081d56a5f1605e52592a38d5f4" category="list-text">确保LUN处于脱机状态。否则、无法将该磁盘作为直通磁盘添加到VM中。</block>
  <block id="9865f9e3af02eaca8b480229a22515f4" category="list-text">如果存在多个LUN、请务必在磁盘管理中记下LUN的磁盘编号。这样做是必要的、因为为虚拟机列出的磁盘都是使用磁盘编号列出的。此外、选择该磁盘作为虚拟机的直通磁盘也是基于该磁盘编号。</block>
  <block id="15b11e66e58b25dffc74ff36f6529d4d" category="list-text">NetApp建议使用在主机上配置的ONTAP MPIO进行存储。</block>
  <block id="154e178d8f948264ecf34dcfd8ad3112" category="summary">本附录介绍了如何在集群模式环境之外使用Hyper-V实时迁移</block>
  <block id="3a37015d23bf5b95b8aaeeb60e7149f6" category="paragraph">本节介绍如何在集群环境之外部署Hyper-V实时迁移。</block>
  <block id="34076d85579973b175bda646666488f5" category="list-text">具有独立存储或共享SMB存储的独立Hyper-V服务器。</block>
  <block id="6d3867adf71fde2bd2e28c3530f980e2" category="list-text">源服务器和目标服务器上安装的Hyper-V角色。</block>
  <block id="860a24a5665c79d337512cf7091c1f27" category="list-text">这两个Hyper-V服务器属于同一个域或彼此信任的域。</block>
  <block id="599b01a5eeab6af8dcd5d22203b25b3b" category="paragraph">要在非集群环境中执行实时迁移、请配置源和目标Hyper-V服务器、以便它们可以发送和接收实时迁移操作。在两个Hyper-V服务器上、完成以下步骤：</block>
  <block id="5c8aa736f4d71f22237d67e44338e090" category="list-text">在操作中、单击Hyper-V设置。</block>
  <block id="146cc3da35b3cb4807f19e5c342f3d0b" category="list-text">单击实时迁移、然后选择启用传入和传出实时迁移。</block>
  <block id="000104d6631c201d8476c728987584e9" category="list-text">选择是允许任何可用网络上的实时迁移流量、还是仅允许特定网络上的实时迁移流量。</block>
  <block id="bbba185068a3a5aa887f5064ee5fc3de" category="list-text">或者、您也可以从Live Migration的Advanced部分配置身份验证协议和性能选项。</block>
  <block id="0d91ef025d958a7706b6abf25f2160a5" category="list-text">如果使用CredSSP作为身份验证协议、请确保在移动虚拟机之前从目标Hyper-V服务器登录到源Hyper-V服务器。</block>
  <block id="4671ab6d9ed8f69134f49812ab7a7c35" category="list-text">如果使用Kerberos作为身份验证协议、请配置受约束的委派。这样做需要访问Active Directory域控制器。要配置委派、请完成以下步骤：</block>
  <block id="3c3a519ac45fd3a37ae321645897af94" category="list-text">以管理员身份登录到Active Directory域控制器。</block>
  <block id="15be526c72b91c88e16f64f6c832eb6b" category="list-text">在工具部分中、单击Active Directory用户和计算机。</block>
  <block id="444f95dff8ac9b4c8c6335d66d6ae4a7" category="list-text">展开域并单击计算机。</block>
  <block id="a07ecc7f9ab368b241540687975a30aa" category="list-text">从列表中选择源Hyper-V服务器、右键单击该服务器、然后单击属性。</block>
  <block id="a3a23c7b6ce827c11b3cdb698108c307" category="list-text">在委派选项卡中、选择信任此计算机以仅委派给指定服务。</block>
  <block id="4070350eb1a20fec8173f5ee230b8566" category="list-text">选择仅使用Kerberos。</block>
  <block id="36d92877123542287dffc5912e198436" category="list-text">单击添加、此时将打开添加服务向导。</block>
  <block id="2a206fdec4cfdbdd63ff3dd2265bbb34" category="list-text">在"添加服务"中，单击"用户和计算机"，此时将打开"选择用户或计算机**.**"</block>
  <block id="6fb0c1f70349caf1f37bdb1c7b73efe4" category="list-text">提供目标Hyper-V服务器名称、然后单击确定。</block>
  <block id="261db7be66ebd6db420e928cb4b402f7" category="list-text">要移动VM存储、请选择CIFS。</block>
  <block id="f4288db12d8f66e52ec2ac189f491e82" category="list-text">要移动VM、请选择Microsoft虚拟系统迁移服务。</block>
  <block id="9149d965e2ccf728685f671fb1046ab9" category="list-text">在委派选项卡中、单击确定。</block>
  <block id="9bc766cbcc4911cf673963ca303576bc" category="list-text">从"Computers"文件夹中、从列表中选择目标Hyper-V服务器、然后重复此过程。在Select Users or Computers (选择用户或计算机)中、提供源Hyper-V服务器名称。</block>
  <block id="5868e6c6d4568bb2c1245c731ab1f681" category="list-text">移动虚拟机。</block>
  <block id="ab102f10122268c6b0663d464d3192da" category="list-text">选择"Move the Virtual Machine."(移动虚拟机)。</block>
  <block id="8b95cb0524fdc80c99bdf8cb976556d2" category="list-text">指定虚拟机的目标Hyper-V服务器。</block>
  <block id="25b70b154b120ba061f03c292637a9a4" category="list-text">选择移动选项。对于共享实时迁移、请选择仅移动虚拟机。对于"Shared Nothing Live Migration"(无共享实时迁移)、请根据您的首选项选择另外两个选项中的任何一个。</block>
  <block id="8c60fc97ae35b3af22d644ab2b9186e7" category="list-text">根据您的首选项、提供虚拟机在目标Hyper-V服务器上的位置。</block>
  <block id="dd714dbbaab89194e2aefdf439089cff" category="list-text">查看摘要、然后单击确定以移动虚拟机。</block>
  <block id="8ab11353f8fda3f130084c6ff3c1f32e" category="summary">Microsoft Windows和Hyper-V与ONTAP的虚拟化概述</block>
  <block id="e905fd86484ea1bf5b665b34fc9e24b4" category="paragraph">Microsoft Windows Server是一款企业级操作系统(OS)、涵盖网络连接、安全性、虚拟化、私有云、混合云、 虚拟桌面基础架构、访问保护、信息保护、Web服务、应用程序平台基础架构、 等等。</block>
  <block id="16b5970810caafa8d6f89bee6e0398f2" category="admonition">*本文档替代以前发布的技术报告_TR-4568：《适用于Windows Server_*的NetApp部署准则和存储最佳实践》</block>
  <block id="dbf037f8e99a1d5b52fe58af78568561" category="list-text">支持文件、对象和块协议的统一架构。这样、存储控制器便可同时用作NAS和SAN设备以及对象存储</block>
  <block id="23748de0bc860150d3c6b27a4d472042" category="list-text">一种全SAN阵列(ASA)、仅侧重于块协议、并通过为连接的主机添加对称主动-主动多路径来优化I/O恢复时间(I/O Resume Times、IORT)</block>
  <block id="d0114359083804284c542907b2f8cd60" category="list-text">软件定义的统一架构</block>
  <block id="30063e1e8c837a5b52057909e747b2d8" category="list-text">在VMware vSphere或KVM上运行的ONTAP Select</block>
  <block id="f7d26dbdc8e2b21b211abf2157e73536" category="list-text">超超群云提供商提供的第一方产品</block>
  <block id="4d82a1ec1af02725042c8c785564ee7a" category="list-text">适用于 NetApp ONTAP 的 Amazon FSX</block>
  <block id="7450cfde7058dc5e1f7909d0280fd7ae" category="list-text">Azure NetApp Files</block>
  <block id="1215f8190533dfdf63d2224a6d88266f" category="list-text">Google Cloud NetApp卷</block>
  <block id="538a662f2ecbeba6af56e41386484f67" category="paragraph">Windows Server和ONTAP可以一起在大型环境中运行、为数据中心整合以及私有云或混合云部署带来巨大价值。这种组合还可以高效地提供无中断工作负载、并支持无缝可扩展性。</block>
  <block id="8f0442ea7c58fe8ab4000f5aaeac415b" category="paragraph">本文档面向为Windows Server设计NetApp存储解决方案的系统和存储架构师。</block>
  <block id="f6f27d1607ed17a4b610676f16f68357" category="paragraph">在本文档中、我们做出以下假设：</block>
  <block id="e9d690b9eb25093e460ea369baa55496" category="inline-link">《集群管理员系统管理指南》</block>
  <block id="d54e01b4234443b582b1d0cc44ce1c19" category="list-text">读者大致了解NetApp硬件和软件解决方案。请参见<block ref="87244016000a25428f0fcae2d3732d46" category="inline-link-rx"></block> 了解详细信息。</block>
  <block id="c501659fe58b766ec2ead9a0c974e530" category="inline-link">集群模式Data ONTAP SAN管理</block>
  <block id="75ac79ee68c2245f6d8b8cc32a3eae9e" category="inline-link">NAS管理</block>
  <block id="48fa880bcded409e494bd8e2e8c64a97" category="list-text">读者大致了解块访问协议、例如iSCSI、FC和文件访问协议SMB/CCIFS。请参见<block ref="123a6e61ead9566ba44616c8f29f1ba3" category="inline-link-rx"></block> 了解与SAN相关的信息。请参见<block ref="9933d9f07fd1633df051103d1b03340e" category="inline-link-rx"></block> 了解与CIFS或SMB相关的信息。</block>
  <block id="02279515531a2de57bfdffa958d40813" category="list-text">读者具备Windows Server操作系统和Hyper-V的基本知识</block>
  <block id="3eb0aeddd8b10d858bd2028c6f983308" category="summary">VMware SRM和ONTAP存储的操作最佳实践</block>
  <block id="06b2d4b91b5c9eaa8c20a1c270f95b3c" category="inline-image-macro">集群</block>
  <block id="6c0893d9a45aaff00c1ef0daf0867ada" category="paragraph"><block ref="6c0893d9a45aaff00c1ef0daf0867ada" category="inline-image-macro-rx" type="image"></block></block>
  <block id="820b71b9a8a55fe48690a5f973c5480e" category="paragraph">适用于VMware vSphere的ONTAP工具的软件工程采用以下安全开发活动：</block>
  <block id="ecdc76c84c9674a3148f3d464298469c" category="paragraph">适用于VMware vSphere的ONTAP工具在每个版本中都包含以下安全功能。</block>
  <block id="0785fa6b3221e7345916be824259dc2f" category="paragraph">在将SDRS与适用于VMware vSphere的ONTAP工具结合使用时、您必须先使用此插件创建数据存储库、使用vCenter创建数据存储库集群、然后再将此数据存储库添加到其中。创建数据存储库集群后，可以直接从详细信息页面上的配置向导将其他数据存储库添加到数据存储库集群中。</block>
  <block id="043d75b2a25cf6f38bccaf9211c5bcc5" category="summary">此页面介绍了在VMware vSphere环境中实施ONTAP存储解决方案的最佳实践。</block>
  <block id="760f70bd45ae12af9fa6bee90f402eeb" category="cell">请参见中的NFS.MaxQueueDepth <block ref="1f38ac07598dbb4b06912539aafa4211" category="inline-link-macro-rx"></block>。</block>
  <block id="647fe6e64f77a1f54f9bb61154ab2a4f" category="summary">更多的卷资源</block>
  <block id="852ee2d26adc87d2379ffeb9287f7642" category="inline-image-macro">适用于VMware vSphere 9.8 vvol信息板的ONTAP工具</block>
  <block id="12947c7ceaf237f27fd206edb07cc0c1" category="paragraph"><block ref="12947c7ceaf237f27fd206edb07cc0c1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6e2c48e84c0d02dd4e236da05038bd9a" category="paragraph">ONTAP 同时支持 VMFS 和 NFS VVol 数据存储库。将 VVOL 与 SAN 数据存储库结合使用可带来 NFS 的一些优势，例如虚拟机级别粒度。下面是一些需要考虑的最佳实践，您可以在中找到追加信息 <block ref="7be3ce63e842612697a6d91b19b8afcd" category="inline-link-macro-rx"></block>：</block>
  <block id="436b5d96360742275889cb237fe2ab70" category="inline-image-macro">VMware组件</block>
  <block id="1706c14e85f152d61bab2f65d32810a1" category="paragraph"><block ref="1706c14e85f152d61bab2f65d32810a1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="43f38d7beb04aa98b65d2317c2f1659f" category="inline-image-macro">适用于vSphere的ONTAP工具</block>
  <block id="aa5b1d896aebe8a04ceac7c2a16b2cd3" category="paragraph"><block ref="aa5b1d896aebe8a04ceac7c2a16b2cd3" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c4b0e8af5e898d44e394489b0c629abb" category="image-alt">VM主机组和关联性规则</block>
  <block id="f98dd9d12416a648450df8c99d10878a" category="summary">本节将简要介绍采用ONTAP的VMware vSphere虚拟卷(vvol)</block>
  <block id="674c41ba00ec77fc9d294abbba7e7b7d" category="paragraph">二十年来、ONTAP一直是适用于VMware vSphere环境的领先存储解决方案、并不断增加创新功能、以简化管理并降低成本。</block>
  <block id="ae7454da5e20b82b7fe67eb1ff88c923" category="admonition">本文档将取代先前发布的技术报告_TR-4400：《使用ONTAP的VMware vSphere虚拟卷(Vvol)》_</block>
  <block id="afd715f07b1ec06fe77bf23a2d7bf185" category="paragraph">_有关ONTAP 和VMware vSphere最佳实践的详细信息、请参见 <block ref="5dbb4949ffa7cb97fe4eaffc517a1111" category="inline-link-macro-rx"></block>_</block>
  <block id="e88c947a5d8f4c0daec271a8595604a7" category="inline-image-macro">Active IQ Unified Manager虚拟机视图</block>
  <block id="9078040b61fc8a9bd0215e8f35ff788c" category="paragraph"><block ref="9078040b61fc8a9bd0215e8f35ff788c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0ef2f850d3f17cacfbd404bade7eed5b" category="inline-image-macro">AIQUM扩展拓扑</block>
  <block id="75817aa97084cb93e0292a1f0549551f" category="paragraph"><block ref="75817aa97084cb93e0292a1f0549551f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4e749568996a3331860532ac7a470fdb" category="inline-image-macro">SnapMirror关系布局</block>
  <block id="3d2c169d59a49a498b2d7e714c5a6ce2" category="paragraph"><block ref="3d2c169d59a49a498b2d7e714c5a6ce2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="706bdd824ec69e00026180eaf2801d2e" category="paragraph"><block ref="706bdd824ec69e00026180eaf2801d2e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="ba1aebb9b3c7be6b408863c12bbc2844" category="paragraph"><block ref="ba1aebb9b3c7be6b408863c12bbc2844" category="inline-image-macro-rx" type="image"></block></block>
  <block id="ea07c4b81c3f00ae8bbef49ac8562d1c" category="paragraph"><block ref="ea07c4b81c3f00ae8bbef49ac8562d1c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="12a757dd793cbe082927530094a72d26" category="inline-image-macro">阵列对</block>
  <block id="263506cdbbc7c35e461fc5f1044b9c79" category="paragraph"><block ref="263506cdbbc7c35e461fc5f1044b9c79" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b26873df0260bdc332a7511f6823cf63" category="inline-image-macro">不支持的配置</block>
  <block id="120528a3f7d5a39fdd0d67fb0e2b94a4" category="paragraph"><block ref="120528a3f7d5a39fdd0d67fb0e2b94a4" category="inline-image-macro-rx" type="image"></block></block>
  <block id="160a69c7a04198d870353b06dbf714a9" category="paragraph"><block ref="160a69c7a04198d870353b06dbf714a9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="742a3ab0c9a97e5a438c8edfb1b271d2" category="paragraph"><block ref="742a3ab0c9a97e5a438c8edfb1b271d2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="d0a05359b36f0932509cfa007b46e853" category="inline-image-macro">SnapMirror关系的级联</block>
  <block id="2057708d80974a7573d92b3e0d8a9258" category="paragraph"><block ref="2057708d80974a7573d92b3e0d8a9258" category="inline-image-macro-rx" type="image"></block></block>
  <block id="cd92dffb12f75e4b81ad67d8668ae698" category="inline-image-macro">SnapMirror到SnapVault级联</block>
  <block id="13ece5df0d16f65585acbfb9ebad113c" category="paragraph"><block ref="13ece5df0d16f65585acbfb9ebad113c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c74d71595c83ecb05581a89554ca8bb2" category="inline-image-macro">SnapMirror到SnapVault反向级联</block>
  <block id="5bb35c000e450925b37eff3feca75a24" category="paragraph"><block ref="5bb35c000e450925b37eff3feca75a24" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2ab367df5e87b988bc086e5ee534793e" category="summary">此页面介绍了使用ONTAP和NFS连接的数据存储库实施VMware vSphere的最佳实践。</block>
  <block id="0e768c8183bcbfc87718f59d9dfd61eb" category="inline-link-macro">数据存储库</block>
  <block id="622b235a9123d972c612737c81eb55a1" category="inline-link-macro">NetApp和VMware的NFSv3 nConnect功能</block>
  <block id="d94a770977f68948a4930f4a2edbabb9" category="image-alt">新建集群</block>
  <block id="f5c7047b98efcb8c7eef2db6ef31faf4" category="image-alt">启用主机监控选项</block>
  <block id="239aaf78fcb42b02d3709057d2a7978a" category="image-alt">VM监控</block>
  <block id="a7765f8868404f7c3cb890ce051f7de4" category="image-alt">准入控制</block>
  <block id="e5bd6e5564d38885fef18a28e48861b4" category="image-alt">HA集群</block>
  <block id="8e00c91ecf143f76c94e3aa1668fc92b" category="inline-image-macro">ONTAP克隆</block>
  <block id="9c7295440be885852a164f5880627146" category="paragraph"><block ref="9c7295440be885852a164f5880627146" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1eed6756a7834e04fb7716ee8d830425" category="inline-link-macro"><block ref="1eed6756a7834e04fb7716ee8d830425" category="inline-link-rx"></block></block>
  <block id="0e4a75553a081fffff029a37e55f5d71" category="inline-link-macro"><block ref="0e4a75553a081fffff029a37e55f5d71" category="inline-link-rx"></block></block>
  <block id="32fd58743bd2ce579949a47db1b95ca8" category="summary">与SRA和传统数据存储库相比、使用VASA进行VVOs复制可提供独特的功能。</block>
  <block id="570bfadf5783125790b6c87f55842fb2" category="inline-image-macro">SnapCenter部署</block>
  <block id="71ca4878111d253f9883f471e5de9594" category="paragraph"><block ref="71ca4878111d253f9883f471e5de9594" category="inline-image-macro-rx" type="image"></block></block>
  <block id="bd90e11d4c9fc73f37adda8029276215" category="summary">此页面介绍了在VMware vSphere环境中实施ONTAP存储解决方案的最佳实践。</block>
  <block id="ab906277df9ce070b1e11724f8ccf589" category="list-text">为 ONTAP 集群中每个节点上的每个 SVM 使用一个逻辑接口（ LIF ）。不再需要以往为每个数据存储库建议的 LIF 。虽然直接访问(LIF和同一节点上的数据存储库)是最佳选择、但无需担心间接访问、因为对性能的影响通常很小(微秒)。</block>
  <block id="8dc90de75c19a4114217f443b0ca2866" category="inline-image-macro">从vSphere主机连接到ONTAP NFS数据存储库</block>
  <block id="36b9a8da16a1d2fad06b788e662b7c4a" category="paragraph"><block ref="36b9a8da16a1d2fad06b788e662b7c4a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="bb6d2d52dfe07f9662232c444256aece" category="paragraph">使用iSCSI或NVMe/TCP的主机可以直接连接到存储系统并正常运行。原因是路径问题。直接连接到两个不同的存储控制器会导致数据流有两条独立的路径。丢失路径、端口或控制器不会阻止使用另一个路径。</block>
  <block id="0d761ccb2787bad60b77ac971f6d3914" category="summary">此页面介绍了在VMware vSphere环境中实施ONTAP FlexGroup卷的最佳实践。</block>
  <block id="adc6ae60e2ce9c7497e70727d5232a2d" category="paragraph">将ONTAP和FlexGroup卷与VMware vSphere结合使用、可实现简单且可扩展的数据存储库、从而充分利用整个ONTAP集群的全部功能。</block>
  <block id="55e0e7799b68cd76cf68be0ee82fef7b" category="section-title">副本卸载</block>
  <block id="0db4fc806176bc768d44fa59cf3c36aa" category="paragraph">您可能会发现、如果您使用VAAI克隆、但克隆量不足以保持缓存热度、则克隆速度可能不会比基于主机的副本快。如果是这种情况、您可以调整缓存超时以更好地满足您的需求。</block>
  <block id="1e8e371d8058e71f2444bc0cd42517eb" category="paragraph">卷收到的每个新克隆作业都会重置超时。如果示例FlexGroup中的成分卷在超时之前未收到克隆请求、则会清除该特定虚拟机的缓存、并且需要重新填充该卷。此外、如果原始克隆的源发生更改(例如、您已更新模板)、则每个成分卷上的本地缓存都将失效、以防止发生任何冲突。如前文所述、缓存可进行调整、并可根据环境需求进行设置。</block>
  <block id="6bcf203b609d41b14c06e319cede61d7" category="section-title">QoS设置</block>
  <block id="9ab9903a16c07ff38214a043719957fd" category="paragraph">支持使用ONTAP系统管理器或集群Shell在FlexGroup级别配置QoS、但它不提供VM感知或vCenter集成。</block>
  <block id="d9450aaad95d69e8cc75ddc0a69a9026" category="paragraph">此时、可以在vCenter UI中或使用ONTAP工具通过REST API在数据存储库中的单个虚拟机或所有虚拟机上设置QoS (最大/最小IOPS)。在所有 VM 上设置 QoS 将取代任何单独的每 VM 设置。将来，设置不会扩展到新的或迁移的虚拟机；可以在新虚拟机上设置 QoS ，也可以将 QoS 重新应用于数据存储库中的所有虚拟机。</block>
  <block id="f32c3edaacea72c0ddb30ecf0135c4de" category="section-title">指标</block>
  <block id="ed7927d72c6154d79bedf6b19ea8fc83" category="paragraph">ONTAP 9.8还为FlexGroup文件添加了新的基于文件的性能指标(IOPS、吞吐量和延迟)、您可以在适用于VMware vSphere的ONTAP工具信息板和VM报告中查看这些指标。适用于 VMware vSphere 的 ONTAP 工具插件还允许您结合使用最大和 / 或最小 IOPS 来设置服务质量（ QoS ）规则。可以在数据存储库中的所有 VM 之间设置这些值，也可以为特定 VM 单独设置这些值。</block>
  <block id="c2ffe02d76c4f089648f1647b43e4ee5" category="section-title">最佳实践</block>
  <block id="43fc84d75bb64307120a48d004166174" category="inline-link-macro">数据存储库和协议—NFS</block>
  <block id="b43cf2a2c13b864c3b2547368e95b2c5" category="list-text">使用ONTAP工具创建FlexGroup数据存储库、以确保以最佳方式创建FlexGroup、并根据您的vSphere环境配置导出策略。但是、在使用ONTAP工具创建FlexGroup卷之后、您会发现vSphere集群中的所有节点都使用一个IP地址挂载数据存储库。这可能会导致网络端口出现瓶颈。要避免此问题、请卸载此数据存储库、然后使用标准vSphere数据存储库向导使用轮叫DNS名称重新挂载它、以便在SVM上的各个SVM之间平衡负载。重新挂载后、ONTAP工具将再次能够管理数据存储库。如果ONTAP工具不可用、请使用FlexGroup默认值并按照中的准则创建导出策略 <block ref="1dcda1ccb6404fd747bdfa52cd9e0cc2" category="inline-link-macro-rx"></block>。</block>
  <block id="689367b2abf9b4f7fdef5f8589689dbc" category="list-text">在估算 FlexGroup 数据存储库的规模时，请记住， FlexGroup 由多个较小的 FlexVol 卷组成，这些卷会创建一个较大的命名空间。因此、请将数据存储库的大小至少设置为最大VMDK文件大小的8倍(假设默认为8个成分卷)、外加10-20%的未使用余量、以便灵活地重新平衡。例如、如果您的环境中有6 TB VMDK、请将FlexGroup数据存储库的大小设置为不小于52.8 TB (6x8 + 10%)。</block>
  <block id="315f464c64861565200e97577a6eabde" category="list-text">适用于VMware vSphere的SnapCenter插件4.4及更高版本支持备份和恢复主存储系统上FlexGroup数据存储库中的VM。4．6号选择控制阀为基于FlexGroup的数据存储库增加了SnapMirror支持。使用基于阵列的快照和复制是保护数据的最有效方式。</block>
  <block id="6c5f0256b71da4e103acbeed0dfcc379" category="summary">本文档介绍适用于VMware的SnapCenter插件的安全方面。</block>
  <block id="3fd4fd8640d78da436f762569919841f" category="list-text">*产品安全事件响应活动。*安全漏洞在公司内部和外部均已发现、如果不及时解决、可能会对NetApp的声誉造成严重风险。为了便于执行此过程、产品安全意外事件响应团队(PSIRT)会报告并跟踪漏洞。</block>
  <block id="a2132633bc2804871caed9697d50a10d" category="summary">ONTAP工具支持的功能、限制和虚拟卷。</block>
  <block id="2fa76de41291847c8d191ea664c53395" category="summary">了解采用ONTAP的vSphere Metro Storage Cluster</block>
  <block id="0ecd760f5e697e57a60b2f1597be9d54" category="admonition">有关 VMware vSphere 虚拟卷， SPBM 和 ONTAP 的详细信息，请参见 <block ref="2e6ec19fbf81081d6cc68364fb2fb656" category="inline-link-macro-rx"></block>。</block>
  <block id="7dbbfa4d228c6ffe9a64c938bc057b0d" category="inline-image-macro">多路径连接</block>
  <block id="4525956d57ef52f4b2a4f341fbeec28e" category="paragraph"><block ref="4525956d57ef52f4b2a4f341fbeec28e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8692ff2ea8c35b5c4c7cea90481e416c" category="summary">本文档对建议的存储和网络设置进行了分类和列举。</block>
  <block id="ff6fdc6e7749c69219fc26d54c625bd5" category="paragraph">NetApp为NFS和块协议开发了一组最佳ESXi主机设置。此外、还提供了有关多路径和HBA超时设置的特定指导、以便根据NetApp和VMware内部测试在ONTAP中正常运行。</block>
  <block id="baee97fad9d55c529dc7a7eb07fd1ba4" category="cell">vSphere 6.0或更高版本、请设置为256
所有其他NFS配置均设置为64。</block>
  <block id="b3fd5cebc3e5891cccea8f8df97003e0" category="paragraph">以下各节概述了ONTAP和VMware SRM的部署最佳实践。</block>
  <block id="c89f9fd1a8019dc4d7a2559a982d3aa8" category="inline-link-macro">S3配置概述</block>
  <block id="8eb06904cba6440e6130ac3e32b68aba" category="paragraph">*注：*有关SVM、统一存储和客户端访问的详细信息、请参见 <block ref="9e7286a7ad3ab81fa024704c7a52e505" category="inline-link-macro-rx"></block> 在 ONTAP 9 文档中心。</block>
  <block id="d96a9839a4f7a8d356a868bd23816516" category="summary">近20年来、ONTAP一直是适用于VMware vSphere环境的领先存储解决方案、并不断增加创新功能、以简化管理并降低成本。本文档介绍了适用于 vSphere 的 ONTAP 解决方案，其中包括用于简化部署，降低风险和简化管理的最新产品信息和最佳实践。</block>
  <block id="93fbb268e5e551ae95265cfe3b3b6c7a" category="paragraph">PostgreSQL附带的变体包括PostgreSQL、PostgreSQL Plus和EDB Postgrers Advanced Server (ePAS)。PostgreSQL通常部署为多层应用程序的后端数据库。它受常见中间件包(如PHP、Java、Python、Tcl/Tk、ODBC、 和JDBC)、并且一直以来都是开源数据库管理系统的常用选择。对于运行PostgreSQL数据库来说、ONTAP的可靠性、高性能和高效的数据管理功能是一个绝佳的选择。</block>
  <block id="bbc2d665b02dc421c5c756db4b973610" category="sidebar">Microsoft Hyper-V</block>
  <block id="672553790d8814b967eb8623e754ea84" category="sidebar">部署准则和存储最佳实践</block>
  <block id="c5865855c43d734069987786177edd98" category="sidebar">Hyper-V</block>
  <block id="230dea8fdf5e53eb32282fb3f8d4d9f6" category="sidebar">部署准则和存储最佳实践</block>
  <block id="3c0fa9c86e8d92c7a146b2d71467ab2e" category="sidebar">NetApp存储和Windows Server环境</block>
  <block id="1ed211700a6cc31a2b45adb662dcbb8a" category="sidebar">在SAN环境中配置</block>
  <block id="41ffc5ff950f2260951b6b6150c36f6b" category="sidebar">在SMB环境中配置</block>
  <block id="e5f52b64058cb937fdd114369219d380" category="sidebar">基于NetApp的Hyper-V存储基础架构</block>
  <block id="4380100fa910735712157068aeec0575" category="sidebar">在集群环境中部署Hyper-V实时迁移</block>
  <block id="0726f4e9c3c98564af638f1b4cd17a9e" category="sidebar">在集群环境之外部署Hyper-V实时迁移</block>
  <block id="1bbd09497cd931a02f8dc0ee3cfcf19d" category="sidebar">在集群环境之外部署Hyper-V副本</block>
  <block id="832a116d7f9184d8880a539553a0cb52" category="sidebar">在集群环境中部署Hyper-V副本</block>
  <block id="1a85c0d242c43eb56cc500e60d323331" category="paragraph">VMFS 是一种高性能集群文件系统，可提供共享存储池中的数据存储库。可以为VMFS数据存储库配置使用FC、iSCSI、FCoE访问的LUN、或者配置使用NVMe/FC或NVMe/TCP协议访问的NVMe命名区。VMFS允许集群中的每个ESX服务器同时访问存储。从ONTAP 9.12.1P2 (以及ASA系统中的更早版本)开始、最大LUN大小通常为128 TB；因此、可以使用一个LUN来创建大小上限为64 TB的VMFS 5或6数据存储库。</block>
  <block id="8983ee0717807e5385f3c8b2c70a177c" category="list-text">TR-4597 ：适用于 ONTAP 的 VMware vSphere
<block ref="0bff808225ac084b8184e7670c17aa52" category="inline-link-macro-rx"></block></block>
  <block id="1f7ff87198d4a8563ac0d42354d47052" category="list-text">TR-4400 ：采用 ONTAP 的 VMware vSphere 虚拟卷
<block ref="57ea579fe6c0d333a496008248ad03e2" category="inline-link-macro-rx"></block></block>
  <block id="e651877073d877e1ee090d986eafc550" category="list-text">您需要将Hyper-V集群置于相同或不同地理位置、用作主集群和副本集群。请查看 <block ref="8a150f92c22920868769b8738759e23d" category="inline-link-macro-rx"></block> 有关详细信息：</block>
  <block id="8762adae157b34ee542f2e614401603a" category="list-text">ONTAP 概念
<block ref="836022e29667128997850a15d18e8759" category="inline-link-rx"></block></block>
  <block id="e7b3912abd11fa36935a211d0189ebc2" category="list-text">现代SAN的最佳实践
<block ref="49df8abaa6163afdde37b69f7f59185c" category="inline-link-rx"></block></block>
  <block id="05c54431756e1b1a7114938bc6f4b199" category="list-text">NetApp全SAN阵列数据可用性和NetApp ASA完整性
<block ref="8f140ecff12b563e3c96a8cff991aedb" category="inline-link-rx"></block></block>
  <block id="bc96f334e3988ce96701a7082c0e23b5" category="list-text">开始使用您的安装和使用的软件+
<block ref="abdd6de84336a7f761fbe384605879e9" category="inline-link-rx"></block></block>
  <block id="0e660b82d6e28b6935041a5223ed1aed" category="paragraph">要部署实时迁移、您需要在具有共享存储的故障转移集群中配置Hyper-V服务器。请查看 <block ref="8a150f92c22920868769b8738759e23d" category="inline-link-macro-rx"></block> 有关详细信息：</block>
  <block id="1dd1e97374852e1f244963d9fdb0c414" category="list-text">测试计划内故障转移。通过实时迁移、快速迁移或存储迁移(移动)将VM移动到另一个节点。请查看 <block ref="ba8afff2d0e4662eeb47d28935e79828" category="inline-link-macro-rx"></block> 有关详细信息：</block>
  <block id="8737a5d2bc43b0eb76ab5674d0fcb094" category="sidebar">使用ONTAP的SRM概述</block>
  <block id="76f6daa4bfab6ca8a7350e46d3d6718f" category="sidebar">适用于SRM的追加信息</block>
  <block id="3ebf71fd7bd7392466a892c2228b2f58" category="section-title">在Windows Server上配置SMB共享</block>
  <block id="674b9c5bbf2379d6c48343d029972e53" category="section-title">主机集成</block>
  <block id="16ce478a465011bacaa6e508063c2648" category="section-title">需要记住的事项</block>
  <block id="83f04319244758f7531b398c51aa9f38" category="section-title">在NFS服务器上配置SMB共享</block>
  <block id="2323e97f7cf2da464750911f1f3e1af6" category="doc">在集群环境中部署Hyper-V副本</block>
  <block id="36b10adb4505559b63b091b53614af1f" category="section-title">NetApp重复数据删除</block>
  <block id="1ba5c1747d37a3d7ae84fd1dcac77603" category="section-title">进一步阅读</block>
  <block id="50802d3e5a25b93d471686a10da03dd8" category="section-title">最佳实践</block>
  <block id="67bd1e9f90c0abcd3fe89dce2e8b6307" category="doc">在集群环境之外部署Hyper-V实时迁移</block>
  <block id="f2b84afd0523a6df7547c404aa3647d8" category="section-title">目标受众</block>
  <block id="458ed20ed5d1729b427e233e0e52f797" category="section-title">为Windows Server配置NetApp存储</block>
  <block id="e648c74a53b161f90c8e915624ce6135" category="section-title">管理NetApp存储</block>
  <block id="9292ee6bce21e93911c38cd0a1c2e209" category="section-title">网络最佳实践</block>
  <block id="381400d1babe5b80783d5e46896d832e" category="doc">部署完成的服务器</block>
  <block id="02676c7c18a8d411999242a1f5731de2" category="section-title">基于NetApp CIFS的Hyper-V存储</block>
  <block id="00a66fbc09172147ac7be9c85b708a6b" category="section-title">卸载数据传输</block>
  <block id="39d0bfdf27f1fc555ae2f030e21f8818" category="section-title">Hyper-V集群：虚拟机的高可用性和可扩展性</block>
  <block id="10fd9c0040ca7b99a67758c3cd638746" category="section-title">集群环境中的实时迁移</block>
  <block id="ed7cd01cb26e2db33a36eaa87ac85ff1" category="section-title">在集群环境之外进行实时迁移</block>
  <block id="023196611fee49915adf49422b3289e6" category="section-title">Hyper-V副本：虚拟机灾难恢复</block>
  <block id="e78f6d0414a6dde66f4e12a3e218620b" category="section-title">扩展复制</block>
  <block id="e43f3be13a49d6eeab4304d80790eaa0" category="section-title">检测块存储</block>
  <block id="adc95a9707f2f351740aa0d52f08981e" category="section-title">NetApp FlexClone方法</block>
  <block id="0bee1618a00f62535bd1e3f03af6a8f0" category="section-title">从SAN启动物理主机</block>
  <block id="68468d5f213be162fe50260787894f8f" category="section-title">从SAN启动虚拟机</block>
  <block id="5b6253395cb699e828a4e33bbe3ad99e" category="doc">在集群环境之外部署Hyper-V副本</block>
  <block id="c56bd6d44fe37df3133f12e09059b492" category="doc">部署Hyper-V集群</block>
  <block id="284558d4613b1e72103300f1b8973b3b" category="paragraph">首次安装时、ESX没有预配置的功能、例如托管子操作系统或支持最终用户应用程序。在定义虚拟机(VM)之前、此容器为空容器。ONTAP与此类似。首次安装ONTAP时、在创建SVM之前、它无法提供数据。SVM特性用于定义数据服务。</block>
  <block id="2737c9012caaebb1cbb9e526400a2345" category="paragraph">在多租户环境中、可以为每个租户的数据提供一个专用SVM。每个集群、HA对和节点的SVM和LIP数量限制取决于所使用的协议、节点型号和ONTAP版本。  请参见 <block ref="41f66f34b3a905f864500c9319fdff8f" category="inline-link-macro-rx"></block> 的限制。</block>
  <block id="50812cc1b8d48579d382b689e4393be6" category="paragraph">某些数据不包含重复数据。例如、Oracle块包含数据库全局唯一的标头和几乎唯一的尾部。因此、对Oracle数据库进行重复数据删除很少能节省超过1%的空间。对MS SQL数据库执行重复数据删除略有改进、但块级别的唯一元数据仍是一个限制。</block>
  <block id="e237dd01ca20b300861ea50239fefbf9" category="paragraph">这包括典型的规划措施、例如、确保主机和存储系统之间的SAN具有足够的带宽、检查所有必需设备之间是否存在所有SAN路径、使用FC交换机供应商所需的FC端口设置、避免ISL争用、 并使用适当的SAN网络结构监控。</block>
  <block id="bab63c3a8b4ae009c3596c809e27d73b" category="paragraph">MetroCluster复制基于NetApp SyncMirror技术、该技术旨在高效地切换至同步模式和切换至同步模式之外。此功能可满足需要同步复制、但也需要数据服务高可用性的客户的要求。例如、如果与远程站点的连接断开、则通常最好让存储系统继续在未复制的状态下运行。</block>
  <block id="bf4d44f407dab4b746f1eaeb06e897af" category="paragraph">许多同步复制解决方案只能在同步模式下运行。这种类型的全或全不复制有时称为Domino模式。此类存储系统将停止提供数据、而不是允许本地和远程数据副本处于不同步状态。如果强制中断复制、重新同步可能会非常耗时、并且可能会使客户在重新建立镜像期间完全丢失数据。</block>
  <block id="8f076395fe8f8f46c03efb655db313e6" category="section-title">FC直连</block>
  <block id="722830ffc5e46dbe206670f85cd1d889" category="paragraph">ONTAP和某些其他NetApp产品现在支持使用多种方法进行多因素身份验证(MFA)。其结果是、用户名/密码被泄露本身并不是没有第二个因素(例如FOB或智能手机应用程序)的数据的安全线程。</block>
  <block id="37c43820ab88f1340855c30955eec330" category="section-title">多管理员验证(MAV)</block>
  <block id="1910dc5a02cb649cc24df5670c631e34" category="paragraph"><block ref="1910dc5a02cb649cc24df5670c631e34" category="inline-image-macro-rx" type="image"></block></block>
  <block id="416d0d3efc5f3919abcdaaa2364738d9" category="paragraph"><block ref="416d0d3efc5f3919abcdaaa2364738d9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="28c6217e46797f76e427c591070cf50c" category="paragraph"><block ref="28c6217e46797f76e427c591070cf50c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="d03e09c345dd723011486de3855c13b2" category="list-text">SMB文档
<block ref="409ef354547d1e3428907ed7fdd2dc6e" category="inline-link-rx"></block></block>
  <block id="834873443aaaf2c09b851c8b0f7b2497" category="section-title">数据库压缩</block>
  <block id="2ee3c7318caa2523e9c749e4e2152266" category="paragraph">首次接触ONTAP的客户通常会感到困惑的一点是、FlexVol的使用、通常简称为"卷"。</block>
  <block id="ff2dabe8a40c84d01b0584c50319a79e" category="paragraph">卷不是LUN。这些术语与许多其他供应商产品(包括云提供商)同义。ONTAP卷只是管理容器。它们不会自行提供数据、也不会占用空间。它们是文件或LUN的容器、旨在提高和简化易管理性、尤其是大规模管理。</block>
  <block id="92a5781e05d0d9b7044f44e2ef7bff84" category="section-title">卷和LUN</block>
  <block id="faf1e8eebcac2d18d4ac10e75f416a3f" category="paragraph">相关LUN通常位于同一个卷中。例如、需要10个LUN的数据库通常会将所有10个LUN放置在同一个卷上。</block>
  <block id="3a5bf2895b95fa2b89fce4dcf94fd2f9" category="list-text">采用1：1的LUN与卷比率(即每个卷一个LUN)是一种*不*正式的最佳实践。</block>
  <block id="1886f4ac4aa2f64bf8224f178a36ba92" category="list-text">而是应将卷视为工作负载或数据集的容器。每个卷可能有一个LUN、也可能有多个LUN。正确的问题解答取决于易管理性要求。</block>
  <block id="0de05608a70e8ec5863afc41ba150178" category="list-text">将LUN分散在不必要数量的卷上可能会导致额外开销和操作计划问题、例如快照操作、UI中显示的对象数量过多、并导致在达到LUN限制之前达到平台卷限制。</block>
  <block id="0955dbd01a9f8194cad5a6876b931f5a" category="section-title">卷、LUN和快照</block>
  <block id="9bbd4f2fca3a1e1aaa76abf8cb43351c" category="paragraph">Snapshot策略和计划放置在卷上、而不是LUN上。如果包含10个LUN的数据集位于同一个卷中、则这些LUN只需要一个Snapshot策略。</block>
  <block id="f34f28bb7a1701ded173c2ab504f5c20" category="paragraph">此外、在一个卷中将给定数据集的所有相关LUN同位可实现原子快照操作。例如、如果基础LUN都位于一个卷上、则驻留在10个LUN上的数据库或包含10个不同操作系统的基于VMware的应用程序环境可以作为一个一致的对象进行保护。如果将它们放置在不同的卷上、则快照可能会(也可能不会)完全同步、即使是同时计划的也是如此。</block>
  <block id="fe7797cb1dbe36223357d4c25ff30c9e" category="paragraph">在某些情况下、由于恢复要求、可能需要将一组相关LUN拆分为两个不同的卷。例如、一个数据库可能有四个用于数据文件的LUN和两个用于日志的LUN。在这种情况下、最好使用包含4个LUN的数据文件卷和包含2个LUN的日志卷。原因是独立可恢复性。例如、可以有选择地将数据文件卷还原到先前的状态、这意味着所有四个LUN都将还原到快照的状态、而日志卷及其关键数据不会受到影响。</block>
  <block id="66383d632fe33f1b7c20af9c1c142028" category="section-title">卷、LUN和SnapMirror</block>
  <block id="8fb29c5f40886ece62abcd994f1aa202" category="paragraph">SnapMirror策略和操作与快照操作一样、在卷上执行、而不是在LUN上执行。</block>
  <block id="7d8d0afc8d9998a7e6457c6251b4defc" category="paragraph">通过在一个卷中将相关LUN同位、您可以创建一个SnapMirror关系、并通过一次更新来更新所有包含的数据。与快照一样、更新也是一项原子操作。保证SnapMirror目标具有源LUN的单个时间点副本。如果LUN分布在多个卷上、则这些副本之间可能一致、也可能不一致。</block>
  <block id="e45ffde45b5f4090fe8c92a49d38bcb2" category="section-title">卷、LUN和QoS</block>
  <block id="756a4c619fb81eafd00bc072334a5877" category="paragraph">虽然可以有选择地将QoS应用于各个LUN、但在卷级别设置QoS通常更容易。例如、给定ESX服务器中子系统使用的所有LUN都可以放置在一个卷上、然后应用ONTAP自适应QoS策略。因此、会产生一个可自行扩展的每TB IOPS限制、用于对所有LUN执行适用场景操作。</block>
  <block id="fb219ca81e7a635609b70d290a7a3aa2" category="paragraph">同样、如果数据库需要10万次IOPS并占用10个LUN、则在单个卷上设置一个10万次IOPS限制比在每个LUN上设置10个单独的10万次IOPS限制更容易。</block>
  <block id="56739402ea66bd29b7303b69ee165d5b" category="section-title">多卷布局</block>
  <block id="c509cb5f7def30cc77b15b0e91ab39a4" category="paragraph">在某些情况下、在多个卷之间分布LUN可能会很有用。主要原因是控制器条带化。例如、一个HA存储系统可能托管一个数据库、其中需要每个控制器的全部处理和缓存潜力。在这种情况下、典型的设计是、将一半的LUN放置在控制器1上的一个卷中、而将另一半LUN放置在控制器2上的一个卷中。</block>
  <block id="ad328d1793d6c3621e91d83556548a01" category="paragraph">同样、控制器条带化也可用于负载平衡。如果HA系统托管100个数据库、每个数据库包含10个LUN、则可以设计该系统、其中每个数据库在两个控制器中的每个控制器上都接收一个5 LUN卷。这样、在配置更多数据库时、可以保证每个控制器的负载对称。</block>
  <block id="4cd2d5d8d873ad1f707d88334324153a" category="paragraph">但是、这些示例均不涉及卷与LUN的比例为1：1。我们的目标仍然是通过在卷中主机代管相关LUN来优化易管理性。</block>
  <block id="a9fd7be1f3363701ad1b35b16af02c9e" category="paragraph">例如、LUN与卷的比例为1：1就意味着容器化、在容器化中、每个LUN可能真正代表一个工作负载、需要逐个进行管理。在这种情况下、1：1的比例可能是最佳的。</block>
  <block id="64e5a77897fe6326f14436eaaaf5432b" category="section-title">可用空间和LVM空间分配</block>
  <block id="ceb8ec6ec593174c2c6f33be2ca966eb" category="summary">Oracle和ONTAP卷以及LUN放置</block>
  <block id="0724b56ced27e0a66fb4692a57fb1436" category="doc">Oracle数据库LUN放置</block>
  <block id="f595bf3bf71ab0c91a5503ba4efb8ea4" category="paragraph">数据库LUN在ONTAP卷中的最佳放置位置主要取决于各种ONTAP功能的使用方式。</block>
  <block id="05a1ffdb277b8c7ac1dca78adae0017e" category="sidebar">LUN放置</block>
  <block id="9d5c13d45bbf74999764cfe8d4798562" category="summary">适用于VMware vSphere的ONTAP工具安全增强指南、HTTPS证书管理。</block>
  <block id="d6a1787b51b08315bfcc44f3a9bb4b2f" category="paragraph">默认情况下、ONTAP工具会使用安装期间自动创建的自签名证书来保护对Web UI的HTTPS访问。ONTAP工具提供以下功能：</block>
  <block id="1eddd0f3479da31541c39e5ddddfa930" category="list-text">重新生成HTTPS证书</block>
  <block id="61bf3033b18d202012951f5bf7be4fa9" category="paragraph">在ONTAP工具安装期间、会安装HTTPS CA证书、并将该证书存储在密钥库中。用户可以选择通过maine控制台重新生成HTTPS证书。</block>
  <block id="b363a018e3596ec66080579ce5bd4c2d" category="paragraph">通过导航到"Application Configuration"(应用程序配置)→"Re-generate certificates"(重新生成证书)、可以在_maint_控制台中访问上述选项</block>
  <block id="43d609906e5ac2fd9406eddd67d6f82a" category="summary">适用于VMware vSphere的ONTAP工具安全增强指南、用户访问点。</block>
  <block id="c015e2af845448c5e88873c4e51c8cac" category="paragraph">适用于VMware vSphere的ONTAP工具安装会创建和使用三种类型的用户：</block>
  <block id="6399e228248ba3e1f084750197938b67" category="list-text">System User：root用户帐户</block>
  <block id="2a408bd40a0a3130a390340955a699ef" category="list-text">应用程序用户：管理员用户、maintuser和数据库用户帐户</block>
  <block id="5d212a60c02bc59306c8863b31342276" category="list-text">支持用户：diag用户帐户</block>
  <block id="3c2b7b0ce42bb5eb8141643a9729f4ee" category="section-title">1.系统用户</block>
  <block id="b277c4882e7365ab0ac88d56cd6154b3" category="paragraph">system(root)用户是通过在底层操作系统(DeBM)上安装ONTAP工具来创建的。</block>
  <block id="155b9191864da17a7eaaf07b64d596d8" category="list-text">默认系统用户"root"是通过安装ONTAP工具在Debian上创建的。其默认值为禁用、可通过"aint"控制台临时启用。</block>
  <block id="159efbffccd1957bc8c4c78b2a74c085" category="section-title">2.应用程序用户</block>
  <block id="170cab8b15d5b37a17e43144afe7308d" category="paragraph">应用程序用户在ONTAP工具中命名为本地用户。这些用户是在ONTAP工具应用程序中创建的。下表列出了应用程序用户的类型：</block>
  <block id="e01ca242f9b1bef82800de4c209149c7" category="cell">* 用户 *</block>
  <block id="f14c276c07197ebef1394a5a219087a1" category="cell">* 问题描述 *</block>
  <block id="9eb92414db7b53ac16645af9b0f64e58" category="cell">管理员用户</block>
  <block id="ccf6887baccb4288ae3579b56fac8d2a" category="cell">它是在ONTAP工具安装期间创建的、用户在部署ONTAP工具时提供凭据。用户可以选择在"aint"控制台中更改密码。密码将在90天后过期、用户应更改此密码。</block>
  <block id="55df75b800db0f96de770b3c38f676b4" category="cell">维护用户</block>
  <block id="a2bc121b09cae43d6c478870f5298ae5" category="cell">它是在ONTAP工具安装期间创建的、用户在部署ONTAP工具时提供凭据。用户可以选择在"aint"控制台中更改密码。此用户为维护用户、创建此用户名是为了执行维护控制台操作。</block>
  <block id="b124032a093d41b9efbb43f40c538bcb" category="cell">数据库用户</block>
  <block id="86a670227d3e81e8fa34eb4aede3129a" category="section-title">3.支持用户(diag用户)</block>
  <block id="e482d8f0e37161e7916c7a78d2cf7210" category="paragraph">在ONTAP工具安装期间、系统会创建一个支持用户。此用户可用于在服务器发生任何问题描述或中断时访问ONTAP工具并收集日志。默认情况下、此用户处于禁用状态、但可以通过"aint"控制台临时启用。需要注意的是、此用户将在特定时间段后自动禁用。</block>
  <block id="562596399deefc1e2a6cc32eb489976c" category="summary">适用于VMware vSphere的ONTAP工具安全增强指南。</block>
  <block id="80dd7fd00106118cf9c10abf911b7111" category="paragraph">此处列出的是支持在适用于VMware vSphere服务器的ONTAP工具与其他实体(如受管存储系统、服务器和其他组件)之间进行通信所需的端口和协议。</block>
  <block id="d40dfcfdaecc4e8015535acd5de00398" category="section-title">OTV需要入站和出站端口</block>
  <block id="5732d3577c35dfcce968ba967a9a6149" category="cell">*TCP v4/v6端口#*</block>
  <block id="e71a4b7488a97c0e5d8b3ab3efe619e4" category="cell">* 方向 *</block>
  <block id="bc437eb0df24b836c84a74f47b391093" category="cell">*函数*</block>
  <block id="576fe92cf4e45714b61ed10e5c856aa5" category="cell">HTTPS连接+
用于基于HTTPS的SOAP连接+
必须打开此端口、客户端才能连接到ONTAP工具API服务器。</block>
  <block id="4e31bd5bdc8239bb7c98471d3500d951" category="cell">HTTPS连接- VP和SRA +
用于基于HTTPS的SOAP连接</block>
  <block id="7e6b20d014d1c659e4eaf20dc2dcd7eb" category="cell">8443</block>
  <block id="aaa2d7fe63bee55de8ffca52cb61fbd5" category="cell">远程插件</block>
  <block id="25fa62922a9b3c1c2763bbf88014e217" category="cell">Derby数据库端口、仅在此计算机与自身之间、不接受外部连接—仅限内部连接</block>
  <block id="c68bd9055776bf38d8fc43c0ed283678" category="cell">8150</block>
  <block id="b482bc4bf0e383b0858c5d9eb0e96ba9" category="cell">日志完整性服务在端口上运行</block>
  <block id="9956361dfa33899fc0efed6ee3946512" category="section-title">控制对Derby数据库的远程访问</block>
  <block id="58b7326b56820f4b18dfd73dc9707831" category="paragraph">管理员可以使用以下命令访问derby数据库。可通过ONTAP工具本地VM和远程服务器通过以下步骤访问它：</block>
  <block id="296068c08046bbf197300e38c4e851cb" category="paragraph">*[.underline]#示例：#*</block>
  <block id="10046bc1eb8463e6ca6ae51bd3b7a574" category="inline-image-macro">Derby、宽度=468、高度=136</block>
  <block id="36434da35edb72a1f85cbbcc1ff2b197" category="paragraph"><block ref="36434da35edb72a1f85cbbcc1ff2b197" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f21dd7ffc271f1301878c3078a59692d" category="summary">《适用于VMware vSphere的ONTAP工具安全增强指南》、登录横幅。</block>
  <block id="ae20daf991a940f9de7033ff0a1af410" category="paragraph">用户通过 SSH 通道完成登录后，将显示以下文本：</block>
  <block id="8f1b6f904292913013b1f6e578d7b074" category="summary">适用于VMware vSphere的ONTAP工具安全增强指南、完整性验证。</block>
  <block id="aeeb9f5277554716592480db544d25f3" category="paragraph">客户可以通过两种方法验证其ONTAP工具安装包的完整性。</block>
  <block id="126ba7383e25522e071a963ddd6f220f" category="list-text">验证校验和</block>
  <block id="deccc645a0c8869a44e645f2f4247dbd" category="list-text">验证签名</block>
  <block id="e5f3970dd7fabab1726b53d58d636de2" category="paragraph">OTV安装包的下载页面上提供了校验和。用户必须根据下载页面上提供的校验和验证已下载软件包的校验和。</block>
  <block id="7452fe022f94726684aeea655673eb0f" category="section-title">验证ONTAP工具OVA的签名</block>
  <block id="373d060b52f94a014177952dcca0c4e9" category="paragraph">vapp安装包以tarball的形式提供。此tarball包含虚拟设备的中间证书和根证书、以及自述文件和OVA软件包。README文件可指导用户如何验证vapp OVA软件包的完整性。</block>
  <block id="48fefdb76906b256f183e6f68b23eba1" category="paragraph">客户还必须上传vCenter 7.0U3和更高版本上提供的根证书和中间证书。  对于7.0.1和7.0.U三e之间的vCenter版本、VMware不支持验证证书的功能。客户不需要上传vCenter 6.x的任何证书</block>
  <block id="84a005842347a9560b170cfcd79c5203" category="section-title">将可信根证书上传到vCenter</block>
  <block id="57f60da4817dc5d71c45890bb182781e" category="list-text">使用VMware vSphere Client登录到vCenter Server。</block>
  <block id="72282f16a7aca6b61acfc6fe27ce55c7" category="list-text">为administrator@vsphere.local或vCenter Single Sign-On Administrators组的其他成员指定用户名和密码。如果您在安装期间指定了其他域、请以管理员身份@mydomain登录。</block>
  <block id="43a75b176810226695d2db6f52c87b73" category="list-text">如果系统提示您、请输入vCenter Server的凭据。</block>
  <block id="5f51c5b3cb2f48fd1d670bf384d1006d" category="list-text">在可信根证书下、单击添加。</block>
  <block id="55c3b759c54a437c7ced6432f1c62de0" category="list-text">单击浏览并选择证书.prom文件(OTV_OVA_inter_root_CERT_chain.prom)的位置。</block>
  <block id="8acdedaaa4134bb6ae49472b4bc268a7" category="list-text">单击添加。此时、证书将添加到存储中。</block>
  <block id="e2200da08ea15bdea0f97dbfc4e9f1c7" category="inline-link-macro">将可信根证书添加到证书存储</block>
  <block id="6eeecddd909e7e017ba2732e46dc739c" category="paragraph">请参见 <block ref="b8e45b03638af10d852f253eba7e63e3" category="inline-link-macro-rx"></block> 有关详细信息 ...在部署vapp时(使用OVA文件)、可以在"查看详细信息"页面上验证vapp包的数字签名。如果下载的vapp软件包为正版、"发布者"列将显示"可信证书"(如以下屏幕截图所示)。</block>
  <block id="a13b63a149750821fb588cd3cb41c209" category="inline-image-macro">可信证书</block>
  <block id="a83d8109f7a0cf9c4a04c65c40ecd354" category="paragraph"><block ref="a83d8109f7a0cf9c4a04c65c40ecd354" category="inline-image-macro-rx" type="image"></block></block>
  <block id="61dc5ac976a8bd4a8744d8890305d26e" category="section-title">验证ONTAP工具ISO和SRA tar.gz的签名</block>
  <block id="d4f26c1c073b64ba200e3fa71762c256" category="paragraph">NetApp会在产品下载页面上与客户共享其代码签名证书、以及OTV-ISO和sra.tgz的产品zip文件。</block>
  <block id="a7ac1e7561da5cc70126cfea891de159" category="paragraph">用户可以从代码签名证书中提取公共密钥、如下所示：</block>
  <block id="5f4345a6f62f7a3926b2c3d92f5574f6" category="paragraph">然后，应使用公共密钥验证ISO和tgz产品zip的签名，如下所示：</block>
  <block id="81eeab9506186e2dca8faefa78d54067" category="paragraph">示例</block>
  <block id="c6666237b03fcb86e315a0a06e73b6ef" category="summary">适用于VMware vSphere的ONTAP工具安全增强指南、存储管理连接的相互TLS加密。</block>
  <block id="53893182b7e17fb2da37935ee3ffda55" category="paragraph">ONTAP 9.7及更高版本支持相互TLS通信。从适用于VMware和vSphere 9.12的ONTAP工具开始、可使用相互TLS与新添加的集群进行通信(具体取决于ONTAP版本)。</block>
  <block id="1be712dee4c47804142318ffb739e46b" category="paragraph">对于先前添加的所有存储系统：在升级期间、所有添加的存储系统都将获得自动信任、并配置基于证书的身份验证机制。</block>
  <block id="d39adf53eaace0fbba30d4e13760a974" category="paragraph">如以下屏幕截图所示、集群设置页面将显示为每个集群配置的相互TLS (基于证书的身份验证)的状态。</block>
  <block id="c036889d83926f57571c8b12e4f7fb6f" category="inline-image-macro">图像2、宽度=468、高度=158</block>
  <block id="095064767a4b9cadb4016dfc2788237c" category="paragraph"><block ref="095064767a4b9cadb4016dfc2788237c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="53f061d401dd80027634ccca2a19cd8d" category="section-title">*集群添加*</block>
  <block id="7ce4b2757e70979f49bcf8f64ba36363" category="paragraph">在集群添加工作流期间、如果要添加的集群支持MTLS、则默认情况下会配置MTLS。用户无需为此执行任何配置。以下屏幕截图显示了在添加集群期间向用户显示的屏幕。</block>
  <block id="3c1556a297200019d3a0b8045c0956b9" category="inline-image-macro">添加存储系统、宽度=450、高度=400</block>
  <block id="3a225aabc3c5c25670ad0b4d131da24f" category="paragraph"><block ref="3a225aabc3c5c25670ad0b4d131da24f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="987de6e025f6af1fc4451710295ca76f" category="inline-image-macro">添加存储系统、宽度=468、高度=416</block>
  <block id="576a9128888c73fc82869b3ae173c7d2" category="paragraph"><block ref="576a9128888c73fc82869b3ae173c7d2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="307eba22b8070bb93e642827620f8588" category="paragraph"><block ref="307eba22b8070bb93e642827620f8588" category="inline-image-macro-rx" type="image"></block></block>
  <block id="71cfed326a2cabd3b505c6580123a459" category="inline-image-macro">添加存储系统、宽度=468、高度=516</block>
  <block id="a3a8f9da50b3f15d69f3186129f159f6" category="paragraph"><block ref="a3a8f9da50b3f15d69f3186129f159f6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3b3ebbeea272602ddec07bb77e34668a" category="section-title">集群编辑</block>
  <block id="d2562e450657937f981a45d9d18ff4ec" category="paragraph">在集群编辑操作期间、有两种情形：</block>
  <block id="500bcb89776517849e2e07073aad4eca" category="list-text">如果ONTAP证书过期、则用户必须获取新证书并上传。</block>
  <block id="edf2227e3378b5b0864ef73e58d39d77" category="list-text">如果OTV证书过期、则用户可以通过选中复选框来重新生成它。</block>
  <block id="6db8cdf80049c7cf629fe6f8f6e3a9c0" category="list-text">为ONTAP生成新的客户端证书_</block>
  <block id="acba923a9524c642724d6ff34f5dac93" category="inline-image-macro">修改存储系统、宽度=468、高度=461</block>
  <block id="6a59df9970674c274e20b1d91be2df8a" category="paragraph"><block ref="6a59df9970674c274e20b1d91be2df8a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="75545011d3e6abe8a2cd8cd5bc21c6fd" category="paragraph"><block ref="75545011d3e6abe8a2cd8cd5bc21c6fd" category="inline-image-macro-rx" type="image"></block></block>
  <block id="14a73da2f5fe352620bed1b49a3319ed" category="summary">《适用于VMware vSphere的ONTAP工具的安全增强指南》、《针对DOS攻击的网络安全保护》。</block>
  <block id="8f7e7bd942f453f0550dc4f907e88810" category="paragraph">默认情况下、每个用户的最大并发请求数为48个。ONTAP工具中的root用户可以根据其环境的要求更改此值。*此值不应设置为非常高的值，因为它提供了一种防止拒绝服务(DOS)攻击的机制。*</block>
  <block id="99c1088ea27d16b42c6b45d794f59d3f" category="paragraph">用户可以在*__/opt/NetApp/vscserver/etc/dosfilterParams.json_*文件中更改最大并发会话数和其他受支持的参数。</block>
  <block id="5e7c907630f5a432ac6b39f0b8c04c28" category="paragraph">我们可以通过以下参数配置筛选器：</block>
  <block id="a35f2f4ccb228969a85b8719ea25b047" category="list-text">*_delayMs_*：在考虑之前，所有请求超出速率限制的延迟(以毫秒为单位)。提供-1仅拒绝请求。</block>
  <block id="f1b9d5fde713093a3a80f140d1439d37" category="list-text">*_throtleMs_*：等待信标的非同步等待时间。</block>
  <block id="aa363bec6acd7600aedeee5377470bde" category="list-text">*_maxRequestMs_*：允许此请求运行的时间长度。</block>
  <block id="351b695725caafd647abb749c50a7e6f" category="list-text">*_ipWhitlist_*：不受速率限制的IP地址的逗号分隔列表。(可以是vCenter、ESXi和SRA IP)</block>
  <block id="058e1fe7e6afcd3bcff86482a583976b" category="list-text">*_maxRequestsPerSec_*：每秒从连接发出的最大请求数。</block>
  <block id="1c1496a21f967d57b50fe5ebb0e62125" category="paragraph">*_dosfilterParams file_:*中的默认值</block>
  <block id="9afb15056a8bc8b4402d55eba2274dad" category="summary">适用于VMware vSphere的ONTAP工具安全增强指南、NTP配置。</block>
  <block id="48edbd8a951efb0ad617f7868b27a6c0" category="paragraph">有时、由于网络时间配置的差异、可能会出现安全问题。请务必确保网络中的所有设备都具有准确的时间设置、以防止出现此类问题。</block>
  <block id="a55d703ea2930e8e72e94ce11c3297ab" category="section-title">*虚拟设备*</block>
  <block id="5a65f4c9ca6d99f573528348d36914fa" category="paragraph">您可以从虚拟设备的维护控制台配置NTP服务器。  用户可以在_System Configuration_=&gt;_Add new NTP Server_选项下添加NTP服务器详细信息</block>
  <block id="90ab4fc7a1c530bceac36bda71efbc5f" category="paragraph">默认情况下、NTP的服务为ntpd.这是一项传统服务、在某些情况下不适用于虚拟机。</block>
  <block id="6801ecdb823d018c7370042d27b5ee2c" category="section-title">*Debian</block>
  <block id="dc3bb5166d38d2aec53765aca7c0d24c" category="paragraph">在Debian上、用户可以访问/etc/ntp.conf文件以获取NTP服务器详细信息。</block>
  <block id="fec65f0c33739368ce5845fadb6cb880" category="paragraph">这些指南适用于设备本身的应用程序和子操作系统。</block>
  <block id="5aaf8fc9424d7872cf500fb7adcb3b97" category="summary">《适用于VMware vSphere的ONTAP工具安全增强指南》、密码策略配置。</block>
  <block id="53477738359cebc12d4e01727ee8b5e7" category="paragraph">首次部署ONTAP工具或升级到9.12或更高版本的用户需要同时遵循管理员和数据库用户的强密码策略。在部署过程中、系统将提示新用户输入其密码。对于升级到9.12或更高版本的brownfield用户、维护控制台中将提供遵循强密码策略的选项。</block>
  <block id="7afd9be20a239f83f98bdbc7f90512ef" category="list-text">用户登录maIT控制台后、系统将根据复杂规则集检查密码、如果发现未遵循此规则、则会要求用户重置相同密码。</block>
  <block id="1e048d74f3d9375186833526a00f4309" category="list-text">密码默认有效期为90天、75天后、用户将开始收到更改密码的通知。</block>
  <block id="dbb73ef3f8e9b61d387a809281a654cc" category="list-text">需要在每个周期设置新密码、系统不会将最后一个密码作为新密码。</block>
  <block id="210b05d5e7375bcb02bcf09a873bbda6" category="list-text">每当用户登录maIT控制台时、它都会检查密码策略、如以下屏幕截图、然后再加载主菜单：</block>
  <block id="bc66b4fce20ef49b05e4a54f053e65a6" category="inline-image-macro">主菜单、宽度=468、高度=116</block>
  <block id="4661acb75237098be364b3c05d7d9b7c" category="paragraph"><block ref="4661acb75237098be364b3c05d7d9b7c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8f09c69f731d4d6f2e8d6135082aa8e4" category="list-text">如果发现不符合密码策略、或者不符合ONTAP工具9.11或更早版本的升级设置。然后、用户将看到以下屏幕以重置密码：</block>
  <block id="4499d4bfb9610056781e2e61956dd0ca" category="inline-image-macro">密码重置屏幕，宽度=468，高度=116</block>
  <block id="a84278f7bf3ee281e39e467fca1fe454" category="paragraph"><block ref="a84278f7bf3ee281e39e467fca1fe454" category="inline-image-macro-rx" type="image"></block></block>
  <block id="47e6664ac0a72e1d719cfc288383b4f8" category="list-text">如果用户尝试设置弱密码或再次提供最后一个密码、则用户将看到以下错误：</block>
  <block id="fe04952c38b6a9a7db1a75bbb4905232" category="inline-image-macro">弱密码错误、宽度=468、高度=101</block>
  <block id="2c59de9ea5183e73d5fa6382fa7f3fc1" category="paragraph"><block ref="2c59de9ea5183e73d5fa6382fa7f3fc1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="704c7fc6c4d40b9af6aafb7cf9b44022" category="paragraph">为了防止未经授权的访问、系统会设置非活动超时、以便在使用授权资源时自动注销在特定时间段内处于非活动状态的用户。这样可以确保只有授权用户才能访问资源、并有助于保持安全性。</block>
  <block id="80f9ebebc8f94450338d28bcb4a2164d" category="inline-link">配置vSphere Client超时值</block>
  <block id="3748702da26b5718f1f7c769ce58b009" category="list-text">默认情况下、vSphere Client会话会在空闲120分钟后关闭、需要用户重新登录才能继续使用客户端。您可以通过编辑webclient.properties文件来更改超时值。 您可以配置vSphere Client的超时<block ref="ec8715bde1a929a6f64160d5372f4574" category="inline-link-rx"></block></block>
  <block id="e4306c4cf124046d8f90518752cd5021" category="list-text">ONTAP工具的web-cli会话注销时间为30分钟。</block>
  <block id="7fb0cadcdae6feac05c7b8274b97b3c7" category="sidebar">ONTAP工具强化概述</block>
  <block id="10b486896b1a91f5d38214dfb30c4263" category="sidebar">验证ONTAP工具安装包的完整性</block>
  <block id="7c7c4cc4771d6114aa8b4d38f5817a85" category="sidebar">端口和协议</block>
  <block id="919e26ea009ce7fa2dcc499a27ccc6aa" category="sidebar">访问点(用户)</block>
  <block id="333dd505db0523536c6885f47456518c" category="sidebar">相互TLS</block>
  <block id="6a3f3799bc264d32568bb7169ddd515a" category="sidebar">HTTPS证书</block>
  <block id="4b7ad38343c4b2010cf81e6b2933e186" category="sidebar">登录横幅</block>
  <block id="bfdb89134acf30ff5da790924cefa0ac" category="sidebar">非活动超时</block>
  <block id="cb197b06aa92a742d01e256d58d3e34b" category="sidebar">DOS攻击</block>
  <block id="d870a4bd29f74339732a958574d2c4eb" category="sidebar">NTP配置</block>
  <block id="339ce1d4220ba7045e3a35ef35279ad3" category="sidebar">密码策略</block>
  <block id="3698338a95ad1801e25ed154adaf1a70" category="summary">适用于VMware vSphere的ONTAP工具安全强化指南概述和简介。</block>
  <block id="47d29daaa26fbfa9c9a069d4cd023ac1" category="doc">适用于VMware vSphere的ONTAP工具安全强化指南</block>
  <block id="fe0e23a929284a636c245a362ada6472" category="paragraph">适用于VMware vSphere的ONTAP工具的安全强化指南提供了一套全面的说明、用于配置最安全的设置。</block>
  <block id="bc86ce4caa57368f9094a93dd72ffd28" category="paragraph">如果需要Domino模式、则NetApp提供SnapMirror同步(SM-S)。此外、还存在应用程序级选项、例如Oracle DataGuard或SQL Server Always On可用性组。可以选择操作系统级磁盘镜像。有关追加信息和选项、请咨询您的NetApp或合作伙伴客户团队。</block>
  <block id="8059304404c995bd8a349056e7d40e32" category="inline-link">_VMware虚拟化NetApp解决方案，由Broadcom提供_</block>
  <block id="cc5363f91541e771ebd890b2330cb8ba" category="paragraph"><block ref="cc5363f91541e771ebd890b2330cb8ba" category="inline-link-rx"></block></block>
  <block id="c90946faf2ed37e17d936e0b3acde7a7" category="summary">对空闲数据进行加密的需求不断增加、这种需求已超出传统数据的范畴、扩展到所有已存储的数据类型。</block>
  <block id="b1e1676a19b222da72a55b95aa86d3e9" category="paragraph">要深入了解更多安全主题、请参阅以下资源。</block>
  <block id="e6bd708199eed7d8bf33ef8308be0b3e" category="inline-link-macro">安全技术报告</block>
  <block id="fb7f6edb08c080e81bd91a922a9d08f8" category="list-text"><block ref="fb7f6edb08c080e81bd91a922a9d08f8" category="inline-link-macro-rx"></block></block>
  <block id="ff8c9f0959eb84d21416835c3f9c89d6" category="inline-link-macro">安全强化指南</block>
  <block id="589b1ebfaed268e1548717208be6131f" category="list-text"><block ref="589b1ebfaed268e1548717208be6131f" category="inline-link-macro-rx"></block></block>
  <block id="e44de13cc4b452eccde9961bbe9da42b" category="inline-link-macro">ONTAP安全性和数据加密产品文档</block>
  <block id="c76e848365d3a2199dfced47ddbf8690" category="list-text"><block ref="c76e848365d3a2199dfced47ddbf8690" category="inline-link-macro-rx"></block></block>
  <block id="7436b418bed093768e360d32105591d2" category="inline-link-macro">ONTAP Select 文档</block>
  <block id="82fe32c89de73116e2188701ca735c39" category="list-text"><block ref="82fe32c89de73116e2188701ca735c39" category="inline-link-macro-rx"></block></block>
  <block id="f5c286d9dc4cdaffcb8e5c86388e6ed8" category="list-text"><block ref="f5c286d9dc4cdaffcb8e5c86388e6ed8" category="inline-link-macro-rx"></block></block>
  <block id="4dab2f9796b0af6304d00e21e2b9dfb4" category="inline-link-macro">基于 AWS 的 VMware Cloud</block>
  <block id="560d5b2cd40977bd7b77b31d7088f657" category="list-text"><block ref="560d5b2cd40977bd7b77b31d7088f657" category="inline-link-macro-rx"></block></block>
  <block id="9789f0612fda153726aa8ad87265e4b9" category="inline-link-macro">Azure VMware 解决方案</block>
  <block id="f068ad668d317d445bc0da61125c318f" category="list-text"><block ref="f068ad668d317d445bc0da61125c318f" category="inline-link-macro-rx"></block></block>
  <block id="8cb69aa5b1609d0a39f0fcd576c07df6" category="inline-link-macro">Google Cloud VMware 引擎</block>
  <block id="dadb2f85467c159b9d8387744cdd0ce6" category="list-text"><block ref="dadb2f85467c159b9d8387744cdd0ce6" category="inline-link-macro-rx"></block></block>
  <block id="e6288bb2b93ca74537fbff66317f01d9" category="inline-link-macro">什么是Google Cloud NetApp卷？</block>
  <block id="e19aa8cca2f701dba5fc123376bebdb5" category="list-text"><block ref="e19aa8cca2f701dba5fc123376bebdb5" category="inline-link-macro-rx"></block></block>
  <block id="b44c4aa4ed40a2c01a89549bc8746cbd" category="cell">对于大多数vSphere 6.X版本、设置为512 MB。
对于6.5U3、6.7U3和7.0或更高版本、设置为默认值(1024MB)。</block>
  <block id="f3c4f211a4831f8f7c223705b0fccd5d" category="paragraph">在控制服务级别、管理未知工作负载或在部署之前测试应用程序以确保它们不会影响生产环境中的其他工作负载时、吞吐量限制非常有用。它们还可用于在确定抢占资源的工作负载后对其进行限制。</block>
  <block id="5ab12aefceb83851b73081a686bd30ab" category="section-title">ONTAP QoS策略支持</block>
  <block id="8aa45e69fd8330d5e4d2f6e16309ff41" category="paragraph">此外，还支持基于 IOPS 的最低服务级别，以便为 ONTAP 9.2 中的 SAN 对象和 ONTAP 9.3 中的 NAS 对象提供稳定一致的性能。</block>
  <block id="98d229565d14d4d286f57a588a784c1e" category="inline-link-macro">性能监控和管理概述</block>
  <block id="b7629a90716592b8dcae7480ad66d224" category="paragraph">请参见 <block ref="de4b907e949a377b72cd0f0b0595d155" category="inline-link-macro-rx"></block> 有关详细信息 ...</block>
  <block id="81eba6b819a671b6c8962061afd13a78" category="section-title">非卷NFS数据存储库</block>
  <block id="5bafceb9f14cf4b07086992cd31326a5" category="paragraph">ONTAP QoS策略可应用于整个数据存储库或其中的各个VMDK文件。但是、请务必了解、传统(非Vvol) NFS数据存储库上的所有VM都会共享给定主机的一个通用I/O队列。如果任何虚拟机受到ONTAP QoS策略的控制、则实际上会导致该主机上该数据存储库的所有I/O都受到控制。</block>
  <block id="1520a4910ffa6efc27379931cc307d0b" category="paragraph">* 示例： *
*对于主机ESXi -01作为传统NFS数据存储库挂载的卷、您需要在vm1.vmdk上配置QoS限制。
*同一主机(ESXi -01)正在使用vm2.vmdk、并且位于同一个卷上。
*如果vm1.vmdk受到节流、则vm2.vmdk也会显示为已节流、因为它与vm1.vmdk共享同一个IO队列。</block>
  <block id="caf18b31d986fc095c3c0cd6a1f19f9e" category="paragraph">从vSphere 6.5开始、您可以利用具有存储I/O控制(SIIOC) v2的基于存储策略的管理(Storage Policy-Based Management、SPBM)来管理非Vvol数据存储库的文件粒度限制。</block>
  <block id="c28029445f9803e209550517678387a9" category="paragraph">有关使用SIC和SPBM策略管理性能的详细信息、请参见以下链接。</block>
  <block id="8bef032522908e987555b77fb50dbb85" category="inline-link-macro">SPBM基于主机的规则：SIIOC v2</block>
  <block id="98a7507b3e8be801707c07e336bc5506" category="inline-link-macro">使用vSphere管理存储I/O资源</block>
  <block id="37b0c263c77e85e59d9f00438e870fa4" category="paragraph"><block ref="ea373db41b8c05446b96b46f4bbe1141" category="inline-link-macro-rx"></block>
<block ref="c5badf4fd27434d786395fe52801b533" category="inline-link-macro-rx"></block></block>
  <block id="cd6af799ac31b0fbf81bcbba1d3d6bf1" category="list-text">必须将此策略应用于<block ref="3b9aef0680339707b430261c2f800255" prefix=" " category="inline-code"></block> 包含实际虚拟磁盘映像、而不是<block ref="aa26c73336ecfd98ed727b3e249c7f90" prefix=" " category="inline-code"></block> (虚拟磁盘描述符文件)或<block ref="092eb4dd2ca488962f4c22b3e8cc4ca0" prefix=" " category="inline-code"></block> (VM描述符文件)。</block>
  <block id="9aa28dc739b66a86d9f73ba24b9dd4c2" category="paragraph">在使用适用于 VMware vSphere 9.8 及更高版本的 ONTAP 工具时， FlexGroup 数据存储库可提供增强的 QoS 功能。您可以轻松地在数据存储库中的所有 VM 或特定 VM 上设置 QoS 。有关详细信息，请参见本报告的 FlexGroup 一节。请注意、上述传统NFS数据存储库的QoS限制仍然适用。</block>
  <block id="b5380e34617914719b059f6d55b97b66" category="section-title">VMFS数据存储库</block>
  <block id="b74c42e3de8c5b901769e263bf236711" category="paragraph">使用ONTAP LUN、可以将QoS策略应用于包含LUN或单个LUN的FlexVol卷、但不能应用于单个VMDK文件、因为ONTAP无法识别VMFS文件系统。</block>
  <block id="e122a7a507ac1f580cc5b9f2632a851c" category="section-title">数据存储库</block>
  <block id="be1ca5bcad3b34c08e2b2d7bfc8a95e3" category="paragraph">使用基于存储策略的管理和Vvol、可以轻松地在各个VM或VMDK上设置最小和/或最大QoS、而不会影响任何其他VM或VMDK。</block>
  <block id="f5ac983ee93a7017d283971566bc828e" category="paragraph">在为VVOV容器创建存储功能配置文件时、请在性能功能下指定一个最大和/或最小IOPS值、然后使用虚拟机的存储策略引用此SCP。在创建虚拟机时使用此策略或将此策略应用于现有虚拟机。</block>
  <block id="1f23e960871a0a77a49731a6b47646c5" category="inline-link-macro">采用ONTAP的VMware vSphere虚拟卷(Vvol)</block>
  <block id="8743b08c4d707cd145a4e7acce189480" category="cell">是(数据存储库可能会受到控制)</block>
  <block id="b2891bc898f2a418aa349b623568299e" category="summary">借助Active IQ Unified Manager、可以监控VMware vSphere环境中的NetApp存储和性能问题并对其进行故障排除。</block>
  <block id="b7ce758ec5c25cb23edfa4ead0d0097e" category="admonition">* NetApp建议*使用旋转驱动器时至少留出15%的可用空间。这包括所有未使用的空间、包括聚合或卷中的可用空间、以及由于使用完全配置而分配但实际数据未使用的任何可用空间。可用空间接近10%时、性能将受到影响。</block>
  <block id="5a7f49be424e282d22b4c3889f5cd341" category="paragraph">MetroCluster是ONTAP的一项功能、可通过站点间的RPO = 0同步镜像保护Oracle数据库、并可进行扩展以在一个MetroCluster系统上支持数百个数据库。</block>
  <block id="30160293c6cf2d26d13cbd294af7fb4c" category="paragraph">它也易于使用。使用MetroCluster并不一定会增加或更改运行企业级应用程序和数据库的任何最佳网络竞赛。</block>
  <block id="641cc5f60c71fe9f9a2e15c5cc680ec3" category="summary">适用于VMware vSphere的ONTAP工具、TCP端口和协议的安全增强指南</block>
  <block id="273eb98a312e607888044e87e0210015" category="section-title">NetApp虚拟卷支持</block>
  <block id="551e3b0a48f99995daac658b17a1de62" category="list-text">*更好的容量管理*通过使用VASA和ONTAP工具、可以根据需要查看存储容量、使其降至各个聚合级别、并在容量开始不足时提供多层警报。</block>
  <block id="38653f1dd04b13c5276f4f4a82e8506f" category="admonition">术语"连接"是指用于跨站点复制的集群连接。它不是指主机协议。无论用于集群间通信的连接类型如何、MetroCluster配置均支持所有主机端协议。</block>
  <block id="6f343e6c5daed91ac953577dd5e1e06e" category="doc">复制连接丢失</block>
  <block id="6f04ca443b44ef3da2adedd7c0cf36fa" category="paragraph">在以下示例中、假设站点A已配置为首选站点。</block>
  <block id="f553ed0b13f8b38932589ba34432ab5a" category="paragraph">如果SM-AS复制中断、则无法完成写入IO、因为集群无法将更改复制到相反站点。</block>
  <block id="2ef1646841c5728f668289819e837437" category="section-title">站点A (首选站点)</block>
  <block id="47d7b1b43310c2ce615be2e71aed414d" category="paragraph">首选站点上的复制链路故障会导致写入IO处理暂停大约15秒、因为ONTAP会在确定复制链路确实无法访问之前重试复制的写入操作。15秒后、站点A系统将恢复读取和写入IO处理。SAN路径不会更改、LUN将保持联机状态。</block>
  <block id="bb713afeab82bcb45a45d3cc1411e3eb" category="section-title">站点 B</block>
  <block id="dc68c1abbc392a93905ce712c45999eb" category="paragraph">由于站点B不是SnapMirror主动同步首选站点、因此其LUN路径将在大约15秒后变得不可用。</block>
  <block id="3784559d5087e35dc7372b1c51cf920e" category="section-title">存储系统故障</block>
  <block id="901afcf3108cffc70b3209e8613babf0" category="paragraph">存储系统故障的结果与丢失复制链路的结果几乎相同。正常运行的站点应出现大约15秒的IO暂停。15秒过后、IO将照常在该站点上恢复。</block>
  <block id="0ce6f0c843cdd28d3ff7284039730959" category="section-title">调解器丢失</block>
  <block id="6b9600f6a35d60a0773b02ff771e5be1" category="paragraph">调解器服务不直接控制存储操作。它可用作集群之间的备用控制路径。它主要用于自动执行故障转移、而不存在脑裂情况的风险。在正常操作下、每个集群都会将更改复制到其配对集群、因此、每个集群都可以验证配对集群是否联机并提供数据。如果复制链路失败、复制将停止。</block>
  <block id="878273b0ad33bf4f330480ad6262d08c" category="paragraph">安全自动故障转移需要调解器的原因是、否则存储集群将无法确定双向通信丢失是网络中断还是实际存储故障所致。</block>
  <block id="7bccc28ee4a5fac4fa93b691ca9733bc" category="paragraph">调解器为每个集群提供一个备用路径、以验证其配对集群的运行状况。具体情形如下：</block>
  <block id="7ba0268be94dd09db527214e2f2862b4" category="list-text">如果集群可以直接与其配对集群联系、则复制服务将正常运行。无需执行任何操作。</block>
  <block id="5c3163ce1d24869bf6e6594bcd37901d" category="list-text">如果首选站点无法直接或通过调解器与其配对站点联系、则会假定配对站点实际不可用或已隔离、并且其LUN路径已脱机。然后、首选站点将继续释放RPO = 0状态、并继续处理读写IO。</block>
  <block id="e2c06d8468f627e9f8fdc9380204f00f" category="list-text">如果非首选站点无法直接与其配对站点联系、但可以通过调解器与其联系、则它会使其路径脱机、并等待复制连接返回。</block>
  <block id="f7fd4567c8be042fc3f9be5b45124d76" category="list-text">如果非首选站点无法直接联系其配对站点或无法通过操作调解器联系其配对站点、则会假定配对站点实际不可用或已隔离、并且其LUN路径已脱机。然后、非首选站点将继续释放RPO = 0状态、并继续处理读写IO。它将承担复制源的角色、并成为新的首选站点。</block>
  <block id="1286d22222876588b31270c148d8c480" category="paragraph">如果调解器完全不可用：</block>
  <block id="3cc95aae492aaec45753d6e6b7d91c12" category="list-text">复制服务因任何原因发生故障(包括非首选站点或存储系统发生故障)、都会导致首选站点释放RPO = 0状态并恢复读写IO处理。非首选站点将使其路径脱机。</block>
  <block id="92395625e4bc805c933a9b4f52c5c594" category="list-text">首选站点发生故障将导致中断、因为非首选站点无法验证对等站点是否真正脱机、因此非首选站点无法安全地恢复服务。</block>
  <block id="3450c1f3c1166bb5f38dd42c45eb1b70" category="section-title">正在还原服务</block>
  <block id="5a0a7b8380bda809ef1b210c3bb41b93" category="paragraph">解决故障(例如、还原站点间连接或启动故障系统)后、SnapMirror活动同步端点将自动检测是否存在故障复制关系、并将其恢复为RPO = 0状态。重新建立同步复制后、故障路径将再次联机。</block>
  <block id="8f3219fa36fad5d789373fdf883d28b1" category="paragraph">在许多情况下、集群模式应用程序会自动检测故障路径的返回情况、这些应用程序也会恢复联机。在其他情况下、可能需要进行主机级SAN扫描、或者可能需要手动将应用程序恢复联机。它取决于应用程序及其配置方式、通常、此类任务可以轻松实现自动化。ONTAP本身具有自我修复能力、不需要任何用户干预即可恢复RPO = 0存储操作。</block>
  <block id="52ec8762530eb85c0734309b6747a861" category="section-title">手动故障转移</block>
  <block id="afe62727c9717a186ce014753f902c8a" category="paragraph">更改首选站点只需简单的操作即可。在集群之间切换复制行为的权限时、IO将暂停一两秒钟、但IO不会受到影响。</block>
  <block id="2d430e41b39275608ed6816ee435f2c4" category="paragraph">调解器并不是真正的断路器、但它提供的功能实际上就是这样。它不会执行任何操作、而是为集群到集群的通信提供备用通信通道。</block>
  <block id="caeb8c810d4965bfc8ad369332977e54" category="inline-image-macro">带调解器的SnapMirror活动同步图</block>
  <block id="2767cf2bbeaf5540c1e615745cfead81" category="paragraph">自动化故障转移的第一大挑战是脑裂问题、如果两个站点彼此断开连接、就会出现该问题。应该发生什么？您不希望让两个不同的站点将自己指定为数据的无故障副本、但单个站点如何区分实际丢失相对站点与无法与相反站点通信之间的区别？</block>
  <block id="661d0a9679d7d1af0f76f646c941e5cc" category="paragraph">这是调解者进入画面的地方。如果放置在第三个站点上、并且每个站点都与该站点建立了单独的网络连接、则每个站点都有一条额外的路径来验证另一个站点的运行状况。再次查看上图、并考虑以下情形。</block>
  <block id="d0c23d9c3fc0a960d3362e7ba10243f5" category="list-text">如果调解器发生故障或无法从一个或两个站点访问、会发生什么情况？</block>
  <block id="123c024944e0a1dd3f71661e6d0e5005" category="list-text">两个集群仍可通过复制服务所使用的同一链路彼此通信。</block>
  <block id="00a2d2948ebb25dba32d9366b8655dfc" category="list-text">数据仍会提供RPO = 0保护</block>
  <block id="7ac2e4e468f2c732023f530f71ac9dbb" category="list-text">如果站点A发生故障、会发生什么情况？</block>
  <block id="ce89434a9a13b39dccbbded97d674de0" category="list-text">站点B将看到两个通信通道关闭。</block>
  <block id="0a22d4bfa3bb021654f02d82cdbb9422" category="list-text">站点B将接管数据服务、但没有RPO = 0镜像</block>
  <block id="2a7681a43b5e9647d24566f342ab0b27" category="list-text">如果站点B发生故障、会发生什么情况？</block>
  <block id="1c8ff8325f78bcc084c3c197606b5482" category="list-text">站点A将看到两个通信通道关闭。</block>
  <block id="8a8e5bd62b16753898cefd37bdf7ccb4" category="list-text">站点A将接管数据服务、但没有RPO = 0镜像</block>
  <block id="11b1ce76911fece428e0edd5c9e7682f" category="paragraph">还需要考虑另一种情形：丢失数据复制链路。如果站点之间的复制链路丢失、显然无法执行RPO = 0镜像。那么应该发生什么呢？</block>
  <block id="3e2a78d8ed8be1e5b40ff81cc9e2a2d6" category="paragraph">这由首选站点状态控制。在SM-AS关系中、其中一个站点是另一个站点的二级站点。这对正常操作没有影响、并且所有数据访问都是对称的、但是如果复制中断、则必须断开连接才能恢复操作。结果是、首选站点将继续操作而不进行镜像、而二级站点将暂停IO处理、直到复制通信恢复为止。</block>
  <block id="225caaa9ecf3ac7dfb141c808a1c1651" category="paragraph">通过SnapMirror主动同步(以前称为SnapMirror业务连续性或SM-bc)、各个SQL Server数据库和应用程序可以在发生中断时继续提供服务、并且无需任何手动干预即可实现透明的存储故障转移。</block>
  <block id="700cb79deb6ef819c0aacbb228c5a16b" category="paragraph">SnapMirror活动同步(SM-AS)基于SnapMirror同步。两者都可以实现RRPO = 0的数据同步复制、但SM-AS通过为SAN数据提供近乎为零的RTO可用性、进一步推动了解决方案的发展。这可以通过自动化来实现、该自动化可管理SAN路径以保持数据可用。站点、控制器和通信故障均由ONTAP自动处理。</block>
  <block id="c159224eea5fb4a30b3cc9be6e90cd6c" category="paragraph">SnapMirror主动同步提供位于两个不同站点上的LUN。在正常操作下、不存在"源"或"目标"。方向是双向的。指向给定LUN路径的所有读取IO将由本地控制器使用其本地数据副本进行处理。所有写入操作都将复制到远程配对节点、并在本地写入、然后才会得到确认。</block>
  <block id="4a85397e66688e4e619ffe832e627548" category="inline-image-macro">SnapMirror活动同步概述</block>
  <block id="ddc1e5dc440806435445e7a532ad1198" category="paragraph">从逻辑上讲、此行为类似于一组LUN。可以通过两个不同集群上的SAN路径将IO定向到这些逻辑LUN、但数据始终相同。IO行为对称、这对于许多主动-主动应用程序配置至关重要。</block>
  <block id="ddc5ca7c74db522011a3b2ddccda5b40" category="inline-image-macro">SnapMirror主动同步逻辑设计</block>
  <block id="daadd24f5163a10f9a2f016019883886" category="section-title">路径管理</block>
  <block id="9bb9bee58b329761e36c7d9bf8900d6f" category="paragraph">SnapMirror同步网络拓扑有两种方法：统一和非统一。在选择统一访问和非统一访问时、主要考虑因素是您是否可以或必须跨站点扩展SAN。在这两种情况下、均可使用SnapMirror主动同步。</block>
  <block id="1f46c4a6c97a8add22ae7c23181c23d8" category="paragraph">ONTAP调解器是从NetApp支持站点下载的软件应用程序、通常部署在虚拟机上。</block>
  <block id="91e17573d84d7d626cc27e989a3957bc" category="inline-link-macro">有关SnapMirror active sync的ONTAP文档</block>
  <block id="ae81dd17263728532627374843ee0ff8" category="paragraph">有关规划和配置步骤，请参阅<block ref="44f5d8051247437425911d96f84db248" category="inline-link-macro-rx"></block>。</block>
  <block id="5abea2d56204d1c15aa063dc90ccfb4f" category="paragraph">SnapMirror主动同步会将一个站点视为"源"、而将另一个站点视为"目标"。这意味着单向复制关系、但这不适用于IO行为。复制是双向的、对称的、镜像两端的IO响应时间相同。</block>
  <block id="e5086daa5843466ff5f04f20d4c19d74" category="paragraph">该<block ref="36cd38f49b9afa08222c0dc9ebfe35eb" prefix=" " category="inline-code"></block>名称用于控制首选站点。如果复制链路丢失、则源副本上的LUN路径将继续提供数据、而目标副本上的LUN路径将变得不可用、直到重新建立复制并使SnapMirror重新进入同步状态为止。然后、这些路径将恢复提供数据。</block>
  <block id="a0bbe7bd1e93252f1267d98703905552" category="paragraph">可通过SystemManager查看源/目标配置：</block>
  <block id="13d0a54956b2dd09d5e909acadfb1694" category="inline-image-macro">sm-as源的SM屏幕截图</block>
  <block id="5b53b7d18b58af25bcf47dc21678038f" category="paragraph">或在命令行界面上：</block>
  <block id="498b1bbe0e017f1ad405fe4c77fb8ea1" category="paragraph">关键在于源是位于第一个Storage Virtual Machine上的SVM。如上所述、术语"源"和"目标"并不表示复制的数据流。两个站点都可以处理写入并将其复制到相反站点。实际上、两个集群都是源和目标。将一个集群指定为源集群的效果只是控制在复制链路丢失时哪个集群作为读写存储系统继续存在。</block>
  <block id="18a07170e14f5cbc26533f0a136dfdd0" category="inline-image-macro">SnapMirror主动同步非一致性网络</block>
  <block id="9532c9e7afcd43c7d9bb5740695fc259" category="paragraph">这种方法的主要优势是SAN的精简性、您无需在网络上延伸SAN。某些客户的站点间连接延迟不足、或者缺少通过站点间网络传输FC SAN流量的基础架构。</block>
  <block id="439caacb19fa16f2c21563703ed645d7" category="paragraph">非一致访问的缺点是、某些故障情形(包括丢失复制链路)将导致某些主机无法访问存储。如果本地存储连接丢失、则作为单个实例运行的应用程序(例如、本质上仅在任何给定挂载的单个主机上运行的非集群数据库)将失败。数据仍会受到保护、但数据库服务器将无法再访问。它需要在远程站点上重新启动、最好是通过自动化过程重新启动。例如、VMware HA可以在一台服务器上检测到全路径关闭的情况、并在具有可用路径的另一台服务器上重新启动VM。</block>
  <block id="9fad44ede04fb95c16ea64be5e51836c" category="paragraph">在许多情况下、通过站点间链路访问存储的应用程序所产生的额外延迟开销是不可接受的。这意味着统一网络可用性的提高微乎其微、因为如果站点上丢失存储、则无论如何都需要关闭故障站点上的服务。</block>
  <block id="15da96ce40136a3259e04ae0dc25fc95" category="paragraph">为了简单起见、这些图中未显示通过本地集群的冗余路径。ONTAP存储系统本身就是HA、因此控制器故障不应导致站点故障。它只会导致受影响站点上使用的本地路径发生更改。</block>
  <block id="bb12626aefb7c36f9b13694d35dadd5d" category="paragraph">SM-AS的一项重要功能是、可以对存储系统进行配置、使其知道主机所在的位置。将LUN映射到给定主机时、您可以指示它们是否接近给定存储系统。</block>
  <block id="4590bab77464ba1a9c8ee6b8095eef60" category="inline-image-macro">SnapMirror主动同步AFF统一网络</block>
  <block id="2b2fdfa824f1319cc47992b1277faa78" category="paragraph">在正常操作下、所有IO均为本地IO。读取和写入操作由本地存储阵列提供。当然、在确认写入IO之前、本地控制器也需要将其复制到远程系统、但所有读取IO都将在本地进行处理、并且不会通过遍历站点间的SAN链路而产生额外延迟。</block>
  <block id="97b2bb0cfbae3fe49433caf537e819ec" category="paragraph">只有在所有主动/优化路径丢失时、才会使用非优化路径。例如、如果站点A上的整个阵列断电、则站点A上的主机仍可访问站点B上阵列的路径、因此、尽管延迟较长、但仍可保持正常运行。</block>
  <block id="5ab085bf88338486e590861594d3947a" category="paragraph">NetApp ASA系统可在集群上的所有路径之间提供主动-主动多路径功能。这也适用于SM-AS配置。</block>
  <block id="6511f0e2589c08e82bc8dd3e9bc93185" category="inline-image-macro">SnapMirror主动同步ASA统一网络</block>
  <block id="c3fe6771b27ffcb15a75ae88f6d57c4b" category="paragraph">使用非一致访问的ASA配置的工作原理与使用AFF时大致相同。使用统一访问时、IO将跨越WAN。这可能是可取的、也可能不可取。</block>
  <block id="498a9faf271a73dcf026b1041b66ef2a" category="paragraph">如果两个站点之间相距100米且具有光纤连接、则WAN上不会出现可检测到的额外延迟、但如果两个站点相距较远、则两个站点上的读取性能都会受到影响。相比之下、使用AFF时、只有在没有可用的本地路径时才会使用这些WAN交叉路径、而且由于所有IO都是本地IO、因此日常性能会更好。使用非一致访问网络的ASA可以获得ASA的成本和功能优势、而不会造成跨站点延迟访问损失。</block>
  <block id="15ab92b8042738f6acc912e2d98ae17a" category="paragraph">在低延迟配置中使用SM-A的ASA具有两个有趣的优势。首先、从本质上说、它可以将任何一台主机的性能提高一倍、因为使用两倍路径的控制器可以为IO提供服务。其次、在单站点环境中、它可以提供极高的可用性、因为整个存储系统可能会丢失、而不会中断主机访问。</block>
  <block id="41c719032afe187deaf4b4b2af41aa36" category="paragraph">温度敏感型存储效率(TSSE)可在ONTAP 9 8及更高版本中使用。它依靠块访问热图来识别不常访问的块、并以更高的效率对其进行压缩。</block>
  <block id="8284eb5a9d9bef8f0f1ece257656d0fe" category="summary">ONTAP上Epic的其他信息</block>
  <block id="345245c83d2b2c4c2a5eb9f2887da627" category="paragraph">要了解有关本文档中所述信息的更多信息，请参见以下文档和 / 或网站：</block>
  <block id="bc4fe2352063642d68529f2aa0ca7ca3" category="inline-link-macro">NetApp 产品文档</block>
  <block id="0897605072547ea93ef25a4b355ac5f6" category="list-text"><block ref="0897605072547ea93ef25a4b355ac5f6" category="inline-link-macro-rx"></block></block>
  <block id="5358757de9216cc29d688612a3d72fe1" category="inline-link-macro">ONTAP 9文档</block>
  <block id="3973235e869d719328cf4b37e59562e5" category="list-text"><block ref="3973235e869d719328cf4b37e59562e5" category="inline-link-macro-rx"></block></block>
  <block id="c9cefb6ed873a418f8c8232dca6879d2" category="inline-link-macro">一致性组</block>
  <block id="10d6aff3e86ebe3712a2616b45008fb3" category="list-text"><block ref="10d6aff3e86ebe3712a2616b45008fb3" category="inline-link-macro-rx"></block></block>
  <block id="0d3cc094235677831b5697c5bab76394" category="inline-link-macro">ONTAP 和 ONTAP System Manager 文档资源</block>
  <block id="3b2c8ae1d985c88d539bf7851e067922" category="list-text"><block ref="3b2c8ae1d985c88d539bf7851e067922" category="inline-link-macro-rx"></block></block>
  <block id="e9bf68ed54b6d1ff63e8bda8c0b6a70f" category="inline-link-macro">TR-3930i ：《 NetApp Epic 规模估算准则》</block>
  <block id="920aa6d447930899ad56517c79fd12fc" category="list-text"><block ref="b6ff45309a811037a92ca1e6262c74a8" category="inline-link-macro-rx"></block>(需要登录NetApp)</block>
  <block id="840f4016fe968750d45ea4545f2f1893" category="section-title">EPIC客户指导文档</block>
  <block id="a839c9787ec80291f4b34dc5451786a5" category="paragraph">EPIC为客户提供以下文档、以提供有关服务器、存储和网络的指导。本技术报告引用了这些文档。</block>
  <block id="67bab37630accce3ea259fb1601fca2e" category="list-text">存储区域网络注意事项</block>
  <block id="0fe2c5f32f45114c27e3b7a7ca0ba0ad" category="list-text">《业务连续性技术解决方案指南》</block>
  <block id="2163e1881d92ff554d8969998a7d618f" category="list-text">《全闪存参考架构战略手册》</block>
  <block id="b332ca8d59cd86adb52c28aef982cc69" category="list-text">存储产品和技术状态</block>
  <block id="a0107bedc201b2df3694df573f65ae32" category="list-text">史诗般的云考虑因素</block>
  <block id="0cf7d14c360e7f8755d749057b348718" category="list-text">硬件配置指南(特定于客户)</block>
  <block id="50923dab9020d1e069418763d0bd15a3" category="list-text">数据库存储布局建议(针对特定客户)</block>
  <block id="4e1249f2da2104e56555dec5d4d51e6a" category="summary">经典的四节点架构</block>
  <block id="7baf69c8e83ff08e0583426d011bc650" category="paragraph">下图显示了四节点架构的存储布局：生产环境中的HA对和灾难恢复环境中的HA对。控制器大小和磁盘数量取决于后一个规模估算映像。</block>
  <block id="70ccc987c3596ca363e7b8d980858220" category="paragraph">NetApp通过接受SLM建议的AQoS策略来保证最低楼层性能。EPIC支持将ONTAP上的存储池整合到显著减少的硬件上。有关详细信息、请参见Epic每季度spats文档。基本上、pool1、Pool2和NAS1 (在Epic硬件配置指南中列出)都可以在一个HA对上运行、并且工作负载均匀分布在两个控制器上。在灾难恢复中、Epic Pool 3和NAS 3也会在HA对中的两个控制器之间拆分。</block>
  <block id="34557edb2bf88cd4f837f2384ead1830" category="paragraph">从Epic Production、Epic Report或Epic Disaster Recovery克隆测试完整副本环境(例如、SUB、REL和PYX)。有关Epic备份和刷新的信息、请参见"数据管理"一节。</block>
  <block id="5c8423bf649a8a50f33626549581cce9" category="section-title">四节点架构</block>
  <block id="f42ac2802f367c372897f3fb06218d2d" category="inline-image-macro">EPIC 4节点架构</block>
  <block id="848f13dbd455e0190684bb8052ef94d6" category="paragraph"><block ref="848f13dbd455e0190684bb8052ef94d6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="14b8013c3961c3eb9f2d01aff2c9d430" category="section-title">四节点工作负载放置</block>
  <block id="8e576f920186d1c7001b6f1da66f2359" category="inline-image-macro">EPIC 4节点放置</block>
  <block id="34594b0fc43be2425a0a68f14928bc8d" category="paragraph"><block ref="34594b0fc43be2425a0a68f14928bc8d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="145a177f694025424b761a3b22ca2f6b" category="summary">经典的六节点架构</block>
  <block id="7682e26e53b5af35c13c22f5034f788a" category="paragraph">客户可能希望从六节点设计入手、也可能希望随着需求的增长从四节点无缝横向扩展到六节点。通过横向扩展、您可以无干扰地在节点之间移动工作负载、并在集群中重新平衡。</block>
  <block id="121ec45abd57b78d2c63e13a01970fbf" category="paragraph">此架构可在集群上实现最佳性能和容量平衡。Epic Production、Epic Report和Epic Test均在第一个HA对上运行。第二个HA对用于Clarity、Hyperspace、VMware、NA1和其余Epic工作负载。灾难恢复与上一节中的四节点架构相同。</block>
  <block id="628e6fdb5831f5144730fdfb620a1a2a" category="section-title">六节点架构</block>
  <block id="5d28884b83f218379ec90c789e2e382b" category="inline-image-macro">EPIC 6节点架构</block>
  <block id="a5cf77b4851a534d4e7f8cbfc10e7734" category="paragraph"><block ref="a5cf77b4851a534d4e7f8cbfc10e7734" category="inline-image-macro-rx" type="image"></block></block>
  <block id="214d949b6d12c893a63f49d862292640" category="section-title">六节点工作负载放置</block>
  <block id="65ea1ebb7d9c2d858f8701fcbecd438d" category="inline-image-macro">EPIC 6节点放置</block>
  <block id="77e8933cdf526d7670fcd797f57f81a7" category="paragraph"><block ref="77e8933cdf526d7670fcd797f57f81a7" category="inline-image-macro-rx" type="image"></block></block>
  <block id="a3ab98b5217808d71238c069623fa0ff" category="summary">经典的八节点架构</block>
  <block id="ab4e8eb50674d5d1bee79a6682b49325" category="paragraph">下图显示了横向扩展的八节点架构。同样、您也可以从四节点开始、扩展到六节点、然后继续扩展到八节点及更多节点。此架构可在生产环境中的六个节点之间实现最佳性能和容量平衡。</block>
  <block id="0ef10ffde0c0ebd21feabe96ec890f72" category="paragraph">在此设计中、测试环境将从Report克隆、而不是从生产环境克隆。这样可以将测试环境和完整性检查负载从生产环境中分流出来。</block>
  <block id="211891edb616b1a6e25c469a73cd07c9" category="section-title">八节点架构</block>
  <block id="3b31cb391c5fb328f6bcf768909f68a2" category="paragraph"><block ref="3b31cb391c5fb328f6bcf768909f68a2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c344a01a287e43ab2ef2793cf550435a" category="section-title">八节点工作负载放置</block>
  <block id="80a544c0b0187e121e581e019d0902a9" category="inline-image-macro">EPIC 8节点放置</block>
  <block id="e374fdf5079d6709ca8206b4c77be000" category="paragraph"><block ref="e374fdf5079d6709ca8206b4c77be000" category="inline-image-macro-rx" type="image"></block></block>
  <block id="17e9ce8e967d60724d7f53d467470a10" category="summary">经典架构</block>
  <block id="b1830ae1e99adb346ce1da353cd6c089" category="paragraph">本节介绍Epic软件环境以及需要存储的关键组件。其中提供了一些重要注意事项、有助于指导存储设计。</block>
  <block id="4db273f137d059bd4ffd23818c367214" category="paragraph">总部位于威斯康星州维罗纳的EPIC为大中型医疗集团、医院和集成医疗保健组织制造软件。客户还包括社区医院、学术机构、客户组织、安全网提供商和多医院系统。EPIC集成软件涵盖临床、访问和收入功能、并扩展到家庭。</block>
  <block id="27cd823999704d6e14cdee1e83bef7f0" category="paragraph">涵盖 Epic 软件所支持的广泛功能超出了本文档的讨论范围。但是、从存储系统的角度来看、所有Epic软件都会为每个部署共享一个以患者为中心的数据库。EPIC正在从InterSystems Cach é 数据库过渡到新的InterSystems InterIS数据库。由于Cach é 和Ire的存储要求相同、因此在本文档的其余部分中、我们将数据库称为Ire。可以在AIX和Linux操作系统上使用IS。</block>
  <block id="4e25ab2bd75f003927aabf72608c3610" category="section-title">系统间的可转性</block>
  <block id="0af82ac784148ef3818d2fe5b04763fa" category="paragraph">系统间的系统间的信息库是Epic应用程序使用的数据库。在此数据库中、数据服务器是持久存储数据的访问点。应用程序服务器管理数据库查询并向数据服务器发出数据请求。对于大多数Epic软件环境、在单个数据库服务器中使用对称多处理器(SMP)架构足以满足Epic应用程序的数据库请求。在大型部署中、可以使用InterSystems的企业Cach é Protocol (企业Cach é 协议、InterSystems)来支持分布式模型。</block>
  <block id="8dfea4e602a85bafff792b879b2d056b" category="paragraph">通过使用启用故障转移的集群硬件、备用数据服务器可以访问与主数据服务器相同的存储。它还使备用数据服务器能够在发生硬件故障时接管处理职责。</block>
  <block id="c77ab217583518f1b67702b591baf929" category="paragraph">系统间还提供了一些技术来满足数据复制、灾难恢复和高可用性(HA)要求。系统间复制技术用于将一个iSCSI数据库从主数据服务器同步或异步复制到一个或多个二级数据服务器。NetApp SnapMirror用于复制WebBLOB存储或用于备份和灾难恢复。</block>
  <block id="df2e58f9c6f746010ccdd5cf07673500" category="paragraph">更新后的可刷新的可刷新的数据库具有许多优势：</block>
  <block id="f8ffd660138274e3b7b31f900153e4b6" category="list-text">提高了可扩展性、并支持具有多个Epic实例的大型组织整合到一个更大的实例中。</block>
  <block id="242ef58734fef1421d6cc1e1154bd041" category="list-text">许可假期、客户现在可以在AIX和Red Hat Enterprise Linux (RHEL)之间切换、而无需购买新的平台许可证。</block>
  <block id="08a78b85487809e2116574e4ff97dec5" category="section-title">Cach é 数据库服务器和存储使用量</block>
  <block id="4cc33a0396ddd5a29816a3a40d01a6b5" category="list-text">*生产*在Epic软件环境中，部署了一个以患者为中心的数据库。在Epic的硬件要求中、托管主读/写IERIS数据服务器的物理服务器称为生产数据库服务器。对于属于主数据库实例的文件、此服务器需要高性能全闪存存储。为了实现高可用性、Epic支持使用可访问相同文件的故障转移数据库服务器。IRC使用Epic Mirror复制到只读报告、灾难恢复并支持只读副本。出于业务连续性的原因、每种类型的数据库服务器都可以切换到读/写模式。</block>
  <block id="cdbcd4cba3ac1d1b15d302df69df1198" category="list-text">*Report*报告镜像数据库服务器提供对生产数据的只读访问。它托管着一个配置为生产用的许可协议数据服务器的备份镜像的许可协议数据服务器。报告数据库服务器与生产数据库服务器具有相同的存储容量要求。报告写入性能与生产环境相同、但读取工作负载特征和规模不同。</block>
  <block id="10938a446d1d37c3afcad8aac850f514" category="list-text">*支持只读*此数据库服务器是可选的，下图未显示。此外、还可以部署镜像数据库服务器来支持Epic支持只读功能、在此功能中、可以在只读模式下访问生产副本。出于业务连续性原因、可以将此类数据库服务器切换到读/写模式。</block>
  <block id="32042e6794444e49e092cad346b66b28" category="list-text">*灾难恢复*为了满足业务连续性和灾难恢复目标，灾难恢复镜像数据库服务器通常部署在与生产和/或报告镜像数据库服务器不同地理位置的站点上。灾难恢复镜像数据库服务器还托管一个配置为生产用的镜像存储系统数据服务器的备份镜像的镜像存储系统。如果生产站点长时间不可用、则可以将此备份镜像数据库服务器配置为充当镜像读/写实例(SRW)。备份镜像数据库服务器与生产数据库服务器具有相同的文件存储要求。相比之下、从性能角度来看、为了实现业务连续性、备份镜像数据库存储的大小与生产存储的大小相同。</block>
  <block id="d05c7e253f48b314f8488aba0e85b3b4" category="inline-image-macro">EPIC IRIS Oodb.(经典IRIS模式</block>
  <block id="90cb7e5b029ac3a1b754d9f0d75bfbb9" category="paragraph"><block ref="90cb7e5b029ac3a1b754d9f0d75bfbb9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b101ffd23847579c0cf3cb028fc314ee" category="list-text">*测试*医疗保健组织通常部署开发、测试和暂存环境。对于这些环境、其他的可扩展存储系统数据服务器也需要存储空间、而存储空间可由同一个存储系统容纳。对于从共享存储系统提供额外存储、EPIC具有特定的要求和限制。本文档中的最佳实践一般会介绍这些特定要求。</block>
  <block id="5c52f2993ead7ce33b4600c9955d9657" category="paragraph">除了光标数据服务器之外、Epic软件环境通常还包括其他组件、如下图所示、如下图所示：</block>
  <block id="c352fde153a95627d87a161b60e9e211" category="list-text">Oracle或Microsoft SQL Server数据库服务器作为Epic Clarity业务报告工具的后端</block>
  <block id="72e364f0316ce75144d3bcbc76627977" category="admonition">Clarity用于报告每天从报告的"ExIs数据库"中提取的数据。</block>
  <block id="9c7d7e54119a875f7f730fac34d86939" category="list-text">WebBLOB服务器(SMB)</block>
  <block id="7f140c68d528349ef23a9adde829618a" category="list-text">多用途数据库服务器</block>
  <block id="db670b036ce103ccc68fe4a2f746bcbb" category="list-text">多用途虚拟机(VM)</block>
  <block id="46f49acf82ce78d08668061bb78e679a" category="list-text">用于客户端访问的超空间</block>
  <block id="847ce339c80d3a544fdd1e3ea23f89ed" category="inline-image-macro">EPIC数据库</block>
  <block id="ddc0ff60fb0cba83974547cb2fd7a40e" category="paragraph"><block ref="ddc0ff60fb0cba83974547cb2fd7a40e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="300c335aaf3a97bb6020a19be0b8ca96" category="paragraph">所有这些多个工作负载、池、NAS和SAN协议的存储需求均可整合并由一个ONTAP集群托管。通过这种整合、医疗保健组织可以为所有Epic和非Epic工作负载制定单一的数据管理策略。</block>
  <block id="4a7de8a55a290fb3a0a4efd490ec781b" category="section-title">运行数据库工作负载</block>
  <block id="a627911d38337b81dddab9711a61842c" category="paragraph">每个Epic数据库服务器都会对以下类型的文件执行I/O：</block>
  <block id="458648f675593beefe031e7b7ba9fcdd" category="list-text">数据库文件</block>
  <block id="07599d3aee2c26c36cae1cb305a0d120" category="list-text">日志文件</block>
  <block id="b9c807a9cbbe80f3b710d64a47334ecf" category="list-text">应用程序文件</block>
  <block id="4b11d0da3422be079767b9c81ea967cb" category="paragraph">单个数据库服务器的工作负载取决于其在Epic软件环境中的角色。例如、生产数据库文件通常会产生要求最苛刻的工作负载、包括100%随机I/O请求。任何镜像数据库的工作负载通常要求较低、并且读取请求较少。日志文件工作负载主要是顺序的。</block>
  <block id="6908d08a516bc86d102ccafa6c2ece9d" category="paragraph">EPIC为存储性能基准测试和客户工作负载维护一个工作负载模型。有关Epic工作负载模型、基准测试结果以及使用NetApp规模估算工具为Epic环境正确估算存储规模的指导信息、请参见(需要登录NetApp)。<block ref="81c36a9e6d224e9d42c9630dffaa9434" category="inline-link-rx"></block></block>
  <block id="f71d6b15e61746171efc106f495b60cd" category="paragraph">此外、EPIC还为每个客户提供了自定义的硬件配置指南、其中包含I/O预测和存储容量要求。最终存储要求可能包括开发、测试和/或暂存环境以及可能整合的任何其他辅助工作负载。客户可以使用硬件配置指南向NetApp传达总存储要求。本指南包含估算Epic部署规模所需的所有数据。</block>
  <block id="c7a0b1a5f7a146b9b72947b2bba045ed" category="paragraph">在部署阶段、Epic提供了《数据库存储布局指南》、其中提供了更精细的LUN级别详细信息、可用于高级存储设计。请注意、《数据库存储布局指南》是一般性存储建议、并不特定于NetApp。使用本指南可确定NetApp上的最佳存储布局。</block>
  <block id="ab3b24e1e2a3f9784a9c6cad8db20a76" category="summary">规模估算</block>
  <block id="706a0ec5dbae849750639964dc6b852f" category="paragraph">估算Epic存储环境规模时、一个重要的架构注意事项是ODB数据库大小。</block>
  <block id="abe227b9b306ed7c0527800b44a2f1d0" category="paragraph">您可以使用下图选择一个小型-中型-大型Epic存储架构。这些设计包括运行《硬件配置指南》中列出的所有工作负载。规模估算树基于100多份硬件配置指南中的数据、大多数情况下应是准确的估计值。</block>
  <block id="be0322041cc582d91f5f470df1ef2ba4" category="paragraph">需要注意的是、这只是一个起点。您应与我们的Epic联盟团队合作、确认任何Epic设计。您可以通过epic@NetApp．com联系该团队。每次部署都需要满足客户的要求、同时遵循Epic和NetApp建议的最佳实践。</block>
  <block id="20e8e833e31ffb5776ac701658144bd3" category="list-text">小型Epic架构、Epic数据库小于10 TB</block>
  <block id="5d8ee21ec144a04a8287c0171b9a8527" category="list-text">中型Epic架构、Epic数据库大小从10 TB到50 TB不等</block>
  <block id="79ac7005a81d3ad4f64a1a5f5db00c7e" category="list-text">大型Epic架构、其中Epic数据库容量大于50 TB</block>
  <block id="650c96055e8747d8b8a4c503b32aea8d" category="inline-image-macro">经典的规模估算指导</block>
  <block id="1c2004236bc67ea5f8fcc53a967ce698" category="paragraph"><block ref="1c2004236bc67ea5f8fcc53a967ce698" category="inline-image-macro-rx" type="image"></block></block>
  <block id="431d999c23fb9c149586aa971425928e" category="summary">存储需求史诗般</block>
  <block id="8afb3f2b206e0239313a484fe51999d7" category="paragraph">通常为生产数据库提供专用存储资源、而镜像数据库实例则与其他Epic软件相关组件(例如Clarity报告工具)共享二级存储资源。</block>
  <block id="d31081e8762bd0903adf5d3f0b769e73" category="paragraph">其他软件存储环境(例如用于应用程序和系统文件的软件存储环境)也由二级存储资源提供。</block>
  <block id="ed879cdc9a77683dfbe5be59441dec43" category="paragraph">除了规模估算注意事项之外、Epic还具有以下其他存储布局规则和主要注意事项：</block>
  <block id="ba76cf08b10101b5fee8e2e6d0da268e" category="list-text">自2020年以来、所有运营数据库(ODB)工作负载都必须位于全闪存阵列上。</block>
  <block id="542f0f7c69fde2bd55b5a36854a84fa3" category="list-text">EPIC建议每个存储池都位于单独的物理硬件上、包括pool1、Pool2、pool3、NA1和NA4.2。</block>
  <block id="919d67cad73121e6af0b2b20169d947b" category="admonition">集群中的节点可视为存储池。使用ONTAP 9™4或更高版本和AQoS，您可以使用策略创建受保护的池。</block>
  <block id="4449a7b5d2b5dfb4b1bad2ed2f86b5fd" category="list-text">新Epic 3-2-1备份建议。</block>
  <block id="b560499317ab0447790f01d7acd5401b" category="list-text">位于远程站点的副本(灾难恢复)</block>
  <block id="09d6c5f51239ea513e80e433549993f4" category="list-text">其中一个副本必须位于与主副本不同的存储平台上</block>
  <block id="df5be706f042b26557014aa77c608eb6" category="list-text">数据的副本</block>
  <block id="47311b53e9ae798223e097c4249a0668" category="admonition">使用NetApp SnapMirror备份NetApp的客户不符合3-2-1建议。原因是ONTAP to ONTAP不满足上述第二个要求。您可以将SnapMirror直接从ONTAP使用到内部对象存储(例如通过StorageGRID)或云、以满足Epic要求。</block>
  <block id="fef74abf89ce7520dbdabb6ae983ee4b" category="paragraph">有关存储要求的详细信息、请参见Galaxy中提供的以下Epic指南：</block>
  <block id="bed1a6db332388739ca169835c6c3425" category="list-text">SAN 注意事项</block>
  <block id="9080906c2106e0567c91717cc003d027" category="list-text">存储产品和技术状态(燕麦)</block>
  <block id="81b560a1124b6edc7fe2858e332661b6" category="list-text">《硬件配置指南》</block>
  <block id="db11e37a9250a9db4d48618851771913" category="summary">存储快照配置</block>
  <block id="4cbb03cae0c07fb5c8e5d5e6df97064e" category="doc">史诗般的存储效率配置</block>
  <block id="bc9c71d0bf41f8b2c8bde032eb1d97d0" category="paragraph">如果应用程序的存储分布在多个卷上、并且其中的一个或多个LUN的数量适合工作负载、则需要同时备份这些内容、以确保一致的数据保护需要使用CGS。</block>
  <block id="d43039551f875a24f15f154306be2586" category="paragraph">一致性组(简称CGS)可提供此功能以及更多功能。它们可以在夜间使用、以便使用策略创建按需快照或计划内一致的快照。您可以使用它来还原、克隆甚至复制数据。</block>
  <block id="cbe00f2bdd9a3c8aaaf5f8159a8750c1" category="paragraph">有关GS的更多信息、请参见<block ref="acc09d7e0c59ae3310cafae5d547383a" category="inline-link-macro-rx"></block></block>
  <block id="e62f16b222adc7aecc70ff7b56e652dc" category="paragraph">按照本文档前面几节所述配置卷和LUN后、可以将其配置为一组CGS。建议的最佳实践是按照下图所示进行设置：</block>
  <block id="7dd784e39903a42471f96a6d0d6ae420" category="inline-image-macro">EPIC一致性组布局</block>
  <block id="909e3795441b963b86fcad387196919f" category="paragraph"><block ref="909e3795441b963b86fcad387196919f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="45dbe5c870e6de731da235aab8c51046" category="paragraph">应在与为生产数据库提供存储的卷关联的每个子CG上设置每晚CG快照计划。这样就会在每晚为这些GS创建一组全新的一致备份。然后、可以使用这些副本克隆生产数据库、以便在开发和测试等非生产环境中使用。NetApp为Epic开发了基于CG的专有自动化Ans得 工作流、用于自动备份生产数据库、同时还可以自动执行刷新和测试环境。</block>
  <block id="a93362f9de0aff40adccba50a939a6fa" category="paragraph">CG快照可用于支持Epic生产数据库的还原操作。</block>
  <block id="4bf6f09e67952b918985533c270b0668" category="paragraph">对于SAN卷、在用于CGS的每个卷上禁用默认快照策略。这些快照通常由所使用的备份应用程序或NetApp的Epic Ans得 自动化服务进行管理。</block>
  <block id="7082753514151e011ff039e6fe23eba2" category="paragraph">对于SAN卷、在每个卷上禁用默认快照策略。这些快照通常由备份应用程序或Epic Ans得 自动化管理。[NS2]</block>
  <block id="669d2da75a76d767cc8259b5f37cacc3" category="paragraph">WebBLOB和VMware数据集应仅配置为卷、而不与CGS关联。您可以使用SnapMirror在与生产系统不同的存储系统上维护快照。</block>
  <block id="5a6fb6753e1c4f748d223c8e329133fb" category="paragraph">完成后、配置将如下所示：</block>
  <block id="926ce6c3b85cb26b415b6fc7e43f2879" category="inline-image-macro">使用CG快照实现EPIC</block>
  <block id="a578d209aa95904cf62330de918a003d" category="paragraph"><block ref="a578d209aa95904cf62330de918a003d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="193e03aa51a18f1e5d72b6a9dd240ed7" category="paragraph">默认情况下、ONTAP实时效率功能处于启用状态、无论存储协议、应用程序或存储层如何、均可正常工作。</block>
  <block id="f900dc6292f9bf9dcf98291ad5846d4b" category="paragraph">效率功能可减少写入昂贵闪存存储的数据量、并减少所需的驱动器数量。ONTAP可通过复制保持效率。每种效率对性能几乎没有影响、即使对于Epic等对延迟敏感的应用程序也是如此。</block>
  <block id="936d07f32ce5afcd55e98c4a8cbce642" category="paragraph">* NetApp建议*启用所有效率设置以最大程度地提高磁盘利用率。默认情况下、基于AFF和ASA的系统会启用这些设置。</block>
  <block id="d4a551eeebb2992a4ffff1ad1083479a" category="paragraph">以下功能可实现这种存储效率：</block>
  <block id="cc0df1dcdfa0541f9c5dde8e0b570a36" category="list-text">重复数据删除可删除托管LUN的卷中的冗余块副本、从而节省主存储上的空间。默认情况下、此建议选项处于启用状态。</block>
  <block id="db37fd6533f852997b6ae076ae5e86e0" category="list-text">实时压缩可减少写入磁盘的数据量、并可通过Epic工作负载显著节省空间。默认情况下、此建议选项处于启用状态。</block>
  <block id="c8afff3d362092825c7eda5b0b6b39af" category="list-text">实时数据缩减会占用填充度不足一半的4 k块、并将其合并为一个块。默认情况下、此建议选项处于启用状态。</block>
  <block id="b158d6ac5a43e19d1be67d7ba849494d" category="list-text">精简复制是NetApp数据保护软件产品组合(包括NetApp SnapMirror软件)的核心。SnapMirror精简复制可保护业务关键型数据、同时最大程度地降低存储容量需求。* NetApp建议*启用此选项。</block>
  <block id="13fb0a52e16b7b3839f151b0847cd0d1" category="list-text">聚合重复数据删除。重复数据删除始终处于卷级别。借助ONTAP 9。2、可以使用聚合重复数据删除功能、从而节省更多的磁盘精简空间。ONTAP 9中添加了后处理聚合重复数据删除。3* NetApp建议*启用此选项。</block>
  <block id="46269eefafcbb08ab4667022c6491767" category="summary">EPIC和文件协议</block>
  <block id="73a17ad0a24141989f242b5b099eec4f" category="paragraph">支持在同一个全闪存阵列上组合使用NAS和SAN。</block>
  <block id="688ffca27fb85bfb71c8a7632a871ec1" category="paragraph">* NetApp建议*对NAS共享使用FlexGroup卷、例如WebBLOB (如果可用)。</block>
  <block id="55449fd175613962d882ab450cfc5f3c" category="inline-link-macro">FabricPool</block>
  <block id="1cd6516d7f54730b868069e2db63b528" category="paragraph">WebBLOB包含高达95%的冷数据。您可以选择释放全闪存阵列上的空间、并使用ONTAP的功能将备份和冷数据分层到内部或云中的对象存储<block ref="e722be9b80fb0aa9c356c4300710e630" category="inline-link-macro-rx"></block>。所有这些都可以在不影响性能的情况下完成。FabricPool是ONTAP的一项随附功能。客户可以生成冷数据(或非活动数据)报告、以查看启用FabricPool可以获得多少优势。您可以将数据的使用期限设置为通过策略分层。EPIC的客户通过此功能节省了大量成本。</block>
  <block id="fc3145f7fe85a0cdfffb31f4034ada3b" category="summary">ONTAP上的EPIC—主机实用程序</block>
  <block id="f2f8d65f0baeae6d15c1016784ddadbf" category="paragraph">NetApp主机实用程序是适用于各种操作系统的软件包、其中包含管理实用程序、例如<block ref="3a8e4afa851609127d534b04e7d29c08" prefix=" " category="inline-code"></block>命令行界面二进制文件、多路径驱动程序以及正常SAN操作所需的其他重要文件。</block>
  <block id="23cfb87b0ff3960aab8099cbbb63b50b" category="inline-link-macro">SAN主机</block>
  <block id="b0a8af1d81527bdd65ec0e8fb2a4b4e0" category="paragraph">NetApp建议*在连接到存储系统并访问NetApp存储系统的主机上安装NetApp主机实用程序。有关详细信息、请参见<block ref="b2445b429f9784426e3dc1158e67c70d" category="inline-link-macro-rx"></block>和<block ref="7d7a0f71ed9bf2fe94a10fa9e1aeb381" category="inline-link-macro-rx"></block>文档。</block>
  <block id="54ed29e411552372c5b6b9e2e1617e6d" category="admonition">对于AIX、在发现LUN之前安装Host Utilities尤为重要。这样可确保LUN多路径行为配置正确。如果在未使用Host Utilities的情况下执行发现、则需要使用命令从系统中取消配置LUN、然后通过或重新启动重新发现<block ref="fe54d1c30028417038a4ffe0fc5eb503" prefix=" " category="inline-code"></block>LUN<block ref="9442434081221d63eaaa2c4799062866" prefix=" " category="inline-code"></block>。</block>
  <block id="e7a8be60cff2fec7b8ed793c4d2dddfe" category="summary">EPIC LUN和卷配置</block>
  <block id="acdbb325faec5e3e2d86b3dbbaf90c54" category="paragraph">Epic数据库存储布局建议文档提供了有关每个数据库的LUN大小和数量的指导。</block>
  <block id="a620ecf0a73eb209a145eb913a29bc5a" category="paragraph">请务必阅读本文档、了解Epic DBa和Epic支持、并确定LUN数量和LUN大小、因为它们可能需要调整。这些存储建议对于HBA队列深度、存储性能、易操作性和易扩展性非常重要。</block>
  <block id="21ebeea1f14a138dfebb1b9599a4c3dd" category="paragraph">为了最大限度地提高Epic odb或Clarity等工作负载的性能、每个布局也最适合NetApp存储。通过使用八个卷、写入IO会在控制器之间均匀分布、从而最大程度地提高CPU利用率。对于复制和备份、最好将卷数限制为八个、以简化操作。</block>
  <block id="90adf331b7868c7af46ad6e035e93844" category="section-title">扩展选项</block>
  <block id="b323bb297a66afc2eea7b89dd4019798" category="section-title">卷和8-LUN布局</block>
  <block id="66d125e77a6185ef5cf43b2a6bffea80" category="inline-image-macro">EPIC 8-LUN布局</block>
  <block id="99a54ac1eaa5bd57b4c4c29d6a63f1ac" category="paragraph"><block ref="99a54ac1eaa5bd57b4c4c29d6a63f1ac" category="inline-image-macro-rx" type="image"></block></block>
  <block id="bad4d79343f04d8b64999875ad328086" category="list-text">在HA对中平衡工作负载、以最大限度地提高性能和效率。</block>
  <block id="26b591a32a8a235db7f742995589a455" category="list-text">使用精简配置的卷和LUN。</block>
  <block id="9fb0aaeb125238e83485971ae6b7e2fc" category="list-text">至少使用八个数据库LUN、两个日志LUN和两个应用程序LUN。此配置可最大限度地提高存储性能和操作系统队列深度。如果出于容量或其他原因需要、可以使用更多。</block>
  <block id="ba5e00554d1ba1b8ca0fc2eaeda44672" category="list-text">如果确实需要向卷组添加LUN、请一次添加八个LUN。</block>
  <block id="08c8ec6a9fefcf9c5c7dff1258aacf67" category="list-text">要同时备份的卷组和LUN组需要一致性组(一致性组、CGS)。</block>
  <block id="f513b81222a1b44f552ae172aeb697c9" category="list-text">请勿在Genio或任何I/O性能期间使用QoS。</block>
  <block id="b77a34499937c829a2c5c5a1cdc17f05" category="list-text">完成Genio或Clarity测试后、NetApp建议删除存储并重新配置、然后再加载生产数据。</block>
  <block id="186bc47646aec5e2abf40b2605a16461" category="list-text">请务必<block ref="54645d7349dcc4fe9d7d19985a40c2c9" prefix=" " category="inline-code"></block>在LUN上设置已启用。否则、ONTAP将看不到LUN上任何已删除的数据、并可能导致容量问题。有关详细信息、请参见Epic存储配置快速参考指南。</block>
  <block id="153c47e1653d87804319da1fe347f29b" category="summary">卓越的性能管理</block>
  <block id="912975539030067a6f1874223cda9b75" category="paragraph">大多数全闪存阵列均可提供Epic工作负载所需的性能。NetApp的独特优势在于它能够设置楼层性能策略、并保证每个应用程序的性能始终如一。</block>
  <block id="edfc4c86589e31546a8fb2d8b085b8c9" category="section-title">服务质量(QoS)</block>
  <block id="8080e6f80ff76b571829265ee2917e87" category="paragraph">NetApp建议使用QoS。QoS的优势在于能够整合所有Epic工作负载。所有协议和存储池可以驻留在较少的硬件上。您无需分离存储池。</block>
  <block id="44c2f7cd7c41efaae67916780bf96079" category="list-text">NetApp建议将集群中的所有工作负载分配给一个QoS策略、以便更好地管理集群上的性能余量。</block>
  <block id="d90d7fd828646173964451dadbe758c1" category="list-text">NetApp建议在HA对之间均衡平衡所有工作负载。</block>
  <block id="a77412a540f86bfc443abfcef22db414" category="list-text">执行任何I/O测试时、请勿使用QoS策略；否则、Genio测试将失败。在分配任何QoS策略之前、对不同的生产工作负载进行2-4周的分析。</block>
  <block id="c36c006dced61f1e460ff43516fa7294" category="summary">ONTAP上的EPIC—协议</block>
  <block id="0f079f7da3a6e5c8a52a3aca113fd3e6" category="paragraph">FCP是提供LUN的首选协议。</block>
  <block id="97ec588f063ba0f25df2b93eda2639c8" category="paragraph">* NetApp建议*单个启动程序分区：每个分区一个启动程序、并使用全球通用端口名称(WWPN)在存储上配置所有必需的目标端口。如果一个分区中存在多个启动程序、则可能会导致间歇性HBA串扰、从而导致明显中断。</block>
  <block id="880bc24c60e1d6eb559f57440c27f955" category="paragraph">创建LUN后、将LUN映射到包含主机WWPN的启动程序组(igrop)以启用访问。</block>
  <block id="d8609b6e37acaad082fff919da3c6691" category="paragraph">此外、NetApp还支持使用NVMe/FC (如果您的AIX和RHEL操作系统版本可以)、并可提高性能。FCP和NVMe/FC可以同时位于同一个网络结构中。</block>
  <block id="2586e87005565fe66fa19a3af50f632c" category="summary">Epic的存储规模估算</block>
  <block id="5e3e8694114d62a133f86c691b0d1d68" category="paragraph">您应与我们的Epic联盟团队合作、确认任何Epic设计。您可以通过epic@NetApp．com联系该团队。每次部署都需要满足客户的要求、同时遵循Epic和NetApp建议的最佳实践。</block>
  <block id="c77c62342c6d144df81571fee8e8a4e8" category="paragraph">有关如何使用NetApp规模估算工具根据Epic软件环境存储需求确定正确的RAID组大小和RAID组数量的信息、请参见(需要NetApp登录)。<block ref="b6ff45309a811037a92ca1e6262c74a8" category="inline-link-macro-rx"></block></block>
  <block id="6fff8a4d9dc5db1aefc3e3a86c26dbd7" category="admonition">需要访问NetApp Field Portal。</block>
  <block id="1484157a851d4053990c9bf55fb59e58" category="summary">ONTAP上的EPIC部署示例—聚合</block>
  <block id="e8f3d574ecc3fdf160285a0c9a5a7046" category="paragraph">有关配置聚合的最新文档，请单击<block ref="a20b867e80db6cfd4fb8336d84c1fcc5" category="inline-link-macro-rx"></block>。</block>
  <block id="f2871c08962452bb98a23ee83880a7dd" category="admonition">默认设置可优化性能和容量。每个节点会创建一个大型聚合。</block>
  <block id="46b67d0e3c5baea52f318c392862983a" category="summary">ONTAP部署示例中的EPIC—文件系统</block>
  <block id="ff902a0a262960f8bf9189923c1ff7d9" category="paragraph">有关挂载LUN、创建卷组和逻辑卷以及配置文件系统的信息、请参见Epic存储配置快速参考指南。使用以下示例命令为RHEL设置Epic生产服务器。</block>
  <block id="f54e4ad7066826fa3c18dcb8a62ddd03" category="section-title">文件系统和挂载选项</block>
  <block id="ca487f2e3d336dbbead8ef7ce6f1dc6c" category="paragraph">创建和映射LUN并完成分区后、请使用以下过程将存储连接到服务器。</block>
  <block id="232aac42537fa2491071068a6dacfe10" category="admonition">在此示例中、我们为数据库使用了8个1024Gb LUN、为日志使用了2个1024Gb LUN、为应用程序安装使用了2个1024Gb LUN。</block>
  <block id="cdf658da371089bb06d8dc79b4ae2e2e" category="section-title">异步I/O</block>
  <block id="86c5811d8dc490e1467aed33484d89f2" category="paragraph">Epic SAN注意事项白皮书和存储配置快速参考文档提供了有关如何配置主机和连接到存储的详细信息。本节介绍如何设置Red Hat Enterprise Linux主机。AIX详细信息可在参考文档中找到。</block>
  <block id="81cba0a3715b5297330ade2beaa9dc7d" category="summary">ONTAP上的EPIC部署示例—LUN</block>
  <block id="30baf86157b500051493cda4ff1be0c3" category="paragraph">&gt;&gt;&gt;描述性主句或段落的占位符</block>
  <block id="6aa18085c59b7b34360d5dff15bf6e84" category="paragraph">创建 LUN</block>
  <block id="6a761ce5c1cf1122b1aaea2aec3cfc85" category="paragraph">创建LUN：<block ref="18244093c882fe4e65acdec6d61f9f95" category="inline-link-rx"></block></block>
  <block id="8ede5bcd129cb7b52add8d233c5e5867" category="paragraph">向CG添加卷</block>
  <block id="4bd3faeb169131a1ecbf00026f146a6f" category="paragraph">要创建或修改一致性组、请执行以下操作：<block ref="52ad8c1ba289849e0c6ebe85b916c91a" category="inline-link-rx"></block></block>
  <block id="1093fcc785c9f0e59ff32142b73ff3a5" category="paragraph">映射LUN</block>
  <block id="9e5dabcfb97ff08290166a6dd001c95e" category="paragraph">要映射LUN：<block ref="8b5a6c46b302a4299b28e891d262657f" category="inline-link-rx"></block></block>
  <block id="73a228bbb9b14b5f966f329a201b115d" category="paragraph">根据ONTAP的版本、卷上预留百分比的默认设置可以为100%。此配置应设置为0。</block>
  <block id="b13aace07f0445cf1ff16be054bcc01e" category="summary">ONTAP上的EPIC示例部署</block>
  <block id="cca1d6e8ff542fcd4d1315f7f9033467" category="paragraph">本节将向您介绍ONTAP集群的完整高级配置、配置以及向Epic服务器提供存储。</block>
  <block id="df8f0aad2b90e887efba35ecbc7e6546" category="paragraph">为了捕获详细信息并简化文档、使用命令行。如果首选使用GUI、则可以在System Manager中配置所有设置。</block>
  <block id="d706ffe8745cb55ce7b7d1c7dfa458dd" category="paragraph">以往、使用表1中列出的命令通常可以更快地为大型项目进行初始批量设置、尤其是在将这些命令合并到工作表中时。此命令列表还可用作出色的构建文档。</block>
  <block id="12c8172fde8f9b3f81c3ed0d2805f3d4" category="paragraph">另一个配置选项是使用使用Ans为期0天和为期1天的自动化脚本。NetApp有数百本现有的操作手册可供下载、其中包括通过ANs溶 银河集合install sand.s得ONTAP命令提供的NetApp集合。</block>
  <block id="80455b40cdd7b477184d76f23f747af1" category="paragraph">此外、图形用户界面还非常适合使用简单的单页LUN和共享配置。在添加、修改或删除存储时、最好使用GUI执行操作。如果应用表1中的最佳实践存储设置、则任一选项均正常。</block>
  <block id="d7441f24bee2c1922760ce27f5e978ec" category="paragraph">分阶段完成集群设置和存储/主机配置不应超过一小时。</block>
  <block id="3924c8a2656c72cc0c7d6a27f9ad08ea" category="paragraph">*存储设置最佳实践*</block>
  <block id="51ac4bf63a0c6a9cefa7ba69b4154ef1" category="cell">设置</block>
  <block id="689202409e48743b914713f96d93947c" category="cell">价值</block>
  <block id="2ee34178bb8415b7d7234cd27b83aed6" category="cell">聚合</block>
  <block id="ae6bd8a277455ba774ffc217a2f8a539" category="cell">默认自动配置、每个节点使用一个具有RAID DEP的ADP聚合</block>
  <block id="63555da25f96be027cd722d9f281cffa" category="cell">使用multiprocol时的两个SVM (块SVM和SMB/NFS SVM)。使用Epic和协议命名约定。使用正确的安全模式</block>
  <block id="aec0819ab194aee8aab8a5e40aad8343" category="cell">卷空间保证</block>
  <block id="334c4a4c42fdb79d7ebc3e73b517e6f8" category="cell">无</block>
  <block id="d374cbba7f603e6be8e6450a6b3feb45" category="cell">卷快照策略</block>
  <block id="8285885018fdba6d87edc774237f0e24" category="cell">卷自动调整</block>
  <block id="4d200fce73a8e1cc965cfc2c43343824" category="cell">增长</block>
  <block id="948111f101cd4e13c4a1e21775e9742d" category="cell">卷最大自动调整大小</block>
  <block id="fde7826aacd46b7610beed2b0ef8d81e" category="cell">2 TB或2 X个LUN大小</block>
  <block id="ca714a7089246aff7f85bbda97ba660b" category="cell">卷快照自动删除</block>
  <block id="a10311459433adf322f2590a4987c423" category="cell">已启用</block>
  <block id="6bb41960470a19d97556b9240ac0b3ff" category="cell">卷大小</block>
  <block id="9bba382221ce257d09f3f50492803815" category="cell">1.5 X LUN大小</block>
  <block id="dc85eb20ed6dd71700df76a7f9acd32b" category="cell">卷布局</block>
  <block id="370e47099244ee43c575d91449bb7e36" category="cell">甚至跨控制器分布</block>
  <block id="ca301c828c76b7b6b1a9b621ba37f603" category="cell">igroup 类型</block>
  <block id="d6c56de514a4a8fe23f54d6b42dd23af" category="cell">与物理服务器结合使用时为操作系统、与ESX结合使用时为VMware类型。</block>
  <block id="bbd68bf55ab562da30e73449f1b87424" category="summary">ONTAP上的EPIC部署示例—协议</block>
  <block id="589b83bd3c7696acc0086c7f233e64e3" category="doc">ONTAP上的EPIC部署示例—平台</block>
  <block id="05f72896244a448167caa4a410eb4ecf" category="paragraph">对于Epic odb数据库、日志和应用程序工作负载、Epic建议将服务器存储作为FCP LUN提供。</block>
  <block id="a3a5d01a736b2f5bc994d2ff7b0da8c5" category="summary">ONTAP上的EPIC部署示例—FCP协议</block>
  <block id="dc0e595680f18844673c0930ecf1ca6b" category="paragraph">创建SVM后、您需要向其添加协议。</block>
  <block id="263a628397d3f78e3b61f40863b0868f" category="paragraph">要创建FCP数据生命<block ref="8f46d074b2d46f416cb36dce6f8bd76d" category="inline-link-macro-rx"></block>周期，请单击。</block>
  <block id="663c2decd75c93fbad53179b6016c0d1" category="paragraph">启动程序组用于允许服务器访问LUN。要创建iGroup，请单击<block ref="c6345eebd77187b1723cf47095ffbd0f" category="inline-link-macro-rx"></block>。</block>
  <block id="93f7209bec244568b95ac2f8f50896d7" category="summary">ONTAP上的EPIC部署示例—SVM</block>
  <block id="39ce7fcbb7e39843ad7e81e460901359" category="paragraph">NetApp可对存储进行虚拟化、用户访问由SVM提供。</block>
  <block id="8c22ab38f47a2a116e19714defb5f005" category="paragraph">对于Epic、有一个FCP SVM和一个SMB SVM。根据您希望如何管理存储以及可能的多租户、您可以使用更多SVM。</block>
  <block id="99889a411324e95bb7313521d10d972b" category="paragraph">要设置SVM、请单击<block ref="cb8e547e3f29ee63864aeed75c724bf1" category="inline-link-macro-rx"></block></block>
  <block id="abf025601df70d9ba931fe67b1cc4a79" category="summary">ONTAP上的EPIC部署示例—卷</block>
  <block id="02594c71ca915876e2512e474d8b462d" category="paragraph">要创建卷、请参见<block ref="b6546da834bc505016791ad9e7ec9d1e" category="inline-link-rx"></block></block>
  <block id="36e2bc00e48fbcfe5ae35a8a6056788c" category="admonition">从NVE.7开始、如果您具有ONTAP 9许可证以及板载或外部密钥管理、则聚合和卷加密默认处于启用状态。要启用卷级重复数据删除、请将add -加密 故障设置为volume creation/修改 命令(如果您拥有NVE许可证)。</block>
  <block id="7a112f92e38a30129ab13d18331e21ce" category="section-title">自动删除快照</block>
  <block id="f118801694edca90b5e446d3fe39cda0" category="paragraph">要自动删除快照、请执行以下操作：<block ref="ecea59d033fb2dad1d38e75fbdc1c820" category="inline-link-rx"></block></block>
  <block id="e324e68086bb9c9e930b9d1168f1de5d" category="summary">ONTAP可用性的史诗般的体验</block>
  <block id="8339b88fddad3cfe433f684a83da04eb" category="paragraph">ONTAP的核心是无中断运行、它可以帮助您避免代价高昂的业务运营中断。</block>
  <block id="ca7972f1caf7a478b4f931e986112b62" category="paragraph">NetApp根据生产数据提供99.999999%以上的可用性、这些数据通过NetApp Active IQ称为主存储。集群中的每个HA对都没有单点故障。ONTAP的历史可追溯到1992年、是全球部署最广泛的数据管理软件、在提供可靠存储方面有着非凡的历史。现在、借助Active IQ主动监控和自动解决97%的问题、可用性得到提高、支持案例明显减少。</block>
  <block id="43a21754b069ee170b1858e00c4072df" category="paragraph">Epic 建议使用 HA 存储系统来缓解硬件组件故障。此建议从基本硬件(如冗余电源)扩展到网络(如多路径网络)。</block>
  <block id="58992d12f27d940ad0ced78080987a44" category="paragraph">当您需要在集群中升级存储、纵向扩展、横向扩展或重新平衡工作负载时、对患者护理没有任何影响。您可能会移动数据、但您不需要再次通过数据迁移或叉车式升级中断患者护理。迁移到下一代技术、适应未来需求、避免受制于硬件。NetApp甚至提供100%书面可用性担保。</block>
  <block id="071a41c2bfc6123073746c5459501089" category="inline-link-macro">NetApp ONTAP可靠性、可用性、可维护性和安全性</block>
  <block id="c38a90bcf1a9aa5905c0c4e6fbac331b" category="paragraph">有关NetApp可靠性、可用性、可维护性和安全性功能的详细信息、请参见<block ref="c4f5dec030b0bd57318efbed2e25e7a7" category="inline-link-macro-rx"></block>白皮书。</block>
  <block id="12a3215a6e17b2d4e547b8c9ddb4db59" category="summary">史诗般的数据保护</block>
  <block id="e2f4ffd17d85ea8c667a8fa10eaa81bd" category="doc">经典克隆</block>
  <block id="d777ff146845d0c5a59b451dcdd63eff" category="paragraph">EPIC认识到、与基于文件的传统备份相比、基于存储节点的NetApp Snapshot技术对生产工作负载没有任何性能影响。如果将Snapshot备份用作生产数据库的恢复源、则在实施备份方法时必须考虑数据库一致性。</block>
  <block id="7952c7481879c42a618f85cfab77dc0b" category="paragraph">快照是卷的时间点只读备份副本。NetApp FlexClone®创建快照并使其可立即读取和写入。FlexClone卷具有巨大的价值、可创建应用程序一致的只读快照、并根据生产数据创建可写FlexClone卷。此本机功能对存储节省量、操作时间和自动化功能有着显著影响。</block>
  <block id="dd12a5170cc960b0ed4afe4f23fd727b" category="paragraph">在刷新过程中、将使用FlexClone卷。</block>
  <block id="198010d8bf8a3ff0f084ffd059a9a1da" category="section-title">数据管理</block>
  <block id="31949f92a027681e10fa0ae809d62bcd" category="paragraph">作为该解决方案的一部分、NetApp通过使用本机ONTAP工具提供完全自动化的备份和测试更新解决方案。此解决方案旨在专门为大型Epic数据库管理员(Database Administrator、Database Administrator、数据库管理员)社区简化Epic数据管理：</block>
  <block id="bde282ad1e62a3d8d64bcbebfd99918c" category="list-text">EPIC镜像用于将数据复制到灾难恢复和报告(以绿色表示)。</block>
  <block id="89c4ed523f61f9d3446182d80a53c8b6" category="list-text">从Report到Clarity的每日数据转储。</block>
  <block id="c3d37da5ec71148ab4d2292c5fc62181" category="list-text">NetApp自动备份(以黄色表示)。</block>
  <block id="f417d841f910f45d16ac64fccd850be8" category="list-text">NetApp自动刷新SUP、REP和其他测试(以蓝色表示)。</block>
  <block id="2a7a6372892435f5d284e730df618c35" category="list-text">测试环境适用于完整副本环境、而不适用于较小的强制转换副本。</block>
  <block id="88b2dcefc205727508d4017aacafaafd" category="paragraph">有关详细信息、请联系适用于Epic应用程序的NetApp服务。</block>
  <block id="4e3e281c19bf41f436de9fe363daa25c" category="paragraph">一致性组(简称CGS)可提供此功能以及更多功能。它们可以在夜间使用、以便使用策略创建按需快照或计划内一致的快照。您可以使用它来还原、克隆甚至复制数据。</block>
  <block id="f5de57234e68f27cbd82acfc80f2d5cb" category="inline-link-macro">有关一致性组的NetApp文档</block>
  <block id="f7e43fe614bf53ff9721f7494c0caf16" category="paragraph">有关GS的更多信息、请参见<block ref="0efc681e89d66f1c589ad00a8ae67afa" category="inline-link-macro-rx"></block></block>
  <block id="9f42082fda47a6a26e6c6e6bcc14526e" category="section-title">为Epic配置一致性组</block>
  <block id="7d381e222258ec55bcf215684ae70097" category="inline-image-macro">经典和一致性组</block>
  <block id="4eb8f91ee432a8e69615314961db4f88" category="paragraph"><block ref="4eb8f91ee432a8e69615314961db4f88" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4294e0bf4b67190ddcb91a01b3c4356c" category="section-title">一致性组快照</block>
  <block id="86cfb45aaa741215d8d8d58223948dcc" category="paragraph">WebBLOB和VMare数据集应仅配置为卷、而不与CGS关联。您可以使用SnapMirror或SnapVault技术在独立于生产环境的存储系统上维护其Snapshot副本。</block>
  <block id="f5445123331a1b74a34fd1f392e9e946" category="inline-image-macro">EPIC CG快照</block>
  <block id="92aabd14a16803d9fa65ca4f94488322" category="paragraph"><block ref="92aabd14a16803d9fa65ca4f94488322" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9c71026f6349a81cd2a3cfcfa8ea9ceb" category="summary">ONTAP整合的史诗般的体验</block>
  <block id="569a30a99d3744f0871a7c36162f469c" category="paragraph">医疗保健行业面临的主要挑战之一是、单组环境的效率低下。</block>
  <block id="87b522a84cee7651eb3ea5c59d4c9a35" category="paragraph">多个群体创建了多个点的解决方案、阻碍了进展。统一的数据管理战略有助于提高效率、加快转型步伐。患者病历的数据化、Ransan发生 器和生成性AI等颠覆性技术都推动了整合需求。</block>
  <block id="882f36b3d76e4e5b9ac08850c1e7a15a" category="paragraph">借助ONTAP、您可以整合文件/块/对象以及在内部和云中运行的第0/1/2/3层工作负载、所有这些工作负载均在ONTAP上运行。</block>
  <block id="0b153e0d191221abe8c325950ab9a03b" category="summary">ONTAP效率史诗般的表现</block>
  <block id="12ca553efec3e73a9120d8c050d405a9" category="paragraph">EPIC在全闪存阵列上运行、其中大部分成本都是磁盘成本。因此、存储效率对于节省成本至关重要。</block>
  <block id="aac466a460fe672b45d2e43b476f772e" category="paragraph">NetApp实时存储效率可在不影响性能的情况下实现行业领先的存储节省、我们甚至还为全闪存阵列提供书面效率担保。</block>
  <block id="436525ee58a117eefbde96bb2f0cae02" category="paragraph">在计算存储效率时、一定要衡量原始容量、可用容量和有效容量。</block>
  <block id="bbf547b93564824fe00f04646269a56e" category="list-text">*原始容量*在应用任何RAID之前、磁盘大小按磁盘数量。</block>
  <block id="29cabda6c17d251ab3bba7feb41646fc" category="list-text">*可用容量*应用RAID后，可用存储容量。</block>
  <block id="9edb4e889ca40d3881217c9433ecb376" category="list-text">*有效容量*配置并提供给主机或客户端的存储容量。</block>
  <block id="21e10a177fbffc69f63f5dcdb44175f5" category="paragraph">下图是典型Epic部署的效率计算示例、其中包括需要852TB有效存储且效率为5.2：1且可提供1.32PB总有效数据的所有工作负载。</block>
  <block id="c8c2fd097c28062ec912ad0d2f9bbe11" category="admonition">根据磁盘数量、原始容量到可用容量略有不同。</block>
  <block id="f0a0c9b18011b122c315d8970dbcce49" category="inline-image-macro">卓越的存储效率</block>
  <block id="d145883b21ccbccb471abc3a5dac40f3" category="paragraph"><block ref="d145883b21ccbccb471abc3a5dac40f3" category="inline-image-macro-rx" type="image"></block></block>
  <block id="bf8acecf163b9e71e2e9331bc87c5e90" category="admonition">NetApp不使用NetApp快照技术或精简配置来计算担保计划中的效率。这样做会显示出30-100：1的不切实际的效率、这在估算实际存储容量规模时毫无意义。</block>
  <block id="f4f81a0ab85224d234bc465988b5b871" category="summary">ONTAP上的EPIC概述</block>
  <block id="35b4c598dd74c59e91d978c12210cc03" category="doc">ONTAP上的经典</block>
  <block id="52aaae321a4b3f69eaf3448c22d2d55c" category="paragraph">ONTAP让EPIC变得更轻松。</block>
  <block id="76d68daeac9b3e7a8cfb0c3d904ac7de" category="paragraph">ONTAP是一款数据管理平台、支持您整合Epic工作负载、同时满足您的所有性能、数据保护和数据管理要求。</block>
  <block id="85e6f9f2e3539043a3a60b16af5a654f" category="paragraph">只有在NetApp上、您才能在一个高可用性数据管理平台上标准化SAN、NAS和对象的所有医疗保健工作负载。ONTAP是全球部署最广泛的存储软件平台、拥有近30年的持续创新经验。借助本机ONTAP数据管理工具和应用程序集成、您可以应对所有Epic挑战。无需购买大量第三方工具来填补解决方案中的空白。</block>
  <block id="54fed3d17b1233bcc7ab7b0d3f6eddca" category="paragraph">许多存储供应商都提供传统、可靠且快速的块存储。它们运行良好、但通常部署在孤岛中以运行单个工作负载、例如生产、报告、Clarity、VDI、VMware和NAS。每个孤岛都有不同的硬件和不同的管理工具、它们通常由不同的IT组进行管理。这种传统方法增加了当今医疗保健领域最大的问题—复杂性。</block>
  <block id="58ad32957aed88a3c14ef81e5f254bd3" category="paragraph">NetApp让数据管理变得更加轻松高效。ONTAP利用创新和技术、通过任何协议和集成数据保护、在一个平台上为每个工作负载提供一致且有保障的SLA、而不是浪费资金解决超大孤岛的问题。这些功能和工具还扩展到您选择的云、如下图所示。</block>
  <block id="0d9c98d3832defc892b59655abcfacfc" category="inline-image-macro">借助ONTAP实现医疗保健行业的扩展和精简性</block>
  <block id="4277ed476100dc05b0a4e0e837c3d9b9" category="paragraph"><block ref="4277ed476100dc05b0a4e0e837c3d9b9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="63cc4e5664cd9022b0fc1580682f9995" category="summary">ONTAP性能卓越</block>
  <block id="6762c0b102338c245945f7d09da83fa4" category="paragraph">ONTAP于2009年推出了闪存技术、自2010年以来便支持SSD。凭借在闪存存储方面的长期经验、NetApp可以调整ONTAP功能、以优化SSD性能并增强闪存介质持久性、同时保留ONTAP丰富的功能。</block>
  <block id="8e0c14b7c96a8748c07c3916510ebd8b" category="paragraph">自2020年以来、所有Epic odb工作负载都必须位于全闪存存储上。EPIC工作负载通常以每TB存储大约1、000-2、000次IOPS (8k块、75%/C5%读写比率和100%随机)的速度运行。EPIC对延迟非常敏感、高延迟对最终用户体验以及运行报告、备份、完整性检查和环境刷新时间等操作任务具有明显影响。</block>
  <block id="4a9928f04affb2a4fe321fb9e2b003fd" category="list-text">纯闪存阵列的限制因素不是驱动器、而是控制器上的利用率。</block>
  <block id="11a9dfbe9a015ca567ecd5f77959dc1f" category="list-text">ONTAP采用双主动架构。为提高性能、HA对中的两个节点都会写入驱动器。</block>
  <block id="3a5c5db6ac361794af4c29a626c584f5" category="list-text">这样就可以最大限度地提高CPU利用率、这是NetApp发布行业最佳Epic性能的一个最重要因素。</block>
  <block id="2f6b137b593d6a732992bc619827ee36" category="list-text">NetApp RAID DP、高级磁盘分区(ADP)和WAFL技术可满足所有Epic要求。所有工作负载都会在所有磁盘之间分布IO。无瓶颈。</block>
  <block id="0ce3d3de991180e05a5a0818efc312ef" category="list-text">ONTAP经过写入优化；写入一旦写入镜像NVRAM、就会得到确认、然后再以实时内存速度写入磁盘。</block>
  <block id="ca65639a4e206f319202179e1d9a4ff4" category="list-text">借助WAFL、NVRAM和模块化架构、NetApp可以利用软件实现实时效率、加密和性能创新。此外、NetApp还可以在不影响性能的情况下引入新特性和功能。</block>
  <block id="f13349f1404495d87711104e964b1cef" category="list-text">以往、每个新版本的ONTAP都会将性能和效率提高30-50%。当您及时了解ONTAP时、性能将达到最佳。</block>
  <block id="70d9e3c68d42d6ec42ab792e06c44357" category="section-title">NVMe</block>
  <block id="42fa4afed0f941a60ea00e82671c421d" category="paragraph">当性能至关重要时、NetApp还支持下一代FC SAN协议NVMe/FC。</block>
  <block id="1e4d4890d3f90b04841095b53183f782" category="paragraph">如下图所示、我们的Genio测试使用NVMe/FC协议实现的IOPS比使用FC协议实现的IOPS要多得多。NVMe/FC连接解决方案在超过45秒写入周期阈值之前实现了超过70万次IOPS。通过将SCSI命令替换为NVMe、还可以显著降低主机上的利用率。</block>
  <block id="0b336e7e203efd55d17ecfaa03c134f5" category="inline-image-macro">经典Genio图</block>
  <block id="293e47073bb00e514b986ef28fbbb2e1" category="paragraph"><block ref="293e47073bb00e514b986ef28fbbb2e1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9ff8735576a58daba5ba20974f92a584" category="summary">ONTAP可扩展性的史诗般的体验</block>
  <block id="1027782bab261904e6adf43f2b137951" category="paragraph">Epic硬件配置指南在3年内每年增长~20%。但是、环境也可能意外增长。</block>
  <block id="39e52e339ff39b5620d48036812e09ec" category="paragraph">对于NAS、SAN和对象集群、NetApp可以将性能和容量无缝扩展到多达12个节点。因此、您可以随着业务增长无干扰地进行纵向和横向扩展。</block>
  <block id="49c5cdfe08202e574deefaa3d26c332a" category="inline-link-macro">NetApp经验证的架构在现代SAN上的Epic</block>
  <block id="12cb4beeba752f647712c749e3076fbf" category="paragraph">EPIC的可扩展性更出色。它支持拥有多个Epic实例的大型客户整合为一个实例。该<block ref="5d13d58e489e8fe43bb727515c1d9ff2" category="inline-link-macro-rx"></block>文档表明、Epic可以在一个HA上无缝地将整合工作负载扩展到720、000次IOPS、并在一个集群中横向扩展到400、000次以上的IOPS。您可以通过升级控制器或向现有集群添加磁盘来无干扰地进行纵向扩展。</block>
  <block id="196097993185ddccf60443ac3f86e89f" category="paragraph">NAS、SAN和对象数据还可以在集群中的节点之间无故障移动。集群中的每个HA对都可以是ONTAP FAS和AFF系统类型和大小的任意组合。您可以在一个集群之间平衡工作负载、从而最大程度地提高存储投资。</block>
  <block id="6abd4957b4615c500bd2a32425316211" category="paragraph">此外、ONTAP还可以选择使用StorageGRID或云上的对象存储作为备份目标和/或自动冷存储层目标。通过此功能、您可以将昂贵的全闪存磁盘、分层快照和冷数据自动释放到对象中。</block>
  <block id="8d3f76f475a5e81f188f700429c71a9e" category="paragraph">因此、Epic可以利用ONTAP、多协议、StorageGRID和您选择的云、在NetApp产品组合中更好地运行。这些产品提供灾难恢复、归档、分析、分层等选项。</block>
  <block id="1e3ccee88df9552e4751ba4ad173de96" category="summary">ONTAP安全上的史诗般体验</block>
  <block id="32e1bf49ff775c9283c882fe7f3ec873" category="paragraph">安全是当今企业和医疗保健主管最关心的问题。管理难度从未如此之大、而且企业在合规性、数据监管、防病毒保护和勒索软件方面也面临挑战。</block>
  <block id="0d6ce08690a300cb8ce00d77e1c31a5e" category="inline-link-macro">《ONTAP安全增强指南》</block>
  <block id="40e97866feb53c48881b34e5f97ca61f" category="paragraph">本文档不会提供有关Epic和存储安全性的完整指南、但会<block ref="471b0f2cfbad0f2ec4e54df06500d580" category="inline-link-macro-rx"></block>详细介绍ONTAP提供的所有广泛而高级的安全功能。</block>
  <block id="1408f921f799efe0e585aeba5fa9ed58" category="inline-link-macro">TR-4569</block>
  <block id="f87d3f3c7c3e6e9ab1153c53d78b40b1" category="paragraph">NetApp Active IQ Unified Manager会根据中包含的信息监控安全违规、并在信息板中报告这些违规<block ref="1b2ca6a48e0bf52cc6351680c5ee6170" category="inline-link-macro-rx"></block>、以简化安全管理。这些工具可以帮助您的组织实现安全目标、以保护、检测和修复攻击。</block>
  <block id="a1fbc1f9fe3c77416c96f491ba933c4a" category="inline-link-macro">NetApp FPolicy</block>
  <block id="96f76ddccc0adcaf0fc9a2fc6c834374" category="inline-link-macro">多因素(MFA)身份验证</block>
  <block id="a754af2f708573321f76c2d36bea9f02" category="paragraph">NetApp还与安全供应商合作、通过软件实现集成、<block ref="48fae993b7aeb9944f39dadc4618e2b6" category="inline-link-macro-rx"></block>以增强您的安全产品。此外、还可以添加、<block ref="b5ae90d3a2df9b77f2db834fe0dc7b7d" category="inline-link-macro-rx"></block>以保护您的Epic环境、防止未经授权而使用泄露的凭据进行访问。</block>
  <block id="91d998bab304adb0fd27858a4295dcac" category="inline-link-macro">ONTAP网络存储</block>
  <block id="e9c1c7d4ca860adb553d87c2c1d9ef35" category="inline-link-macro">适用于勒索软件的NetApp解决方案</block>
  <block id="63ab8aaa1f35361bdf5c84b3d1dd4765" category="inline-link-macro">NetApp和零信任</block>
  <block id="a67fe844bc4d3e5cf5ebac11dea00b01" category="paragraph">最后，ONTAP本机Snapshot副本和带有的不可移动SnapLock技术<block ref="79305a8b61b53acc892506e6bcd6f49f" category="inline-link-macro-rx"></block>提供了独特的空隙功能，可保护您的患者记录免遭勒索软件的攻击。请参见上的NetApp文档<block ref="910d0617bba4ff1a9d41b4b330096d85" category="inline-link-macro-rx"></block>。有关更具战略性的安全性方法，请参见<block ref="aaf21a490837c9b392e59c6c9110165d" category="inline-link-macro-rx"></block>。</block>
  <block id="28caba838e7a7ff7ff218bae8235208a" category="summary">史诗般的快照和克隆</block>
  <block id="8ad0c394ef79d2b18983fabe84f658fc" category="paragraph">快照是卷的只读时间点副本。</block>
  <block id="568043eed0b44992a4b4a1cc21f8b633" category="paragraph">快照会对活动文件系统中的所有块进行逻辑锁定。NetApp ONTAP Snapshot副本近乎即时、不会使用任何额外存储。</block>
  <block id="04a00b93a2db41946dc3d263cf6c294c" category="paragraph">写入、其中文件布局(WAFL)是一个只写文件系统；它不会执行额外的IO、例如在覆盖之前复制受Snapshot保护的块中的数据。不会移动任何数据；因此、快照不会对存储容量或性能产生任何影响。快照可在扩充备份解决方案的同时节省大量存储空间。</block>
  <block id="a701f5d044348085ee4f97fef6636845" category="section-title">FlexClone</block>
  <block id="16f57611d3d44b74ce1c1b134cb8e798" category="paragraph">NetApp ONTAP FlexClone卷是现有卷的克隆或现有卷的快照。在其他方面、它与任何其他卷一样是ONTAP卷、它本身可以进行克隆、使用快照进行保护、并使用QoS策略进行配置。</block>
  <block id="e0c3236990160654182a79c89baab29f" category="paragraph">与快照一样、FlexClone卷在创建时不需要任何额外空间。只有对克隆进行更改才需要额外容量。</block>
  <block id="9a9ff90c24c36543bf54b1f2136fd9e0" category="paragraph">EPIC需要10到30个生产数据库副本来满足各种操作要求、例如流式备份、完整性检查和暂存升级环境。随着升级频率的提高、对基于FlexClone卷构建的解决方案的需求也随之增加。</block>
  <block id="dad816f366caa0b8cae67daaeb85deb0" category="admonition">在该解决方案中使用了NetApp和本机NetApp工具、提供了一个完全自动化的Epic备份解决方案和Epic更新解决方案。</block>
  <block id="53f102b306ab1aba43e9e20701dc32f2" category="doc">ONTAP上的经典</block>
  <block id="3bfc8ddd725eed5b674d1a480bc650d2" category="paragraph">数字化转型的关键在于利用数据实现更多优势。</block>
  <block id="2b82426bc0bfa4ea3efb779d165629a4" category="admonition">本文档将取代先前发布的技术报告_TR-3923：《适用于Epic_的NetApp最佳实践》。</block>
  <block id="fdf0f3f3a2bae0d66ca5ecb45e1f3d85" category="paragraph">医院需要大量数据才能开启数字化转型之旅。在治疗患者、管理员工计划和医疗资源的过程中、一部分是收集和处理信息。但是、许多操作仍然是手动执行的或通过过时的系统执行的。其中一个常数是数据量持续呈指数级增长、因此越来越难以管理。</block>
  <block id="74090662bfdb94e49dfc286a6946cc5c" category="paragraph">这一问题的主要原因是医院数据往往存储在数据孤岛中。手动输入和更新所花费的时间过长、从而导致作业中断和错误。本文档是医疗保健数据Epic电子健康记录(EHR)的一部分。但是、此处介绍的数据管理策略可以而且应该应用于所有医疗保健数据。NetApp在打造现代化和简化数字基础架构方面拥有骄人的历史。我们的智能数据基础架构是数字化转型的基础。</block>
  <block id="b68a1112138fe0c0c1beafc2aea18949" category="paragraph">NetApp提供一个单一的数据管理解决方案来满足所有医疗保健需求、我们能够指导医院完成数字化转型之旅。通过构建结构化和智能解决方案、医疗保健行业可以充分发挥这些宝贵信息的价值。这一框架可帮助医疗提供者更快地诊断疾病，并制定个性化治疗计划，以更好地支持紧急情况下的决策过程。您还将能够构建自己的智能数据基础架构、使医院能够打破数据孤岛、促进数据互操作性并保护敏感的患者信息。</block>
  <block id="6b5a360f7d15046cfd935db963e3da66" category="paragraph">使用本文档作为成功构建和实施Epic EHR的指南。无需构建多个Epic孤岛、只需构建一个Epic数据基础架构、即可实现医院转型。</block>
  <block id="261addf78c7b2c961032b3dd08ba0b1f" category="section-title">目的</block>
  <block id="b8954f46b76dae4370058c7bd9ae0c97" category="paragraph">本文档介绍了将NetApp存储集成到Epic软件环境中的最佳实践。它包含以下部分：</block>
  <block id="6c5022fa1197168f37c42e56f80d36aa" category="list-text">从技术上了解Epic软件环境及其在各种配置中的存储要求。</block>
  <block id="a9da176a5abe5a618e8ed6a88bdbf21b" category="list-text">Epic存储注意事项、介绍Epic解决方案的重要决策因素。</block>
  <block id="8b3f0902644adbb7e0435ae9c9a284e2" category="list-text">NetApp存储建议、介绍满足Epic存储要求的NetApp存储配置最佳实践。</block>
  <block id="5d113f2038d289f391614c39043629e8" category="section-title">范围</block>
  <block id="217eb7cf1ad7503a42f61ad3cffb47fb" category="paragraph">本文档不涵盖以下主题：</block>
  <block id="f900b8ede5ddf3a0471176dab052001d" category="list-text">中介绍了定量性能要求和规模估算指导<block ref="81c36a9e6d224e9d42c9630dffaa9434" category="inline-link-rx"></block>(需要NetApp登录)</block>
  <block id="ef1e6887c579ba81dcedc3f4e3793cd2" category="section-title">受众</block>
  <block id="2f215f5ba67ae7978ce4846a4a1cdc08" category="paragraph">NetApp假定读者具备以下背景知识：</block>
  <block id="6cfde17644914efa6d0a4d0c21a8f9db" category="list-text">深入了解SAN和NAS概念</block>
  <block id="c86456e4299d4b0ad43e030d0fdd0af5" category="list-text">熟悉ONTAP存储系统的技术知识</block>
  <block id="59eba43c04b655e21f087af920398a2a" category="list-text">熟悉ONTAP的配置和管理</block>
  <block id="b7c45da218d2e29ec939a31cdd81f2be" category="paragraph">在Windows Server环境中、运行ONTAP的NetApp存储控制器可以支持以下工作负载：</block>
  <block id="f43e8d35e63b48bc73d5dc074df829ae" category="paragraph">Microsoft ODX (也称为副本卸载)支持在存储设备内或兼容存储设备之间直接传输数据、而无需通过主机计算机传输数据。ONTAP支持对CIFS和SAN协议使用ODX功能。如果副本位于同一个卷中、ODX可能会提高性能、降低客户端上的CPU和内存利用率、并降低网络I/O带宽利用率。</block>
  <block id="72960f8df48c0debc035454921c1b5d3" category="list-text">在共享实时迁移中、虚拟机存储在SMB共享上。因此、实时迁移虚拟机时、该虚拟机的存储仍保留在中央SMB共享上、以供另一节点即时访问、如下所示。</block>
  <block id="5a002cf26db634ca1b1fff75461d2427" category="list-title">ONTAP在NetApp存储控制器上运行。它提供多种格式。</block>
  <block id="6011d6a859985e0b6d7c13b0907896ca" category="paragraph">ONTAP可提供高可用性存储、其中可存在从存储控制器到Windows Server的多条路径。多路径是指从一台服务器到一个存储阵列具有多条数据路径的能力。多路径功能可防止出现硬件故障(缆线切断、交换机和主机总线适配器[HBA]故障等)、并可通过使用多个连接的聚合性能来提供更高的性能限制。当一个路径或连接不可用时、多路径软件会自动将负载转移到其他可用路径之一。MPIO功能将存储的多个物理路径组合为一个逻辑路径、用于数据访问、以提供存储故障恢复能力和负载平衡。要使用此功能、必须在Windows Server上启用MPIO功能。</block>
  <block id="8bbfb9edfb90853f3f9439d77ce59441" category="list-text">ONTAP上的命令行界面命令</block>
  <block id="e72f4a4f5fcfab964176e743af1f3196" category="paragraph">NAS协议CIFS本机集成到ONTAP中。因此、Windows Server不需要任何其他客户端软件即可访问ONTAP上的数据。NetApp存储控制器在网络上显示为本机文件服务器、并支持Microsoft Active Directory身份验证。</block>
  <block id="ab2d1dd1b024fd7be648c22c4a43997b" category="list-text">某些CIFS管理任务可以使用Microsoft管理控制台(MMC)来执行。在执行这些任务之前、您必须使用MMC菜单命令将MMC连接到ONTAP存储。</block>
  <block id="1d5ba6202d85466a95188b58c37dccc8" category="list-text">NetApp建议使用10 GB网络(如果有)连接Hyper-V主机和ONTAP存储。如果使用1 GB网络连接、NetApp建议创建一个由多个1 GB端口组成的接口组。</block>
  <block id="79d467fa842b9015f2f12ada4fa1c7fc" category="paragraph">SQL Server的性能与CPU和核心配置有多种依赖性。</block>
  <block id="4403546c5938500562a9d8677deb1c38" category="section-title">核心和许可</block>
  <block id="c325fde2d51a1ea2ddd8c9dd51cfdf9c" category="paragraph">下图显示了启动后的SQL Server日志消息、指示核心限制的强制实施。</block>
  <block id="e59dc8056170cddb696ba9bff812c325" category="paragraph">SQL Server使用操作系统中可用的所有CPU (如果选择了按处理器核心许可证)。此外、它还会为每个CPU创建计划程序f0r、以便充分利用任何给定工作负载的资源。多任务处理时，操作系统或服务器上的其他应用程序可以将进程线程从一个处理器切换到另一个处理器。SQL Server是一个资源密集型应用程序、发生这种情况时、性能可能会受到影响。为了最大限度地减少影响、您可以对处理器进行配置、使所有SQL Server负载都定向到一组预先选择的处理器。这可通过使用CPU相关性掩码来实现。</block>
  <block id="e40a45aed8142e74026f5aa7a6ee1122" category="paragraph">相关性I/O掩码选项可将SQL Server磁盘I/O绑定到一部分CPU。在SQL Server OLTP环境中、此扩展可以显著提高发出I/O操作的SQL Server线程的性能。</block>
  <block id="16dce493fdad96fe48148f47dc552bfb" category="admonition">* NetApp建议*对于数据仓库等DSS，从50开始，<block ref="1abedc5f6ab369ab9fcd16d6b7990638" prefix=" " category="inline-code"></block>并根据需要进行调整。请确保在进行更改时测量应用程序中的关键查询。</block>
  <block id="0add8d6e7be42a854cd7e0161c7f9bcc" category="paragraph">通常、系统会为每个查询创建一个单独的操作系统线程。如果与SQL Server同时建立了数百个连接、则每个查询一个线程的配置可能会占用过多的系统资源。该<block ref="a9233738c364090bbc418d8a0e08a79e" prefix=" " category="inline-code"></block>选项可以使SQL Server创建一个工作线程池、从而共同为大量查询请求提供服务、从而有助于提高性能。</block>
  <block id="29daf9697a41a463dbe76855a2053a87" category="paragraph">以下示例显示了如何使用T-SQL配置最大工作线程数选项。</block>
  <block id="7039e99a0fdcc0d3ef80074ed42bf4e4" category="paragraph">数据库备份策略应基于已确定的业务要求、而不是理论能力。通过将ONTAP的Snapshot技术与Microsoft SQL Server API相结合、无论用户数据库大小如何、您都可以快速创建应用程序一致的备份。为了满足更高级或横向扩展的数据管理要求、NetApp提供了SnapCenter。</block>
  <block id="97e73fdb42ddecb63ed519a484ff3c9b" category="paragraph">SQL Server还要求操作系统和存储之间进行协调、以确保创建快照时Snapshot中存在正确的数据。在大多数情况下、执行此操作的唯一安全方法是使用SnapCenter或T-SQL。如果未进行这种额外协调、则创建的快照可能无法可靠地恢复。</block>
  <block id="9d831cc4c73b8a2915ce6d8928d55915" category="paragraph">SQL Server无中断可用性组复制功能是一个绝佳的选择、NetApp提供了将数据保护与无中断集成的选项。但是、在某些情况下、您可能需要考虑使用ONTAP复制技术。有三个基本选项。</block>
  <block id="dd432f8769e4d3db8acf8bf9df94680a" category="paragraph">SnapMirror技术为通过LAN和广域网复制数据提供了快速灵活的企业解决方案。SnapMirror技术仅在创建初始镜像后将更改后的数据块传输到目标、从而显著降低网络带宽要求。它可以配置为同步或异步模式。</block>
  <block id="fce5f84d02dbd5c9e3cfedf18e809644" category="summary">Microsoft SQL Server和NetApp MetroCluster</block>
  <block id="41900c1c2eb669e401e4abee9091b40b" category="paragraph">在MetroCluster环境中部署Microsoft SQL Server需要对MetroCluster系统的物理设计进行一些说明。</block>
  <block id="60359402d81f6673550c3df489efb034" category="paragraph">MetroCluster会在位于不同位置或故障域的两个ONTAP集群之间同步镜像数据和配置。MetroCluster通过自动管理两个目标为应用程序提供持续可用的存储：</block>
  <block id="abf0aedf685f58c3cf3abe3e41ca549c" category="list-text">通过同步镜像写入集群的数据实现零恢复点目标(RPO)。</block>
  <block id="1194ac032fc54dbcf779ac23fbc73dd5" category="list-text">通过镜像配置和自动访问第二个站点的数据、实现近乎为零的恢复时间目标(Recovery Time目标、RTO)。</block>
  <block id="9aa45379205d52916f2958359e92c1c8" category="paragraph">MetroCluster通过在两个站点中的两个独立集群之间自动镜像数据和配置来简化操作。由于存储是在一个集群中配置的，因此它会自动镜像到第二个站点的第二个集群。NetApp SyncMirror®提供所有数据的完整副本，并且没有RPO。这意味着、一个站点的工作负载可以随时切换到另一个站点、并继续提供数据、而不会丢失数据。MetroCluster负责管理切换过程、以便能够访问第二个站点上NAS和SAN配置的数据。将MetroCluster设计为经验证的解决方案、其中包括规模估算和配置、可在协议超时期限内或更短时间(通常少于120秒)执行切换。这样、RPO几乎为零、应用程序可以继续访问数据、而不会发生故障。MetroCluster可通过后端存储网络结构定义的多种变体提供。</block>
  <block id="47985b72c36de8197de21d06517f1a03" category="paragraph">使用MetroCluster保护SQL Server以SyncMirror为基础、该技术可提供最高性能的横向扩展同步镜像技术。</block>
  <block id="96a36329b3e96b1619b1d635a806bb3f" category="summary">采用NetApp MetroCluster的Microsoft SQL Server</block>
  <block id="9fcf1f7a4c16b536048dc5875b61d4b1" category="paragraph">保护零RPO SQL Server数据库的一个选项是MetroCluster。MetroCluster是一种简单的高性能RPO = 0复制技术、支持您在站点间轻松复制整个基础架构。</block>
  <block id="8a7f9ca86b522c62318d9b1eb5b51625" category="paragraph">SQL Server可在一个MetroCluster系统上扩展到多达数千个数据库。可能存在SQL Server独立实例或故障转移集群实例、MetroCluster系统不一定会添加或更改数据库管理的任何最佳实践。</block>
  <block id="43135677cc98d0d6872d9ec24bef82e4" category="paragraph">本文档不会对MetroCluster进行完整说明、但其原则非常简单。MetroCluster可提供具有快速故障转移功能的RPO = 0复制解决方案。在此基础之上构建的内容取决于您的要求。</block>
  <block id="046797023ebbfe8b6dd24d4fc7cab0be" category="paragraph">例如、站点突然丢失后的基本快速灾难恢复过程可以使用以下基本步骤：</block>
  <block id="f8b79e7c0c5914411ccfda1cbaa25414" category="list-text">强制执行MetroCluster切换</block>
  <block id="740d5da1ae0060ef63f290d3aed64929" category="list-text">发现FC/iSCSI LUN (仅限SAN)</block>
  <block id="89c617c4ed9cac275e572a67b1c52b29" category="list-text">挂载文件系统</block>
  <block id="f08329445e69fa49a8223bf365f09e47" category="list-text">启动SQL服务</block>
  <block id="b7aabeea5e06b7371d4372fd7f698f88" category="paragraph">此方法的主要要求是在远程站点上运行操作系统。它必须预配置SQL Server设置、并应使用等效的内部版本进行更新。SQL Server系统数据库也可以镜像到远程站点、并在发生灾难时进行挂载。</block>
  <block id="2b963bb5f627aa0ffda026b4d97b6474" category="summary">Microsoft SQL Server和SM-AS故障转移场景</block>
  <block id="b0bb805a1ea68ad43ceacf65954b4b4b" category="paragraph">要规划完整的SnapMirror主动同步应用程序架构、需要了解SM-AS如何在各种计划内和计划外故障转移场景中做出响应。</block>
  <block id="511d40fa1b50f901027391480dff9c67" category="paragraph">要安全地自动执行故障转移、需要使用调解器。理想情况下、它会放置在独立的第三个站点上、但如果与参与复制的集群之一主机代管、它仍可满足大多数需求。</block>
  <block id="cef962a099d3ff2b834420d0c97f5bc1" category="summary">Microsoft SQL Server和SM-AS非一致访问</block>
  <block id="3ef2650b3e4d89df6ea0248f432e6c2c" category="paragraph">非一致访问网络意味着每个主机只能访问本地存储系统上的端口。SAN不会跨站点(或同一站点内的故障域)进行扩展。</block>
  <block id="7c58b14cf1e27ff24a5b6a0656848380" category="summary">Microsoft SQL Server和SnapMirror活动同步</block>
  <block id="64affc06244780af1f97a68438460989" category="paragraph">通过SnapMirror主动同步、各个SQL Server数据库和应用程序可以在存储和网络中断期间继续运行、并可实现透明的存储故障转移、而无需任何手动干预。</block>
  <block id="0a19f1ca74616d0d4972b2c02c3f7fee" category="paragraph">从ONTAP 9 15.1开始、除了现有的非对称配置之外、SnapMirror主动同步还支持对称主动/主动架构。对称主动/主动功能提供同步双向复制、以实现业务连续性和灾难恢复。它可以跨多个故障域同时对数据进行读写访问、从而帮助您保护关键SAN工作负载的数据访问、从而确保无中断运行、并在发生灾难或系统故障时最大限度地减少停机时间。</block>
  <block id="d17dae030927ab027095c1e44df8fbf1" category="paragraph">SQL Server主机使用光纤通道(Fibre Channel、FC)或iSCSI LUN访问存储。在托管已复制数据副本的每个集群之间进行复制。由于此功能是存储级别复制、因此在独立主机或故障转移集群实例上运行的SQL Server实例可以对任一集群执行读/写操作。有关规划和配置步骤，请参阅<block ref="44f5d8051247437425911d96f84db248" category="inline-link-macro-rx"></block>。</block>
  <block id="b2f689709f901a51858096aaf9637eb4" category="paragraph">**同步复制**</block>
  <block id="71ed2e619a97a27f6fe533714a412725" category="paragraph">在正常操作下、每个副本始终是一个RPO = 0的同步副本、但有一个例外。如果无法复制数据、则ONTAP将不再需要复制数据并恢复在一个站点上提供IO、而另一个站点上的LUN将脱机。</block>
  <block id="331b5c7e8c01ec1e37b60de5a5efba6c" category="paragraph">**存储硬件**</block>
  <block id="588068838f06fe39dec548e2210ddf2f" category="paragraph">ONTAP调解器是从NetApp支持下载的软件应用程序、通常部署在小型虚拟机上。ONTAP调解器不是Tieb破碎 机。它是参与SnapMirror活动同步复制的两个集群的备用通信通道。ONTAP根据通过直接连接和调解器从合作伙伴处收到的响应来推动自动化操作。</block>
  <block id="6fda40460e9cbbefd704b9c01ea2c18c" category="summary">Microsoft SQL Server和SM-AS首选站点</block>
  <block id="ac420a2d1b21182a80148191683bc9f7" category="paragraph">SnapMirror主动同步行为是对称的、但有一个重要例外-首选站点配置。</block>
  <block id="3ccf31c781c6df95109107d66199a8f6" category="section-title">SQL Server的独立实例</block>
  <block id="bd53ef250bf6f7a012cc7ed01c62f8cd" category="inline-link-macro">基于ONTAP的SQL Server</block>
  <block id="d0d5aa4f66a3624a91ad4b11bbc2250f" category="paragraph">文件布局和服务器配置的最佳实践与文档中建议的相同<block ref="c89905de54b32eb552c83786b7590df9" category="inline-link-macro-rx"></block>。</block>
  <block id="a489ffed938ef1b9e86889bc413501ee" category="inline-link-macro">统一</block>
  <block id="ee289d07b4c3d14dcc9cc162df065f99" category="paragraph">使用独立设置时、SQL Server只能在一个站点上运行。可能<block ref="b88135502d93a28469d0c520f73e7e7d" category="inline-link-macro-rx"></block>会使用访问权限。</block>
  <block id="50c137c2af8db8930fd9881b4ece5d99" category="inline-image-macro">具有统一访问的单个主机</block>
  <block id="327efeeabe7ad30552ef39a61284b93b" category="paragraph">使用统一访问时、任一站点的存储故障都不会中断数据库操作。当然、如果包含数据库服务器的站点发生完全故障、则会导致中断。</block>
  <block id="5bc465d840f8a329d264340f938ab253" category="paragraph">某些客户可以为在远程站点上运行的操作系统配置预先配置的SQL Server设置、并使用与生产实例相同的构建版本进行更新。故障转移需要激活备用站点上的独立SQL Server实例、发现LUN并启动数据库。由于不需要从存储端执行任何操作、因此可以使用Windows PowerShell cmdlet自动完成整个过程。</block>
  <block id="ea7bbefe18f9ad7af62904dd6da19c33" category="inline-link-macro">非一致性</block>
  <block id="b53a3ef75c6e33a4f8945589cbe8beee" category="paragraph"><block ref="56d4a3cb11d7ad2b0e560d2cc8afde2c" category="inline-link-macro-rx"></block>也可以使用访问、但如果数据库服务器所在的存储系统因数据库没有可用的存储路径而出现故障、则会导致数据库中断。在某些情况下、这种情况仍可接受。SnapMirror主动同步仍可提供RPO = 0的数据保护、并且在站点发生故障时、运行正常的副本将处于活动状态、并可使用与上述统一访问相同的过程恢复操作。</block>
  <block id="a2e30e760061ab42fd5030c552306712" category="paragraph">使用虚拟化主机可以更轻松地配置简单的自动化故障转移过程。例如、如果SQL Server数据文件与启动VMDK一起同步复制到二级存储、则在发生灾难时、可以在备用站点上激活整个环境。管理员可以在正常运行的站点上手动激活主机、也可以通过VMware HA等服务自动执行此过程。</block>
  <block id="f04055c72ba32a95b9830308e4508cb1" category="section-title">SQL Server故障转移集群实例</block>
  <block id="21fd4631916f5c0e63ef67f98d413d6a" category="paragraph">SQL Server故障转移实例也可以托管在作为子操作系统运行在物理服务器或虚拟服务器上的Windows故障转移集群上。这种多主机架构可提供SQL Server实例和存储故障恢复能力。在需要在保持增强性能的同时实现强大故障转移流程的高需求环境中、此类部署非常有用。在故障转移集群设置中、当主机或主存储受到影响时、SQL服务将故障转移到二级主机、同时、二级存储将可用于提供IO。无需自动化脚本或管理员干预。</block>
  <block id="58daef667c5e83ded89d712a683c532b" category="summary">Microsoft SQL Server和SM-AS统一访问</block>
  <block id="b8c5c455d22a62b43bd58615af0a569e" category="paragraph">统一访问网络意味着主机能够访问两个站点(或同一站点中的故障域)上的路径。</block>
  <block id="fdbd6bb11fa9bf15b9e53c8f359e821c" category="list-text">如果使用SMB、则目标SVM必须是源SVM所属的同一Active Directory域的成员、以便在灾难恢复期间不会破坏NAS文件中存储的访问控制列表(ACL)。</block>
  <block id="d5a7d81e3f495111d65621aede2e26a4" category="list-text">使用与源卷名称相同的目标卷名称并不是必需的、但这样可以简化将目标卷挂载到目标的过程、使其易于管理。如果使用SMB、则必须使目标NAS命名空间与源命名空间的路径和目录结构完全相同。</block>
  <block id="4dd0779e2b7f46c37eb5ec38cdde3bb6" category="list-text">如果对快速数据恢复的需求较高、则使用同步复制；如果需要异步解决方案、则可以灵活地执行RPO。</block>
  <block id="829f5bea960b53b5f1e50e8288a740d4" category="paragraph">通过将文件组中的逻辑对象放置与物理数据库文件分隔开、您可以微调数据库文件布局、从而最大程度地利用存储子系统。支持指定工作负载的数据文件数量可以根据需要进行更改、以支持I/O要求和预期容量、而不会影响应用程序。数据库布局中的这些变化对于应用程序开发人员来说是透明的、他们将数据库对象放在文件组中、而不是数据库文件中。</block>
  <block id="df42f2a843e18c9b5f6adccba2ffcbf9" category="paragraph">在SQL Server 2016中、执行卷维护任务得到了简化、稍后在安装过程中作为一个选项提供。此图显示了为SQL Server数据库引擎服务授予执行卷维护任务权限的选项。</block>
  <block id="8c0ea2438ef8ec6eede8f5ae6996c5a0" category="paragraph">控制数据库文件大小的另一个重要数据库选项是自动缩放。启用此选项后、SQL Server会定期缩减数据库文件、减小其大小并向操作系统释放空间。此操作会占用大量资源、并且很少有用、因为新数据进入系统一段时间后、数据库文件会再次增长。不应在数据库上启用自动缩放。</block>
  <block id="58083df92a650a52d9ea6e4d544ffbd8" category="list-text">在SnapCenter将事务日志复制到的专用卷上创建主机日志目录。</block>
  <block id="42ad46ab967ef7af8287ca8a5c12f2d1" category="paragraph">下一节将介绍优化数据库性能所需的SQL Server内存设置。</block>
  <block id="4e6b5a65dde214f8e25b7adbac9c9583" category="paragraph">最大服务器内存选项用于设置SQL Server实例可以使用的最大内存量。通常、如果多个应用程序运行在运行SQL Server的同一服务器上、并且您希望保证这些应用程序具有足够的内存来正常运行、则使用此方法。</block>
  <block id="fb182faf8ee092092118e8cbb568ae0d" category="paragraph">某些应用程序仅在启动时使用可用的任何内存、而不会请求额外内存、即使它们受到内存压力也是如此。这就是最大服务器内存设置的作用所在。</block>
  <block id="c7af956e7765f16c090e0eab836fb42a" category="paragraph">使用SQL Server Management Studio调整最小或最大服务器内存需要重新启动SQL Server服务。您还可以使用Transact SQL (T-SQL)使用以下代码调整服务器内存：</block>
  <block id="0abaf38d5c4f997a2507fe6e57682b0b" category="paragraph">非一致内存访问(Nonun均匀 内存访问、NMA)是一种内存访问优化技术、有助于避免处理器总线上的额外负载。</block>
  <block id="87dfe44a851d25873ee6bd0691ac0c6e" category="paragraph">如果在安装了SQL Server的服务器上配置了NUMA、则无需进行其他配置、因为SQL Server可识别NUMA、并且在NUMA硬件上性能良好。</block>
  <block id="7cf384150f5c5317f48125af9bf68c31" category="paragraph">index create memory选项是另一个高级选项、通常不需要更改默认值。</block>
  <block id="64e199b7fb089ffb63f4c4396bac2cd1" category="paragraph">默认情况下、"每个查询的最小内存"设置会为要运行的每个查询分配&gt;=到1024KB的内存。最佳做法是、将此设置保留为默认值、以便SQL Server能够动态管理为索引创建操作分配的内存量。但是、如果SQL Server的RAM超过高效运行所需的RAM、则提高此设置可以提高某些查询的性能。因此、只要SQL Server、任何其他应用程序或操作系统未使用服务器上的可用内存、则提高此设置就可以提高SQL Server的整体性能。如果没有可用内存，则增加此设置可能会影响整体性能。</block>
  <block id="95a3a11e77f5071b2a97b611548b866c" category="paragraph">本最佳实践部分的范围仅限于根据NetApp为存储基础架构建议的原则和首选标准进行技术设计。端到端实施已超出范围。</block>
  <block id="133dcf168b09b98ab4e6c6f77a743a14" category="paragraph">有关NetApp产品的兼容性信息，请参见<block ref="18e7fcfe606d6d0912191de7fd9eb56a" category="inline-link-macro-rx"></block>。</block>
  <block id="961963c19132b001c6c7289519292be5" category="paragraph">在部署SQL Server之前、您必须了解SQL Server数据库实例支持的应用程序的工作负载要求。每个应用程序对容量、性能和可用性有不同的要求、因此每个数据库的设计都应以最佳方式支持这些要求。许多组织使用应用程序要求定义SLA、将数据库分为多个管理层。SQL Server工作负载通常按如下所述进行分类：</block>
  <block id="d748a2050ea9de15020c9f22e1c8a802" category="list-text">OLTP、通常是组织中最关键的数据库。这些数据库通常为面向客户的应用程序提供支持、并被视为公司核心运营的关键。任务关键型OLTP数据库及其支持的应用程序通常具有SLA、这些SLA要求高性能、容易受到性能下降的影响、并要求最大可用性。它们也可能是"无中断故障转移集群"或"无中断可用性"组的候选对象。这些类型数据库上的I/O混合通常表现为75%到90%的随机读取和25%到10%的写入。</block>
  <block id="542d0aad1735dc536565c8a1ec4b579f" category="list-text">决策支持系统(DSS)数据库、有时称为数据仓库。这些数据库对于许多依靠分析来开展业务的企业来说至关重要。在运行查询时、这些数据库对CPU利用率和磁盘读取操作非常敏感。在许多组织中、DSS数据库在月份、季度和年终都是最重要的此工作负载的读取I/O混合比例通常接近100%、并且IO吞吐量通常比IOPS更重要。</block>
  <block id="af2a7a153f6f4904cc7384604809cf3c" category="paragraph">SQL Server可以配置为每个服务器一个实例、也可以配置为多个实例。正确的决策通常取决于多种因素、例如服务器是用于生产还是开发、实例是否被视为对业务运营和性能目标至关重要。</block>
  <block id="8f66f557400d1222f6352dbc8811ec03" category="paragraph">共享实例配置最初可能更易于配置、但可能会导致资源被划分或锁定的问题、进而导致数据库托管在共享SQL Server实例上的其他应用程序出现性能问题。</block>
  <block id="40d6bdd2be551c4046e5ad632c4dfe71" category="paragraph">ONTAP存储解决方案与Microsoft SQL Server相结合、可以实现企业级数据库存储设计、从而满足当今最苛刻的应用程序要求。</block>
  <block id="9e020f08745f560c049f43a1b5ead190" category="paragraph">要优化基于ONTAP的SQL Server解决方案、需要了解SQL Server I/O模式和特征。为SQL Server数据库精心设计的存储布局必须支持SQL Server的性能要求、同时还必须在整体上最大限度地提高基础架构的可管理性。良好的存储布局还可以成功完成初始部署、并随着业务的增长逐步平稳地扩展环境。</block>
  <block id="9eb2f26da39e165d9e3a1c48b5798690" category="paragraph">卷会创建并驻留在聚合中。此术语有时会引起混淆、因为ONTAP卷不是LUN。ONTAP卷是数据的管理容器。卷可以包含文件、LUN甚至S3对象。卷不会占用空间、它仅用于管理包含的数据。</block>
  <block id="64999620676d7bc615f88fabe256272f" category="list-text">如果在SMB共享上安装SQL Server、请确保在SMB卷上启用Unicode以创建文件夹。</block>
  <block id="b0874893f6e3e7030833ec488dc9da90" category="list-text">将用户数据文件<block ref="937f38432beb92fdba3d47780720bdf7" prefix="(" category="inline-code"></block>()放在不同的卷上，因为它们是随机读/写工作负载。通常、创建事务日志备份的频率比创建数据库备份的频率更高。因此，请将事务日志文件<block ref="cb15b9539ae0d984ff8740c68b52561c" prefix="(" category="inline-code"></block>()放在与数据文件不同的卷或VMDK上，以便可以为每个卷或VMDK创建独立的备份计划。这种分离还会将日志文件的顺序写入I/O与数据文件的随机读/写I/O隔离开来、并显著提高SQL Server性能。</block>
  <block id="f7f1cb17ab4960f1a8e4c28a7fbccb0d" category="list-text">不要在同一LUN上混合使用数据库文件和非数据库文件、例如与全文搜索相关的文件。</block>
  <block id="58ccb3e2006ffa82c78944061df94b30" category="paragraph">ONTAP存储效率已进行优化、可存储和管理SQL Server数据、所用存储空间量最低、不会对性能产生任何影响。</block>
  <block id="6f80e9146e2184b9ec3c46b6d7dd903f" category="paragraph">如果SQL Server必须向特殊系统页面写入数据以分配新对象、则全局分配映射(GAM)、共享全局分配映射(SGAM)或页面可用空间(PFS)页面可能会发生页面争用。闩锁将这些页面锁定在内存中。在繁忙的SQL Server实例上、可能需要很长时间才能在tempdb中的系统页面上获得锁定。这会导致查询运行时间变慢、并称为闩锁争用。请参见以下创建tempdb数据文件的最佳实践：</block>
  <block id="255bd5c00b8de4b2f998369f766b2b5e" category="paragraph">本节将介绍远程数据保护、即将数据复制到远程站点以实现安全异地存储和灾难恢复。请注意、这些表不涉及同步镜像数据保护。有关此要求、请参见NetApp MetroCluster文档、包括<block ref="06d0604733fc7f7e3f9befaa1239278d" category="inline-link-macro-rx"></block>和<block ref="87f167af2516b222ddeec7405581e8b8" category="inline-link-macro-rx"></block></block>
  <block id="ad8d77efdce72d372a83929b50a127d1" category="paragraph">崩溃状态一致的数据集备份是指在一个时间点捕获整个数据集结构。如果数据集存储在单个卷中、则此过程非常简单；可以随时创建Snapshot。如果数据集跨越多个卷、则必须创建一致性组(CG)快照。创建CG快照的选项有多种、包括NetApp SnapCenter软件、本机ONTAP一致性组功能以及用户维护的脚本。</block>
  <block id="3c27a8d13352bda1e272615270d5faba" category="paragraph">崩溃状态一致的数据库备份是指在一个时间点捕获整个数据库结构、包括数据文件、重做日志和控制文件。如果数据库存储在单个卷中、则此过程非常简单；可以随时创建Snapshot。如果数据库跨越多个卷、则必须创建一致性组(CG)快照。创建CG快照的选项有多种、包括NetApp SnapCenter软件、本机ONTAP一致性组功能以及用户维护的脚本。</block>
  <block id="7589d3d0b42e170fc0a459aba0b87fd6" category="paragraph">当数据库非常大或必须尽快恢复时、最好使用VBSR、而使用VBSR需要隔离数据文件。在NFS环境中、给定数据库的数据文件必须存储在未受任何其他类型文件污染的专用卷中。在SAN环境中、数据文件必须存储在专用卷上的专用LUN中。如果使用卷管理器(包括Oracle自动存储管理[ASM])、则磁盘组还必须专用于数据文件。</block>
  <block id="d8c4de538bee7abe14d3527c343afee7" category="paragraph">如果需要双主动扩展RAC、则应考虑使用SnapMirror主动同步代替MetroCluster。SM-AS复制允许首选使用数据的特定副本。因此、可以构建一个扩展RAC集群、在该集群中、所有读取操作都在本地进行。读取I/O不会跨越站点、从而尽可能地降低延迟。所有写入活动仍必须传输站点间连接、但使用任何同步镜像解决方案时、此类流量都是不可避免的。</block>
  <block id="be6001fc2ab5bfaacf123c0267e58a0a" category="admonition">如果在Oracle RAC中使用启动LUN (包括虚拟化启动磁盘)、则可能需要更改此<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block>参数。有关RAC超时参数的详细信息，请参阅<block ref="1d616ba7dc3776fc2ecabd1cd20f420f" category="inline-link-macro-rx"></block>。</block>
  <block id="2bd32004298994cdcbc5a1672f2b8c95" category="summary">具有SnapMirror活动同步的Oracle单实例</block>
  <block id="b704207e8ec8f6bbae1764da78cb5232" category="doc">具有SnapMirror活动同步的Oracle</block>
  <block id="93c480a0b6f335159bf44fcf2e2bec93" category="paragraph">使用SnapMirror主动同步不一定会增加或更改数据库操作的任何最佳实践。</block>
  <block id="30bca7463d8c7b2108be553aabb70549" category="paragraph">最佳架构取决于业务需求。例如、如果目标是使RPO=0防止数据丢失、但RTO较宽松、则使用Oracle单实例数据库并使用SM-AS复制LUN可能足以满足Oracle许可标准的要求、而且成本更低。远程站点故障不会中断操作、丢失主站点将导致运行正常的站点上的LUN处于联机状态并可供使用。</block>
  <block id="34ff499afe445b877410a8ae3527a84f" category="paragraph">如果要对RTO进行更严格的配置、则可以通过脚本或PacMaker或Ansv可 等工具实现基本的主动-被动自动化、从而缩短故障转移时间。例如、可以对VMware HA进行配置、使其检测主站点上的VM故障、并激活远程站点上的VM。</block>
  <block id="63cededd737a118049828e08a2a7e8c7" category="paragraph">最后、为了实现极快的故障转移、可以跨站点部署Oracle RAC。RTO基本上为零、因为数据库将始终处于联机状态、并可在两个站点上使用。</block>
  <block id="5d0f4a1c768b6f8fc0a38580e17ef62b" category="summary">具有SnapMirror活动同步的Oracle扩展RAC</block>
  <block id="596d088e9c01a0ceec54de24c763f7c4" category="paragraph">许多客户通过跨站点扩展Oracle RAC集群来优化其RTO、从而形成完全主动-主动配置。整体设计变得更加复杂、因为它必须包括Oracle RAC的仲裁管理。</block>
  <block id="c128a5dcb6cee18ff198d2c48937cea1" category="paragraph">传统的扩展RAC集群模式依靠ASM镜像来提供数据保护。这种方法有效、但也需要大量手动配置步骤、并会给网络基础架构带来开销。相比之下、让SnapMirror主动同步负责数据复制可以显著简化解决方案。同步、中断后重新同步、故障转移和仲裁管理等操作更加简单、而且SAN不需要分布在多个站点上、从而简化了SAN的设计和管理。</block>
  <block id="74f82d1e2ecf05353775ddaeb38bcddd" category="paragraph">要了解SnapMirror主动同步上的RAC功能、关键在于将存储视为镜像存储上托管的一组LUN。例如：</block>
  <block id="68dcade92edf97d052fd54be2dc6b60c" category="inline-image-macro">Oracle逻辑访问</block>
  <block id="9c4d005ebe3fb148615bd62837da8194" category="paragraph"><block ref="9c4d005ebe3fb148615bd62837da8194" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b88e2c412773438221951df1b45aa00c" category="paragraph">没有主副本或镜像副本。从逻辑上讲、每个LUN只有一个副本、并且该LUN可在两个不同存储系统上的SAN路径上使用。从主机角度来看、不会发生存储故障转移、而是会发生路径更改。各种故障事件可能会导致LUN的某些路径丢失、而其他路径仍保持联机状态。SnapMirror主动同步可确保在所有操作路径中提供相同的数据。</block>
  <block id="31c1d5c6e07b5b3d11e0585af763dc13" category="paragraph">在此示例配置中、ASM磁盘的配置与企业存储上任何单站点RAC配置中的配置相同。由于存储系统提供数据保护、因此会使用ASM外部冗余。</block>
  <block id="f016e2bef75fc762898fb65f21fb9836" category="section-title">统一访问与非通知访问</block>
  <block id="c70bc2caf8d25b4a91254d72909c7e75" category="paragraph">在SnapMirror主动同步模式下使用Oracle RAC最重要的注意事项是使用统一访问还是非统一访问。</block>
  <block id="7cb7fcd446ee1d35aa27d2af5532e2ea" category="paragraph">统一访问意味着每个主机都可以看到两个集群上的路径。非一致访问表示主机只能查看本地集群的路径。</block>
  <block id="53934f78a11bd68da05d52b4f83ec9fc" category="paragraph">这两个选项都不是特别建议的、也不建议采用。有些客户可以随时使用暗光纤连接站点、而有些客户则没有这种连接、或者他们的SAN基础架构不支持远程ISL。</block>
  <block id="53772793c4bb5f4dac1c6c0eade7403c" category="section-title">非一致访问</block>
  <block id="68f708ec0a3f5091f6e432be351bf3cc" category="paragraph">从SAN的角度来看、非一致性访问更易于配置。</block>
  <block id="b923541ce3d0d3feae5be9fb6199f770" category="inline-image-macro">Oracle RAC非一致性访问</block>
  <block id="b7d64dea0436c64fbd1652575479aa68" category="paragraph"><block ref="b7d64dea0436c64fbd1652575479aa68" category="inline-image-macro-rx" type="image"></block></block>
  <block id="58dcba3041e7c7c3352e2c7f9f497eb5" category="inline-link-macro">非一致访问</block>
  <block id="52aa3a00cda7a8077552683f88c13e20" category="paragraph">此方法的主要缺点<block ref="56ad9440d84c5145567c05e340b22f93" category="inline-link-macro-rx"></block>是、站点间ONTAP连接断开或存储系统丢失将导致一个站点上的数据库实例丢失。这显然不是理想的做法、但作为交换更简单的SAN配置、这种风险可能是可以接受的。</block>
  <block id="4f7fff29e362cc56706e5fe5d34884b6" category="section-title">统一访问</block>
  <block id="df51b4c411cdf825abbf60c345b2886c" category="paragraph">统一访问要求跨站点扩展SAN。主要优势是、丢失存储系统不会导致数据库实例丢失。相反、它会导致当前正在使用的路径发生多路径更改。</block>
  <block id="bb79831252d74e631b0f64224932d6e6" category="paragraph">可以通过多种方式配置非一致性访问。</block>
  <block id="8ce82023c8f26832db1e79b32f2f7171" category="admonition">在下图中、还存在一些在简单控制器故障期间会使用的活动但非优化路径、但为了简化图示、这些路径不会显示出来。</block>
  <block id="15670c5b41a372b781730d1a2677ed57" category="section-title">具有邻近设置的AFF</block>
  <block id="e2b2f6d768064f58804cd8cb2f295266" category="paragraph">如果站点间延迟较长、则可以为AFF系统配置主机邻近设置。这样、每个存储系统就可以了解哪些主机是本地主机、哪些主机是远程主机、并相应地分配路径优先级。</block>
  <block id="5ffb901a29d38d4d4f7c462ffbd0ad7f" category="inline-image-macro">具有统一访问的RAC</block>
  <block id="efdefb56bfdac6f3b9194f8ce94b9ae9" category="paragraph"><block ref="efdefb56bfdac6f3b9194f8ce94b9ae9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e106da7d1088531e38324a9d76b9a988" category="paragraph">在正常操作下、每个Oracle实例都会优先使用本地主动/优化路径。这样、所有读取操作都将由块的本地副本处理。这样可以尽可能地降低延迟。写入IO也会通过路径向下发送到本地控制器。在确认之前、仍然必须复制IO、因此、通过站点到站点网络仍会产生额外的延迟、但在同步复制解决方案中无法避免这种情况。</block>
  <block id="889ea87800d5947e36cda77f7d1b16b4" category="section-title">不带邻近设置的ASA / AFF</block>
  <block id="a92e6cf0c610f6072564d047ffa516be" category="paragraph">如果站点之间没有明显延迟、则可以在不配置主机邻近设置的情况下配置AFF系统、也可以使用ASA。</block>
  <block id="7760495be1250342ca752bb9cdc684ee" category="paragraph"><block ref="7760495be1250342ca752bb9cdc684ee" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6bad71277bac94b02b8ad4267095b9e1" category="paragraph">每个主机都可以使用两个存储系统上的所有操作路径。这样、每个主机就可以利用两个集群(而不仅仅是一个集群)的性能潜能、从而显著提高性能。</block>
  <block id="56473d7f95c121dd938752e3ee76807e" category="paragraph">使用ASA时、不仅会将两个集群的所有路径视为活动路径并进行了优化、而且配对控制器上的路径也会处于活动状态。结果将始终是整个集群上的全活动SAN路径。</block>
  <block id="22ede275964a6c559bc3f8f6d60e47ff" category="admonition">ASA系统也可用于非统一访问配置。由于不存在跨站点路径、因此IO跨越ISL不会对性能产生任何影响。</block>
  <block id="263e6bb36868a481a8831ae728712452" category="summary">Oracle SnapMirror活动同步</block>
  <block id="d1864442faf9b87db487ba86c72892a9" category="paragraph">下面的示例介绍了使用SnapMirror活动同步复制部署Oracle单实例数据库的许多选项中的一些选项。</block>
  <block id="1bd45bc28deaa95af95dd782d94963fa" category="inline-image-macro">具有非一致访问的Oracle SI</block>
  <block id="c94bc93663b0f709f6a6885553fe9153" category="paragraph"><block ref="c94bc93663b0f709f6a6885553fe9153" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b29b2b92ebd168fbb013ea878c5c1075" category="paragraph">SnapMirror主动同步可为灾难恢复站点上的数据提供同步副本、但要使数据可用、需要使用操作系统和相关应用程序。基本自动化可以显著缩短整个环境的故障转移时间。通常会使用PacMaker等集群软件产品在站点间创建集群、在许多情况下、可以使用简单的脚本来执行故障转移过程。</block>
  <block id="1e953e50c45ead229eae67ed609a3a1e" category="paragraph">如果主节点丢失、则集群软件(或脚本)将使备用站点上的数据库联机。一种选择是、创建为构成数据库的SAN资源预先配置的备用服务器。如果主站点发生故障、则集群软件或脚本化备用站点将执行一系列类似以下内容的操作：</block>
  <block id="861373097ad1daff7221c81f1ffb8bd2" category="list-text">检测主站点故障</block>
  <block id="471eb645214523a67e69f308fd203df5" category="list-text">发现FC或iSCSI LUN</block>
  <block id="aaae9cdb1dc3caf850c21cbae6cb7dd9" category="paragraph">实际激活操作步骤非常简单。LUN发现等命令只需对每个FC端口执行几个命令即可。文件系统挂载只不过是一个<block ref="19822b1b15d9eefc54c07ab49f87b100" prefix=" " category="inline-code"></block>命令、数据库和ASM都可以通过命令行界面使用一个命令来启动和停止。</block>
  <block id="81760e5cf8ff0457c9927339fe0d7987" category="list-text">手动启动数据库或将虚拟机配置为自动启动数据库。</block>
  <block id="17ad404af9b36204bcadadd073042e1c" category="paragraph">例如、ESX集群可以跨越多个站点。发生灾难时、可以在切换后将灾难恢复站点上的虚拟机置于联机状态。</block>
  <block id="06c019e625f0595de8528ac88cab1815" category="section-title">存储故障保护</block>
  <block id="0559887c95614fe388b0dc7f8914a2db" category="paragraph">上图显示了的使用<block ref="56ad9440d84c5145567c05e340b22f93" category="inline-link-macro-rx"></block>，其中SAN不会跨站点延伸。这可能更易于配置、在某些情况下、这可能是当前SAN功能的唯一选项、但也意味着主存储系统故障将导致数据库中断、直到应用程序进行故障转移为止。</block>
  <block id="5cbfe7798787ccd0e92fcaceca503314" category="inline-link-macro">统一访问</block>
  <block id="38a1b98129ec5892c90cdda2967b957c" category="paragraph">为了提高故障恢复能力，可以使用部署该解决方案<block ref="8c3bdda17267bf34dafd546406201d13" category="inline-link-macro-rx"></block>。这将允许应用程序使用从另一站点广告的路径继续运行。</block>
  <block id="d77ca8b041bbb54326491bb1aeb6fadf" category="doc">Oracle和SnapMirror活动同步—RAC Tieb破碎 机</block>
  <block id="084a4c8d8d6223c9b3c0749a4097bf8f" category="paragraph">虽然使用SnapMirror主动同步的扩展RAC在IO方面是对称架构、但有一个例外情况是连接到脑裂管理。</block>
  <block id="f0dd83fae83b5ba13b4e8c760578f47f" category="paragraph">如果复制链路丢失且两个站点都没有仲裁、会发生什么情况？应该发生什么？此问题既适用于Oracle RAC、也适用于ONTAP行为。如果无法在各个站点之间复制更改、而您希望恢复操作、则其中一个站点必须继续运行、而另一个站点必须不可用。</block>
  <block id="58dc7db50a2e11a9de9e6cc092c59d4d" category="inline-link-macro">ONTAP 调解器</block>
  <block id="406abe933a832eefeb56c0390b824200" category="paragraph"><block ref="6663df057ff17bcadb83516e8fd742b7" category="inline-link-macro-rx"></block>可在ONTAP层满足此要求。RAC分Tieb破碎 功能有多个选项。</block>
  <block id="1a7cedbe5066c42f7f901bffc7905f59" category="section-title">Oracle Tieburkers</block>
  <block id="236ca78f8e5b54033dbbd133abe79e60" category="paragraph">管理脑裂Oracle RAC风险的最佳方法是使用奇数个RAC节点、最好使用第三个站点的Tieb破碎 机。如果第三个站点不可用、则可以将Tieb破碎 机实例放置在两个站点中的一个站点上、从而有效地将其指定为首选的幸存站点。</block>
  <block id="af70ccf0217a2356d2bcebb6fab5a25b" category="section-title">Oracle和CSS_critical</block>
  <block id="e7c7cde013ca0177a945b339ca49fe1d" category="paragraph">如果节点数为偶数、则默认Oracle RAC行为是、集群中的一个节点将被视为比其他节点更重要。具有较高优先级节点的站点将不受站点隔离的影响、而另一站点上的节点将被逐出。优先级基于多个因素、但您也可以使用设置来控制此行为<block ref="6124b1cbe711d49d95a1c41d4e2701b4" prefix=" " category="inline-code"></block>。</block>
  <block id="1a79a4d60de6718e8e5b326e338ae533" category="inline-link-macro">示例</block>
  <block id="6ae35dd8ffe888ab910de0d5d5e3a45a" category="paragraph">在该架构中<block ref="0a286933b98d5160dd3059338d9fd4c7" category="inline-link-macro-rx"></block>、RAC节点的主机名是jfs12和jfs13。的当前设置<block ref="6124b1cbe711d49d95a1c41d4e2701b4" prefix=" " category="inline-code"></block>如下：</block>
  <block id="d05ceaa3e91a5aa94cbe7a8ac83ad048" category="paragraph">如果要将带有jfs12的站点作为首选站点、请在站点A节点上将此值更改为yes、然后重新启动服务。</block>
  <block id="d7e25fc2f6769b17d752bc3cde6d0266" category="summary">Oracle和SnapMirror主动同步故障转移</block>
  <block id="f0972b46fa5671c4841c63750ccdebb9" category="doc">SnapMirror active sync—丢失Oracle RAC复制</block>
  <block id="8a6c7e7b423c27776aad808ff121ced3" category="paragraph">丢失Oracle RAC复制链路会产生与丢失SnapMirror连接类似的结果、只是默认情况下超时时间较短。在默认设置下、Oracle RAC节点在丢失存储连接后将等待200秒后才会被逐出、但在丢失RAC网络检测信号后只会等待30秒。</block>
  <block id="488bd272072f6a962dc0b8f69fc362b8" category="paragraph">CRS消息与以下所示类似。您可以看到30秒的超时时间。由于在位于站点A的jfs12上设置了css_critical,因此该站点将继续运行,而站点B上的jfs13将被逐出。</block>
  <block id="80f8fcffb7c608c6d25e68111eb38b2d" category="summary">Oracle和SnapMirror活动同步—手动故障转移</block>
  <block id="0d97f4e7841f881ee429033c005d63ef" category="paragraph">术语"故障转移"并不是指使用SnapMirror活动同步进行复制的方向、因为它是一种双向复制技术。相反、"故障转移"是指发生故障时、哪个存储系统将成为首选站点。</block>
  <block id="669420d9776c5672f6a1edf3bbf41604" category="paragraph">例如、您可能希望在关闭站点进行维护之前或执行灾难恢复测试之前执行故障转移以更改首选站点。</block>
  <block id="1a5cda38e5f45bb47ad55cae28a62d58" category="paragraph">GUI示例：</block>
  <block id="dd8c4d4a8c7db09b331d019e9ba3a643" category="inline-image-macro">SM-AS首选站点的SystemManager剪辑</block>
  <block id="50925d08482582f6a3178736557a9d6c" category="paragraph"><block ref="50925d08482582f6a3178736557a9d6c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="beecd91de8185d21ecef9d430e18d4dc" category="paragraph">通过命令行界面将其更改回的示例：</block>
  <block id="3877a64f9dbc63cfbdca7e30e66c42a2" category="summary">Oracle和SnapMirror活动同步-调解器失败</block>
  <block id="9daff60ceba391d4160d5e54f14037d8" category="paragraph">调解器服务不直接控制存储操作。它可用作集群之间的备用控制路径。它主要用于自动执行故障转移、而不存在脑裂情况的风险。</block>
  <block id="13ce4a149213a3a389210201d2850f7c" category="paragraph">在正常操作下、每个集群都会将更改复制到其配对集群、因此、每个集群都可以验证配对集群是否联机并提供数据。如果复制链路失败、复制将停止。</block>
  <block id="381c63e25d0de40f5be6677aa1346b0e" category="paragraph">安全自动化操作需要调解器的原因是、否则存储集群将无法确定双向通信丢失是网络中断还是实际存储故障所致。</block>
  <block id="e51e3b7c6dff02b4ab76ceab7b000eb8" category="list-text">复制服务因任何原因出现故障都会导致首选站点释放RPO = 0状态、并恢复读写IO处理。非首选站点将使其路径脱机。</block>
  <block id="957e90f10d8268ba74dc866bec3ed2fa" category="doc">SnapMirror active sync—连接完全断开</block>
  <block id="4470e5dd55a8a6253ccfd5dca462e193" category="paragraph">如果站点之间的复制链路完全丢失、则SnapMirror活动同步和Oracle RAC连接都将中断。</block>
  <block id="cd48b65842aa3ca6718bf9d05c82a272" category="paragraph">Oracle RAC脑裂检测依赖于Oracle RAC存储检测信号。如果丢失站点间连接导致RAC网络检测信号和存储复制服务同时丢失、则RAC站点将无法通过RAC互连或RAC投票磁盘进行跨站点通信。如果节点数为偶数、则可能会在默认设置下逐出这两个站点。具体行为取决于事件顺序以及RAC网络和磁盘检测信号轮询的时间。</block>
  <block id="d76ecbc1eb83c7a69064a5bb857c85c9" category="inline-link-macro">Tieb破碎 机</block>
  <block id="acef32b29f0767a38d288d2517fd82e4" category="paragraph">双站点中断的风险可以通过两种方式来解决。首先、<block ref="5eea39840e87052aa3c632ea60116716" category="inline-link-macro-rx"></block>可以使用配置。</block>
  <block id="f52f16ab0735aaefebdd18f6be0a1d9a" category="paragraph">如果第三个站点不可用、则可以通过调整RAC集群上的mscount参数来解决此风险。在默认设置下、RAC网络检测信号超时为30秒。RAC通常会使用此方法来确定发生故障的RAC节点并将其从集群中删除。它还可以连接到投票磁盘检测信号。</block>
  <block id="c2b5462b64e9fc5a5b57a31b233c8857" category="paragraph">例如、如果反铲切断了承载Oracle RAC和存储复制服务的站点间流量的管道、则会开始30秒的错误计数倒计时。如果RAC首选站点节点无法在30秒内与另一站点重新建立联系、并且也无法使用投票磁盘在同一30秒窗口内确认另一站点已关闭、则首选站点节点也将被清除。结果是数据库完全中断。</block>
  <block id="db651e89ed200f74c11c1ae1c5d2b32d" category="paragraph">根据发生错误计数轮询的时间、30秒可能不足以使SnapMirror活动同步超时并允许首选站点上的存储在30秒窗口到期之前恢复服务。这30秒的窗口时间可以增加。</block>
  <block id="dbdaf8435bc0aa414eca4876e6c308d2" category="paragraph">此值允许首选站点上的存储系统在错误计数超时过期之前恢复操作。这样、只会逐出已删除LUN路径的站点上的节点。以下示例：</block>
  <block id="e231fb490ed068ec9b23beb7dd95220e" category="paragraph">Oracle支持部门强烈建议您不通过更改msscount或disktimeout参数来解决配置问题。但是、在许多情况下、包括SAN启动、虚拟化和存储复制配置、更改这些参数是有保证的、也是不可避免的。例如、如果您的SAN或IP网络出现稳定性问题、导致RAC逐出、则应修复底层问题、而不对msscount或disktimeout值收费。更改超时以解决配置错误会掩盖问题、而不会解决问题。根据底层基础架构的设计方面更改这些参数以正确配置RAC环境的做法有所不同、并且与Oracle支持声明一致。在SAN启动中、通常会将Msscount调整为最大200、以匹配磁盘超时。有关更多信息、请参见<block ref="ba774c2123df7855b7691ef15a557a8c" category="inline-link-macro-rx"></block>。</block>
  <block id="cb5f127f654db8aa1847f5e9e6c5118e" category="summary">Oracle和SnapMirror活动同步—服务还原</block>
  <block id="894265e54aece56ce813211a980cdfe2" category="paragraph">SnapMirror可以自行恢复。SnapMirror主动同步将自动检测复制关系是否存在故障、并将其恢复到RPO = 0状态。重新建立同步复制后、路径将再次联机。</block>
  <block id="c512ae64a9e9927a6314fdd926760a72" category="paragraph">在许多情况下、集群模式应用程序会自动检测故障路径的返回情况、这些应用程序也会恢复联机。在其他情况下、可能需要进行主机级SAN扫描、或者可能需要手动将应用程序恢复联机。</block>
  <block id="c83e8f0dcd2a1773693ac06c752f2ddd" category="paragraph">这取决于应用程序及其配置方式、通常、此类任务可以轻松实现自动化。SnapMirror主动同步本身可以自行修复、在电源和连接恢复后、不需要任何用户干预即可恢复RPO = 0存储操作。</block>
  <block id="b55bb91b49684d644a2314af260f5584" category="doc">采用SnapMirror主动同步的Oracle示例架构</block>
  <block id="8ba2bb4ebd97f28e7d98a180d8b06c1a" category="paragraph">本节中显示的详细故障示例基于下面所示的架构。</block>
  <block id="5d10516d162cd9f09cf5dc249d499836" category="admonition">这只是SnapMirror主动同步上的Oracle数据库的众多选项之一。之所以选择此设计、是因为它展示了一些更复杂的情形。</block>
  <block id="ce2a1d07c1660eb99608e2aeb9ffda20" category="inline-link-macro">首选站点</block>
  <block id="93d235b3b3adb1fcc631cc9720911156" category="paragraph">在此设计中，假设站点A设置在<block ref="0a07e9e6141ed78f0b7013768c76c4a9" category="inline-link-macro-rx"></block>。</block>
  <block id="3f35d87b783da3d0c6ab04c2222e88cc" category="inline-image-macro">基于SM-AS设计的示例Oracle</block>
  <block id="65d5312cbb5d7497db9571af7d19e76d" category="paragraph"><block ref="65d5312cbb5d7497db9571af7d19e76d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="af82c537bd0f6778b9916dc78da8c55a" category="paragraph">存储系统或站点故障的结果与丢失复制链路的结果几乎相同。正常运行的站点应在写入时发生大约15秒的IO暂停。15秒过后、IO将照常在该站点上恢复。</block>
  <block id="24f2945a7c742e126cdf5dcdfb08ec89" category="paragraph">如果仅存储系统受到影响、则故障站点上的Oracle RAC节点将丢失存储服务、并在逐出和后续重新启动之前输入相同的200秒磁盘超时时间。</block>
  <block id="0cff2ae5f5c305f11d8d8a333bd1da2c" category="paragraph">丢失存储服务的RAC节点上的SAN路径状态如下所示：</block>
  <block id="e33921fb5e166f433573176882c09294" category="paragraph">Linux主机检测到路径丢失的速度比200秒快得多、但从数据库角度来看、在默认Oracle RAC设置下、与故障站点上主机的客户端连接仍会冻结200秒。只有在逐出完成后、才会恢复完整数据库操作。</block>
  <block id="db34db4ac9bd7910a9eded83e1ff30f9" category="paragraph">同时、另一站点上的Oracle RAC节点将记录另一个RAC节点的丢失情况。否则，它将继续照常运作。</block>
  <block id="ad08bdae586fc05e13eff6bd6d9f0ee2" category="paragraph">如果SnapMirror活动同步复制链路无法完成写入IO、因为集群无法将更改复制到相反站点。</block>
  <block id="564a95e2696af68aa1c3a4953ecd1ce9" category="section-title">站点 A</block>
  <block id="18fe52a46fad1fa4c9873ea81b6e885f" category="paragraph">在站点A上、复制链路发生故障会导致写入IO处理暂停大约15秒、因为ONTAP会在确定复制链路确实无法运行之前尝试复制写入。15秒后、站点A上的ONTAP集群将恢复读写IO处理。SAN路径不会更改、LUN将保持联机状态。</block>
  <block id="657e60cc43634129c8f9314afdd5c48b" category="paragraph">复制链路在时间戳15：19：44处断开。当200秒超时(由Oracle RAC参数disktimeout控制)接近时、Oracle RAC发出的第一条警告会在100秒后到达。</block>
  <block id="f29d4b902de1f9de93b8673047367cb3" category="paragraph">达到200秒表决磁盘超时时间后、此Oracle RAC节点将从集群中退出并重新启动。</block>
  <block id="b864ca7c3ca6173547e4a66ba059c688" category="summary">Oracle、SM-AS、活动同步、调解器</block>
  <block id="01682ebdcacbc827e3ef8083e7b4c060" category="summary">Oracle和SM-AS非一致性访问</block>
  <block id="f6dbb06140585fe45ddeaf49cae9418e" category="summary">Oracle和SnapMirror活动同步</block>
  <block id="d6e7dde9799f39cece01cbc4b2728cdf" category="paragraph">通过SnapMirror主动同步、您可以构建超高可用性Oracle数据库环境、其中LUN可从两个不同的存储集群访问。</block>
  <block id="13645bda5e7e84c7e547caee4c6325b2" category="paragraph">使用SnapMirror主动同步时、不存在数据的"主"和"二级"副本。每个集群都可以从其本地数据副本提供读取IO、并且每个集群都会向其配对集群复制写入。结果是对称IO行为。</block>
  <block id="36b94662a6696bbaee0152aefe40ed13" category="paragraph">除其他选项外、此选项还允许您将Oracle RAC作为扩展集群运行、并在两个站点上运行操作实例。或者、您也可以构建RPO = 0主动-被动数据库集群、在站点中断期间、可以在站点间移动单实例数据库、并且可以通过Pacemker或VMware HA等产品自动执行此过程。所有这些选项的基础都是由SnapMirror主动同步管理的同步复制。</block>
  <block id="d1a363496283d60774ff9c9c51ffe653" category="paragraph">在正常操作下、SnapMirror主动同步始终提供RPO = 0的同步副本、但有一个例外。如果无法复制数据、则ONTAP将不再需要复制数据并恢复在一个站点上提供IO、而另一个站点上的LUN将脱机。</block>
  <block id="72f31f711b37dc7ce7b34e00dd56b5ae" category="paragraph">ONTAP调解器是从NetApp支持下载的软件应用程序、通常部署在小型虚拟机上。与SnapMirror活动同步结合使用时、ONTAP调解器不是Tieb破碎 器。它是参与SnapMirror活动同步复制的两个集群的备用通信通道。ONTAP根据通过直接连接和调解器从合作伙伴处收到的响应来推动自动化操作。</block>
  <block id="b06e5b68abe4f23a716133f1fa1a4472" category="summary">Oracle和SM-AS首选站点</block>
  <block id="6d14548094c3b2a5b0a69049f8497fa8" category="doc">Oracle和SM-AS统一访问</block>
  <block id="36ba939f32969ddc6751427944e3569d" category="paragraph">最重要的要求是将数据文件隔离到一个或多个专用卷中。它们必须未受任何其他文件类型的污染。其原因是、要确保数据文件复制完全独立于其他数据类型(如归档日志)的复制。有关文件布局的其他信息以及有关确保存储布局便于快照的重要详细信息，请参见<block ref="c87a7212960b8cc2aca49adb1795e291" category="inline-link-macro-rx"></block>。</block>
  <block id="64c93f87be857cf43f66e341a377693a" category="paragraph">操作系统可以检测到<block ref="9ad16912cc0ba54a259b1a15d233c264" prefix=" " category="inline-code"></block>和<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>位于同一个卷上、即同一个源文件系统。然后、操作系统会使用相同的设备句柄来访问数据。这样做可以改进操作系统缓存和某些其他操作的使用、但会干扰DNFS。如果DNFS必须访问文件(如上的<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>)<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block>，它可能会错误地尝试使用错误的数据路径。结果是I/O操作失败。在这些配置中、请将挂载选项添加<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block>到与该主机上的另一个NFS文件系统共享源卷的任何NFS文件系统。这样做会强制Linux操作系统为该文件系统分配独立的设备句柄。</block>
  <block id="30d0582d4c5a0b280454304dcff9c28f" category="paragraph">Solaris 11对其处理大型I/O操作的方式进行了更改、这可能会导致SAN存储阵列出现严重的性能问题。此问题已记录在NetApp跟踪错误报告“Solaris 11 ZFS性能回归”中。</block>
  <block id="c041cd46ed4caba0947ab494ac5bb1d9" category="paragraph">这不是ONTAP错误。这是Solaris缺陷、根据Solaris缺陷7199305和7082975进行跟踪。</block>
  <block id="a83650b3549679a1591275f0f9cd38e0" category="paragraph">您可以咨询Oracle支持部门、了解您的Solaris 11版本是否受到影响、也可以更改为较小的值来测试解决方法<block ref="954f82599f7db0212a28fd448e03bdf3" prefix=" " category="inline-code"></block>。</block>
  <block id="65711e429e82120028dff2df28b4b92d" category="paragraph">为此、您可以以root用户身份运行以下命令：</block>
  <block id="f0eff8c4d89b44c0cf8b8c323abeaa20" category="paragraph">如果需要脱机进程、请延迟重新发现或重新启动服务、直到命令指示所有迁移均已成功完成为止<block ref="1ab15ef2c245a4434fcea3cc3149f4f4" prefix=" " category="inline-code"></block>。然后，您可以按中所述完成迁移过程<block ref="bfe85b0236d22bff0d0d13e4e3fecb98" category="inline-link-macro-rx"></block>。</block>
  <block id="dbd3f1a817d137c052ec01ef60940131" category="inline-link">ONTAP 外部 LUN 导入文档</block>
  <block id="1e63fd2b99b2fef1f5d2ae61ebd5b4a3" category="paragraph">NetApp中介绍了使用FLI迁移SAN资源的过程<block ref="3a5bd22edab525577a3f095f01c2551b" category="inline-link-rx"></block>。</block>
  <block id="4fc57ef291a6bc6be0f3f8c81e4f9b44" category="paragraph">以下流程图显示了最适合迁移路径的注意事项类型。您可以右键单击图像并在新选项卡中打开它、以提高可读性。</block>
  <block id="17ed98f652bb960b10b3357e44785f38" category="inline-image-macro">迁移流程图</block>
  <block id="f420007a3c90420b30780388a0e05dbc" category="paragraph"><block ref="6ee66f70cd2b82e9dd03128a50a38de9" category="inline-image-macro-rx" type="image"></block>(英文)</block>
  <block id="fb3e908ec44ab0657a364e90a649adee" category="admonition">有关可能会产生异常结果的Linux特定DNFS问题、请参见中的<block ref="6ada863f3548cecdf5d7a06e9c4201cd" category="inline-link-macro-rx"></block>注释<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block>。</block>
  <block id="baeaebf1ec4083a8b5a2278617a67479" category="paragraph">另请参见一节中有关压缩块对齐的讨论<block ref="936e7f76dd05eeca0e082776361dee38" category="inline-link-macro-rx"></block>。与8 KB压缩块边界对齐的任何布局也与4 KB边界对齐。</block>
  <block id="0452707f6213531bbf4f41e5f16cdead" category="paragraph">克隆可以通过多种机制卸载到运行ONTAP的系统、通常是在虚拟机、VVOL或 数据存储库级别。其中包括：</block>
  <block id="a4ec3dfc79c8493b1e9fcaee6b06b5a8" category="summary">ONTAP广泛支持混合云。</block>
  <block id="14f3c0fa1399e57b5998b528cc5f3515" category="paragraph">ONTAP是企业级横向扩展NAS阵列、其中包括许多功能。ONTAP支持VMware vSphere从许多ESXi主机并发访问NFS连接的数据存储库、远远超出了对VMFS文件系统施加的限制。将NFS与vSphere结合使用可提供一些易用性和存储效率可见性优势、如一节中所述<block ref="72b655a9973dbed02099f5e63762d591" category="inline-link-macro-rx"></block>。</block>
  <block id="ef7f5a0b4e0866202a92874cc85a2fd2" category="list-text">需要更仔细迁移的虚拟机包括使用连接存储的数据库和应用程序。一般情况下、请考虑使用应用程序的工具来管理迁移。对于 Oracle ，请考虑使用 RMAN 或 ASM 等 Oracle 工具迁移数据库文件。有关详细信息、请参见<block ref="74eec9db95a0d18126c677c2dcc1d6f1" category="inline-link-rx"></block> 。同样，对于 SQL Server ，请考虑使用 SQL Server Management Studio 或 NetApp 工具，例如适用于 SQL Server 的 SnapManager 或 SnapCenter 。</block>
  <block id="8c796e9ce33123891311630e9843b227" category="paragraph">在运行ONTAP的系统上使用vSphere时、配置网络设置非常简单、与其他网络配置类似。需要考虑以下几点：</block>
  <block id="66149c951df015fb5f7aa252fa92bf64" category="paragraph">在运行ONTAP的系统上使用vSphere时、配置网络设置非常简单、与其他网络配置类似。</block>
  <block id="bfcd75cb17a665212ae0889e787a7330" category="paragraph">运行ONTAP的系统可以使用存储服务质量(QoS)功能来限制不同存储对象(例如文件、LUN、卷或整个SVM)的吞吐量(以MBps和/或每秒I/O数(IOPS)为单位)。</block>
  <block id="5c60617d5730a7a614bfa0383a2affbd" category="admonition">这不适用于此类卷。</block>
  <block id="b78488659ce8aad3288a0ad7f27c84fb" category="admonition">vvol需要使用适用于VMware vSphere的ONTAP工具、该工具可用作适用于ONTAP的VASA Provider。请参见<block ref="2486a36e844a24e9d1cf22351b1f1514" category="inline-link-macro-rx"></block>、了解有关此类卷的最佳实践。</block>
  <block id="58da89a03db394d8f73b6516f5a75882" category="paragraph">ONTAP服务质量(QoS)和VMware vSphere存储I/O控制(SIO)是两项相辅相成的技术、vSphere和存储管理员可以结合使用这些技术来管理运行ONTAP的系统上托管的vSphere VM的性能。每个工具都有自己的优势，如下表所示。由于 VMware vCenter 和 ONTAP 的作用域不同，因此某些对象可以由一个系统查看和管理，而不能由另一个系统查看和管理。</block>
  <block id="bf0dee50832ba16a28008161612fd476" category="paragraph">ONTAP通过简化的软件定义方法统一存储、实现安全高效的管理、提高性能和无缝可扩展性。这种方法可增强数据保护并有效利用云资源。</block>
  <block id="a6848cf51eef6140971685faf5c7a111" category="paragraph">在 vSphere 环境中，这种方法还可能意味着为虚拟桌面基础架构 (VDI) 和虚拟服务器基础架构（ VSI ）提供一个统一的系统。与传统企业阵列相比、运行ONTAP的系统在VSI方面的成本通常较低、但具有高级存储效率功能、可以在同一系统中处理VDI。ONTAP 还统一了从 SSD 到 SATA 的各种存储介质，并可轻松地将其扩展到云。无需购买一个闪存阵列即可实现高性能、一个SATA阵列可用于归档、而单独的系统则可用于云。ONTAP 将所有这些问题联系在一起。</block>
  <block id="3a5159fa23e450460f03e5a885a6c51c" category="paragraph">*[注释]</block>
  <block id="d235766de3bd77aa4983181862c135d7" category="admonition">在这种情况下、MetroCluster的行为没有变化、所有数据存储库在其各自的站点中仍保持完好。</block>
  <block id="14d627875de76f84985b8a3b27c96633" category="list-text">在此期间、虚拟机I/O操作不会受到影响、但性能会下降、因为数据是通过ISL链路从远程磁盘架访问的。</block>
  <block id="290cbdcb6abb203d45786213f3c43662" category="admonition">在此期间、虚拟机将保持运行状态、并且MetroCluster行为在此情形下不会发生任何变化。所有数据存储库在其各自的站点中仍保持完好。</block>
  <block id="9a18dc3c2c9a217a632ca45b5b93a004" category="admonition">只有在布局管理器找到合适的存储之后、HA主节点才会开始尝试重新启动、因此、如果站点完全发生故障、则可能会在执行切换后发生。</block>
  <block id="e3f530e977d74053c6d70eb84886e756" category="sidebar">Epic</block>
  <block id="faeaec9eda6bc4c8cb6e1a9156a858be" category="sidebar">可用性</block>
  <block id="4289ad5c614f8037a8810e869b56facd" category="sidebar">整合</block>
  <block id="bc967dc2d57e6eff184a821bf7577a80" category="sidebar">扩展</block>
  <block id="86a69bd2f501f95ed83bb7014fac7e30" category="sidebar">快照和克隆</block>
  <block id="58bc025e75c4b3fd1adf3ea672dd4424" category="sidebar">经典架构和设计</block>
  <block id="92672a7a2b909945fbfa9f44f057c7a1" category="sidebar">规模估算</block>
  <block id="41b36522e1e1020bad35b072e2f4caeb" category="sidebar">存储要求</block>
  <block id="ddb04c3c1835c48b34dced1c453450e9" category="sidebar">配置和最佳实践</block>
  <block id="3e23b54348b2b8424e24a426570dc9f2" category="sidebar">Host Utilities</block>
  <block id="6e19e43ad6dccde81e8d288a0c9ce380" category="sidebar">LUN和卷配置</block>
  <block id="a2ddb4431dcf2a898d386c1f3b82c926" category="sidebar">文件服务</block>
  <block id="9985b4390c40137573e6da05caf85874" category="sidebar">协议</block>
  <block id="894445e8ea6df545bfbc4247797a2162" category="sidebar">存储规模估算</block>
  <block id="051c025eb3cc7303bf3116bffdb7e95d" category="sidebar">MetroCluster架构</block>
  <block id="a1930436e8ea74adaf54ff76d868829b" category="sidebar">SQL Server与MetroCluster</block>
  <block id="33673f825b847c6610f7c7115da0bbde" category="sidebar">首选站点</block>
  <block id="57848b20be1bd330229089d2e136d982" category="sidebar">网络拓扑</block>
  <block id="3a1c15502275494d5a57fe7f225fa951" category="sidebar">使用SM-AS的SQL Server</block>
  <block id="e30da740afd1eb5c7fc5ade391ee694d" category="sidebar">Oracle配置</block>
  <block id="3d9396f3fc3010d09439c0c007a897aa" category="sidebar">Oracle单个实例</block>
  <block id="87e1ed5a71c4eb8ff653400f9dd917a0" category="sidebar">Oracle RAC和Tieburkers</block>
  <block id="4a1483b5d5deb83e67e3184b05202d31" category="sidebar">架构示例</block>
  <block id="8b7786259860e64596ef2df3349d25e1" category="sidebar">RAC互连故障</block>
  <block id="d65b736af70982866f4f95287faab7ac" category="sidebar">SnapMirror通信失败</block>
  <block id="9b7da52d3b31b3d0a034473609a069e5" category="sidebar">网络互连总故障</block>
  <block id="1163a74136e40a05bc320e61f567a4df" category="sidebar">站点故障</block>
  <block id="29a8ec19326654cdf89bb8516725720a" category="sidebar">调解器故障</block>
  <block id="38ea1deaf691187fc38ab915566310c5" category="sidebar">出现故障后恢复服务</block>
  <block id="9132b772b1437e64c8acac2be79a7a0f" category="sidebar">手动故障转移</block>
  <block id="05b66cacce7105ad4a548ef5054997f0" category="doc">邻近设置</block>
  <block id="eccafd14420b568fff639755b251d1bd" category="paragraph">接近是指每个集群的配置、表示特定主机WWN或iSCSI启动程序ID属于本地主机。这是配置LUN访问的第二个可选步骤。</block>
  <block id="d99ea4fad7d0a9010283969d9ddf89aa" category="paragraph">第一步是常规的igrop配置。每个LUN都必须映射到一个igrop、该igrop包含需要访问该LUN的主机的wwn/iSCSI ID。此选项用于控制哪个主机对LUN具有_access_访问权限。</block>
  <block id="bba32ce1a7b85dd9ba50c49b1a53fe4c" category="paragraph">第二个可选步骤是配置主机邻近性。这不控制访问、而是控制_priority_。</block>
  <block id="98271aec6138a28e374c8f3724a535b6" category="paragraph">例如、可以将站点A的主机配置为访问受SnapMirror活动同步保护的LUN、并且由于SAN跨站点扩展、因此可以使用站点A上的存储或站点B上的存储为该LUN提供路径</block>
  <block id="81959299f52ddb567fd902f3e1ae5311" category="paragraph">如果没有邻近设置、则该主机将平等使用这两个存储系统、因为这两个存储系统都会公布主动/优化路径。如果站点之间的SAN延迟和/或带宽有限、则可能无法实现这一点、您可能希望确保在正常操作期间、每个主机优先使用指向本地存储系统的路径。这可通过将主机的wwn/iSCSI ID作为近端主机添加到本地集群来配置。可通过命令行界面或SystemManager完成此操作。</block>
  <block id="f08670cf73640d447fb34d01b0f6418f" category="paragraph">对于AFF系统、配置主机邻近性后、路径将如下所示。</block>
  <block id="85a2564342597a065a3926228b7e9fcd" category="paragraph">可以将SQL Server配置为以多种方式与SnapMirror活动同步配合使用。正确答案取决于可用的网络连接、RPO要求和可用性要求。</block>
  <block id="d60999416cfb11e4fa51f3dbe7386d64" category="paragraph">SM-AS和MetroCluster在整体功能上相似、但在实施RPO = 0复制的方式及其管理方式上存在重要差异。SnapMirror异步和同步也可用作灾难恢复计划的一部分、但它们不是作为HA回配技术而设计的。</block>
  <block id="e122442a5a5728cd45ffc4ddd170a36f" category="list-text">MetroCluster配置更像是一个集成集群、其中的节点分布在各个站点之间。SM-AS的行为类似于两个其他方面独立的集群、它们合作提供选定的RPO = 0同步复制的LUN。</block>
  <block id="dbbbd9519f58f000ae618fd3a3f2f38c" category="list-text">在任何给定时间、只能从一个特定站点访问MetroCluster配置中的数据。另一个数据副本位于另一个站点上、但数据是被动的。如果没有存储系统故障转移、则无法访问它。</block>
  <block id="72d2ba33caf4a678d0b02c7a4a562662" category="list-text">MetroCluster和SM-AS执行镜像在不同级别进行。MetroCluster镜像在RAID层执行。使用SyncMirror以镜像格式存储低级别的数据。在LUN、卷和协议层、镜像的使用实际上是不可见的。</block>
  <block id="33613d29368b0b312d33bd204505f12b" category="list-text">相反、SM-AS镜像发生在协议层。这两个集群总体上是独立的集群。两个数据副本同步后、这两个集群只需镜像写入即可。在一个集群上进行写入时、该写入会复制到另一个集群。只有在两个站点上的写入均已完成时、才会向主机确认写入。除了此协议拆分行为之外、这两个集群在其他方面都是正常的ONTAP集群。</block>
  <block id="c6ce2d48c3feb0ac105233b1d47d6785" category="list-text">MetroCluster的主要角色是大规模复制。您可以复制RPO为0且RTO接近零的整个阵列。这样可以简化故障转移过程、因为故障转移只需执行一项"操作"、而且在容量和IOPS方面扩展得非常好。</block>
  <block id="22c8f7d4250a7117dcec5e795cf01979" category="list-text">SM-AS的一个关键用例是粒度复制。有时、您不希望将所有数据作为一个单元进行复制、或者您需要能够有选择地对某些工作负载进行故障转移。</block>
  <block id="466f5e6d5af96a45aba533d742d1f30e" category="list-text">SM-AS的另一个主要用例是主动-主动操作、您希望在位于两个不同位置的两个不同集群上提供完全可用的数据副本、这些集群具有相同的性能特征、如果需要、也不需要在站点间延伸SAN。您的应用程序可以同时在两个站点上运行、这样可以减少故障转移操作期间的整体恢复时间。</block>
  <block id="3ab2196c18fe1cd72bf252059597387b" category="section-title">NetApp MetroCluster和SnapMirror活动同步</block>
  <block id="95da439be4f858e05c58cde4b5946324" category="paragraph">对于许多客户来说、灾难恢复不仅需要拥有远程数据副本、还需要能够快速利用这些数据。NetApp提供了两种技术来满足这一需求—MetroCluster和SnapMirror主动同步</block>
  <block id="3e6b18011054436086bb6cf813b0cb23" category="section-title">SM-AS和MCC比较</block>
  <block id="4ab72a69aa303ab33d610a6f6e594e68" category="section-title">校验和</block>
  <block id="0a4a3e3ef29b5fc4ea4e557f166532b4" category="paragraph">SnapMirror活动同步(SM-AS)基于SnapMirror同步。通过MetroCluster、每个ONTAP控制器都负责将其驱动器数据复制到远程位置。使用SnapMirror主动同步时、您实际上拥有两个不同的ONTAP系统、它们会维护LUN数据的独立副本、但会相互协作、为该LUN提供一个实例。从主机角度来看、它是一个LUN实体。</block>
  <block id="2f589372957b08ce09879b8a2ab6e58c" category="section-title">启用DNFS</block>
  <block id="1a89d30b5bb0e2de334e029001a92f8a" category="paragraph">Oracle DNFS可以与NFSv3结合使用、除了启用DNFS库之外、无需进行任何配置(有关所需的特定命令、请参见Oracle文档)、但如果DNFS无法建立连接、则可以静默还原到内核NFS客户端。如果发生这种情况、可能会严重影响性能。</block>
  <block id="9cb0e5a02b9facf3c0e654f08ceceda4" category="paragraph">如果要在多个接口之间使用DNFS多路复用、使用NFSv4.X或使用加密、则必须配置oranfstab文件。语法极为严格。文件中的小错误可能会导致启动挂起或绕过oranfstab文件。</block>
  <block id="3c04631b254b4b0e971a2c82517f50cb" category="paragraph">要确保DNFS按预期运行、唯一的方法是查询v$dnfs表。</block>
  <block id="21986e459426718105f7dc1a16e88bd0" category="paragraph">下面是一个示例oranfstab文件、该文件位于/等 位置这是可以放置oranfstab文件的多个位置之一。</block>
  <block id="1d4338d2de6e933a6941c8605def3a39" category="paragraph">第一步是检查指定文件系统的DNFS是否正常运行：</block>
  <block id="75bc8bd82bedf61e91351f8667b97e13" category="paragraph">此输出表示DNFS正在与这两个文件系统结合使用、但它不表示oranfstab正常运行。如果出现错误、DNFS可能已自动发现主机的NFS文件系统、您仍可能会看到此命令的相同输出。</block>
  <block id="f4327e73856b2069e10b045605d3fbe9" category="paragraph">可以按如下所示检查多路径：</block>
  <block id="99dc2d8bc11eb27fb0b920ca969e43e1" category="paragraph">这些是DNFS正在使用的连接。对于每个SVRNAME条目、可以看到两个路径和通道。这意味着多路径正在工作、这意味着已识别并处理oranfstab文件。</block>
  <block id="d99de907aa06fa04c7b19ffceff68307" category="admonition">以下各节是ONTAP 9 15.1.的最新版本、但租用和锁定行为以及调整选项可能会因版本而有所不同。如果需要调整NFSv4租赁/锁定超时、请咨询NetApp支持部门以了解最新信息。</block>
  <block id="4bf95f1ea9ecf4f42a7b323970405bb4" category="paragraph">此宽限期用于控制网络接口更改期间的租约回收，但有另一个宽限期用于控制存储故障转移期间的回收<block ref="d75aeb1a8759ea7475fe0ddcd2058ca1" prefix=" " category="inline-code"></block>。这是一个节点级选项。</block>
  <block id="0ba7c8a7759adb519c715ac93fdee2a6" category="paragraph">例如，如果您经常需要执行LIF故障转移，并且需要缩短宽限期，则可以更改<block ref="b1280b7c6d986647dff33b87ce276327" prefix=" " category="inline-code"></block>。如果要在控制器故障转移期间缩短IO恢复时间，则需要更改<block ref="d75aeb1a8759ea7475fe0ddcd2058ca1" prefix=" " category="inline-code"></block>。</block>
  <block id="3f3edac1c3ed7bfad53f9d42b9a0c5a7" category="paragraph">只有在充分了解风险和后果后、才应谨慎更改这些值。使用NFSv4.X执行故障转移和迁移操作所涉及的IO暂停无法完全避免。锁定、租用和宽限期是NFS RFC的一部分。对于许多客户来说、NFSv3更受欢迎、因为故障转移速度更快。</block>
  <block id="167503c08e9285f5c4a4a61a0123897b" category="paragraph">宽限期和租赁期是连接的。如上所述、默认租约超时为30秒、这意味着NFSv4客户端必须至少每30秒向服务器签入一次、否则它们将失去租约、进而失去锁定。有一个宽限期、允许NFS服务器重建租用/锁定数据、默认为45秒。宽限期必须长于租赁期。这样可以确保设计为至少每30秒续订一次租约的NFS客户端环境能够在重新启动后与服务器签入。45秒的宽限期可确保所有希望至少每30秒续订一次租约的客户都有机会续订租约。</block>
  <block id="6be050126f2df5ae7cd944ce446241c2" category="paragraph">如果不接受30秒的超时时间、您可以选择延长租赁期限。</block>
  <block id="38d530634a8d32e8775a37109fc08542" category="paragraph">如果要将租约超时时间增加到60秒、以承受60秒网络中断、则还必须延长宽限期。这意味着、在控制器故障转移期间、IO暂停时间将更长。</block>
  <block id="ac76821692fdb2dae1d98babe804fb8f" category="paragraph">这通常不会是问题。通常、用户每年只更新ONTAP控制器一次或两次、并且很少会因硬件故障而发生计划外故障转移。此外、如果您的网络可能会发生60秒的网络中断、并且您需要将租赁超时时间设置为60秒、则可能不会反对偶尔发生的存储系统故障转移、从而导致61秒的暂停。您已确认您的网络经常暂停60秒以上。</block>
  <block id="3a80e1e29c96d0837b12aef65785a41a" category="doc">配置参数</block>
  <block id="4bb9f72180425717a416a5037a100cca" category="searchtitle">MySQL和InnoDB文件结构</block>
  <block id="9a41c04f55c43c1bfac6d1e3fb0992de" category="doc">NFSv3插槽表</block>
  <block id="dce12836eeccf070f53590dc5d86633d" category="doc">块大小</block>
  <block id="b4aa7c0127688b4c623685cfeed4ab97" category="searchtitle">Oracle Real Application Clusters超时</block>
  <block id="6fae8d228f324e0e0a9c817b746b9bd0" category="doc">RAC超时</block>
  <block id="b64e3a0dc81f710f886a442e1a397bb9" category="doc">数据库管理和自动化工具</block>
  <block id="87921e5ee2cf87589874871f0d361694" category="doc">数据库可用性</block>
  <block id="accd3900cbd3e4d55a38c8518052015c" category="doc">校验和与数据完整性</block>
  <block id="5611150a7a2a706d09d267b466f083d6" category="paragraph">对于真正的存储阵列、数据完整性可通过在多个级别使用校验和来保护。如果基于IP的网络中的数据损坏、则传输控制协议(TCP)层会拒绝数据包数据并请求重新传输。FC协议包括校验和、封装的SCSI数据也是如此。将ONTAP置于阵列上后、它将具有RAID和校验和保护功能。可能会发生损坏、但与大多数企业阵列一样、系统会检测到并更正此问题。通常、整个驱动器发生故障、提示重建RAID、数据库完整性不受影响。驱动器上的单个字节仍然可能被宇宙辐射或闪存单元故障损坏。如果发生这种情况、奇偶校验检查将失败、驱动器将出现故障、并开始RAID重建。同样、数据完整性也不受影响。最后一道防线是使用校验和。例如、如果驱动器损坏的数据出现灾难性固件错误、而RAID奇偶校验检查无法检测到该数据、则校验和将不匹配、ONTAP将阻止在Oracle数据库收到损坏的块之前传输该块。</block>
  <block id="cd985f59320d95026288fa5ff6dcf58a" category="doc">联机备份</block>
  <block id="9c030078e0f444e80ad1c24e215220a4" category="doc">利用ONTAP实现数据保护</block>
  <block id="6bb9a5aec98309d1414b32f7e0751415" category="doc">数据保护规划</block>
  <block id="06db8225d3ec2b43755ddc9358302450" category="doc">RTO、RPO和SLA规划</block>
  <block id="5d827e5d4c92779310224878dc408813" category="summary">使用MetroCluster进行Oracle数据库灾难恢复</block>
  <block id="f0b223afb696335287bc2ed9501b5b33" category="doc">借助MetroCluster实现灾难恢复</block>
  <block id="67be2475945283126e261087dcc833b7" category="doc">MetroCluster和NVFAIL</block>
  <block id="13262509535baae73d0cc7ab06de1fc6" category="searchtitle">基于MetroCluster的Oracle扩展RAC</block>
  <block id="7993038617c805a663d50702c4494b68" category="doc">Oracle Extended RAC</block>
  <block id="75b233b87417347976ef489e09961c77" category="doc">Oracle单实例</block>
  <block id="aa51324dbf5137dc80d29f127e7265f1" category="doc">Oracle单实例</block>
  <block id="254742fbeffe659f98f802792b541c45" category="doc">RAC Tieb破碎 机</block>
  <block id="aeee9c92b22d6f18b8670c9f330ea7c9" category="doc">网络互连总故障</block>
  <block id="0ef819e6ae8a74f9c8ac0158a24b1627" category="doc">服务还原</block>
  <block id="8367f9ef79397d7d8f1367cb4392c602" category="summary">Oracle和SnapMirror活动同步—站点故障</block>
  <block id="5c8784e46ac32f6b1c9b78f954c1a473" category="summary">SnapMirror active sync—SnapMirror通信失败</block>
  <block id="7ed82538ab967cd6e2949aa971158dc9" category="searchtitle">Oracle、SnapMirror活动同步和ONTAP调解器</block>
  <block id="db2170f38b52c13c31e0572c709b6f8a" category="searchtitle">Oracle和SnapMirror主动同步概述</block>
  <block id="e9a673980d8df30ed4173e4b7c4ecd2c" category="searchtitle">Oracle和SnapMirror主动同步首选站点</block>
  <block id="45d97b0c2ca342ad882153a1245f9897" category="doc">SnapMirror主动同步首选站点</block>
  <block id="0bb4536e921f4d96dd701c1afe746457" category="doc">ASMLib/AFD (ASM筛选器驱动程序)</block>
  <block id="3ee9e6a595247d1965be0d0c6cd0f22e" category="doc">数据文件迁移</block>
  <block id="a9761df551af398a0fc2974288502d8a" category="doc">主机数据复制</block>
  <block id="d437e7d8b6513f91bbd58e0b1e08c90b" category="doc">迁移规划</block>
  <block id="4c7e0d612a5f0e09f272083633991979" category="doc">TCP/IP和以太网配置</block>
  <block id="9f2dc5f476d250d879dc58a583f93fd1" category="searchtitle">适用于Oracle数据库的FC SAN配置</block>
  <block id="08f606415b4ad7fb864651eac04fcd8e" category="searchtitle">Oracle数据库性能优化和基准测试</block>
  <block id="b30e3ef968d39d109aea4a92750c9792" category="doc">NFSv3锁定陈旧</block>
  <block id="1d19e21de0f93b11f5ceb8b535a3afc2" category="doc">容量管理</block>
  <block id="8d409dbefa8e76403d7adf4cbd315d3d" category="doc">ONTAP故障转移/切换</block>
  <block id="0f03a4e25b68a1a67d3be8f0d989ef8b" category="doc">利用ONTAP QoS进行性能管理</block>
  <block id="555472a0fed2f80e0848845e538a08af" category="doc">Oracle Direct NFS (DNFS)</block>
  <block id="92d0288d9e0c6ed5ffd8dcd2e0900101" category="paragraph">在编写本报告时、DNFS多路径不能与最新版本的Oracle数据库中的NFSv4.1结合使用。将NFSv4.1指定为协议的oranfstab文件只能对给定导出使用一个路径语句。原因是ONTAP不支持客户端ID中继。我们将来可能会提供用于解决此限制的Oracle数据库修补程序。</block>
  <block id="3fdf18c0210b51691df97c8be74021a3" category="doc">ASM Recasation Utility (ASM回收实用程序)(ASMRU)</block>
  <block id="d63f66214ae30c5b9b10653f1e503492" category="doc">LUN对齐</block>
  <block id="38baeef7dc11ad9438aa5b211745d9f6" category="searchtitle">Oracle数据库LUN大小调整和LVM大小调整</block>
  <block id="f447f8c9180e11bc4219ace93e7431fb" category="doc">LUN大小调整和LVM大小调整</block>
  <block id="c8d869d733bd5299001f9d90b9f00d90" category="doc">LUN大小调整和LUN计数</block>
  <block id="4ee97146242ed12473141d7ecad00ee1" category="doc">备份层</block>
  <block id="e7cba09a05ca3e6ccdd30a1aa0a7d3af" category="doc">归档日志层</block>
  <block id="c1affdf2bd2e606557f2bf12c69af8f8" category="doc">部分文件分层</block>
  <block id="3bf6f5a455b1889775d79713ad4e19ed" category="doc">检索策略</block>
  <block id="636d94f9e0fb52c5d7560661b059b203" category="doc">Snapshot层</block>
  <block id="bf5f70c9080724ef27b09203705b1abc" category="doc">完整文件层</block>
  <block id="acf5662e9defb6f8df644e0d8b4caa28" category="doc">初始化参数</block>
  <block id="03095e209912bbf8e40f883c88befe49" category="searchtitle">PostgreSQL本机数据保护</block>
  <block id="300e5ea4a0c7d02b8a4efeba5a1f6faf" category="doc">本机Ddta保护</block>
  <block id="1c3ee6977dcad0709502549dd7b111f3" category="sidebar">使用MetroCluster进行Oracle灾难恢复</block>
  <block id="662637dadb14be675de52ed993629bcd" category="paragraph">要考虑服务器操作系统队列深度、请为一个数据库至少使用八个LUN (每个卷一个LUN)。按ONTAP集群中的节点数增加LUN数量。例如、如果使用4节点(2个HA对)集群、请添加4个LUN。对于较大的环境、可能需要更多的LUN；使用相同数量的卷(总共八个、分布在存储节点上)、并在集群节点和卷之间添加LUN (以两的倍数)。通过这种方法、您可以轻松扩展Epic环境。</block>
  <block id="f73f987e4ea887ccfd1bf297bad46e22" category="paragraph">*示例1：2节点ONTAP集群*</block>
  <block id="f08ea6531fe21723a28ec9f89ea3e451" category="paragraph">2个节点、1个HA对、8个卷、每个节点4个卷、8个LUN、每个卷一个LUN、再添加2个LUN、其中一个位于volume01中的node01上、一个位于volume02中的node02上。</block>
  <block id="fd52d4fb0b6e3cfb46cae3e012d26c20" category="paragraph">*示例2：4节点ONTAP集群*</block>
  <block id="489d5412107ca7c901de568b7c7dcce3" category="paragraph">4个节点、2个HA对、8个卷、每个节点2个卷、8个LUN、每个卷1个LUN、再添加4个LUN、其中1个位于volume01的node01上、1个位于volume02的node02上、1个位于volume03的node03上、1个位于volume04的node04上。</block>
  <block id="2feec0f4e37d9566d4cf292116430adb" category="paragraph">如果服务器需要更多存储、最简单的选择是增加包含卷的LUN的大小。第二种方法是、一次以两的倍数向卷组添加LUN (每个节点的每个卷一个)。</block>
  <block id="c338b7a4eb0c6f0bb88b444f6c195b01" category="admonition">如果在大型环境中需要4个以上的节点或8个以上的LUN、请咨询Epic联盟团队以确认LUN设计。您可以通过epic@NetApp．com联系该团队。</block>
  <block id="e9afc81d3b8e2990f966bb247fa75a6b" category="list-text">首先在8个卷中使用8个LUN、一次在集群的所有节点上添加2个LUN。</block>
  <block id="eb75aeb3b4b2b9734ba3e52f5483f0b2" category="inline-link-macro">ONTAP文档</block>
  <block id="c5432110ad66f4e2e624118b88a48126" category="list-text">按照预期增长3年的大小创建LUN。(有关最大LUN大小、请参见<block ref="2a57767dbf71d600f009b2fefab6360d" category="inline-link-macro-rx"></block>。)</block>
  <block id="4631d10aa7c8cd31e9dcf52425c327ee" category="paragraph">可使用六种协议将VMware vSphere连接到运行ONTAP的系统上的数据存储库：</block>
  <block id="4dc791031dce7528180b933655b6f73e" category="paragraph">FCP、NVMe/FC、NVMe/TCP和iSCSI是块协议、它们使用vSphere虚拟机文件系统(VMFS)将VM存储在ONTAP FlexVol volume中包含的ONTAP LUN或NVMe命名空间中。NFS 是一种文件协议，无需使用 VMFS 即可将虚拟机放置到数据存储库（即 ONTAP 卷）中。SMB (CIFS)、iSCSI、NVMe/TCP或NFS也可以从子操作系统直接使用到ONTAP。</block>
  <block id="6b8f0029ce30f9b4d5fe0def33875511" category="cell">FC</block>
  <block id="81761811d0f769f1e8ab81834167af5c" category="cell">启用了VMware vStorage APIS for Data Protection (VADP)的备份软件</block>
  <block id="50f09c99cf03d7efc83cfdc33047b54f" category="cell">是^1^</block>
  <block id="bb3e0b0b29c5930728585f775194c32b" category="cell">否^2^</block>
  <block id="b42c555e5ddbb6a4354369bbdd6b4513" category="cell">仅v3 ^2^</block>
  <block id="cb928308729506b7eff5e7791a0ce0ba" category="list-text">较旧的子操作系统（ OS ）需要与存储系统对齐，以获得最佳性能和存储效率。但是， Microsoft 和 Linux 分销商（例如 Red Hat ）提供的现代供应商支持的操作系统不再需要进行调整，以便在虚拟环境中将文件系统分区与底层存储系统的块对齐。如果您使用的是可能需要对齐的旧操作系统、请使用"VM对齐"搜索NetApp支持知识库文章、或者向NetApp销售人员或合作伙伴联系人申请TR-3747副本。</block>
  <block id="2d95becf2e726f81e5f2c0c9447ec2ad" category="paragraph">一般来说、* NetApp建议*在vCenter中使用适用于VMware vSphere的ONTAP工具界面来配置传统数据存储库和Vvol数据存储库、以确保遵循最佳实践。</block>
  <block id="3405fd91ec611e14ca0464a159e87d21" category="list-text">当ESXi和ONTAP存储阵列连接到以太网存储网络时，*PortFast* NetApp建议将这些系统连接到的以太网端口配置为快速生成树协议(RSTP)边缘端口或使用Cisco端口快速功能。* NetApp建议*在使用Cisco PortFast功能且为ESXi服务器或ONTAP存储阵列启用了802.1Q VLAN中继的环境中启用生成树PortFast中继功能。</block>
  <block id="96d48caf96811ccfa373aaf5fbe6f862" category="list-text">* NetApp建议*以下链路聚合最佳实践：</block>
  <block id="d4b27e1b61577e2e3dfeebd3b8129da5" category="list-text">避免在主机之间共享卷。例如、虽然可以在一个卷中创建2个LUN并将每个LUN共享到不同的主机、但应避免这种情况、因为它会使管理复杂化。如果在同一主机上运行多个SQL Server实例、则除非某个节点上的卷接近限制、否则请避免卷共享、而是为每个主机上的每个实例创建一个单独的卷、以简化数据管理。</block>
  <block id="e3ea9105e22caf8aa06aee0279a968bb" category="list-text">适当时、配置卷自动调整策略以帮助防止出现空间不足情况。</block>
  <block id="72a9733bd5929d30a93ea680e0c3fad1" category="list-text">将数据库二级文件(作为文件组的一部分)放在不同的卷上可提高SQL Server数据库的性能。只有当数据库的文件不与任何其他文件共享其LUN<block ref="937f38432beb92fdba3d47780720bdf7" prefix=" " category="inline-code"></block>时、此隔离才有效<block ref="937f38432beb92fdba3d47780720bdf7" prefix=" " category="inline-code"></block>。</block>
  <block id="82d9655a27436534991360ea4c0dc680" category="paragraph">tempdb数据库的利用率可能很高。除了在ONTAP上以最佳方式放置用户数据库文件之外、tempdb数据文件放置对于减少分配争用也至关重要。tempdb应放置在单独的磁盘上、不应与用户数据文件共享。</block>
  <block id="5c4a7832da0e9f8799089fdc985bb9b3" category="list-text">应创建大小相等的tempdb数据文件</block>
  <block id="20453a1c8627ad0bc536be210636fa41" category="paragraph">以下示例脚本通过创建八个大小相等的tempdb文件并将tempdb移动到SQL Server 2012及更高版本的挂载点来修改tempdb<block ref="ae6fbe62f3ddc46fa9a9885244d23675" prefix=" " category="inline-code"></block>。</block>
  <block id="3f808654ebfed6aae875b71a402ac91b" category="inline-link-macro">ONTAP 9的通知。16.1.</block>
  <block id="afb530fcc81b2978f808bd5327a32c87" category="inline-link-macro">9.16.0 9.16.0的通知</block>
  <block id="d804afb237a517c556722013a1b8ec73" category="inline-link-macro">9.15.1 9.9.1通知</block>
  <block id="5f016d328522d91c512269e0786e144d" category="inline-link-macro">9.15.0 9.9.1通知</block>
  <block id="98ea16e049d26c017c083e3896766015" category="inline-link-macro">9.14.1 9.9.1通知</block>
  <block id="2a0d0e639657d07a66d55606242f8863" category="inline-link-macro">9.14.0 9.9.1通知</block>
  <block id="d13ca0508189923e4791d61e82518903" category="paragraph"><block ref="ee254fc53b05f67f41ce3314151253c2" category="inline-link-macro-rx"></block> <block ref="83cffbd8d99e434b2f5f3940f69ff8e4" category="inline-link-macro-rx"></block> <block ref="23ce2232a13ec581d8a1f356c5cc2645" category="inline-link-macro-rx"></block> <block ref="4d4f1ffb0dbcd5627ca696d020c34dce" category="inline-link-macro-rx"></block> <block ref="d16c9b11843460f788b4709fb5f6f9c0" category="inline-link-macro-rx"></block> <block ref="5032e7169b10b3f96d6c299a82923a0e" category="inline-link-macro-rx"></block> <block ref="f7a2b1db149ed9886af0ce846dbc3e14" category="inline-link-macro-rx"></block> <block ref="b349c509ad858348b30db7e73307e3aa" category="inline-link-macro-rx"></block> <block ref="0dce234dfded58bd461541473b86e42a" category="inline-link-macro-rx"></block> <block ref="9760ec4df13f0afbdfec88ae16c871ae" category="inline-link-macro-rx"></block> <block ref="b6dab2933dfb92cf0c1355707a4aec7c" category="inline-link-macro-rx"></block> <block ref="1b7c80b26162b03bd0addd587f70df55" category="inline-link-macro-rx"></block> <block ref="14faf912aa42102a6628af4551e02583" category="inline-link-macro-rx"></block> <block ref="a90f36d649d3be5d386cc3563ab044fb" category="inline-link-macro-rx"></block> <block ref="2cd65b4a044075cfd9ad4a91f42fdff4" category="inline-link-macro-rx"></block> <block ref="5e764cc3fdcc19ff667796e414159bdc" category="inline-link-macro-rx"></block> <block ref="561451f09c7bca700ea0d7833cd9e92e" category="inline-link-macro-rx"></block> <block ref="d23d341a344216fbf99a91152429d49c" category="inline-link-macro-rx"></block> <block ref="b35e8fbd7b0369b23734510994911ec4" category="inline-link-macro-rx"></block> <block ref="41d4305cf7a6acb595086f123121a781" category="inline-link-macro-rx"></block> <block ref="ea685649fabe77da53e843fec56f72b8" category="inline-link-macro-rx"></block></block>
  <block id="c9e7f99d53af8a795853cdf25af30b41" category="section-title">适用于MetroCluster IP配置的ONTAP调解器</block>
  <block id="f6cab8e78e70dc1f9720a3ef038776e0" category="inline-link-macro">9.9.1有关适用于MetroCluster IP配置的ONTAP调解器的通知</block>
  <block id="ebe991cfd03b446bbf8687699ccbd660" category="inline-link-macro">9.8关于MetroCluster IP配置的ONTAP调解器的通知</block>
  <block id="2db41096b15f25232cba7341c2140448" category="inline-link-macro">9.7关于MetroCluster IP配置的ONTAP调解器的通知</block>
  <block id="f81cc577527b8b7cad4405edd62a83d4" category="paragraph"><block ref="3e82164cf34143fb60c8ff9df8c41c0a" category="inline-link-macro-rx"></block> <block ref="d53517b81c95b1c10115cf953ff553c1" category="inline-link-macro-rx"></block> <block ref="b1bde49b948d4004f51f0cd5e9a9e990" category="inline-link-macro-rx"></block></block>
  <block id="7d90174e2cb3f5e3051541506c8587b4" category="list-text">使用适用于VMware vSphere的ONTAP工具配置数据存储库、因为它可以简化导出策略的自动管理。</block>
  <block id="4ac7ffa40244bc8345591768f8411745" category="list-text">使用插件挂载功能将现有数据存储库应用于新服务器。</block>
  <block id="adf5380025d4004543deef73a471bbd5" category="inline-link-macro">NetApp和VMware的NFSv3 nconnect功能</block>
  <block id="f9f508df0fe89d92476e598965812f69" category="list-text">当前支持的所有VMware vSphere版本均可同时使用NFS v3和v4.1。vSphere 8.0 Update 2 (适用于NFS v3)和Update 3 (适用于NFS v4.1)新增了对nconnect的官方支持。对于NFS v4.1、vSphere仍支持会话中继、Kerberos身份验证和具有完整性的Kerberos身份验证。请务必注意、会话中继需要ONTAP 9.14.1或更高版本。有关nconnect功能及其如何提高性能的详细信息，请访问<block ref="8bbf9cc2e5403eec56b8cc2f4bd74d68" category="inline-link-macro-rx"></block>。</block>
  <block id="81439479f2f4c0fa8c28668334fa82bd" category="list-text">在vSphere 8中、nconnect的最大值为4、默认值为1。可以通过高级设置按主机提高vSphere中的最大值限制、但通常不需要。</block>
  <block id="b279126f58fd7f43a55f5efc8596bcea" category="list-text">对于需要比单个TCP连接所能提供的性能更高的环境、建议将值设置为4。</block>
  <block id="9d676095b7ff8ea1b1779bc58fb32a92" category="list-text">请注意、ESXi的NFS连接数限制为256个、每个nconnect连接数均计入此总数。例如、两个nconnect = 4的数据存储库总共会计入八个连接。</block>
  <block id="efdc45c7bd15d84f5bcb4df0560d6d3a" category="list-text">在生产环境中实施大规模更改之前、必须测试nconnect对环境的性能影响。</block>
  <block id="d1801a2d87a0325c6c691a74f5d1ffef" category="list-text">值得注意的是、NFSv3和NFSv4.1使用不同的锁定机制。NFSv3使用客户端锁定、而NFSv4.1使用服务器端锁定。虽然ONTAP卷可以通过这两种协议导出、但ESXi只能通过一种协议挂载数据存储库。但是、这并不意味着其他ESXi主机不能通过其他版本挂载同一数据存储库。为了避免出现任何问题、请务必指定挂载时要使用的协议版本、以确保所有主机使用相同版本、从而使用相同的锁定模式。请务必避免在主机之间混用NFS版本。如果可能、请使用主机配置文件检查合规性。</block>
  <block id="c17658fd7af3bb19a0f047cb1e006186" category="list-text">NFS导出策略规则用于控制vSphere主机的访问。您可以对多个卷（数据存储库）使用一个策略。对于NFS、ESXi会使用sys (UNIX)安全模式、并需要根挂载选项来执行VM。在 ONTAP 中，此选项称为超级用户，使用超级用户选项时，无需指定匿名用户 ID 。请注意、对于和<block ref="df809a941c1287d18c08bb5927b639dc" prefix=" " category="inline-code"></block>使用不同值的导出策略规则<block ref="ea72d12ecaa06afdb0c8a3b15e485e95" prefix=" " category="inline-code"></block>可能会导致ONTAP工具出现SVM发现问题。IP地址应是一个逗号分隔列表、挂载数据存储库的vmkernel端口地址不含空格。下面是一个策略规则示例：</block>
  <block id="a001b05a0a70d03d708c133c88072a2b" category="list-text">客户端匹配主机名、IP地址、网络组或域列表：192.168.42.21、192.168.42.22</block>
  <block id="0106a8755025c8789c58f6ca3db3cd93" category="list-text">RO访问规则：任意</block>
  <block id="1c66db8bac919c3f29211badf0369156" category="list-text">RW Access Rule：any (RW访问规则：任意)</block>
  <block id="193fc1ecf90841d52215e705d60caa7b" category="list-text">匿名用户映射到的用户ID：6554</block>
  <block id="f913a13d0c2cb8f8dd45dc1479901025" category="list-text">超级用户安全类型：any</block>
  <block id="e44d8f7f976db169814f15c0e3c91250" category="list-text">在SETATTR中使用set_id位：true</block>
  <block id="c154c7fcb68e62b069047ccff2521dc0" category="list-text">允许创建设备：true</block>
  <block id="71168bd99a960bfb425e723f5750b3fc" category="list-text">如果使用适用于VMware VAAI的NetApp NFS插件、则在创建或修改导出策略规则时、应将此协议设置为<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block>。要使VAAI副本卸载正常工作、需要使用NFSv4协议、而将协议指定为<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block>会自动包括NFS3和NFSv4版本。即使数据存储库类型创建为NFS v3、也需要执行此操作。</block>
  <block id="dd68c690edda5e0630944465c5950d11" category="list-text">访问协议：NFS</block>
  <block id="4d6306be791d29381011bb901e0351d5" category="list-text">客户端匹配规范：192.168.42.21、192.168.42.22</block>
  <block id="62297138e048f9159339e4709b23cd2f" category="list-text">作为iSCSI连接的LUN或NVMe/TCP连接的命名空间、由软件启动程序从VM子操作系统访问和控制</block>
  <block id="7eae63bf83e6298ab64a2dd5e2544df9" category="inline-link-macro">VMware配置最大值工具</block>
  <block id="ee1c3928454779ec08bd2d50271b6621" category="admonition">有关ESXi中支持的最新限制、请参见<block ref="ca32979bcc653e1966d3624ee8d76604" category="inline-link-macro-rx"></block>。</block>
  <block id="387b349695476180bf90cc1891288318" category="list-text">检查<block ref="1f38ac07598dbb4b06912539aafa4211" category="inline-link-macro-rx"></block>NetApp与VMware合作建议的设置。</block>
  <block id="9c4a21e654649a6a5201381ce4ba6cbd" category="paragraph">下表介绍了ONTAP支持vSphere的传统数据存储库功能。此信息不适用于VVOL数据存储库、但它通常适用于使用受支持的ONTAP 版本的适用场景 vSphere 6.x及更高版本。您还可以参考了解<block ref="ca32979bcc653e1966d3624ee8d76604" category="inline-link-macro-rx"></block>特定vSphere版本、以确认特定限制。</block>
  <block id="27071f484b59aa9ce5f5cffcefefd481" category="paragraph">^2^使用NVMe-oF和NFS v4.1的数据存储库需要vSphere复制。SRM目前不支持对NFS v4.1执行基于阵列的复制。适用于VMware vSphere Storage Replication Adapter (SRA)的ONTAP工具目前不支持使用NVMe-oF进行基于阵列的复制。</block>
  <block id="f992800e6b8aa5ca675e5d1c9fd9950c" category="summary">使用 SnapCenter ，您可以创建可应用于多个作业的备份策略。这些策略可以定义计划，保留，复制和其他功能。它们仍然允许选择虚拟机一致的快照、从而利用虚拟机管理程序在创建VMware快照之前将I/O置于静修状态的功能。</block>
  <block id="0a99e5aa10081a6cc2cd756764a791f5" category="inline-link-macro">Snapshot限制</block>
  <block id="aa4e326f7359bc14116e671e7002dd80" category="paragraph">ONTAP使用传统iSCSI和光纤通道协议(Fibre Channel Protocol、FCP)以及高效率和高性能的下一代块协议基于网络结构的NVMe (NVMe-oF)为VMware vSphere提供企业级块存储、并支持NVMe/FC和NVMe/TCP。</block>
  <block id="69ed4612751aa53c36bfb06723b9ac3c" category="inline-link-macro">数据存储库和协议—SAN</block>
  <block id="6ed827bb740ef6ae13ba33875f09bd4d" category="paragraph">有关在vSphere和ONTAP中为VM存储实施块协议的详细最佳实践、请参见<block ref="851570383af5746336da824a0a2590e1" category="inline-link-macro-rx"></block></block>
  <block id="080533926d0a5f93ded730459d8fe38e" category="paragraph">通过 vSphere ，客户可以使用企业级 NFS 阵列为 ESXi 集群中的所有节点提供对数据存储库的并发访问。如一节所述<block ref="72b655a9973dbed02099f5e63762d591" category="inline-link-macro-rx"></block>、在vSphere中使用NFS具有一些易用性和存储效率可见性优势。</block>
  <block id="d9243800afbb4af685507413cda85fb3" category="inline-link-macro">数据存储库和协议—NFS</block>
  <block id="5b17d236da497a1c9e5d89b42dfc8264" category="paragraph">有关建议的最佳实践、请参见<block ref="75fda850433b3639ed71701079d043be" category="inline-link-macro-rx"></block></block>
  <block id="d240aead1fe438e9f66d54e3cebb7e47" category="paragraph">下面是当前所有受支持的ONTAP版本的建议主机设置。</block>
  <block id="11d0e9e8442c67c812829427e008eb11" category="inline-link-macro">VMFS5虚拟机的空间回收</block>
  <block id="fef769c2e7ba3ba16273c3c81c47ed9e" category="cell">保留默认值(0)、但可以根据需要进行更改。有关详细信息、请参见 <block ref="9b26e5c0136d6a9ffe3ef541d9621427" category="inline-link-macro-rx"></block></block>
  <block id="c99694bb5336dd37a10341183ec8a950" category="inline-link-macro">VMware 知识库 2069356</block>
  <block id="2f5a0569065e71943058f8fb26e3e8da" category="inline-link">更改延迟轮循的默认参数</block>
  <block id="da151950bd7f77d4d82f31a151e48d86" category="paragraph">对于采用vSphere 7的FCP和iSCSI、有关详细信息、请参见。<block ref="ad69e690a8561a2cf3328cde094252f4" category="inline-link-macro-rx"></block>对于采用vSphere 8的FCP和iSCSI、有关详细信息、请参见<block ref="0b6ab7c7c874850b69a7bdde572cc0ce" category="inline-link-macro-rx"></block>。对于采用vSphere 7的NVMe-oF、有关详细信息、请参见<block ref="72dcc917faa9346f108bcba624c6b54f" category="inline-link-macro-rx"></block>。对于采用vSphere 8的NVMe-oF、有关详细信息、请参见<block ref="6388c35b35c0c848de96298937e342cf" category="inline-link-macro-rx"></block></block>
  <block id="b565c40b717c5d84ecaff52fbb94903d" category="paragraph">NetApp于2012年首次宣布、是VMware的早期设计合作伙伴、负责开发VMware vSphere APIS for Storage AWAREIVAWARE(VASA)、这是企业级存储阵列基于存储策略的管理(Storage Policy Based Management、SPBM)的基础。这种方法为VMFS和NFS存储提供了有限的VM粒度存储管理。</block>
  <block id="e01da3b454da14823394d0b9b3fac1d6" category="section-title">虚拟卷(Virtual Volume、Virtual Volume、Virtual Volume)</block>
  <block id="b077cca6e6fd5e690157294fd7f87e08" category="paragraph">vvol是一种革命性的存储架构、支持VM粒度存储管理、不仅可以按VM (包括VM元数据)管理存储、还可以按VMDK管理存储。vvol是软件定义的数据中心(SDDC)战略的一个关键组件、该战略构成了VMware Cloud Foundation (VCF)的基础、可为虚拟化环境提供更高效、可扩展的存储架构。</block>
  <block id="7dba0dd24357e8a19109bbbf7f689fb2" category="paragraph">通过Vvol、VM可以按每个VM使用存储、因为每个VM存储对象都是NetApp ONTAP中的一个唯一实体。对于不再需要卷管理的ASA R2系统、这意味着每个VM存储对象都是阵列上的一个唯一存储单元(SU)、可以独立控制。这样、便可创建可应用于单个VM或VMDK (从而实现独立SUS)的存储策略、从而对性能、可用性和数据保护等存储服务进行精细控制。</block>
  <block id="f467f22eb6ec5b3e0694963b3f16ebc2" category="section-title">基于存储策略的管理(Storage Policy Based Management、SPBM)</block>
  <block id="05ba8cf72b56cd6a89d699c0a922d186" category="paragraph">SPBM 提供了一个框架，可用作虚拟化环境可用存储服务与通过策略配置的存储元素之间的抽象层。通过这种方法、存储架构师可以设计具有不同功能的存储池。VM管理员可以轻松使用这些池。然后、管理员可以将虚拟机工作负载要求与所配置的存储池进行匹配。此方法可简化存储管理、并可更高效地利用存储资源。</block>
  <block id="4e1ae190f1f93f025754e7944927b697" category="paragraph">SPBM是虚拟卷的一个关键组件、可提供一个基于策略的框架来管理存储服务。策略由vSphere管理员使用供应商的VASA Provider (VP)提供的规则和功能来创建。可以为性能、可用性和数据保护等不同存储服务创建策略。可以将策略分配给单个VM或VMDK、从而对存储服务进行精细控制。</block>
  <block id="ac0bb89f2c9215fb6f1280fb1d88d213" category="section-title">NetApp ONTAP和虚拟卷</block>
  <block id="1402ced4d3888a58c5af1059e38ea6b4" category="paragraph">NetApp ONTAP在虚拟卷扩展领域居于存储行业领先地位，可在一个集群中支持数十万个虚拟卷*。相比之下、企业级阵列供应商和小型闪存阵列供应商支持的每个阵列只能支持数千个的卷。ONTAP为VMware vSphere环境提供了一个可扩展的高效存储解决方案、可通过一组丰富的存储服务(包括重复数据删除、数据压缩、精简配置和数据保护)来支持vvol。SPBM支持与VMware vSphere环境无缝集成。</block>
  <block id="6070863553bff7655694da4be22f793e" category="paragraph">我们之前提到、VM管理员可以将容量用作存储池。这可以通过使用存储容器来实现、这些存储容器在vSphere中表示为逻辑数据存储库。</block>
  <block id="5db11f8fed5bd72f359ab9469069dffa" category="summary">ONTAP工具10安装检查清单</block>
  <block id="a5d727df2ce2d168bae39c78df4b9054" category="doc">检查清单</block>
  <block id="7aed7b3182cbdda9aceb9c8f8b3c2dbe" category="paragraph">使用此安装检查清单可确保成功部署(针对10.3及更高版本进行了更新)。</block>
  <block id="06c2cea18679d64399783748fa367bdd" category="inline-image-macro">一个</block>
  <block id="1e90f607d380c9ee51b487edec3975fa" category="list-title"><block ref="58f667aaf05f87159670e12bd9bc076b" category="inline-image-macro-rx" type="image"></block>初步规划</block>
  <block id="5541521d8d465590f0919510f29154b2" category="inline-link">部署适用于VMware vSphere的ONTAP工具的配置限制</block>
  <block id="225d03736b7d93585b216af68e8caa12" category="list-text">确定您的环境所需的ONTAP工具配置的大小和类型。有关详细信息、请参见<block ref="de0a48be1b1ae6c0ec73a4762c1d7abf" category="inline-link-rx"></block>。</block>
  <block id="c56feb728c490e11ea8eba91afce9419" category="list-text">确定要使用适用于VMware Site Recovery Manager (SRM)的ONTAP工具Storage Replication Adapter (SRA)还是Live Site Recovery (vrr)。如果是、则需要访问SRM/vrr服务器管理界面才能安装SRA。</block>
  <block id="15ee84770ceab89b9fe30ec618843c01" category="inline-link">在ONTAP中创建集群对等关系</block>
  <block id="bfbb5bcd0f88a18adcc2741da1b9063a" category="inline-link">在ONTAP中创建集群间SVM对等关系</block>
  <block id="d8a2601707345eab1d4df3e541d61f3c" category="list-text">如果您要使用由ONTAP工具管理的SnapMirror复制(包括但不限于SnapMirror活动同步)、则ONTAP管理员必须<block ref="f4be9e71a34420e69a7db6d0cf97d232" category="inline-link-rx"></block>先将ONTAP工具与SnapMirror结合使用、<block ref="42356490ef97c026f7c04a9cb9eeee7d" category="inline-link-rx"></block>然后才能使用。</block>
  <block id="801ab24683a4a8c433c6eb40c48bcd9d" category="inline-link">下载</block>
  <block id="18f5114f4a595ad26525bf20f301ce19" category="list-text"><block ref="20462cf0cb6f4e0f9c91cc66c831d98e" category="inline-link-rx"></block>ONTAP工具OVA、如果需要、还包括SRA tar.gz文件。</block>
  <block id="aada29daee1d64ed0fe907043855cb7e" category="inline-image-macro">两个</block>
  <block id="770c8023395525bc05b5a8fc2e6efa8b" category="list-title"><block ref="54f425ce8d89f4ed6b8a546561af5d60" category="inline-image-macro-rx" type="image"></block>配置IP地址和DNS记录</block>
  <block id="08b0c7e27d2f1780fce59893f12e7642" category="list-text">ONTAP工具应用程序地址____________。\____________。\____________。\____________</block>
  <block id="6bb090d29a0e3de8cc001d02c1e8a7b3" category="list-text">内部服务地址\____________。\____________。\____________。\____________</block>
  <block id="e32a9122e97bf17560b53c6993301629" category="list-text">节点1的DNS主机名\____________________________________________</block>
  <block id="1cb7943b8cf41289c8d5ae2c9f9ec310" category="list-text">节点1的IP地址____________。\____________。\____________。\____________</block>
  <block id="2b5f3d5d41f4d2986a55a91aa934205c" category="list-text">子网掩码____________。\____________。\____________。\____________</block>
  <block id="ed7c49acbcb0724e63d695ba272bcd1d" category="list-text">默认网关\____________。\____________。\____________。\____________</block>
  <block id="a637d19158a083f61d5e6d9df66998cb" category="list-text">DNS服务器1____________。\____________。\____________。\____________</block>
  <block id="b7eed84956833fb9e8cbb126fb30803f" category="list-text">DNS服务器2____________。\____________。\____________。\____________</block>
  <block id="7f7df9c7f87bea4d47136da35a80f4a9" category="list-text">DNS搜索域\___________________________________________</block>
  <block id="59cd965988b8905f3416029cd3a1facf" category="list-text">节点2的DNS主机名(可选)___________________________________________</block>
  <block id="242e264b9e179f0ea25123089a967467" category="list-text">节点2的IP地址(可选)____________。\____________。\____________。\____________</block>
  <block id="4115e1d934066b360d5cdd8013198fff" category="list-text">节点3的DNS主机名(可选)___________________________________________</block>
  <block id="8043aaa26cf3f85d9ab4df441ceb6ef3" category="list-text">节点3的IP地址(可选)____________。\____________。\____________。\____________</block>
  <block id="305c44d3641b44153a7487e28382fffb" category="list-text">为上述所有IP地址创建DNS记录。</block>
  <block id="ca8a2087e5557e317599344687a57391" category="inline-image-macro">三个</block>
  <block id="543a0cfd4f6527c92c513911b3079c22" category="list-title"><block ref="05b2444faffd66d76e88602ea7dd353f" category="inline-image-macro-rx" type="image"></block>网络防火墙配置</block>
  <block id="76841410d8f9a6881e0b96f150e9cedf" category="inline-link">端口要求</block>
  <block id="1cb44e38b7d534b49fb7ce15d6726cb0" category="list-text">在网络防火墙中打开上述IP地址所需的端口。有关最新更新、请参见<block ref="d75d54fbd8f18143d683ed6f5389e615" category="inline-link-rx"></block>。</block>
  <block id="981b8fcee42e1e726a67a2b9a98ea6e9" category="inline-image-macro">四个</block>
  <block id="640e990f06389e4b49f54086ba1aba46" category="inline-link">编辑设备设置并启用vasa服务</block>
  <block id="49b964c1f288e8e75650b3e86683914d" category="list-text">要使用此类卷、您必须先<block ref="c9f7d482e0b51df808dc044e3e43f591" category="inline-link-rx"></block>执行此操作。同时、请查看以下两项。</block>
  <block id="8ba46a1826b102cd1b8b0fb75a241176" category="inline-link">启用高可用性</block>
  <block id="acc64c77b8528b3513e0bab18372f0d3" category="list-text">如果您计划在生产环境中使用虚拟卷、请<block ref="b5eaf1d61c4c1246e4e215774dc53776" category="inline-link-rx"></block>使用上面的两个可选IP地址。</block>
  <block id="fddd8f455515e6a6de8e8d876641e0c5" category="inline-link">启用SRA服务</block>
  <block id="777b715f4e7db3295048bd9409cb3a0f" category="list-text">如果您计划将ONTAP工具Storage Replication Adapter (SRA)用于VMware站点恢复管理器或实时站点恢复，<block ref="9eb793199b56cb94f5df0c657a62ea9e" category="inline-link-rx"></block></block>
  <block id="e5d9de39f7ca1ba2637e5640af3ae8aa" category="inline-image-macro">五个</block>
  <block id="e03ec7d1e46f44c47e1547f8c19fdbb5" category="list-text">根据VMware、如果在多个vCenter中使用Vvol、则需要CA签名证书。</block>
  <block id="777f90dea67a6de19d7e4287d6d65525" category="list-text">VASA服务\____________________________________________</block>
  <block id="50261e7dc97594e1ef47d1913fadd642" category="list-text">行政事务\____________________________________________</block>
  <block id="e6fbc0b9673f8c86726688d7607fc8f5" category="inline-image-macro">六个</block>
  <block id="96c44f7328270a7b9e72a07f78739ecf" category="list-text">共享存储设备上需要一个数据存储库。或者、您也可以使用与节点1位于同一数据存储库中的内容库、以便使用VAAI快速克隆模板。</block>
  <block id="656b82abf6edc190097506cd4d1d585b" category="list-text">内容库(仅HA需要)___________________________________________</block>
  <block id="99325facb7679dc357733bd909532cfc" category="list-text">节点1数据存储库\____________________________________________</block>
  <block id="f669e2c7e65edea7adca0c4006b6cf36" category="list-text">节点2数据存储库(可选、但建议用于HA)___________________________________________</block>
  <block id="5ba1096fffa0ecfd4695651916c48133" category="list-text">节点3数据存储库(可选、但建议用于HA)___________________________________________________</block>
  <block id="12e67aac3e7f9227cc35f8f047d7dc74" category="inline-image-macro">七个</block>
  <block id="db5321854b38ff4107ff88c3d3fb2602" category="inline-link">部署OVA</block>
  <block id="62386ee2b40ea01fd147eb04a3da8b17" category="list-text"><block ref="2b093a8e786abd40836246bfb87e05bd" category="inline-link-rx"></block>使用vSphere Client。</block>
  <block id="baca0ca6729684fd54206793ae4b5bd5" category="inline-image-macro">八个</block>
  <block id="d40a477cc61e319a78ef1bb36d8ea566" category="list-text">为HA部署中的VM创建反关联性规则。</block>
  <block id="4695b076293ddedd5434ae5a73b57ae2" category="list-text">如果使用HA、则Storage vMotion会将节点2和节点3分隔为不同的数据存储库(可选、但建议使用)。</block>
  <block id="fde3f7a850bbaaac2a3706bf8c7df54c" category="inline-link">配置ONTAP用户角色和权限</block>
  <block id="064719d8b0308f2a4bc89590c3becdab" category="inline-link">使用管理证书</block>
  <block id="d59a2f6a46dd460183ac2d0c23cf6f75" category="list-text"><block ref="53fb9f19112a80479a138e84ac0182c6" category="inline-link-rx"></block>在ONTAP工具管理器中安装任何必需的CA签名证书。</block>
  <block id="6245e46af5a3bdaf57696763c4214c70" category="inline-link">添加vCenter Server实例</block>
  <block id="427d083edfb4d6df118817492fea1fea" category="list-text"><block ref="9271e724c67dd3dffeb4e3ddaf43b80d" category="inline-link-rx"></block>在ONTAP工具管理器中。</block>
  <block id="75299228e38c6c56354b3fbc53bd01db" category="inline-link">板载集群</block>
  <block id="0583aea4353aeb5998071022ebbb79ae" category="inline-link">板载SVM</block>
  <block id="4d5a9665c20fe0f045d612f3d7c14c3a" category="inline-link">在VMware Live Site Recovery设备上配置SRA</block>
  <block id="74d3c40ee5d2741e75390e90d13a881a" category="list-text">如果您为SRM/vSR启用了SRA以保护传统数据存储库，<block ref="ae14a63430307f4358dbb1aa0a6215ef" category="inline-link-rx"></block>请。</block>
  <block id="56b3d744b9b4be462a3690ae4544597f" category="inline-link">RPO几乎为零</block>
  <block id="c6a161ea3b473fa2cdc98e5283764902" category="list-text">配置定期备份到其他存储介质。</block>
  <block id="ed0748e15540f55b7e9e13424330165e" category="paragraph">请遵循以下最佳实践为虚拟机创建虚拟卷存储。</block>
  <block id="071d555e17e95fc548b89eaa2c3d9abf" category="section-title">准备使用ONTAP工具创建虚拟卷存储库</block>
  <block id="ed0b328de155f4d64394b3fa01aa3eda" category="inline-link">为SVM分配本地层(聚合)</block>
  <block id="835f14a0eb02625831ec957a0e6d8a57" category="list-text"><block ref="62ee77b15c683e37c03a082cde78e3a1" category="inline-link-rx"></block>适用于所有非ASA R2系统。</block>
  <block id="975336c37f4c9eec8db7574a1acdfc20" category="inline-link">配置文件配置概览</block>
  <block id="a51cd3bd8dc9efabd4808d4faa54cb85" category="inline-link">将物理端口组合在一起以创建接口组</block>
  <block id="02da2876df386437299938fff21fad98" category="list-text">对于每个交换机/网络结构连接、每个节点至少需要一个LIF。作为最佳实践、为每个节点创建两个或更多基于FCP、iSCSI或NVMe的协议。每个节点一个LIF足以支持基于NFS的卷、但此LIF应受LACP ifgroup保护。有关详细信息、请参见<block ref="f0614b67c9ad440bb8aa968adbd6137a" category="inline-link-rx"></block>和<block ref="a5ffd5460ffa788a3fba4a7f91132efb" category="inline-link-rx"></block>。</block>
  <block id="88ad52445ad4b758c30b8d41e4898479" category="inline-link">ONTAP集群和SVM已建立对等关系</block>
  <block id="9e972a46542b8d916a3d602fa7d61635" category="list-text">如果您计划使用SnapMirror，请确保您的源和目标<block ref="03354afe01dc1f53e5b25fc0bc002ae0" category="inline-link-rx"></block>。</block>
  <block id="2a03ee5b0887b8a6bf23fd52456544db" category="inline-link">部署适用于VMware vSphere的ONTAP工具</block>
  <block id="23f58455f809e6f8a8a2cac1db0e49cf" category="list-text"><block ref="17b63a5e90adbe276a8874700041ac19" category="inline-link-rx"></block>使用从NetApp支持站点下载的OVA。</block>
  <block id="951d3fc54a28f9f46798897467d96a5b" category="inline-link">管理证书</block>
  <block id="485a78e60d40cdf87a9864e840ed44a8" category="inline-link">横向扩展ONTAP工具</block>
  <block id="0112f904af205a304a0144318d92a88f" category="inline-link">在不使用vSphere DRS的情况下使用关联规则</block>
  <block id="7ff088db1b9b2e6077b66b3e834c022c" category="inline-link">创建VM-VM关联性规则</block>
  <block id="1d7299ee36dd01581c03d394e21875e9" category="inline-link">使用内置配置备份实用程序</block>
  <block id="97075bcba23b351ceb599f8167247f82" category="list-text">为您的环境配置ONTAP工具10.3。</block>
  <block id="46efd89ca4d682d645c74916f2c8e8f4" category="list-text"><block ref="9271e724c67dd3dffeb4e3ddaf43b80d" category="inline-link-rx"></block>在ONTAP工具管理器UI中。</block>
  <block id="6eaf552fe4b827d87d969ecf00791fab" category="inline-link">添加ONTAP集群</block>
  <block id="e4c64ea440c0954a75e29bee53f58731" category="list-text">ONTAP工具10.3支持安全多租户。如果您不需要安全多租户、只需转到vCenter中的ONTAP工具菜单、单击_Storage Backends_并单击_add_按钮即可<block ref="c70dc775815ebe034e3eb8a346ef862b" category="inline-link-rx"></block>。</block>
  <block id="2fdde12c870630cac6cf925e7762e8b7" category="list-text">登录到ONTAP工具管理器用户界面</block>
  <block id="bfae79cf17053457fef781bcd20e0f14" category="inline-link">载入存储集群</block>
  <block id="b7d3b83b5327fbad54ed641ffe056c7b" category="list-text"><block ref="b7d3b83b5327fbad54ed641ffe056c7b" category="inline-link-rx"></block></block>
  <block id="a5ff3af9e80b6313b32053dd07f43a23" category="inline-link">将存储后端与vCenter Server实例相关联</block>
  <block id="b60bfa6652bfe8b1d4f8779e792ac95c" category="list-text"><block ref="b60bfa6652bfe8b1d4f8779e792ac95c" category="inline-link-rx"></block></block>
  <block id="0abec471b6c51c227aee6d0b1708d228" category="list-text">最佳做法是为存储帐户创建RBAC角色。</block>
  <block id="8ca4b3b11e162a34da542a63661edf9a" category="list-text">有关ONTAP RBAC角色的详细信息，请参见<block ref="34ad13b9bdc1ec3d2d017144f37b1766" category="inline-link-rx"></block>。</block>
  <block id="90aa53fd267c0c35741d35381ad7a054" category="section-title">使用ONTAP工具创建虚拟卷存储库</block>
  <block id="2899926e592e956d9ee50e9ac1a3fcc5" category="paragraph">右键单击要创建ONTAP 数据存储库的主机、集群或数据中心、然后选择_VMware tools_&gt;_ProVision DataData存储 库_。</block>
  <block id="893534fd72b00ed504664763cdcfc0a5" category="inline-image-macro">Role="thum"配置数据存储库向导"、300</block>
  <block id="4a68f477edf1ea24da48b805acb7318c" category="paragraph"><block ref="4a68f477edf1ea24da48b805acb7318c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="20474b1a0c7edf7bd0809f2cb13dfe99" category="list-text">选择"vols"并提供有意义的名称、然后选择所需协议。您也可以提供数据存储库的问题描述。</block>
  <block id="f4f44261c4e217310cb4f0bb2cc389f5" category="list-text">ONTAP Tools 10.3与ASA R2。</block>
  <block id="39a5735e417853a21c6d8ed53aa5cb1f" category="paragraph"><block ref="39a5735e417853a21c6d8ed53aa5cb1f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e332ae811243a2074f58eb5d5efdcc21" category="list-text">选择ASA R2系统SVM、然后单击_n机_。</block>
  <block id="dac9a06ae28c99c2bc00c2f1ca94c7ed" category="paragraph"><block ref="dac9a06ae28c99c2bc00c2f1ca94c7ed" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2b3dd72cbd7ce4cf79b8fe46700d45d5" category="list-text">单击_Finish _</block>
  <block id="278f04f3dff2f303eed4edfbc836f534" category="paragraph"><block ref="278f04f3dff2f303eed4edfbc836f534" category="inline-image-macro-rx" type="image"></block></block>
  <block id="78195be4e07f2cf980cf70b78cfd4a62" category="list-text">就是这么简单！</block>
  <block id="7f016940a12444f321c6a4251eb495cf" category="list-text">选择协议</block>
  <block id="c3646108adeb4be26557fcbb99f62dc2" category="paragraph"><block ref="c3646108adeb4be26557fcbb99f62dc2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b0ec44dc6f9561dfdf58606f8e389753" category="list-text">选择SVM并单击_nXT。</block>
  <block id="444c0ec9fa985ffe1e7a13b90ec73f1b" category="paragraph"><block ref="444c0ec9fa985ffe1e7a13b90ec73f1b" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9a7e72607a6faad27d7fbe6e5f295675" category="paragraph"><block ref="9a7e72607a6faad27d7fbe6e5f295675" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4e1a38b50f0db11d407ccb112de6a782" category="paragraph"><block ref="4e1a38b50f0db11d407ccb112de6a782" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2037e6ffbfee1dde5dddbbca50cda2de" category="paragraph"><block ref="2037e6ffbfee1dde5dddbbca50cda2de" category="inline-image-macro-rx" type="image"></block></block>
  <block id="775c4cf447196b1d2af4bc4eb340eab0" category="list-text">您可以在数据存储库的配置选项卡的ONTAP工具菜单中查看已分配的卷。</block>
  <block id="f16d549f88c459ef96e6cb1cfd5e5ad6" category="paragraph"><block ref="f16d549f88c459ef96e6cb1cfd5e5ad6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="66ded2ce50d43c22f8e56efe6053a76d" category="list-text">现在、您可以从vCenter UI中的_policies and Profile _菜单创建虚拟机存储策略。</block>
  <block id="fc7ec2dfcc40e5c7c47dca5758e10523" category="paragraph">将VM从传统数据存储库迁移到Vvol数据存储库就像在传统数据存储库之间移动VM一样简单。只需选择虚拟机、然后从操作列表中选择迁移、并选择迁移类型_change storage only"。出现提示时、选择与您的Vvol数据存储库匹配的VM存储策略。对于SAN VMFS到Vvol的迁移、可以使用vSphere 6.0及更高版本卸载迁移副本操作、但不能从NAS VMDK卸载到Vvol。</block>
  <block id="8b8944ec0cef6dd0777b2144561987fe" category="admonition">与先前版本一样、ONTAP工具10.0及更高版本不再使用存储功能配置文件。而是直接在VM存储策略本身中定义存储功能。</block>
  <block id="0774b1717ce18129cd8e3ec0094e8640" category="paragraph">创建存储策略后、即可在配置新VM时使用该策略。</block>
  <block id="473e84e674f60e2fe619202a460efdfb" category="inline-image-macro">Role="thum"使用ONTAP工具创建VM存储策略VASA Provider 9.10"、300</block>
  <block id="e2f8ccc321215682fc34ae142633f3ff" category="paragraph"><block ref="b8f36bdf242d29fb6768827d6130494d" category="inline-image-macro-rx" type="image"></block> <block ref="e2501bb4f16d0f74914f04323d8e5e58" category="inline-image-macro-rx" type="image"></block> <block ref="166606e94a626af27852e00771133222" category="inline-image-macro-rx" type="image"></block> <block ref="8a14d5d27355a6630c7d65d859977eb8" category="inline-image-macro-rx" type="image"></block> <block ref="50b6bc69b9e417ba7f80bbcc0baaf57d" category="inline-image-macro-rx" type="image"></block> <block ref="8ec6614ba8e8947129dafaaede18ec39" category="inline-image-macro-rx" type="image"></block> <block ref="7bf707d7de5e0a048094c66368c89e52" category="inline-image-macro-rx" type="image"></block></block>
  <block id="71ea2d7b6b501372ec2ecc7846b5bd74" category="section-title">使用ONTAP工具进行性能管理</block>
  <block id="4357d652f2cfe6e15b6e8c54aacec10b" category="paragraph">ONTAP工具使用自己的平衡放置算法将新的VVOl放置在VVOl数据存储库中具有统一或经典ASA系统的最佳FlexVol volume中、或者具有ASA R2系统的存储可用性区域(Storage Availability Zone、SAZ)中。放置取决于后备存储与VM存储策略的匹配。这样可以确保数据存储库和后备存储满足指定的性能要求。</block>
  <block id="97c380438d77f28866d8fca75c697d78" category="list-text">可以在VM策略中指定*最小和最大IOX*。</block>
  <block id="6c2d6091dcb0d9df928f0dc687f86383" category="inline-image-macro">Role="thum""Reapplying VM Storage Policy"、300</block>
  <block id="8551dcdff381e3430606b1ff98a1e369" category="paragraph"><block ref="8551dcdff381e3430606b1ff98a1e369" category="inline-image-macro-rx" type="image"></block></block>
  <block id="def8fabb3f167c5ac05ad7f416c77a5c" category="paragraph">将VVOS与NetApp结合使用的关键是适用于VMware vSphere的ONTAP工具、这些工具作为NetApp ONTAP 9系统的VASA (vSphere存储感知API)提供程序界面。</block>
  <block id="e1688cfcbc1a78418422879cc779caf5" category="paragraph">ONTAP工具还包括vCenter UI扩展、REST API服务、适用于VMware Site Recovery Manager/Live Site Recovery的存储复制适配器、监控和主机配置工具以及一系列可帮助您更好地管理VMware环境的报告。</block>
  <block id="3122b363be1cca4e9b79843907db549f" category="paragraph">对于将VMware Cloud Foundation与vSAN结合使用的客户、可以将vvol作为补充存储添加到任何管理或工作负载域。vvol可通过基于通用存储策略的管理框架与vSAN无缝集成。</block>
  <block id="adcd94c2ec3aa54fc9fbaa77544ccc10" category="paragraph">下一代ONTAP工具10版本系列通过可扩展的容器化微服务架构实现了先前功能的现代化、该架构可通过ESXi上的一个简单OVA格式设备进行部署。ONTAP Tools 10将三个以前的设备和产品的所有功能整合到一个部署中。对于vvol管理、您将对ONTAP工具VASA Provider使用直观的vCenter UI扩展或REST API。请注意、SRA组件适用于传统数据存储库；VMware Site Recovery Manager不会对vvol使用SRA。</block>
  <block id="b87ac5af4acce876c9cb950c7c5a1891" category="section-title">在将iSCSI或FCP与统一系统结合使用时、ONTAP会使用VASA Provider架构</block>
  <block id="b566b0372bb84d18bc26fdc4c0fbd397" category="paragraph">对于全新安装、请将虚拟设备部署到vSphere环境中。部署后、您可以登录到管理器UI或使用REST API纵向或横向扩展部署、板载vCenter (此操作会将此插件注册到vCenter)、板载存储系统、并将存储系统与vCenter关联起来。只有当您计划对专用SVM使用安全多租户时、才需要在ONTAP工具管理器UI中启用存储系统并将集群与vCenter相关联、否则只需在ONTAP工具vCenter UI扩展中或使用REST API即可将所需的存储集群挂载。</block>
  <block id="26ffc687a7267f96a389530199971cd1" category="inline-link">适用于VMware vSphere的ONTAP工具文档</block>
  <block id="e8d49fe128837c5d33383898126449d6" category="paragraph">请参阅<block ref="d7e84668ac8db4130d4662ae6bde9c89" category="inline-link-macro-rx"></block>本文档中的或<block ref="b9c3640cd3dcc39d23d49bf169dd367b" category="inline-link-rx"></block>。</block>
  <block id="2e2b8d8692ea57a5a089be51e49a3104" category="paragraph">最佳实践是、将ONTAP工具和vCenter设备存储在传统NFS或VMFS数据存储库上、以避免任何相互依赖关系冲突。由于vCenter和ONTAP工具必须在vvol操作期间相互通信、因此请勿将ONTAP工具设备或vCenter Server设备(VCSAS)安装或移动到它们所管理的vvol存储中。如果发生这种情况、重新启动vCenter或ONTAP工具设备可能会导致控制平台访问中断、并且设备无法启动。</block>
  <block id="d6776ddc59d905e2967855a8949b8ff0" category="inline-link">适用于VMware vSphere 10的ONTAP工具—下载</block>
  <block id="e085c3225ffce6bb698ac8cf50cc0dc4" category="inline-link">从适用于VMware vSphere 10.x的ONTAP工具升级到10.3</block>
  <block id="e43b5fd407b2bc9fda1a39851a48f9bb" category="inline-link">从适用于VMware vSphere 9.x的ONTAP工具迁移到10.3</block>
  <block id="8374c9fea191c7d2f4430555aa250de3" category="paragraph">要估算虚拟设备的规模并了解配置限制、请参见<block ref="d602e3cdd9623c66a90a3f53a55d967f" category="inline-link-rx"></block></block>
  <block id="eddf7820ea4e2a78603e1bff3aa3bbb6" category="paragraph"><block ref="eddf7820ea4e2a78603e1bff3aa3bbb6" category="inline-link-rx"></block></block>
  <block id="a4552c6e2a6c6188a04ffaf366c67ea5" category="list-text"><block ref="a4552c6e2a6c6188a04ffaf366c67ea5" category="inline-link-rx"></block></block>
  <block id="2bd2f3ded095498e9ee97f7cc9074dc0" category="inline-link">适用于VMware vSphere的ONTAP工具概述</block>
  <block id="0e8f3f9d7644f28839e4eb573b4c2589" category="list-text"><block ref="0e8f3f9d7644f28839e4eb573b4c2589" category="inline-link-rx"></block></block>
  <block id="b832e56b13b2026b9c4d50d0f3f07904" category="list-text"><block ref="b832e56b13b2026b9c4d50d0f3f07904" category="inline-link-rx"></block></block>
  <block id="f0bc076dbe95da208c42e642105b0125" category="list-text"><block ref="f0bc076dbe95da208c42e642105b0125" category="inline-link-rx"></block></block>
  <block id="5245dc6f2a790bb421c841d2dfa17c0d" category="inline-link">配置数据存储库</block>
  <block id="607bc4263c4e2c484eb0fbbfdc21b438" category="list-text"><block ref="607bc4263c4e2c484eb0fbbfdc21b438" category="inline-link-rx"></block></block>
  <block id="f5f3c80e03e60f2a58399685adcf6610" category="list-text"><block ref="f5f3c80e03e60f2a58399685adcf6610" category="inline-link-rx"></block></block>
  <block id="1608a10fc8319b14c6c50a77edab9e7c" category="inline-link">修改 ESXi 主机设置</block>
  <block id="1f4b95b02061cf146ca813dd68f240b5" category="list-text"><block ref="1f4b95b02061cf146ca813dd68f240b5" category="inline-link-rx"></block></block>
  <block id="952be4c4311cd0b3b105435f5c484336" category="inline-link">使用ONTAP工具和SnapMirror活动同步配置vSphere Metro Storage Cluster (VMSC)</block>
  <block id="4e22d6ab0229a29e7c9f041b1f4263a0" category="list-text"><block ref="4e22d6ab0229a29e7c9f041b1f4263a0" category="inline-link-rx"></block></block>
  <block id="c724784c65896d8b16350f4b0580dfd4" category="inline-link">保护虚拟机</block>
  <block id="19ffdbf6d480a0097bf46b6fe379b412" category="list-text"><block ref="7970b8a3df0aeb298f96944db6f19225" category="inline-link-rx"></block>使用SRM</block>
  <block id="cb2b70161843498e22e97eb5f155009c" category="inline-link">监控集群、数据存储库和虚拟机</block>
  <block id="1f901bed9e91faa77a039d895d167c4b" category="list-text"><block ref="1f901bed9e91faa77a039d895d167c4b" category="inline-link-rx"></block></block>
  <block id="90d45c9fcbbcfdfcff766c447a16f73a" category="paragraph">VASA Provider包括一个信息板、其中包含各个VVO尔VM的性能和容量信息。此信息直接来自ONTAP中有关VVOL文件 和LUN的信息、包括延迟、IOPS、吞吐量等。如果使用当前所有受支持的ONTAP 9版本、则默认情况下会启用此功能。请注意、初始配置完成后、数据可能需要长达30分钟才能填充信息板。</block>
  <block id="6861075c55e048882e2c055171a337b2" category="section-title">其他最佳实践</block>
  <block id="ce76fed6b9276669c61e2b0b85e8e767" category="paragraph">一般来说，ONTAP支持VMware定义的vvol限制(请参见已发布<block ref="a6efdd9b1a19df6105024b4869e0582b" category="inline-link-rx"></block>)。请始终检查<block ref="bb9c67b5a4c15a85b5e6aa6c9afd0285" category="inline-link-rx"></block>、了解有关LUN、卷空间和文件的数量和大小的更新限制。</block>
  <block id="3729a48b517da427fd2d9807ebc0fed5" category="paragraph">*对光纤通道网络结构进行分区、然后再对其使用FCP来创建卷。*</block>
  <block id="f156d8db1f2ed380f0199266e583aa1b" category="paragraph">对于非R2系统、可能需要向ASA数据存储库添加多个后备卷、以便在ONTAP集群中分布工作负载、支持不同的策略选项或增加允许的LUN或文件数量。但是、如果需要最大的存储效率、请将所有备份卷放在一个聚合上。或者、如果需要最大的克隆性能、则可以考虑使用一个FlexVol 卷、并将模板或内容库保留在同一个卷中。VASA Provider会将许多VVOLs存储操作(包括迁移、克隆和快照)卸载到ONTAP。如果在一个FlexVol 卷中执行此操作、则会使用节省空间的文件克隆、并且这些克隆几乎可以即时使用。在FlexVol 卷之间执行此操作时、这些副本可以快速可用并使用实时重复数据删除和数据压缩、但只有在使用后台重复数据删除和数据压缩的卷上运行后台作业后、才能最大程度地恢复存储效率。根据源和目标、某些效率可能会降级。</block>
  <block id="256a688cc49c759f4698b8d5d1dd7b6a" category="paragraph">在ASA R2系统中、卷或聚合的概念从用户那里抽象出来、从而消除了这种复杂性。系统会自动处理动态放置、并根据需要创建协议端点。如果需要进行额外扩展、可以即时自动创建其他协议端点。</block>
  <block id="66a77b29a2cc0bdf1aa1bf8f6d4dac96" category="paragraph">*确保您具有足够的数据Lifs。*请参阅 <block ref="d7e84668ac8db4130d4662ae6bde9c89" category="inline-link-macro-rx"></block>。</block>
  <block id="b2dd36bd4918e00f8b2e15e6d62a4b94" category="section-title">VASA Provider</block>
  <block id="0a4ba68e118d83e29ea66516a02f1b48" category="section-title">协议端点(PE)</block>
  <block id="974863a1395a284a680d09e18cf6c9cc" category="section-title">虚拟协议端点(VPE)</block>
  <block id="8f13bfaaa8ba18765f4525a280f647cf" category="section-title">虚拟卷数据存储库</block>
  <block id="9f1893d8db5ceaf62726d1a0aa228224" category="section-title">VM 存储策略</block>
  <block id="0aa8052a92097a4f8ec3114e7249a0e1" category="paragraph">VM存储策略在vCenter中的策略和配置文件下创建。对于虚拟卷、请使用NetApp虚拟卷存储类型提供程序中的规则创建一个规则集。现在、与ONTAP工具9.X相比、ONTAP工具10.X提供了一种更简单的方法、它允许您直接在VM存储策略本身中指定存储属性。</block>
  <block id="1bf63b567c68de7fcd78fcc89f42f93c" category="inline-link">使用主机集群保护进行保护</block>
  <block id="b6930b017bd126db888766f9750b206b" category="section-title">VMware vSphere配置</block>
  <block id="2587ca69fa38fdcf84be76d7302e4e48" category="admonition">本文档中的任何内容均不会取代<block ref="0802e50581eb79c07178f36fed073afc" category="inline-link-rx"></block>。本内容仅供参考、不能替代VMware官方文档。</block>
  <block id="0daafa8f38daf57ac774520f73c6131b" category="section-title">根据需要创建数据存储库集群</block>
  <block id="5888812a5e670c1dc41279a5d93cc502" category="paragraph">*使用ONTAP存储时、建议禁用存储DRS。</block>
  <block id="f58d6a99824e61e497bca94714a3efef" category="list-text">通常、不需要或不建议将存储DRS用于ONTAP存储系统。</block>
  <block id="8525b77695e58a3254731f53ce2b2162" category="list-text">ONTAP提供自己的存储效率功能、例如重复数据删除、数据压缩和数据缩减、这些功能可能会受到存储DRS的影响。</block>
  <block id="c9a841ce409cdc722c7bdd080f0f88de" category="list-text">如果您使用的是ONTAP快照、则Storage vMotion会在快照中保留VM副本、这可能会提高存储利用率、并可能影响NetApp SnapCenter等跟踪VM及其ONTAP快照的备份应用程序。</block>
  <block id="e5239709587bb3ebb34629be6c41ac7b" category="paragraph">NetApp®MetroCluster™和SnapMirror主动同步(以前称为SnapMirror业务连续性或SMBC)均支持VMSC解决方案，如果一个或多个故障域发生完全中断，则可以提供高级业务连续性。不同故障模式的故障恢复能力取决于您选择的配置选项。</block>
  <block id="1e1566860cb6afbc338f9fba32c4e5e5" category="list-text">对称活动同步(ONTAP 9.15.1)</block>
  <block id="b9ca5ba97cf75d3dafb51f78e073770a" category="inline-link">NetApp文档</block>
  <block id="1c71125ba0668792e46d93c17dc6c428" category="paragraph">有关SnapMirror主动同步的特定设计和部署信息、请参见<block ref="9ace5d3ebe2fe57037322de54ac9a869" category="inline-link-rx"></block>。</block>
  <block id="c50c3de11b39aab15ac6b3b860691105" category="paragraph">通过VMware Storage DRS功能、可以将数据存储库聚合到一个单元中、并在超过存储I/O控制(SIIOC)阈值时平衡虚拟机磁盘。</block>
  <block id="a6389705a0010980a83767268763aa53" category="sidebar">使用工具的虚拟卷(Virtual Volume、ONTAP) 10.</block>
  <block id="d858ab232a556e2be473d51d09bc0c3d" category="sidebar">ONTAP工具安装检查清单</block>
  <block id="2e0a1393be1d4f990f277513b8384831" category="cell">保留默认值(1)有关详细信息、请参见<block ref="3b98534d1167689d42f2d1a533484036" category="inline-link-macro-rx"></block></block>
  <block id="79a22fb066bcc86a371f557f30051d43" category="inline-link">配置分区</block>
  <block id="b5d661217ddfecce129a41707ffa9fa9" category="list-text">确定是否要使用光纤通道(FC)进行存储连接。如果是、则必须<block ref="1ce5ae0107fd362eacaa4ef5b56c5d82" category="inline-link-rx"></block>在FC交换机上启用ESXi主机与SVM的FC LUN之间的连接。</block>
  <block id="49e1b0dac188727de519431ac2068825" category="list-text">向网络团队请求以下IP信息。前三个IP地址是必需的；节点2和节点3用于横向扩展高可用性(HA)部署。DNS主机记录为必填项、所有节点名称和所有地址都应位于同一VLAN和子网中。</block>
  <block id="7be8dd6dbcd142349f300df69f6a63d2" category="list-title"><block ref="beadfa85a2fdca06b91edc1131c603e6" category="inline-image-macro-rx" type="image"></block>存储</block>
  <block id="829d9899725b36358387edfa5df0e486" category="list-title"><block ref="99e8b2f00e172bfcff96afdce69907bc" category="inline-image-macro-rx" type="image"></block>部署OVA</block>
  <block id="2c63315a0e6899fa3f810f1b06553689" category="list-title"><block ref="ef78558f80439832e0f51cc22cee8b8c" category="inline-image-macro-rx" type="image"></block>将vCenter添加到ONTAP工具</block>
  <block id="0547f403694814dca82327ab77f95205" category="list-title"><block ref="36915574c413876eaa75cbd48f69fd00" category="inline-image-macro-rx" type="image"></block>将存储后端添加到ONTAP工具</block>
  <block id="5abf46747a299bb4d24d81d3a3f343aa" category="list-text"><block ref="40ea307f91b1c1591600230b15a0b728" category="inline-link-rx"></block>在ONTAP工具管理器中、并将其与vCenter关联。</block>
  <block id="e69b3c58a2b1480f291387c690bf92b4" category="list-text"><block ref="9f5477aac946ec407262cd052d80864d" category="inline-link-rx"></block>在ONTAP工具vCenter UI中。</block>
  <block id="9e80f1d38a7781fc49c6800d20337ec2" category="list-text"><block ref="40ea307f91b1c1591600230b15a0b728" category="inline-link-rx"></block>直接在ONTAP工具vCenter UI中。或者、在这种情况下、如果不使用Vvol、则可以直接添加SVM。</block>
  <block id="421bdf5be659af6d75aab31df92b7907" category="list-title"><block ref="430057c670c01688e904ed2ba129a0b5" category="inline-image-macro-rx" type="image"></block>配置设备服务(可选)</block>
  <block id="24db11216549ee55172c33cf3def2f3f" category="inline-image-macro">九</block>
  <block id="8a339db13a88428ad39d370cfdd1129a" category="list-title"><block ref="b37b448eff4f65237cf47b29bdd2817c" category="inline-image-macro-rx" type="image"></block>证书(可选)</block>
  <block id="a185c3c138dca5ef46afc33288a67d1f" category="inline-image-macro">十</block>
  <block id="71fc21799db94f8cae72c8732659492c" category="list-title"><block ref="6097494f0af631df68e3dcb7a6da8d2a" category="inline-image-macro-rx" type="image"></block>其他部署后任务</block>
  <block id="93da9d9a3842b9e17ab9de43211bf697" category="paragraph">有关详细信息，请参见<block ref="0802e50581eb79c07178f36fed073afc" category="inline-link-rx"></block></block>
  <block id="275507174f3ab21b1a65c1d5e8446001" category="paragraph">您还应参考<block ref="0802e50581eb79c07178f36fed073afc" category="inline-link-rx"></block>。</block>
  <block id="c44625cf01f743c720301c28e8461709" category="list-text">请注意、此步骤可能需要长达45分钟才能完成</block>
  <block id="7747c50f7bb3ac05c39d999f8d5ce43e" category="list-text">在OVA部署的第3步中、选择"自定义此虚拟机的硬件"选项、并在第10步中设置以下内容：</block>
  <block id="a7510781f5c52d40e5706471809518f0" category="list-text">"启用CPU热添加"</block>
  <block id="5b1ae3ca31ee580e9664ebf0949a302c" category="list-text">"内存热插拔"</block>
  <block id="2cd9adcb9e8de7c58834011ca647797d" category="list-text"><block ref="4ccf4d83bac775854f5f0cfb549c6d86" category="inline-link-rx"></block>如果不使用管理员、则使用随附的JSON文件。</block>
  <block id="067561a3b92d67321174249eb7de567d" category="paragraph">NetApp于2012年开始与VMware合作、为适用于vSphere 5的vSphere APIS for Storage AWARMIVAIVAICHUIAICHUDE(VASA )提供支持。通过早期的VASA Provider、可以在配置文件中定义存储功能、这些功能可用于在配置时筛选数据存储库、并在此后检查是否符合策略。随着时间的推移、这种情况不断发展、增加了一些新功能、以便在配置以及添加虚拟卷或vvol (其中、各个存储对象用于虚拟机文件和虚拟磁盘)方面实现更大的自动化。这些对象可以是LUN、文件、现在适用于vSphere 8 - NVMe命名空间(与ONTAP工具9.13P2结合使用)。NetApp与VMware密切合作、作为2015年随vSphere 6发布的vvol的参考合作伙伴、并再次作为在vSphere 8中基于网络结构使用NVMe的vvol的设计合作伙伴。NetApp将继续增强ONTAP 以利用其最新功能。</block>
  <block id="f615a85ee8b4ffd3bdd64ab72c2cf934" category="paragraph">如上所述、使用策略有助于简化配置VM或VMDK的任务。只需选择适当的策略、VASA Provider就会显示支持该策略的VVOs数据存储库、并将VVOV放入一个合规的FlexVol volume中。</block>
  <block id="5c2620ed6abb266a7824246fc409e405" category="admonition">如果卷配置为厚配置、则必须注意完全禁用该卷的所有效率功能、包括使用命令解压缩和删除重复数据删除<block ref="3cfeff511a11b8c5f54ce9749a719a58" prefix=" " category="inline-code"></block>。此卷不应显示在输出中<block ref="df899f2d908ec33afe1d01ee26b3dd47" prefix=" " category="inline-code"></block>。如果配置了效率功能、则仍会为卷部分配置效率功能。因此、覆盖保证的工作方式有所不同、这会增加配置疏忽导致卷意外用尽空间的可能性、从而导致数据库I/O错误。</block>
  <block id="d276d666f03c049a59433c8727efaa6e" category="paragraph">在Linux环境中、在整个驱动器设备上构建逻辑卷组。如果需要分区、请运行并验证每个分区的起始位置是否为八的倍数、以检查对齐<block ref="ab425294b9ef9f9c8acbc3f08f92b37d" prefix=" " category="inline-code"></block>情况。这意味着分区从八个512字节扇区的倍数开始、即4 KB。</block>
  <block id="e23f5b5639a79ab22ace94b51b47872d" category="paragraph"><block ref="e23f5b5639a79ab22ace94b51b47872d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="39e45e79eb595c951cff8267572302f1" category="inline-image-macro">SyncMirror配置</block>
  <block id="8c91b2538377a2c3400ec4694ba15e2e" category="paragraph"><block ref="8c91b2538377a2c3400ec4694ba15e2e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="073b52a996437eabf93f7783b02e2fe9" category="paragraph">该<block ref="fe3ee14511b9b1e5dfd5af1f82ac3216" category="inline-link-macro-rx"></block>软件可以在第三个站点上运行、以监控MetroCluster环境的运行状况、发送通知、并在发生灾难时强制执行切换(可选)。有关Tieb破碎 机的完整说明<block ref="2acc94a061be1196588f7f734d193bf6" category="inline-link-macro-rx"></block>，请参见，但MetroCluster Tieb破碎 机的主要用途是检测站点丢失。它还必须区分站点丢失和连接丢失。例如、切换不应因TiebREAKER无法访问主站点而发生、这就是TiebREAKER同时监控远程站点联系主站点的能力的原因。</block>
  <block id="007bfe897ab1dfc6713daff4c13130e2" category="admonition">强制切换时、MCTB软件不会验证NVRAM是否同步和/或plexes是否同步。如果已配置自动切换、则应在维护活动期间禁用、从而导致NVRAM或SyncMirror plexes失去同步。</block>
  <block id="d5e917df8e0b7f1db3996ead2cbeb2ac" category="paragraph">ONTAP调解器可与MetroCluster IP和某些其他ONTAP解决方案结合使用。它的功能与上述MetroCluster Tieb破碎 机软件非常相似、但也包括一项关键功能—执行自动无人值守切换。</block>
  <block id="bf74d7de09985a8ef553e5122b5d0f7c" category="inline-image-macro">ClusterLion图</block>
  <block id="0354d54d7a567ab0e86cd8a04f4919a1" category="paragraph"><block ref="0354d54d7a567ab0e86cd8a04f4919a1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0db380344593268d0331dffbd0e53491" category="inline-image-macro">MetroCluster IP架构</block>
  <block id="207f169ffa50efdada53e61e95be500f" category="paragraph"><block ref="207f169ffa50efdada53e61e95be500f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="d012707a79628e35e35aa78aae04ba03" category="inline-image-macro">四节点MetroCluster</block>
  <block id="d2d10d2707ff9930a55b8735ba28ca8b" category="paragraph"><block ref="d2d10d2707ff9930a55b8735ba28ca8b" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f76fa4fd08c3d58e5591281c16d5c61b" category="inline-image-macro">双节点MetroCluster</block>
  <block id="4cc7f7e2eae466068330e3136b2e786f" category="paragraph"><block ref="4cc7f7e2eae466068330e3136b2e786f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="57d3154f4afcd986d4f30b4e06c1c434" category="paragraph">ONTAP灵活卷或更简单地说、卷与LUN并不同义。卷是文件或LUN等数据的管理容器。例如、数据库可能位于一个8 LUN条带集上、所有LUN都包含在一个卷中。</block>
  <block id="05ef9b22209f0e35efc9b6f875ad3c55" category="inline-link-macro">ONTAP文档。</block>
  <block id="a9f5ed6c3fb24e75b9bbfde2801f43c5" category="paragraph">有关快照的详细信息、请参见<block ref="8f47a9b0ccec19c7f5d940ab138ea0b4" category="inline-link-macro-rx"></block></block>
  <block id="7509bd2cfd7821f433d962315cc50a57" category="paragraph">从ONTAP 9.12.1开始、快照不仅是只读的、还可以防止意外或故意删除。此功能称为防篡改快照。可以通过Snapshot策略设置和实施保留期限。生成的快照在达到到期日期之前无法删除。不会覆盖管理或支持中心。</block>
  <block id="287130f9ebd13d6ed68dd04d8d2a295e" category="admonition">不能使用光纤池对防篡改快照进行分层。</block>
  <block id="c2f55c662895ff4fac4100a2a0852e43" category="paragraph">有关防篡改快照的详细信息、请参见<block ref="fd5bfd16d2f3d4d67a500529a5ee8cad" category="inline-link-macro-rx"></block></block>
  <block id="be7dc70d98bcb6099a5c94c0eb263502" category="paragraph">也可以将快照复制到远程系统。这包括防篡改快照、即在远程系统上应用和实施保留期限。结果是、数据保护优势与本地快照相同、但数据位于另一个存储阵列上。这样可以确保销毁原始阵列不会影响备份。</block>
  <block id="170814cc5599dd2691018c487b6c756b" category="paragraph">有关SnapMirror的详细信息、请参见<block ref="3a921b7bc4d1ecfb45f8d64003b59241" category="inline-link-macro-rx"></block></block>
  <block id="f1e054edf08e67911f64f3d6bc85055c" category="paragraph">新配置的ONTAP存储系统与新配置的VMware ESX服务器类似、因为在创建虚拟机之前、这两个系统都不能支持任何用户。通过ONTAP、您可以创建一个Storage Virtual Machine (SVM)、此SVM将成为存储管理的最基本单元。每个SVM都有自己的存储资源、协议配置、IP地址和FCP WWN。这是ONTAP多租户的基础。</block>
  <block id="9f531561663c2d70601e59d0a2a97e22" category="paragraph">有关SVM的详细信息、请参见<block ref="49f63552efbf93d6a834173c0aa523ad" category="inline-link-macro-rx"></block></block>
  <block id="7995495e3afeef685b0a0bcf51360d6c" category="paragraph">有关管理访问控制的详细信息、请参见<block ref="a0740fbcbe9ba6690a7ab99ab89cd2c9" category="inline-link-macro-rx"></block></block>
  <block id="19fd31cbf45473230fbcebf8392cc91e" category="section-title">多因素身份验证(MFA)</block>
  <block id="96654aef2c50a23153b1537b5229776f" category="paragraph">有关多因素身份验证(MFA)的详细信息、请参见<block ref="1786169af27633b737f29186948225e1" category="inline-link-macro-rx"></block></block>
  <block id="e888b1b74bec5238c3c604159ac1d53a" category="paragraph">有关API RBAC的详细信息、请参见<block ref="e61ba9faf8dbe169378ea875c9b479b4" category="inline-link-macro-rx"></block></block>
  <block id="6e09a67fb21def2cb508cbfe0d7c0794" category="paragraph">有关多管理员验证(MAV)的详细信息、请参见<block ref="88147b7c4319c7463e1de20879284ceb" category="inline-link-macro-rx"></block></block>
  <block id="d682e5055f8368ad42d44e0de5e75ed3" category="inline-image-macro">SnapMirror主动同步正常操作</block>
  <block id="a61d348ee21d7fdf1a9da822a79df846" category="paragraph"><block ref="a61d348ee21d7fdf1a9da822a79df846" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3fe281f607d85b52408e82cb2d7aef71" category="inline-image-macro">SnapMirror活动同步失败</block>
  <block id="c5ff28a15762db1ce9589bc45fe42a83" category="paragraph"><block ref="c5ff28a15762db1ce9589bc45fe42a83" category="inline-image-macro-rx" type="image"></block></block>
  <block id="a98433bfbc9755650778888be2e155c8" category="inline-image-macro">SnapMirror主动同步故障转移</block>
  <block id="5fe2be834f0686a9a02a2872ecb20f91" category="paragraph"><block ref="5fe2be834f0686a9a02a2872ecb20f91" category="inline-image-macro-rx" type="image"></block></block>
  <block id="40685542fb725d5516910c5721538340" category="inline-image-macro">SnapMirror主动同步修复</block>
  <block id="67e60a13c39559320bab1f6f456824d0" category="paragraph"><block ref="67e60a13c39559320bab1f6f456824d0" category="inline-image-macro-rx" type="image"></block></block>
  <block id="217536ed57b639cdf05f688cf8ddaca1" category="inline-image-macro">SnapMirror主动同步故障恢复</block>
  <block id="362b862a6b72622be34b2904dcbf413b" category="paragraph"><block ref="362b862a6b72622be34b2904dcbf413b" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f060f17ec7a3fc2a182a4759545d4cb3" category="paragraph"><block ref="f060f17ec7a3fc2a182a4759545d4cb3" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3d25a1eebebf538e68ea79a21fdeb31c" category="paragraph"><block ref="3d25a1eebebf538e68ea79a21fdeb31c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1cf9d22584fea5a10f4ed164a871a45f" category="paragraph"><block ref="1cf9d22584fea5a10f4ed164a871a45f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4be3d396256a7548ce446a9a03183122" category="paragraph"><block ref="4be3d396256a7548ce446a9a03183122" category="inline-image-macro-rx" type="image"></block></block>
  <block id="05933557921f3e80d9d78fff7d9532d6" category="paragraph"><block ref="05933557921f3e80d9d78fff7d9532d6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2a5e066e529edd11b35f46c161170620" category="paragraph">相比之下、Oracle RAC等集群应用程序可以提供在两个不同站点上同时提供的服务。丢失站点并不意味着整个应用程序服务都会丢失。实例仍可用、并且在正常运行的站点上运行。</block>
  <block id="d629eadf33041c24ee81c3752a895f8d" category="paragraph"><block ref="d629eadf33041c24ee81c3752a895f8d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="267017761cb9de7ce4e0ea9f0e078628" category="paragraph"><block ref="267017761cb9de7ce4e0ea9f0e078628" category="inline-image-macro-rx" type="image"></block></block>
  <block id="fd994146b555ce2a39038a16098a6e3e" category="list-text"><block ref="9df22f196a33acd0b372fe502de51211" prefix="" category="inline-code"></block>-仅检索随机读取的数据</block>
  <block id="0c65a737281c49235c3058020e81f7b9" category="list-text"><block ref="8805d416ce540c5f2df34af5b18d742b" prefix="" category="inline-code"></block>-检索所有按顺序或随机读取的数据</block>
  <block id="deea309eeb62f907bfa37ca436857255" category="list-text"><block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix="" category="inline-code"></block>-检索所有按顺序或随机读取的数据</block>
  <block id="c4216ce97dadec9cf3de76609a5a07de" category="list-text"><block ref="a181a603769c1f98ad927e7367c7aa51" prefix="" category="inline-code"></block>-不从容量层检索数据</block>
  <block id="47f64097ec44c9f18f4025941f2e4436" category="inline-image-macro">FabricPool 分层</block>
  <block id="0a5778c8b17c5df28190c8f022c4e11a" category="paragraph"><block ref="0a5778c8b17c5df28190c8f022c4e11a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e6edcd80dc55ce70fb5c4fa1c13c9bc6" category="section-title">超线程</block>
  <block id="7e4c522ec8e0c58e24f493765888ed54" category="paragraph">超线程是指同时多线程(SMT)实施、可提高x86处理器上执行计算的并行性。SMT在Intel和AMD处理器上均可用。</block>
  <block id="4114d233d42e1381db8a36ed5a76930b" category="paragraph">超线程会导致逻辑CPU在操作系统中显示为物理CPU。然后、SQL Server会看到这些额外的CPU、并将其用作核心数多于物理内核数的情况。这可以通过提高并行处理能力显著提高性能。</block>
  <block id="fbb6d18b081bfa69df40139eb4b0213b" category="inline-image-macro">SQL Server日志消息</block>
  <block id="d78202a5fb91002bb31924c80636beee" category="paragraph"><block ref="d78202a5fb91002bb31924c80636beee" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8f2b07811863589142fb500958a93aef" category="paragraph">尽管这对于大型查询很有用、但它可能会出现发生原因性能问题并限制并发性。一种更好的方法是、将并行处理限制为单个CPU插槽中的物理核心数。例如、在具有两个物理CPU插槽且每个插槽具有12个核心的服务器上、无论是否使用超线程、均<block ref="1abedc5f6ab369ab9fcd16d6b7990638" prefix=" " category="inline-code"></block>应设置为12。<block ref="1abedc5f6ab369ab9fcd16d6b7990638" prefix=" " category="inline-code"></block>不能限制或指定要使用的CPU。相反、它会限制单个批处理查询可使用的CPU数量。</block>
  <block id="2bcdfd16d227f0659d58f9c368f92311" category="inline-link-macro">配置最大工作线程数服务器配置选项</block>
  <block id="784d03ae991a0cc4ef7f8b5318d0643e" category="paragraph">应在何时配置SQL Server以使用更多工作线程？如果每个计划程序的平均工作队列长度超过1、则向系统添加更多线程可能会更有用、但前提是负载不受CPU制约或遇到任何其他繁重等待。如果出现上述任一情况、添加更多线程将毫无帮助、因为它们最终会等待其他系统瓶颈。有关最大工作线程数的详细信息，请参见<block ref="516f4431a9f331f442450f80b5638a9d" category="inline-link-macro-rx"></block>。</block>
  <block id="a5ee78f6f06a355d893076bd00799f33" category="inline-image-macro">最大工作线程数</block>
  <block id="06a7934dd21e03f634b6cd9fc8dfafd5" category="paragraph"><block ref="06a7934dd21e03f634b6cd9fc8dfafd5" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c7acc2cdcff9c9156a99e4f37871f0b3" category="searchtitle">使用SnapCenter和T-SQL命令保护ONTAP上的Microsoft SQL Server数据库</block>
  <block id="d56a13248537a908d7fb7730827a3ea8" category="paragraph">确保SQL Server数据库环境的安全是一项多方面的工作、不仅限于管理数据库本身。ONTAP提供了多种独特的功能、旨在保护数据库基础架构的存储方面。</block>
  <block id="1fdd8a4c4832d13ddabbb02c424cf87d" category="paragraph">如果在切换之前灾难恢复站点未使用托管虚拟化数据库的卷、文件系统和数据存储库、则无需在关联的卷上设置<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block>。</block>
  <block id="358f73eb3e0830400b47b849dd1ff244" category="summary">Microsoft SQL Server和ONTAP调解器</block>
  <block id="d7b47db08dce16a62f9ea97613e8f704" category="paragraph">要安全地自动执行故障转移、需要使用调解器。理想情况下、它会放置在独立的第三个站点上、但如果与参与复制的集群之一主机代管、它仍可满足大多数需求。</block>
  <block id="f9619e52c7cdde4c0b1a97530a47dd35" category="section-title">SnapMirror主动同步架构与对称主动/主动架构</block>
  <block id="19faeb7ab81d5f28227fc1778d55ff90" category="inline-image-macro">SnapMirror主动同步架构</block>
  <block id="133eca4b24d6c05606859c2288c8ac7f" category="paragraph"><block ref="133eca4b24d6c05606859c2288c8ac7f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="441756ba9f536a754940c70c53cb3b13" category="paragraph">** ONTAP调解器**</block>
  <block id="b41efcb6893de373f77e07be9a8e0d32" category="paragraph"><block ref="b41efcb6893de373f77e07be9a8e0d32" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f830e7995cd120ac203db751bdb1174b" category="paragraph">NetApp提供了Asta三项功能来提供高级存储管理功能。例如、Asta三元数据可以使在Kubnetes中创建的容器自动在适当的层上配置其存储、应用导出策略、设置快照策略、甚至可以将一个容器克隆到另一个容器。有关更多信息，请参见<block ref="d243cca937364184efa824b0525b876a" category="inline-link-macro-rx"></block>。</block>
  <block id="e5f3f995b3e054f0d6bfdd13c3597e2c" category="paragraph"><block ref="e5f3f995b3e054f0d6bfdd13c3597e2c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9b87cb3e85b59ad2d04537560673f94b" category="inline-image-macro">I/O类型</block>
  <block id="977d1017b39374152ac0d18ac3267ca2" category="paragraph"><block ref="977d1017b39374152ac0d18ac3267ca2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="77ea00d93c10244a077ab55be57f5c28" category="admonition">如果将此参数或InnoDB_IO_capACity_max参数设置得过高并设置为"wastin"、可能会严重影响性能</block>
  <block id="04a3449528520ec35e2bce9c433ee1a4" category="admonition">在新的ASA平台中、使用_vault_ policy将快照复制到远程集群、然后锁定目标以使快照不受篡改。</block>
  <block id="c1a5c6240b77f4bda50ebb9ea018010b" category="paragraph"><block ref="c1a5c6240b77f4bda50ebb9ea018010b" category="inline-image-macro-rx" type="image"></block></block>
  <block id="a1fb4e9793df0c2c759586b0d4cc9a59" category="inline-link-macro">计算容量限制(按SQL Server版本)</block>
  <block id="c637f2ccb4ed04efecb5d430f9b8e9fa" category="paragraph">此处需要注意的是、每个SQL Server版本都有自己的计算能力限制。有关详细信息，请参见 <block ref="5f7d6b9101e39b0f89ce2a4419443b58" category="inline-link-macro-rx"></block>。</block>
  <block id="027202a07b43ba49311d98b7812a6c84" category="searchtitle">使用NetApp管理软件保护Microsoft SQL Server数据</block>
  <block id="a6612611980ab8001eb37d9b0d21fc8b" category="list-text">使用新的backup group和backup server命令同时对存储单元上的多个数据库执行快照。</block>
  <block id="0dedd2c3e15900b4f533838e17976dab" category="list-text">如果数据库工作负载跨多个存储单元、请创建一致性组以简化管理任务。一致性组是指作为单个单元进行管理的一组存储单元。</block>
  <block id="7f9d52f3748a3a0f2854076ed4952d80" category="admonition">* NetApp建议*使用SnapCenter创建Snapshot副本。上述T-SQL方法同样有效、但SnapCenter可实现备份、还原和克隆过程的完全自动化。同时、它还会执行发现以确保创建的快照正确无误。</block>
  <block id="19f005706f432809f0c867f9d97c05b0" category="admonition">* NetApp建议*使用SnapCenter创建Snapshot副本。上述T-SQL方法同样有效、但SnapCenter可实现备份、还原和克隆过程的完全自动化。同时、它还会执行发现以确保创建的快照正确无误。无需预配置。</block>
  <block id="88db39456c39e1de4d937d721ec1f2fc" category="doc">数据库文件和文件组</block>
  <block id="2bcb2e2e60d655aca12a6062bc99f69c" category="section-title">数据库实例文件初始化</block>
  <block id="44f4b94c8c1ceb120fb9fb9a843fbc0b" category="paragraph">SQL Server无中断可用性组复制功能是一个绝佳的选择、NetApp提供了将数据保护与无中断集成的选项。但是、在某些情况下、您可能需要考虑使用以下选项的ONTAP复制技术。</block>
  <block id="5698ceeb808e1afe078605b6dbb0a4cb" category="paragraph">SnapMirror技术为通过LAN和广域网复制数据提供了快速灵活的企业解决方案。SnapMirror技术仅在创建初始镜像后将更改后的数据块传输到目标、从而显著降低网络带宽要求。它可以配置为同步或异步模式。NetApp ASA中的SnapMirror同步复制使用SnapMirror活动同步进行配置。</block>
  <block id="8d4bad202645c8ab15f054b63fe34160" category="paragraph">对于许多客户来说、业务连续性不仅需要拥有远程数据副本、还需要能够快速利用这些数据、而在NetApp ONTAP中、可以使用SnapMirror主动同步来实现这一点</block>
  <block id="07b431b6fdd20fcb79eababc436bc39b" category="paragraph">使用SnapMirror主动同步时、您实际上拥有两个不同的ONTAP系统、它们会维护LUN数据的独立副本、但会相互协作、为该LUN提供一个实例。从主机角度来看、它是一个LUN实体。基于iSCSI/FC的LUN支持SnapMirror主动同步。</block>
  <block id="2ae812ab75c34451d9dd11549d394f2a" category="paragraph">SnapMirror主动同步可以提供RPO = 0复制、并且可以轻松地在两个独立的集群之间实施。当两个数据副本处于同步状态后、两个集群只需镜像写入即可。在一个集群上进行写入时、该写入会复制到另一个集群。只有在两个站点上的写入均已完成时、才会向主机确认写入。除了此协议拆分行为之外、这两个集群在其他方面都是正常的ONTAP集群。</block>
  <block id="1848ac209b4ee9b7c68bbc4a1711a45d" category="paragraph">SM-AS的另一个主要用例是主动-主动操作、您希望在位于两个不同位置的两个不同集群上提供完全可用的数据副本、这些集群具有相同的性能特征、如果需要、也不需要在站点间延伸SAN。如果应用程序受支持、则您的应用程序可能已在这两个站点上运行、这样可以减少故障转移操作期间的整体恢复时间。</block>
  <block id="bdd8b094b65ec8544e0ad9724a1984ad" category="searchtitle">Microsoft SQL Server和SnapMirror主动同步故障转移</block>
  <block id="3fc36a3b35bb877723ed17d69c3d57fb" category="summary">Microsoft SQL Server和ONTAP调解器</block>
  <block id="b029689b71622a39b3564f8800798f34" category="paragraph"><block ref="b029689b71622a39b3564f8800798f34" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5a2e2e33df9734d8ef57bcb93643d89a" category="paragraph">相比之下、Oracle RAC等集群应用程序可以提供在两个不同站点上同时提供的服务。丢失站点并不意味着整个应用程序服务都会丢失。实例仍可用、并且在正常运行的站点上运行。</block>
  <block id="a87e788e43169f3df56a7eee4e9bd79c" category="searchtitle">SQL Server和SnapMirror活动同步</block>
  <block id="5181c0b41b072fc878e6ffdb78976292" category="paragraph">SnapMirror主动同步支持对称主动/主动架构、可提供同步双向复制、以实现业务连续性和灾难恢复。它可以跨多个故障域同时对数据进行读写访问、从而帮助您保护关键SAN工作负载的数据访问、从而确保无中断运行、并在发生灾难或系统故障时最大限度地减少停机时间。</block>
  <block id="3fa280b2a8840046be265109ff9f0696" category="section-title">SnapMirror主动与对称主动/主动的架构</block>
  <block id="a93a13dd139e6bb0629cd0ace446c595" category="paragraph"><block ref="a93a13dd139e6bb0629cd0ace446c595" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c2048364072b2c53688aeb273047e068" category="paragraph">** ONTAP调解器**</block>
  <block id="309d61d5c343d8fd53c2c585c64587b6" category="searchtitle">具有SnapMirror活动同步的Microsoft SQL Server</block>
  <block id="c3764435b077d7aa876e89575fe5dd64" category="paragraph"><block ref="c3764435b077d7aa876e89575fe5dd64" category="inline-image-macro-rx" type="image"></block></block>
  <block id="335b6de9aebdde6ff1e76f9688ff7ff7" category="paragraph"><block ref="335b6de9aebdde6ff1e76f9688ff7ff7" category="inline-image-macro-rx" type="image"></block></block>
  <block id="481a499afea5f44d3d3173e0504a6ee5" category="paragraph">使用统一访问时、IO将跨越WAN。这是一个全网状网络集群、在所有使用情形中、这可能是可取的、也可能不理想。</block>
  <block id="e7de94b63ec3b4535a16228dd6f49119" category="paragraph">如果两个站点之间相距100米且具有光纤连接、则WAN上不会出现可检测到的额外延迟、但如果两个站点相距较远、则两个站点上的读取性能都会受到影响。使用非一致访问网络的ASA可以获得ASA的成本和功能优势、而不会造成跨站点延迟访问损失、也不会使用主机邻近功能允许两个站点进行站点本地读/写访问。</block>
  <block id="cb2187a7d951edc5247ba9c129fee8f3" category="paragraph">配置主机邻近性后、路径将如下所示。</block>
  <block id="277d64d9a84f721cc341e91f0de1dcae" category="inline-image-macro">SnapMirror主动同步ASA统一邻近网络</block>
  <block id="7ee14065ea840a8b3d77ca1b09cd0d68" category="paragraph"><block ref="7ee14065ea840a8b3d77ca1b09cd0d68" category="inline-image-macro-rx" type="image"></block></block>
  <block id="988f5836c7a60d1374a4804da23d51e4" category="paragraph"><block ref="988f5836c7a60d1374a4804da23d51e4" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b7986b8213ecdd63004689cc2dedb163" category="searchtitle">使用SnapMirror进行Microsoft SQL Server灾难恢复</block>
  <block id="f10483e265b11816545d508fc76923ed" category="list-text">同步复制与SnapMirror主动同步结合使用、后者对快速数据恢复的需求较高、而异步解决方案则可实现RPO的灵活性。</block>
  <block id="76deb86c7bf1ea33d737ef060d9ffff6" category="list-text">如果您使用SnapCenter备份数据库并将快照复制到远程集群、请勿出于一致性目的从控制器计划SnapMirror更新。而是应启用SnapCenter中的SnapMirror更新、以便在完整备份或日志备份完成后更新SnapMirror。</block>
  <block id="ad2a53b49c8e7cc0e22f4346908a1866" category="list-text">在集群中的不同节点之间平衡包含SQL Server数据的存储单元、以允许所有集群节点共享SnapMirror复制活动。此分布可优化节点资源的使用。</block>
  <block id="98b161980bf5831bfe65c048b46d0439" category="summary">在ASA上放置Microsoft SQL Server数据库文件</block>
  <block id="1b1b4c822e9c1b28b845dcc038fec08e" category="searchtitle">Microsoft SQL Server数据库文件和文件组</block>
  <block id="ba25a3e50659c5e29996ff4f5d42a259" category="paragraph">日志目录在SQL Server中指定、用于在主机级别存储事务日志备份数据。如果使用SnapCenter备份日志文件、则SnapCenter使用的每个SQL Server主机都必须配置一个主机日志目录、才能执行日志备份。</block>
  <block id="c05ca2066a3b729016e386c067cd91b4" category="paragraph">将日志目录放在专用存储单元上。主机日志目录中的数据量取决于备份的大小以及备份的保留天数。SnapCenter只允许每个SQL Server主机有一个主机日志目录。您可以在SnapCenter --&gt; Host --&gt; Configure Plug-in中配置主机日志目录。</block>
  <block id="74432d98a78bf2e3e3b497b91dc1c516" category="list-text">在SnapCenter将事务日志复制到的专用存储单元上创建主机日志目录。</block>
  <block id="00b0277b7e21cfea83e1cd6202498b9e" category="list-text">如果您使用的是无中断故障转移集群实例、则用于主机日志目录的存储单元必须是与要在SnapCenter中备份的SQL Server实例位于同一集群组中的集群磁盘资源。</block>
  <block id="c42f502d6a45acd6c1d2a13f44016270" category="summary">ASA系统上的Microsoft SQL Server存储注意事项</block>
  <block id="e7a0b265e1ae7c0bf7047bd4770bc53d" category="paragraph">NetApp ASA R2是一款简化且功能强大的解决方案、适用于运行任务关键型工作负载的纯SAN客户。运行ONTAP存储解决方案的ASA R2平台与Microsoft SQL Server相结合、可以实现企业级数据库存储设计、从而满足当今最苛刻的应用程序要求。</block>
  <block id="95cc7be66d78a646c5ee563f83198ab4" category="paragraph">以下ASA平台归类为支持所有SAN协议(iSCSI、FC、NVMe/FC、NVMe/TCP)的ASA R2系统。iSCSI、FC、NVMe/FC和NVMe/TCP协议支持对称双主动多路径架构、以便主机和存储之间的所有路径都处于主动/优化状态：</block>
  <block id="5d6a7459a3583d9e29f4b486d809b6a1" category="list-text">ASA A1K</block>
  <block id="009f19d7e9e80eda1c7dbf7374519e58" category="list-text">ASA A90</block>
  <block id="cd527b2aadf2bebf28ba082002724ab0" category="list-text">ASA A70</block>
  <block id="3ee9bc9a210bd85fa921ca63bdeef612" category="list-text">ASA A50</block>
  <block id="e21bdbd552261278be0a5ad02fbc6fa7" category="list-text">ASA A30</block>
  <block id="3c609b480f1311eaec9774146ac50e79" category="list-text">ASA A20</block>
  <block id="2b304856171196502641312a496c6d54" category="inline-link-macro">NetApp ASA</block>
  <block id="4dd59f71d7cf036df0941aa4fcd50443" category="paragraph">有关详细信息、请参见 <block ref="a37d9d52d65391d0ce6c582426431be1" category="inline-link-macro-rx"></block></block>
  <block id="bb9a4cadd83e3ce26b592d1a9eeafb2e" category="paragraph">要优化基于ONTAP的SQL Server解决方案、需要了解SQL Server I/O模式和特征。为SQL Server数据库精心设计的存储布局必须支持SQL Server的性能要求、同时还必须在整体上最大限度地提高基础架构的可管理性。良好的存储布局还可以成功完成初始部署、并随着业务的增长逐步平稳地扩展环境。</block>
  <block id="bfdf538d8298e1c20008ee59ebb494a0" category="paragraph">Microsoft建议将数据和日志文件放在不同的驱动器上。对于同时更新和请求数据的应用程序、日志文件会占用大量写入资源、而数据文件(取决于您的应用程序)会占用大量读/写资源。对于数据检索、不需要日志文件。因此、可以通过放置在其自己驱动器上的数据文件来满足数据请求。</block>
  <block id="801afe45de7db517b57f747a8973280a" category="section-title">存储单元注意事项</block>
  <block id="5e64d69892f623826e85a5239abf0607" category="paragraph">ASA中的存储单元是指SCSI/FC主机的LUN或NVMe主机的命名空间。根据支持的协议、系统将提示您创建LUN和/或NVMe命名空间。在为数据库部署创建存储单元之前、请务必了解SQL Server I/O模式和特征如何根据工作负载以及备份和恢复要求而有所不同。请参见以下存储单元的NetApp建议：</block>
  <block id="506a88168c6bdfeb32f8fae8409c1eba" category="list-text">避免在同一主机上运行的多个SQL Server之间共享同一存储单元、以避免复杂的管理。如果在同一主机上运行多个SQL Server实例、则除非某个节点上的存储单元接近限制、否则请避免共享、而是为每个主机的每个实例设置单独的存储单元、以简化数据管理。</block>
  <block id="3c00c0b1042b695af03e498424f2ee1e" category="list-text">使用NTFS挂载点而不是驱动器盘符、以超过Windows中26个驱动器盘符的限制。</block>
  <block id="216443bb5f5d2545cc1881816458e899" category="list-text">禁用快照计划和保留策略。请改用SnapCenter来协调SQL Server数据存储单元的Snapshot副本。</block>
  <block id="44d48620d1d725aaad54d642f73970a9" category="list-text">将SQL Server系统数据库放在专用存储单元上。</block>
  <block id="5375f513e791de754ec7d070bbf5512c" category="list-text">tempdb是一个系统数据库、SQL Server会使用它作为临时工作空间、尤其是用于I/O密集型DBCC CHECKDB操作。因此、请将此数据库放在专用存储单元上。在存储单元计数存在挑战的大型环境中、您可以在仔细规划后将tempdb与系统数据库整合到同一存储单元中。tempdb的数据保护不是高优先级、因为每次重新启动SQL Server时都会重新创建此数据库。</block>
  <block id="5b2b825a890a5ed31984f174b5420a05" category="list-text">将用户数据文件<block ref="937f38432beb92fdba3d47780720bdf7" prefix="(" category="inline-code"></block>()放在单独的存储单元上，因为它们是随机读/写工作负载。通常、创建事务日志备份的频率比创建数据库备份的频率更高。因此，请将事务日志文件<block ref="cb15b9539ae0d984ff8740c68b52561c" prefix="(" category="inline-code"></block>()放在与数据文件不同的存储单元或VMDK上，以便可以为每个存储单元或VMDK创建独立的备份计划。这种分离还会将日志文件的顺序写入I/O与数据文件的随机读/写I/O隔离开来、并显著提高SQL Server性能。</block>
  <block id="892e3db84641b51931ab0dac9977d1bf" category="list-text">确保用户数据库文件和用于存储日志备份的日志目录位于单独的存储单元上、以防止保留策略在存储策略中的SnapMirror功能中使用快照时覆盖快照。</block>
  <block id="d3bcdc884b8b6c9a2e038e5aca8eb201" category="list-text">请勿在同一存储单元上混合使用数据库文件和非数据库文件、例如与全文搜索相关的文件。</block>
  <block id="c7b140168b3cdc8eaaa3041ffa0d954a" category="list-text">将数据库二级文件(作为文件组的一部分)放在单独的存储单元上可提高SQL Server数据库的性能。只有当数据库的文件不与任何其他文件共享其存储单元<block ref="937f38432beb92fdba3d47780720bdf7" prefix=" " category="inline-code"></block>时、此隔离才有效<block ref="937f38432beb92fdba3d47780720bdf7" prefix=" " category="inline-code"></block>。</block>
  <block id="47d411a79b7445f424218bb5a6265a1a" category="list-text">在Windows服务器中使用磁盘管理器格式化磁盘时、请确保分区的分配单元大小设置为64K。</block>
  <block id="b1d3c04670a31b00b47ed2f54cef4f19" category="list-text">请勿将用户数据库或系统数据库放置在托管挂载点的存储单元上。</block>
  <block id="995050bacc63636e91e211836cab350a" category="list-text">如果您使用的是无中断故障转移集群实例、则必须将用户数据库置于在Windows服务器故障转移集群节点之间共享的存储单元上、并且物理磁盘集群资源会分配给与SQL Server实例关联的集群组。</block>
  <block id="79b0cf2c987928face3999e45504752c" category="sidebar">AFF或FAS系统上的存储配置</block>
  <block id="120f8cb87e8ceb36804a526419a5803a" category="sidebar">基于Microsoft/SQL系统的AFF FAS</block>
  <block id="fc5b2b3c5350dcd6f3cc1cc3cdf1a13f" category="sidebar">ASA R2系统上的存储配置</block>
  <block id="8bdbdec629db36efc1c9bdbf743dd56a" category="sidebar">ASA系统上的Microsoft SQL Server</block>
  <block id="3e2b4674c9afc41f9c3a0311b458ed23" category="list-text">如果卷和(或) LUN未进行精简配置、则必须禁用所有效率设置、因为使用这些功能不会节省空间、并且将厚配置与空间效率结合使用可能会导致意外行为、包括空间不足错误。</block>
  <block id="c2dc7d465f4be5df7a663820063fe07c" category="summary">使用SnapCenter的Microsoft SQL Server可用性组</block>
  <block id="b474dc2fb6ce60c11ecdfbe0a373bf34" category="doc">使用SnapCenter的SQL Server可用性组</block>
  <block id="0a1151b962e7b34ea7fa78538961cc63" category="paragraph">SnapCenter支持备份使用Windows故障转移集群配置的SQL Server可用性组数据库。</block>
  <block id="55876228853abf632dec9346a4f372ec" category="inline-link-macro">文档</block>
  <block id="19bc77c28d506c79f4e3acd767956f68" category="paragraph">适用于Microsoft SQL Server的SnapCenter插件必须安装在Windows服务器故障转移集群的所有节点上。有关设置SnapCenter插件的前提条件和步骤、请参见<block ref="7ea17b48fc658598752bd1b70818d0c2" category="inline-link-macro-rx"></block>。</block>
  <block id="878026ceb11256fd34df776a768794b2" category="paragraph">SnapCenter会发现Windows主机中的所有数据库、实例和可用性组、SnapCenter资源页面上会枚举这些主机和资源。</block>
  <block id="feb288d4161a267b78f781ef497c33f6" category="section-title">保护始终可用性组中的数据库</block>
  <block id="6493759953e55bc95c88e42046f8c8e1" category="paragraph">可用性组中的数据库可以通过多种方式进行保护。</block>
  <block id="71903a5ca626286195e8839f74b46627" category="list-text">数据库级备份：为数据库资源页面选择可用性数据库、添加包含完整备份/日志备份的策略、并计划备份。无论数据库角色是主副本还是二级副本、SnapCenter都会执行备份。也可以通过将数据库添加到资源组来配置保护。</block>
  <block id="402962f18d83fc2e3da0155e7c85d340" category="list-text">实例级备份：选择实例、实例上运行的所有数据库将根据选定策略受到保护。所有数据库(包括作为主副本或二级副本运行的可用性数据库)都会使用SnapCenter进行备份。也可以通过将实例添加到资源组来配置此保护。</block>
  <block id="4eea6cb4e656587b45ce878e96aced6c" category="list-text">可用性组级别备份：配置策略时、SnapCenter提供了一个用于可用性组级别备份的高级选项。策略中的可用性组设置允许用户选择要备份的副本首选项。您可以选择主副本、二级副本或全部副本。默认选项基于SQL Server可用性组配置中的备份副本集。</block>
  <block id="df79a1b2903886af697a431a42cecd61" category="paragraph">仅当可用性组级别备份用于保护可用性组数据库而不适用于数据库或实例级别备份时、SnapCenter策略中的可用性组设置才会适用。</block>
  <block id="2b371d66d8eda6963cd085c7a884f4d7" category="admonition">* NetApp建议*使用可用性级别备份来备份在NetApp ONTAP存储上运行的所有副本。</block>
  <block id="5c0ae1f6e89ffad82dfe5e7773da2fd6" category="section-title">在SnapCenter中配置日志备份</block>
  <block id="b3b9b1046ddf8efb1b774f35855a0d1c" category="paragraph">如果在独立SQL Server设置中设置了可用性组、则必须在Windows服务器故障转移集群的每个节点上挂载一个专用磁盘。应使用专用磁盘配置日志目录以保存事务日志备份。</block>
  <block id="ac3f0583ff584e6a0d60cd070d6edce2" category="paragraph">如果在SQL Server故障转移集群上设置了可用性组、则应在SQL Server故障转移集群实例上创建集群磁盘、以托管日志目录。</block>
  <block id="57194431a839a253461e94f7d15e0d30" category="section-title">使用SnapCenter在可用性组设置中还原数据库</block>
  <block id="cb66b1b1ce1e9f56d0a1572ba3dcccdd" category="list-text">SnapCenter提供了reeseed选项、可从二级副本上提供的最新快照自动恢复数据库。重新密封操作将自动还原数据库备份并将其加入可用性组。</block>
  <block id="4c25cf6fd81e138392692e0a7e5523f3" category="list-text">在可用性组中还原副本数据库的另一种方法是、中断可用性组并执行完整的完整还原和日志还原。使用SnapCenter在恢复模式下还原数据库、然后使用SQL Server Management Studio或T-SQL将数据库重新加入可用性组。</block>
  <block id="533d3de92f8337e84aa0eccec7e4698f" category="list-text">要仅恢复部分数据、可以使用SnapCenter的克隆功能创建数据库的克隆副本。使用SnapCenter在几分钟内创建数据库副本、然后使用SQL Server本机工具将数据导出到主副本。</block>
  <block id="f652b77e8bd5ef106d3fbeec02a874c5" category="inline-link-macro">TR-4714《使用NetApp SnapCenter的Microsoft SQL Server最佳实践》</block>
  <block id="9cc210a8901b58403ed2b299b9f87ac9" category="paragraph">有关设置数据库存储布局以满足RTO和RPO要求的最佳实践，请参见<block ref="4619ebf0116b8a67a7bd991a2d661c12" category="inline-link-macro-rx"></block>。</block>
  <block id="724394156ac637a07abed4b02026424a" category="admonition">SnapCenter不支持分布式可用性组和包含的可用性组。</block>
  <block id="f9feae8e1753d6486bf95d4403f7d5a7" category="list-text">请勿在FAS中包含SQL Server数据文件的任何卷上启用重复数据删除、除非已知该卷包含同一数据的多个副本、例如、将数据库从备份还原到单个卷。</block>
  <block id="3e7987259108445ae7c1491ed79b073d" category="list-text">此时、LUN将命名为"簇磁盘"、并在磁盘下显示为可用存储。</block>
  <block id="c1e7f55d2b03b3e23328dcdcd802d754" category="list-text">右键单击LUN ("集群磁盘")、然后单击添加到集群共享卷。现在、LUN显示为CSV。</block>
  <block id="43e27ab0f91db8b4bb59d8e4c4d1e8ed" category="list-text">将NanoServerImageGenerator文件夹从Windows Server ISO中的\NanoServer文件夹复制到本地硬盘。</block>
  <block id="7e5f3f135d7a8c51734f09f3d5a12050" category="list-text">以管理员身份启动Windows PowerShell、导航到本地硬盘上复制的纳米服务器映像生成器文件夹、然后运行以下cmdlet：</block>
  <block id="eacb5e0f83e8ccaa90b1b924f6610ac2" category="paragraph">通过NetApp ONTAP中的存储服务质量(QoS)、您可以对存储对象进行分组、并为组设置吞吐量限制。存储服务质量(QoS)可用于限制工作负载的吞吐量并监控工作负载性能。借助此功能、存储管理员可以按组织、应用程序、业务单位或生产或开发环境分离工作负载。</block>
  <block id="34d1a06b342ddf788eb8d311a6a90b0f" category="paragraph">此外、重复数据删除、NetApp FlexClone (R)副本、NetApp快照技术、精简配置、数据压缩和存储分层等NetApp存储效率功能为Windows Server上运行的工作负载提供了显著价值。</block>
  <block id="832d3120e6d9fa2f59f4e48705370613" category="paragraph">多个节点聚合到一个集群系统中。集群中的节点会持续相互通信、以协调集群活动。此外、这些节点还可以使用冗余路径连接到由两个10 Gb以太网交换机组成的专用集群互连、从而在节点之间透明地移动数据。在任何故障转移情形下、集群中的节点都可以相互接管、以提供高可用性。集群在整个集群而非每个节点上进行管理、并从一个或多个Storage Virtual Machine (SVM)提供数据。一个集群必须至少具有一个SVM才能提供数据。</block>
  <block id="7d1f2201f5f9a58716d9d3945ca25236" category="paragraph">集群的基本单元是节点、节点会作为高可用性(HA)对的一部分添加到集群中。HA对通过HA互连(与专用集群互连分开)相互通信并维护与HA对磁盘的冗余连接、从而实现高可用性。尽管磁盘架可能包含属于HA对任一成员的磁盘、但HA对之间不会共享磁盘。下图展示了Windows Server环境中的NetApp存储部署。</block>
  <block id="89b1c55fe8e272ac47674f0cc764a248" category="paragraph">NetApp PowerShell工具包(PSTK)是一个PowerShell模块、可提供端到端自动化并支持ONTAP的存储管理。ONTAP模块包含2、000多个cmdlet、可帮助管理NetApp AFF、FAS、商用硬件和云资源。</block>
  <block id="511fb782308cb99c53153d22cdb1d521" category="list-text">在对Hyper-V使用iSCSI LUN时、请确保在Hyper-V主机的防火墙设置中启用"入站iSCSI服务(tcp-in)"和"出站iSCSI服务(tcp-out)"。这样可以使iSCSI流量进出Hyper-V主机和NetApp控制器。</block>
  <block id="faccfad1846422576248770b7a6395e9" category="list-text">使用虚拟光纤通道配置VM需要启用了N_Port ID虚拟化的FC HBA。最多支持四个FC端口。</block>
  <block id="7b0285f3bc080c0c79f477f620f40e9e" category="list-text">有关FC HBA的信息，请参见<block ref="5555d80b97794db0ba7e8564a4b85ca4" category="inline-link-rx"></block>。</block>
  <block id="f00baf160282989fbb1cb808699a6f2a" category="paragraph">Hyper-V集群模式服务器(称为节点)通过物理网络和集群软件进行连接。这些节点使用共享存储来存储VM文件、其中包括配置、虚拟硬盘(Virtual Hard Disk、VHD)文件和快照。共享存储可以是NetApp SMB/CCIFS共享、也可以是基于NetApp LUN的CSV、如下所示。此共享存储可提供一个一致的分布式命名空间、集群中的所有节点均可同时访问此命名空间。因此、如果集群中的一个节点发生故障、另一个节点将通过故障转移过程提供服务。故障转移集群可以使用故障转移集群管理器管理单元和故障转移集群Windows PowerShell cmdlet进行管理。</block>
  <block id="111539b465998ea501279f7e74e96c23" category="paragraph">ONTAP可通过增强的性能和效率提供NetApp存储效率功能、例如NetApp快照技术、克隆、重复数据删除、精简配置、精简复制、数据压缩、虚拟存储分层等。</block>
  <block id="77c4f5b694a7632dd418203c35b28001" category="paragraph">有关经过测试且受支持的SAN和NAS配置的定期更新的完整列表、请参见<block ref="5555d80b97794db0ba7e8564a4b85ca4" category="inline-link-rx"></block>NetApp支持站点上的。通过IMT、您可以确定特定环境支持的确切产品和功能版本。NetApp IMT定义了与NetApp支持的配置兼容的产品组件和版本。具体结果取决于每个客户是否按照已发布的规格进行安装。</block>
  <block id="5dda25d6b4e823951b5421768be35626" category="paragraph">LUN的直接路径是指SVM的Lifs和要访问的LUN位于同一节点上的路径。要从物理目标端口转到磁盘、无需遍历集群互连。</block>
  <block id="c364dd3fe0de768ba9017fa088c60e25" category="paragraph">间接路径是指SVM的Lifs和要访问的LUN位于不同节点上的数据路径。数据必须遍历集群互连、才能从物理目标端口传输到磁盘。</block>
  <block id="2111c0c11662be8bb8715d01b06012e1" category="summary">TR-4792提供了在由NVIDIA图形处理单元(GPU)和虚拟化软件提供支持的VMware Horiz前景 环境中将NetApp 615 C用于3D图形工作负载的指导。</block>
  <block id="3797bd9f7fdebe600f0b50130ab6e88e" category="doc">适用于VMware vSphere 9.13访问点(用户)的ONTAP工具</block>
  <block id="fe3b52cc276d9b4f6ff1d7dd52ebf482" category="doc">每个用户的最大并发请求数(网络安全保护/DOS攻击)适用于VMware vSphere的ONTAP工具9.13</block>
  <block id="999ce5ccae91de7a317d5634f874aaf1" category="doc">ONTAP工具9.13 HTTPS证书</block>
  <block id="773a7bfeb117dbffddb5069c857898f1" category="doc">验证适用于VMware vSphere 9.13的ONTAP工具安装包的完整性</block>
  <block id="d0190e0d0c684fb3bf0db89bc85d9fa8" category="list-text">导航到证书管理UI：a.从主菜单中、选择管理。b.在证书下、单击证书管理。</block>
  <block id="e8783ca43a9865b78e97faa419114d3c" category="doc">ONTAP工具9.13登录横幅</block>
  <block id="3b3c746ae575763a882807d59864cd91" category="paragraph">用户在登录提示符中输入用户名后、将显示以下登录横幅。请注意、SSH在默认情况下处于禁用状态、如果从VM控制台启用了SSH、则只允许一次性登录。</block>
  <block id="5d012d90287d95d6d8add32b5532516f" category="doc">ONTAP工具9.13相互TLS (基于证书的身份验证)</block>
  <block id="985cdfe4013537c1d4d5c214f7c0dd0d" category="doc">ONTAP工具的网络时间协议(NTP)配置9.13.</block>
  <block id="5b0454dc521b829107eee95fdbdcf609" category="doc">适用于VMware vSphere 9.13的ONTAP工具安全强化指南</block>
  <block id="2b7bcb6c5618e904562d6803c126f1fd" category="doc">ONTAP工具的密码策略9.13.</block>
  <block id="00100652bee31d3d3d08d4e151ec666b" category="doc">ONTAP工具的端口和协议9.13.</block>
  <block id="db739753b5ca22081d5a70569c187468" category="paragraph">请注意下表、其中列出了ONTAP工具正常运行所需的入站和出站端口。请务必确保仅为远程计算机的连接打开表中提到的端口、而为远程计算机的连接应阻止所有其他端口。这将有助于确保系统的安全性和安全性。</block>
  <block id="9fbc29d1252118b9f8037064f509bbc6" category="doc">ONTAP工具的非活动超时9.13.</block>
  <block id="67119628cfd34ebda11e94844fd8ae42" category="inline-link-macro"><block ref="67119628cfd34ebda11e94844fd8ae42" category="inline-link-rx"></block></block>
  <block id="e1d3de60f7ed9e2b5f5783aa86ff23d8" category="list-text">适用于VMware vSphere 10.x的ONTAP工具资源<block ref="2a13554f799535d02439d73fba6b8874" category="inline-link-macro-rx"></block></block>
  <block id="430d5e16a0652c5ee12e9434368c8970" category="list-text">适用于VMware vSphere 9.x的ONTAP工具资源<block ref="9d52dd6d1c195e015d4baef3146522a8" category="inline-link-macro-rx"></block></block>
  <block id="4644d098069796f6576040c27eaa2902" category="inline-link-macro"><block ref="4644d098069796f6576040c27eaa2902" category="inline-link-rx"></block></block>
  <block id="f9b6e9a89bb3e4c6302d8214e9ef8e1f" category="list-text">VMware Live Site Recovery文档<block ref="401159cdbd602df2732f9d02a280896a" category="inline-link-macro-rx"></block></block>
  <block id="0a94bde8cd1434df225de9583026ce2a" category="paragraph">要验证您的特定环境是否支持本文档所述的确切产品和功能版本、请参见<block ref="de89165a46abdf575eb9a1ba0995e131" category="inline-link-macro-rx"></block>NetApp支持站点上的。NetApp IMT 定义了可用于构建 NetApp 支持的配置的产品组件和版本。具体结果取决于每个客户是否按照已发布的规格进行安装。</block>
  <block id="92f5dfcc91de805d4d9a5e53648b4d2a" category="section-title">使用最新版本的ONTAP工具10</block>
  <block id="1464492cec5287ef61574839a96af5c6" category="paragraph">与先前版本相比、ONTAP工具10提供了以下显著改进：</block>
  <block id="b87867526ca4f4c733e3ce06f5010124" category="list-text">测试故障转移速度加快8倍*</block>
  <block id="27074144cd68d611ee2ff77b05e534c7" category="list-text">清理和重新保护速度加快2倍*</block>
  <block id="3b8fbbed2d84b9255b899aa6e5ca940a" category="list-text">故障转移速度加快32%*</block>
  <block id="aec894aa3f9e8a2faa2fbdd72e233401" category="list-text">对共享站点布局的本机支持</block>
  <block id="bee99bc5e766f9e6501e1f77a31daf3b" category="paragraph">*这些改进基于内部测试、可能因环境而异。</block>
  <block id="d7d8e8809bed362c1ee6bc2b541e379d" category="list-text">默认 vsadmin SVM 帐户没有执行 ONTAP 工具任务所需的访问级别。因此、您需要创建新的SVM帐户。<block ref="4010916266efe7d8b0185d4d2025f808" category="inline-link-rx"></block>使用随附的JSON文件。这可以用于 SVM 或集群范围的帐户。</block>
  <block id="87849b3f2b772c5e059e8e32ae26acba" category="list-text">由于vCenter UI插件、VASA Provider和SRA服务器都是完全集成的微服务、因此您必须按照在适用于ONTAP的vCenter UI工具中添加存储的方式向SRM中的SRA适配器添加存储。否则， SRA 服务器可能无法识别通过 SRA 适配器从 SRM 发送的请求。</block>
  <block id="132951122a677efd5c41a88deabeabd8" category="list-text">使用SVM范围的凭据时、不会执行NFS路径检查、除非首先<block ref="ea2efd531a0984091e8158139d5ccc0c" category="inline-link-rx"></block>使用ONTAP工具管理器并将其与vCenter关联。这是因为物理位置从 SVM 中进行了逻辑抽象。不过，这并不是一个值得关注的发生原因，因为现代 ONTAP 系统在使用间接路径时不再出现任何明显的性能下降。</block>
  <block id="0a1fcbae4c54aa60a8f2fe5671680e27" category="doc">使用了以下新功能：使用了、ONTAP使用了、使用了、使用了、使用了</block>
  <block id="03a93b2df7509ea17938237f51860034" category="paragraph">近二十年来， NetApp 与 VMware 建立了深厚的合作关系，并努力尽快为最新版本提供支持。请始终检查NetApp<block ref="5a1370857464a2f4fc64961fad76707f" category="inline-link-rx"></block>以了解最新的合格软件组合。</block>
  <block id="bdbeaf4744c4096d9ca05899a1b20ac6" category="list-text">SRM 8.2 （ 8.1 ， 8.3 和 8 ）不支持。支持4及更高版本)</block>
  <block id="99d2e422e054ee65d15c388ce83e3aad" category="list-text">检查<block ref="5a1370857464a2f4fc64961fad76707f" category="inline-link-rx"></block>以获取最新的合格版本。</block>
  <block id="03e80035ff033dbb43bc1cf4dfd27b9d" category="paragraph">ONTAP工具10.4 SRA现在可支持最大扩展范围的vr/SRM。</block>
  <block id="5b71ff881fa46f7d950270720dfba930" category="list-text">受保护VM总数= 5000</block>
  <block id="00b46b3bd011b06ddc97d2d87f3f693c" category="list-text">每个保护组的VM数= 1000</block>
  <block id="f13d5084a9427ce818e051b68dd775de" category="list-text">恢复计划总数= 250</block>
  <block id="32037bfb6e7cea15bb8d753bacb8c6f1" category="list-text">每个恢复计划的保护组总数= 250</block>
  <block id="0e10d41896dde55f485a601573eb4cd1" category="list-text">复制的数据存储库总数= 255</block>
  <block id="9f1fc329126d15e2b5b7ab32cb32d7b5" category="list-text">并发运行的恢复计划的总数。= 10</block>
  <block id="1e1088bfcfb8add5780ae378f2754112" category="paragraph">现在， SRA 服务器配置可通过 REST API 进行管理。我们添加了Swagger UI来帮助您构建自动化工作流，您可以在ONTAP工具设备上找到该用户界面，网址为<block ref="8a609c6f0b4bce52148730c8d12b504f" prefix=" " category="inline-code"></block>。</block>
  <block id="0544f3896fcb77e4b634ce110f6bd9b9" category="list-text">每个站点的 SAN 协议都应是同构的。您可以混合使用 NFS 和 SAN ，但不应在站点内混合使用 SAN 协议。例如、您可以在站点A中使用FCP、而在站点B中使用iSCSI。您不应在站点A中同时使用FCP和iSCSI</block>
  <block id="4e3807553eb007466c17fb67a2210f32" category="list-text">之前的指南建议创建LIF以定位数据。也就是说，始终使用物理拥有卷的节点上的 LIF 挂载数据存储库。虽然这仍然是最佳实践、但在ONTAP 9的现代版本中、这不再是一项要求。如果给定了集群范围的凭据、则ONTAP工具仍会尽可能选择在数据本地的各个LUN之间进行负载平衡、但这并不是高可用性或高性能的要求。</block>
  <block id="f48bad2be9e924ec16a98855ffa5205d" category="list-text">可以将ONTAP 9配置为在自动调整大小无法提供足够的紧急容量时自动删除快照、以便在空间不足的情况下保持正常运行时间。此功能的默认设置不会自动删除由SnapMirror创建的快照。如果删除了SnapMirror快照、则NetApp SRA将无法反转和重新同步受影响卷的复制。要防止ONTAP删除SnapMirror快照、请将快照自动删除功能配置为"try"。</block>
  <block id="9d9eddaf9d0daee09cf623c1a7efe898" category="inline-link-macro">将卷配置为自动增长和缩减其大小</block>
  <block id="cdf854c312fc769dc7a37371e3862cf7" category="list-text">对于包含SAN数据存储库的卷和NFS数据存储库、<block ref="d89f4f8b1d7c18847b88b46142f61535" prefix=" " category="inline-code"></block>应将卷自动调整设置为<block ref="4d200fce73a8e1cc965cfc2c43343824" prefix=" " category="inline-code"></block>。有关此主题的更多信息，请访问<block ref="1e69033938f9e72dbed381804139dcb7" category="inline-link-macro-rx"></block>。</block>
  <block id="0f5c04a3e7eeab838bfbea0da2647014" category="paragraph">复制组包含同时恢复的虚拟机的逻辑集合。由于 ONTAP SnapMirror 复制是在卷级别进行的，因此卷中的所有 VM 都位于同一个复制组中。</block>
  <block id="5e3d02d3d6c87568b9fb31c561e3c30c" category="paragraph">对于复制组以及如何在 FlexVol 卷之间分布虚拟机，需要考虑几个因素。对于缺少聚合级重复数据删除的旧版ONTAP系统、将相似的VM分组在同一个卷中可以提高存储效率、但分组会增加卷的大小并减少卷I/O并发性。在现代ONTAP系统中、可以通过在同一聚合中的FlexVol卷之间分布虚拟机、从而利用聚合级重复数据删除并在多个卷之间实现更大的I/O并行处理能力、从而在性能和存储效率之间实现最佳平衡。您可以同时恢复卷中的 VM ，因为一个保护组（如下所述）可以包含多个复制组。这种布局的缺点是、数据块可能会通过缆线多次传输、因为SnapMirror不会考虑聚合重复数据删除。</block>
  <block id="63e4890c97de111da0d06968949b7dd9" category="paragraph">例如、您的公司可能拥有一个第1层业务关键型应用程序、该应用程序的数据库依赖于Microsoft SQL Server。因此，您决定将 VM 置于优先级组 1 中。在优先级组 1 中，您开始规划订单以启动服务。您可能希望Microsoft Windows域控制器在Microsoft SQL Server之前启动、而Microsoft SQL Server需要在应用程序服务器之前联机、依此类推。您可以将所有这些VM添加到优先级组、然后设置依赖关系、因为依赖关系仅适用于给定优先级组。</block>
  <block id="d64567ab52d5b1768fa4574f7913b737" category="paragraph">作为最佳实践、每当对受保护VM存储的配置进行更改时、都应始终执行测试故障转移。这样可以确保在发生灾难时、您可以相信Site Recovery Manager可以在预期的Recovery目标范围内还原服务。</block>
  <block id="440c65ed1c918c9b0812a49f7d368131" category="summary">适用于VMware Live Site Recovery (vrr)和Site Recovery Manager (SRM)的ONTAP解决方案</block>
  <block id="05d7c63979cf1697d07b8942ba9871b7" category="doc">使用ONTAP进行VMware实时站点恢复</block>
  <block id="26f37d417bce4746b39183f7a16780af" category="paragraph">自2002年引入现代数据中心以来、ONTAP已成为VMware vSphere以及最近的Cloud Foundation环境的主要存储解决方案。它继续推出创新功能、以简化管理并降低成本。</block>
  <block id="e0982d67f17f6b02d88a0cbc066cd4ae" category="paragraph">本文档重点介绍与适用于VMware vSphere 10.4的ONTAP工具(包括NetApp存储复制适配器[SRA ]和VASA Provider [VP])以及VMware Live Site Recovery 9结合使用时、ONTAP 9最新版本中的功能。</block>
  <block id="07f63b028c614758695673e7c08bb043" category="section-title">为什么要将ONTAP与甚量卷请求或SRM结合使用？</block>
  <block id="785b838a99d90e91a3859239a468a546" category="section-title">VLSR 如何利用 ONTAP 9</block>
  <block id="1625d4b695f746dca5ff4f4c76ddee9c" category="paragraph">VLSR 可通过与适用于 VMware vSphere 的 ONTAP 工具集成来利用 ONTAP 系统的高级数据管理技术， VMware vSphere 是一种虚拟设备，其中包括三个主要组件：</block>
  <block id="69fc564a57c8d57102ff1d2144ad8232" category="list-text">无论您使用的是SAN还是NAS、ONTAP工具vCenter插件(以前称为虚拟存储控制台(VSC))均可简化存储管理和效率功能、提高可用性并降低存储成本和运营开销。它使用最佳实践配置数据存储库，并为 NFS 和块存储环境优化 ESXi 主机设置。为了获得所有这些优势、在将vSphere与运行ONTAP的系统结合使用时、NetApp建议使用此插件。</block>
  <block id="60da32bc0bc08789d91b50e6c1e297c4" category="list-text">ONTAP工具VASA Provider支持VMware vStorage APIS for Storage Aware (VASA)框架。VASA Provider 可将 vCenter Server 与 ONTAP 连接起来，以帮助配置和监控 VM 存储。这样、便可支持VMware虚拟卷(vvol)并管理VM存储策略和单个VM vvol性能。此外，它还提供警报，用于监控容量以及配置文件合规性。</block>
  <block id="aedad0f692989ea8f930a5704478b317" category="list-text">SRA 与 VLSR 结合使用，用于管理传统 VMFS 和 NFS 数据存储库的生产站点和灾难恢复站点之间的 VM 数据复制，并用于无中断测试灾难恢复副本。它有助于自动执行发现，恢复和重新保护任务。它既包含一个SRA服务器设备、又包含用于Windows SRM服务器和vrr设备的SRA适配器。</block>
  <block id="9220276841499e90e16d19b02e4be757" category="paragraph">SRA为VSR服务器提供了一个命令和控制界面、用于管理包含VMware虚拟机(VM)的ONTAP FlexVol卷以及对其进行保护的SnapMirror复制。</block>
  <block id="1590566734d497290ef7dec19c83ae27" category="paragraph">如果发生真正的灾难甚至是计划内迁移， VLSR 允许您通过最终 SnapMirror 更新（如果您选择这样做）向数据集发送任何最后一分钟的更改。然后，它会中断镜像并将数据存储库挂载到灾难恢复主机。此时，您可以根据预先规划的策略按任意顺序自动启动 VM 。</block>
  <block id="ad84b24a08fcf7b630aabbaa227285e4" category="admonition">虽然ONTAP系统允许您将同一集群中的SVM配对以进行SnapMirror复制、但这种情况不会通过VLSR的测试和认证。因此、建议在使用VLSR时仅使用不同集群中的SVM。</block>
  <block id="7c4dce5fd159dd8fdded222a89550c4b" category="section-title">采用 ONTAP 的 VLSR 以及其他使用情形：混合云和迁移</block>
  <block id="8fff56a05881c6f706c3ed3a782050f2" category="paragraph">VLSR 还可用于执行计划内迁移，方法是利用 SnapMirror 将 VM 从一个数据中心高效地传输到另一个数据中心，甚至在同一个数据中心内高效地传输 VM ，无论您自己还是通过任意数量的 NetApp 合作伙伴服务提供商。</block>
  <block id="d274b8ae04172dec40c6aa0549b00986" category="summary">将ONTAP与SnapMirror以及VMware vrSR和SRM结合使用的复制拓扑。</block>
  <block id="08db3b842a4cb2c270982436a350d96f" category="paragraph">一个虚拟机不能在多个 VLSR 阵列上拥有虚拟机磁盘（ Virtual Machine Disk ， VMDK ）或 RDM 数据，原因如下：</block>
  <block id="d8a9d635a5de68d706349e0ba1582a33" category="list-text">VLSR 只能识别 SVM ，而不能识别单个物理控制器。</block>
  <block id="03a2d94e9dd3faa9d1c2ba5048e50ff5" category="cell">要确定可支持性，请牢记以下规则：要使用 VLSR 和 NetApp SRA 保护 VM ， VM 的所有部分都必须仅位于一个 SVM 上。此规则适用于受保护站点和恢复站点。</block>
  <block id="e30b1ded833744ef423f9c06bfca3bab" category="paragraph">下图显示了 VLSR 和 SRA 支持的 SnapMirror 关系布局方案。复制卷中的每个 VM 在每个站点上仅拥有一个 VLSR 阵列（ SVM ）上的数据。</block>
  <block id="aefe28ee95511224d6209514d7186d90" category="paragraph">在 VLSR 中使用基于阵列的复制（ ABR ）时，保护组会隔离到一个阵列对中，如以下屏幕截图所示。在此场景中、<block ref="129864522ed0e4ac80f306ecfa130ef7" prefix=" " category="inline-code"></block>和<block ref="ec87aa7f4c8e70a139fd988f87b6549f" prefix=" " category="inline-code"></block>与恢复站点上的和<block ref="58bdbfcb72c2dd3d883a7ca754443a4c" prefix=" " category="inline-code"></block>建立对等关系<block ref="387d04b65848414d4697f145a3782f90" prefix=" " category="inline-code"></block>。但是，在创建保护组时，您只能选择两个阵列对中的一个。</block>
  <block id="2e7b54c50f0d287a5bf008ad268a0789" category="paragraph">不受支持的配置会在单个虚拟机所拥有的多个 SVM 上包含数据（ VMDK 或 RDM ）。在下图所示的示例中、<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block>无法使用VSR配置保护、因为<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block>数据位于两个SVM上。</block>
  <block id="4fdeeea2f6ee5d6350aa8d922fb0a5af" category="paragraph">如果任何复制关系将单个 NetApp 卷从一个源 SVM 复制到同一 SVM 或不同 SVM 中的多个目标，则称为 SnapMirror 扇出。VLSR 不支持扇出。在下图所示的示例中、<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block>无法配置用于在虚拟卷访问请求中进行保护、因为它会使用SnapMirror复制到两个不同位置。</block>
  <block id="9aaec9a7e35a54378af7cf34a10ff7ad" category="paragraph">VLSR 不支持 SnapMirror 关系的级联，即，将源卷复制到目标卷，同时使用 SnapMirror 将目标卷复制到另一个目标卷。在下图所示的情形中，不能使用 VLSR 在任何站点之间进行故障转移。</block>
  <block id="c37d439a6d3a3437f39236143c5a460a" category="paragraph">NetApp SnapVault 软件支持在 NetApp 存储系统之间对企业数据进行基于磁盘的备份。SnapVault 和 SnapMirror 可以同时位于同一环境中；但是， VLSR 仅支持 SnapMirror 关系的故障转移。</block>
  <block id="79f08fde51df68a19d8383c68f8adebb" category="paragraph">可以在级联配置中创建源卷，在级联配置中，卷会复制到灾难恢复站点中的 SnapMirror 目标，然后从该位置存储到 SnapVault 目标。也可以在扇出关系中创建源卷，其中一个目标是 SnapMirror 目标，另一个目标是 SnapVault 目标。但是，在发生 VLSR 故障转移或复制反转时， SRA 不会自动重新配置 SnapVault 关系以使用 SnapMirror 目标卷作为存储源。</block>
  <block id="4cc1b133c2294fcf3e444666786b490e" category="cell">如果在同一环境中使用 SnapVault 和 VLSR ， NetApp 建议使用 SnapMirror 到 SnapVault 级联配置，其中通常会从灾难恢复站点的 SnapMirror 目标执行 SnapVault 备份。发生灾难时，此配置会使主站点无法访问。通过将 SnapVault 目标保留在恢复站点上，可以在故障转移后重新配置 SnapVault 备份，以便在恢复站点上运行时可以继续执行 SnapVault 备份。</block>
  <block id="28ce1496405d55f61c08746bcc7d2134" category="paragraph">在 VMware 环境中，每个数据存储库都有一个通用唯一标识符（ UUID ），每个 VM 都有一个唯一的受管对象 ID （ MOID ）。在故障转移或故障恢复期间， VLSR 不会维护这些 ID 。由于 VLSR 在故障转移期间不会维护数据存储库 UUID 和 VM MOID ，因此，在 VLSR 故障转移后，必须重新配置依赖这些 ID 的所有应用程序。例如， NetApp Active IQ Unified Manager 可将 SnapVault 复制与 vSphere 环境进行协调。</block>
  <block id="36021caed35d3ff177cae271cf95e17f" category="paragraph">下图显示了使用 VLSR 将 SnapMirror 复制反转回主站点后的配置。此外，还对环境进行了重新配置，使 SnapVault 备份从现在的 SnapMirror 源进行。此设置为 SnapMirror SnapVault 扇出配置。</block>
  <block id="b352b28b9db88c716b387eac7bfd478e" category="paragraph">在vsrm执行故障恢复并再次反转SnapMirror关系后、生产数据将返回到主站点。现在，此数据将通过 SnapMirror 和 SnapVault 备份获得与故障转移到灾难恢复站点之前相同的保护方式。</block>
  <block id="0df9db9c3f8671a5c3e32d66c594a54d" category="paragraph">qtrees是一种特殊目录、可用于为NAS应用文件系统配额。ONTAP 9 允许创建 qtree ，而 qtree 可以存在于使用 SnapMirror 复制的卷中。但是、SnapMirror不允许复制单个qtree或进行qtree级复制。所有 SnapMirror 复制仅在卷级别进行。因此， NetApp 不建议在 VLSR 中使用 qtree 。</block>
  <block id="5c7eaf04fc264c6082cadf5fd01b4cd3" category="paragraph">VMware VLSR 和 NetApp SRA 支持在一个站点使用 FC 协议，而在另一个站点使用 iSCSI 协议。但是，不支持在同一 ESXi 主机或同一集群中的不同主机中混合使用 FC 连接的数据存储库和 iSCSI 连接的数据存储库。VLSR 不支持此配置，因为在 VLSR 故障转移或测试故障转移期间， VLSR 会在请求中包括 ESXi 主机中的所有 FC 和 iSCSI 启动程序。</block>
  <block id="612460a6891d7eecad16636b2ccd03ec" category="cell">VLSR 和 SRA 支持在受保护站点和恢复站点之间混合使用 FC 和 iSCSI 协议。但是，每个站点只能配置一个 FC 或 iSCSI 协议，而不能在同一站点上同时配置这两个协议。如果要求在同一站点同时配置 FC 和 iSCSI 协议， NetApp 建议某些主机使用 iSCSI ，而其他主机使用 FC 。在这种情况下， NetApp 还建议设置 VLSR 资源映射，以便将 VM 配置为故障转移到一组主机或另一组主机。</block>
  <block id="2fc50e10e291654a0ac526fdd9d85edd" category="doc">使用卷复制时对volSRM/SRM进行故障排除</block>
  <block id="3d0b50d268649e9f201008e1735764c1" category="paragraph">使用ONTAP工具9.13P2时、使用vvol复制时、vSR和SRM中的工作流与使用SRA和传统数据存储库时的工作流明显不同。例如，没有阵列管理器概念。因此、<block ref="0ec64480a9620a1430c0ae1b6603ea01" prefix=" " category="inline-code"></block>和<block ref="ba6c59072f543cb828e47d5bac560371" prefix=" " category="inline-code"></block>命令永远不会显示出来。</block>
  <block id="36c0e0bf3cbce9baff381f0038982596" category="inline-link">Omnissa地平线景观</block>
  <block id="713e31d24f394517ddb2727e75ad1c07" category="list-text">使用 vSphere API —阵列集成（ VAAI ）进行 vSphere 克隆和迁移。在SAN和NAS环境中、可以将VM克隆操作卸载到ONTAP (NetApp提供了一个ESXi插件来为NFS启用VAAI)。vSphere仅会卸载NAS数据存储库中冷(已关闭) VM上的操作、而热VM上的操作(克隆和Storage vMotion)也会卸载到SAN上。ONTAP根据源和目标使用最高效的方法。此功能也可供使用<block ref="d752e276b58b6c367f27570fc3212480" category="inline-link-rx"></block>。</block>
  <block id="f6f2c5686cc4f0cddb9b97a821855375" category="list-text">SRA (与VMware Live Site Recon/Site Recovery Manager结合使用)。此处，克隆用于无中断测试灾难恢复副本的恢复情况。</block>
  <block id="ab145b0c5bc936679238040b42d242a8" category="list-text">使用 SnapCenter 等 NetApp 工具进行备份和恢复。VM克隆用于验证备份操作以及挂载VM备份、以便可以还原各个文件。</block>
  <block id="b1fd904929f16090f01753d2728346c6" category="paragraph">VMware ， NetApp 和第三方工具可以调用 ONTAP 卸载克隆。卸载到 ONTAP 的克隆具有多个优势。在大多数情况下，它们节省空间，只需要存储即可更改对象；读取和写入它们不会产生额外的性能影响，在某些情况下，通过在高速缓存中共享块来提高性能。它们还会从 ESXi 服务器卸载 CPU 周期和网络 I/O 。使用FlexVol volume的传统数据存储库中的副本卸载在获得FlexClone许可(包含在ONTAP One许可证中)的情况下可以快速而高效、但FlexVol卷之间的副本速度可能会较慢。如果您将 VM 模板维护为克隆源，请考虑将其放置在数据存储库卷中（使用文件夹或内容库对其进行组织），以实现节省空间的快速克隆。</block>
  <block id="706253931ccf2225bbabb539eead1ee1" category="paragraph">ONTAP 9.8以及适用于VMware vSphere的ONTAP工具9.8-9.13和适用于VMware 4.4及更高版本的SnapCenter插件增加了对vSphere中FlexGroup卷支持的数据存储库的支持。FlexGroup卷可以简化大型数据存储库的创建过程、并自动在ONTAP集群中创建必要的分布式成分卷、以最大程度地提高ONTAP系统的性能。</block>
  <block id="fea36c6d0158f7614a47593cee5c4381" category="paragraph">如果您需要一个具有完整ONTAP集群功能的可扩展vSphere数据存储库、或者如果您的克隆工作负载非常大、可以通过持续保持克隆缓存预热来从FlexGroup克隆机制中受益、请将FlexGroup卷与vSphere结合使用。</block>
  <block id="4b2e7f21f2ab284dbe47715a088a87e4" category="paragraph">除了对vSphere工作负载进行广泛的系统测试之外、ONTAP 9.8还为FlexGroup数据存储库添加了一种新的副本卸载机制。这一新系统使用经过改进的复制引擎在后台成分卷之间复制文件、同时允许访问源和目标。然后、可以使用此成分卷本地缓存根据需要快速例化VM克隆。</block>
  <block id="a8abf0cad71a45472969fad71143d9b0" category="inline-link">如何配置ONTAP FlexGroup卷以允许VAAI副本卸载</block>
  <block id="c53113221d1d9379aed8b77f57224f6d" category="paragraph">要启用FlexGroup优化的副本卸载、请参见<block ref="fbd3cc38c04df5a782d56a4261d462a4" category="inline-link-rx"></block></block>
  <block id="dd2b1d725ccce54064350ab418850836" category="paragraph">有关将FlexGroup卷与VAAI结合使用的详细信息、请参阅此知识库文章：<block ref="23db52497ce446299e31ecc0b7572649" category="inline-link-rx"></block></block>
  <block id="b66d69c6b478b422763ae8a4362fd4cc" category="paragraph">请注意、VMware vSphere会将NFS数据存储库的所有IO视为每个主机的一个队列、而一个VM上的QoS限制可能会影响该主机的同一数据存储库中其他VM的性能。这与Vvol不同、Vvol可以在迁移到另一个数据存储库时保持其QoS策略设置、并且在受到控制时不会影响其他VM的IO。</block>
  <block id="55fcf4f8582fc20cbc496c8370d02a9f" category="list-text">从ONTAP 9.14.1开始、VMware和NetApp支持NFSv4.1会话中继。有关特定版本的详细信息、请参见NetApp NFS 4.1互操作性表工具(IMT)说明。从vSphere 8.0U2开始、NFSv3不支持卷的多个物理路径、但支持nconnect。有关nconnect的详细信息，请参见<block ref="2b967deae9aa9df284273d8dd1c4a3f3" category="inline-link-macro-rx"></block>。</block>
  <block id="692b0504520eb51f2f7e36bb610ab39c" category="list-text">使用适用于 VMware VAAI 的 NFS 插件执行副本卸载。请注意、如前文所述、虽然FlexGroup数据存储库中的克隆功能得到了增强、但在FlexVol和/或FlexGroup卷之间复制VM时、ONTAP与ESXi主机副本相比、不会提供显著的性能优势。因此、在决定使用VAAI或FlexGroup卷时、请考虑克隆工作负载。修改成分卷数量是针对基于FlexGroup的克隆进行优化的一种方法。正如调整前面提到的缓存超时。</block>
  <block id="7e6aa8006e5e8e08a135d46ba03f7aca" category="list-text">使用适用于VMware vSphere的ONTAP工具9.8-9.13通过ONTAP指标(信息板和VM报告)监控FlexGroup VM的性能、并管理各个VM上的QoS。目前无法通过 ONTAP 命令或 API 获得这些指标。</block>
  <block id="b8ed23c8b817e9613412fc97543a876a" category="list-text">如果使用fpolicy、请务必排除.lck文件、因为vSphere会使用这些文件在启动虚拟机时进行锁定。</block>
  <block id="d76b03755162bf8402fea0ef97d95c2b" category="list-text">有关支持所需的特定ESXi修补程序级别、请参见中的NFS v4.1互操作性表说明<block ref="aaa18d9ccb38f09094f0c241a8585efd" category="inline-link-macro-rx"></block>。</block>
  <block id="2e5d8aa3dfa8ef34ca5131d20f9dad51" category="inline-link-macro">设置</block>
  <block id="428a818039f2f00961fdd9e4de07b721" category="inline-link">VMware 知识库 386364</block>
  <block id="e43e8e9d4a1f6f9dbd56154ac2df4c6a" category="list-text">如中所述<block ref="5c427f7294fd54c254262776a96b148a" category="inline-link-macro-rx"></block>，如果您不使用适用于Kubnetes的vSphere CSI，则应将newSyncInterval设置为<block ref="e3529737a3b4eef7cff2c05dcd47fcdc" category="inline-link-rx"></block></block>
  <block id="686d950560445531708a511e6ad1567c" category="paragraph">在vSphere中、可以通过四种方式使用块存储设备：</block>
  <block id="8f3179360beae87966e6fc5f46edfb7b" category="list-text">作为一个卷数据存储库</block>
  <block id="041c0652f0218403d2721d2ddd9260df" category="admonition">块区是一个vSphere存储概念、您可以将多个LUN "拼接"在一起、以创建一个更大的数据存储库。切勿使用块区来达到所需的数据存储库大小。对于VMFS数据存储库、最佳做法是使用一个LUN。</block>
  <block id="9d6605bbb339340832866d8bab7bf7e5" category="paragraph">vSphere内置了对存储设备的多个路径的支持。vSphere可以检测受支持存储系统的存储设备类型、并自动配置多路径堆栈以支持所使用存储系统的功能、无论所使用的协议如何、也无论使用的是ASA、AFF、FAS还是软件定义的ONTAP。</block>
  <block id="4dbfcd0fae38bf4e35602557a83d9ea3" category="paragraph">vSphere和ONTAP均支持使用NVMe/FC和NVMe/TCP为光纤通道和iSCSI建立主动/优化和主动/非优化路径、并为NVMe命名空间建立非对称命名空间访问(ANA）。在ONTAP中、AUA或ANA优化的路径遵循直接数据路径、使用托管要访问的LUN或命名空间的节点上的目标端口。默认情况下、vSphere和ONTAP均会启用ALOA/ANA。vSphere中的多路径软件会将ONTAP集群识别为AUA或ANA、并使用适当的本机插件和轮叫负载平衡策略。</block>
  <block id="c35f72eea36b7f94209ed29c1e457501" category="paragraph">在NetApp的ASA系统中、LUN和名称库会通过对称路径提供给ESXi主机。表示所有路径均处于活动状态并已进行优化。vSphere中的多路径软件会将ASA系统识别为对称系统、并使用适当的本机插件和循环负载平衡策略。</block>
  <block id="719d3c21fd388bea9bc6e0ae1f7aead3" category="admonition">有关优化的多路径设置、请参见<block ref="1f38ac07598dbb4b06912539aafa4211" category="inline-link-macro-rx"></block>。</block>
  <block id="ab0394f516e490b8b46d91283e6b9f4f" category="paragraph">ESXi不会发现任何超出其限制的LUN、名称和路径。在较大的 ONTAP 集群中，可以在达到 LUN 限制之前达到路径限制。为了解决此限制， ONTAP 在 8.3 及更高版本中支持选择性 LUN 映射（ SLM ）。</block>
  <block id="43a4405ebd9c78d08e6cdf383a650243" category="paragraph">SLM 会限制向给定 LUN 公布路径的节点。NetApp最佳实践是、每个SVM的每个节点至少具有两个LIT、并使用SLM限制向托管LUN的节点及其HA配对节点公布的路径。虽然存在其他路径、但默认情况下不会公布这些路径。可以使用 SLM 中的添加和删除报告节点参数修改公布的路径。请注意、在8.3之前的版本中创建的LUN会公布所有路径、需要进行修改、以便仅向托管HA对公布路径。有关SLM的详细信息，请查看的第5.9节<block ref="a2bae1e6a9d1ce7703c1f95bb6ec1d6e" category="inline-link-rx"></block>。也可以使用先前的端口集方法进一步减少 LUN 的可用路径。端口集有助于减少 igroup 中启动程序可通过的可见路径数。</block>
  <block id="b05dc829eda4798f22045fd6851afaaf" category="list-text">对于在Data ONTAP 8.3之前创建的LUN、请运行命令手动应用SLM<block ref="886fd385b633a0746a8a08f8f00c67cd" prefix=" " category="inline-code"></block>、以删除LUN报告节点并限制LUN访问权限、使其只能访问拥有LUN的节点及其HA配对节点。</block>
  <block id="b0bdc1022637913a5e63f708d401c7dd" category="paragraph">基于SCSI的块协议(iSCSI、FC和FCoE)使用LUN ID、序列号以及唯一名称来访问LUN。FC和FCoE使用全球通用名称(WWNN和WWPN)、而iSCSI则使用iSCSI限定名称(iSCSI限定名称、IQN)根据按端口集和SLM筛选的LUN到igrou的映射来建立路径。基于NVMe的块协议可通过将具有自动生成的命名空间ID的命名空间分配给NVMe子系统并将该子系统映射到主机的NVMe限定名称(NQN)来进行管理。无论FC或TCP如何、NVMe命名空间都使用NQN而不是WWPN或WWNN进行映射。然后、主机会为映射的子系统创建一个软件定义的控制器、以访问其命名存储。ONTAP中LUN和名称区的路径对于块协议没有意义、不会显示在协议中的任何位置。因此，只包含 LUN 的卷根本无需在内部挂载，而包含数据存储库中使用的 LUN 的卷则不需要接合路径。</block>
  <block id="274b68192b056e268f128ff63bfcd4a4" category="cell">不适用</block>
  <block id="582afacce7e9a2be95f7ef78c502a227" category="cell">每个主机256个NFS连接(受nconnect和会话中继的影响)默认NFS。最大卷数为 8 。使用适用于 VMware vSphere 的 ONTAP 工具将其增加到 256 。</block>
  <block id="10a941de93465e9a6eee9a21f0334c73" category="cell">使用 FlexGroup 卷时为 300 TB 或更高的 FlexVol 卷</block>
  <block id="5567896b478134e909968961c6a17720" category="cell">Live Site Recon/Site Recovery Manager</block>
  <block id="9ec9fe6b9d42732de69c5f1b252be1db" category="cell">ONTAP Snapshot</block>
  <block id="ddf9393cfd2f44676f3a0bce71fc55e0" category="cell">支持SnapCenter和VADP的备份软件</block>
  <block id="a383dfc926e414528d11cef825a5dbf3" category="cell">启用了SnapCenter和VADP的备份软件、vSphere Client和vSphere Web Client数据存储库浏览器</block>
  <block id="f44de200e9dad7356d95c3b2b370d3ef" category="cell">启用了SnapCenter和VADP的备份软件、仅限Windows</block>
  <block id="ff9f148c8b974c820cc302f7190a7533" category="cell">支持SnapCenter和VADP的备份软件和第三方应用程序</block>
  <block id="920ab17e6978a5f8b455022d3ec15080" category="paragraph">^1^* NetApp建议*对Microsoft集群使用子系统内iSCSI、而不是在VMFS数据存储库中使用启用了多写入程序的VMDK。这种方法完全受Microsoft和VMware的支持、可通过ONTAP (SnapMirror到内部或云中的ONTAP系统)提供极大的灵活性、易于配置和自动化、并可通过SnapCenter进行保护。vSphere 7增加了一个新的集群模式VMDK选项。这与启用了多写入程序的VMDK不同、后者需要启用了集群模式VMDK支持的VMFS 6数据存储库。其他限制适用。有关配置准则、请参见VMware<block ref="46658ede14d15d79e2a20c75a7b15bb2" category="inline-link-macro-rx"></block>文档。</block>
  <block id="1c39c1dd8f654eedbd266d325b8b2bfe" category="paragraph">运行ONTAP的系统支持所有主要存储协议、因此客户可以根据现有和计划内的网络基础架构以及员工技能选择最适合其环境的协议。以往、NetApp测试通常显示、以相似线路速度运行的协议和连接数之间几乎没有差别。但是、NVMe-oF (NVMe/TCP和NVMe/FC)在IOPS、延迟以及存储IO的主机CPU消耗减少多达50%甚至更多方面表现出显著提升。另一方面、NFS可提供最大的灵活性和易管理性、尤其是对于大量VM。所有这些协议均可与适用于VMware vSphere的ONTAP工具结合使用和管理、该工具提供了一个简单的界面来创建和管理数据存储库。</block>
  <block id="a057cf188c3e7763e47d59ffd633784e" category="list-text">*当前操作环境。*虽然IT团队通常擅长管理以太网IP基础架构、但并非所有IT团队都擅长管理FC SAN网络结构。但是、如果使用的是不针对存储流量设计的通用IP网络、则可能效果不会很好。请考虑您已有的网络基础架构，任何计划内的改进，以及管理这些改进的人员的技能和可用性。</block>
  <block id="03acb8fd56768c1827623c3c7e78f5ad" category="list-text">*易于管理。*对于SAN协议、如果需要更多空间、则需要执行多个步骤、包括增加LUN大小、重新扫描以发现新大小、然后增加文件系统大小。虽然可以增加LUN大小、但减小LUN大小却不可行。NFS 可以轻松地进行大小调整，存储系统可以自动调整大小。SAN可通过子操作系统DEALLOCATE/TRIM/UNMAP命令提供空间回收、从而将已删除文件中的空间返回到阵列。对于NFS数据存储库来说、这种类型的空间回收不难实现。</block>
  <block id="2153785b657110dbec7bac0a2931c4b0" category="paragraph">ONTAP 存储系统可以非常灵活地为 VM 和虚拟磁盘创建数据存储库。虽然在使用ONTAP工具为vSphere配置数据存储库时会应用许多ONTAP最佳实践(在一节中列出<block ref="2e24324ebf41be836715e1e0dd648f4f" category="inline-link-macro-rx"></block>)，但还需要考虑以下一些准则：</block>
  <block id="4179f1498130aa878933f74dbe16642c" category="list-text">使用 ONTAP NFS 数据存储库部署 vSphere 可实现高性能，易于管理的实施，从而提供基于块的存储协议无法实现的虚拟机与数据存储库比率。此架构可将数据存储库密度提高十倍，并相应地减少数据存储库数量。尽管较大的数据存储库可以提高存储效率并提供运营优势、但请考虑在每个节点上至少使用四个数据存储库(FlexVol卷)将虚拟机存储在一个ONTAP控制器上、以便从硬件资源中获得最大性能。通过这种方法，您还可以使用不同的恢复策略建立数据存储库。根据业务需求、某些备份或复制的频率比其他备份或复制的频率要高。FlexGroup 卷不需要多个数据存储库来提高性能、因为它们可以根据设计进行扩展。</block>
  <block id="1bce4f9db0fda9ee171dac82c454e8f5" category="list-text">* NetApp建议*对大多数NFS数据存储库使用FlexVol卷。从ONTAP 9.8开始、也支持将FlexGroup卷用作数据存储库、并且通常建议在某些使用情形下使用。通常不建议使用其他ONTAP存储容器、例如qtrees、因为适用于VMware vSphere的ONTAP工具或适用于VMware vSphere的NetApp SnapCenter插件目前均不支持这些存储容器。</block>
  <block id="6826e55696449edeff52e813c25cad54" category="list-text">对于 FlexVol 卷数据存储库，大小合适的数据存储库大约为 4 TB 到 8 TB 。这种大小可以很好地平衡性能，易管理性和数据保护。从小规模入手（例如 4 TB ），然后根据需要扩展数据存储库（最大 300 TB ）。较小的数据存储库可以更快地从备份中或发生灾难后进行恢复，并可在集群中快速移动。请考虑使用 ONTAP 自动调整大小功能在已用空间发生变化时自动增长和缩减卷。默认情况下、适用于VMware vSphere的ONTAP工具数据存储库配置向导会对新数据存储库使用自动调整大小。可以使用 System Manager 或命令行对增长和缩减阈值以及大小上限和下限进行其他自定义。</block>
  <block id="0546b812db9e807a7b499d48c3af08ef" category="list-text">或者、也可以为VMFS数据存储库配置可通过FC、iSCSI、NVMe/FC或NVMe/TCP访问的LUN或NVMe命名空间(在新ASA系统中称为存储单元)。VMFS允许集群中的每个ESX服务器同时访问数据存储库。VMFS 数据存储库的大小最多可达 64 TB ，并且最多可包含 32 个 2 TB LUN （ VMFS 3 ）或一个 64 TB LUN （ VMFS 5 ）。在AFF、ASA和FAS系统上、ONTAP的最大LUN大小为128 TB。NetApp始终建议对每个数据存储库使用一个大型LUN、而不是尝试使用块区。与NFS一样、请考虑使用多个数据存储库(卷或存储单元)、以最大程度地提高单个ONTAP控制器的性能。</block>
  <block id="69f31e71b4d944d0f4c405d0e6e39f7e" category="list-text">在某些情况下，您甚至可能不需要数据存储库。考虑子系统拥有的文件系统、例如由子系统管理的NFS、SMB、NVMe/TCP或iSCSI文件系统。有关具体的应用指南，请参见适用于您的应用程序的 NetApp 技术报告。例如、<block ref="cfa0393f870bc70fd8973ae18376facc" category="inline-link-macro-rx"></block>中有一节介绍虚拟化、并提供了有用的详细信息。</block>
  <block id="bcc3251e9d72ed4c51a3b9557e4067c9" category="list-text">虽然您可以仔细规划迁移到适当的目标数据存储库，但批量迁移之后再根据需要进行组织往往会更简单。如果您有特定的数据保护需求(例如不同的Snapshot计划)、则可能需要使用此方法来指导您迁移到不同的数据存储库。此外、VM位于NetApp集群上后、Storage vMotion可以使用VAAI卸载在集群上的数据存储库之间移动VM、而无需基于主机的副本。请注意、NFS不会卸载已启动虚拟机的Storage vMotion、但VMFS会卸载。</block>
  <block id="0ad05ff30fea1e84deaaa1ed7bee8fac" category="paragraph">在运行ONTAP的系统中使用vSphere时、最重要的最佳实践是安装和使用适用于VMware vSphere的ONTAP工具插件(以前称为虚拟存储控制台)。无论使用SAN或NAS、ASA、AFF、FAS还是ONTAP Select (在VMware或KVM VM中运行的软件定义版本ONTAP)、此vCenter插件均可简化存储管理、提高可用性并降低存储成本和运营开销。它使用最佳实践来配置数据存储库，并针对多路径和 HBA 超时优化 ESXi 主机设置（这些内容在附录 B 中进行了介绍）。由于它是vCenter插件、因此可供连接到vCenter Server的所有vSphere Web Client使用。</block>
  <block id="e4aac7f3219a7f18dc97515d5997afad" category="admonition">在基于映像的vSphere集群上、您仍需要将NFS插件添加到映像中、以便在使用ONTAP工具安装时、这些插件不会不合规。</block>
  <block id="279b6091a0ac82b44d1b55974e5be84e" category="paragraph">ONTAP工具也是适用于ONTAP的VASA Provider的许多功能的管理界面、支持使用VVO尔 进行基于存储策略的管理。</block>
  <block id="56de38ee4f3cd70309ddc44c00acb1fb" category="list-text">NetApp仅建议在ONTAP集群中的集群互连端口上禁用网络流量控制。对于用于数据流量的其余网络端口， NetApp 不提供其他最佳实践建议。您应根据需要启用或禁用。有关流量控制的更多背景信息、请参见<block ref="3455dc2b3e7cd12a38e508bec690aa67" category="inline-link-rx"></block>。</block>
  <block id="3a04c6fe53e84b0859143746f9b8b3bc" category="paragraph">备份和快速恢复虚拟机(VM)是使用适用于vSphere的ONTAP的主要优势。可以通过适用于VMware vSphere的SnapCenter插件在vCenter中轻松管理此功能。许多客户通过SnapCenter增强了第三方备份解决方案、以利用ONTAP的快照技术、因为它提供了使用ONTAP恢复VM的最快、最直接的方式。拥有ONTAP One许可证的客户可以免费获得SnapCenter、也可以获得其他许可证包。</block>
  <block id="17d20b1dcedfc04c7879e9675412b0db" category="section-title">NetApp ONTAP卷快照</block>
  <block id="424a2b394957a69a3a605706153f9539" category="paragraph">快照是ONTAP的一项重要功能、可用于创建数据的时间点副本。它们节省空间、并且可以快速创建、因此非常适合保护虚拟机和数据存储库。快照可用于各种用途、包括备份、恢复和测试。这些快照与VMware (一致性)快照不同、适用于长期保护。由于性能和其他影响、建议仅在短期内使用VMware vCenter管理的快照。<block ref="edb84c63886608dd2a747873a2732130" category="inline-link-macro-rx"></block>有关详细信息、请参见。</block>
  <block id="9fe3ffc9df0f8a5c691d2ed0c67a5b03" category="paragraph">快照是在卷级别创建的、可用于保护该卷中的所有虚拟机和数据存储库。这意味着、您可以创建整个数据存储库的快照、其中包括该数据存储库中的所有虚拟机。</block>
  <block id="d1c6249258c65372addf83e0659b487e" category="paragraph">对于NFS数据存储库、您可以通过浏览.Snapshot目录轻松查看快照中的VM文件。这样、您就可以快速从快照访问和还原文件、而无需使用特定的备份解决方案。</block>
  <block id="98366d305ee795988e2e64b7dc1644c0" category="paragraph">对于VMFS数据存储库、您可以根据所需的快照创建数据存储库的FlexClone。这样、您就可以根据快照创建新的数据存储库、此数据存储库可用于测试或开发目的。FlexClone仅会为创建快照后所做的更改占用空间、从而可以节省空间来创建数据存储库副本。创建FlexClone后、您可以像常规数据存储库一样、将LUN或命名空间映射到ESXi主机。这样、您不仅可以还原特定的VM文件、还可以根据生产数据快速创建测试或开发环境、而不会影响生产环境的性能。</block>
  <block id="03e4c24bf78c3a62e1dced5c76036cf1" category="inline-link">ONTAP本地Snapshot副本</block>
  <block id="27ad839d4296d122cd72e93f1112d733" category="section-title">适用于VMware vSphere的SnapCenter插件</block>
  <block id="f3980536bb15eae0ba5c0b2657f8433a" category="paragraph">使用 SnapCenter ，您可以创建可应用于多个作业的备份策略。这些策略可以定义计划，保留，复制和其他功能。它们仍然允许选择虚拟机一致的快照、从而利用虚拟机管理程序在创建VMware快照之前将I/O置于静修状态的功能。但是，由于 VMware 快照对性能的影响，通常不建议使用这些快照，除非您需要暂停子文件系统。而是使用快照进行常规保护、并使用SnapCenter应用程序插件等应用程序工具来保护SQL Server或Oracle等事务处理数据。</block>
  <block id="fcc3a75d51e5e5b8a03324e1a626fb47" category="paragraph">这些插件提供了扩展功能，可在物理和虚拟环境中保护数据库。在vSphere中、您可以使用它们来保护SQL Server或Oracle数据库、其中数据存储在RDM LUN、Vvol或NVMe/TCP命名空间和直接连接到子操作系统的iSCSI LUN上、或者VMFS或NFS数据存储库上的VMDK文件上。这些插件允许指定不同类型的数据库备份、支持联机或脱机备份、并保护数据库文件和日志文件。除了备份和恢复之外、这些插件还支持出于开发或测试目的克隆数据库。</block>
  <block id="ed4b38adcac92958d35c1949278ac403" category="inline-link">适用于VMware vSphere的SnapCenter插件规模估算指南</block>
  <block id="12a351ccc1f78e4aee2d5bf9f55f754b" category="paragraph">有关规模估算信息、请参见<block ref="c5fb486dbca6b73042cefb5314c3e0ce" category="inline-link-rx"></block></block>
  <block id="555f2327888d8e7cf50068fd301b189d" category="section-title">适用于采用VMware Live Site Recovery的VMware vSphere的ONTAP工具</block>
  <block id="bdfe900673edfc6634c23bde843c6420" category="paragraph">适用于VMware vSphere的ONTAP工具(OT4VS)是一款免费插件、可在VMware vSphere和NetApp ONTAP之间实现无缝集成。您可以通过它直接从vSphere Web Client管理ONTAP存储、从而更轻松地执行配置存储、管理复制和监控性能等任务。</block>
  <block id="d6c59a18f3b83d8486f9527e20ea1941" category="paragraph">要改进灾难恢复功能、请考虑使用适用于VMware vSphere的ONTAP工具中的适用于ONTAP的NetApp SRA以及VMware Live Site Recovery (以前称为Site Recovery Manager)。此工具不仅支持使用SnapMirror将数据存储库复制到灾难恢复站点、还支持通过克隆复制的数据存储库在灾难恢复环境中进行无中断测试。此外、借助内置的自动化功能、还可以简化从灾难中恢复以及在解决中断后重新保护生产环境的过程。</block>
  <block id="d223a7adee575c4956124c0868f0825f" category="section-title">NetApp MetroCluster和SnapMirror处于活动同步状态的vSphere Metro Storage Cluster (VMSC)</block>
  <block id="85abd770c37e6b8f0dd32bb10e63df19" category="paragraph">最后、要获得最高级别的数据保护、请考虑使用NetApp MetroCluster的VMware vSphere Metro Storage Cluster (VMSC)配置。VMSC是一款经VMware认证且受NetApp支持的解决方案、它使用同步复制、可提供与高可用性集群相同的优势、但分布在不同的站点上以防止站点灾难。NetApp SnapMirror Active Sync (采用ASA和AFF)以及MetroCluster (采用AFF)为同步复制提供了经济高效的配置，可从任何单个存储组件故障中透明恢复，并可在SnapMirror活动同步时透明恢复，或在发生站点灾难时使用MetroCluster进行单命令恢复。中详细介绍了VMSC。<block ref="252912db8b98e51588a897ab91b985e0" category="inline-link-rx"></block></block>
  <block id="99f033ca163a880d3ebaf5192a303bf9" category="paragraph">运行ONTAP的系统可通过空闲加密轻松保护任何数据。NetApp存储加密(NSE)将自加密驱动器(Self-Encryption Drive、SE)与ONTAP结合使用来保护SAN和NAS数据。NetApp 还提供 NetApp 卷加密和 NetApp 聚合加密，这是一种基于软件的简单方法，用于对任何磁盘驱动器上的卷进行加密。这种软件加密不需要特殊的磁盘驱动器或外部密钥管理器、ONTAP客户可以免费使用。您可以升级并开始使用它、而不会对客户端或应用程序造成任何中断、并且这些客户端或应用程序已通过FIPS 140-2 1级标准(包括板载密钥管理器)的验证。</block>
  <block id="5826cf23650ea572524e9309431c2169" category="list-text">*包括板载密钥管理器。*NetApp软件加密包括一个板载密钥管理器、无需购买和使用复杂的高可用性密钥管理服务器、即可轻松上手。</block>
  <block id="1499e638502a512eab8c6e5e76d54ece" category="paragraph">软件加密入门非常简单。安装许可证后、只需指定密码短语来配置板载密钥管理器、然后创建新卷或执行存储端卷移动以启用加密即可。NetApp 正在努力在其未来版本的 VMware 工具中增加对加密功能的集成支持。</block>
  <block id="0499c7df3779345b8007d3f36acf7bae" category="list-text">将存储网络流量与其他网络分开。可以通过使用专用 VLAN 或单独的存储交换机来实现单独的网络。如果存储网络共享上行链路等物理路径，您可能需要 QoS 或其他上行链路端口来确保带宽充足。除非您的解决方案指南明确要求、否则请勿将主机直接连接到存储；使用交换机提供冗余路径、并允许VMware HA在没有干预的情况下运行。</block>
  <block id="d0ffa72f3503feac723dc422bf406d9f" category="list-text">如果您的网络支持巨型帧、则应使用巨型帧。如果使用这些协议，请确保在存储和 ESXi 主机之间的路径中的所有网络设备， VLAN 等上对其进行相同的配置。否则，您可能会看到性能或连接问题。此外，还必须在 ESXi 虚拟交换机， VMkernel 端口以及每个 ONTAP 节点的物理端口或接口组上以相同的方式设置 MTU 。</block>
  <block id="7e8f5f024231d60cdc9576880a7f052a" category="list-text">NetApp仅建议在ONTAP集群中的集群互连端口上禁用网络流量控制。对于用于数据流量的其余网络端口的流量控制最佳实践、NetApp不提供任何其他建议。您应根据需要启用或禁用它。有关流量控制的更多背景信息、请参见<block ref="3455dc2b3e7cd12a38e508bec690aa67" category="inline-link-rx"></block>。</block>
  <block id="6e4e8c0fcc610bc580228562a24b83ab" category="section-title">SAN (FC、NVMe/FC、iSCSI、NVMe/TCP)、RDM</block>
  <block id="10a270aa1bdf582d9f25983e1c822f19" category="paragraph">存储管理员有时倾向于通过从配置中删除网络交换机来简化其基础架构。在某些情况下、可以支持此功能。但是、需要注意一些限制和注意事项。</block>
  <block id="020f95916177eb14567bf65de71d3668" category="paragraph">在实践中、NetApp客户确实使用直连NFS、但通常仅适用于故障转移期间IO暂停的工作负载。使用硬挂载时、暂停期间不应出现任何IO错误。IO应冻结、直到服务还原为止、方法是通过故障恢复或手动干预在主机上的NIC之间移动IP地址。</block>
  <block id="72ddef074f60e5fc537d32dc77a96c36" category="paragraph">本文档介绍了适用于vSphere的ONTAP解决方案、其中重点介绍了可简化部署、降低风险和简化管理的最新产品信息和最佳实践。</block>
  <block id="ce688f68d7fc3cbdd2bee58fdaa7a3ae" category="paragraph">本文档重点介绍在vSphere 7.0或更高版本上运行的ONTAP (9.x)的最新版本中的功能。有关特定版本的详细信息、请参见<block ref="ab7acb1690084e25996646d49d4a381e" category="inline-link-rx"></block>和<block ref="e1593898142109fc8cd8025356d3f312" category="inline-link-rx"></block>。</block>
  <block id="7642d26aa7df3de4ab3a541dbfe31437" category="paragraph">利用VMware vSphere APIS for Storage AWARENYUIYUHEYUJIYUDEJIYUDEJIYUDEJUDEJIEMIYUDEJUDEJUDEJUDEJUHE</block>
  <block id="13844ac053869d38b76530ed8f4159a9" category="paragraph">在使用VASA之前、VM管理员可以定义VM存储策略、但他们必须与存储管理员一起确定适当的数据存储库、通常使用文档或命名约定。借助 VASA ，存储管理员可以定义一系列存储功能，包括性能，分层，加密和复制。一个卷或一组卷的一组功能称为存储功能配置文件（ Storage Capability Profile ， SCP ）。</block>
  <block id="ea70c1612f8cd9738b66d05af624f8c5" category="paragraph">利用VMware vSphere APIS for Storage AWARENYUIYUHEYUJIYUDEJIYUDEJIYUDEJUDEJIEMIYUDEJUDEJUDEJUDEJUHE值得一看的是、这种方法可以帮助您简化虚拟化存储操作、避免大量琐碎的工作。</block>
  <block id="15526db5729ae485923742110cf54c7a" category="paragraph">VMware Storage Distributed Resource Scheduler (SDRS)是一项vSphere功能、可根据当前I/O延迟和空间使用情况自动将VM放置在数据存储库集群中。</block>
  <block id="e21e1ecabc11b1c40a35e9030d8474bd" category="list-text">除非您有特定要求、否则请勿使用SDRS。</block>
  <block id="397f2530fca86e36b28c183ded119555" category="list-text">使用ONTAP时不需要SDRS。SDRS无法识别重复数据删除和数据压缩等ONTAP存储效率功能、因此、它可能会做出不适合您环境的决策。</block>
  <block id="28ef5b69fedbf0bfc161c069c66b8c56" category="list-text">SDRS无法识别ONTAP QoS策略、因此可能会做出性能不理想的决策。</block>
  <block id="07495043326316f508fa4c530196be56" category="list-text">SDRS无法识别ONTAP Snapshot副本、因此它可能会做出导致快照呈指数级增长的决策。例如、将虚拟机移动到另一个数据存储库会在新数据存储库中创建新文件、从而导致快照增长。对于具有大型磁盘或多个快照的VM尤其如此。然后、如果将虚拟机移回原始数据存储库、则原始数据存储库上的快照将增大。</block>
  <block id="2b53a21ac29cb3161e892454cf7f0621" category="paragraph">如果您确实使用SDRS、请考虑以下最佳实践：</block>
  <block id="2c1e5c80beebd647a22327e2b18b2ddf" category="list-text">当SDRS在数据存储库之间移动VMDK时、ONTAP克隆或重复数据删除节省的空间可能会减少、具体取决于重复数据删除或数据压缩在目标上的效果。</block>
  <block id="2d8ff546478fe1dc3783d293a5650bb1" category="inline-link">存储DRS常见问题解答</block>
  <block id="9fe1a69b0192fb5955b959edd763b9d6" category="paragraph">有关SDRS的详细信息，请参见VMware文档，网址为<block ref="6f5bfdeedeaf40bf3dcc7dcc4311a1cf" category="inline-link-rx"></block>。</block>
  <block id="2a104d02cb0299df0ebe47fa0ceb2e3f" category="paragraph">可以使用适用于VMware vSphere的ONTAP工具轻松设置这些值：从ONTAP工具概述页面向下滚动到底部、然后单击ESXi主机合规性portlet中的应用建议设置。</block>
  <block id="b8ed49f8c2faef2a05f3432a8bf20432" category="cell">newSyncInterval</block>
  <block id="b7715db44a4dfbe51370a25ea991a2f0" category="cell">如果您不使用适用于Kubnetes的vSphere CSI、请按设置<block ref="e3529737a3b4eef7cff2c05dcd47fcdc" category="inline-link-rx"></block></block>
  <block id="bc7b51a623cfc5e288b304d2f9c93eac" category="admonition">使用VMware vSphere 7.0.1和VMware vSphere ESXi 7.3.2时、NFS高级配置选项MaxQueue深度 可能无法正常工作。有关详细信息、请参见<block ref="861055760f3cd527823fd34a49459992" category="inline-link-macro-rx"></block>。</block>
  <block id="93754b0c6a333efae9b897da113630eb" category="paragraph">最初、这种统一方法指的是在一个存储系统上同时支持NAS和SAN协议、而ONTAP凭借其在NAS中的原有优势、仍然是SAN的领先平台。ONTAP现在还提供S3对象协议支持。虽然S3不用于数据存储库、但您可以将其用于子系统内应用程序。有关ONTAP中S3协议支持的详细信息，请参见<block ref="9a0a48164e4b196191c2134bda6f342d" category="inline-link-macro-rx"></block>。统一存储一词已发展为一种统一的存储管理方法、包括通过一个界面管理所有存储资源的能力。这包括能够同时管理内部和云存储资源、最新的全SAN阵列(ASA)系统、以及从一个界面管理多个存储系统。</block>
  <block id="9f4686c99993be53ee2c19ad1e4f9c69" category="paragraph">Storage Virtual Machine (SVM)是ONTAP中的安全多租户单元。它是一种逻辑构造、允许客户端访问运行ONTAP的系统。SVM 可以通过多个数据访问协议通过逻辑接口（ Logical Interface ， LIF ）同时提供数据。SVM 可通过 CIFS 和 NFS 等 NAS 协议提供文件级数据访问，并通过 iSCSI ， FC/FCoE 和 NVMe 等 SAN 协议提供块级数据访问。SVM可以同时分别为SAN和NAS客户端以及S3提供数据。</block>
  <block id="ddf4bde5aaaa48fac85f6c5a4c180815" category="paragraph">NetApp提供了多个与传统ONTAP和ASA系统兼容的独立软件工具、可通过集成vSphere来有效管理您的虚拟化环境。</block>
  <block id="9955c42610092bf7a7dbb035ba2362df" category="paragraph">ONTAP One许可证附带了以下工具、无需额外付费。有关这些工具在 vSphere 环境中如何协同工作的说明，请参见图 1 。</block>
  <block id="28c25b3bd0941927acf5da7cedf09056" category="paragraph"><block ref="b4726a9e2d7c67e5d20fb7588efe2682" category="inline-link-rx"></block>是一组用于将ONTAP存储与vSphere结合使用的工具。无论您使用的是 SAN 还是 NAS ， vCenter 插件（以前称为 Virtual Storage Console （ VSC ））均可简化存储管理和效率功能，提高可用性并降低存储成本和运营开销。它使用最佳实践配置数据存储库，并为 NFS 和块存储环境优化 ESXi 主机设置。为了获得所有这些优势、NetApp建议在将vSphere与运行ONTAP的系统结合使用时、最佳做法是使用这些ONTAP工具。它包括服务器设备、vCenter、VASA Provider和Storage Replication Adapter的用户界面扩展。ONTAP 工具中的几乎所有内容都可以通过简单的REST API实现自动化、而大多数现代自动化工具都可以使用这些API。</block>
  <block id="88450f60f7fbe5f503e1fecfcab9fb4d" category="list-text">*vCenter UI扩展。*ONTAP工具UI扩展可通过直接在vCenter UI中嵌入易于使用的上下文相关菜单来管理主机和存储、信息性portlet以及本机警报功能来简化工作流、从而简化运营团队和vCenter管理员的工作。</block>
  <block id="8fc0876b17dbd4327218c6365f4d3ed1" category="inline-link">适用于VMware VAAI的NetApp NFS插件</block>
  <block id="6b7f9103f91020461893e7625153d87c" category="paragraph"><block ref="e56b6fbfc57db1f13007ad438701316e" category="inline-link-rx"></block>是适用于ESXi主机的插件、允许这些主机对ONTAP上的NFS数据存储库使用VAAI功能。它支持克隆操作的副本卸载、厚虚拟磁盘文件的空间预留以及快照卸载。将副本操作卸载到存储不一定会更快完成、但它会降低网络带宽要求、并减轻CPU周期、缓冲区和队列等主机资源的负载。您可以使用适用于VMware vSphere的ONTAP 工具在ESXi主机或vSphere Lifecycle Manager (如果支持)上安装此插件。</block>
  <block id="662df1486cbd8ddf1909b804fde3b122" category="section-title">高级软件选项</block>
  <block id="89a13650cc26099f24645b3ebabd8681" category="inline-link">数据基础架构洞察力(DII)</block>
  <block id="7449970110f98c992170b6bbd68252f9" category="paragraph">作为技术设计合作伙伴、NetApp提供了架构方面的投入、并于2015年宣布支持虚拟卷。现在、这项新技术可通过SPBM实现VM粒度和真正的阵列本机存储配置自动化。</block>
  <block id="09807314260bef27b90345fd0212a57f" category="paragraph">存储容器由存储管理员创建、用于对可由VM管理员使用的存储资源进行分组。根据您使用的ONTAP系统类型、创建存储容器的方式可能有所不同。对于传统ONTAP 9集群、系统会为容器分配一个或多个后备FlexVol卷、这些卷共同构成存储池。对于ASA R2系统、整个集群都是存储池。</block>
  <block id="660bee009f0ed31eb05e51ba93850f4d" category="paragraph">*取决于平台和协议</block>
  <block id="935aaefee7fac977eb8c3770e167d5f9" category="summary">由于适用于vSphere的ONTAP具有统一的SAN和NAS存储解决方案以及最新全SAN阵列中采用的全新简化离散式存储架构、客户信心十足地选择了该解决方案。此平台提供卓越的快照保护和强大的管理工具。通过将功能卸载到专用存储、ONTAP可以最大限度地利用主机资源、降低成本并保持最佳性能。此外、还可以使用Storage vMotion在VMFS、NFS或Vvol之间轻松迁移工作负载。</block>
  <block id="b587bd8bd461a8e643d3122ed2fc385e" category="doc">为什么选择适用于VMware vSphere的ONTAP？</block>
  <block id="f89ab8928b3772533629296451ffbbf3" category="section-title">使用适用于vSphere的ONTAP的优势</block>
  <block id="be68f84ad2e7ab7d1f2a41defa80f499" category="list-text">*全SAN阵列(ASA)。*最新的ONTAP ASA系统(从A1K、A90、A70、A50、A30和A20开始)基于新的存储架构构建、消除了管理聚合和卷的传统ONTAP存储模式。由于没有文件系统共享、因此不需要卷！连接到HA对的所有存储都被视为通用存储可用性区域(SAZ)、其中LUN和NVMe命名空间配置为"存储单元"(SUS)。最新的ASA系统易于管理、并具有SAN存储管理员熟悉的体验。这种新架构非常适合vSphere环境、因为它可以轻松管理存储资源、并为SAN存储管理员提供简化的体验。ASA架构还支持最新的基于网络结构的NVMe (NVMe-oF)技术、可为vSphere工作负载提供更高的性能和可扩展性。</block>
  <block id="088651913adba4fc73fbb23602f7c656" category="list-text">*快照技术。*ONTAP是第一家提供数据保护快照技术的公司、它仍然是业内最先进的公司。这种节省空间的数据保护方法已扩展为支持VMware vSphere APIS for Array Integration (VAAI)。通过这种集成、您可以利用ONTAP的快照功能执行备份和还原操作、从而减少对生产环境的影响。通过这种方法、您还可以使用快照快速恢复VM、从而减少恢复数据所需的时间和精力。此外、ONTAP的快照技术还与VMware的实时站点恢复(VSR、以前称为站点恢复管理器[SRM])解决方案相集成、为您的虚拟化环境提供全面的数据保护策略。</block>
  <block id="9406fb3af0e8e2bf8446823785c0e069" category="inline-link">数据基础架构洞察力</block>
  <block id="1c951601876e4daa83bce02aba074440" category="list-text">开始安装之前、您应检查<block ref="ab7acb1690084e25996646d49d4a381e" category="inline-link-rx"></block>以确保您的部署已通过认证。</block>
  <block id="ef30f0c0c266a8b9be1816aa72a0f58f" category="list-text">确定要使用多租户SVM还是允许完全集群访问。如果使用多租户SVM、则需要在要使用的每个SVM上具有一个SVM管理LIF。ONTAP工具必须可通过端口443访问此LIF。</block>
  <block id="4050ff4d6d35bffd46dbff7fad4e6941" category="doc">在AFF、ASA、ASA R2和FAS系统上部署虚拟卷</block>
  <block id="8a440842662a6052845e4abd1f7d5dec" category="paragraph">配置vols数据存储库涉及几个步骤。NetApp的ASA R2系统专为VMware工作负载而设计、可提供与传统ONTAP系统不同的用户体验。使用ASA R2系统时、ONTAP工具10.3或更高版本所需的设置步骤更少、并且包含针对新存储架构优化的UI扩展和REST API支持。</block>
  <block id="3164e4b18dd8dcc542a3c18024fc82b6" category="inline-link-macro">检查清单</block>
  <block id="35d34bb35f01ef3d59680d5fb99f1085" category="paragraph">如果您已经在使用ONTAP工具来管理、自动化和报告现有VMFS或基于NFS的传统存储、则可以跳过部署过程的前两个步骤。您还可以参考此完整说明<block ref="9dbdf15e49c83951dd903469aa18bcda" category="inline-link-macro-rx"></block>来部署和配置ONTAP工具。</block>
  <block id="ee88aebf80e3a3f63dfba15f3b663832" category="list-text">在要将特定Storage Virtual Machine (SVM)委派给特定vCenter的安全多租户环境中、您必须执行以下操作。</block>
  <block id="5e182d41ad3ea710eea81b3297a29a79" category="paragraph">ONTAP One许可证包括在ONTAP系统中使用虚拟卷所需的所有许可。唯一的附加要求是免费的ONTAP工具OVA、它充当VASA Provider。在VVO尔 环境中、VASA Provider软件会将阵列功能转换为策略驱动型属性、这些属性可通过VASA API加以利用、而vSphere管理员无需了解如何在后台管理这些功能。这样、就可以根据策略动态消耗分配的存储容量、从而无需手动创建传统数据存储库并管理其各自的存储消耗率。简而言之、vvol可以消除管理企业级存储的所有复杂性、并将其从vSphere管理员手中抽象出来、以便他们可以专注于虚拟化层。</block>
  <block id="98f85fc67e5f6131ae07084cdeebb84a" category="paragraph">可以使用ONTAP支持站点上可下载的升级ISO文件(需要登录)原位升级NetApp工具<block ref="b5b3717cb556fa4a89daf005a0a23ea8" category="inline-link-rx"></block>。按照<block ref="f4c1005a920344cdec43558687897506" category="inline-link-rx"></block>指南说明升级设备。也可以从ONTAP工具9.13并排升级到10.3。有关该主题的详细信息、请参见<block ref="f6676f6d529f1f81f9da02084f545f3c" category="inline-link-rx"></block>。</block>
  <block id="96e626dfdfc4f6474618b5d6e22f052e" category="list-text"><block ref="96e626dfdfc4f6474618b5d6e22f052e" category="inline-link-rx"></block></block>
  <block id="62c6b269dc04e5f59ec38c35e3251edb" category="paragraph">虽然可以使用常规vSphere界面创建vvol数据存储库、但使用ONTAP工具将根据需要自动创建协议端点、并使用ONTAP最佳实践创建FlexVol卷(ASA R2不需要)。只需右键单击主机/集群/数据中心、然后选择_ ONTAP tools_和_配置数据存储库_即可。您只需在向导中选择所需的卷选项即可。</block>
  <block id="c1d59fa07379d331f1649dd32c8b663d" category="paragraph">如果您需要重新启动设备、因为它们在重新启动期间无法重新绑定自己的虚拟卷、则可能会出现"鸡肉和鸡蛋的情况"。您可以将其存储在由其他ONTAP 工具和vCenter部署管理的Vvol数据存储库中。</block>
  <block id="4e9810675a80252409e746ff4f07c469" category="paragraph">*根据需要规划备用FlexVol卷。*</block>
  <block id="6ce93abd27f08d98b3c9e6da0a3d3006" category="admonition">本文档已进行更新、其中包括vSphere 8.0 Update 3、ONTAP工具10.4版中的新vvol功能以及新的NetApp ASA系统。</block>
  <block id="5631462c0980ed3fbdd07e734f163939" category="list-text">通过Aia (原vReise)套件、OpenStack等利用自动化和流程编排功能。</block>
  <block id="40ea6e1672fc21c11ea997d9b187dcef" category="paragraph">在ONTAP SRM对的初始支持版本中、需要先预创建FlexVol卷并启用SnapMirror保护、然后再将其用作9.7.1数据存储库的后备卷。从ONTAP 工具9.10开始、不再需要此过程。现在、您可以向现有备份卷添加SnapMirror保护、并更新VM存储策略、以便利用与SRM集成的灾难恢复和迁移流程编排及自动化功能、实现基于策略的管理。</block>
  <block id="0d5e4b39b7c99ac3687449b64c2f61d7" category="paragraph">除了有关NetApp虚拟化产品的各种知识库文章之外、NetApp支持站点还提供了一个方便的产品登录页面<block ref="6e90053136fd326e5d581844ca21966d" category="inline-link-rx"></block>。此门户可通过链接访问NetApp社区中的文章、下载内容、技术报告和VMware解决方案讨论。可从以下位置获取：</block>
  <block id="24096e60b90028c96c0a8e8df7c3c258" category="paragraph">有关NetApp MetroCluster的设置说明，请访问<block ref="2c736bccede87dae47dcf61108f083c4" category="inline-link-rx"></block>。有关SnapMirror活动同步(SMA)的说明，请参见<block ref="14203840309dd1b6e13f73373477bb9d" category="inline-link-rx"></block>。</block>
  <block id="e69c207b2671a8571c172595068da749" category="paragraph">如果未使用MetroCluster、或者您的ONTAP系统不支持MetroCluster、例如ASA R2系统、则可以使用SnapMirror主动同步、它可以在不同故障域的多个ONTAP集群之间提供数据存储库粒度保护和主动-主动访问。SMA使用一致性组(一致性组、CGS)确保一个或多个数据存储库之间的写入顺序一致性、您可以根据应用程序和数据存储库要求创建多个CGS。对于需要在多个数据存储库之间同步数据的应用程序、一致性组尤其有用。例如、分布在数据存储库之间的子系统LVM。此外、SMA还支持原始设备映射(Raw Device Mapping、RDM)以及通过子系统内iSCSI启动程序连接到子系统的存储。有关一致性组的详细信息，请访问<block ref="8bba9b5b97dba092834d7a48a07f102d" category="inline-link-rx"></block>。</block>
  <block id="646b17235be3514942344039b13b0ef5" category="paragraph">与MetroCluster相比、使用SnapMirror活动同步管理VMSC配置有一些不同。首先、SMA是一种仅SAN配置、SnapMirror活动同步无法保护任何NFS数据存储库。其次、您必须将两个LUN副本映射到ESXi主机、以使其能够访问这两个故障域中复制的数据存储库。第三、您必须为要使用SnapMirror主动同步保护的数据存储库创建一个或多个一致性组。最后、您必须为创建的一致性组创建SnapMirror策略。所有这些操作都可以通过ONTAP工具vCenter插件中的"保护集群"向导轻松完成、也可以使用ONTAP命令行界面或System Manager手动完成。</block>
  <block id="46a01589543ca9b2c28b281bc82d5190" category="section-title">使用适用于SnapMirror活动同步的ONTAP工具vCenter插件</block>
  <block id="8acd56e642eabaf4e2e00e987d06c0dd" category="paragraph">ONTAP工具vCenter插件提供了一种简单直观的方法来为VMSC配置SnapMirror活动同步。您可以使用ONTAP工具vCenter插件在两个ONTAP集群之间创建和管理SnapMirror活动同步关系。此插件提供了一个易于使用的界面、用于高效地建立和管理这些关系。有关ONTAP工具vCenter插件的详细信息，请访问<block ref="238135431b1a2d25dda1f29146112b60" category="inline-link-rx"></block>，或者直接跳转到<block ref="50b45f063e0080035a4876db2aa395bd" category="inline-link-rx"></block>。</block>
  <block id="be0e7f3621283e77712fee8493cfe7c2" category="list-text">单击"确定"。</block>
  <block id="1dddac6a529bf77c76b061ccea8bd130" category="list-text">对于采用MetroCluster的VMSC、建议使用以下附加vSphere HA设置：</block>
  <block id="4b0d37b4c720a2f35c5ebf18456af4c4" category="paragraph">添加名为ds.heartbeatDsPerHost的高级设置可以增加检测信号数据存储库的数量。使用四个检测信号数据存储库(HB DSS)—每个站点两个。使用"从列表中选择但恭维"选项。这是必需的、因为如果一个站点发生故障、您仍需要两个HB DSS。但是、这些数据不必通过MetroCluster或SnapMirror主动同步进行保护。</block>
  <block id="261a4b114a90c38336a91406135768d4" category="list-text">您可以创建基于事件的警报、当虚拟机违反VM-主机关联性规则时触发该警报。在vSphere Client中、为虚拟机添加新警报、然后选择"VM is violating VM-Host Affinity Rule "作为事件触发器。有关创建和编辑警报的详细信息、请参阅<block ref="68398319bb6b2bfb9f64390479799795" category="inline-link-macro-rx"></block>文档。</block>
  <block id="d34c2eaf11cfea5ea00aa0943b8fcfab" category="admonition">本文档可替代先前发布的技术报告_TR-4128：《基于NetApp MetroCluster的vSphere》_</block>
  <block id="2483a165b6002a92b0e076050cb48ea0" category="paragraph">NetApp MetroCluster使用NetApp的HA (控制器故障转移或CFO)功能来防止控制器发生故障。它还包括本地SyncMirror技术、灾难时集群故障转移(集群灾难故障转移或CFOD)、硬件冗余和地理分隔、以实现高可用性。SyncMirror通过将数据写入两个丛(本地磁盘架上主动提供数据的本地丛和通常不提供数据的远程丛)、在MetroCluster配置的两部分之间同步镜像数据。所有MetroCluster组件(例如控制器、存储、缆线、交换机(用于光纤MetroCluster)和适配器)都具有硬件冗余。</block>
  <block id="4e7a787aaa9321ad4106d26a88e54252" category="paragraph">非MetroCluster系统和ASA R2系统上提供的NetApp SnapMirror主动同步功能可通过FCP和iSCSI SAN协议提供数据存储库粒度保护。通过它、您可以保护整个VMSC、也可以有选择地保护高优先级工作负载。与主动-备用解决方案NetApp MetroCluster不同、它可以同时对本地和远程站点进行主动-主动访问。从ONTAP 9.15.1开始、SnapMirror主动同步支持对称主动/主动功能、可通过双向同步复制从受保护LUN的两个副本执行读写I/O操作、从而使两个LUN副本均可在本地处理I/O操作。在ONTAP 9.151之前的版本中、SnapMirror主动同步仅支持非对称主动/主动配置、即二级站点上的数据代理到LUN的主副本。</block>
  <block id="0e050612c89bbe89c4a1f2c79db93a7f" category="paragraph">NetApp MetroCluster可以部署在两种不同的配置中、以便与vSphere结合使用：</block>
  <block id="bb74c883034be56ad2c714b34888809d" category="image-alt">使用MetroCluster的VMSC示意图</block>
  <block id="2a36d659f1adb408dfdab4248eac6770" category="image-alt">带有MSA和ONTAP调解器的VMSC示意图</block>
  <block id="051b8072cddf34ff82fc627b5ef88b06" category="paragraph">这些工具可为整个存储环境提供站点范围的保护、确保数据始终可用。无论您使用的是独立服务器、高可用性服务器集群、容器还是虚拟化服务器、NetApp技术都可以在因断电、散热或网络连接中断、存储阵列关闭或操作错误而导致全面中断时无缝地保持存储可用性。</block>
  <block id="f027f8c94b36e501200aa21bd5b3643f" category="paragraph">在接管期间、MetroCluster配置中的NAS LUN会自动进行故障转移。但是、SAN Lifs不会进行故障转移；它们将继续使用逻辑单元号(Logical Unit Number、LUN)的直接路径。</block>
  <block id="3b414f3b9c656fa9b5680e32bf9b7d2d" category="paragraph">有关HA接管和交还的详细信息，请参见<block ref="5a72801b431f75b7489a0e7de50680bf" category="inline-link-rx"></block>。值得注意的是、此功能并不特定于MetroCluster或SnapMirror活动同步。</block>
  <block id="49c8d9bbd63bc0df306259c93fa4d364" category="paragraph">使用SnapMirror主动同步时、由于两个副本会同时使用、因此现有主机将继续运行。要确保正确进行站点故障转移、需要使用ONTAP调解器。</block>
  <block id="240e602413c054e65f7a1233278f5c39" category="doc">使用MetroCluster的VMSC的故障情形</block>
  <block id="8c3100c726feafcb8f5c89188709b8da" category="paragraph">在这种情况下、出现两个以上磁盘或整个磁盘架故障。数据从无故障丛提供、而不会中断数据服务。磁盘故障可能会影响本地丛或远程丛。聚合将显示为降级模式、因为只有一个丛处于活动状态。更换故障磁盘后、受影响的聚合将自动重新同步以重建数据。重新同步后、聚合将自动恢复为正常镜像模式。如果一个RAID组中有两个以上的磁盘出现故障、则必须重建丛。</block>
  <block id="e3010a7324dc76261135a69dad98bcf2" category="paragraph">在站点之间对ESXi主机进行分区后、vSphere HA代理将检查数据存储库检测点、并且在每个站点中、本地ESXi主机将能够将此数据存储库检测点更新到其各自的读/写卷/LUN。站点A中的主机将假定站点B上的其他ESXi主机发生故障、因为不存在网络/数据存储库检测点。站点A上的vSphere HA将尝试重新启动站点B的虚拟机、但最终将失败、因为存储ISL故障将无法访问站点B的数据存储库。站点B也会出现类似情况</block>
  <block id="7ae222a2c832e4ce999571e88803083d" category="paragraph">如果一个或多个ISL发生故障、流量将继续通过其余链路。如果两个网络结构上的所有ISO都发生故障、以致于站点之间没有用于存储和NVRAM复制的链路、则每个控制器将继续提供其本地数据。至少还原一个ISL后、将自动重新同步所有plexes。</block>
  <block id="33cb67cb29131f1d0275317dce2cf236" category="paragraph">在对等集群链路故障情形下、由于网络结构的CRL仍处于活动状态、因此两个站点上的数据服务(读取和写入)将继续提供给两个plexs。任何集群配置更改(例如、添加新SVM、在现有SVM中配置卷或LUN)都无法传播到其他站点。这些卷保存在本地CRS元数据卷中、并在恢复对等集群链路后自动传播到另一集群。如果需要强制切换才能还原对等集群链路、则在切换过程中、系统将从正常运行的站点上元数据卷的远程复制副本自动重做未完成的集群配置更改。</block>
  <block id="5cac5bfa9407e4851e57fffb3704c323" category="paragraph">VMware的集群技术可将ESXi服务器分组到虚拟机的共享资源池中、并提供vSphere高可用性(HA)。vSphere HA可为虚拟机中运行的应用程序提供易于使用的高可用性。在集群上启用HA功能后、每个ESXi服务器都会与其他主机保持通信、以便在任何ESXi主机无响应或隔离时、 HA集群可以在集群中的无故障主机之间协商恢复该ESXi主机上运行的虚拟机。如果子操作系统发生故障、vSphere HA可以在同一物理服务器上重新启动受影响的虚拟机。vSphere HA可以减少计划内停机、防止计划外停机、并从中断中快速恢复。</block>
  <block id="13756f2a610f8f2a9bfce56369289ce1" category="paragraph">请务必了解、VMware vSphere不了解NetApp MetroCluster或SnapMirror主动同步、并且会根据主机和VM组关联性配置将vSphere集群中的所有ESXi主机视为符合HA集群操作条件的主机。</block>
  <block id="5cda3e7fc012f3f66cb81b04173c232e" category="paragraph">NetApp建议将"主机隔离响应"设置为"已禁用"。</block>
  <block id="990ae835e5ddcf593414be2262bdace1" category="list-text">NetApp建议将"Response for Data with APD"配置为"*关闭并重新启动VM (保守)*"。</block>
  <block id="ed239ad833fcd059d909a3b5c5ef32f0" category="list-text">如果APD状态为已解决、并且在超时时间之前还原了对存储的访问、则HA不会不必要地重新启动虚拟机、除非您明确对此虚拟机进行配置。如果即使环境已从APD条件中恢复、也需要响应、则应将APD超时后APD恢复的响应配置为重置VM。</block>
  <block id="2f567a5b33a98cbc762cbf67a7d2a620" category="section-title">为NetApp SnapMirror活动同步实施VMware DRS</block>
  <block id="c55b2a3b93f65c4f9532694d5e8ffba3" category="paragraph">VMware DRS是一项将主机资源聚合到集群中的功能、主要用于在虚拟基础架构中的集群内进行负载平衡。VMware DRS主要计算在集群中执行负载平衡所需的CPU和内存资源。由于vSphere无法识别延伸型集群、因此在进行负载平衡时、它会考虑两个站点中的所有主机。</block>
  <block id="7753c40d9b983d2079b72842e3406960" category="paragraph">NetApp建议实施"应该"规则、而不是"必须"规则、因为如果发生故障、vSphere HA会违反这些规则。使用"必须"规则可能会导致服务中断。</block>
  <block id="b88201736c7c63fe1df854d89bf2427f" category="sidebar">为什么选择ONTAP for VMware</block>
  <block id="4d68c6910c7e5b8e5f736a0a37eba4e6" category="paragraph">自二十多年前 ESX 引入现代数据中心以来， ONTAP一直是 VMware vSphere 以及最近的 Cloud Foundation 的领先存储解决方案。 NetApp不断推出创新系统，例如最新一代ASA A 系列，以及SnapMirror主动同步等功能。这些进步简化了管理，增强了弹性，并降低了 IT 基础设施的总拥有成本 (TCO)。</block>
  <block id="d51eebcc193505dec7ec133bd17d0702" category="paragraph">本文档介绍了适用于 VMware Live Site Recovery (VLSR)（以前称为 Site Recovery Manager (SRM)，VMware 业界领先的灾难恢复 (DR) 软件）的ONTAP解决方案，包括最新产品信息和最佳实践，以简化部署、降低风险并简化持续管理。</block>
  <block id="3f17c15e23b90a1416deb27191a1348e" category="admonition">本文档取代了之前发布的技术报告《TR-4900：使用 ONTAP 的 VMware Site Recovery Manager》</block>
  <block id="2c958a4052929ded88125b8785727f4a" category="paragraph">由ONTAP提供支持的NetApp数据管理平台是 VLSR 最广泛采用的存储解决方案之一。原因有很多：一个安全、高性能、统一协议（NAS 和 SAN 结合）的数据管理平台，提供行业定义的存储效率、多租户、服务质量控制、使用空间高效快照的数据保护以及使用SnapMirror的复制。所有这些都利用原生混合多云集成来保护 VMware 工作负载，并提供大量自动化和编排工具。</block>
  <block id="5b2c42c877c0360cfec4222fd847686f" category="paragraph">当您使用SnapMirror进行基于阵列的复制时，您可以利用 ONTAP 最成熟、最成熟的技术之一。 SnapMirror为您提供安全、高效的数据传输优势，仅复制更改的文件系统块，而不是整个虚拟机或数据存储区。即使这些块也利用了空间节省功能，例如重复数据删除、压缩和压缩。现代ONTAP系统现在使用与版本无关的SnapMirror，让您可以灵活地选择源集群和目标集群。  SnapMirror确实已成为最强大的灾难恢复工具之一。</block>
  <block id="e6e16bd7b0eb9a9b6d1b84b252dfef52" category="paragraph">无论您使用的是传统的 NFS、iSCSI 还是光纤通道连接的数据存储（现在支持vVols数据存储），VLSR 都能提供强大的第一方产品，利用ONTAP的最佳功能进行灾难恢复或数据中心迁移规划和编排。</block>
  <block id="34ae253d12dacf4256947aab08d2797a" category="paragraph">在 VLSR 服务器上安装并配置 SRA 适配器以保护非 vVols 数据存储区后，您可以开始配置 vSphere 环境以进行灾难恢复的任务。</block>
  <block id="aa1408f10ab599451ceb8278538aceb3" category="paragraph">VLSR 可以使用 NetApp 专有的FlexClone技术无中断地测试您的 DR 计划，以便在您的 DR 站点几乎即时地克隆受保护的数据存储。  VLSR 创建了一个沙箱来进行安全测试，以便在发生真正的灾难时保护您的组织和客户，让您对组织在灾难期间执行故障转移的能力充满信心。</block>
  <block id="4a3ecc4c037b88a5dd4a78c48aa300b8" category="cell">vSphere 7.0 到 8.0，设置为 128。  ESXi 8.0 之后的版本中将忽略此设置。</block>
  <block id="4ca458329416c6834c4fcde7d851a203" category="list-text">在高性能环境中使用非ASA系统或使用单个 LUN 数据存储测试性能时，请考虑将循环 (VMW_PSP_RR) 路径选择策略 (PSP) 的负载平衡设置从默认 IOPS 设置 1000 更改为值 1。看<block ref="1687988694c35db61b845d7b15620672" category="inline-link-macro-rx"></block>了解更多信息。</block>
  <block id="b236a2de8d4b9a7647b4e38da0f41f0f" category="list-text">在 vSphere 6.7 Update 1 中，VMware 为 Round Robin PSP 引入了一种新的延迟负载平衡机制。现在，当使用带有 NVMe 命名空间的 HPP（高性能插件）以及 vSphere 8.0u2 及更高版本、iSCSI 和 FCP 连接的 LUN 时，也可以使用延迟选项。新选项在选择 I/O 最佳路径时会考虑 I/O 带宽和路径延迟。 NetApp建议在具有非等效路径连接的环境中使用延迟选项，例如一条路径上的网络跳数比另一条路径上的网络跳数更多的情况，或者使用NetApp ASA系统时。看<block ref="d244127cef9364538ba1012ad8871adc" category="inline-link-rx"></block>了解更多信息。</block>
  <block id="8c243b1b00784482e5851745cf6cbb46" category="paragraph">客户可以放心地选择ONTAP for vSphere 作为 SAN 和 NAS 存储解决方案。最新的 All SAN 阵列采用了新的简化分解存储架构，为 SAN 存储管理员提供了熟悉的简化体验，同时保留了传统ONTAP系统的大部分集成和功能集。 ONTAP系统提供卓越的快照保护和强大的管理工具。通过将功能卸载到专用存储， ONTAP可以最大限度地利用主机资源、降低成本并保持最佳性能。此外，可以使用 Storage vMotion 轻松跨 VMFS、NFS 或vVols迁移工作负载。</block>
  <block id="90d5572babcb90a9380df46334d2e1e8" category="paragraph">ONTAP与 vSphere 结合使用是一种很好的组合，可以让您减少主机硬件和 VMware 软件的费用。您还可以以较低的成本保护您的数据，同时保持始终如一的高性能。由于虚拟化工作负载是移动的，您可以探索使用 Storage vMotion 的不同方法在同一存储系统上跨 VMFS、NFS 或vVols数据存储移动虚拟机。</block>
  <block id="e74fa8c8fcfd6e51d8817a758d558fc7" category="paragraph">以下是当今客户重视的关键因素：</block>
  <block id="bf6e1db9bc182aafee86baa8047fa767" category="list-text">*统一存储。*运行ONTAP 的系统在几个重要方面是统一的。最初，这种方法同时涉及 NAS 和 SAN 协议， ONTAP继续成为 SAN 的领先平台，同时又具有 NAS 方面的原有优势。在 vSphere 世界中，这种方法还意味着虚拟桌面基础架构 (VDI) 与虚拟服务器基础架构 (VSI) 的统一系统。运行ONTAP 的系统对于 VSI 而言通常比传统企业阵列更便宜，并且具有高级存储效率功能，可在同一系统中处理 VDI。 ONTAP还统一了各种存储介质，从 SSD 到 SATA，并且可以轻松将其扩展到云端。没有必要为了性能而购买一个存储操作系统，为了归档而购买另一个，为了云而购买另一个。  ONTAP将它们全部联系在一起。</block>
  <block id="2afba2255c7be3f11ffd2cc4f8b80e6f" category="list-text">*虚拟卷和基于存储策略的管理。* NetApp是 VMware 在 vSphere Virtual Volumes (vVols) 开发方面的早期设计合作伙伴，为vVols和 VMware vSphere APIs for Storage Awareness (VASA) 提供架构输入和早期支持。这种方法不仅为 VMFS 带来了细粒度的 VM 存储管理，还支持通过基于存储策略的管理实现存储配置的自动化。这种方法允许存储架构师设计具有不同功能的存储池，以便虚拟机管理员轻松使用。  ONTAP在 vVol 规模方面处于存储行业领先地位，在单个集群中支持数十万个vVols ，而企业阵列和小型闪存阵列供应商每个阵列仅支持几千个vVols 。  NetApp还通过即将推出的功能推动细粒度 VM 管理的发展。</block>
  <block id="6876f82e64fd9d6a64f99665e3913906" category="list-text">*存储效率。*尽管NetApp是第一个为生产工作负载提供重复数据删除功能的公司，但这项创新并不是该领域的第一次或最后一次创新。它从快照开始，这是一种节省空间且不会影响性能的数据保护机制，同时结合FlexClone技术，可以立即为生产和备份使用制作虚拟机的读/写副本。  NetApp继续提供内联功能，包括重复数据删除、压缩和零块重复数据删除，以从昂贵的 SSD 中榨取最多的存储空间。 ONTAP还增加了使用压缩将较小的 I/O 操作和文件打包到磁盘块中的功能。这些功能的结合使得客户普遍看到 VSI 节省高达 5:1，VDI 节省高达 30:1。最新一代ONTAP系统还包括硬件加速压缩和重复数据删除功能，可以进一步提高存储效率并降低成本。这种方法允许您在更少的空间内存储更多数据，从而降低总体存储成本并提高性能。  NetApp对其存储效率功能非常有信心，因此提供了一个链接： https://www.netapp.com/pdf.html?item=/media/79014-ng-937-Efficiency-Guarantee-Customer-Flyer.pdf item=/media/79014-ng-937-Efficiency-Guarantee-Customer-Flyer.pdf [效率保证^]。</block>
  <block id="a54f2a3da40d66f7a06b1a0b6fdfa9a8" category="list-text">*多租户* ONTAP长期以来一直是多租户领域的领导者，允许您在单个集群上创建多个存储虚拟机 (SVM)。这种方法允许您隔离工作负载并为不同的租户提供不同级别的服务，使其成为服务提供商和大型企业的理想选择。最新一代ONTAP系统还包括对租户容量管理的支持。此功能允许您为每个租户设置容量限制，确保没有单个租户可以消耗所有可用资源。这种方法有助于确保所有租户都能获得他们期望的服务级别，同时还能在租户之间提供高级别的安全性和隔离。此外，ONTAP 的多租户功能与 VMware 的 vSphere 平台集成，使您可以通过以下方式轻松管理和监控虚拟化环境<block ref="238135431b1a2d25dda1f29146112b60" category="inline-link-rx"></block>和<block ref="409cf7667ac8df435e8d9883234935b9" category="inline-link-rx"></block>。</block>
  <block id="2a2939154778c60691f9f31e86248f82" category="list-text">*混合云。*无论用于本地私有云、公共云基础架构还是结合两者优点的混合云， ONTAP解决方案都可以帮助您构建数据结构以简化和优化数据管理。从高性能全闪存系统开始，然后将它们与磁盘或云存储系统结合，以实现数据保护和云计算。从 Azure、AWS、IBM 或 Google Cloud 中选择，以优化成本并避免锁定。根据需要利用对 OpenStack 和容器技术的高级支持。  NetApp还为ONTAP提供基于云的备份（ SnapMirror Cloud、 Cloud Backup Service和Cloud Sync）以及存储分层和归档工具（FabricPool ），以帮助降低运营费用并利用云的广泛覆盖范围。</block>
  <block id="ea286565525af4dcaa423ad23150249f" category="paragraph">每个NetApp SVM 在 Site Recovery Manager 中都被视为一个唯一阵列。VLSR 支持某些阵列到阵列（或 SVM 到 SVM）复制布局。</block>
  <block id="229406b7ca97303faec1240cf4a1fc11" category="section-title">VMFS 支持SnapMirror主动同步</block>
  <block id="1843642fc06043e7400ba7901fad582a" category="paragraph">ONTAP工具 10.3 及更高版本还支持使用SnapMirror主动同步 (SMas) 保护您的 VMFS 数据存储库。这使得两个相对较近的数据中心（称为故障域）之间的业务连续性能够实现透明的故障转移。然后可以通过带有 VLSR 的ONTAP工具 SRA 使用异步SnapMirror来协调远距离灾难恢复。</block>
  <block id="eb9f146fc1b0b4bc5e3804fa7d20b1a5" category="inline-link">了解ONTAP SnapMirror主动同步</block>
  <block id="7bcca325804b87edcbde47da8ec3bb3c" category="paragraph"><block ref="7bcca325804b87edcbde47da8ec3bb3c" category="inline-link-rx"></block></block>
  <block id="a0b90d1e79d4aef818085b3423183ae7" category="paragraph">数据存储区被收集在一个一致性组 (CG) 中，并且所有数据存储区的虚拟机都将作为同一 CG 的成员保持写入顺序一致。</block>
  <block id="d27c7eb1b19cbebab6552ca4574e51e5" category="paragraph">一些示例可能是柏林和汉堡的站点受 SMas 保护，第三个站点副本使用SnapMirror异步并受 VLSR 保护。另一个例子可能是使用 SMas 保护纽约和新泽西的站点，并保护芝加哥的第三个站点。</block>
  <block id="3b2b0ebfa27de38f05b20b21651ca265" category="inline-image-macro">SMas布局</block>
  <block id="65e70274fc1f803a54b1efd4b9ef1df0" category="paragraph"><block ref="65e70274fc1f803a54b1efd4b9ef1df0" category="inline-image-macro-rx" type="image"></block></block>
  <block id="aff39d99fde3099978b06c2121c26bd9" category="paragraph">在设计基于虚拟机的应用程序时，请考虑未来的云移动性。例如，不要将应用程序和数据文件放在一起，而是对数据使用单独的 LUN 或 NFS 导出。这使您可以将虚拟机和数据分别迁移到云服务。</block>
  <block id="a34428791f8c5ce4b1184d505db69402" category="inline-link-macro">备份和恢复文档</block>
  <block id="48f148d7f57b20a6060d03bbcf7335ad" category="list-text"><block ref="48f148d7f57b20a6060d03bbcf7335ad" category="inline-link-macro-rx"></block></block>
  <block id="e198d5cba43e1161bc035f28e60cc161" category="inline-link-macro">灾难恢复文档</block>
  <block id="d39786efdbd499fa740dd3765a7d5cf9" category="list-text"><block ref="d39786efdbd499fa740dd3765a7d5cf9" category="inline-link-macro-rx"></block></block>
  <block id="0da690016e4be64638cdfef258418203" category="inline-link">NetApp Backup and Recovery</block>
  <block id="cd7147239f56f957d4a7cc78ef256227" category="paragraph">此外，适用于 VMware 的SnapCenter插件可以与<block ref="ea219d297aff06b5ddbb99bc32d2e25b" category="inline-link-rx"></block>，为大多数ONTAP系统提供有效的 3-2-1 备份解决方案。请注意，如果使用具有高级服务的虚拟机备份和恢复，可能会收取一些费用，例如用于额外备份存储的对象存储。本节概述了可用于保护虚拟机和数据存储的各种选项。</block>
  <block id="19cbafc0246850c97323cac4fb786794" category="section-title">NetApp Disaster Recovery</block>
  <block id="c256d43e8fa2b8e01df9b9333e730677" category="list-text">*存储复制适配器。*SRA 与 VMware Live Site Recovery (VLSR)/Site Recovery Manager (SRM) 一起使用，使用SnapMirror进行基于阵列的复制，管理生产站点和灾难恢复站点之间的数据复制。它可以在发生灾难时自动执行故障转移任务，并可以帮助无中断地测试 DR 副本，以确保对 DR 解决方案的信心。</block>
  <block id="78dea62c276f3a86642777c27b42218f" category="paragraph">这<block ref="df7f63ec4790cd7696ac38c73a72d254" category="inline-link-rx"></block> 是 vCenter Server 的一个插件，可让您管理虚拟机 (VM) 和数据存储区的备份和还原。它提供了一个单一界面来管理跨多个ONTAP系统的虚拟机和数据存储库的备份、恢复和克隆。SnapCenter支持使用SnapMirror复制到辅助站点以及从辅助站点恢复。最新版本还支持SnapMirror到云（S3）、防篡改快照、 SnapLock和SnapMirror主动同步。适用于 VMware vSphere 的SnapCenter插件可以与SnapCenter应用程序插件集成，以提供应用程序一致的备份。</block>
  <block id="1e3f6786e57985e5818c765f46508ca6" category="inline-link">NetApp Disaster Recovery(DR)</block>
  <block id="9469e1759c7e42bfeb74f9c90db108cb" category="list-text">如果您打算使用存储多租户而不是使用 vCenter 中的ONTAP集群凭据将特定 SVM 分配给 vCenter，请按照以下步骤操作：</block>
  <block id="617275a68b9e63b5c1bdbaedd18295fb" category="list-text">如果*不*在 vCenter 中使用多租户 SVM：</block>
  <block id="618f681cdba2c4c2fc4bbcbf50528810" category="paragraph">ONTAP架构是一个灵活且可扩展的存储平台，为数据存储提供 SAN（FCP、iSCSI 和 NVMe-oF）和 NAS（NFS v3 和 v4.1）服务。NetApp AFF、 ASA和FAS存储系统使用ONTAP操作系统为客户存储访问提供附加协议，如 S3 和 SMB/CIFS。</block>
  <block id="dece980ac7b814fce6a3ac5ab9c2c18d" category="paragraph">vSphere Metro Storage Cluster (vMSC) 是一种经过认证的配置，可保护虚拟机 (VM) 和容器免受故障影响。这是通过使用延伸存储概念以及 ESXi 主机集群来实现的，这些集群分布在不同的故障域中，例如机架、建筑物、校园甚至城市。NetApp MetroCluster和SnapMirror主动同步存储技术用于为主机集群提供零恢复点目标 (RPO=0) 保护。vMSC 配置旨在确保即使整个物理或逻辑“站点”发生故障，数据也始终可用。作为 vMSC 配置一部分的存储设备必须在成功完成 vMSC 认证过程后进行认证。所有受支持的存储设备都可以在<block ref="34bc39e238eb497134ec6f46ab689fb0" category="inline-link-rx"></block>。</block>
  <block id="fd480a9146da7f38fc6111c24d64620e" category="paragraph">NetApp客户已成功在 Azure 云中运行所有 Epic 工作负载。  AWS 和 Google Cloud 也能够运行 Epic 工作负载。  NetApp提供企业级功能和在云中有效运行 Epic 所需的性能。  NetApp云选项通过 iSCSI 提供块并通过 NFS 或 SMB 提供文件。</block>
  <block id="c4a18a844b0430569f6e8b2d7bfc02b5" category="list-text">*第一方产品。*Amazon FSx for NetApp ONTAP、 Google Cloud NetApp Volumes和Azure NetApp Files在领先的公共云环境中提供高性能、多协议托管存储服务。VMware Cloud on AWS（VMC on AWS）、Azure VMware Solution（AVS）和 Google Cloud VMware Engine（GCVE）可以直接将它们用作客户操作系统（GOS）和计算实例的数据存储或存储。</block>
  <block id="e465d3a307ef6903982ceaea5de22f9a" category="list-text">*云服务。*使用NetApp Backup and Recovery或SnapMirror Cloud 通过公共云存储保护来自本地系统的数据。NetApp Copy and Sync有助于在 NAS 和对象存储之间迁移数据并保持数据同步。NetApp Disaster Recovery提供了一种经济高效的解决方案，利用NetApp技术作为强大且功能强大的灾难恢复解决方案的基础，适用于 DR 到云、DR 到本地以及本地到本地。</block>
  <block id="1e8675e287bf96049d13eb5bf5b6fac6" category="inline-link-macro">什么是Azure NetApp Files？</block>
  <block id="0756abbe79f45685a93dcbd06502741d" category="list-text"><block ref="0756abbe79f45685a93dcbd06502741d" category="inline-link-macro-rx"></block></block>
  <block id="1e813c9851ad8226497585cd68a9aa1c" category="paragraph">NetApp提供以下优质软件产品。它们不包含在ONTAP One 许可证中，必须单独购买。</block>
  <block id="46aee8859cf7d350c8d57a3c97362a07" category="list-text"><block ref="84f74eb2e2d8d303e0cb7d49d5faf63f" category="inline-link-rx"></block>适用于 VMware vSphere。这是一项基于云的服务，为 VMware 环境提供灾难恢复和备份。它可以与SnapCenter一起使用，也可以单独使用，并且支持使用 SAN 或 NAS 进行本地到本地的 DR，以及使用 NFS 进行本地到云/从云（如果支持）。</block>
  <block id="f2f7b54edfb5972f4e3e57e3873f8a6f" category="list-text"><block ref="32ac26eb0ba8de4f2245bdaa97bc7e60" category="inline-link-rx"></block>。这是一项基于云的服务，为 VMware 环境提供监控和分析。它支持异构存储环境中的其他存储供应商，以及多个交换机供应商和其他虚拟机管理程序。DII 提供有关 VMware 环境的性能、容量和健康状况的完整端到端洞察。</block>
  <block id="2d025755c29d2044d54015979818fb44" category="paragraph">除了AFF、 ASA和FAS系统上的ONTAP 9 之外， NetApp还支持ONTAP Select上的 VMware 工作负载、带有 VMware Cloud on AWS 的Amazon FSx for NetApp 、带有 Azure VMware Solution 的Azure NetApp Files 、带有 Google Cloud VMware Engine 的Google Cloud NetApp Volumes以及 Equinix 中的NetApp Private Storage，但具体功能可能因服务提供商和可用的网络连接而异。</block>
  <block id="2ee606af5da3062695cabb75a160eb48" category="inline-link">Equinix Metal 上的NetApp存储</block>
  <block id="fea612aa54d66a179c5538c5cd1b8525" category="paragraph">将 VLSR 部署与ONTAP高级数据管理功能相集成，与本地存储选项相比，可以大幅提高规模和性能。但更重要的是，它带来了混合云的灵活性。混合云可让您通过使用FabricPool将高性能阵列中未使用的数据块分层到您首选的超大规模器（可以是本地 S3 存储，例如NetApp StorageGRID）来节省资金。您还可以将SnapMirror用于基于边缘的系统，并使用软件定义的ONTAP Select或基于云的 DR<block ref="48f4ab00daadfbd5f3a95d2ba27ed047" category="inline-link-rx"></block>或其他托管ONTAP服务。</block>
  <block id="0fc9a0e7b30259b88ee28dc36905dc46" category="paragraph">灾难恢复 (DR) 是一种基于云的服务，可在发生灾难时提供保护您的数据和应用程序的全面解决方案。它提供了一系列功能，包括自动故障转移和故障恢复、多个时间点恢复点、应用程序一致的灾难恢复以及对本地和基于云的ONTAP系统的支持。NetApp Disaster Recovery旨在与ONTAP和您的 VMware vSphere 环境无缝协作，提供统一的灾难恢复解决方案。</block>
  <block id="b49008ff3ed6386e7b79c895a99dfda0" category="paragraph">调解员实际上并不是打破僵局的人，尽管它实际上发挥了这样的作用。中介器有助于确定集群节点的状态，并在站点发生故障时协助自动切换过程。在任何情况下，中介都不会传输数据。</block>
  <block id="389aace802a4b9cc02f057be6b44af1e" category="inline-link-macro"><block ref="389aace802a4b9cc02f057be6b44af1e" category="inline-link-rx"></block></block>
  <block id="3f5aed07b92e68d50c76da775ecd27e7" category="list-text">TR-4015 ONTAP 9 SnapMirror配置最佳实践指南 <block ref="2b18a9579e6e53dd966359ed48786df3" category="inline-link-macro-rx"></block></block>
  <block id="af5901ed678cf3616d5e1dd4457d3301" category="paragraph">有关ONTAP 9 的SnapMirror和SnapVault的最新信息，请参阅<block ref="f0cb7261aff0b0ca14230d45000a9acc" category="inline-link-rx"></block></block>
  <block id="0aa1117bb089f8873e3b481abb0fc667" category="inline-link">ONTAP SnapMirror复制工作流程</block>
  <block id="c7d6bfcc1002f9443cf062da6e677452" category="paragraph">有关快照的更多信息，请参阅ONTAP文档。以下链接提供了更多详细信息： <block ref="8952dffd5c4f20d5268260325aabe39c" category="inline-link-rx"></block> <block ref="929e1122e30b57f1156728cb315c1ee3" category="inline-link-rx"></block></block>
  <block id="fa3baa666422f615ee0c858e2af05bb1" category="list-text">配置本地备份<block ref="0322cca7da8e1c0c74e3021d8f78b104" category="inline-link-rx"></block>。</block>
  <block id="41100a7491d59c0ef8c938d85e01e5c1" category="list-text">创建存储虚拟机（SVM）及其协议配置。请注意， ASA r2 系统可能不需要这样做，因为它们通常已经有一个用于数据服务的 SVM。您可以选择 NVMe/FC（仅限ONTAP工具 9.13）、NFSv3、NFSv4.1、iSCSI、FCP 或这些选项的组合。NVMe/TCP 和 NVMe/FC 也可与ONTAP工具 10.3 及更高版本配合使用，用于传统的 VMFS 数据存储。您可以使用ONTAP系统管理器向导或集群 shell 命令行。</block>
  <block id="a667b507cc97b9e322f83694aef20f26" category="list-text">如果您打算对租户 vCenter 使用 SVM 范围的凭据，则每个 SVM 至少需要一个管理 LIF。</block>
  <block id="3047555801fe554dc4ff9eb83876f55f" category="list-text">对于非ASA r2 系统，此时可以创建卷，但最佳实践是让ONTAP工具中的 _Provision Datastore_ 向导创建它们。唯一的例外是，如果您计划将vVols复制与 VMware Site Recovery Manager 和ONTAP工具 9.13 一起使用。使用已存在的FlexVol卷和已建立的SnapMirror关系，设置起来会更容易。请注意不要在任何用于vVols 的卷上启用 QoS，因为这将由 SPBM 和ONTAP工具进行管理。</block>
  <block id="cefc859ccac1b3994312e8dd1ebb3c0b" category="list-text">ONTAP tools 10.0 及更高版本支持每个设备运行多个 vCenter 服务器；您不再需要为每个 vCenter 部署一个ONTAP tools 设备。</block>
  <block id="fb91efb595464d6bb7ce61d52e51afb8" category="list-text">如果您计划将多个 vCenter 连接到单个ONTAP工具实例，则必须创建并安装 CA 签名的证书。请参阅<block ref="32dbc6ca4c4a8bcb0695dd873f46e9e4" category="inline-link-rx"></block> 步骤如下。</block>
  <block id="4a628faabe7420580271b233272fa51c" category="list-text">从 10.3 版本开始， ONTAP工具现在可以部署为单节点小型设备，适用于大多数非 vVols 工作负载。</block>
  <block id="c5bfd1aed347562f4c83466e7148d3bc" category="list-text">推荐的最佳实践是<block ref="ef398e4ee19e56a537bbd5564e5f4512" category="inline-link-rx"></block> 10.3 及更高版本对所有生产工作负载采用 3 节点高可用性 (HA) 配置。对于实验室或测试目的，可以使用单节点部署。</block>
  <block id="5d30eb70e267f638c91e511336e18c50" category="list-text">生产环境中使用vVols的最佳实践建议是消除任何单点故障。创建反亲和性规则，防止ONTAP工具虚拟机在同一主机上同时运行。初始部署之后，还建议使用存储 vMotion 将ONTAP工具 VM 放入不同的数据存储中。了解更多<block ref="9d1413939148e981fa32923e1c0a740d" category="inline-link-rx"></block> 或者<block ref="33bad2ad715296cb3b9df2aa8e0bbe93" category="inline-link-rx"></block>。您还应该安排定期备份，和/或<block ref="afe67d2e70705f50a69e7f10157eddf5" category="inline-link-rx"></block>。</block>
  <block id="b6fa162d550fdf3811bb66a421d37a80" category="list-text">向 vCenter 管理员提供特定的 SVM 凭据，管理员随后会将 SVM 添加为 vCenter 中ONTAP工具存储后端菜单中的存储后端。</block>
  <block id="6e8ad103d591d2950b1fe8bfa0008d9e" category="list-text">ONTAP工具包含一个 JSON 文件，其中包含ONTAP工具存储帐户所需的必要角色权限。您可以将 JSON 文件上传到ONTAP系统管理器，以简化 RBAC 角色和用户的创建。</block>
  <block id="de0a42cf0bf16700b2d6ceaa65e730ff" category="admonition">之所以需要在ONTAP工具管理器 UI 中对整个集群进行配置，是因为用于vVols的许多 API 仅在集群级别可用。</block>
  <block id="32a092925eea22c0b1d4fe921bee9674" category="list-text">ONTAP工具 10.3，以及ASA r2 之前的ONTAP FAS、 AFF和ASA 。</block>
  <block id="698e9066527b73452158df76842fdbce" category="list-text">单击“添加新卷”或“使用现有卷”，然后指定属性。请注意，在ONTAP工具 10.3 中，您可以同时请求创建多个卷。您还可以手动添加多个卷，以在ONTAP集群中实现卷的平衡。点击“下一步”</block>
  <block id="672114503f75f02ec534447f449e3aea" category="paragraph">要实现基于策略的存储配置自动化，您需要创建与所需存储功能相对应的虚拟机存储策略。</block>
  <block id="e379bf0b5f962009eafc2e78e4ccd8ad" category="paragraph">在 vSphere 中，虚拟机存储策略用于管理可选功能，例如存储 I/O 控制或 vSphere 加密。它们还与vVols一起使用，以便为虚拟机应用特定的存储功能。使用“ NetApp ”存储类型。有关使用ONTAP工具 VASA Provider 的示例，请参阅链接：vmware-vvols-ontap.html#Best Practices[使用 NFS v3 上的vVols进行网络配置的示例]。“ NetApp.clustered.Data. ONTAP.VP.VASA10”存储的规则将与非基于 vVols 的数据存储一起使用。</block>
  <block id="47e0e897820975c7c38f37533787dde3" category="paragraph">更改性能功能（例如最小和最大 IOPS）需要注意具体的配置。</block>
  <block id="b27853fb2993befbcb7d7e7a6c3a1927" category="list-text">更改策略中的 IOPS 不会改变vVols上的 QoS，直到将 VM 策略重新应用到使用该策略的 VM。或者，您可以创建一个具有所需 IOPS 的新策略，并将其应用于目标虚拟机。一般来说，建议为不同的服务层级定义单独的虚拟机存储策略，然后在虚拟机上更改虚拟机存储策略即可。</block>
  <block id="66f65a7c73ea75782888c8906ba2f531" category="list-text">ASA、 ASA r2、 AFF和FAS人格类型具有不同的 IOP 设置。所有闪光灯系统都支持最小和最大 IOP 设置；但是，非AFF系统只能使用最大 IOP 设置。</block>
  <block id="d0cd506b6c0d5ed0d5425daa47dfeb60" category="paragraph">| 虚拟卷数据存储是vVols容器的逻辑数据存储表示，由 VASA 提供商创建和维护。该容器代表由 VASA 提供商管理的存储系统提供的存储容量池。ONTAP工具支持将多个FlexVol卷（称为后备卷）分配给单个vVols数据存储，这些vVols数据存储可以跨越ONTAP集群中的多个节点，将具有不同功能的闪存和混合系统结合起来。管理员可以使用配置向导或 REST API 创建新的FlexVol卷，或者选择预先创建的FlexVol卷作为后备存储（如果有的话）。</block>
  <block id="a6a73b3a10a10b51bba03dc762f92a92" category="paragraph">vVols是存储在vVols数据存储中的实际虚拟机文件和磁盘。使用术语 vVol（单数）指的是单个特定文件、LUN 或命名空间。ONTAP根据数据存储使用的协议创建 NVMe 命名空间、LUN 或文件。vVols)有几种不同的类型；最常见的包括配置卷 (Config，唯一使用 VMFS 文件系统的卷，包含元数据文件，例如虚拟机的 VMX 文件)、数据卷 (Data，虚拟磁盘或 VMDK) 和交换卷 (Swap，在虚拟机启动时创建)。受 VMware 虚拟机加密保护的vVols类型为“其他”。VMware VM 加密不应与ONTAP卷或聚合加密混淆。</block>
  <block id="2b0dd43a13989e23e28f9ebb507c10be" category="section-title">基于政策的管理</block>
  <block id="d6f00e5aae221de00f33ed84d98aeeda" category="paragraph">VMware vSphere API for Storage Awareness (VASA) 使虚拟机管理员能够轻松使用配置虚拟机所需的任何存储功能，而无需与存储团队进行交互。在 VASA 出现之前，虚拟机管理员可以定义虚拟机存储策略，但必须与存储管理员合作来确定合适的数据存储，通常是通过文档或命名约定来实现的。借助 VASA，具有相应权限的 vCenter 管理员可以定义一系列存储功能，供 vCenter 用户用于配置虚拟机。VM 存储策略与数据存储功能之间的映射关系，使得 vCenter 能够显示可供选择的兼容数据存储列表，并支持其他技术，例如 VCF（以前称为 Aria 和 vRealize）自动化或 VMware vSphere Kubernetes 服务 (VKS)，从分配的策略中自动选择存储。这种方法被称为基于存储策略的管理。虽然 VASA Provider 规则和 VM 存储策略也可以与传统数据存储一起使用，但我们在这里的重点是vVols数据存储。</block>
  <block id="429ed308056ea5f8d3df998e8661d751" category="paragraph">一旦虚拟机完成配置，VASA 提供商将继续检查合规性，并在备份卷不再符合策略时通过 vCenter 中的警报提醒虚拟机管理员。</block>
  <block id="2b71981af75257a406431c49fe3b8723" category="paragraph">ONTAP自 2012 年首次发布以来就一直支持 VASA 规范。虽然其他NetApp存储系统可能支持 VASA，但本文档重点介绍当前支持的ONTAP 9 版本。</block>
  <block id="29c9d02592dad3fe1d168768977884ff" category="paragraph">截至本文发布时，超大规模环境仅限于传统的 NFS v3 数据存储；因此， vVols仅适用于本地ONTAP系统，或提供本地系统全部功能的云连接系统，例如NetApp合作伙伴和全球服务提供商托管的系统。</block>
  <block id="61ff9bb3324d0333e1239537ddd0a4ff" category="paragraph">2015 年，VMware 在 VASA 2.0 中引入了vVols支持，他们将其描述为“一个集成和管理框架，为外部存储（SAN/NAS）提供了一种新的操作模式”。这种运行模式与ONTAP存储相结合，具有诸多优势。</block>
  <block id="268208b0fa10cfeb5423cddf7639a4fb" category="paragraph">如第 1.2 节所述，基于策略的管理允许使用预定义的策略来配置和随后管理虚拟机。这可以从多个方面帮助IT运维：</block>
  <block id="bd9a10f490f8034385f873c360de29c0" category="list-text">提高速度。ONTAP工具消除了 vCenter 管理员为存储配置活动向存储团队开具工单的需要。但是，通过限制对特定功能的访问， ONTAP工具在 vCenter 和ONTAP系统中的 RBAC 角色仍然允许独立团队（例如存储团队）或同一团队开展独立活动。</block>
  <block id="57e53c1d32a2012eca394e4b926e662d" category="paragraph">使用光纤通道和 iSCSI 的 SAN 存储系统是 VMware ESX 最早支持的存储系统，但它们缺乏从存储系统管理单个 VM 文件和磁盘的功能。相反，系统会配置 LUN，然后由 VMFS 管理各个文件。这使得存储系统难以直接管理单个虚拟机的存储性能、克隆和保护。vVols 结合了vVols存储用户已经享有的存储粒度控制，以及ONTAP强大的高性能 SAN 功能。</block>
  <block id="e685b5808aa3d45726f9fa420d612499" category="paragraph">现在，借助 vSphere 8 和ONTAP tools for VMware vSphere， vVols用于传统 SCSI 协议的那些精细控制功能，现在也可以在现代光纤通道 SAN 中使用 NVMe over Fabrics 来实现，从而在规模上获得更高的性能。借助 vSphere 8.0 更新 1，现在可以部署完整的端到端 NVMe 解决方案，使用vVols，而无需在虚拟机管理程序存储堆栈中进行任何 I/O 转换。</block>
  <block id="4595fa438a32e8c0c07a9bac5336deb5" category="paragraph">虽然 VAAI 提供各种卸载到存储的操作，但 VASA 提供商可以解决一些问题。SAN VAAI 无法将 VMware 管理的快照卸载到存储系统。NFS VAAI 可以卸载 VM 管理的快照，但对具有存储原生快照的 VM 存在一些限制。由于vVols使用单独的 LUN、命名空间或文件作为虚拟机磁盘， ONTAP可以快速高效地克隆文件或 LUN，从而创建 VM 粒度的快照，不再需要增量文件。NFS VAAI 也不支持热（通电）Storage vMotion 迁移的卸载克隆操作。当使用 VAAI 和传统 NFS 数据存储时，必须关闭虚拟机电源才能卸载迁移任务。ONTAP工具中的 VASA 提供程序可以实现近乎即时、存储高效的热迁移和冷迁移克隆，并且还支持对vVols进行近乎即时的跨卷迁移复制。由于这些显著的存储效率优势，您或许能够充分利用vVols工作负载。<block ref="9d1af7a9d4f98887e53c1a9bedbce044" category="inline-link-rx"></block> 程序。同样，如果使用 VAAI 进行跨卷克隆不能满足您的要求，那么借助vVols 的复制体验改进，您很可能能够解决您的业务难题。</block>
  <block id="020478d1582d888a4b791c9b662505b9" category="list-text">VMware vSphere Kubernetes Service (VKS) 持久卷。</block>
  <block id="53a448a8a5917d3739e5a38641e09b61" category="list-text">通过独立的 VMDK 生命周期管理提供类似 Amazon EBS 的服务。</block>
  <block id="2625ac556b206894854d65e8c2d8dd60" category="list-text">在ONTAP集群中，克隆可以在单个卷内或跨多个卷快速创建，这比传统的启用 VAAI 的克隆具有优势。它们还具有良好的存储效率。卷内的克隆使用ONTAP文件克隆，类似于FlexClone卷，仅存储源 vVol 文件/LUN/命名空间的更改。因此，用于生产或其他应用程序用途的长期虚拟机可以快速创建，占用空间极小，并且可以受益于虚拟机级别的保护（使用适用于 VMware vSphere 的NetApp SnapCenter插件、VMware 管理的快照或 VADP 备份）和性能管理（使用ONTAP QoS）。使用vVols进行跨卷克隆比使用 VAAI 快得多，因为使用 VASA，我们可以在复制完成之前创建克隆并允许在目标位置访问它。数据块作为后台进程复制到目标 vVol。这与ONTAP对传统 LUN 的非中断式 LUN 迁移的工作方式类似。</block>
  <block id="4dc7238e721d4ca5345cd81e6c8cb3e0" category="list-text">亚马逊 EBS 类服务可以通过 FCD 交付，因为 FCD VMDK 顾名思义是 vSphere 中的一等公民，其生命周期可以独立于它可能附加到的虚拟机进行管理。</block>
  <block id="ec23f03594c1cf8ce973ded1ce2c46bd" category="paragraph">vCenter Server Appliance (VCSA) 是一个功能强大的集中式管理系统和 vSphere 的单一管理界面，使管理员能够有效地操作 ESXi 集群。它支持虚拟机配置、vMotion 操作、高可用性 (HA)、分布式资源调度器 (DRS)、VMware vSphere Kubernetes 服务 (VKS) 等关键功能。它是 VMware 云环境中的一个重要组成部分，在设计时应考虑到服务的可用性。</block>
  <block id="af47b720024b8b1ab024ae20f4022d06" category="paragraph">vSphere HA 集群从故障服务器恢复虚拟机。</block>
  <block id="0c56b1414177813b5b1a16b32ed9d5ac" category="paragraph">HA集群创建完成后，集群中的所有主机都会参与选举，其中一台主机将成为主主机。每个从设备都会向主设备发送网络心跳信号，而主设备反过来也会向所有从设备主机发送网络心跳信号。vSphere HA 集群的主主机负责检测从主机的故障。</block>
  <block id="c9f8dbe3b85827073fec58373038b8e3" category="paragraph">隔离响应是 vSphere HA 中的一项设置，用于确定当 vSphere HA 集群中的主机失去其管理网络连接但仍继续运行时，在虚拟机上触发的操作。此设置有三个选项：“禁用”、“关闭并重启虚拟机”和“关闭电源并重启虚拟机”。</block>
  <block id="2f8a6f413f09b796f9ebf6bf39d1ee4f" category="paragraph">“关机”比“断电”更好，“断电”不会将最近的更改刷新到磁盘或提交事务。如果虚拟机在 300 秒内没有关闭，则会将其断电。要更改等待时间，请使用高级选项 das.isolationshutdowntimeout。</block>
  <block id="895d9c0d44a4811deea841128e0e1ef4" category="paragraph">PDL 是指存储设备永久发生故障或被管理员移除且预计不会恢复的情况。NetApp存储阵列向 ESXi 发出 SCSI Sense 代码，声明该设备已永久丢失。在 vSphere HA 的“故障条件和 VM 响应”部分，您可以配置检测到 PDL 条件后应采取的响应。</block>
  <block id="7b2473c88828f0e4e9ae70e269a94371" category="paragraph">NetApp建议将“带有 PDL 的数据存储的响应”设置为“*关闭电源并重新启动虚拟机*”。当检测到此情况时，虚拟机将在 vSphere HA 集群中运行正常的宿主机上立即重新启动。</block>
  <block id="99ca3d06ef1fb8b0d3501365bab5899a" category="paragraph">APD 是指存储设备对主机不可见，且没有通往阵列的路径时发生的情况。ESXi 认为这是设备的暂时性问题，预计该设备将再次可用。</block>
  <block id="8bf5af809d53b1494fe364d8cbe68c9f" category="list-text">保守性是指 HA 能够重启虚拟机的可能性。当设置为保守模式时，HA 仅在知道另一台主机可以重启受 APD 影响的虚拟机时才会重启该虚拟机。对于“积极型”HA，即使不知道其他主机的状态，它也会尝试重启虚拟机。如果没有主机可以访问虚拟机所在的存储区域，则可能导致虚拟机无法重启。</block>
  <block id="7fce4a8e4d875aacc44e3d2ed8580a5d" category="paragraph">您可以为 vSphere HA 故障转移行为指定两种类型的规则：</block>
  <block id="26cc6fc2decc1bcfa2c0a112114e3acc" category="paragraph">服务的可用性应始终优先于服务的性能。如果整个数据中心发生故障，“必须”规则必须从 VM 主机亲缘性组中选择主机，并且当数据中心不可用时，虚拟机将不会重新启动。</block>
  <block id="81430f9750a817293c793dd7958f44fa" category="list-text">如果您正在使用ONTAP快照，则存储 vMotion 会在快照中留下 VM 的副本，这可能会增加存储利用率，并可能影响NetApp SnapCenter等备份应用程序，这些应用程序会跟踪 VM 及其ONTAP快照。</block>
  <block id="f51e6cb0023f640f3e441b33ea6d90b2" category="summary">使用ASA r2 的 Oracle 数据库块大小</block>
  <block id="b74e31875db8b4ffb64a32f6af8a00c3" category="paragraph">ONTAP内部使用可变块大小，这意味着 Oracle 数据库可以配置为所需的任何块大小。然而，文件系统块大小会影响性能，在某些情况下，更大的重做块大小可以提高性能。</block>
  <block id="25efcd88d2bb8d1c51866688d59b6df0" category="paragraph">与AFF/ FAS系统相比， ASA r2 对 Oracle 块大小建议没有任何改变。ONTAP在所有平台上的行为保持一致。</block>
  <block id="45dfed63ad9cfaef8f16e45163f1ddcb" category="summary">Oracle 数据库参数 - filesystemio_options（ ASA r2）</block>
  <block id="29967c867552a538cee57e0fefdb1612" category="paragraph">ASA r2 上的 filesystemio_options 的行为和建议与AFF/ FAS系统相同，因为该参数是 Oracle 特有的，与存储平台无关。ASA r2 和AFF/ FAS一样使用ONTAP ，因此相同的最佳实践也适用。</block>
  <block id="4725bcfd9454b799bd0d8edf9880b9c6" category="admonition">在 ASM 环境中，Oracle 会自动对 ASM 管理的磁盘使用直接 I/O 和异步 I/O，因此<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 对 ASM 磁盘组没有影响。对于非 ASM 部署（例如，SAN LUN 上的文件系统），请设置：<block ref="6a1623be7d673ed665d6446f22dbb37c" prefix=" " category="inline-code"></block>。这样既可以实现异步 I/O，也可以实现直接 I/O，从而获得最佳性能。</block>
  <block id="11277a7f8d508b5b546ee39af32e9b34" category="paragraph">一些较旧的操作系统在异步 I/O 方面存在问题，导致一些过时的建议认为应该避免使用异步 I/O。但是，异步 I/O 稳定可靠，并且在所有当前的操作系统上都得到全面支持。除非发现特定的操作系统漏洞，否则没有理由禁用它。</block>
  <block id="3d1060d19355a79188cebceddfe20cac" category="admonition">NetApp建议设置<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 到<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block>但请注意，在某些情况下，主机缓冲区缓存的丢失可能需要增加 Oracle SGA。ASA r2 系统针对低延迟的 SAN 工作负载进行了优化，因此使用 setall 与 ASA 的高性能 Oracle 部署设计完美契合。</block>
  <block id="cc9bafe604d9f828f9e50b888b5af83a" category="summary">Oracle 数据库参数 - db_file_multiblock_read_count（ ASA r2）</block>
  <block id="77da25139302fac7c4678c7feff95328" category="paragraph">与AFF/ FAS系统相比，建议没有变化。ONTAP 的行为和 Oracle 最佳实践在ASA r2、 AFF和FAS平台上保持不变。</block>
  <block id="7a6b7a0812fd796dcb806fd5b0c2b6c7" category="summary">Oracle RAC 超时与ASA r2</block>
  <block id="f034ddba34805dbfe68b7f48ca895681" category="searchtitle">Oracle Real Application Clusters 与ASA r2 出现超时问题</block>
  <block id="6ee77b798f308781373f865ac29cba09" category="paragraph">ASA r2 系统使用ONTAP，就像AFF/ FAS一样，因此相同的原则也适用于 Oracle RAC 超时参数。ASA没有针对磁盘超时或错误计数建议的特定更改。然而， ASA r2 针对 SAN 工作负载和低延迟故障转移进行了优化，这使得这些最佳实践变得更加重要。</block>
  <block id="9f7a41723dc84c90511cb0c3007557cc" category="admonition">信息中 <block ref="9cd17d807316d35ef47b12cbecab4ec8" category="inline-link-macro-rx"></block> 本节包含使用网络存储的 Oracle RAC 环境的关键信息，在许多情况下，需要更改默认的 Oracle RAC 设置，以确保 RAC 集群在网络路径更改和存储故障转移操作后仍能正常运行。</block>
  <block id="c03d1b47221ed5a173395512ed362d44" category="list-text"><block ref="ff4a008470319a22d9cf3d14af485977" prefix="" category="inline-code"></block> 二进制文件位于网络附加驱动器上，包括 iSCSI、FC 和基于数据存储的驱动器。</block>
  <block id="543df3f730045fd30ce4af77abea11e1" category="list-text">ASA r2 的 SAN 优化设计降低了故障转移延迟，但对于网络启动或网格二进制文件，超时时间仍需进行调整。</block>
  <block id="82106d3b2ed91a254d7c6d4d5342cbc1" category="list-text">对于扩展的 RAC 或主动-主动设置（例如， SnapMirror主动同步），超时调整对于零 RPO 架构仍然至关重要。</block>
  <block id="6c7de758773bd93ee212e9116ff23b70" category="summary">数据库和ASA r2 ONTAP存储容量以及ASA r2 上的可用空间</block>
  <block id="0ba26eed20c7a72b7557b1dca31463f8" category="searchtitle">ASA r2 上的 Oracle 数据库和存储容量管理</block>
  <block id="fec46d85c88737d5c6bc3c8fb9d31d07" category="paragraph">ASA r2 使用存储可用区 (SAZ) 而不是聚合，但原理仍然相同：可用空间包括未被实际数据、快照或系统开销占用的任何物理容量。还必须考虑精简配置——逻辑分配并不能反映真实的物理使用情况。</block>
  <block id="fd3c3ddb6afa0f19ccd103893bdfff01" category="paragraph">NetApp对用于企业应用的ASA r2 存储系统的建议如下：</block>
  <block id="b117f27a635613ecfcbec6e1b094b82f" category="section-title">ASA r2 系统中的 SSD 池</block>
  <block id="286282b47dd388584f0b47bb531e0c18" category="admonition">NetApp建议在ASA r2 环境中保持至少 10% 的可用物理空间。本指南适用于ASA r2 系统使用的仅限 SSD 的存储池，包括 SAZ 和存储单元内的所有未使用空间。逻辑空间并不重要；重点在于可用于数据存储的实际物理空间。</block>
  <block id="e44f572dc67206f5fe79649b7a71ea39" category="paragraph">虽然ASA r2 可以维持高利用率而不降低性能，但在接近满负荷运行时，扩展存储时会增加空间耗尽和管理开销的风险。驱动器利用率超过 90% 可能不会影响性能，但会使管理复杂化并延迟额外驱动器的配置。</block>
  <block id="0d0fe41e4cffbd1cbbfd0ff604e5847a" category="paragraph">ASA r2 系统支持高达 128TB 的存储单元和高达 2PB 的 SAZ 大小（每个 HA 对）， ONTAP会自动在节点之间平衡容量。监控集群、SAZ 和存储单元级别的利用率对于确保快照、精简配置工作负载和未来增长有足够的可用空间至关重要。如果容量接近临界阈值（~90% 利用率），则应分组（至少六个驱动器）添加额外的 SSD，以保持性能和弹性。</block>
  <block id="9c4d6eff4aaa2da2a41a618d4e6308e6" category="summary">使用ASA r2 提升 Oracle 数据库和存储效率</block>
  <block id="eaad7dcfc067b66ed2d62d108f314eaa" category="searchtitle">Oracle 数据库和ONTAP与ASA r2 的效率特性</block>
  <block id="97c9a5fb8d9dca6d787d486fae38909e" category="paragraph">ONTAP 的空间效率功能已得到全面支持，并针对ASA r2 系统进行了优化。在几乎所有情况下，最佳做法是保留默认设置并启用所有效率功能。</block>
  <block id="29e5740ae1265e0ae9ddc367075a430d" category="paragraph">ASA r2 系统是全闪存 SAN 平台，因此压缩、精简和重复数据删除等效率技术对于最大限度地提高可用容量和降低成本至关重要。</block>
  <block id="0e607e6969928c8f0be851b17df35b7c" category="paragraph">压缩通过对数据中的模式进行编码来减少空间需求。采用基于 SSD 的ASA r2 系统，压缩可显著节省成本，因为闪存消除了为提高性能而过度配置的需要。ONTAP自适应压缩默认启用，并已使用企业工作负载（包括 Oracle 数据库）进行了全面测试，即使在延迟以微秒为单位测量的环境中，也没有可衡量的性能影响。在某些情况下，由于压缩数据占用更少的缓存空间，性能会得到提升。</block>
  <block id="acf1c3f0880b3b517ae9c08198c3313c" category="admonition">温度敏感存储效率 (TSSE) 不适用于ASA r2 系统。在ASA r2 系统中，压缩不是基于热数据（经常访问的数据）或冷数据（不经常访问的数据）。压缩无需等待数据冷却即可开始。</block>
  <block id="c9359b028210c16d749a4ad44ceef2fe" category="paragraph">自适应压缩默认使用 8KB 的块大小，与关系数据库常用的块大小相匹配。较大的块大小（16KB 或 32KB）可以提高顺序数据（如事务日志或备份）的效率，但对于活动数据库应谨慎使用，以避免在覆盖期间产生开销。</block>
  <block id="47e17029663cd0a26bc74c23a15916f1" category="admonition">对于日志或备份等静止文件，块大小可以增加到 32KB。更改默认设置前，请先查阅NetApp指南。</block>
  <block id="fb88d498aeb61ef7dc46cf0183899e05" category="admonition">不要对流式备份使用 32KB 压缩和去重功能。使用 8KB 压缩以保持去重效率。</block>
  <block id="fce01c72f00048fc766f0b547b80b0c1" category="paragraph">对于随机覆盖，压缩对齐很重要。确保 LUN 类型正确、分区偏移量（8KB 的倍数）以及文件系统块大小与数据库块大小一致。备份或日志等顺序数据不需要考虑对齐问题。</block>
  <block id="2f096f341d922649f5787ac9dc67736f" category="paragraph">压缩是对压缩的补充，它允许多个压缩块共享同一个物理块。例如，如果一个 8KB 的数据块压缩到 1KB，压缩可以确保剩余空间不会被浪费。此功能为内联功能，不会造成性能损失。</block>
  <block id="6d6c415da1e0bfc92ede47ea457bacfe" category="paragraph">去重操作会移除数据集中的重复数据块。虽然 Oracle 数据库由于具有独特的块头和块尾，通常只能节省极少的重复数据，但ONTAP重复数据删除仍然可以从零块和重复模式中回收空间。</block>
  <block id="afe06725d3e8e69f957d42e07a4d2ac6" category="paragraph">ASA r2 系统默认使用精简配置。效率特性与精简配置相辅相成，可最大限度地利用可用容量。</block>
  <block id="3ae7feb5d9cb2335f10922aa1130319d" category="admonition">在ASA r2 存储系统上，存储单元始终采用精简配置。不支持厚配置。</block>
  <block id="b562c9523a15796f6734824c6906ea4b" category="section-title">快速辅助技术（QAT）</block>
  <block id="9d501bcd94601848e35a4581445c16ae" category="paragraph">在NetApp ASA r2 平台上，Intel QuickAssist 技术 (QAT) 提供硬件加速的效率，这与没有 QAT 的基于软件的温度敏感存储效率 (TSSE) 有很大不同。</block>
  <block id="a5b1922762277348e395a0f5bb63a066" category="paragraph">*支持硬件加速的快速访问终端 (QAT)：*</block>
  <block id="7f061561c79fda3cf285f802ab1df9dd" category="list-text">将压缩和加密任务从 CPU 核心卸载。</block>
  <block id="daf76bc97dc262e8534a7d1b39c594b8" category="list-text">能够立即提高热数据（频繁访问的数据）和冷数据（不频繁访问的数据）的在线处理效率。</block>
  <block id="e0f81090ab3cc33731ea0afa51ad04be" category="list-text">显著降低CPU占用率。</block>
  <block id="ea763c657dce8d1d285478f80caeaa58" category="list-text">提供更高的吞吐量和更低的延迟。</block>
  <block id="96458f7ac4191be2139fef330262c1f1" category="list-text">提高了对性能要求较高的操作（例如 TLS 和 VPN 加密）的可扩展性。</block>
  <block id="1121032714cb05a8acd4182211a3d959" category="paragraph">*不含QAT的TSSE：*</block>
  <block id="87dd7a76029eb48dc4829ef2fb0998f1" category="list-text">依靠CPU驱动的进程来实现高效运行。</block>
  <block id="cc16c02975ac3a8fc5a6760ee8b59086" category="list-text">仅对延迟后的冷数据应用效率优化。</block>
  <block id="dbb9a4d9b6afe5a22a188b05e2c55aca" category="list-text">消耗更多CPU资源。</block>
  <block id="15c9489f22847ad34cca043b0d3781d9" category="list-text">与 QAT 加速系统相比，整体性能受到限制。</block>
  <block id="7f0fa9ea3b1bfd8171845c4fd64b045b" category="paragraph">因此，现代ASA r2 系统比旧式的仅支持 TSSE 的平台具有更快的硬件加速效率和更好的系统利用率。</block>
  <block id="17d46209898416a0271a7a40a040fa62" category="section-title">ASA r2 的效率最佳实践</block>
  <block id="52101fec2ca49d6ad57b390b63e72b67" category="section-title">ASA r2 默认值</block>
  <block id="1dc9bf51a5f61b552c5fb6db7bd754ab" category="paragraph">在ASA r2 系统上运行的ONTAP上创建的存储单元采用精简配置，默认情况下启用所有内联效率功能，包括压缩、精简和重复数据删除。尽管 Oracle 数据库通常不会从重复数据删除中获益匪浅，并且可能包含不可压缩的数据，但这些默认设置几乎适用于所有工作负载。ONTAP旨在高效处理所有类型的数据和 I/O 模式，无论它们是否能带来节省。只有在完全了解原因并且偏离默认设置有明显好处的情况下，才应该更改默认设置。</block>
  <block id="db430188d143b5480822ddee760e1628" category="list-text">禁用加密或应用程序压缩数据的压缩：如果文件已经在应用程序级别压缩或加密，请禁用压缩以优化性能并允许在其他存储单元上更高效地运行。</block>
  <block id="629e6580aba1cbe6cff5a2d11fd73f2b" category="list-text">避免将大压缩块与重复数据删除结合使用：不要在数据库备份中同时使用 32KB 压缩和重复数据删除。对于流式备份，请使用 8KB 压缩以保持去重效率。</block>
  <block id="339bd8b6442c9bc710297e62b92fe61c" category="list-text">监控效率节省：使用ONTAP工具（系统管理器、 Active IQ）跟踪实际的空间节省情况，并在需要时调整策略。</block>
  <block id="5e9589652c75095a75909065d8a0d93f" category="summary">要确保 Oracle 数据库操作不会因这些操作而中断，就需要了解存储接管功能。此外，收购操作中使用的论据如果使用不当，可能会影响数据完整性。</block>
  <block id="73561d6c3983a6b603417a787cf17ce9" category="searchtitle">ASA r2 中的 Oracle 数据库和ONTAP控制器故障转移</block>
  <block id="817dbb89ea186ed07c38e66cc3f11ad2" category="doc">ONTAP故障转移</block>
  <block id="6217c84a6fec75785f109083aaaa4617" category="paragraph">要确保 Oracle 数据库操作在这些操作期间不会中断，就需要了解存储接管功能。此外，收购操作中使用的论点如果使用不当，可能会影响数据完整性。</block>
  <block id="0ee72c88d56aef3026c4fb8a22263fb4" category="paragraph">正常情况下，写入给定控制器的传入数据会同步镜像到其高可用性伙伴。在具有SnapMirror Active Sync (SM-as) 的ASA r2 环境中，写入操作也会镜像到辅助站点的远程控制器。只有当写入操作在所有位置都存储在非易失性介质中时，主机应用程序才能收到确认。</block>
  <block id="8729e9a956b08f3fe788c6d911ba78fa" category="paragraph">存储写入数据的介质称为非易失性存储器（NVMEM）。它有时被称为非易失性随机存取存储器（NVRAM），可以将其视为写入日志而不是缓存。正常运行期间，不会读取NVMEM中的数据；它仅用于在软件或硬件发生故障时保护数据。当数据写入驱动器时，数据是从系统 RAM 传输的，而不是从NVMEM传输的。</block>
  <block id="3b95fd9bb9e3f2ccc9cb80f0a533d06e" category="paragraph">在接管操作期间，HA 对中的一个节点会接管其伙伴节点的操作。在ASA r2 中，由于不支持MetroCluster ，因此无法进行切换；取而代之的是， SnapMirror Active Sync 提供站点级冗余。例行维护期间的存储接管操作应该是透明的，除了网络路径改变时操作会短暂暂停之外。网络可能很复杂，而且很容易出错，因此NetApp强烈建议在将存储系统投入生产之前彻底测试接管操作。这样做是确保所有网络路径都正确配置的唯一方法。在 SAN 环境中，使用以下命令验证路径状态<block ref="41dc2c94e82e1c56ba876085acf5a974" prefix=" " category="inline-code"></block> 或者使用操作系统自带的多路径工具，以确保所有预期路径都可用。ASA r2 系统为 LUN 提供所有活动的优化路径，使用 NVMe 命名空间的客户应依赖操作系统原生工具，因为 sanlun 不涵盖 NVMe 路径。</block>
  <block id="fbd1162054dfcc75279eb74994c81fc2" category="paragraph">强制收购时必须谨慎行事。强制更改存储配置意味着忽略拥有驱动器的控制器的状态，备用节点强制接管驱动器的控制权。强制接管操作不当可能导致数据丢失或损坏，因为强制接管操作可能会丢弃NVMEM的内容。接管完成后，数据丢失意味着从数据库的角度来看，存储在驱动器上的数据可能会恢复到稍旧的状态。</block>
  <block id="417180065e1db56271a50819dfc8d77a" category="paragraph">使用普通HA对进行强制接管的情况应该很少发生。在几乎所有故障情况下，节点都会关闭并通知合作伙伴，以便进行自动故障转移。有些极端情况，例如滚动故障，其中节点之间的互连丢失，然后一个控制器发生故障，在这种情况下需要强制接管。在这种情况下，节点之间的镜像会在控制器发生故障之前丢失，这意味着幸存的控制器不再拥有正在进行的写入操作的副本。收购必须强制执行，这意味着数据可能会丢失。</block>
  <block id="eac9e01dcafe5df31549db862e4b5e12" category="paragraph">NetApp 建议采取以下预防措施：</block>
  <block id="a0033c4526f3231e5c7e8c2c6461cbe2" category="list-text">务必小心，不要意外地促成收购。通常情况下，不应该强制执行更改，强制更改可能会导致数据丢失。</block>
  <block id="9215c7ac58dee80cff52c5d5fa62a977" category="list-text">如果需要强制接管，请确保应用程序已关闭，所有文件系统已卸载，并且逻辑卷管理器 (LVM) 卷组已关闭。必须卸载 ASM 磁盘组。</block>
  <block id="5ebade231442483b3d9dd2848baa6ccc" category="inline-link">ASA r2 系统上的SnapMirror主动同步</block>
  <block id="fd360c79cec2c6ecdbf2a17c6ad2be7f" category="list-text">在使用 SM-as 时，如果发生站点级故障， ONTAP Mediator 辅助的自动非计划故障转移将在幸存集群上启动，这将导致短暂的 I/O 暂停，然后数据库转换将从幸存集群继续进行。更多信息请参见<block ref="e60237ff925f4fb2924a96cecb00f215" category="inline-link-rx"></block> 详细配置步骤请见下文。</block>
  <block id="20b465cc6f734e64de0fc141d799a08b" category="summary">在ASA r2 上使用ONTAP QoS 进行 Oracle 数据库性能管理</block>
  <block id="2579c376f51f8f990ad0da35fad7b27f" category="doc">在ASA r2 系统上使用ONTAP QoS 进行性能管理</block>
  <block id="f35a95ecdbc736cf5efbd3ffed0758e4" category="paragraph">在ASA r2 上安全高效地管理多个 Oracle 数据库需要有效的 QoS 策略。这一点尤其重要，因为ASA r2 系统是全闪存 SAN 平台，专为极高的性能和工作负载整合而设计。</block>
  <block id="fb0f677afb501d6e6b186ff048005ff0" category="paragraph">即使是最强大的控制器，相对较少的 SSD 也可能会使其达到饱和，因此 QoS 控制对于确保跨多个工作负载的可预测性能至关重要。作为参考， ASA r2 系统（例如ASA A1K 或 A90）可以提供数十万到超过一百万的 IOPS，延迟低于毫秒级。很少有单个工作负载会消耗如此高的性能，因此要充分利用性能通常需要托管多个数据库或应用程序。安全地执行此操作需要 QoS 策略来防止资源争用。</block>
  <block id="56f97482820208f3d16d39528cfb6570" category="paragraph">ONTAP QoS 在ASA r2 上的工作原理与在AFF/ FAS系统上相同，主要有两种类型的控制：IOPS 和带宽。QoS 控制可以应用于 SVM 和 LUN。</block>
  <block id="2e6032fca80b51e97df45f1a5170bd68" category="paragraph">基于 IOPS 的 QoS 限制了给定资源的总 IOPS。在ASA r2 中，QoS 策略可以应用于 SVM 级别和单个存储对象（例如 LUN）。当工作负载达到其 IOPS 限制时，额外的 I/O 请求会排队等待令牌，从而引入延迟。这是预期行为，可以防止任何单一工作负载垄断系统资源。</block>
  <block id="3edd2c44fe87d2162de06be373a31a13" category="admonition">将 QoS 控制应用于数据库事务/重做日志数据时要谨慎。这些工作负载具有突发性，对于平均活动而言看似合理的 QoS 限制可能对于峰值突发而言过低，从而导致严重的性能问题。一般而言，重做日志和归档日志不应受服务质量 (QoS) 的限制。</block>
  <block id="31aa78c338ede606cfe715629f639a6b" category="paragraph">基于带宽的服务质量限制吞吐量（以Mbps为单位）。当工作负载执行大块读取或写入操作（例如全表扫描或备份操作）时，这非常有用，因为这些操作会消耗大量带宽，但 IOPS 相对较少。结合 IOPS 和带宽限制可以提供更精细的控制。</block>
  <block id="d7800d36c7fddb11c98fb31a8c1d5d50" category="paragraph">最低服务质量策略将性能保留给关键工作负载。例如，在生产数据库和开发数据库混合的环境中，对开发工作负载应用最大 QoS，对生产工作负载应用最小 QoS，以确保性能可预测。</block>
  <block id="4602ec11783dd2c5a8ddc1a6a89c04f9" category="paragraph">自适应 QoS 会根据存储对象的大小调整限制。虽然很少用于数据库（因为大小与性能需求不相关），但对于性能要求随容量扩展的虚拟化工作负载来说，它可能很有用。</block>
  <block id="6edda6968105d6954b5256694e3649bb" category="summary">RAID 和 Oracle 数据库与ASA r2</block>
  <block id="fce02cd425679718f604302e0d536227" category="searchtitle">RAID 和 Oracle 数据库与ASA r2</block>
  <block id="a939d6e21a6c89c72af6e1899ba41b70" category="paragraph">RAID 指的是利用基于奇偶校验的冗余技术来保护数据免受硬盘故障的影响。ASA r2 使用与AFF和FAS系统相同的ONTAP RAID 技术，可有效防止多块磁盘故障。</block>
  <block id="a4769c5e44f0e97f11cb16b39f1a1a0a" category="paragraph">ONTAP会自动为ASA r2 系统执行 RAID 配置。这是ASA r2 特性引入的简化存储管理体验的核心组成部分。</block>
  <block id="747e44d761ad33b2eb88ebaad70815e6" category="paragraph">ASA r2 自动 RAID 配置的关键细节包括：</block>
  <block id="86b1e9f406f275d55d8bdbd97ba561d9" category="list-text">存储可用区 (SAZ)： ASA r2 使用存储可用区 (SAZ) 来代替手动管理传统的聚合和 RAID 组。这些是 HA 对共享的、受 RAID 保护的磁盘池，其中两个节点可以完全访问相同的存储。</block>
  <block id="ff90b3e28ca02df77a6681a0efbd5741" category="list-text">自动放置：创建存储单元（LUN 或 NVMe 命名空间）时， ONTAP会自动在 SAZ 内创建一个卷，并将其放置在最佳性能和容量平衡的位置。</block>
  <block id="27712ac508d43c6818eadfc8acc10e0e" category="list-text">不支持手动聚合管理： ASA r2 不支持传统的聚合和 RAID 组管理命令。这样就无需管理员手动规划 RAID 组大小、奇偶校验盘或节点分配了。</block>
  <block id="070b455242b96e245be06bac031a00b6" category="list-text">简化配置：配置通过系统管理器或简化的 CLI 命令进行处理，这些命令侧重于存储单元，而不是底层的物理 RAID 布局。</block>
  <block id="27c8bb95e41f4dcc96c3db322fd90359" category="list-text">工作负载重新平衡：从 2025 年版本（ONTAP 9.17.1）开始， ONTAP会自动在 HA 对中的节点之间重新平衡工作负载，以确保性能和空间利用率保持平衡，而无需人工干预。</block>
  <block id="156a4db35771b9cfbf2f3357b9e08916" category="paragraph">ASA r2 会自动使用 ONTAP 的默认 RAID 技术：大多数配置使用RAID DP ，非常大的 SSD 池使用RAID-TEC 。这样就省去了手动选择 RAID 的麻烦。这些基于奇偶校验的 RAID 级别比镜像提供更好的存储效率和可靠性，虽然旧的 Oracle 最佳实践通常推荐镜像，但镜像与ASA r2 无关。ONTAP通过WAFL集成避免了传统的 RAID 写入惩罚，从而确保 Oracle 工作负载（例如重做日志记录和随机数据文件写入）的最佳性能。结合自动化 RAID 管理和存储可用区， ASA r2 为 Oracle 数据库提供高可用性和企业级保护。</block>
  <block id="7ba55adf8707a9ea679db22769a025ca" category="summary">使用ASA r2 为 Oracle 数据库配置 SVM</block>
  <block id="d4aa9e950ef36e360271594778cbca0b" category="searchtitle">Oracle 数据库和存储虚拟机与ASA r2</block>
  <block id="2f715c6e6aa91757f50ff512d56b2a12" category="paragraph">ASA r2 系统上的 Oracle 数据库存储管理也集中在存储虚拟机 (SVM) 上，在ONTAP CLI 中称为 vserver。</block>
  <block id="fb6310455e0908df1c6dd824a7609791" category="paragraph">SVM 是ONTAP中存储配置和安全的基本单元，类似于 VMware ESX 服务器上的客户虚拟机。当ONTAP首次安装在ASA r2 上时，在创建 SVM 之前，它不具备数据服务能力。SVM 定义了 SAN 环境的个性和数据服务。</block>
  <block id="ef7aca175aba92d84bbc0ea32b9f26da" category="paragraph">ASA r2 系统采用仅限 SAN 的ONTAP特性，该特性经过简化，支持块协议（FC、iSCSI、NVMe/FC、NVMe/TCP），并移除了与 NAS 相关的功能。这简化了管理，并确保所有 SVM 配置都针对 SAN 工作负载进行了优化。与AFF/ FAS系统不同， ASA r2 不提供 NAS 服务选项，例如主目录或 NFS 共享。</block>
  <block id="146a5691df8cfb757d7eda2981b3b7f3" category="paragraph">创建集群时， ASA r2 会自动配置一个名为 svm1 的默认数据 SVM，并启用 SAN 协议。该SVM无需手动配置协议服务即可进行块存储操作。默认情况下，此 SVM 中的 IP 数据 LIF 支持 iSCSI 和 NVMe/TCP 协议，并使用默认数据块服务策略，从而简化了 SAN 工作负载的初始设置。管理员之后可以根据性能、安全性或多租户要求创建额外的 SVM 或自定义 LIF 配置。</block>
  <block id="5e8ecb21f02df615400fabb622919767" category="inline-link">仅支持 iSCSI 的 LIF</block>
  <block id="fcfc982506d2f40ecc714c466f201d61" category="admonition">SAN 协议的逻辑接口 (LIF) 应根据性能和可用性要求进行设计。ASA r2 支持 iSCSI、FC 和 NVMe LIF，但请注意，默认情况下未启用自动 iSCSI LIF 故障转移，因为ASA r2 对 NVMe 和 SCSI 主机使用共享网络。要启用自动故障转移，请创建<block ref="dd448f10ba2739ef2cba9a955f730acc" category="inline-link-rx"></block>。</block>
  <block id="01991e7e8fe0103fe2e08fb4a06fbb42" category="paragraph">与其他ONTAP平台一样，对于要创建的 SVM 数量没有官方的最佳实践；该决定取决于管理和安全要求。</block>
  <block id="c9b46b0decb2ff8d931995e958aac2fa" category="paragraph">大多数客户日常运营只使用一台主SVM，并根据特殊需求创建额外的SVM，例如：</block>
  <block id="7296e471f26dfae6081a67aab939b8eb" category="list-text">由专业团队管理的专用支持虚拟机，用于关键业务数据库。</block>
  <block id="e3c2829fad1bbce26c8d52d257268905" category="list-text">具有委托管理控制权的开发小组的支持向量机</block>
  <block id="1a8aadbbefcd940de4217d51d39c26b0" category="list-text">用于处理需要受限管理访问权限的敏感数据的 SVM</block>
  <block id="83993ee11718fbb27918bc9918e00456" category="paragraph">在多租户环境中，每个租户都可以分配一个专用的 SVM。每个集群、HA 对和节点的 SVM 和 LIF 数量的限制取决于所使用的协议、节点模型和ONTAP版本。请咨询 <block ref="41f66f34b3a905f864500c9319fdff8f" category="inline-link-macro-rx"></block> 在这些限制条件下。</block>
  <block id="9166ee55eb1a0be8fa4f050e48a01084" category="admonition">从ONTAP 9.18.1 开始， ASA r2 每个集群和每个 HA 对最多支持 256 个 SVM（早期版本中为 32 个）。</block>
  <block id="d60202b60a3d35c578e974e24bb90e86" category="summary">Oracle 和ONTAP与ASA r2 的精简配置</block>
  <block id="0382550e451d7d7be20bbfe79e2675ff" category="searchtitle">在ASA r2 上使用 Oracle 数据库进行精简配置</block>
  <block id="5db8916695aa627be657a119d435e622" category="paragraph">在ASA r2 上对 Oracle 数据库进行精简配置需要仔细规划，因为它涉及配置比物理可用空间更多的逻辑空间。如果实施得当，精简配置可以显著节省成本并提高可管理性。</block>
  <block id="67e76662b290c7bb7ddf8c8a381fc486" category="paragraph">精简配置是ASA r2 的组成部分，并且与ONTAP效率技术密切相关，因为两者都允许存储比系统物理容量更多的逻辑数据。ASA r2 系统仅限 SAN，精简配置适用于存储可用区 (SAZ) 内的存储单元和 LUN。</block>
  <block id="3d54b31e7b15e5ca1f9174de08508c48" category="admonition">ASA r2 存储单元默认采用精简配置。</block>
  <block id="e95dcb4757cac01a8bf2901588dcfc87" category="paragraph">几乎所有快照的使用都涉及精简配置。例如，一个典型的 10 TiB 数据库，包含 30 天的快照，可能会显示为 310 TiB 的逻辑数据，但实际上只占用 12 TiB 到 15 TiB 的物理空间，因为快照只存储已更改的数据块。</block>
  <block id="70f4fe0bb63801388d4cd14e6d6bbf05" category="paragraph">同样，克隆也是精简配置的另一种形式。一个开发环境，如果完全写入一个 80 TiB 数据库的 40 个克隆，则需要 3.2 PiB 的空间，但实际上消耗的空间要少得多，因为只存储更改。</block>
  <block id="05472458ee0330f07697b2632e7a917a" category="paragraph">在应用环境中采用精简配置时必须格外小心，因为数据变更率可能会意外增加。例如，如果对数据库表进行重新索引，或者对 VMware 客户机进行大规模修补，则快照导致的空间消耗可能会迅速增长。备份文件丢失可能会在很短的时间内写入大量数据。最后，如果 LUN 意外耗尽可用空间，则某些应用程序可能难以恢复。</block>
  <block id="5db9d3525c3598e18d4bb1ea2db8cc18" category="paragraph">在ASA r2 中，这些风险是通过精简配置、主动监控和 LUN 调整大小策略来缓解的，而不是通过ONTAP 的卷自动增长或快照自动删除等功能来缓解的。管理员应该：</block>
  <block id="9609344ef7cd19a1a5460b6f51e139c4" category="list-text">启用 LUN 上的精简配置 <block ref="fa1fdc365b74d5b14cab89cd4c2cc7cc" prefix="(" category="inline-code"></block>这是ASA r2 中的默认设置。</block>
  <block id="ac53c0ea3204288de3a2c2522bb85398" category="list-text">使用系统管理器警报或基于 API 的自动化方式监控容量</block>
  <block id="d07ab9395151c8b26ab66a9772523f52" category="list-text">使用计划或脚本化的 LUN 调整大小来适应增长</block>
  <block id="cd8bb089e11224111755a57f499c8ea5" category="list-text">通过系统管理器（图形用户界面）配置快照保留和自动快照删除</block>
  <block id="224e45482a3dbc2d7cadd78a8463e91a" category="admonition">由于ASA r2 不支持自动卷增长或 CLI 驱动的快照删除，因此仔细规划空间阈值和自动化脚本至关重要。</block>
  <block id="d53a5e27c9f806298b719e63b60e4d4d" category="paragraph">ASA r2 不使用部分储备设置，因为它是一个仅支持 SAN 的架构，抽象了基于WAFL 的卷选项。相反，空间效率和覆盖保护是在 LUN 级别进行管理的。例如，如果您从存储单元配置了一个 250 GiB 的 LUN，快照会根据实际块更改消耗空间，而不是预先预留等量的空间。这样就无需进行大量的静态预留，而这种预留在传统的ONTAP环境中使用部分预留时很常见。</block>
  <block id="141cd2097fb78575737b1bfd31b06f02" category="admonition">如果需要保证覆盖保护且监控不可行，管理员应在存储单元中提供足够的容量并适当设置快照保留。然而， ASA r2 的设计使得大多数工作负载不需要部分备用容量。</block>
  <block id="351f6ae6656f0bf997a0922ec06a6218" category="paragraph">ASA r2 中的压缩和去重是空间效率技术，而不是传统的精简配置机制。这些特性通过消除冗余数据和压缩数据块来减少物理存储占用空间，从而允许存储比原始容量所允许的更多的逻辑数据。</block>
  <block id="5ef42f934d63cddc5a96f971a94b7429" category="paragraph">例如，一个 50 TiB 的数据集可以压缩到 30 TiB，从而节省 20 TiB 的物理空间。从应用程序的角度来看，虽然磁盘上只占用 30 TiB，但仍然有 50 TiB 的数据。</block>
  <block id="5ebf328c9cae7faff1019b087db64713" category="admonition">数据集的可压缩性会随时间变化，这可能会增加物理空间的消耗。因此，必须通过监控和容量规划来主动管理压缩和去重。</block>
  <block id="8fecfb85db5fdf8ae66c3e9a061aa518" category="paragraph">在ASA r2 环境中，如果删除的数据块没有被回收，精简配置的效率会随着时间的推移而降低。除非使用 TRIM/UNMAP 释放空间或用零覆盖（通过 ASMRU - 自动空间管理和回收实用程序），否则已删除的数据将继续占用物理容量。在许多 Oracle 数据库环境中，精简配置的优势有限，因为数据文件通常在创建时就被预先分配到其全部大小。</block>
  <block id="374b240506a11f9564274703d9a9aaa6" category="paragraph">精心规划 LVM 配置可以提高效率，并最大限度地减少存储配置和 LUN 调整大小的需求。当使用 Veritas VxVM 或 Oracle ASM 等 LVM 时，底层 LUN 被划分为仅在需要时才使用的扩展区。例如，如果一个数据集最初大小为 2 TiB，但随着时间的推移可能会增长到 10 TiB，则可以将此数据集放置在 10 TiB 的精简配置 LUN 上，这些 LUN 组织成一个 LVM 磁盘组。创建时仅占用 2 TiB 的空间，并且只有在分配扩展区以适应数据增长时才会占用额外的空间。只要对空间进行监控，这个过程就是安全的。</block>
  <block id="aba3acce9bf977db783a1f3a099fd0a2" category="summary">配置 NVFAIL 以保护ASA r2 上的 Oracle 数据库</block>
  <block id="5510f46c151cfb15d45e4ba8a9a86738" category="searchtitle">Oracle 数据库和ASA r2 上的 NVFAIL</block>
  <block id="5726149f7f17e93d987e963b1a9815aa" category="paragraph">NVFAIL 是ONTAP 的一项功能，可在灾难性故障转移情况下确保数据完整性。</block>
  <block id="5b44cc6bdb59c7fcd5800e8ca4e8de88" category="paragraph">即使ASA r2 系统采用简化的 SAN 架构（SAZ 和存储单元而不是卷），此功能仍然适用于ASA r2 系统。</block>
  <block id="b7a2b4c7beb39acbf30964be233d43b6" category="paragraph">由于数据库维护着大量的内部缓存，因此在存储故障转移事件期间容易发生数据损坏。如果发生灾难性事件需要强制ONTAP故障转移，无论整体配置的健康状况如何，结果都是先前已确认的更改可能会被有效地丢弃。存储阵列的内容向前跳跃，数据库缓存的状态不再反映磁盘上的数据状态。这种不一致会导致数据损坏。</block>
  <block id="d529f1699059fd775d38daec404c9709" category="paragraph">缓存可以在应用层或服务器层进行。例如，Oracle Real Application Cluster (RAC) 配置中，服务器在主站点和远程站点上都处于活动状态，并将数据缓存在 Oracle SGA 中。强制故障转移操作导致数据丢失，会使数据库面临损坏的风险，因为存储在 SGA 中的数据块可能与磁盘上的数据块不匹配。</block>
  <block id="ad67299b81080b42995c6a5aa870ca24" category="paragraph">缓存还有一个不太明显的用途，那就是在操作系统文件系统层。基于位于主站点的 LUN 的集群文件系统可以挂载到远程站点的服务器上，并且可以再次缓存数据。在这些情况下， NVRAM故障或强制接管可能会导致文件系统损坏。</block>
  <block id="3ddb6c813a50856a003faa943d94ca24" category="paragraph">ONTAP使用 NVFAIL 及其相关设置来保护数据库和操作系统免受此情况的影响，这些设置会向主机发出信号，使缓存数据失效，并在故障转移后重新挂载受影响的文件系统。该机制适用于ASA r2 LUN 和命名空间，就像适用于AFF/ FAS一样。</block>
  <block id="cb43a7910131c4a9b54ee4527f41584a" category="paragraph">ASA r2 的关键考虑因素：</block>
  <block id="760178473b2704cd5e111e8ac1c4ae81" category="list-text">NVFAIL 在 LUN 级别（存储单元）运行，而不是在 SAZ 级别运行。</block>
  <block id="c87084320a0d119d921d77b65b487a40" category="list-text">对于 Oracle 数据库，应在所有托管关键组件（数据文件、重做日志、控制文件）的 LUN 上启用 NVFAIL。</block>
  <block id="2619eb12ebcaa2f4223907a04c8b3e6a" category="list-text">ASA r2 不支持MetroCluster ，因此 NVFAIL 主要适用于本地 HA 故障转移场景。</block>
  <block id="ed28739e6688c1c56caa21d8f4e83fa0" category="list-text">ASA r2 不支持 NFS，因此 NVFAIL 注意事项仅适用于基于 SAN 的工作负载（FC/iSCSI/NVMe）。</block>
  <block id="e519d6eb34dfc47edf5072f1a0a920e0" category="summary">在ASA r2 上使用 AIX 的 Oracle 数据库</block>
  <block id="fcb9fe371de92b4141a475f18125a2e7" category="searchtitle">在ASA r2 上使用 IBM AIX 的 Oracle 数据库</block>
  <block id="14590776a7ec5f76f6c0dbaf12aea82d" category="paragraph">IBM AIX 上 Oracle 数据库与ASA r2 ONTAP的配置主题。</block>
  <block id="e21c6d7d6ce64b744e1b3dfc9f3dbb12" category="paragraph">AIX 支持使用NetApp ASA r2 托管 Oracle 数据库，前提是：</block>
  <block id="61cc31cc32fc76833bf9b697fedcd7b5" category="list-text">您已正确配置 Oracle 以支持并发 I/O。</block>
  <block id="9dfe407ff2ee9c174cce1d9f12a01c51" category="list-text">您使用受支持的 SAN 协议（FC/iSCSI/NVMe）。</block>
  <block id="5dbad350303c2f9f6c54a25478f708e6" category="list-text">您在ASA r2 上运行ONTAP 9.16.x 或更高版本。</block>
  <block id="ef37a2ddad88a2a152b9948feb73bc4b" category="paragraph">在 IBM AIX 上使用ASA r2 实现最佳性能需要使用并发 I/O。如果没有并发 I/O，性能可能会受到限制，因为 AIX 执行的是串行原子 I/O，这会产生很大的开销。</block>
  <block id="6edb8857a5df843ec36fc2b3a863d730" category="paragraph">最初， NetApp建议使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 挂载选项可以强制文件系统进行并发 I/O，但此过程存在缺点，现在已不再需要。自 AIX 5.2 和 Oracle 10gR1 推出以来，AIX 上的 Oracle 可以打开单个文件进行并发 I/O，而不是强制对整个文件系统进行并发 I/O。</block>
  <block id="eda28eaca3dbfe13d6de344928f25e81" category="paragraph">使用 cio 作为挂载选项会强制使用并发 I/O，这可能会产生负面影响。例如，强制并发 I/O 会禁用文件系统上的预读功能，这可能会损害 Oracle 数据库软件外部发生的 I/O 的性能，例如复制文件和执行磁带备份。此外，Oracle GoldenGate 和 SAP BR*Tools 等产品与某些版本的 Oracle 使用 cio mount 选项不兼容。</block>
  <block id="c3fcaa918acdb778a4e2f846c030c0a9" category="list-text">仅使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 如果无法设置挂载选项，则进行设置<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block>。</block>
  <block id="4ad5c7879e9856926d647b1c4108aa1a" category="admonition">由于ASA r2 不支持 NAS，因此 AIX 上的所有 Oracle 部署都必须使用块协议。</block>
  <block id="8ae7510e454410710230296d25e27ce1" category="cell">控制文件、</block>
  <block id="d41de13d4f13727ba8bcfa0e4b6f43d3" category="cell">数据文件</block>
  <block id="823272d72b3248694e3df021ef8cf5d4" category="cell">重做日志</block>
  <block id="36287b7fc9193c5febdd31bfd37adb9e" category="paragraph">在使用 AIX 之前<block ref="b7cc91287fc99a8937a55e79376c6f54" prefix=" " category="inline-code"></block> 在任何环境（包括数据库）中的设备，检查参数<block ref="9d51746070ef554ad4e93a16de4aed0f" prefix=" " category="inline-code"></block>。此参数并非HBA队列深度；而是与单个SCSI卡的队列深度相关。<block ref="b1835b2bc8fe4eebb5093da8087b01e9" prefix=" " category="inline-code"></block>。根据ASA r2 LUN 的配置方式，该值会有所不同。<block ref="9d51746070ef554ad4e93a16de4aed0f" prefix=" " category="inline-code"></block> 可能太低，无法获得良好的性能。测试表明最佳值为 64。</block>
  <block id="d79502074cc6e7e5a364f270a466f90a" category="summary">在ASA r2 上使用 Linux 和 ASMlib/ASM 过滤器驱动程序的 Oracle 数据库</block>
  <block id="1b8322dc9ddcf0f0884dea2005af98a4" category="searchtitle">在ASA r2 上使用 ASMLib/AFD（ASM 过滤器驱动程序）的 Oracle 数据库</block>
  <block id="3488d46993d5a8378c20ef8680693299" category="paragraph">使用 AFD 和 ASMlib 的ASA r2 ONTAP的 Linux 操作系统特有的配置主题。</block>
  <block id="d096e0a6df0924614163a540b2214971" category="paragraph">ASMlib 是一个可选的 ASM 管理库和相关实用程序。它的主要价值在于能够将 LUN 标记为 ASM 资源，并带有人类可读的标签。</block>
  <block id="d19e24337b54fcc70e96e05114ad22a2" category="summary">在ASA r2 上使用 HP-UX 的 Oracle 数据库</block>
  <block id="20c8ba6aea292789ef2e6f1b4b89ae77" category="paragraph">HP-UX 上 Oracle 数据库与ASA r2 ONTAP的配置主题。</block>
  <block id="e9b7342441652011904ff65fb1193d74" category="paragraph">HP-UX 支持与NetApp ASA r2 配合使用，用于托管 Oracle 数据库，前提是：</block>
  <block id="4f24e0afbf75599b5597e3a2be666094" category="list-text">ONTAP版本为 9.16.x 或更高版本。</block>
  <block id="3b97f328d0018662389a71edcacbc5a0" category="list-text">使用 SAN 协议（FC/iSCSI/NVMe）。ASA r2 不支持 NAS。</block>
  <block id="36995f50a8bb9428c17eabad17a9e21e" category="list-text">应用HP-UX特有的挂载和I/O调优最佳实践。</block>
  <block id="b6c1b0f6914791454ede96b6820e724b" category="summary">在ASA r2 上使用 Linux 的 Oracle 数据库</block>
  <block id="735da48e08399aff4389f7645ad63008" category="paragraph">针对 Linux 操作系统和ASA r2 ONTAP 的配置主题。</block>
  <block id="cc72f8ba70e23d17e4898b2d817c7775" category="paragraph">ASA r2 支持 Oracle 数据库，并兼容 Linux（Oracle Linux、RHEL、SUSE）。使用 SAN 协议，正确配置多路径，并应用 Oracle 最佳实践进行 ASM 和 I/O 调优。</block>
  <block id="1f0e7d8c686c998d847b6b6b0524d0db" category="paragraph">例如，RHEL 9.7 上的多路径守护进程的默认配置可能如下所示：</block>
  <block id="17d641ba9ac890f75d4c292b06bb7b94" category="section-title">队列深度</block>
  <block id="409778175ac5dff7ebc33d3a237112c3" category="paragraph">为 SAN 设备设置合适的队列深度，以避免 I/O 瓶颈。Linux 上的默认队列深度通常设置为 128，这可能会导致 Oracle 数据库出现性能问题。队列深度设置过高会导致 I/O 排队过多，从而导致延迟增加和吞吐量降低。设置得太低会限制未完成的 I/O 请求数量，从而降低整体性能。对于ASA r2 上的 Oracle 数据库工作负载，队列深度 64 通常是一个不错的起点，但可能需要根据具体的工作负载特性和性能测试进行调整。</block>
  <block id="af911470a92a15ef9be3fd8bf911b56d" category="paragraph">对于支持主动-主动多路径的ASA r2 系统，应调整这些多路径设置。由于所有路径都处于活动状态并进行了负载均衡，因此不需要无限期排队。相反，多路径参数应优先考虑性能和快速故障恢复。这种行为对于 ASM 镜像很重要，因为 ASM 必须收到 I/O 失败才能在备用 LUN 上重试 I/O。如果 I/O 无限期地排队，ASM 无法触发故障转移。</block>
  <block id="a202cf3983184d1ce3e7056d7305d01f" category="admonition">NetApp建议使用默认挂载选项。在 LUN 上创建文件系统时，请确保正确对齐。</block>
  <block id="0fc668638a672a7d830afec06b27d782" category="summary">在ASA r2 上使用 Solaris 的 Oracle 数据库</block>
  <block id="40dff793103aa25077d6225eb96d92b6" category="paragraph">适用于 Solaris 操作系统和ASA r2 ONTAP 的配置主题。</block>
  <block id="5979a32a9c62ecee74c171ed5cc2d6e7" category="summary">在ASA r2 上使用 Microsoft Windows 的 Oracle 数据库</block>
  <block id="59c2890ecd2c8d54b1be7b5075c7d55a" category="paragraph">在 Microsoft Windows 上使用ASA r2 ONTAP 的Oracle 数据库配置主题。</block>
  <block id="41dc5a1bfa78463990313337562fc0a9" category="summary">Oracle 数据库和ONTAP直连与ASA r2 的连接</block>
  <block id="e7e1bbfbb8e743a965e762dfa3e234f9" category="paragraph">使用 iSCSI 或 NVMe/TCP 的主机可以直接连接到ASA r2 存储系统并正常运行。原因在于路径规划。直接连接到两个不同的存储控制器，会产生两条独立的数据流路径。只要多路径配置正确，路径、端口或控制器的丢失并不会阻止使用其他路径。</block>
  <block id="35a14cf200b3e6049eeb29738ad4711e" category="paragraph">使用 FC 协议无法将主机直接连接到ASA r2 存储系统。原因与AFF/ FAS系统相同，即使用 NPIV。用于识别 FC 网络中ONTAP FC 端口的 WWN 使用一种称为 NPIV 的虚拟化类型。任何连接到ONTAP系统的设备都必须能够识别 NPIV WWN。目前还没有任何 HBA 供应商提供可以安装在能够支持 N​​PIV 目标的宿主机上的 HBA。</block>
  <block id="4d2361ac0de1401ab0ff03a54ff4a137" category="summary">ASA r2 系统上的 Oracle、TCP/IP 和以太网配置</block>
  <block id="3c80c484426036630d6eb8389c2ac11d" category="searchtitle">使用ASA r2 配置 Oracle 数据库的 TCP/IP 和以太网</block>
  <block id="5db9438e726eacde259e400997b7ad50" category="paragraph">许多 Oracle on ASA r2 ONTAP客户使用以太网、iSCSI 网络协议和 NVMe/TCP。</block>
  <block id="b9859abe854650d97cc9443efe8bacae" category="paragraph">对于仅限 SAN 的ASA r2 系统，以太网流控制考虑因素主要适用于 iSCSI 和 NVMe/TCP 流量。</block>
  <block id="391bb22eb81aa6a08c067e17fdc19f3a" category="admonition">NetApp建议确保NetApp ASA r2 存储控制器不接收以太网流控制数据包。这通常可以通过设置控制器所连接的交换机端口来实现，但某些交换机硬件存在限制，可能需要进行客户端更改。</block>
  <block id="208fb28dae4318ca1f947bab31f1c824" category="paragraph">对于仅限 SAN 的ASA r2 系统，巨型帧仅适用于基于以太网的 SAN 协议（iSCSI 和 NVMe/TCP）。</block>
  <block id="d65d3c32ef266ba55e2378bbd9a6b317" category="paragraph">NetApp建议在ASA r2 SAN 环境中配置以下内容：</block>
  <block id="84519fb5c01a2679ca254670c9be6802" category="list-text">对于 1GbE 来说，巨型帧是可取的，但并非必需。</block>
  <block id="db7fb2373c0f2187e6de7e956e29cfed" category="list-text">对于 10GbE 而言，巨型帧是实现最佳性能的必要条件；对于 iSCSI 和 NVMe/TCP 流量而言，巨型帧的速度更快。</block>
  <block id="1ce271de40e24ab8a63800ce42e0a92a" category="summary">使用ASA r2 配置 Oracle 数据库的 FC 网络</block>
  <block id="8a0dcf3ef73899d99ab6e7a82434404d" category="searchtitle">使用ASA r2 配置 Oracle 数据库的 FC SAN</block>
  <block id="d2bdcae397f14f23d178639b4a3449f1" category="paragraph">在ASA r2 系统上为 Oracle 数据库配置 FC SAN 主要在于遵循标准的 SAN 最佳实践。</block>
  <block id="e731c4d7f31dd741c0d10f0333c324be" category="paragraph">ASA r2 针对仅限 SAN 的工作负载进行了优化，因此其原理与AFF/ FAS相同，重点在于性能、弹性和简单性。这包括典型的规划措施，例如确保主机和存储系统之间的 SAN 有足够的带宽，检查所有必需设备之间是否存在所有 SAN 路径，使用 FC 交换机供应商要求的 FC 端口设置，避免 ISL 争用，以及使用适当的 SAN 结构监控。</block>
  <block id="517d60dbcaa0d6b23a9f47fbd0edaa39" category="list-text">ASA r2 使用存储可用区而不是聚合，但这并不会改变 FC 分区原则。</block>
  <block id="c39ca1d0b43d0baae5362c1cde3ee38c" category="list-text">多路径 (MPIO) 仍然是主要的弹性机制；然而，对于支持对称主动-主动多路径的ASA r2 系统，到 LUN 的所有路径都是活动的，并同时用于 I/O。</block>
  <block id="2209a1d9b2ca24fe83599efabcbffce1" category="summary">使用ASA r2 的 Oracle 数据库逻辑接口设计</block>
  <block id="3af46ba2ee5090e4c4e7846e7b132945" category="paragraph">本节概述了ASA r2 系统的关键 LIF 设计原则，该系统针对仅限 SAN 环境进行了优化。如需更全面的文档，请参阅 <block ref="a3e6361e1a52d384f542a2f2d8bc9bb1" category="inline-link-macro-rx"></block>。与数据库架构的其他方面一样，存储虚拟机 (SVM，在 CLI 中称为 vserver) 和逻辑接口 (LIF) 设计的最佳选择很大程度上取决于扩展要求和业务需求。</block>
  <block id="21799093fc4cfb791dfe32dc663f4f8b" category="list-text">*表现。*网络带宽是否足以满足Oracle工作负载的需求？</block>
  <block id="111dbd10ee2308ce64978a8e5e7d7304" category="list-text">*数据 LIF。*仅支持 SAN 协议的接口：FC、iSCSI、NVMe/FC、NVMe/TCP。ASA r2 系统不支持 NAS 协议（NFS、SMB/CIFS）。</block>
  <block id="eb7b64f9138ff27678062103f7c70882" category="admonition">尽管 iSCSI（或 NVMe/TCP）和管理流量都使用 IP 协议，但无法为两者配置同一个接口。在 iSCSI 或 NVMe/TCP 环境中，需要单独的管理 LIF。为了提高弹性和性能，每个节点每个协议配置多个 SAN 数据 LIF，并将它们分布在不同的物理端口和结构上。与AFF/ FAS系统不同， ASA r2 不允许 NFS 或 SMB 流量，因此无法将 NAS 数据 LIF 重新用于管理。</block>
  <block id="fbd9cbd3f29c4cfd273ea6e2c6e2ea2e" category="paragraph">在 SAN 环境中，影响 LIF 性能的最重要因素是带宽。例如，一个双节点ASA r2 集群，每个节点有两个 32Gb FC 端口，每个节点最多可提供 64Gb 的带宽。同样，对于 NVMe/TCP 或 iSCSI，要确保 Oracle 工作负载有足够的 25GbE 或 100GbE 连接。</block>
  <block id="df8a61f03f4995a39442d2a271415832" category="paragraph">SAN LIF 的故障转移方式与ASA LIF 不同。ASA r2 系统依靠主机多路径（MPIO/ALUA）来实现弹性恢复。如果由于控制器故障转移导致 SAN LIF 不可用，客户端的多路径软件会检测到路径丢失，并将 I/O 重定向到备用路径。ASA r2 可能会在短暂延迟后执行 LIF 重定位以恢复完整路径的可用性，但这不会中断 I/O，因为伙伴节点上已经存在活动路径。故障转移过程是为了恢复所有已定义端口上的主机访问权限。</block>
  <block id="a16d6c41318f3de1eb13c1844f304422" category="paragraph">在 SAN 环境中，当 HA 对内的卷被重新定位时，无需迁移 LIF。这是因为，卷迁移完成后， ONTAP会向 SAN 发送路径变更通知，SAN 客户端会自动重新优化。使用 SAN 进行 LIF 迁移主要与重大的物理硬件变更相关。例如，如果需要对控制器进行无中断升级，则 SAN LIF 会迁移到新硬件。如果发现 FC 端口出现故障，可以将 LIF 迁移到未使用的端口。</block>
  <block id="9828810f7fcace78de1d1de0e576c84e" category="paragraph">NetApp针对ASA r2 SAN环境提出以下建议：</block>
  <block id="f83001332c7becf3e61981f64091d862" category="list-text">使用选择性 LUN 映射 (SLM) 功能，该功能默认启用。使用 SLM，任何新的 LUN 都会从拥有底层聚合的节点和该节点的 HA 伙伴自动发布。这种安排避免了创建端口集或配置区域来限制端口访问权限的需要。每个 LUN 都部署在满足最佳性能和弹性所需的最少节点上。</block>
  <block id="9bd683ce8a75eb3cef3454ed97d056e9" category="list-text">如果需要将 LUN 迁移到两个控制器之外，则可以使用以下方式添加额外的节点：<block ref="02d0bbdc14988c85bbd7994723f4dd7f" prefix=" " category="inline-code"></block> 命令将 LUN 通告到新节点上。这样做会为 LUN 迁移创建额外的 SAN 路径。但是，主机必须执行发现操作才能使用新路径。</block>
  <block id="90f4c30336e9921dc9f790199b80a26c" category="summary">在ASA r2 上使用ONTAP零块检测的 ASM 回收实用程序</block>
  <block id="68b277e79eb0e18f7699090c7f597833" category="searchtitle">ASM 回收实用程序 (ASRU) 与ASA r2 上的ONTAP</block>
  <block id="bfbea40daf6eff16b91d4b7d3bd13b21" category="doc">ASM 回收实用程序 (ASRU)</block>
  <block id="8c18218e2429b3c0e71cfb77a5486907" category="paragraph">当启用在线压缩时， ONTAP on ASA r2 可以有效地删除写入 LUN（存储单元）的零块。Oracle ASM 回收实用程序 (ASRU) 等实用程序的工作原理是将零写入未使用的 ASM 区段。</block>
  <block id="9dc9cfea7e02e83a3b766a99a9b3b25c" category="paragraph">这样，数据库管理员就可以在数据删除后回收存储阵列上的空间。ONTAP拦截零值并从 LUN 中释放空间。由于存储系统中没有实际写入任何数据，因此回收过程非常快。</block>
  <block id="96564d0673d8b56c565c6c6ef3de2ca7" category="paragraph">使用ASA r2 ONTAP需要考虑的关键 ASRU 因素：</block>
  <block id="c6455a89096acca814d31fecbec23bf9" category="list-text">由于ASA r2 仅支持块存储，因此其工作方式与AFF/ FAS相同，适用于 SAN 工作负载。</block>
  <block id="ce11aa3271c53b3bab6765e2d48951ac" category="list-text">适用于在 SAZ 内配置的 LUN 和 NVMe 命名空间。</block>
  <block id="5c9e99714e3d57e5572281b0e41e2cc6" category="list-text">FlexVol卷不存在，但零块回收行为是相同的。</block>
  <block id="203be0c11c79d2c1a42df2c5bab9a460" category="summary">在ASA r2 上与 Oracle 数据库进行 LUN 对齐</block>
  <block id="7b349eb0f9d2f474d9ab9cc5118eb5d6" category="searchtitle">使用ASA r2 进行 Oracle 数据库 I/O 的 LUN 对齐</block>
  <block id="93f6837f6081de07a7906f5c0941bc8d" category="paragraph">ASA r2 系统使用与AFF/ FAS相同的ONTAP架构，但配置模型更简化。ASA r2 系统使用存储可用区 (SAZ) 而不是聚合，但对齐原则保持不变，因为ONTAP跨平台一致地管理块布局。但是，请注意以下ASA特有的几点：</block>
  <block id="8a19d2cf9991d8821095e34703361c32" category="list-text">ASA r2 系统为所有 LUN 提供主动-主动对称路​​径，从而消除了对齐期间的路径不对称问题。</block>
  <block id="95c89bde38b17ca0c2652e49f027682e" category="list-text">存储单元 (LUN) 默认采用精简配置；对齐方式不会改变此行为。</block>
  <block id="4c58090f7a610a39283889bddaa74a38" category="list-text">在创建 LUN 期间可以配置快照保留和自动快照删除（ONTAP 9.18.1 及更高版本）。</block>
  <block id="1734f57e94713f0a032bc6c907c9bdcb" category="paragraph">使用诸如此类的工具来验证对齐情况。<block ref="40883add63f1fbabc7fe6158f93c1246" prefix=" " category="inline-code"></block> 或者<block ref="1aabac6d068eef6a7bad3fdf50a05cc8" prefix=" " category="inline-code"></block> 能够以规定的块大小生成 I/O。可以使用以下命令查看存储系统的 I/O 对齐统计信息：<block ref="446501053769c06c565094b26d26e8ef" prefix=" " category="inline-code"></block> 命令。看 <block ref="ebccec7997af507c87f985ec4ccec634" category="inline-link-macro-rx"></block> 了解更多信息。</block>
  <block id="05a449cce434ca63ba5e47373b9d1f49" category="paragraph">其他最佳实践：</block>
  <block id="fcfa58ba93830f78edfcf9fa0d9fc8f0" category="list-text">使用NetApp互操作性矩阵工具 (IMT) 验证 HBA 固件和操作系统设置。</block>
  <block id="a169b081fb2875694e9e5e4fc00c909c" category="list-text">使用 sanlun 工具确认路径健康状况和对齐情况。</block>
  <block id="cc8928f2af9f0fae6ef3d8017126cfc4" category="list-text">对于 Oracle ASM 和 LVM，请确保配置文件（/etc/lvm/lvm.conf、/etc/sysconfig/oracleasm）设置正确，以避免出现对齐问题。</block>
  <block id="f12a09107ad4162f57baf9c752a518f2" category="summary">使用ASA r2 进行 Oracle 和ONTAP LUN 部署</block>
  <block id="aaa76fde2acba4d974e5e81148765b08" category="searchtitle">使用ASA r2 进行 Oracle 数据库 LUN 部署</block>
  <block id="92ed1004aa7bc12d2dc43469c67ca8cd" category="paragraph">ASA r2 系统中数据库 LUN 的最佳放置位置主要取决于ONTAP 的各种功能将如何使用。</block>
  <block id="e3908755a901bd8b390fca0586e5d01b" category="paragraph">在ASA r2 系统中，存储单元（LUN 或 NVMe 命名空间）由称为存储可用性区域 (SAZ) 的简化存储层创建，SAZ 充当 HA 对的公共存储池。</block>
  <block id="4882324a7fb3b029e3afbfa4ea1996f7" category="admonition">通常每个 HA 对只有一个存储可用区 (SAZ)。</block>
  <block id="90015b4a4947685eab609edee413af64" category="section-title">存储可用区 (SAZ)</block>
  <block id="95eeff3469b684d29e14c8c7ed95c6e1" category="paragraph">在ASA r2 系统中，卷仍然存在，但它们会在创建存储单元时自动创建。存储单元（LUN 或 NVMe 命名空间）直接在存储可用区 (SAZ) 中自动创建的卷内进行配置。这种设计消除了手动卷管理的需要，使 Oracle 数据库等块工作负载的配置更加直接和精简。</block>
  <block id="20ccc13be8bc94c50c99ae571eabbf3d" category="section-title">安全区域区和存储单元</block>
  <block id="c8e0228d7d981590c271f1ebd7928f14" category="paragraph">相关存储单元（LUN 或 NVMe 命名空间）通常位于同一个存储可用区 (SAZ) 内。例如，一个需要 10 个存储单元 (LUN) 的数据库，通常会将所有 10 个单元放置在同一个 SAZ 中，以简化操作并提高性能。</block>
  <block id="0c6b3219675d75f631c2a5c116fc5051" category="list-text">使用 1:1 的存储单元与卷的比例，即每个卷对应一个存储单元 (LUN)，是ASA r2 的默认行为。</block>
  <block id="4e198a8d880a904a00df60812b1e1b01" category="list-text">如果ASA r2 系统中存在多个 HA 对，则给定数据库的存储单元 (LUN) 可以分布在多个 SAZ 中，以优化控制器利用率和性能。</block>
  <block id="4cdd51ddfeccf85bb8dd182e9f83f00d" category="admonition">在 FC SAN 的上下文中，存储单元指的是 LUN。</block>
  <block id="cd57cb5c212b19d23633017bc53cc4e7" category="section-title">一致性组 (CG)、LUN 和快照</block>
  <block id="ef7a7d977f1a63e641a7fce414bb7e47" category="paragraph">在ASA r2 中，快照策略和计划是在一致性组级别应用的，一致性组是一个逻辑结构，它将多个 LUN 或 NVMe 命名空间分组，以实现协调的数据保护。由 10 个 LUN 组成的数据集只需要一个快照策略，前提是这些 LUN 属于同一个一致性组。</block>
  <block id="7d17b1c72d96ef2be6eb824b79d17c09" category="paragraph">一致性组确保所有包含的 LUN 上的原子快照操作。例如，如果将底层 LUN 分组到同一个一致性组中，则可以将驻留在 10 个 LUN 上的数据库或由 10 个不同操作系统组成的基于 VMware 的应用程序环境作为单个一致的对象进行保护。如果快照被放置在不同的一致性组中，即使在同一时间安排，快照也可能无法完全同步。</block>
  <block id="893cac1ea1cce31311a3726c0d553033" category="paragraph">在某些情况下，由于恢复要求，可能需要将一组相关的 LUN 分成两个不同的一致性组。例如，一个数据库可能有四个 LUN 用于数据文件，两个 LUN 用于日志。在这种情况下，包含 4 个 LUN 的数据文件一致性组和包含 2 个 LUN 的日志一致性组可能是最佳选择。原因在于独立可恢复性：数据文件一致性组可以有选择地恢复到较早的状态，这意味着所有四个 LUN 都将恢复到快照的状态，而包含关键数据的日志一致性组将不受影响。</block>
  <block id="c630ef12bf3956117cddb1064fc3d361" category="section-title">CG、LUN 和SnapMirror</block>
  <block id="6a824f9a12117a2a6895290867e086df" category="paragraph">SnapMirror策略和操作与快照操作一样，是在一致性组上执行的，而不是在 LUN 上执行的。</block>
  <block id="13fa8b6e8b3be69f7fe58ff3630ccb35" category="paragraph">将相关的 LUN 放在同一个一致性组中，可以创建单个SnapMirror关系，并通过一次更新更新所有包含的数据。与快照一样，此次更新也将是一个原子操作。SnapMirror目标位置将保证拥有源 LUN 的单一时间点副本。如果 LUN 分布在多个一致性组中，则副本之间可能一致，也可能不一致。</block>
  <block id="403e3c031b4cfa6e3fe3dae9c8c5fe13" category="paragraph">在ASA r2 系统上使用SnapMirror进行复制存在以下限制：</block>
  <block id="387dae8bc04454e56a9780e8507821e5" category="list-text">不支持SnapMirror同步复制。</block>
  <block id="74618c54a0d6a05f0dbccbfa9f4bc480" category="list-text">SnapMirror主动同步仅支持在两个ASA r2 系统之间进行。</block>
  <block id="b24c01ad6773e01500470565f30e6c7e" category="list-text">SnapMirror异步复制仅支持在两个ASA r2系统之间进行。</block>
  <block id="760e533cef4cb07e928f9667b4337a91" category="list-text">SnapMirror异步复制不支持在ASA r2 系统与ASA、 AFF或FAS系统或云之间进行。</block>
  <block id="91986d95992f1ad825d4163f8cc66a27" category="inline-link">ASA r2 系统支持SnapMirror复制策略</block>
  <block id="2280c599c5e817601b252f1594e3c4b2" category="paragraph">了解更多<block ref="2475b888e80612096ae52a0122ee018c" category="inline-link-rx"></block>。</block>
  <block id="8ca2b03f914c6e1c468a2cd13b3c8b3d" category="section-title">CG、LUN 和 QoS</block>
  <block id="7f2da44f6bd7c9356e63d179a440809d" category="paragraph">虽然 QoS 可以有选择地应用于单个 LUN，但通常在一致性组级别设置 QoS 更容易。例如，可以将给定 ESX 服务器中所有客户机使用的所有 LUN 放在一个一致性组中，然后应用ONTAP自适应 QoS 策略。最终结果是，每 TiB 的 IOPS 具有自扩展性，并且适用于所有 LUN。</block>
  <block id="9a463c1574f65dcc765615800d99e581" category="paragraph">同样地，如果一个数据库需要 100K IOPS 并占用 10 个 LUN，那么在单个一致性组上设置一个 100K IOPS 限制比在每个 LUN 上设置 10 个单独的 10K IOPS 限制要容易得多。</block>
  <block id="410329240fb2d429a85eaa5a8949cc3d" category="section-title">多种CG布局</block>
  <block id="5d754c13781487993a2059f802f22ba4" category="paragraph">在某些情况下，将 LUN 分布到多个一致性组中可能是有益的。主要原因是控制器条带化。例如，HA ASA r2 存储系统可能托管单个 Oracle 数据库，此时需要每个控制器的全部处理和缓存能力。在这种情况下，典型的设计是将一半的 LUN 放在控制器 1 上的一个一致性组中，将另一半 LUN 放在控制器 2 上的一个一致性组中。</block>
  <block id="7f8f628b8a7fd8f111de2978da131f9d" category="paragraph">同样地，对于托管多个数据库的环境，将 LUN 分布在多个一致性组中可以确保控制器利用率的均衡。例如，一个 HA 系统托管 100 个数据库，每个数据库有 10 个 LUN，则每个数据库可能将 5 个 LUN 分配给控制器 1 上的一个一致性组，将 5 个 LUN 分配给控制器 2 上的一个一致性组。这样可以保证在配置更多数据库时实现对称加载。</block>
  <block id="ae306759adf36251b055c76a41fa02d8" category="paragraph">不过，这些例子都不涉及 1:1 LUN 与一致性组的比例。目标仍然是通过将相关的 LUN 在逻辑上分组到一致性组中来优化可管理性。</block>
  <block id="09ff91a9a7ddab76a6eac2cd43acf9a1" category="paragraph">1:1 LUN 与一致性组比例的一个合理例子是容器化工作负载，其中每个 LUN 实际上可能代表一个单独的工作负载，需要单独的快照和复制策略，因此需要单独管理。在这种情况下，1:1 的比例可能是最佳选择。</block>
  <block id="ef2e36dfa6fb12cf1c8a7a0ae0c88d52" category="summary">在ASA r2 上使用 Oracle 数据库调整 LUN 和 LVM 大小</block>
  <block id="aea1f5a276c7b54d6172243c8b548bb2" category="searchtitle">使用ASA r2 调整 Oracle 数据库 LUN 和 LVM 的大小</block>
  <block id="70092e467b0294964d44a44d52d770f2" category="paragraph">当基于 SAN 的文件系统或 Oracle ASM 磁盘组在ASA r2 上达到容量限制时，有两种方法可以增加可用空间：</block>
  <block id="8abbd05e0a227c599291f20b646a134d" category="list-text">增加现有 LUN（存储单元）的容量</block>
  <block id="735f16a4a3b88e32076ada50e5286ae7" category="list-text">向现有 ASM 磁盘组或 LVM 卷组添加新的 LUN，并扩展其包含的逻辑卷。</block>
  <block id="40ad3147cef36b9d1a82d15d59687f65" category="paragraph">虽然ASA r2 支持 LUN 调整大小，但通常最好使用逻辑卷管理器 (LVM)，例如 Oracle ASM。LVM 存在的主要原因之一是避免频繁调整 LUN 大小。使用 LVM，可以将多个 LUN 组合成一个虚拟存储池。从该存储池中划分出的逻辑卷可以轻松调整大小，而不会影响底层存储配置。</block>
  <block id="be47566c8372059834f1fc8385d4ac38" category="paragraph">使用 LVM 或 ASM 的其他好处包括：</block>
  <block id="f04f7fcd9aefa6cc6cfcacbeef712d68" category="list-text">性能优化：将 I/O 分布到多个 LUN 上，减少热点。</block>
  <block id="1abd7acfc8d1a1b656234e216fc629f5" category="list-text">灵活性：添加新的 LUN 而不会中断现有工作负载。</block>
  <block id="dc417c507b436d9dcf6e3dbb977f40b7" category="list-text">透明迁移：ASM 或 LVM 可以将扩展区迁移到新的 LUN 以进行均衡或分层，而无需主机停机。</block>
  <block id="c73b873ea9167a593bee299b16d12b06" category="list-text">LUN 调整大小是在存储虚拟机 (SVM) 内的存储单元级别执行的，使用来自存储可用区 (SAZ) 的容量。</block>
  <block id="1b691366b4a3ac901464c48c9d4d8bff" category="list-text">对于 Oracle 而言，最佳实践是将 LUN 添加到 ASM 磁盘组，而不是调整现有 LUN 的大小，以保持条带化和并行性。</block>
  <block id="58cb14b122b3d785a1a321856cc92c3f" category="summary">Oracle 数据库 LUN 大小调整和 LUN 数量指南（ ASA r2）</block>
  <block id="cf15b0ae7bdc6d8834b7e6418ffef6cf" category="searchtitle">使用ASA r2 进行 Oracle 数据库 LUN 大小调整和 LUN 计数</block>
  <block id="49521166939155a64490ecd7f6957360" category="paragraph">LUN 是ONTAP上的虚拟化对象，它存在于ASA r2 系统上托管存储可用区 (SAZ) 的所有驱动器中。因此，LUN 的性能不受其大小的影响，因为无论选择什么大小，LUN 都能充分利用 SAZ 的全部性能潜力。</block>
  <block id="d25613c7fbbaea4aab9e21e2b21ad490" category="paragraph">* ASA r2 注意事项：*</block>
  <block id="5f929ae9afccf8d55896b9978ea77cf9" category="list-text">ASA r2 的最大 LUN 大小为 128TB，这允许使用更少但更大的 LUN，而不会影响性能。</block>
  <block id="717d9e18e5ee8ee018a606f9bdf7aef7" category="list-text">ASA r2 使用存储可用区 (SAZ) 而不是聚合，但这并不会改变 Oracle 工作负载的 LUN 大小调整逻辑。</block>
  <block id="8dd6202dd76a4a6b4230a20ff09f6fac" category="list-text">默认情况下启用精简配置；调整 LUN 大小不会造成中断，也不需要将其脱机。</block>
  <block id="cc7c6c6a526f7d2cb13c2fd2a0b9e839" category="paragraph">对于ASA r2，LUN 计数的原则与AFF/ FAS相同，因为ONTAP在跨平台处理并行 I/O 的方式类似。然而， ASA r2 的 SAN 专用架构和主动-主动对称路​​径确保了所有 LUN 的一致性能。</block>
  <block id="1b3bc440bdc4148abaecc010852b3e48" category="paragraph">一般来说，4 到 16 个 LUN 足以满足任何给定 Oracle 数据库工作负载的 I/O 需求。由于主机 SCSI 实现方面的限制，少于四个 LUN 可能会造成性能限制。除了极端情况（例如非常高的随机 I/O SSD 工作负载）之外，将 LUN 数量增加到 16 个以上很少能提高性能。</block>
  <block id="32a9cc09d7b28dad1bdac19dfa8defca" category="summary">适用于配备ASA r2 的 Oracle 数据库的 LVM 条带化配置</block>
  <block id="84337c2f0bd3b367c079858b351c1519" category="searchtitle">在ASA r2 上使用 Oracle 数据库进行 LVM 条带化</block>
  <block id="9dc44bcf4c4a65f757ee2d4f417fb802" category="paragraph">使用旋转硬盘进行条带化更加困难，因为必须预先知道 I/O 模式。如果条带化没有针对真实的 I/O 模式进行正确调整，则条带化配置可能会损害性能。对于 Oracle 数据库，尤其是全闪存存储配置，条带化配置起来要容易得多，并且已被证明可以显著提高性能。</block>
  <block id="3fcb47409d533bbc0f1dedd640536c4e" category="paragraph">Oracle 数据库 LVM 条带化的最佳实践：</block>
  <block id="1ee9d08de424307c5b0c68e2cae8b964" category="list-text">条带大小≥数据库块大小。</block>
  <block id="fb7356b0e5eebd52996145ea92edb38c" category="list-text">条带大小 * LUN 数量 ≈ 1MB，以实现最佳并行性。</block>
  <block id="77ad8db55bb3aef8186b8f78c53a25b3" category="list-text">每个 ASM 磁盘组使用多个 LUN 以最大限度地提高吞吐量并避免热点。</block>
  <block id="e9846a743cf48ba63b998c13227ca620" category="sidebar">AFF/ FAS系统上的ONTAP配置</block>
  <block id="a5cbfd8d8aee880e78887fb902e5c440" category="sidebar">Oracle 数据库的ONTAP配置</block>
  <block id="19dcc7d0feb41b8b247042f6b5c839cb" category="sidebar">ASA r2 系统上的ONTAP配置</block>
  <block id="4239635e98cf1c9aade3e99963b47f3e" category="sidebar">适用于配备ASA r2 系统的 Oracle 数据库的ONTAP配置</block>
  <block id="83059bc9b08eac1413f80049818a551a" category="sidebar">使用AFF/ FAS系统进行数据库配置</block>
  <block id="9cbfcdc7f6207e881eb9efa080cb634a" category="sidebar">使用ASA r2 系统进行数据库配置</block>
  <block id="3072f08a47d3ebf5a6bb93d196fc3d0c" category="sidebar">适用于ASA r2 系统的 Oracle 数据库配置</block>
  <block id="cf3d30b3a2769e5a42ca691fedc13a7a" category="sidebar">主机配置与AFF/ FAS系统</block>
  <block id="dc224317c322fd5cc85a7517df62ebbd" category="sidebar">使用ASA r2 系统的主机配置</block>
  <block id="67e9cfbd67f63687103cc996b36d89a3" category="sidebar">适用于配备ASA r2 系统的 Oracle 数据库主机配置</block>
  <block id="7f63d60cb330bfa4e266460c2678e3e5" category="sidebar">AFF/ FAS系统的网络配置</block>
  <block id="d9c561cf68fdc77bb1da849869a07f1c" category="sidebar">ASA r2 系统上的网络配置</block>
  <block id="38e7ae928dc580caab650dc5df5d2fc1" category="sidebar">Oracle 数据库与ASA r2 系统的网络配置</block>
  <block id="8637dea0297332b772f83909e4341446" category="sidebar">Oracle 数据库与ASA r2 系统的存储配置</block>
  <block id="bf9da0db0cba95abeb9d604e28d6fae5" category="paragraph">在文件系统环境中，随着数据的删除，活动 LUN 的精简配置效率可能会随时间推移而降低。除非删除的数据被零覆盖（另请参阅链接：oracle-storage-san-config-asm ru.html[ASMRU]）或使用 TRIM/UNMAP 空间回收释放空间，否则“擦除”的数据会在文件系统中占用越来越多的未分配空白空间。此外，在许多数据库环境中，活动 LUN 的精简配置用途有限，因为数据文件在创建时会被初始化为全部大小。</block>
</blocks>