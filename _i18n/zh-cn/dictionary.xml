<?xml version="1.0" encoding="UTF-8"?>
<blocks>
  <block id="d41d8cd98f00b204e9800998ecf8427e" category="summary"></block>
  <block id="30d965eef5ba25c6b9998ae38270b43e" category="doc">法律声明</block>
  <block id="e9c44bbfd795a5d63d74c6a77afee70d" category="paragraph">法律声明提供对版权声明、商标、专利等的访问。</block>
  <block id="6016a2b341113bf496b719905398ecd2" category="section-title">版权</block>
  <block id="52009bb7ee17227f566cd26a02caee56" category="inline-link-macro"><block ref="52009bb7ee17227f566cd26a02caee56" category="inline-link-rx"></block></block>
  <block id="a1a9afcf552a769c282769271829889a" category="paragraph"><block ref="a1a9afcf552a769c282769271829889a" category="inline-link-macro-rx"></block></block>
  <block id="126a02652da6de02962cf1b654fd6376" category="section-title">商标</block>
  <block id="c4ce4761e466527d26b3e3d5ed1006fd" category="paragraph">NetApp 、 NetApp 徽标和 NetApp 商标页面上列出的标记是 NetApp 、 Inc. 的商标。其他公司和产品名称可能是其各自所有者的商标。</block>
  <block id="f99aa604031e5049799e73b5c3748a98" category="inline-link-macro"><block ref="f99aa604031e5049799e73b5c3748a98" category="inline-link-rx"></block></block>
  <block id="5d545fe5152641e2ebe654e336e520e5" category="paragraph"><block ref="5d545fe5152641e2ebe654e336e520e5" category="inline-link-macro-rx"></block></block>
  <block id="be89498d2f8a22ce47c02ba9795fe2af" category="section-title">专利</block>
  <block id="d0b19d36be2c5f16e9aef46c8a452d3d" category="paragraph">有关 NetApp 拥有的专利的最新列表，请访问：</block>
  <block id="88e5eabd3917048b6927c42496b98f86" category="inline-link-macro"><block ref="88e5eabd3917048b6927c42496b98f86" category="inline-link-rx"></block></block>
  <block id="dd38f906b37d412de7d1c1dcf4cbf31c" category="paragraph"><block ref="dd38f906b37d412de7d1c1dcf4cbf31c" category="inline-link-macro-rx"></block></block>
  <block id="56c34c6410dd45c5cec44149ad0ce037" category="section-title">隐私政策</block>
  <block id="8acb58cbd50ef1b468a020ee0bd351d3" category="inline-link-macro"><block ref="8acb58cbd50ef1b468a020ee0bd351d3" category="inline-link-rx"></block></block>
  <block id="2352c4e1f4d0024ade0869e00e6243f4" category="paragraph"><block ref="2352c4e1f4d0024ade0869e00e6243f4" category="inline-link-macro-rx"></block></block>
  <block id="c0227cef6f07a8cd2ac72f2945b031aa" category="section-title">开放源代码</block>
  <block id="9b73989307c1975dfa4d5e1581e4afe8" category="paragraph">通知文件提供有关 NetApp 软件中使用的第三方版权和许可证的信息。</block>
  <block id="253b40ae359ba25b56231803430c4873" category="section-title">ONTAP</block>
  <block id="856c8958afd787f748a4a025f649154a" category="inline-link-macro">ONTAP 9.13.1的注意事项</block>
  <block id="b22b3b2970d843f99e7e6904bea05207" category="inline-link-macro">ONTAP 9.12.1的通知</block>
  <block id="0358f41254df2d512849db5a04b7e3d4" category="inline-link-macro">ONTAP 9.12.0通知</block>
  <block id="28f1290102a277ef2fd452d558c74219" category="inline-link-macro">ONTAP 9.11.1注意事项</block>
  <block id="57b07f14c8eb4660f94a86d29d53362d" category="inline-link-macro">ONTAP 9.10.1 的通知</block>
  <block id="396712eb9c1644241047ac30619b2b3e" category="inline-link-macro">ONTAP 9.10.0的通知</block>
  <block id="1e6000d4849ef9f3e08d1d9908e9f163" category="inline-link-macro">ONTAP 9.9.1 注意事项</block>
  <block id="6f408b9c999245c7aa32bc9cb1a020f6" category="inline-link-macro">ONTAP 9.8 注意事项</block>
  <block id="04b0bd5b1b4d414fdde93f809162d36d" category="inline-link-macro">ONTAP 9.7通知</block>
  <block id="0c1d7dffcba488555d5eb39b8991e822" category="inline-link-macro">ONTAP 9.6的通知</block>
  <block id="a11ac6880e72412c0f54ae19bea3d191" category="inline-link-macro">ONTAP 9.5通知</block>
  <block id="e49c3c01b15761b5f011d0bd2a0661a3" category="inline-link-macro">ONTAP 9.4通知</block>
  <block id="bf7dcf6467a8a03b05b2d37d31d6eccd" category="inline-link-macro">ONTAP 9.3通知</block>
  <block id="0328352fdfda84af6968462d1a67d3a6" category="inline-link-macro">ONTAP 9.2通知</block>
  <block id="83904100c7d6fe0102e8b2b5bd8ec4bb" category="inline-link-macro">ONTAP 9.1通知</block>
  <block id="5672f5979be77bb31dd559817c9e1e76" category="paragraph"><block ref="f7a2b1db149ed9886af0ce846dbc3e14" category="inline-link-macro-rx"></block>
<block ref="b349c509ad858348b30db7e73307e3aa" category="inline-link-macro-rx"></block>
<block ref="0dce234dfded58bd461541473b86e42a" category="inline-link-macro-rx"></block>
<block ref="9760ec4df13f0afbdfec88ae16c871ae" category="inline-link-macro-rx"></block>
<block ref="b6dab2933dfb92cf0c1355707a4aec7c" category="inline-link-macro-rx"></block>
<block ref="1b7c80b26162b03bd0addd587f70df55" category="inline-link-macro-rx"></block>
<block ref="14faf912aa42102a6628af4551e02583" category="inline-link-macro-rx"></block>
<block ref="a90f36d649d3be5d386cc3563ab044fb" category="inline-link-macro-rx"></block>
<block ref="2cd65b4a044075cfd9ad4a91f42fdff4" category="inline-link-macro-rx"></block>
<block ref="5e764cc3fdcc19ff667796e414159bdc" category="inline-link-macro-rx"></block>
<block ref="561451f09c7bca700ea0d7833cd9e92e" category="inline-link-macro-rx"></block>
<block ref="d23d341a344216fbf99a91152429d49c" category="inline-link-macro-rx"></block>
<block ref="b35e8fbd7b0369b23734510994911ec4" category="inline-link-macro-rx"></block>
<block ref="41d4305cf7a6acb595086f123121a781" category="inline-link-macro-rx"></block>
<block ref="ea685649fabe77da53e843fec56f72b8" category="inline-link-macro-rx"></block></block>
  <block id="07ee2fe6f236deffba69a7cf80a680fd" category="section-title">MCC IP的ONTAP调解器</block>
  <block id="f089ab2b9f25f609795bdd46ae636f18" category="inline-link-macro">9.9.1关于MCC IP的ONTAP调解器的通知</block>
  <block id="239794a299abe62705440f2dab3114cb" category="inline-link-macro">9.8关于MCC IP的ONTAP调解器的通知</block>
  <block id="51fcca20d278d2d03192c01120f17442" category="inline-link-macro">9.7关于MCC IP的ONTAP调解器的通知</block>
  <block id="3ba2aeb22339424d5f5b15dafd2c3eca" category="paragraph"><block ref="c8696a7854fcd089ea112145e4968b10" category="inline-link-macro-rx"></block>
<block ref="4d19e06382f392d0f1a50df789d77c13" category="inline-link-macro-rx"></block>
<block ref="fe4ac88b6b3f1cb9f1dc6d5d4b5086ee" category="inline-link-macro-rx"></block></block>
  <block id="9e476387322a5c250893cf9c5c4ce78c" category="doc">策略</block>
  <block id="b9e18a3460bc17eb9ea65b03f0167453" category="paragraph">这在数据库中很常见。已知包含非活动块的数据库也是FabricPool层的候选数据库。例如、供应链管理数据库可能包含历史信息、这些信息在需要时必须可用、但在正常操作期间不会访问。可以使用FabricPool有选择地重新定位非活动块。</block>
  <block id="95e955bbbe5dd9520a6bf45b0d8a9d4c" category="paragraph">例如、使用的FabricPool卷上运行的数据文件<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 90天期限将在性能层上保留前90天访问的任何块。但是、任何在90天内未访问的内容都会重新定位到容量层。在其他情况下、正常应用程序活动会将正确的块保留在正确的层上。例如、如果数据库通常用于定期处理前60天的数据、则要低得多<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 可以设置期限、因为应用程序的自然活动可确保不会过早重新定位块。</block>
  <block id="c33af7c93d461803ceaf8531e861017d" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 对数据库使用策略时应谨慎。许多数据库都定期开展活动、例如季度末流程或重新编制索引操作。如果这些操作的期限大于<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 可能会发生性能问题。例如、如果季度末处理需要1 TB的数据、而这些数据在其他情况下未被触及、则这些数据现在可能位于容量层上。从容量层读取的速度通常非常快、可能不会出现发生原因性能问题、但具体结果取决于对象存储配置。</block>
  <block id="03431a55183cb73a12c1bbc3e1927678" category="paragraph">。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 策略应设置得足够高、以保留性能层上可能需要的文件。例如、如果数据库中可能需要最新60天的数据且性能最佳、则需要设置<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 期限为60天。根据文件的访问模式、也可以实现类似的结果。例如、如果需要最近90天的数据、而应用程序正在访问这90天的数据、则数据将保留在性能层上。设置<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 在数据变得不太活跃后、将立即对数据进行分层。</block>
  <block id="25d9496e96e698b08c4fc713bfc9a5ca" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 要对这些块进行层化、需要使用策略、因为只有<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略会影响活动文件系统中的块。</block>
  <block id="55fad400d892fb6062e67904fa9be485" category="admonition">任何类型的数据访问都会重置热图数据。因此、数据库完整表扫描甚至读取源文件的备份活动都会阻止分层、因为需要分层<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 从未达到阈值。</block>
  <block id="117c4b6bad0236ab23e0fe29aead8aef" category="paragraph">虽然可以选择调整LUN大小来增加容量、但通常最好使用LVM、包括Oracle ASM。存在LVM的一个主要原因是避免调整LUN大小。通过LVM、多个LUN会绑定到一个虚拟存储池中。从该池中划分出来的逻辑卷由LVM管理、并且可以轻松调整大小。另一个优势是、通过在所有可用LUN之间分布给定逻辑卷、可以避免特定驱动器上出现热点。通常、可以通过使用卷管理器将逻辑卷的底层块区重新定位到新LUN来执行透明迁移。</block>
  <block id="4d4855a15e1f9d6fd8f8bdf1668c537e" category="doc">手动强制NVFAIL</block>
  <block id="8772c1c8bed97f5c942657feeb8bfb6f" category="admonition">本节将详细介绍基本ONTAP NVFAIL、以涵盖MetroCluster特定的主题。</block>
  <block id="14d74316044293d1ebd8c5a01ff90055" category="paragraph">使用MetroCluster时、写入操作在至少另一个控制器上登录到本地NVRAM和NVRAM后才会得到确认。此方法可确保硬件故障或断电不会导致传输中I/O丢失如果本地NVRAM发生故障或与其他节点的连接发生故障、则无法再镜像数据。</block>
  <block id="d820d86d09ea05a0de19c3aacbfb72b2" category="paragraph">如果本地NVRAM报告错误、则此节点将关闭。此关闭会导致在使用HA对时故障转移到配对控制器。使用MetroCluster时、行为取决于所选的整体配置、但可能会自动故障转移到远程便签。在任何情况下、数据都不会丢失、因为发生故障的控制器尚未确认写入操作。</block>
  <block id="886174de078cee4595eb8a8d07f81703" category="paragraph">站点间连接故障会阻止NVRAM复制到远程节点、这种情况更为复杂。写入操作不再复制到远程节点、因此、如果控制器发生灾难性错误、可能会导致数据丢失。更重要的是、在这些情况下尝试故障转移到其他节点会导致数据丢失。</block>
  <block id="790ec042c9b89dac2390ea81b9c29a51" category="paragraph">控制因素是NVRAM是否同步。如果NVRAM已同步、则可以安全地进行节点间故障转移、而不会丢失数据。在MetroCluster配置中、如果NVRAM与底层聚合plexes处于同步状态、则可以安全地继续执行切换、而不会丢失数据。</block>
  <block id="3d936bb059b98a2fc7c177d20eb755c9" category="paragraph">除非强制执行故障转移或切换、否则ONTAP不允许在数据不同步时执行故障转移或切换。以这种方式强制更改条件即表示数据可能会留在原始控制器中、并且数据丢失是可以接受的。</block>
  <block id="3d37a3a8ed77bebc986238aedccecbc9" category="paragraph">如果强制执行故障转移或切换、则数据库尤其容易受到损坏的影响、因为数据库在磁盘上维护着更大的内部数据缓存。如果发生强制故障转移或切换、先前确认的更改将被有效丢弃。存储阵列的内容会及时有效地向后跳转、数据库缓存的状态不再反映磁盘上数据的状态。</block>
  <block id="7ad23b7fa394c8666b132d78a58b1987" category="paragraph">为了保护应用程序免受这种情况的影响、ONTAP允许对卷进行配置、以便针对NVRAM故障提供特殊保护。触发此保护机制后、卷将进入名为NVFAIL的状态。此状态会导致I/O错误、发生原因应用程序会关闭以使其不使用陈旧数据。不应丢失数据、因为存储系统上仍存在任何已确认的写入、对于数据库、任何已提交的事务数据都应出现在日志中。</block>
  <block id="99259586124503e22927506a7ed3738d" category="paragraph">通常的后续步骤是、管理员先完全关闭主机、然后再手动将LUN和卷重新联机。虽然这些步骤可能涉及一些工作、但这种方法是确保数据完整性的最安全方法。并非所有数据都需要这种保护、这就是可以逐个卷配置NVFAIL行为的原因。</block>
  <block id="13fbc5a220fe8007dcaea69217bba134" category="paragraph">要强制与分布在各个站点上的应用程序集群(包括VMware、Oracle RAC等)进行切换、最安全的方法是指定<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> 在命令行中。此选项可作为紧急措施使用、以确保所有缓存数据均已转储。如果主机正在使用最初位于发生灾难的站点上的存储资源、则会收到I/O错误或陈旧的文件句柄 <block ref="a3c6541ac12f1f06a81cc9b03e6bd094" prefix="(" category="inline-code"></block>)错误。Oracle数据库崩溃、文件系统要么完全脱机、要么切换到只读模式。</block>
  <block id="dc6683d37e50abd82911fa91c036fbb2" category="paragraph">切换完成后、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 标记、并且LUN需要置于联机状态。完成此活动后、可以重新启动数据库。这些任务可以自动执行、以减少RTO。</block>
  <block id="a2626552f293b2377efe829e69d14daa" category="section-title">dr-force－nvfail</block>
  <block id="f0cc4bbe3d196251009dbe9f0ac42ffc" category="paragraph">作为一般安全措施、请设置<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> 在正常操作期间可能从远程站点访问的所有卷上的标志、表示它们是故障转移之前使用的活动。此设置的结果是、所选远程卷在进入后将不可用<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 切换期间。切换完成后、<block ref="6b0a5ec5ecf08db5d4b32d860214d098" prefix=" " category="inline-code"></block> 标记、并且LUN必须置于联机状态。完成这些活动后、可以重新启动应用程序。这些任务可以自动执行、以减少RTO。</block>
  <block id="5f6aa76cc0fe886c07f242f921486ef7" category="paragraph">结果类似于使用<block ref="71e644310ff0f1164d905d6e80174023" prefix=" " category="inline-code"></block> 用于手动切换的标志。但是、受影响的卷数量可以仅限于那些必须防止应用程序或具有陈旧缓存的操作系统访问的卷。</block>
  <block id="4df566a29b44806612369c0c1f67521b" category="paragraph">对于不使用的环境、有两个关键要求<block ref="a2626552f293b2377efe829e69d14daa" prefix=" " category="inline-code"></block> 在应用程序卷上：</block>
  <block id="aaf1cc67bd88c39a71e691d413ded49f" category="list-text">在主站点丢失后、强制切换的发生时间不得超过30秒。</block>
  <block id="7f9cc623e2a11875714cf4bc64f148fd" category="list-text">在执行维护任务期间、或者在SyncMirror plexes或NVRAM复制不同步的任何其他情况下、不得发生切换。第一个要求可通过Tieber4软件来满足、该软件配置为在站点发生故障后30秒内执行切换。此要求并不意味着必须在检测到站点故障后30秒内执行切换。这确实意味着、如果自某个站点确认正常运行后30秒内已过、则不再安全地强制执行切换。</block>
  <block id="0929cc8043c21dcf0163f06424677ede" category="paragraph">如果已知MetroCluster配置不同步、则可以通过禁用所有自动切换功能来部分满足第二项要求。更好的选择是、使用Tiebre机会 解决方案监控NVRAM复制和SyncMirror plexes的运行状况。如果集群未完全同步、则Tieb破碎 机不应触发切换。</block>
  <block id="a168430c68d0310385371eabe149a118" category="paragraph">NetApp MCTB软件无法监控同步状态、因此、如果MetroCluster因任何原因而不同步、则应将其禁用。ClusterLion具有NVRAM监控和丛监控功能、可以将其配置为不触发切换、除非确认MetroCluster系统已完全同步。</block>
  <block id="baba038803e218b2ac3b2688bc2fd5db" category="doc">LUN计数</block>
  <block id="b0e4db975ae00108abe9f47db9be5668" category="paragraph">LUN是ONTAP上的一个虚拟化对象、位于托管聚合中的所有驱动器上。因此、LUN的性能不受其大小的影响、因为无论选择何种大小、LUN都会利用聚合的全部性能潜能。</block>
  <block id="7235d4b71fadc2fe03d09d863c7cdd66" category="paragraph">为了方便起见、客户可能希望使用特定大小的LUN。例如、如果数据库是基于LVM或Oracle ASM磁盘组构建的、其中每个磁盘组包含两个1 TB的LUN、则该磁盘组必须以1 TB为增量进行增长。最好使用八个500 GB的LUN来构建磁盘组、以便可以以较小的增量来增加磁盘组。</block>
  <block id="4b1ffe65479a23391a2c7f9caf467a35" category="paragraph">建议不要建立通用标准LUN大小、因为这样做会使易管理性复杂化。例如、如果数据库或数据存储库的大小介于1 TB到2 TB之间、则100 GB的标准LUN大小可能效果良好、但20 TB的数据库或数据存储库需要200个LUN。这意味着、服务器重新启动时间会更长、需要在各种用户界面中管理更多对象、SnapCenter等产品必须对许多对象执行发现。使用更少、更大的LUN可避免此类问题。</block>
  <block id="4afa3de974c36a09c2055d30989bb405" category="list-text">LUN计数比LUN大小更重要。</block>
  <block id="691c70133d96d57796a9299359666f80" category="list-text">LUN大小主要由LUN计数要求控制。</block>
  <block id="8af9e525c143179b948a11fc382a331e" category="list-text">避免创建超出所需数量的LUN。</block>
  <block id="407b2218ad77513a7e3964f169d07e66" category="paragraph">与LUN大小不同、LUN计数会影响性能。应用程序性能通常取决于通过SCSI层执行并行I/O的能力。因此、两个LUN的性能优于一个LUN。使用Veritas VLVM、Linux LVM2或Oracle ASM等LVM是提高并行性的最简单方法。</block>
  <block id="39143fe6204f383e4ce3bb3b77926455" category="paragraph">虽然对随机I/O非常繁重的100% SSD环境进行的测试表明、LUN数量最多可增加到64个、但一般来说、NetApp客户从LUN数量增加到16个以上所获得的优势微乎其微。</block>
  <block id="9875f7503e59521e91e519abd87f5c9e" category="paragraph">* NetApp建议*：</block>
  <block id="57153ab478a4958250d76ac6bf4e3ac0" category="paragraph">通常、四到十六个LUN足以满足任何给定数据库工作负载的I/O需求。由于主机SCSI实施的限制、如果LUN数量少于四个、则可能会造成性能限制。</block>
  <block id="de932976b195d4755fcbea64295fc7cb" category="doc">主机操作系统设置</block>
  <block id="f62cb371f65c322cd9e17a5c2cecd1c8" category="paragraph">大多数应用程序供应商文档都包含特定的TCP和以太网设置、旨在确保应用程序以最佳状态运行。这些相同的设置通常足以提供基于IP的最佳存储性能。</block>
  <block id="ae7a0bb210cbd1edb935128116a21c55" category="section-title">以太网流量控制</block>
  <block id="a3c15fb208efc85bdfe72c57d56c92b8" category="paragraph">此技术允许客户端请求发送方暂时停止数据传输。这通常是因为接收方无法足够快速地处理传入数据。一次、请求发送方停止传输比让接收方丢弃数据包造成的中断要少、因为缓冲区已满。如今、操作系统中使用的TCP堆栈已不再是这种情况。事实上、流量控制造成的问题比它解决的问题多。</block>
  <block id="950d31923e253d170d6c994801ce7cec" category="paragraph">近年来、以太网流量控制导致的性能问题不断增加。这是因为以太网流量控制在物理层运行。如果网络配置允许任何主机操作系统向存储系统发送以太网流量控制请求、则会导致所有已连接客户端的I/O暂停。由于单个存储控制器为越来越多的客户端提供服务、因此其中一个或多个客户端发送流量控制请求的可能性会增加。在广泛的操作系统虚拟化过程中、客户站点经常会出现此问题。</block>
  <block id="6bfd8563627c68f73c30581843441a74" category="paragraph">NetApp系统上的NIC不应接收流量控制请求。根据网络交换机制造商的不同、实现此结果的方法也会有所不同。在大多数情况下、可以将以太网交换机上的流量控制设置为<block ref="a67b5ddb674c9ca32d9c9e1ca81578ee" prefix=" " category="inline-code"></block> 或<block ref="f4eb0bfa09695eb47ff4f3bd3ca4449d" prefix=" " category="inline-code"></block>，表示流量控制请求不会转发到存储控制器。在其他情况下、存储控制器上的网络连接可能不允许禁用流量控制。在这些情况下、必须将客户端配置为从不发送流量控制请求、方法是更改主机服务器本身的NIC配置或主机服务器所连接的交换机端口。</block>
  <block id="7496f3ff64e30d4732c2c64880faf186" category="admonition">* NetApp建议*确保NetApp存储控制器不接收以太网流量控制数据包。这通常可以通过设置控制器所连接的交换机端口来实现、但某些交换机硬件存在一些限制、可能需要在客户端进行更改。</block>
  <block id="ae6d0fc57efaf02ad7dfdacd3575e315" category="section-title">MTU大小</block>
  <block id="ff13ea04765cd9c9aed7b839f15eb2b4" category="paragraph">事实证明、使用巨型帧可以减少CPU和网络开销、从而在一定程度上提高1 Gb网络的性能、但其优势通常并不明显。</block>
  <block id="ee3f364287a30ef10dfdce2f37d94ed2" category="admonition">* NetApp建议*尽可能实施巨型帧、以实现任何潜在的性能优势并使解决方案适应未来需求。</block>
  <block id="2c6ba27b7ed602a9089da6ad9f762c9a" category="paragraph">在10 Gb网络中使用巨型帧几乎是强制性要求。这是因为大多数10 Gb实施在达到10 Gb标记之前都会达到每秒数据包数限制、而不会出现巨型帧。使用巨型帧可以提高TCP/IP处理的效率、因为它允许操作系统、服务器、NIC和存储系统处理的数据包数量较少、但数量较大。不同NIC的性能提升各不相同、但性能提升幅度很大。</block>
  <block id="a44be1bbfde97e4a64b50282325165e7" category="paragraph">对于巨型帧实施、人们普遍认为所有连接的设备都必须支持巨型帧、并且MTU大小必须端到端匹配、但这种看法并不正确相反、在建立连接时、这两个网络端点会协商双方可接受的最高帧大小。在典型环境中、网络交换机的MTU大小设置为9216、NetApp控制器设置为9000、客户端设置为9000和1514的混合。可以支持9000 MTU的客户端可以使用巨型帧、而只支持1514的客户端可以协商较低的值。</block>
  <block id="a31484167f31e1c3f36f7cea821bc581" category="paragraph">在完全交换的环境中、这种安排的问题很少见。但是、在路由环境中请注意、不会强制任何中间路由器对巨型帧进行分段。</block>
  <block id="c805e9846e6fca449dbe3233cc5dbdf5" category="paragraph">* NetApp建议*配置以下内容：</block>
  <block id="b4446b5ca60d915111af271495bd4c17" category="list-text">巨型帧是需要的、但对于1 Gb以太网(GbE)则不需要巨型帧。</block>
  <block id="5b1ea13ac12a9c8be0d09303f637dba4" category="list-text">要在10GbE和更快的速度下实现最高性能、需要巨型帧。</block>
  <block id="08a8dce78637f5dd14ed052163feb9da" category="section-title">TCP参数</block>
  <block id="1a999618685598bee637262fe589de70" category="paragraph">通常会有三种设置配置不当：TCP时间戳、选择性确认(SACK)和TCP窗口缩放。Internet上的许多过时文档建议禁用其中一个或多个参数以提高性能。这一建议在多年前具有一定的价值、那时CPU功能要低得多、尽可能减少TCP处理开销会有好处。</block>
  <block id="6a594ec6f0bb742c1d2b0f631cf65ba1" category="paragraph">但是、在现代操作系统中、禁用任何这些TCP功能通常不会带来明显的优势、同时还可能会损害性能。在虚拟化网络环境中、性能可能会受到损害、因为要高效处理数据包丢失和网络质量变化、需要使用这些功能。</block>
  <block id="cdc44d05b1633e8a8c7835010c423dd6" category="admonition">*TCP NetApp建议*在主机上启用TCP时间戳、SACK和TCP窗口缩放，在任何当前操作系统中，所有这三个参数都应默认为打开。</block>
  <block id="72a921ac9177188a9be32ec711fc15d8" category="doc">路径访问</block>
  <block id="544c599da087dba677a820c3df344503" category="paragraph">SnapMirror业务连续性(SM-BC)本质上是SAN的一项增强型SnapMirror功能、允许主机从托管LUN的系统以及托管其副本的系统访问LUN。</block>
  <block id="6139cdabb39d5ceac18a60642497c6a7" category="paragraph">SM-BC和SnapMirror Sync (SM-S)共享一个复制引擎、但是SM-BC还包括一些附加功能、例如、企业级应用程序的透明应用程序故障转移和故障恢复。</block>
  <block id="a73743f15de974052b0640c60f489d90" category="paragraph">在实践中、它的工作原理与粒度版本的MetroCluster类似、它可以为各个工作负载启用选择性粒度RPO = 0同步复制。低级别的路径行为与MetroCluster截然不同、但从主机角度来看、最终结果是类似的。</block>
  <block id="b3bf85c7b0a17286752c110f404a7035" category="paragraph">SM-BC使主存储阵列和远程存储阵列中的存储设备对主机操作系统可见。路径可通过非对称逻辑单元访问(AANAA)进行管理、ANAA是一种行业标准协议、用于确定存储系统与主机之间的优化路径。</block>
  <block id="cbf0bd4f4096570f567049c984f8c9d3" category="paragraph">访问I/O的最短设备路径被视为主动/优化路径、其余路径被视为主动/非优化路径。</block>
  <block id="350b9208772a185e0d0943b105765d89" category="paragraph">SM-BC关系位于不同集群上的一对SVM之间。这两个SVM都能够提供数据、但ALUA会优先使用当前拥有LUN所在驱动器所有权的SVM。远程SVM的IO将通过SM-BC互连代理。</block>
  <block id="341d84aa26cb4521474864e04ea2a63b" category="inline-image-macro">错误：缺少图形映像</block>
  <block id="532db5273379dd6149d97b7ab6e420b6" category="paragraph"><block ref="532db5273379dd6149d97b7ab6e420b6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b56265ceb6311e42003e668438136a59" category="section-title">同步复制</block>
  <block id="8159c40a86db91b72e00c2eb5cf751fe" category="paragraph">在正常操作下、远程副本始终是RPO = 0的同步副本、但有一个例外。如果无法复制数据、SM-BC将释放复制数据的要求并恢复提供IO。如果客户认为复制链路丢失是近乎灾难的情况、或者不希望在无法复制数据时业务运营暂停、则首选此选项。</block>
  <block id="0cf4a786acebd750bbfdfc4416c89406" category="section-title">存储硬件</block>
  <block id="f0fd4c8ee2422af8e335cc85c485ccbf" category="paragraph">与其他存储灾难恢复解决方案不同、SM-BC提供了非对称平台灵活性。每个站点的硬件不必相同。通过此功能、您可以调整用于支持SM-BC的硬件的大小。如果需要支持完整的生产工作负载、远程存储系统可以与主站点完全相同；但是、如果灾难导致I/O减少、则与远程站点上较小的系统相比、可能会更经济高效。</block>
  <block id="ea9f3de5dd21190fbc6bca180b2040f1" category="section-title">ONTAP调解器</block>
  <block id="b378eb5f2b386494f24a3f09afd8ae1f" category="paragraph">ONTAP调解器是从NetApp支持下载的软件应用程序。调解器可自动执行主站点和远程站点存储集群的故障转移操作。它可以部署在内部或云端托管的小型虚拟机(VM)上。配置后、它将作为第三个站点来监控这两个站点的故障转移场景。</block>
  <block id="0f54fb931dbdeea735f18a8e73f9eab5" category="doc">利用SyncMirror实现数据保护</block>
  <block id="d7023f86951b6c3c009891a468c3effd" category="paragraph">最简单的一个层面是、同步复制意味着、在确认镜像存储之前、必须对镜像存储的两端进行任何更改。例如、如果数据库正在写入日志、或者VMware子系统正在修补、则写入操作绝不能丢失。作为协议级别、在将写入提交到两个站点上的非易失性介质之前、存储系统不得确认写入。只有这样、才能安全地继续操作、而不会丢失数据。</block>
  <block id="eee4f7a4e0ed3a8646a97bcf3e118fb9" category="paragraph">使用同步复制技术是设计和管理同步复制解决方案的第一步。最重要的注意事项是了解在各种计划内和计划外故障情形下可能发生的情况。并非所有同步复制解决方案都能提供相同的功能。如果您需要的解决方案能够实现零恢复点目标(RPO)、即零数据丢失、则必须考虑所有故障情形。特别是、如果由于站点间连接断开而无法进行复制、则会产生什么预期结果？</block>
  <block id="71554672a088c43ab21c759ddd161928" category="section-title">SyncMirror数据可用性</block>
  <block id="bec293a9cf8e49ec40e6a4fdc02b9146" category="paragraph">MetroCluster复制基于NetApp SyncMirror技术、该技术旨在高效地切换至同步模式和切换至同步模式之外。此功能可满足需要同步复制、但也需要数据服务高可用性的客户的要求。例如、如果与远程站点的连接断开、则通常最好让存储系统继续在未复制的状态下运行。</block>
  <block id="9a9ce41f4b23474045b6c6e0ac7752af" category="paragraph">许多同步复制解决方案只能在同步模式下运行。这种类型的全或全不复制有时称为Domino模式。此类存储系统将停止提供数据、而不是允许数据的本地和远程副本不同步。如果强制中断复制、重新同步可能会非常耗时、并且可能会使客户在重新建立镜像期间完全丢失数据。</block>
  <block id="8646bb558f8f18a200cce2f70602627a" category="paragraph">SyncMirror不仅可以在无法访问远程站点时无缝切换出同步模式、还可以在恢复连接后快速重新同步到RPO = 0状态。远程站点上的陈旧数据副本也可以在重新同步期间保留在可用状态、从而确保本地和远程数据副本始终存在。</block>
  <block id="995f5151d2d1c0a4e8371b2b3c9b6e5b" category="paragraph">如果需要Domino模式、则NetApp提供SnapMirror同步(SM-S)。此外、还提供了应用程序级选项、例如Oracle DataGuard或主机端磁盘镜像的扩展超时。有关追加信息和选项、请咨询您的NetApp或合作伙伴客户团队。</block>
  <block id="1d12d7a206d9b5337ae6fa442f23d377" category="doc">仅快照</block>
  <block id="64c29f2f2feedeb607ff588b13d9758b" category="paragraph">。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block><block ref="964193481f440d73ce3474a7a09bc3ac" prefix=" " category="inline-code"></block> 仅适用于未与活动文件系统共享的块。实际上、它需要对数据库备份进行层化。创建快照后、块将成为分层的候选块、然后将其覆盖、从而导致块仅存在于快照中。之前的延迟<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 块被视为冷却由控制<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 卷的设置。从ONTAP 9.8开始、此范围为2到183天。</block>
  <block id="ebd9889c847a7a3ddeccd2717ead46f2" category="paragraph">许多数据集的更改率较低、因此此策略节省的空间极少。例如、在ONTAP上观察到的典型数据库每周的更改率小于5%。数据库归档日志可能会占用大量空间、但它们通常仍存在于活动文件系统中、因此不适合在此策略下进行分层。</block>
  <block id="06b9281e396db002010bde1de57262eb" category="section-title">自动</block>
  <block id="ecf602bd5abbd6a605debedbb6c3d4e0" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 层划分策略可将层划分扩展到快照特定的块以及活动文件系统中的块。块被视为冷却之前的延迟由控制<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 卷的设置。从ONTAP 9.8开始、此范围为2到183天。</block>
  <block id="6256ce48698ff0bde6f818679cdfb382" category="paragraph">此方法可启用在中不可用的层选项<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 策略。例如、数据保护策略可能需要保留90天的某些日志文件。如果将冷却期设置为3天、则会将超过3天的任何日志文件从性能层中分层出来。此操作可释放性能层上的大量空间、同时仍允许您查看和管理整个90天的数据。</block>
  <block id="6adf97f83acf6453d4a6a4b1070f3754" category="section-title">无</block>
  <block id="7026ff5c5d4ab3946ff2d86f0e2cca6f" category="paragraph">。<block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix=" " category="inline-code"></block> 分层策略可防止从存储层对任何其他块进行分层、但容量层中的任何数据仍会保留在容量层中、直到被读取为止。如果随后读取该块、则会将其移回并放置在性能层上。</block>
  <block id="d152c7b0939fb6d35fdb0433de0d6369" category="paragraph">使用的主要原因<block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix=" " category="inline-code"></block> 分层策略可防止对块进行分层、但随着时间的推移更改策略可能会很有用。例如、假设某个特定数据集已广泛分层到容量层、但却出现了对全部性能功能的意外需求。可以更改此策略、以防止任何其他分层、并确认随着IO增加而读回的任何块仍保留在性能层中。</block>
  <block id="b1c94ca2fbc3e78fc30069c8d0f01680" category="section-title">全部</block>
  <block id="84826d7e23dfac7549819d5115fdcedd" category="paragraph">。<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 层策略将取代<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 自ONTAP 9.6起的策略。。<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 策略仅应用于数据保护卷、即SnapMirror或NetApp SnapVault目标。。<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 策略的功能相同、但不限于数据保护卷。</block>
  <block id="10d8500e282e8bbacd668af6f773f412" category="paragraph">使用此策略、块将立即视为冷数据块、并有资格立即分层到容量层。</block>
  <block id="ec583de0216b95bc673c84e4ec9356e6" category="paragraph">此策略尤其适用于长期备份。它还可用作分层存储管理(HSM)的一种形式。过去、HSM通常用于将文件的数据块分层到磁带、同时使文件本身在文件系统上保持可见。使用的FabricPool卷<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 通过策略、您可以将文件存储在一个可见且易于管理的位置、但几乎不会占用本地存储层上的空间。</block>
  <block id="79768a069a539d4f130e672a660bf45f" category="doc">分区</block>
  <block id="79da1502ddfac887bfdf0d92f2428fe6" category="paragraph">这包括典型的规划措施、例如、确保主机和存储系统之间的SAN具有足够的带宽、检查所有必需设备之间是否存在所有SAN路径、使用FC交换机供应商所需的FC端口设置、避免ISL争用、 并使用适当的SAN网络结构监控。</block>
  <block id="a0bdb98e8b9da585816478d24278e42f" category="paragraph">一个FC分区不应包含多个启动程序。这种安排最初可能看起来有效、但启动程序之间的串扰最终会影响性能和稳定性。</block>
  <block id="8ef958d9e25538841b306960ab117626" category="paragraph">虽然在极少数情况下、不同供应商的FC目标端口的行为会导致问题、但多目标区域通常被视为安全区域。例如、避免将NetApp和非NetApp存储阵列的目标端口都包含在同一分区中。此外、将NetApp存储系统和磁带设备置于同一分区更容易出现发生原因问题。</block>
  <block id="642223473862db290604321fe2ebe763" category="doc">svms</block>
  <block id="47ea917cf14ad91c68c407f90a7a189d" category="paragraph">SVM (在ONTAP命令行界面中称为Vserver)是存储的基本功能单元、将SVM与VMware ESX服务器上的子系统进行比较非常有用。</block>
  <block id="9efbaa34de852e33319ca8ceb1861832" category="paragraph">首次安装时、ESX没有预配置的功能、例如托管子操作系统或支持最终用户应用程序。在定义虚拟机(VM)之前、此容器为空容器。ONTAP与此类似。首次安装ONTAP时、在创建SVM之前、它无法提供数据。SVM特性用于定义数据服务。</block>
  <block id="13ce2622b2cc2118c44d3aae7df8167d" category="paragraph">与存储架构的其他方面一样、SVM和逻辑接口(LIF)设计的最佳选项在很大程度上取决于扩展要求和业务需求。</block>
  <block id="8fb41a27984f0beba2e12fb920a486aa" category="paragraph">目前尚无为ONTAP配置SVM的官方最佳实践。正确的方法取决于管理和安全要求。</block>
  <block id="f4d8541bb6d07f7533a6b5aa6cfb2455" category="paragraph">大多数客户都会运行一个主SVM来满足大多数日常需求、但随后会创建少量SVM来满足特殊需求。例如、您可能希望创建：</block>
  <block id="259908e9e431c0fbb9d425249ceb7930" category="list-text">由专业团队管理的关键业务数据库的SVM</block>
  <block id="0e10f2715884f3538282397d69b2cd00" category="list-text">开发组的SVM、该开发组拥有完全的管理控制权、因此可以独立管理自己的存储</block>
  <block id="7624156e307247e4ea1ec8bf574136a1" category="list-text">用于敏感业务数据(例如人力资源或财务报告数据)的SVM、必须限制管理团队</block>
  <block id="e5e09031843479ef9ef8cbbd4c2f404c" category="inline-link-macro">NetApp Hardware Universe</block>
  <block id="bd32656670155eb09690047819fc0971" category="paragraph">在多租户环境中、可以为每个租户的数据分配一个专用SVM。每个集群、HA对和节点的SVM和LIP数量限制取决于所使用的协议、节点型号和ONTAP版本。  请参见 <block ref="41f66f34b3a905f864500c9319fdff8f" category="inline-link-macro-rx"></block> 的限制。</block>
  <block id="fb012f1e7970d8285bd5d6c5a7f7d523" category="doc">SSD聚合、包括AFF系统</block>
  <block id="cb8e4651c457f71d5788f38eac01471f" category="paragraph">可用空间是指未用于实际数据的任何空间、其中包括聚合本身上的未分配空间以及成分卷中的未使用空间。此外、还必须考虑精简配置。例如、卷可能包含1 TB的LUN、其中实际数据仅利用了50%的空间。在精简配置环境中、这将正确地显示为占用500 GB的空间。但是、在完全配置的环境中、1 TB的全部容量似乎正在使用中。500 GB的未分配空间将被隐藏。实际数据未使用此空间、因此应将此空间计入总可用空间。</block>
  <block id="d3487661d9a0702bd5915d49070f62dc" category="paragraph">对于用于企业级应用程序的存储系统、NetApp建议如下：</block>
  <block id="678e476783bceae80094bcb4c1f32969" category="admonition">* NetApp建议*至少留出10%的可用空间。这包括所有未使用的空间、包括聚合或卷中的可用空间、以及由于使用完全配置而分配但实际数据未使用的任何可用空间。逻辑空间并不重要、问题是可用于数据存储的实际可用物理空间有多少。</block>
  <block id="2171d172d184f1202a686849c85dce91" category="paragraph">建议10%的可用空间非常保守。SSD聚合可以支持利用率更高的工作负载、而不会对性能产生任何影响。但是、随着聚合利用率的提高、如果不仔细监控利用率、用尽空间的风险也会增加。此外、在以99%的容量运行系统时、可能不会影响性能、但可能会导致管理工作、试图在订购额外硬件时阻止系统完全填满、并且可能需要一些时间来采购和安装额外的驱动器。</block>
  <block id="789243e17acb0b134f435d6c4c1350f2" category="section-title">HDD聚合、包括Flash Pool聚合</block>
  <block id="7302e9f16fb8c5bc30f6035fe4098b52" category="admonition">* NetApp建议*使用旋转驱动器时至少留出15%的可用空间。这包括所有未使用的空间、包括聚合或卷中的可用空间、以及由于使用完全配置而分配但实际数据未使用的任何可用空间。当言论自由接近10%时、性能将受到影响。</block>
  <block id="0b0a68e2dedde9c0b9a3ea4276f4b85c" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略是最适合备份数据的策略。这样可以确保在达到冷却阈值时及时分层、而不管这些文件是已删除还是仍位于主文件系统中。将所有可能需要的文件存储在活动文件系统中的一个位置也可以简化管理。没有理由通过搜索快照来查找需要还原的文件。</block>
  <block id="11a75a1257cc68a4a46bc553dabe0c0d" category="paragraph">。<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 可以使策略有效、但该策略仅适用于不再位于活动文件系统中的适用场景块。因此、必须先删除NFS或SMB共享上的文件、然后才能对数据进行分层。</block>
  <block id="b4af96e8cea99b56592db816cab30fce" category="paragraph">对于LUN配置、此策略的效率甚至会更低、因为从LUN中删除文件只会从文件系统元数据中删除文件引用。LUN上的实际块将一直保留在原位、直到被覆盖为止。这种情况可能会在删除文件和覆盖块并成为可进行层的候选块之间造成长时间延迟。移动有一些好处<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 块到容量层、但总体而言、FabricPool备份数据管理最适合与结合使用<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略。</block>
  <block id="1c237d1ebcdeff13ae0145c741d9401d" category="admonition">这种方法有助于用户更高效地管理备份所需的空间、但FabricPool本身并不是一种备份技术。将备份文件分层到对象存储可简化管理、因为这些文件在原始存储系统上仍然可见、但对象存储目标中的数据块依赖于原始存储系统。如果源卷丢失、则对象存储数据将不再可用。</block>
  <block id="a19665c8f7c0210f96ad2934ad0ee361" category="paragraph">在ONTAP系统上、存储以4 KB为单位进行组织。一个数据库或文件系统的8 KB块应正好映射到两个4 KB块。如果LUN配置错误使对齐在任一方向上移动1 KB、则每个8 KB块将位于三个不同的4 KB存储块上、而不是两个。这种安排会增加发生原因延迟、并在存储系统中执行发生原因额外的I/O。</block>
  <block id="211a9fe299057fe8665b591dddbac56d" category="paragraph">对齐也会影响LVM架构。如果在整个驱动器设备上定义了逻辑卷组中的物理卷(不创建分区)、则LUN上的第一个4 KB块与存储系统上的第一个4 KB块对齐。这是正确的对齐方式。分区会出现问题、因为它们会移动操作系统使用LUN的起始位置。只要偏移量以4 KB的整数单位移动、LUN就会对齐。</block>
  <block id="7c8a0aad1f59988f8160921a07203bb4" category="paragraph">在Linux环境中、在整个驱动器设备上构建逻辑卷组。如果需要分区、请运行以检查对齐情况<block ref="16ae8c2dc7757a3180ce37bad780251a" prefix=" " category="inline-code"></block> 并验证每个分区的起始位置是否为八的倍数。这意味着分区从八个512字节扇区的倍数开始、即4 KB。</block>
  <block id="e98a692d783d8d778aab49ed4c55e214" category="doc">站点故障保护：NVRAM和MetroCluster</block>
  <block id="186577daf29184ed8a55cf899ba2979c" category="paragraph">MetroCluster通过以下方式扩展NVRAM数据保护：</block>
  <block id="679f5a5873d7d3378cf4b3035fd5cb13" category="list-text">在双节点配置中、NVRAM数据通过交换机间链路(ISL)复制到远程配对节点。</block>
  <block id="00bec98f52b9151dd2e0c760becd4ca8" category="list-text">在HA对配置中、NVRAM数据会同时复制到本地配对节点和远程配对节点。</block>
  <block id="94deccfbf8f798c1661000b27a568b18" category="list-text">写入只有在复制到所有配对项后才会得到确认。此架构通过将NVRAM数据复制到远程配对节点来保护传输中的I/O免受站点故障的影响。驱动器级数据复制不涉及此过程。拥有聚合的控制器负责通过向聚合中的两个plexes写入数据来进行数据复制、但在站点丢失时、仍必须防止传输中I/O丢失。只有当配对控制器必须接管发生故障的控制器时、才会使用复制的NVRAM数据。</block>
  <block id="996aa1ed8a906e55c7f157a1643021b7" category="section-title">站点和磁盘架故障保护：SyncMirror和plexes</block>
  <block id="1c114a932963683e04dc7dece97c15c9" category="paragraph">SyncMirror是一种镜像技术、可增强但不会取代RAID DP或RAID-TEC。它会镜像两个独立RAID组的内容。逻辑配置如下：</block>
  <block id="b4b4f1d65cb5f1370402220b00584e79" category="list-text">驱动器会根据位置配置到两个池中。一个池由站点A上的所有驱动器组成、另一个池由站点B上的所有驱动器组成</block>
  <block id="418f0763b76bff8e324f1afdd5456b49" category="list-text">然后、基于RAID组的镜像集创建一个通用存储池(称为聚合)。从每个站点提取的驱动器数量相等。例如、一个包含20个驱动器的SyncMirror聚合将由站点A的10个驱动器和站点B的10个驱动器组成</block>
  <block id="51bf74357f742acfa0a7cd11ce52ed7f" category="list-text">给定站点上的每组驱动器都会自动配置为一个或多个完全冗余的RAID DP或RAID-TEC组、而不依赖于镜像的使用。在镜像下使用RAID可提供数据保护、即使在站点丢失后也是如此。</block>
  <block id="8a35ad1e53533c7a3a8ff427bda0deb2" category="paragraph"><block ref="8a35ad1e53533c7a3a8ff427bda0deb2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="abf64dbc3ac20af1b4a30150a016ca58" category="paragraph">上图显示了一个示例SyncMirror配置。在控制器上创建了一个包含24个驱动器的聚合、其中12个驱动器来自站点A上分配的磁盘架、12个驱动器来自站点B上分配的磁盘架这些驱动器被分组为两个镜像RAID组。RAID组0在站点A上包含一个6驱动器丛、该丛镜像到站点B上的一个6驱动器丛同样、RAID组1在站点A上包含一个6驱动器丛、该丛镜像到站点B上的6驱动器丛</block>
  <block id="d9945e1dbadc87ba8e52a5e69376005c" category="paragraph">SyncMirror通常用于为MetroCluster系统提供远程镜像、每个站点有一个数据副本。有时、它会用于在单个系统中提供额外的冗余级别。尤其是、它可以提供磁盘架级冗余。驱动器架已包含双电源和控制器、总体比金属板稍多、但在某些情况下、可能需要额外保护。例如、一家NetApp客户为汽车测试期间使用的移动实时分析平台部署了SyncMirror。该系统分为两个物理机架、配有独立的电源和独立的UPS系统。</block>
  <block id="f3495a1e6cf563a617c71164f3b11ca3" category="section-title">冗余故障：NVFAIL</block>
  <block id="c7474a3ed1a224804e4741a256bdd953" category="paragraph">如前文所述、写入操作只有在至少另一个控制器上记录到本地NVRAM和NVRAM后才会得到确认。此方法可确保硬件故障或断电不会导致传输中I/O丢失如果本地NVRAM发生故障或与其他节点的连接发生故障、则无法再镜像数据。</block>
  <block id="4774101e81ea03c43fe20e0d7f2d21d1" category="paragraph">控制因素是NVRAM是否同步。如果NVRAM已同步、则可以安全地进行节点间故障转移、而不会丢失数据。在MetroCluster配置中、如果NVRAM与底层聚合plexes处于同步状态、则可以安全地继续执行切换、而不会丢失数据。</block>
  <block id="03e97c023521445cd70307afabdcf0d5" category="paragraph">如果强制执行故障转移或切换、则数据库和其他应用程序尤其容易受到损坏的影响、因为它们在磁盘上维护着更大的内部数据缓存。如果发生强制故障转移或切换、先前确认的更改将被有效丢弃。存储阵列的内容会及时有效地向后跳转、缓存的状态不再反映磁盘上数据的状态。</block>
  <block id="ff7a32ed70b7df57dd29a3ed75e8c787" category="paragraph">为了防止出现这种情况、ONTAP允许对卷进行配置、以便针对NVRAM故障提供特殊保护。触发此保护机制后、卷将进入名为NVFAIL的状态。此状态会导致发生原因应用程序崩溃的I/O错误。此崩溃会导致应用程序关闭、以便它们不会使用过时数据。数据不应丢失、因为日志中应存在任何已提交的事务数据。通常的后续步骤是、管理员先完全关闭主机、然后再手动将LUN和卷重新联机。虽然这些步骤可能涉及一些工作、但这种方法是确保数据完整性的最安全方法。并非所有数据都需要这种保护、这就是可以逐个卷配置NVFAIL行为的原因。</block>
  <block id="637d4b37868fb7825461df6edd674158" category="section-title">HA对和MetroCluster</block>
  <block id="9d8738f531e6c6a809ba66315beaa2f4" category="paragraph">MetroCluster有两种配置：双节点和HA对。就NVRAM而言、双节点配置与HA对的行为相同。如果发生突然故障、配对节点可以重放NVRAM数据、以确保驱动器一致、并确保未丢失任何已确认的写入。</block>
  <block id="936f4311b16ee4dc74a5564892f8976d" category="paragraph">HA对配置也会将NVRAM复制到本地配对节点。简单的控制器故障会导致配对节点上的NVRAM重放、就像不使用MetroCluster的独立HA对一样。如果站点突然完全丢失、远程站点还具有必要的NVRAM、以使驱动器保持一致并开始提供数据。</block>
  <block id="83b6c3c3018b913ecf1aca67e0daa35e" category="paragraph">MetroCluster的一个重要方面是、在正常运行条件下、远程节点无法访问配对节点数据。每个站点本质上都是一个独立的系统、可以承担相反站点的特性。此过程称为切换、其中包括计划内切换、在此过程中、站点操作会无系统地迁移到相反站点。此外、还包括站点丢失以及在灾难恢复过程中需要手动或自动切换的计划外情况。</block>
  <block id="58504b36cfdfd10d5f2802d7b943a379" category="section-title">切换和切回</block>
  <block id="d505751d1708fb5d57b0e23d089507a9" category="paragraph">术语切换和切回是指在MetroCluster配置中的远程控制器之间过渡卷的过程。此过程仅会对远程节点执行适用场景。如果在四卷配置中使用MetroCluster、则本地节点故障转移与前面所述的接管和恢复过程相同。</block>
  <block id="1127608e73df5ede22b149c8f19fc860" category="section-title">计划内切换和切回</block>
  <block id="a6733335678588619c977608e891e54e" category="paragraph">计划内切换或切回类似于节点之间的接管或交还。此过程包含多个步骤、看起来可能需要几分钟时间、但实际发生的是存储和网络资源的多阶段平稳过渡。控制传输的速度比执行完整命令所需的时间快得多。</block>
  <block id="4bb5647dcff332f0b53819ecd631303c" category="paragraph">接管/交还与切换/切回之间的主要区别在于对FC SAN连接的影响。使用本地接管/备份时、主机会丢失指向本地节点的所有FC路径、并依靠其本机MPIO切换到可用的备用路径。端口不会重新定位。通过切换和切回、控制器上的虚拟FC目标端口将过渡到另一站点。它们实际上暂时不再存在于SAN上、然后重新出现在备用控制器上。</block>
  <block id="0ba902ec3f6ce91c2e801715bb8b96fa" category="section-title">SyncMirror超时</block>
  <block id="9c8a1814b60b84d1aa68fa7bba69138b" category="paragraph">SyncMirror是一种ONTAP镜像技术、可针对磁盘架故障提供保护。如果磁盘架相隔一段距离、则可以实现远程数据保护。</block>
  <block id="68cf36f65a7e56ff3b6c0894be3ed9e8" category="paragraph">SyncMirror不提供通用同步镜像。结果是可用性更好。某些存储系统使用持续的全镜像或无镜像、有时称为Domino模式。这种形式的镜像在应用程序中受到限制、因为如果与远程站点的连接断开、所有写入活动都必须停止。否则、写入将在一个站点上存在、而在另一个站点上不存在。通常、此类环境会配置为在站点间连接丢失的时间较短(例如30秒)时使LUN脱机。</block>
  <block id="84ad4c21def9c355e80ef250d910bfa2" category="paragraph">这种行为适合一小部分环境。但是、大多数应用程序都需要一个解决方案、该系统可以在正常运行条件下提供有保障的同步复制、但可以暂停复制。站点间连接完全断开通常被视为近乎灾难的情况。通常、此类环境会保持联机并提供数据、直到修复连接或正式决定关闭环境以保护数据为止。仅由于远程复制失败而要求自动关闭应用程序的要求并不常见。</block>
  <block id="e3bd381a7bbaee6c741aee230972acf4" category="paragraph">SyncMirror支持同步镜像要求、并具有超时的灵活性。如果与远程控制器和/或丛的连接断开、30秒计时器将开始倒计时。当计数器达到0时、写入I/O处理将继续使用本地数据。数据的远程副本可用、但会及时冻结、直到连接恢复为止。重新同步利用聚合级快照使系统尽快恢复到同步模式。</block>
  <block id="0c919cd6511df6d83b811234b0448374" category="paragraph">值得注意的是、在许多情况下、在应用程序层实施这种通用的全Domino模式或全无Domino模式复制效果更佳。例如、Oracle DataGuard包括最大保护模式、可保证在任何情况下进行长实例复制。如果复制链路出现故障的时间超过可配置的超时时间、数据库将关闭。</block>
  <block id="ba92cbe464cfee8aa12c41e6aecd1071" category="section-title">使用光纤连接MetroCluster自动执行无人看管切换</block>
  <block id="515094655d10031595da776c94b3d710" category="paragraph">自动无人值守切换(Automatic无人值守切换、AUSO)是一项光纤连接的MetroCluster功能、可提供一种跨站点HA形式。如前文所述、MetroCluster有两种类型：每个站点上一个控制器或每个站点上一个HA对。HA选项的主要优势是、计划内或计划外控制器关闭仍可使所有I/O都位于本地。单节点选项的优势在于降低成本、复杂性和基础架构。</block>
  <block id="29d4da26af76b66db3a172a39edf8367" category="paragraph">AUSO的主要价值是提高光纤连接MetroCluster系统的HA功能。每个站点都会监控相反站点的运行状况、如果没有节点可提供数据、则AUSO会导致快速切换。在每个站点只有一个节点的MetroCluster配置中、此方法尤其有用、因为它使配置在可用性方面更接近HA对。</block>
  <block id="6b3a5f7923b2d803fd3b28c255fef420" category="paragraph">AUSO无法在HA对级别提供全面监控。HA对可以提供极高的可用性、因为它包含两根冗余物理缆线、用于节点到节点的直接通信。此外、HA对中的两个节点均可访问冗余环路上的同一组磁盘、从而为一个节点提供另一条路由来监控另一个节点的运行状况。</block>
  <block id="da87dad268507a3523bc38275b1d3fbc" category="paragraph">MetroCluster集群存在于节点间通信和磁盘访问均依赖于站点间网络连接的站点之间。监控集群其余部分的检测信号的能力有限。在另一个站点因网络问题而实际关闭而不是不可用的情况下、AUSO必须区分这种情况。</block>
  <block id="e8e4f55c4203e7fb24d4543a7a0f65da" category="paragraph">因此、如果HA对中的控制器检测到因特定原因(例如系统崩溃)而发生的控制器故障、则该控制器可能会提示接管。如果完全断开连接(有时称为丢失检测信号)、它还会提示接管。</block>
  <block id="91aa4ce36cb243281f3777d66c8f89e0" category="paragraph">只有在原始站点上检测到特定故障时、MetroCluster系统才能安全地执行自动切换。此外、拥有存储系统的控制器必须能够保证磁盘和NVRAM数据保持同步。控制器无法仅因为与源站点断开连接而保证切换的安全性、而源站点仍可正常运行。有关自动执行切换的其他选项、请参见下一节中有关MetroCluster Tieb破碎 机(MCTB)解决方案的信息。</block>
  <block id="8e7705fe4aea384d7f6a99ab6dc0f408" category="section-title">具有光纤连接MetroCluster的MetroCluster Tieb破碎 机</block>
  <block id="897b7698cb343dbc3452e845705ab0f3" category="inline-link">NetApp MetroCluster Tieb破碎 机</block>
  <block id="9c093f14319e8253b8c9b37290597239" category="inline-link">NetApp 支持站点</block>
  <block id="a1d9fc4fb49119a9fe9b39abec0a769b" category="paragraph">。<block ref="9332969062716487f0feefe076babf99" category="inline-link-rx"></block> 软件可以在第三个站点上运行、以监控MetroCluster环境的运行状况、发送通知、并在发生灾难时强制执行切换(可选)。有关Tieb破碎 机的完整问题描述、请参见<block ref="c21658567f794984b03c21186a56713d" category="inline-link-rx"></block>但MetroCluster Tieb破碎 机的主要用途是检测站点丢失。它还必须区分站点丢失和连接丢失。例如、切换不应因TiebREAKER无法访问主站点而发生、这就是TiebREAKER同时监控远程站点联系主站点的能力的原因。</block>
  <block id="6f29b1849750ceee5eb7f6f02d100e6b" category="paragraph">使用AUSO自动切换也与MCTB兼容。AUSO反应非常迅速、因为它可以检测特定的故障事件、然后仅在NVRAM和SyncMirror plexes处于同步状态时调用切换。</block>
  <block id="6f5c7ae76595eca2ca83c5dd30cd8e9f" category="paragraph">相反、Tieb破碎 机位于远程位置、因此必须等待计时器经过、然后才能宣布站点停机。Tieb破碎 机最终会检测到由AUSO涵盖的那种控制器故障、但通常、在Tieb破碎 机开始工作之前、AUSO已启动切换、并且可能已完成切换。Tieb破碎 机生成的第二个切换命令将被拒绝。</block>
  <block id="842547e1622bb12d9201167b0c39cf6d" category="paragraph">*注意：*强制切换时、MCTB软件不会验证NVRAM是否同步和/或plexes是否同步。如果已配置自动切换、则应在维护活动期间禁用、从而导致NVRAM或SyncMirror plexes失去同步。</block>
  <block id="7110edd59c3d0f25a584723f6fea26a0" category="paragraph">此外、MCTB可能无法解决导致以下一系列事件的滚动灾难：</block>
  <block id="93d732b784eaf1a323f191e75c10f233" category="list-text">站点之间的连接中断30秒以上。</block>
  <block id="81d4275cc3534a9fa8cfdcdb5172eb94" category="list-text">SyncMirror复制超时、并且会继续在主站点上执行操作、从而使远程副本过时。</block>
  <block id="44441f68631008a941ce92e985131ff9" category="list-text">主站点丢失。结果是主站点上存在未复制的更改。因此、切换可能不受欢迎、原因有很多、其中包括：</block>
  <block id="499527dd40fad77b119b8b33c99cd614" category="list-text">主站点上可能存在关键数据、这些数据最终可能是可恢复的。允许应用程序继续运行的切换将有效地丢弃这些关键数据。</block>
  <block id="86de4e3737e3d871dacf8ffef353fc31" category="list-text">运行正常的站点上的某个应用程序在站点丢失时使用了主站点上的存储资源、此应用程序可能已缓存数据。切换会导致数据版本过时、与缓存不匹配。</block>
  <block id="dbb2a01afe28c8310daf781bb80b795f" category="list-text">运行正常的站点上的某个操作系统在站点丢失时使用了主站点上的存储资源、此操作系统可能已缓存数据。切换会导致数据版本过时、与缓存不匹配。最安全的方法是、将Tieber4配置为在检测到站点故障时发送警报、然后由某人决定是否强制执行切换。可能需要先关闭应用程序和/或操作系统、才能清除缓存的任何数据。此外、还可以使用NVFAIL设置来添加进一步的保护、并帮助简化故障转移过程。</block>
  <block id="ec6b0ea9c511479c118aa0f028f6519d" category="section-title">使用MetroCluster IP的ONTAP调解器</block>
  <block id="8ada6a626a475d631df231bbb3a88ac9" category="paragraph">ONTAP调解器可与MetroCluster IP和某些其他ONTAP解决方案结合使用。它的功能与上述MetroCluster Tieb破碎 机软件非常相似、但也包括一项关键功能、即执行自动无人值守切换。</block>
  <block id="991d7d7d7388ccdd87c65ca09aa804f2" category="paragraph">光纤连接的MetroCluster可以直接访问相反站点上的存储设备。这样、一个MetroCluster控制器就可以通过从驱动器中读取检测信号数据来监控其他控制器的运行状况。这样、一个控制器就可以识别另一个控制器的故障并执行切换。</block>
  <block id="db2e932a11478bcf14c75d38e8b9a170" category="paragraph">相比之下、MetroCluster IP架构会通过控制器-控制器连接独占路由所有I/O；无法直接访问远程站点上的存储设备。这会限制控制器检测故障和执行切换的能力。因此、需要将ONTAP调解器作为Tieb破碎 机设备来检测站点丢失并自动执行切换。</block>
  <block id="8004e6d63f487a456290225b74768a6c" category="section-title">使用ClusterLion的虚拟第三站点</block>
  <block id="f1d5a7305654a402a719675fbec810e7" category="paragraph">ClusterLion是一种高级MetroCluster监控设备、可充当虚拟第三站点。通过这种方法、可以在双站点配置中安全地部署MetroCluster、并提供完全自动化的切换功能。此外、ClusterLion还可以执行额外的网络级监控并执行切换后操作。完整文档可从ProLion获得。</block>
  <block id="a60b8f728a13371898fea9947ef1e0dc" category="paragraph"><block ref="a60b8f728a13371898fea9947ef1e0dc" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f8aae92ec17ec82868ef9ffc767dbd03" category="list-text">ClusterLion设备可通过直接连接的以太网和串行缆线监控控制器的运行状况。</block>
  <block id="c5f8963a91e3d8e7ac0abda2eab9f17d" category="list-text">这两个设备通过冗余3G无线连接相互连接。</block>
  <block id="24de16a13a1b584832d19117982cbfa6" category="list-text">ONTAP控制器的电源通过内部继电器供电。如果站点发生故障、包含内部UPS系统的ClusterLion会在调用切换之前断开电源连接。此过程可确保不会出现脑裂情况。</block>
  <block id="b2bcd3c3c555e2e4f27d453de4e0f06d" category="list-text">ClusterLion会在30秒SyncMirror超时时间内执行切换、或者根本不执行切换。</block>
  <block id="390fb5f827a3fbcdc7d05e6e7db03223" category="list-text">除非NVRAM和SyncMirror plexes的状态保持同步、否则ClusterLion不会执行切换。</block>
  <block id="f322f850d55e87946f9660e4ccb1bbb6" category="list-text">由于ClusterLion仅在MetroCluster完全同步时执行切换、因此不需要NVFAIL。此配置允许站点范围的环境(例如扩展Oracle RAC)保持联机、即使在计划外切换期间也是如此。</block>
  <block id="5c132e05fb0e306f56955603619de359" category="list-text">支持包括光纤连接MetroCluster和MetroCluster IP</block>
  <block id="86bcf99dbc3944da56f06b48074d09f6" category="doc">正常运行</block>
  <block id="16dd4928055f2caf6f6fb8119ef69bcc" category="paragraph">SM-BC支持两种类型的存储故障转移操作：计划内和计划外、其工作方式略有不同。管理员手动启动计划内故障转移、以便快速切换到远程站点、而计划外故障转移则由第三个站点上的调解器自动启动。计划内故障转移的主要目的是执行增量修补和升级、执行灾难恢复测试或采用一种正式的策略、全年在站点之间切换操作、以证明完全的业务连续性功能。</block>
  <block id="63d4f976530f4faffa1ecd40fe8843f4" category="paragraph">这些图显示了在正常操作、故障转移和故障恢复操作期间发生的情况。为便于说明、它们显示了一个复制的LUN。在实际的SM-BC配置中、复制基于卷、其中每个卷包含一个或多个LUN、但为了简化操作、卷层已被删除。</block>
  <block id="e48472f7daf781b63506f9e296443027" category="paragraph">在正常操作下、可以从本地副本或远程副本访问LUN。红线表示ALOA公布的优化路径、结果应该是会优先沿着此路径发送IO。</block>
  <block id="ef1d805ecb3b65664c42a1d32d8120d5" category="paragraph">绿线是一个活动路径、但它会产生较长的延迟、因为该路径上的IO需要通过SM-BC路径传递。额外的延迟取决于用于SM-BC的站点之间的互连速度。</block>
  <block id="e139a585510a502bbf1841cf589f5086" category="section-title">失败</block>
  <block id="7ed516552b652790c92df0bf237264b2" category="paragraph">如果活动镜像副本因计划内或计划外故障转移而变得不可用、则很明显、它将不再可用。但是、远程系统具有同步副本、并且指向远程站点的SAN路径已存在。远程系统能够为该LUN提供IO服务。</block>
  <block id="89a4933a199f7b0e286c8bcb1606905a" category="paragraph">是否立即使用远程副本取决于SM-BC是在Sync模式还是StrictSync模式下运行。</block>
  <block id="af43c542f512c4f7dc1b137d5de49d40" category="paragraph"><block ref="af43c542f512c4f7dc1b137d5de49d40" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7388404ef116c3ff812bfd290b094d9e" category="section-title">故障转移</block>
  <block id="997dfe060d2107e84407cfb41e692c54" category="paragraph">故障转移会导致远程副本成为活动副本。这些路径将从"Active/Optimized"(活动/优化)更改为"Active/Optimized"(活动/优化)、并且IO将继续提供服务、而不会丢失数据</block>
  <block id="52da4ea35ba60090f331eefab5d6c612" category="paragraph"><block ref="52da4ea35ba60090f331eefab5d6c612" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0493d27e20d11e356e53e0a730b0ad08" category="section-title">修复</block>
  <block id="4f125c91283d9dc1751ad99a7a171420" category="paragraph">源系统恢复使用后、SM-BC可以重新同步复制、但运行另一个方向。现在、配置与起始点基本相同、只是已翻转主动镜像站点。</block>
  <block id="5c647f57a104a05d7d8b55d089efefbe" category="paragraph"><block ref="5c647f57a104a05d7d8b55d089efefbe" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6d80a3efb80520f47b63dc279e1bea3d" category="section-title">故障恢复</block>
  <block id="d47f47372b9b94d274cceb3638b28845" category="paragraph">如果需要、管理员可以执行故障恢复、并将LUN的活动副本移回原始控制器。</block>
  <block id="0c99cedb6f39d8ac16d5b4c01c162c23" category="paragraph">数据库重做/事务日志记录通常会生成未对齐的I/O、此I/O可能会导致发生原因发出有关ONTAP上LUN错位的警告、从而使人产生误解。</block>
  <block id="b2f7bb8e75b21ee3e883141c6ac1defe" category="paragraph">日志记录会使用不同大小的写入顺序写入日志文件。不与4 KB边界对齐的日志写入操作通常不会出现发生原因性能问题、因为下一个日志写入操作会完成块。因此、ONTAP几乎能够将所有写入作为完整的4 KB块进行处理、即使某些4 KB块中的数据是在两个单独的操作中写入的。</block>
  <block id="0e635e1f8ffad809203304cf41ed45c4" category="inline-link-macro">WAFL对齐验证</block>
  <block id="bf837d24f10c904e697e3c0092da43b9" category="paragraph">使用等实用程序验证对齐情况<block ref="40883add63f1fbabc7fe6158f93c1246" prefix=" " category="inline-code"></block> 或<block ref="1aabac6d068eef6a7bad3fdf50a05cc8" prefix=" " category="inline-code"></block> 可以按定义的块大小生成I/O。可以使用查看存储系统上的I/O对齐统计信息<block ref="446501053769c06c565094b26d26e8ef" prefix=" " category="inline-code"></block> 命令：请参见 <block ref="ebccec7997af507c87f985ec4ccec634" category="inline-link-macro-rx"></block> 有关详细信息 ...</block>
  <block id="b5ffbfb0c082804ad41d0f61c87525ed" category="paragraph">许多应用程序数据集都按日期进行组织、随着数据老化、访问这些数据的可能性通常越来越小。例如、银行可能有一个PDF文件存储库、其中包含五年的客户对账单、但只有最近几个月处于活动状态。FabricPool可用于将旧数据文件重新定位到容量层。冷却期为14天、可确保最近14天的PDF文件仍保留在性能层上。此外、至少每14天读取一次的文件将保持热状态、因此仍保留在性能层上。</block>
  <block id="ed7e2cc7ff107d4b2032fe65cf4e756a" category="paragraph">要实施基于文件的分层方法、您必须拥有已写入且随后未修改的文件。。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 策略应设置得足够高、以便可能需要的文件仍保留在性能层上。例如、如果某个数据集需要最近60天的数据且性能最佳、则需要设置<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 期限为60。根据文件访问模式、也可以实现类似的结果。例如、如果需要最近90天的数据、而应用程序正在访问这90天的数据、则数据将保留在性能层上。通过设置<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 从2开始、当数据变得不太活跃后、您会收到分层提示。</block>
  <block id="8a467b35326e4738b1bd39865c3b21a0" category="admonition">任何类型的数据访问都会重置热图数据。病毒扫描、索引编制甚至是读取源文件的备份活动会阻止分层、因为需要分层<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 从未达到阈值。</block>
  <block id="7a1920d61156abc05a60135aefe8bc67" category="doc">Default</block>
  <block id="5ba46d288640832c345e169b04a7458a" category="paragraph">所有FabricPool卷的初始设置为<block ref="c21f969b5f03d33d43e04f8f136e7682" prefix=" " category="inline-code"></block>，这意味着该行为由`云检索策略控制。`具体行为取决于所使用的层策略。</block>
  <block id="5ec354970d7934d92ba67ccaa0de0121" category="list-text"><block ref="9df22f196a33acd0b372fe502de51211" prefix="" category="inline-code"></block>–仅检索随机读取的数据</block>
  <block id="74092cfa5efab8e6ddc5c2991ee2cfc9" category="list-text"><block ref="8805d416ce540c5f2df34af5b18d742b" prefix="" category="inline-code"></block>–检索所有按顺序或随机读取的数据</block>
  <block id="2de036541477f953c6fd33d14a8db0e8" category="list-text"><block ref="334c4a4c42fdb79d7ebc3e73b517e6f8" prefix="" category="inline-code"></block>–检索所有按顺序或随机读取的数据</block>
  <block id="b6ffdb7ccf86e99ecf73899ec23bdd46" category="list-text"><block ref="a181a603769c1f98ad927e7367c7aa51" prefix="" category="inline-code"></block>不从容量层检索数据</block>
  <block id="d556a0d2cad80695d1d803ebb49de9cd" category="section-title">读取时</block>
  <block id="7c39eb141ca855e5a211b468bd67636c" category="paragraph">正在设置 ...<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> 到读取时会覆盖默认行为、因此读取任何分层数据都会将该数据返回到性能层。</block>
  <block id="e07df43ea07fecb178484ef278644eb2" category="paragraph">例如、某个卷在下可能已长时间使用不多<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 分层策略和大多数块现在已分层。</block>
  <block id="98c8614a9e0467f220df33a02cf7550a" category="paragraph">如果业务需求发生意外变化、需要重复扫描某些数据以准备特定报告、则可能需要更改<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> to<block ref="0ba0dc933ac714a0bef4467360437336" prefix=" " category="inline-code"></block> 以确保读取的所有数据(包括按顺序读取的数据和随机读取的数据)都返回到性能层。这样可以提高卷的顺序I/O性能。</block>
  <block id="3ea4ba4aadef21fbda74c9b242c99efa" category="section-title">提升</block>
  <block id="cb674c0cbcbaa23bdd3c8e4f6182f865" category="paragraph">提升策略的行为取决于层策略。如果此层策略为<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block>，然后设置<block ref="723c2b1883eb9949dd821267c2d1b5c7" prefix=" " category="inline-code"></block> 在下次分层扫描时从容量层恢复所有块。</block>
  <block id="452d85cc34fd3a4cf55ac61e732239f4" category="paragraph">如果此层策略为<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block>，则返回的唯一块是与活动文件系统关联的块。通常、这不会产生任何影响、因为只有数据块在下进行了分层<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 策略将是专门与快照关联的块。活动文件系统中不会存在分层块。</block>
  <block id="d6269fb1a970b6c261fedbc79464b3dc" category="paragraph">但是、如果卷上的数据是通过卷SnapRestore或文件克隆操作从快照还原的、则活动文件系统现在可能需要一些因仅与快照关联而分层出的块。可能需要临时更改<block ref="d253e682212338dd6cbe577947f0511e" prefix=" " category="inline-code"></block> 策略为<block ref="eeefc0add5ccd6e20ac4214923d27fbc" prefix=" " category="inline-code"></block> 以快速检索所有本地所需的块。</block>
  <block id="6e7b34fa59e1bd229b207892956dc41c" category="section-title">从不</block>
  <block id="c45e30a0f86af155e2feb17dd7ba6e44" category="paragraph">请勿从容量层检索块。</block>
  <block id="2d242bb36ec91b32005f9296ff03a912" category="doc">架构</block>
  <block id="ac30d4a74ecef302adab70e9669a4bf2" category="paragraph">FabricPool是一种分层技术、可将块分为热块或冷块、并将其放置在最合适的存储层中。性能层通常位于SSD存储上、并托管热数据块。容量层位于对象存储上、用于托管超酷数据块。对象存储支持包括NetApp StorageGRID、ONTAP S3、Microsoft Azure Blot存储、阿里云对象存储服务、IBM云对象存储、Google云存储和Amazon AWS S3。</block>
  <block id="f9f5fe2f7456d37c955f3291744c93b6" category="paragraph">可以使用多个分层策略来控制块的分类方式、这些策略可以按卷设置、也可以根据需要进行更改。在性能层和容量层之间仅移动数据块。定义LUN和文件系统结构的元数据始终保留在性能层上。因此、可在ONTAP上集中管理。文件和LUN的显示与任何其他ONTAP配置中存储的数据没有任何不同。NetApp AFF或FAS控制器会应用定义的策略将数据移动到相应的层。</block>
  <block id="156a1cf692c4ba9a4f9574fb16428b01" category="paragraph"><block ref="156a1cf692c4ba9a4f9574fb16428b01" category="inline-image-macro-rx" type="image"></block></block>
  <block id="616ce0475334fe37834d13972a168ca5" category="section-title">对象存储提供程序</block>
  <block id="71e79501cc067e6b35ac3d3e97c940a4" category="paragraph">对象存储协议使用简单的HTTP或HTTPS请求来存储大量数据对象。对对象存储的访问必须可靠、因为从ONTAP进行数据访问取决于请求的及时处理。选项包括Amazon S3 Standard和Infrequent Access选项、以及Microsoft Azure Hot and Cool Blot Storage、IBM Cloud和Google Cloud。不支持Amazon Glacier和Amazon Archive等归档选项、因为检索数据所需的时间可能会超出主机操作系统和应用程序的容错范围。</block>
  <block id="e114e830308285cd9085063fad91662c" category="paragraph">NetApp StorageGRID也受支持、是最佳的企业级解决方案。它是一个高性能、可扩展且高度安全的对象存储系统、可以为FabricPool数据以及越来越可能成为企业应用程序环境一部分的其他对象存储应用程序提供地理冗余。</block>
  <block id="fb318c5cd9ed18c79e1f7a298dd96665" category="paragraph">StorageGRID还可以通过避免许多公有云提供商为从其服务中读取数据而收取的传出费用来降低成本。</block>
  <block id="119d8a1213b5b7cae4bb567153b028cf" category="section-title">数据和元数据</block>
  <block id="b59d6123a3191bd85fe14e57b7a01e11" category="paragraph">请注意、此处的术语"数据"适用场景是指实际数据块、而不是元数据。仅对数据块进行分层、而元数据保留在性能层中。此外、只有读取实际数据块时、数据块的状态才会受到热或冷的影响。仅读取文件的名称、时间戳或所有权元数据并不会影响底层数据块的位置。</block>
  <block id="1414cdc093d39dd56d0b0d20049e17fc" category="section-title">备份</block>
  <block id="e0b766a7a0a7633679ecddd0f78a7390" category="paragraph">虽然FabricPool可以显著减少存储占用空间、但它本身并不是一个备份解决方案。NetApp WAFL元数据始终保留在性能层上。如果灾难性灾难破坏了性能层、则无法使用容量层上的数据创建新环境、因为该环境不包含WAFL元数据。</block>
  <block id="7a25ce12890e524732cb71784b5915ab" category="paragraph">但是、FabricPool可以成为备份策略的一部分。例如、可以为FabricPool配置NetApp SnapMirror复制技术。镜像的每一半都可以与对象存储目标建立自己的连接。结果是生成两个独立的数据副本。主副本由性能层上的块以及容量层中的关联块组成、副本是第二组性能和容量块。</block>
  <block id="82af841589057aa8922b1ac3bb4a28a4" category="doc">压缩</block>
  <block id="e242ff0701d9ed7d8317b32fd762a100" category="paragraph">数据压缩、数据缩减和重复数据删除等空间效率功能旨在增加给定物理存储量所需的逻辑数据量。这样可以降低成本和管理开销。</block>
  <block id="13b992c3d358d786db03341886472c4f" category="paragraph">从较高层面来看、数据压缩是一个数学过程、通过该过程、可以检测数据模式并对其进行编码、从而减少空间需求。相反、重复数据删除会检测实际重复的数据块并删除无关的副本。数据缩减允许多个逻辑数据块共享介质上的同一物理块。</block>
  <block id="786d7cc1b18aa3d9c3e8d3e30865240e" category="paragraph">在全闪存存储系统推出之前、基于阵列的数据压缩的价值有限、因为大多数I/O密集型工作负载都需要大量磁盘轴才能提供可接受的性能。由于驱动器数量众多、存储系统所含容量总是远远超出所需容量。随着固态存储的兴起、这种情况发生了变化。不再需要纯粹为了获得良好的性能而大量过度配置驱动器。存储系统中的驱动器空间可以与实际容量需求相匹配。</block>
  <block id="b207c460d31fea9e1cfab71057e8152c" category="paragraph">与旋转驱动器相比、固态驱动器(SSD)的IOPS功能提高几乎始终可以节省成本、但数据压缩可以通过增加固态介质的有效容量来进一步节省成本。</block>
  <block id="bd6c983943da8bf0ead08c643f0e75f3" category="paragraph">数据压缩方法有多种。许多数据库都具有自己的数据压缩功能、但在客户环境中很少出现这种情况。原因通常是对压缩数据进行*更改*会对性能造成影响、而且许可成本往往很高。最后、还会对数据库操作产生整体性能影响。为执行数据压缩和解压缩的CPU支付较高的每CPU许可证成本毫无意义、而不是实际的数据库工作。更好的选择是将压缩工作负载分流到存储系统。</block>
  <block id="6296c8b7406b90d37edf269f1ea6f6ee" category="section-title">自适应数据压缩</block>
  <block id="1245fef302b5da2c27766d9a98ad358c" category="paragraph">自适应数据压缩已针对企业级工作负载进行了全面测试、未观察到对性能的影响、即使在延迟以微秒为单位的全闪存环境中也是如此。一些客户甚至报告说、使用数据压缩后性能会提高、因为数据会在缓存中保持压缩状态、从而有效地增加了控制器中的可用缓存量。</block>
  <block id="93e0a644c8f1b7f7f378bc071d15d1e9" category="paragraph">ONTAP以4 KB为单位管理物理块。自适应数据压缩使用默认的压缩块大小8 KB、这意味着数据以8 KB单位进行压缩。这与关系数据库最常使用的8 KB块大小匹配。随着将更多数据作为一个单元进行压缩、数据压缩算法的效率也会提高。32 KB压缩块大小比8 KB压缩块单元更节省空间。这确实意味着、使用默认8 KB块大小的自适应数据压缩确实会使效率率略低、但使用更小的数据压缩块大小也会有显著优势。数据库工作负载包含大量覆盖活动。要覆盖经过压缩的32 KB数据块中的8 KB、需要回读整个32 KB逻辑数据、对其进行解压缩、更新所需的8 KB区域、重新压缩、然后将整个32 KB写入驱动器。这对存储系统来说是一项非常昂贵的操作、因此、某些基于较大压缩块大小的竞争存储阵列也会对数据库工作负载的性能造成严重影响。</block>
  <block id="096cc7f8e7e1861c3ee0269a90fc27e3" category="admonition">自适应数据压缩使用的块大小最多可以增加到32 KB。这可能会提高存储效率、如果阵列上存储了大量的此类数据、则对于归档日志和备份文件等不会影响存储效率的文件、应考虑使用此方法。在某些情况下、使用16 KB或32 KB块大小的活动数据库也可以通过增加要匹配的自适应数据压缩的块大小来受益。请咨询NetApp或合作伙伴代表、了解这是否适合您的工作负载。</block>
  <block id="f291779c724993ded5e79421d88f3e55" category="admonition">在流式备份目标上、不应同时使用大于8 KB的数据压缩块大小和重复数据删除。原因是、对备份的数据所做的微小更改会影响32 KB数据压缩窗口。如果窗口发生变化、则生成的压缩数据会在整个文件中有所不同。重复数据删除在数据压缩后进行、这意味着重复数据删除引擎对每个压缩备份的看法不同。如果需要对流式备份(例如Oracle RMAN)进行重复数据删除、则只应使用8 KB块自适应数据压缩。最好使用自适应数据压缩、因为它的块大小较小、不会影响重复数据删除的效率。出于类似的原因、主机端压缩也会影响重复数据删除效率。</block>
  <block id="1f9367b7afff301ee24188d35050ae0a" category="section-title">对温度敏感的存储效率</block>
  <block id="78aa8c12abb3bf9f61a08df0f9b403de" category="paragraph">温度敏感型存储效率(TSSE)在ONTAP 9.8及更高版本中提供、它依靠块访问热图来识别不常访问的块并以更高的效率对其进行压缩。</block>
  <block id="02e44d620def629a6c145ccd0d9a0fd3" category="section-title">数据压缩对齐</block>
  <block id="3b6e6c232a02ab9c64199eb9efae012c" category="paragraph">数据库环境中的自适应数据压缩需要在一定程度上考虑数据压缩块对齐问题。对于随机覆盖非常特定的块的数据来说、这样做只是一个问题。这种方法在概念上类似于整体文件系统对齐、即文件系统的起点必须与4 k设备边界对齐、文件系统的块大小必须是4 k的倍数。</block>
  <block id="327a36f7ca539411197c2f867b501719" category="paragraph">例如、只有当8 KB写入文件与文件系统本身内的8 KB边界对齐时、才会对其进行压缩。这一点意味着它必须位于文件的前8 KB、文件的后8 KB、依此类推。RMAN备份或归档日志等数据是跨多个块按顺序写入的操作、所有这些块都会进行压缩。因此、无需考虑对齐。唯一关注的I/O模式是随机覆盖文件。</block>
  <block id="1d1a594959ec615f56516f5d0f5e8ddb" category="section-title">NFS</block>
  <block id="8dae8f7054353dae17cd9da8deb0e091" category="paragraph">使用NFS时、文件I/O会对齐。文件的每个块都会相对于文件开头对齐。</block>
  <block id="62a0282d39568be094470486eaf70c4f" category="section-title">SAN</block>
  <block id="b0762e9957c8485f911e57bfd027eddb" category="paragraph">SAN环境要求数据与8 KB边界对齐、以实现最佳数据压缩。SAN对齐有两个方面：LUN和文件系统。LUN必须配置为整个驱动器设备(无分区)或与8 KB边界对齐的分区。</block>
  <block id="ad16b6d5634739ef4ceb795c5beea659" category="admonition">有关数据压缩与预留百分比之间交互的说明、请参见有关精简配置的章节。</block>
  <block id="14c3c56ff2a98d1a9c47b63a917f67a3" category="section-title">数据缩减</block>
  <block id="546168bb7b68da66be7b6c0e60a23460" category="paragraph">数据缩减是ONTAP中推出的一项技术、可提高数据压缩效率。如前文所述、自适应数据压缩本身最多可节省2：1的空间、因为它仅限于在4 KB WAFL块中存储8 KB I/O。块大小越大、压缩方法的效率越高。但是、它们不适用于受到小块覆盖的数据。解压缩32 KB数据单元、更新8 KB部分、重新压缩以及回写驱动器会产生开销。</block>
  <block id="0b01f66d49b9df153ee76048de44f6eb" category="paragraph">数据缩减的工作原理是、允许将多个逻辑块存储在物理块中。例如、具有高度可压缩数据(例如文本或部分全满块)的数据库可以从8 KB压缩到1 KB。如果不进行数据缩减、这1 KB的数据仍会占用整个4 KB块。实时数据缩减允许将1 KB的压缩数据与其他压缩数据一起存储在仅1 KB的物理空间中。它不是一种压缩技术；它只是一种在驱动器上分配空间的更高效的方式、因此不会产生任何可检测的性能影响。</block>
  <block id="07b153ed9b6a6f9f334f2ad1fe94651e" category="paragraph">节省的资金数额各不相同。已压缩或加密的数据通常无法进一步压缩、因此、数据集无法从数据缩减中受益。新初始化的Oracle数据文件包含的块元数据和零数略多于块元数据和零、数据压缩率高达80：1。这创造了极其广泛的可能性。</block>
  <block id="83f45cad5e6f535ff10e564a526baad0" category="section-title">重复数据删除</block>
  <block id="f591ef30da06841378ee7f595e63a93c" category="paragraph">重复数据删除是指从数据集中删除重复的块大小。例如、如果10个不同文件中存在相同的4 KB块、则重复数据删除会将所有10个文件中的4 KB块重定向到相同的4 KB物理块。结果是、这些数据的效率将提高10：1。</block>
  <block id="699c85c5df1985b2af588f9e6c1ad353" category="paragraph">VMware子系统启动LUN等数据的重复数据删除效果通常非常好、因为它们包含同一操作系统文件的多个副本。我们观察到的效率为100：1甚至更高。</block>
  <block id="c3ed34b88ac0b8efff210a99f19a4b9b" category="paragraph">某些数据不包含重复数据。例如、Oracle块包含数据库全局唯一的标头和几乎唯一的尾部。因此、对Oracle数据库进行重复数据删除很少能节省超过1%的空间。</block>
  <block id="9653a3d4907877aae00bb7d39eeec66d" category="paragraph">在少数情况下、使用16 KB和大型块的数据库可节省多达15%的空间。每个块的初始4 KB包含全局唯一标头、而最后4 KB块包含接近唯一的尾部。内部块是重复数据删除的候选数据、但实际上、这几乎完全是由于对置零数据进行重复数据删除。</block>
  <block id="89d6ec0df0a54d3cdcc8f0573a6b37c5" category="paragraph">许多争用资源的阵列都声称、基于数据库被复制多次的假设、可以对Oracle数据库进行重复数据删除。在这方面、也可以使用NetApp重复数据删除、但ONTAP提供了一个更好的选择：NetApp FlexClone技术。最终结果是相同的；会为一个Oracle数据库创建多个副本、这些副本共享大多数底层物理块。与花时间复制数据文件并对其进行重复数据删除相比、使用FlexClone的效率要高得多。实际上、它是无重复数据删除、而不是重复数据删除、因为从一开始就不会创建重复数据。</block>
  <block id="32aeb47267cb2045610b468115f3ae0e" category="section-title">效率和精简配置</block>
  <block id="3381946611f34fb44ad8a38a0c44e0a8" category="paragraph">效率功能是精简配置的一种形式。例如、占用100 GB卷的100 GB LUN可能会压缩到50 GB。由于卷仍为100 GB、因此尚未实现实际节省。必须先减小卷大小、以便节省的空间可用于系统上的其他位置。如果稍后更改100 GB LUN会导致数据的可压缩性降低、则LUN大小会增大、卷可能会填满。</block>
  <block id="20132d08f816a6401f40a29feb68df8d" category="paragraph">强烈建议使用精简配置、因为它可以简化管理、同时显著提高可用容量并节省相关成本。原因很简单—Oracle环境通常包含大量空空间、大量卷和LUN以及可压缩数据。厚配置会为卷和LUN预留存储空间、以防它们最终达到100%全满并包含100%不可压缩数据。这种情况不大可能发生。通过精简配置、可以回收这些空间并将其用于其他位置、并可以基于存储系统本身进行容量管理、而不是基于许多较小的卷和LUN。</block>
  <block id="38ef8b6f2fc332958c293d93c61d7756" category="paragraph">有些客户更喜欢对特定工作负载使用厚配置、或者通常根据既定的运营和采购实践使用厚配置。</block>
  <block id="f8ea8eaa5ca0e58c6a43ec0117b7bd8d" category="paragraph">*注意：*如果卷配置厚配置、则必须小心操作、以便完全禁用该卷的所有效率功能、包括使用解压缩和删除重复数据删除<block ref="3cfeff511a11b8c5f54ce9749a719a58" prefix=" " category="inline-code"></block> 命令：此卷不应显示在中<block ref="df899f2d908ec33afe1d01ee26b3dd47" prefix=" " category="inline-code"></block> 输出。如果配置了效率功能、则仍会为卷部分配置效率功能。因此、覆盖保证的工作方式有所不同、这会增加配置忽略发生原因卷以意外用尽空间的可能性、从而导致数据库I/O错误。</block>
  <block id="0e7c78164adb6d4650ea685a79d8e99e" category="section-title">效率最佳实践</block>
  <block id="d67dd6ae62908b7781805cf297fa8d87" category="paragraph">NetApp针对ONTAP 9及更高版本提供了以下建议。对于ONTAP 9之前的ONTAP版本、请联系您的NetApp代表。</block>
  <block id="ec499ad25fa5a765ba43ec2c87819623" category="section-title">AFF默认值</block>
  <block id="38b7d52fb2d518d07c1c857b20ebbbd2" category="paragraph">在纯闪存AFF系统上运行的ONTAP上创建的卷经过精简配置、并启用了所有实时效率功能。尽管Oracle数据库通常不会从重复数据删除中受益、并且可能包含不可压缩的数据、但默认设置适用于几乎所有工作负载。ONTAP旨在高效处理所有类型的数据和I/O模式、无论它们是否可节省空间。只有在完全了解原因且有优势的情况下、才应更改默认值。</block>
  <block id="9f7127e69d50bf7b844ff3723b86fbd1" category="section-title">一般建议</block>
  <block id="2c24e4751310e03f119a4df187a3bc08" category="list-text">如果卷和(或) LUN未进行精简配置、则必须禁用所有效率设置、因为使用这些功能不会节省空间、而将厚配置与已启用空间效率相结合会发生原因发生意外行为、包括空间不足错误。</block>
  <block id="4922fe547c351d6a121465da036d478e" category="list-text">如果数据不会被覆盖(例如使用备份或数据库事务日志)、则可以通过在较低的冷却期启用TSSE来提高效率。</block>
  <block id="e75fd383e4106eb78482b18896975daf" category="list-text">某些文件可能包含大量不可压缩数据、例如、在应用程序级别已启用数据压缩时、文件已加密。如果出现上述任一情况、请考虑禁用数据压缩、以便在包含可压缩数据的其他卷上执行更高效的操作。</block>
  <block id="11845fef1d21077d7b23ce880868b556" category="list-text">不要在数据库备份中同时使用32 KB数据压缩和重复数据删除。请参阅""部分<block ref="57ee2712afc5e59236f86db0537b05dc" category="inline-xref-macro-rx"></block>""以了解详细信息。</block>
  <block id="64d5def835c194cac8afe4fafded756e" category="doc">Policies—本地快照</block>
  <block id="baa596d0db91317fa83739a95649752e" category="paragraph">FabricPool的初始版本针对备份用例。唯一可以分层的块类型是不再与活动文件系统中的数据关联的块。因此、只能将快照数据块移至容量层。当您需要确保性能不会受到影响时、这仍然是最安全的一种层选项。</block>
  <block id="b21eb7f0b67c3e27e915183638bf92cf" category="paragraph">可通过两种方法将非活动快照块分层到容量层。首先是<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 策略仅针对快照块。虽然<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略包括<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 块、它还会对活动文件系统中的块进行分层。这可能并不可取。</block>
  <block id="eeba990304f236b36a9fec2434c77470" category="paragraph">。<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 值应设置为一个时间段、以便在性能层上提供还原期间可能需要的数据。例如、关键生产数据库的大多数还原方案都包括前几天某个时间的还原点。设置A<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 值为3可确保对文件进行任何还原都能使文件立即实现最高性能。活动文件中的所有块仍位于快速存储上、而无需从容量层中恢复。</block>
  <block id="baf531ed01ad56f5614e1a68e8a2e7aa" category="section-title">Policies—复制的快照</block>
  <block id="27e5121a4c75181022e7be2b738339d0" category="paragraph">使用SnapMirror或SnapVault复制的快照仅用于恢复、通常应使用FabricPool<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 策略。使用此策略、可以复制元数据、但所有数据块都会立即发送到容量层、从而实现最高性能。大多数恢复过程都涉及顺序I/O、这本身就很高效。应评估从对象存储目标恢复的时间、但在设计完善的架构中、此恢复过程不需要比从本地数据恢复明显慢。</block>
  <block id="639e481de0ffe002bd83251b26a2540a" category="paragraph">如果复制的数据也要用于克隆、则<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略更合适、使用<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 包含预计在克隆环境中定期使用的数据的价值。例如、数据库的活动工作集可能包括前三天读取或写入的数据、但也可能包括另外6个月的历史数据。如果是、则<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> SnapMirror目标上的策略可使工作集在性能层上可用。</block>
  <block id="ace0bd0c1be3a9e17d9736d93e7a1da2" category="doc">IOPS QoS</block>
  <block id="786ee59e0cdaa09335e12fea3a168653" category="paragraph">具体而言、随着全闪存存储的采用率不断提高、工作负载得以整合。由于旧旋转驱动器技术的IOPS功能有限、依赖旋转介质的存储阵列往往仅支持数量有限的I/O密集型工作负载。早在存储控制器达到其限制之前、一两个高度活跃的数据库就会使底层驱动器饱和。这种情况已经改变。即使是功能最强大的存储控制器、数量相对较少的SSD驱动器的性能也可能会饱和。这意味着、可以充分利用控制器的全部功能、而不必担心随着旋转介质延迟峰值而导致性能突然崩溃。</block>
  <block id="270d79669200ef485add1ecc1833cc94" category="paragraph">作为一个参考示例、一个简单的双节点HA AFF A800系统能够在延迟超过1秒之前提供高达100万次随机IOPS。只有极少数单个工作负载才能达到此级别。要充分利用此AFF A800系统阵列、需要托管多个工作负载、而安全地执行此操作、同时确保可预测性、则需要QoS控制。</block>
  <block id="4dca0c3547523a2e5bd1b8d0e2ff8de5" category="paragraph">ONTAP中有两种类型的服务质量(QoS)：IOPS和带宽。QoS控制可应用于SVM、卷、LUN和文件。</block>
  <block id="3ea539ed2021ba46a3658039e8af419f" category="paragraph">IOPS QoS控制显然基于给定资源的总IOPS、但IOPS QoS的许多方面可能并不直观。最初、一些客户对达到IOPS阈值时延迟明显增加感到很不明白。限制IOPS自然会导致延迟增加。从逻辑上讲、它的功能类似于令牌系统。例如、如果包含数据文件的给定卷具有10000 IOPS限制、则到达的每个I/O都必须先接收令牌才能继续处理。只要在给定的一秒内使用的令牌不超过10000个、就不会出现延迟。如果IO操作必须等待接收其令牌、则此等待将显示为额外的延迟。工作负载越难超过QoS限制、每个IO在队列中等待处理的时间就越长、这在用户看来是延迟越高。</block>
  <block id="34a96885dd7f4501920b13026e7f2cab" category="admonition">对数据库事务/重做日志数据应用QoS控制时要小心。虽然重做日志记录的性能需求通常要比数据文件低很多、但重做日志活动会变得突发。IO会以短暂的脉冲发生、并且似乎适合平均重做IO级别的QoS限制对于实际要求可能过低。结果可能会造成严重的性能限制、因为QoS会与每个重做日志突发事件结合使用。通常、重做和归档日志记录不应受QoS的限制。</block>
  <block id="c79dc76371299e08f4b4ebd609314ca4" category="section-title">带宽QoS</block>
  <block id="b9d5c520039715de9b997c5a69f4aeaa" category="paragraph">并非所有I/O大小都相同。例如、数据库可能会执行大量小块读取、从而导致达到IOPS阈值、 但是、数据库可能还会执行完整的表扫描操作、其中包含非常少量的大型块读取、占用的带宽非常大、但IOPS相对较少。</block>
  <block id="4930ae83bb8dd5e539dc9f7e73c6d74c" category="paragraph">同样、VMware环境可能会在启动期间产生大量随机IOPS、但在外部备份期间执行的IO会更少、但会更大。</block>
  <block id="eabb5a523a77d4521c12622ee9388aa6" category="paragraph">有时、有效管理性能需要IOPS或带宽QoS限制、甚至两者都需要。</block>
  <block id="13dac55a5f26cefab26368ea5a67e29f" category="section-title">最低/有保障的QoS</block>
  <block id="68559688130772c84bb39b2a9ca2c2af" category="paragraph">许多客户都希望解决方案能够提供有保障的QoS、而这种服务质量比看起来更难实现、而且可能会造成大量浪费。例如、如果要将10个数据库放置在10000 IOPS保证下、则需要对系统进行规模估算、以应对所有10个数据库同时以10000 IOPS运行的情形、总共需要100K IOPS。</block>
  <block id="c0938f706c890ea85c86388391ffad22" category="paragraph">最低QoS控制的最佳用途是保护关键工作负载。例如、假设一个ONTAP控制器的最大可能IOPS为50万次、并混合了生产和开发工作负载。您应将最大QoS策略应用于开发工作负载、以防止任何给定数据库独占控制器。然后、您可以对生产工作负载应用最低QoS策略、以确保它们在需要时始终具有所需的可用IOPS。</block>
  <block id="acdda1c20fb3985ce840929f7525c803" category="section-title">自适应 QoS</block>
  <block id="dd5bc58ed6ab031b170a409470d9a763" category="paragraph">自适应服务质量(QoS)是指ONTAP功能、其中服务质量(QoS)限制基于存储对象的容量。它很少用于数据库、因为数据库大小与其性能要求之间通常没有任何关联。大型数据库可能几乎处于无活动状态、而小型数据库则可能是IOPS密集型最高的数据库。</block>
  <block id="eb595833577352045f92d14ac4315ad2" category="paragraph">自适应QoS对于虚拟化数据存储库非常有用、因为此类数据集的IOPS要求往往与数据库的总大小相关。包含1 TB VMDK文件的较新数据存储库所需的性能可能是2 TB数据存储库的一半左右。自适应QoS允许您在数据存储库中填充数据时自动增加QoS限制。</block>
  <block id="23f3d415bb4fe6f99165df604b24da0e" category="paragraph">使用FabricPool对数据集进行分层会导致主存储阵列与对象存储层之间存在依赖关系。有许多对象存储选项可提供不同级别的可用性。请务必了解主存储阵列与对象存储层之间可能断开连接的影响。</block>
  <block id="7e856c11a853d276fd5d6274bf60fafd" category="paragraph">如果向ONTAP发出的I/O需要容量层中的数据、而ONTAP无法访问容量层来检索块、则此I/O最终会超时。此超时的影响取决于所使用的协议。在NFS环境中、ONTAP会根据协议使用EjUKEBOX或EDELAY响应进行响应。某些较早的操作系统可能会将此错误视为错误、但Oracle Direct NFS客户端的当前操作系统和当前修补程序级别会将此错误视为可检取的错误、并继续等待I/O完成。</block>
  <block id="207d9fe0f57910936bfa043248f3afca" category="paragraph">适用场景SAN环境超时时间更短。如果对象存储环境中需要某个块、但该块在两分钟内仍不可访问、则会向主机返回读取错误。ONTAP卷和LUN会保持联机、但主机操作系统可能会将文件系统标记为处于错误状态。</block>
  <block id="c9251835da8df507ca4f6ce02d4216be" category="paragraph">对象存储连接问题<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 策略不太值得关注、因为只有备份数据是分层的。通信问题会使数据恢复速度变慢、但不会影响正在使用的数据。。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 和<block ref="a181a603769c1f98ad927e7367c7aa51" prefix=" " category="inline-code"></block> 策略允许对活动LUN中的冷数据进行分层、这意味着对象存储数据检索期间出现错误可能会影响数据库可用性。采用这些策略的SAN部署只能与专为实现高可用性而设计的企业级对象存储和网络连接结合使用。NetApp StorageGRID是一个更好的选择。</block>
  <block id="0f8062f9220efe4f38e7236fe8885379" category="paragraph">大多数关系数据库都在事务日志归档模式下运行、以提供时间点恢复。通过记录事务日志中的更改来提交对数据库的更改、事务日志将保留而不被覆盖。因此、可能需要保留大量归档事务日志。许多其他应用程序工作流也存在类似的例子、这些工作流生成的数据必须保留、但极不可能被访问。</block>
  <block id="229384bbfb1db19c4897d87ba4b9bc2d" category="paragraph">FabricPool通过提供具有集成层的单个解决方案解决了这些问题。文件会存储在通常的位置并始终可访问、但在主阵列上几乎不会占用任何空间。</block>
  <block id="f60aec7aaed8420e09f17a8cfd1d7d37" category="paragraph">使用<block ref="e5e88684921dd21f3f86c28343a3082f" prefix=" " category="inline-code"></block> 如果策略设置为几天、则会在性能层上保留最近创建的文件(即近期最可能需要的文件)中的块。然后、旧文件中的数据块将移至容量层。</block>
  <block id="485e24df9e0ebeecf416daa6e5441bba" category="paragraph">。<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 在达到冷却阈值时强制执行提示分层、而不管日志是已删除还是仍位于主文件系统中。将所有可能需要的日志存储在活动文件系统中的一个位置也可以简化管理。没有理由通过搜索快照来查找需要还原的文件。</block>
  <block id="bbe0132696bc482e0ba7a1f293d80083" category="paragraph">某些应用程序(如Microsoft SQL Server)会在备份操作期间会对事务日志文件进行节段、以便日志不再位于活动文件系统中。可以使用节省容量<block ref="8805d416ce540c5f2df34af5b18d742b" prefix=" " category="inline-code"></block> 分层策略、但<block ref="9df22f196a33acd0b372fe502de51211" prefix=" " category="inline-code"></block> 策略对日志数据没有用处、因为活动文件系统中的日志数据很少会冷却下来。</block>
  <block id="0694b4972669f201ca85f9427a230208" category="doc">MetroCluster可用于3种不同的配置</block>
  <block id="948676ffa8073153cbe404795950ad85" category="list-text">具有IP连接的HA对</block>
  <block id="ef012b81fd45a95681a584a59f8df77e" category="list-text">具有FC连接的HA对</block>
  <block id="6ffec869ba36dff4e093b5ed8bac798a" category="list-text">具有FC连接的单个控制器</block>
  <block id="6fa7041982bed9488213a7bd2ecccfdf" category="paragraph">[注意]术语"连接"是指用于跨站点复制的集群连接。它不是指主机协议。无论用于集群间通信的连接类型如何、MetroCluster配置均支持所有主机端协议。</block>
  <block id="4767099b22895a8101a1cba45d8cf6e9" category="section-title">MetroCluster IP</block>
  <block id="adc397d87c1a7827f2df9fdd362d5ff7" category="paragraph">HA对MetroCluster IP配置会在每个站点上使用两个或四个节点。与双节点选项相比、此配置选项会增加复杂性和成本、但它具有一个重要优势：站点内冗余。简单的控制器故障不需要通过WAN访问数据。数据访问仍通过备用本地控制器保持在本地。</block>
  <block id="c15560f2ae5432223c591c5f5d9db5c1" category="paragraph">大多数客户选择IP连接是因为基础架构要求更简单。过去、使用暗光纤和FC交换机配置高速跨站点连接通常比较容易、但如今、高速、低延迟IP电路更容易获得。</block>
  <block id="b28c5a429800ea9669a191a402a72b49" category="paragraph">此外、该架构也更加简单、因为只有跨站点连接用于控制器。在FC SAN连接的MetroCluster中、控制器会直接写入另一站点上的驱动器、因此需要更多的SAN连接、交换机和网桥。相反、IP配置中的控制器会通过控制器写入相对的驱动器。</block>
  <block id="457b0075e8f0333975a8e2aaeaceb149" category="inline-link">MetroCluster IP 解决方案架构和设计</block>
  <block id="82aa44c8aa5ebe78f1496c8fc80cb954" category="paragraph">对于追加信息、请参阅ONTAP官方文档和<block ref="03a3c76178d2d43147a2756857a0985e" category="inline-link-rx"></block>。</block>
  <block id="68cf128ce140240c63e9a47e2a82a333" category="paragraph"><block ref="68cf128ce140240c63e9a47e2a82a333" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0d2d438a72f6c558744351265fa49a62" category="section-title">HA对FC SAN连接的MetroCluster</block>
  <block id="3e9133ff590581b29a911d9631ab1737" category="paragraph">HA对MetroCluster FC配置会在每个站点上使用两个或四个节点。与双节点选项相比、此配置选项会增加复杂性和成本、但它具有一个重要优势：站点内冗余。简单的控制器故障不需要通过WAN访问数据。数据访问仍通过备用本地控制器保持在本地。</block>
  <block id="7ea740801794ba8a2ce3f87db010c319" category="paragraph"><block ref="7ea740801794ba8a2ce3f87db010c319" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4bc2926f030255369db3e4435de5c774" category="paragraph">某些多站点基础架构不是为主动-主动操作而设计的、而是更多地用作主站点和灾难恢复站点。在这种情况下、通常最好使用HA对MetroCluster选项、原因如下：</block>
  <block id="5f49f48dd22b405a813e2ef7cc02e9f8" category="list-text">尽管双节点MetroCluster集群是一个HA系统、但控制器意外故障或计划内维护要求数据服务必须在相反站点联机。如果站点之间的网络连接无法支持所需的带宽、则性能会受到影响。唯一的选择是同时将各种主机操作系统和相关服务故障转移到备用站点。HA对MetroCluster集群可消除此问题、因为丢失控制器会导致在同一站点内进行简单的故障转移。</block>
  <block id="0ce798a4f2e77d6aa1a6e0d718fa8e98" category="list-text">某些网络拓扑不是为跨站点访问而设计的、而是使用不同的子网或隔离的FC SAN。在这些情况下、双节点MetroCluster集群将不再充当HA系统、因为备用控制器无法向对面站点上的服务器提供数据。要提供完全冗余、需要使用高可用性对MetroCluster选项。</block>
  <block id="098fa44ef37572e0f8ea717199ac72e6" category="list-text">如果将双站点基础架构视为一个高可用性基础架构、则适合使用双节点MetroCluster配置。但是、如果系统在站点发生故障后必须长时间运行、则首选HA对、因为它会继续在单个站点中提供HA。</block>
  <block id="ea8bb3e5a357ca97851352f6944342c9" category="section-title">双节点FC SAN连接MetroCluster</block>
  <block id="b759079fef92c80eca80e7349bf84363" category="paragraph">双节点MetroCluster配置仅为每个站点使用一个节点。这种设计比HA对选项更简单、因为需要配置和维护的组件更少。此外、它还降低了布线和FC交换方面的基础架构需求。最后、它还可以降低成本。</block>
  <block id="5bfcbf762ac959212294cdf71bbec2b5" category="paragraph"><block ref="5bfcbf762ac959212294cdf71bbec2b5" category="inline-image-macro-rx" type="image"></block></block>
  <block id="bcf549481eb36a62594e938bca6a10bb" category="paragraph">这种设计的明显影响是、单个站点上的控制器故障意味着数据可以从另一个站点访问。这种限制不一定是问题。许多企业都拥有多站点数据中心运营、并采用延伸型高速低延迟网络、这些网络本质上充当一个基础架构。在这些情况下、首选配置是双节点版本的MetroCluster。目前、多家服务提供商以PB级的规模使用双节点系统。</block>
  <block id="78558542e724655ba80fc4879399f103" category="section-title">MetroCluster故障恢复能力功能</block>
  <block id="5427d2eb91f25a425f13544e56fb12c4" category="paragraph">MetroCluster 解决方案 中没有单点故障：</block>
  <block id="6a988bf07e73bcbf69f62ce9724dd0f3" category="list-text">每个控制器都有两条通往本地站点上的驱动器架的独立路径。</block>
  <block id="2c98a75e02c6e103b43724f02e99e393" category="list-text">每个控制器都有两条通往远程站点上驱动器架的独立路径。</block>
  <block id="e18f703538cd1f5af3b9185eed57b49b" category="list-text">每个控制器都有两条独立的路径连接到另一站点上的控制器。</block>
  <block id="800ec0ea85a62c2fb192ac2f79ee1d02" category="list-text">在HA对配置中、每个控制器都有两个指向其本地配对节点的路径。</block>
  <block id="a3d7a569ad6ea771a0ad9b995619251b" category="paragraph">总之、可以删除配置中的任何一个组件、而不会影响MetroCluster提供数据的能力。这两个选项在故障恢复能力方面的唯一区别是、发生站点故障后、HA对版本仍然是整体HA存储系统。</block>
  <block id="9b4c3976d453e66a3dd22e2793fc3a8e" category="doc">空间管理</block>
  <block id="e89d3732a2fbc592923c30e54522dcdb" category="paragraph">精简配置有多种形式、是ONTAP为企业级应用程序环境提供的许多功能不可或缺的组成部分。精简配置也与效率技术密切相关、原因相同：效率功能允许存储的逻辑数据比存储系统上的技术数据多。</block>
  <block id="537642ed3bfef7f2bb3e580b3b266bd3" category="paragraph">几乎任何快照使用都涉及精简配置。例如、NetApp存储上的典型10 TB数据库包含大约30天的快照。这种安排会使活动文件系统中显示大约10 TB的数据、并将300 TB专用于快照。总存储量为312 TB、通常占用大约12 TB到15 TB的空间。活动数据库会占用10 TB的空间、其余300 TB的数据仅需要2 TB到5 TB的空间、因为系统仅会存储对原始数据所做的更改。</block>
  <block id="a19609016ad1cb6b7bae7cac796a26a4" category="paragraph">克隆也是精简配置的一个示例。一家主要NetApp客户为一个80 TB数据库创建了40个克隆、以供开发使用。如果使用这些克隆的所有40位开发人员都覆盖了每个数据文件中的每个块、则需要3.2 PB以上的存储。实际上、周转率较低、并且总空间需求接近40 TB、因为驱动器上仅存储更改。</block>
  <block id="2433af6347e4871be5af0f2af0f6bd6e" category="paragraph">对应用程序环境进行精简配置时必须格外小心、因为数据变更率可能会意外增加。例如、如果为数据库表重新编制索引或对VMware子系统应用大规模修补、则快照占用的空间会快速增长。放错位置的备份可能会在很短的时间内写入大量数据。最后、如果文件系统意外用尽可用空间、则很难恢复某些应用程序。</block>
  <block id="5cf4dc4d1ce52ff655ea7f1157a72e2e" category="paragraph">幸运的是、这些风险可以通过仔细配置来解决<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block> 策略。正如其名称所暗示的那样、这些选项使用户能够创建策略、以自动清除快照占用的空间或增加卷以容纳更多数据。有多种选项可供选择、不同客户的需求也会有所不同。</block>
  <block id="6a28738961e6f6e4b57e4dd70c446600" category="inline-link-macro">逻辑存储管理文档</block>
  <block id="01570cb5a3aec2324ab56e318e1de04d" category="paragraph">请参见 <block ref="e69bd75bdb49183ee90588843edb33f4" category="inline-link-macro-rx"></block> 有关这些功能的完整讨论。</block>
  <block id="8cf44a7a390ab582c5010ba430143d4b" category="section-title">LUN精简配置</block>
  <block id="ba0bdf51bc57bacdd6f3f0bd26b7674c" category="paragraph">随着数据被删除、文件系统环境中活动LUN的精简配置效率可能会逐渐降低。除非已删除的数据被零覆盖或空间通过TRIM/UNMAP空间回收释放、否则"已删除"的数据会在文件系统中占用越来越多的未分配空格。此外、活动LUN的精简配置在许多数据库环境中的用途有限、因为数据文件在创建时会初始化为其完整大小。</block>
  <block id="e10d46632bc86306cf4c22633ee930ab" category="paragraph">仔细规划LVM配置可以提高效率、并最大限度地减少存储配置和LUN大小调整的需求。使用Veritas VLVM或Oracle ASM等LVM时、底层LUN会划分为仅在需要时才使用的块区。例如、如果数据集的大小从2 TB开始、但随着时间的推移可能会增长到10 TB、则可以将此数据集放置在LVM磁盘组中组织的10 TB精简配置LUN上。在创建时、它只会占用2 TB的空间、并且只会在为满足数据增长而分配块区时占用额外空间。只要空间受到监控、此过程就会很安全。</block>
  <block id="66a41fd6fc38c454973e91d92cf0e291" category="section-title">预留百分比</block>
  <block id="e8a206fe65814e0ea465e32487544751" category="paragraph">预留百分比是指卷中LUN在空间效率方面的行为。选项<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 设置为100%时、卷中的所有数据在使用任何数据模式时均可实现100%的周转率、而不会耗尽卷上的空间。</block>
  <block id="a3cd28aef7d0becd57b60187fdc4a24e" category="paragraph">例如、假设数据库位于1 TB卷中的一个250 GB LUN上。创建快照会立即在卷中预留额外的250 GB空间、以保证卷不会因任何原因用尽空间。使用预留百分比通常会造成浪费、因为数据库卷中的每个字节极不可能需要覆盖。没有理由为从未发生的事件预留空间。但是、如果客户无法监控存储系统中的空间消耗、并且必须确保空间永远不会用尽、则需要100%预留百分比才能使用快照。</block>
  <block id="e30fbe8981929fb070a820a213381bab" category="section-title">数据压缩和重复数据删除</block>
  <block id="1b6e4e9a2be031edc6f3da1f559ef884" category="paragraph">数据压缩和重复数据删除都是精简配置的两种形式。例如、50 TB的数据占用空间可能会压缩为30 TB、从而节省20 TB的空间。要使数据压缩产生任何优势、必须将这20 TB中的一部分用于其他数据、或者购买的存储系统必须小于50 TB。这样、存储的数据就会超过存储系统上的技术可用数据。从数据角度来看、数据容量为50 TB、尽管它在驱动器上仅占用30 TB。</block>
  <block id="dbca4bb791f36eac2c11c32f73f2b4ec" category="paragraph">数据集的可压缩性总是有可能发生变化、从而导致实际空间消耗增加。这种消耗量的增加意味着、在监控和使用方面、必须像其他形式的精简配置一样管理数据压缩<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block>。</block>
  <block id="ad241666a88b5414e8c2fe6d1cc1edb0" category="paragraph">有关数据压缩和重复数据删除的详细信息、请参见链接efficiency.html</block>
  <block id="8ecfcadfebb472a089481e8554ebed87" category="section-title">数据压缩和预留百分比</block>
  <block id="4f8fcc146d2e8e712dcd8c56b1684fcc" category="paragraph">数据压缩是一种精简配置形式。预留百分比会影响数据压缩的使用、但需要注意的一点是、空间是在创建快照之前预留的。通常、只有当存在快照时、预留百分比才重要。如果没有快照、则预留百分比并不重要。而数据压缩则不是这种情况。如果在已进行数据压缩的卷上创建了LUN、则ONTAP会保留空间以容纳快照。此行为在配置期间可能会令人困惑、但这是预期行为。</block>
  <block id="e26f8048b4bf60dad827c5a425271361" category="paragraph">例如、假设一个10 GB的卷具有一个5 GB的LUN、该LUN已压缩为2.5 GB、并且没有快照。请考虑以下两种情形：</block>
  <block id="ade18971a2dab7e37335e95d81da0ef1" category="list-text">预留百分比= 100会导致利用率达到7.5 GB</block>
  <block id="1d07b8e7c92488a55301ea201328cf35" category="list-text">预留百分比= 0会导致利用率达到2.5 GB</block>
  <block id="aa410d0e46ec94b6efcf344f0d870c1a" category="paragraph">第一种情形包括：当前数据占用2.5 GB空间、而源在预计快照使用时的周转率为100%时占用5 GB空间。第二种情形不会预留任何额外空间。</block>
  <block id="e79414ad391b126cc9bd53af1624c8de" category="paragraph">虽然这种情况可能看起来令人困惑、但在实践中不太可能遇到。数据压缩意味着精简配置、而在LUN环境中进行精简配置需要预留百分比。压缩的数据始终可以被不可压缩的内容覆盖、这意味着必须对卷进行精简配置、才能进行压缩、从而节省空间。</block>
  <block id="499a10b92cb9ca6b3412d4bf5a91a2b0" category="paragraph">* NetApp建议*采用以下预留配置：</block>
  <block id="7f26e875cee50c1b3baf71a014043794" category="list-text">设置<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 如果已实施基本容量监控、则为0<block ref="f9e1f2ea1a2becbaf82dd54e55a12e6b" prefix=" " category="inline-code"></block> 和<block ref="24d554277b3513bb6cef3f0a336725a9" prefix=" " category="inline-code"></block>。</block>
  <block id="675996bd34ec0d8c134215f5be73fb3a" category="list-text">设置<block ref="c1acac5c4332e37ec1f281fcbaf0765a" prefix=" " category="inline-code"></block> 如果没有监控能力或在任何情况下都无法排空空间、则为100。</block>
  <block id="8ee38535add58992c14b23a6f7cf8d27" category="doc">LIF类型</block>
  <block id="50d034374ef68094a0f6c8e8d06a77af" category="inline-link-macro">ONTAP网络管理文档</block>
  <block id="fc25025f3f0a2afd42465a55f35c02d0" category="paragraph">本节概述了LIF的主要设计原则。有关更全面的文档、请参见 <block ref="a3e6361e1a52d384f542a2f2d8bc9bb1" category="inline-link-macro-rx"></block>。与数据库架构的其他方面一样、Storage Virtual Machine (SVM、在CLI中称为Vserver)和逻辑接口(LIF)设计的最佳选项在很大程度上取决于扩展要求和业务需求。</block>
  <block id="be0801f7fb241be642bec73b799d45cb" category="paragraph">在制定LIF策略时、请考虑以下主要主题：</block>
  <block id="362c2978dddcf6988ce266d3d60f5beb" category="list-text">*性能。*网络带宽是否足够？</block>
  <block id="cfc88efb72b2c7ea83a4a3d68b760d55" category="list-text">*故障恢复能力。*设计中是否存在单点故障？</block>
  <block id="af02972fd4dc1e949d800731d9518812" category="list-text">*易管理性。*网络能否无干扰地扩展？</block>
  <block id="fdcbadc80d2dd31527cc91cf81fb725d" category="paragraph">这些主题适用于从主机到交换机再到存储系统的端到端解决方案。</block>
  <block id="f45fe079103703d0b315ff2e339728fd" category="inline-link-macro">有关LIF类型的ONTAP文档</block>
  <block id="cc4583278db25277db9ddcd781cbf992" category="paragraph">LIF类型有多种。 <block ref="9d27879d9d2bd4f0f081ffed63159522" category="inline-link-macro-rx"></block> 请提供有关此主题的更完整信息、但从功能角度来看、可以将这些生命周期表分为以下几组：</block>
  <block id="f34a52d788c5a4cf56d7ae8ccb85f8c2" category="list-text">*集群和节点管理Lifs.*用于管理存储集群的Lifs。</block>
  <block id="73ac4e00a9ff3caf31e6df13a6df2f78" category="list-text">* SVM管理LIF.*允许通过REST API或ONTAPI (也称为ZAPI)访问SVM的接口、用于执行创建快照或调整卷大小等功能。SnapManager for Oracle (SMO)等产品必须能够访问SVM管理LIF。</block>
  <block id="b7010e46f4769f638197aa230f448ba0" category="list-text">*数据Lifs.* FC、iSCSI、NVMe/FC、NVMe/TCP、NFS接口 或SMB/CCIFS数据。</block>
  <block id="1eb4f53fa8ee8f0954514a1b9858bf6b" category="admonition">用于NFS流量的数据LIF也可通过从更改防火墙策略来进行管理<block ref="8d777f385d3dfec8815d20f7496026dc" prefix=" " category="inline-code"></block> to<block ref="d724f231a9a7b89757c4394d6622bc47" prefix=" " category="inline-code"></block> 或其他允许HTTP、HTTPS或SSH的策略。此更改可以避免配置每个主机以访问NFS数据LIF和单独的管理LIF、从而简化网络配置。无法为iSCSI和管理流量配置接口、尽管两者都使用IP协议。在iSCSI环境中、需要使用单独的管理LIF。</block>
  <block id="85d465743ad38be108b50648ab283d78" category="section-title">SAN LIF设计</block>
  <block id="8800a54085e1b2987d83537423221cf9" category="paragraph">SAN环境中的LIF设计相对简单、原因之一是：多路径。所有现代SAN实施都允许客户端通过多个独立的网络路径访问数据、并选择最佳访问路径。因此、与LIF设计相关的性能更易于解决、因为SAN客户端会自动在最佳可用路径之间对I/O进行负载平衡。</block>
  <block id="e33c923a4d6280bf6f2b2a982ff74ee3" category="paragraph">如果某个路径不可用、则客户端会自动选择其他路径。由此带来的设计精简性使SAN的生命周期通常更易于管理。这并不意味着SAN环境始终可以更轻松地进行管理、因为SAN存储的许多其他方面都比NFS复杂得多。这只是意味着SAN LIF的设计更简单。</block>
  <block id="9446a98ad14416153cc4d45ab8b531bf" category="section-title">性能</block>
  <block id="141614e246b14131ec01a449d61ed657" category="paragraph">在SAN环境中、LIF性能最重要的考虑因素是带宽。例如、每个节点具有两个16 Gb FC端口的双节点ONTAP AFF集群允许每个节点之间最多32 Gb的带宽。</block>
  <block id="02bc0523497de72834c4c7990e32d155" category="section-title">故障恢复能力</block>
  <block id="01b1d8276ca14813ff4804089a9ac082" category="paragraph">SAN AFF不会在SAN存储系统上进行故障转移。如果SAN LIF因控制器故障转移而失败、则客户端的多路径软件会检测到路径丢失、并将I/O重定向到其他LIF。对于ASA存储系统、将在短暂延迟后对lifs进行故障转移、但这不会中断IO、因为其他控制器上已存在活动路径。执行故障转移过程是为了恢复所有定义端口上的主机访问。</block>
  <block id="b7c94ef25c0629a65f8a1f6ce7014d95" category="section-title">易管理性</block>
  <block id="1325935a6fa0e88cfec45038005f18e3" category="paragraph">在NFS环境中、LIF迁移是一项更为常见的任务、因为LIF迁移通常与在集群中重新定位卷相关联。在HA对中重新定位卷后、无需在SAN环境中迁移LIF。这是因为、在卷移动完成后、ONTAP会向SAN发送有关路径更改的通知、并且SAN客户端会自动重新优化。使用SAN迁移LIF主要与重大物理硬件更改相关。例如、如果需要无中断升级控制器、则会将SAN LIF迁移到新硬件。如果发现FC端口出现故障、则可以将LIF迁移到未使用的端口。</block>
  <block id="dbb887b1373e51dab774976c5a556964" category="section-title">设计建议</block>
  <block id="076872b2444637e6142c3c6f0f157423" category="paragraph">NetApp提出以下建议：</block>
  <block id="d8d6bca7c981c13479781da85883cfef" category="list-text">请勿创建超出所需数量的路径。路径数量过多会使整体管理变得更加复杂、并且某些主机上的路径故障转移可能会出现发生原因问题。此外、对于SAN启动等配置、某些主机存在意外的路径限制。</block>
  <block id="bd662d86fcca370cddf188ff5378fb1b" category="list-text">很少有配置需要一个LUN具有四个以上的路径。如果有两个以上的节点向LUN公布路径、则其价值会受到限制、因为如果拥有LUN的节点及其HA配对节点发生故障、则托管LUN的聚合将无法访问。在这种情况下、在主HA对以外的节点上创建路径毫无用处。</block>
  <block id="8873f044ab7c082f16372e4b8bdc6e03" category="list-text">虽然可以通过选择要包含在FC分区中的端口来管理可见LUN路径的数量、但通常在FC分区中包含所有潜在目标点并在ONTAP级别控制LUN可见性会更容易。</block>
  <block id="0ebc6267761306c4daefb9871a470e4b" category="list-text">在ONTAP 8.3及更高版本中、默认使用选择性LUN映射(SLM)功能。通过SLM、任何新的LUN都会自动从拥有底层聚合的节点以及该节点的HA配对节点公布。这种安排无需创建端口集或配置分区来限制端口可访问性。为了获得最佳性能和故障恢复能力、每个LUN可在所需的最少节点上使用。
*如果必须将LUN迁移到两个控制器之外、则可以使用添加其他节点<block ref="02d0bbdc14988c85bbd7994723f4dd7f" prefix=" " category="inline-code"></block> 命令、以便在新节点上公布LUN。这样会为LUN创建更多SAN路径以进行LUN迁移。但是、主机必须执行发现操作才能使用新路径。</block>
  <block id="cc4b24f288afae5889c6061466dda472" category="list-text">不要过分关注间接流量。在I/O密集型环境中、最好避免间接流量、因为在这种环境中、每微秒的延迟都至关重要、但对于典型工作负载、可见的性能影响可以忽略不计。</block>
  <block id="f54fccb82abaa995eb9f86264f431505" category="section-title">NFS LIF设计</block>
  <block id="e68dee93f11ae71aebd7a1e4c2abfc5a" category="paragraph">与SAN协议不同、NFS定义多个数据路径的能力有限。NFSv4的并行NFS (pNFS)扩展解决了这一限制、但由于以太网速度已达到100 GB甚至超过100 GB、因此添加额外路径很少有价值。</block>
  <block id="391dc675ec3d853200129b799ed5923e" category="section-title">性能和故障恢复能力</block>
  <block id="a0bd34f908e3947aa4aba15382354836" category="paragraph">虽然衡量SAN LIF性能主要是计算所有主路径的总带宽、但要确定NFS LIF性能、需要更深入地了解确切的网络配置。例如、可以将两个10 Gb端口配置为原始物理端口、也可以将其配置为链路聚合控制协议(Link Aggregation Control Protocol、LACP)接口组。如果将其配置为接口组、则可以使用多个负载平衡策略、这些策略的工作方式会有所不同、具体取决于流量是交换流量还是路由流量。最后、Oracle Direct NFS (DNFS)提供了目前在任何操作系统NFS客户端中都不存在的负载平衡配置。</block>
  <block id="e500ca27c6b92454c989d80e0445c359" category="paragraph">与SAN协议不同、NFS文件系统要求在协议层具有故障恢复能力。例如、LUN始终配置为启用多路径、这意味着存储系统可以使用多个冗余通道、每个通道都使用FC协议。另一方面、NFS文件系统取决于单个TCP/IP通道的可用性、该通道只能在物理层进行保护。这种安排就是为什么存在端口故障转移和LACP端口聚合等选项的原因。</block>
  <block id="35926e2ada969ad80fd3b16c0cd7d35a" category="paragraph">在NFS环境中、性能和故障恢复能力均在网络协议层提供。因此，这两个主题是相互交织的，必须一起讨论。</block>
  <block id="84f4a5dfaa9613a469cd783c353a186c" category="section-title">将LIP绑定到端口组</block>
  <block id="44bfb87c11d83c1b91c3589f2081e7ca" category="paragraph">要将LIF绑定到端口组、请将LIF IP地址与一组物理端口相关联。将物理端口聚合在一起的主要方法是LACP。LACP的容错功能相当简单；LACP组中的每个端口都会受到监控、并在发生故障时从端口组中删除。但是、对于LACP在性能方面的工作原理、存在许多误解：</block>
  <block id="19a43026949fb6ef1017a54cf7c94f9b" category="list-text">LACP不要求交换机上的配置与端点匹配。例如、可以为ONTAP配置基于IP的负载平衡、而交换机可以使用基于MAC的负载平衡。</block>
  <block id="86501252b34395de5303a65f5e9943e3" category="list-text">使用LACP连接的每个端点都可以独立选择数据包传输端口、但不能选择用于接收的端口。这意味着、从ONTAP到特定目标的流量会绑定到特定端口、而返回流量可能会到达其他接口。但是、这不会造成发生原因问题。</block>
  <block id="298ca40b99dd3540dcd82ba5537f3f8d" category="list-text">LACP不会始终均匀分布流量。在具有许多NFS客户端的大型环境中、结果通常甚至会使用LACP聚合中的所有端口。但是、环境中的任何一个NFS文件系统都仅限于一个端口的带宽、而不是整个聚合的带宽。</block>
  <block id="d071b5ccd1569aace97a0b4d6c0a71ac" category="list-text">尽管ONTAP上提供了robin-robin LACP策略、但这些策略不会处理从交换机到主机的连接。例如、如果配置中的一个主机上有一个四端口LACP中继、而ONTAP上有一个四端口LACP中继、则仍然只能使用一个端口读取文件系统。虽然ONTAP可以通过所有四个端口传输数据、但目前尚无可通过所有四个端口从交换机发送到主机的交换机技术。仅使用一个。</block>
  <block id="6e9e98dfaea1ca7860606f1fc05e414a" category="paragraph">在包含许多数据库主机的大型环境中、最常见的方法是使用IP负载平衡构建一个包含适当数量10 Gb (或更快)接口的LACP聚合。通过这种方法、只要存在足够多的客户端、ONTAP就可以均匀地使用所有端口。如果配置中的客户端较少、则负载平衡会中断、因为LACP中继不会动态重新分配负载。</block>
  <block id="7815da600ab459d2b05c5792f2271c1a" category="paragraph">建立连接后、特定方向的流量仅会放置在一个端口上。例如、对通过四端口LACP中继连接的NFS文件系统执行完整表扫描的数据库仅通过一个网络接口卡(Network Interface Card、NIC)读取数据。如果在此类环境中只有三个数据库服务器、则这三个服务器都可能从同一端口读取数据、而其他三个端口则处于空闲状态。</block>
  <block id="153f704ea16440133d51b1877af2a657" category="section-title">将Lifs绑定到物理端口</block>
  <block id="70e655aa3c03f840747c5272142b3527" category="paragraph">将LIF绑定到物理端口可以更精细地控制网络配置、因为ONTAP系统上的给定IP地址一次只与一个网络端口相关联。然后、可通过配置故障转移组和故障转移策略来实现故障恢复能力。</block>
  <block id="218f00463f5281b8ead536582c69ac3a" category="section-title">故障转移策略和故障转移组</block>
  <block id="0a53c26a1bc4036c84fc3b4b63542744" category="inline-link-macro">有关故障转移组和策略的ONTAP网络管理文档</block>
  <block id="f29ae31443947c9782482ee9683dbc0e" category="paragraph">故障转移策略和故障转移组控制了在网络中断期间的故障转移。配置选项已随ONTAP的不同版本而发生更改。请参见 <block ref="96c8cd47b667604fb9991ace7d2eff29" category="inline-link-macro-rx"></block> 有关要部署的ONTAP版本的具体详细信息、请参见。</block>
  <block id="0f2f345dd1247ae428cee703c1bf1c84" category="paragraph">ONTAP 8.3及更高版本支持基于广播域管理LIF故障转移。因此、管理员可以定义可访问给定子网的所有端口、并允许ONTAP选择适当的故障转移LIF。某些客户可以使用这种方法、但由于缺乏可预测性、在高速存储网络环境中这种方法存在一些限制。例如、一个环境可以包括用于例行文件系统访问的1 Gb端口和用于数据文件I/O的10 Gb端口如果两种类型的端口都位于同一广播域中、则LIF故障转移可能会导致数据文件I/O从10 Gb端口移动到1 Gb端口。</block>
  <block id="ced0729d57c08312b2b12382f2147d26" category="paragraph">概括地说、请考虑以下做法：</block>
  <block id="57cb6a7ba8acb7faa31cc5219bae83b3" category="list-text">将故障转移组配置为用户定义的组。</block>
  <block id="b444855eccae552d7fb79bf3d31a4f7b" category="list-text">使用存储故障转移(SFR)配对控制器上的端口填充故障转移组、以便在存储故障转移期间、这些LUN跟随聚合。这样可以避免产生间接流量。</block>
  <block id="86c48b21d166ed8e440a07e1d4a0b15d" category="list-text">使用性能特征与原始LIF匹配的故障转移端口。例如、单个10 Gb物理端口上的LIF应包含一个具有单个10 Gb端口的故障转移组。一个四端口LACP LIF应故障转移到另一个四端口LACP LIF。这些端口将是广播域中定义的端口的子集。</block>
  <block id="3e839a73f7dc1262508f23a89628ca2d" category="list-text">将故障转移策略设置为仅SFo-Partner。这样可以确保LIF在故障转移期间跟随聚合。</block>
  <block id="85e82ce4c9842f978fa774c4fe96b14c" category="section-title">自动还原</block>
  <block id="3dc8610f78478640e47688101cecbfad" category="paragraph">设置<block ref="9f1b7141f09f19c4e33409646aef43cf" prefix=" " category="inline-code"></block> 参数。大多数客户倾向于将此参数设置为<block ref="b326b5062b2f0e69046810717534cb09" prefix=" " category="inline-code"></block> 以使LIF还原到其主端口。但是、在某些情况下、客户会将此值设置为`false `so、以便在将LIF返回到其主端口之前可以调查意外故障转移。</block>
  <block id="edf6d4c299bc2890ba63c7eb3ef8b4d2" category="section-title">LIF与卷的比率</block>
  <block id="9c75becef8c432a0152a40c7c037a04c" category="paragraph">一个常见的误解是、卷和NFS Sifs之间必须有1：1的关系。虽然要在集群中的任何位置移动卷而不创建额外的互连流量、都需要使用此配置、但这绝对不是一项要求。必须考虑集群间流量、但仅存在集群间流量并不会造成问题。为ONTAP创建的许多已发布基准主要包括间接I/O</block>
  <block id="2b4ebcd522b07b80d3fd76b301c506e8" category="paragraph">例如、如果某个数据库项目包含的性能关键型数据库数量相对较少、并且总共只需要40个卷、则可能需要采用卷到LIF的1：1策略、这种安排需要40个IP地址。然后、可以将任何卷与关联的LIF一起移动到集群中的任何位置、流量将始终是直接的、即使是微秒级的延迟、也可以最大限度地减少每个源。</block>
  <block id="38bad4911bcdf1117d37eb1195566f8c" category="paragraph">作为一个反例、客户与LI之间的1：1关系可能更易于管理大型托管环境。随着时间的推移、卷可能需要迁移到其他节点、这会对一些间接流量进行发生原因。但是、除非互连交换机上的网络端口饱和、否则不会检测到性能影响。如果存在问题、可以在其他节点上建立新的LIF、并可在下一个维护窗口更新主机、以便从配置中删除间接流量。</block>
  <block id="d75b0d8f723c3e97eaa4ca39630c7420" category="doc">MetroCluster和多个聚合</block>
  <block id="df5855269b493a27a5565dfd9f2584f0" category="list-text">在正常情况下、传入给定控制器的写入会同步镜像到其配对控制器。在NetApp MetroCluster环境中、写入操作也会镜像到远程控制器。写入操作在所有位置的非易失性介质中存储之前、不会向主机应用程序确认。</block>
  <block id="05b60db315aa45e1524b7a6ffa242fa8" category="list-text">存储写入数据的介质称为非易失性内存或NVMEM。它有时也称为非易失性随机存取存储器(NVRAM)、尽管它充当日志、但也可视为写入缓存。在正常操作下、不会读取NVMEM中的数据；该数据仅用于在发生软件或硬件故障时保护数据。将数据写入驱动器后、数据将从系统中的RAM传输、而不是从NVMEM传输。</block>
  <block id="e6dd8b559da6e046f2043043a55faafc" category="list-text">在接管操作期间、高可用性(HA)对中的一个节点会从其配对节点接管操作。切换本质上是相同的、但在IT适用场景 MetroCluster配置中、远程节点接管本地节点的功能。</block>
  <block id="33c0c466972aae7427262e3075a2ed07" category="paragraph">在日常维护操作期间、存储接管或切换操作应该是透明的、而不是在网络路径发生更改时可能会短暂暂停操作。但是、网络连接可能很复杂、容易出错、因此NetApp强烈建议在将存储系统投入生产之前对接管和切换操作进行全面测试。这样做是确保所有网络路径配置正确的唯一方法。在SAN环境中、请仔细检查命令的输出<block ref="41dc2c94e82e1c56ba876085acf5a974" prefix=" " category="inline-code"></block> 确保所有预期的主路径和辅助路径均可用。</block>
  <block id="d33ea1ad1493de23aafd480e95fea159" category="paragraph">发出强制接管或切换命令时必须小心。使用这些选项强制更改存储配置意味着、拥有驱动器的控制器的状态将被忽略、而备用节点将强制接管驱动器。不正确地强制执行接管可能会导致数据丢失或损坏。这是因为强制接管或切换可能会丢弃NVMEM的内容。接管或切换完成后、如果丢失这些数据、则从数据库的角度来看、存储在驱动器上的数据可能会还原到稍旧的状态。</block>
  <block id="c226371d96b605ccff84ad23db0069b8" category="paragraph">很少需要使用普通HA对强制接管。在几乎所有故障情形下、节点都会关闭并通知配对节点、以便进行自动故障转移。在某些边缘情况下、例如、发生滚动故障时、节点之间的互连断开、然后一个控制器断开、此时需要强制接管。在这种情况下、节点之间的镜像会在控制器发生故障之前丢失、这意味着无故障控制器将不再具有正在进行的写入的副本。然后、需要强制执行接管、这意味着数据可能会丢失。</block>
  <block id="418f81f529a577cb711b44adece1376f" category="paragraph">相同的逻辑适用场景会执行MetroCluster切换。在正常情况下、切换几乎是透明的。但是、灾难可能会导致运行正常的站点与灾难站点之间的连接断开。从运行正常的站点的角度来看、问题可能只是站点之间的连接中断、而原始站点可能仍在处理数据。如果节点无法验证主控制器的状态、则只能执行强制切换。</block>
  <block id="ae0c16d397348d8f8fd4e56b08b06c7c" category="paragraph">* NetApp建议*采取以下预防措施：</block>
  <block id="79fd18cb18befbe5c2113757478be193" category="list-text">请格外小心、以免意外强制执行接管或切换。通常、不需要强制执行、强制执行更改可能会导致发生原因数据丢失。</block>
  <block id="26cece11254903c5ba8bfdd8d54ae779" category="list-text">如果需要强制接管或切换、请确保关闭应用程序、卸载所有文件系统并更改逻辑卷管理器(LVM)卷组。必须卸载ASM磁盘组。</block>
  <block id="0b6986eb1285d28a9987ea13adbca358" category="list-text">如果发生强制MetroCluster切换、请将故障节点与所有运行正常的存储资源隔离。有关详细信息、请参见相关ONTAP版本的《MetroCluster管理和灾难恢复指南》。</block>
  <block id="71303adf87737046acd4381c72151278" category="paragraph">MetroCluster是一种同步复制技术、如果连接中断、则会切换到异步模式。这是客户最常见的请求、因为有保障的同步复制意味着站点连接中断会导致数据库I/O完全停止、从而使数据库无法使用。</block>
  <block id="cb791a44ee361703eb7594a7932f57de" category="paragraph">借助MetroCluster、聚合可以在连接恢复后快速重新同步。与其他存储技术不同、MetroCluster不应要求在站点发生故障后进行完整的重新镜像。只需发送增量变更。</block>
  <block id="c1536091d7c1ca33c9dc4dfa8c0852a2" category="paragraph">在跨聚合的数据集中、在滚动灾难场景中需要执行额外的数据恢复步骤的风险很小。具体而言、如果：(a)站点之间的连接中断、(b)连接恢复、(c)聚合达到一种状态、其中一些聚合已同步、而另一些聚合则未同步、 然后(d)主站点丢失、结果是聚合未彼此同步的运行正常的站点。如果发生这种情况、数据集的部分内容会彼此同步、如果不进行恢复、则无法启动应用程序、数据库或数据存储库。如果数据集跨越多个聚合、NetApp强烈建议使用多种可用工具之一利用基于快照的备份来验证在这种异常情况下的快速可恢复性。</block>
  <block id="a42c87064c284490a38efac4bf0b7f7f" category="paragraph">RAID 4、RAID 5、RAID 6、RAID DP和RAID-TEC均使用奇偶校验来确保驱动器故障不会导致数据丢失。与镜像相比、这些RAID选项提供的存储利用率要高得多、但大多数RAID实施都有一个影响写入操作的缺点。在其他RAID实施中完成写入操作可能需要多次驱动器读取才能重新生成奇偶校验数据、此过程通常称为RAID惩罚。</block>
  <block id="3cfcf9a3299db75df9aa0e024ebef965" category="paragraph">但是、ONTAP不会受到这种RAID惩罚。这是因为NetApp WAFL (任意位置写入文件布局)与RAID层集成在一起。写入操作会在RAM中进行聚合、并准备为完整的RAID条带、包括奇偶校验生成。ONTAP无需执行读取即可完成写入、这意味着ONTAP和WAFL可以避免RAID惩罚。重做日志记录等延迟关键型操作的性能不受阻碍、随机数据文件写入不会因需要重新生成奇偶校验而产生任何RAID影响。</block>
  <block id="5ff9a871332f0f82f38d880b68a9874b" category="paragraph">在统计可靠性方面、即使RAID DP也能提供比RAID镜像更好的保护。主要问题是RAID重建期间对驱动器的需求。使用镜像RAID集时、在重建到RAID集中的配对驱动器时、由于驱动器故障而导致数据丢失的风险远高于RAID DP集中三驱动器故障的风险。</block>
  <block id="12c3fe87fd5a746ce8a7cbe25dc1c25b" category="paragraph">在闪存驱动器时代之前、条带化用于帮助克服旋转驱动器的性能限制。例如、如果操作系统需要执行1 MB的读取操作、则从单个驱动器读取1 MB的数据将需要大量的驱动器磁头查找和读取、因为1 MB的传输速度较慢。如果在8个LUN上对1 MB的数据进行条带化、则操作系统可以问题描述并行执行8个128 K读取操作、从而减少完成1 MB传输所需的时间。</block>
  <block id="e337352c3d57672fd08af8ba709b544f" category="paragraph">使用旋转驱动器进行条带化更为困难、因为必须事先知道I/O模式。如果条带化未正确调整为真正的I/O模式、则条带化配置可能会损害性能。使用Oracle数据库、尤其是使用全闪存配置时、条带化更易于配置、并且经验证可显著提高性能。</block>
  <block id="7025652291dc6872022b0f79a2b2be21" category="paragraph">默认情况下、逻辑卷管理器(例如Oracle ASM)会进行条带化、但本机操作系统LVM则不会进行条带化。其中一些会将多个LUN绑定在一起、形成一个串联设备、从而导致数据文件只存在于一个LUN设备上。这会导致热点。其他LVM实施默认使用分布式块区。这与条带化类似、但更粗。卷组中的LUN会被划分为多个大块、称为块区、通常以MB为单位进行测量、然后逻辑卷会分布在这些块区中。结果是、文件的随机I/O应在各个LUN之间分布良好、但顺序I/O操作的效率不如所能达到的高。</block>
  <block id="0c2f3b2ec9d90baa0a0a0b6fb673a113" category="paragraph">性能密集型应用程序I/O几乎始终为(a)基本块大小单位或(b) 1兆字节。</block>
  <block id="804d5b1f06570b4d242be0c2f0c3392c" category="paragraph">条带化配置的主要目标是确保单文件I/O可作为一个单元执行、多块I/O (大小应为1 MB)可在条带化卷中的所有LUN之间均匀并行。这意味着条带大小不能小于数据库块大小、条带大小乘以LUN数量应为1 MB。</block>
  <block id="0598f393baefd05d48b48076cc7df606" category="paragraph">下图显示了三个可能的条带大小和宽度调整选项。选择LUN数量是为了满足上述性能要求、但在所有情况下、单个条带内的总数据均为1 MB。</block>
  <block id="9ca503fae9ccd4d6d8e67806b23adfa0" category="paragraph"><block ref="9ca503fae9ccd4d6d8e67806b23adfa0" category="inline-image-macro-rx" type="image"></block></block>
  <block id="0353522b39b87d54d40d3f09ec668851" category="doc">ONTAP 配置</block>
  <block id="8e52de0d4b03d5fe87dc88da09616c7f" category="inline-link-macro">此处。</block>
  <block id="337c62c6b6eb7319bae58701105e889c" category="doc">分层</block>
  <block id="3493794b3ccb587f71a663f51f4484ef" category="summary">基于ONTAP的PostgreSQL数据库</block>
  <block id="2d3298c651b356a82db5d664ce68e65e" category="doc">本机数据保护</block>
  <block id="31c6611c8e0bd237a3ee51db1728a440" category="paragraph">存储设计的一个主要方面是为PostgreSQL卷启用保护。客户可以使用转储方法或文件系统备份来保护其PostgreSQL数据库。本节介绍备份单个数据库或整个集群的不同方法。</block>
  <block id="9f3265914462c64fd02bc50ab4c9ebe9" category="paragraph">备份PostgreSQL数据有三种方法：</block>
  <block id="6b592c7950245a5a9f54d9424e851e97" category="list-text">SQL Server转储</block>
  <block id="c8b1fc69d12d1da6589e384671c8e82c" category="list-text">文件系统级备份</block>
  <block id="3c25062a0babfa1495dd604698707610" category="list-text">持续归档</block>
  <block id="58c132e2be12705408a7456c6183b617" category="paragraph">SQL Server转储方法的理念是、使用SQL Server命令生成一个文件、当返回到服务器时、该文件可以像转储时那样重新创建数据库。PostgreSQL提供实用程序<block ref="5a5149b2817f30cbb3805307f9cadae4" prefix=" " category="inline-code"></block> 和<block ref="0ead269b3d000482b5a44a1ef4e8cd54" prefix=" " category="inline-code"></block> 用于创建单个和集群级别的备份。这些转储是逻辑转储、不包含可供WAL重放使用的足够信息。</block>
  <block id="1d05b80fc6f199681263e063190e8325" category="paragraph">另一种备份策略是使用文件系统级备份、即管理员直接复制PostgreSQL用于将数据存储在数据库中的文件。此方法在脱机模式下完成：必须关闭数据库或集群。另一种替代方法是使用<block ref="35679fc424d9eec0c30f38459fd9b322" prefix=" " category="inline-code"></block> 对PostgreSQL数据库运行热流备份。</block>
  <block id="10907e7ac5ab6e5235a23898a2331b31" category="doc">基于ONTAP的PostgreSQL数据库</block>
  <block id="b5f477e959f26421a80e1eebdadbdd71" category="paragraph">PostgreSQL附带的变体包括PostgreSQL、PostgreSQL Plus和EDB Postgrers Advanced Server (ePAS)。PostgreSQL通常部署为多层应用程序的后端数据库。它受常见中间件包(如PHP、Java、Python、Tcl/Tk、ODBC、 和JDBC)、并且一直以来都是开源数据库管理系统的常用选择。对于运行PostgreSQL数据库来说、NetApp ONTAP的可靠性、高性能和高效的数据管理功能是一个绝佳的选择。</block>
  <block id="841a21e58e7c22a71c07b89a4362d2b6" category="admonition">有关ONTAP和PostgreSQL数据库的本文档将取代先前发布的_TR-4770：《基于ONTAP的PostgreSQL数据库最佳实践》。_</block>
  <block id="9147e5e61a7b9260dec09f3a6eb3e5be" category="doc">快照</block>
  <block id="0b9d99167191c5d9ad23ca07bc6a9b38" category="paragraph">使用PostgreSQL进行基于Snapshot的备份时、需要为数据文件、WAL文件和归档的WAL文件配置快照、以提供完整或时间点恢复。</block>
  <block id="8c6a53edc4449a4cc3983d47ecffa851" category="paragraph">对于PostgreSQL数据库、快照的平均备份时间介于几秒到几分钟之间。此备份速度比快60到100倍<block ref="35679fc424d9eec0c30f38459fd9b322" prefix=" " category="inline-code"></block> 以及其他基于文件系统的备份方法。</block>
  <block id="c798632224ae09152f66f60e0edc757e" category="paragraph">NetApp存储上的快照可以是崩溃状态一致的快照、也可以是应用程序一致的快照。系统会在存储上创建崩溃状态一致的快照、而不会使数据库处于静音状态、而是在数据库处于备份模式时创建应用程序一致的快照。NetApp还可确保后续快照是永久增量备份、以节省存储空间并提高网络效率。</block>
  <block id="d0e369216eeac8de66e915909364970a" category="paragraph">由于快照速度快且不会影响系统性能、因此您可以计划每天创建多个快照、而不是像使用其他流式备份技术那样创建一个每日备份。在需要执行还原和恢复操作时、系统停机时间可通过以下两个主要功能来减少：</block>
  <block id="316eb8adba4d16a34c92eaf9db381b9e" category="list-text">NetApp SnapRestore数据恢复技术意味着只需几秒钟即可执行还原操作。</block>
  <block id="c128c475c12703e37685edd6db8144bc" category="list-text">主动恢复点目标(Recovery Point目标、RPO)意味着、必须应用的数据库日志减少、并且前向恢复也会加快。</block>
  <block id="9b9f26085ff7149d4dbb916b1db0f121" category="paragraph">要备份PostgreSQL、必须确保数据卷同时受到(一致性组) WAL和归档日志的保护。在使用Snapshot技术复制WAL文件时、请确保运行<block ref="a3b8c8ee15ba60bfb2b999195d2b4e7d" prefix=" " category="inline-code"></block> 刷新必须归档的所有WAL条目。如果在还原期间刷新WAL条目、则只需停止数据库、卸载或删除现有数据目录、并对存储执行SnapRestore操作即可。还原完成后、您可以挂载系统并将其恢复到当前状态。对于时间点恢复、您还可以恢复WAL和归档日志；然后PostgreSQL确定最一致的点并自动恢复它。</block>
  <block id="8e8d6187572eace409fee5bf2dbb7cf9" category="paragraph">一致性组是ONTAP中的一项功能、如果在一个实例或包含多个表空间的数据库中挂载了多个卷、则建议使用一致性组。一致性组快照可确保所有卷都分组在一起并受到保护。您可以从ONTAP系统管理器高效管理一致性组、甚至可以克隆一致性组以创建数据库的实例副本、用于测试或开发目的。</block>
  <block id="55ca4b30c6f7c3ef975a6d1e1fb222a2" category="inline-link-macro">NetApp一致性组概述</block>
  <block id="69dd5879aee425e37fdd5796a8e06a56" category="paragraph">有关一致性组的详细信息、请参见 <block ref="112c5744a39904facdbc5fab385d9fe1" category="inline-link-macro-rx"></block>。</block>
  <block id="7e7397a7b79323762c61941fc0e6b5f9" category="doc">数据保护</block>
  <block id="16a49d0bc0249ef3dd42949589a0ed4e" category="doc">表空间</block>
  <block id="d6d544de56c329d9f68bb176c6245e7c" category="paragraph">初始化数据库集群时、系统会自动创建两个表空间。</block>
  <block id="6df924905e21856e4e8b8f936767cdd6" category="paragraph">。<block ref="bd676cbef0d168a62a062c8709af1824" prefix=" " category="inline-code"></block> 表空间用于共享系统目录。。<block ref="3224684b8e7208962a73daeb0bb24110" prefix=" " category="inline-code"></block> 表空间是template1和template0数据库的默认表空间。如果用于初始化集群的分区或卷用尽空间且无法扩展、则可以在其他分区上创建并使用表空间、直到可以重新配置系统为止。</block>
  <block id="364c9d7b9593277eee9477befaf9f66b" category="paragraph">使用率较高的索引可以放置在快速、高可用性的磁盘上、就像固态设备一样。此外、存储很少使用或不影响性能的归档数据的表可以存储在成本较低、速度较慢的磁盘系统上、例如SAS或SATA驱动器。</block>
  <block id="9bfe8d8e1117bd1d4b8597220e3f166e" category="paragraph">表空间是数据库集群的一部分、不能视为数据文件的自主集合。它们依赖于主数据目录中包含的元数据、因此无法连接到其他数据库集群或单独备份。同样、如果丢失表空间(由于文件删除、磁盘故障等原因)、数据库集群可能会变得不可读或无法启动。将表空间放置在临时文件系统(如RAM磁盘)上会危及整个集群的可靠性。</block>
  <block id="7d9573b1ed3543ec6ea42c81830dc27c" category="paragraph">创建表空间后、如果请求用户具有足够的权限、则可以使用任何数据库中的表空间。PostgreSQL使用符号链接来简化表空间的实现。PostgreSQL在中添加一行<block ref="4a926dc6e7549c49a13755513af41e67" prefix=" " category="inline-code"></block> 表(一个全组范围的表)、并为该行分配一个新的对象标识符(OID)。最后、服务器使用OID在集群和给定目录之间创建符号链接。目录<block ref="8e3da386e945c59fb1e1cd1d7a47697c" prefix=" " category="inline-code"></block> 包含指向集群中定义的每个非内置表空间的符号链接。</block>
  <block id="249fd7d68098688fab42436eed51be7d" category="doc">数据库配置</block>
  <block id="8daf26b2c72dd18a89fa89a6b1aa988d" category="paragraph">可以通过多种PostgreSQL调整配置来提高性能。</block>
  <block id="abb3dae412afe5c801e9ab90de71675b" category="paragraph">最常用的参数如下：</block>
  <block id="bfdf741f4acb3dfee6e87075b535610e" category="list-text"><block ref="39d79378db03fed7c5ba62efba38e327" prefix="" category="inline-code"></block>：一次可建立的最大数据库连接数。使用此参数可限制磁盘交换并导致性能下降。根据您的应用程序要求、您还可以针对连接池设置调整此参数。</block>
  <block id="9625e1a6f5d1f695fd1c72401afaa07e" category="list-text"><block ref="904d399f43708a8a5b6d10c1ee3f8356" prefix="" category="inline-code"></block>：提高数据库服务器性能的最简单方法。对于大多数现代硬件、默认值为low。在部署期间、它会设置为系统上可用RAM的大约25%。此参数设置因其在特定数据库实例中的工作方式而异；您可能需要按试用和错误增加和减小值。但是、将其设置为高可能会降低性能。</block>
  <block id="d1960c56572383fc401fec3f0b767cf9" category="list-text"><block ref="5edeed59821790d8bec6d32da26bca4c" prefix="" category="inline-code"></block>:该值告诉PostgreSQL的优化器PostgreSQL有多少内存可用于缓存数据，并帮助确定是否使用索引。值越大、使用索引的可能性就越大。此参数应设置为分配给的内存量<block ref="e15ed0f69e5c2475450b97691d6a2cee" prefix=" " category="inline-code"></block> 加上可用的操作系统缓存容量。此值通常超过系统总内存的50%。</block>
  <block id="508df54f84fc7abb00f3a92937ca3506" category="list-text"><block ref="1edef4d43b06d4deb28010505df5724d" prefix="" category="inline-code"></block>:该参数控制在排序操作和哈希表中使用的内存量。如果您在应用程序中进行大量排序，则可能需要增加内存量，但要小心。它不是系统范围的参数、而是每个操作的参数。如果复杂查询包含多个排序操作、则它会使用多个work _mEM单元内存、多个后端可以同时执行此操作。如果值过大、此查询通常会导致数据库服务器进行交换。此选项以前在早期版本的PostgreSQL中称为Sort_mm。</block>
  <block id="59d9770060aecba84c7e8ed849b5653d" category="list-text"><block ref="65768448b4f275b95af20a317c7355a9" prefix="" category="inline-code"></block>:此参数用于确定在提交事务之前是否应使用fsync()将所有WAL页面同步到磁盘。关闭它有时可以提高写入性能、而打开它可以增强保护、防止在系统崩溃时发生损坏。</block>
  <block id="625a65dd6cef83bac66319bde3894899" category="list-text"><block ref="ff5a06a39dd6824f30a778a51cf7ea69" prefix="" category="inline-code"></block>：检查点进程将已提交的数据转至磁盘。这涉及到磁盘上的大量读/写操作。该值以秒为单位进行设置、较低的值可缩短崩溃恢复时间、增加该值可通过减少检查点调用来减少系统资源的负载。根据应用程序的严重程度、使用情况和数据库可用性、设置checkpoint_timeout的值。</block>
  <block id="309b1036c45e7ad490448925dc4f9597" category="list-text"><block ref="6a5c0586429891e84e05d6ab15088405" prefix="" category="inline-code"></block> 和<block ref="9080796d32078fea7d191100eab64f92" prefix=" " category="inline-code"></block>：这些选项结合使用，可以同时写出多个提交的事务，从而帮助提高性能。如果在提交事务时有多个commit兄弟姐妹对象处于活动状态、则服务器将等待commit delay微秒尝试一次提交多个事务。</block>
  <block id="8d5137ce002c6328c2b5f4f328662e1d" category="list-text"><block ref="fa4ca2cd95c20a44171f964fb8f5fdb9" prefix="" category="inline-code"></block>：为流程配置最佳数量的员工。max_paral_workers对应于可用的CPU数量。根据应用程序设计、查询可能需要较少的工作人员来执行并行操作。最好保持两个参数的值相同、但在测试后调整该值。</block>
  <block id="c8736e7ca19e9096796c624f3030dae5" category="list-text"><block ref="8dda85a5feb6de66d8f5f9a4cbdb0754" prefix="" category="inline-code"></block>：该值控制PostgreSQL查看非顺序磁盘读取的方式。值越高、意味着PostgreSQL更有可能使用顺序扫描而不是索引扫描、这表示您的服务器具有快速磁盘在评估基于计划的优化、清理、索引以更改查询或架构等其他选项后修改此设置。</block>
  <block id="17edf3863f12b7d9480b3336a9fca773" category="list-text"><block ref="709989c844c22473cb8406550423d39a" prefix="" category="inline-code"></block>：此参数用于设置PostgreSQL尝试同时执行的并发磁盘I/O操作的数量。提高此值会增加任何单个PostgreSQL会话尝试并行启动的I/O操作的数量。允许的范围为1到1、000或零、用于禁止发出异步I/O请求。目前、此设置仅影响位图堆扫描。固态驱动器(SSD)和其他基于内存的存储(NVMe)通常可以处理多个并发请求、因此、数百个请求的最大价值可能是。</block>
  <block id="82b38edb10ad73f9645c5d65e73a659b" category="paragraph">有关PostgreSQL配置参数的完整列表、请参见PostgreSQL文档。</block>
  <block id="402fbc243dbef50cd5c8e57ccbdd92f5" category="section-title">吐司</block>
  <block id="0d2b62abb26bd0b4109f5bc967250933" category="paragraph">TOAST表示超大属性存储技术。PostgreSQL使用固定的页面大小(通常为8 KB)、并且不允许元组跨越多个页面。因此、无法直接存储大字段值。当您尝试存储超过此大小的行时、TOAST会将大型列的数据拆分成较小的"部分"、并将其存储在TOAST表中。</block>
  <block id="3f11f21bdc22c3c955c3f0fca39e9bc0" category="paragraph">只有在将结果集发送到客户端时、才会提取已分配属性的大值(如果已选中)。表本身要小得多、并且可以在共享缓冲区缓存中容纳更多行、而不是在没有任何线外存储(TOAST)的情况下。</block>
  <block id="9a311ef6dad816cb7a15c0ab41920ad8" category="section-title">真空</block>
  <block id="385e23b8ebe64dfd0005f6846cc8e85e" category="paragraph">在正常的PostgreSQL操作中，被更新删除或废弃的元组不会从其表中物理删除；它们会一直存在，直到运行真空为止。因此、您必须定期运行真空、尤其是在频繁更新的表上。然后、必须回收占用的空间、供新行重复使用、以避免磁盘空间中断。但是、它不会将空间归还给操作系统。</block>
  <block id="db81319c35b48ed94867775a9a1ce1d7" category="paragraph">页面中的可用空间不会碎片化。真空会重新写入整个数据块、从而高效地填充其余行、并在一页中保留一个连续的可用空间块。</block>
  <block id="8a5c17164c9920590fc057ee01f2fcb3" category="paragraph">相比之下、真空全满会通过写入不含死空间的全新表文件来主动压缩表。此操作可最大程度地减小表大小、但可能需要很长时间。此外、还需要额外的磁盘空间来创建新的表副本、直到操作完成为止。常规真空的目标是避免真空完全发挥作用。此过程不仅可以将表保持在其最小大小、还可以保持磁盘空间的稳定使用状态。</block>
  <block id="61bcd96a2c1f8026527cbf2019d6e9a4" category="doc">初始化</block>
  <block id="f4f9dac58f7c47e819293af5f2dd1177" category="paragraph">您可以使用创建新的数据库集群<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 计划。一个<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 脚本将创建用于定义集群的数据文件、系统表和模板数据库(template0和template1)。</block>
  <block id="b668460552732302350bbb840d57931c" category="paragraph">模板数据库表示一个常用数据库。它包含系统表、标准视图、函数和数据类型的定义。<block ref="3865cf98fe802a965570b4a10a1d894b" prefix=" " category="inline-code"></block> 用作的参数<block ref="abc91e782cd3950bfa31202aff74ca69" prefix=" " category="inline-code"></block> 指定数据库集群位置的脚本。</block>
  <block id="8fcd14822a5b94d212898fe3e006526e" category="paragraph">PostgreSQL中的所有数据库对象都由各自的OID在内部管理。表和索引也由各个OID管理。数据库对象及其各自的OID之间的关系存储在相应的系统目录表中、具体取决于对象类型。例如、数据库和堆表的OID存储在中<block ref="d0fcebb608269edbd5d67486884ebed7" prefix=" " category="inline-code"></block> 和`pg_class。您可以通过在PostgreSQL客户端上发出查询来确定这些OID。</block>
  <block id="d0e97e34fe92edd2facd0f7377b6340b" category="paragraph">每个数据库都有自己的表和索引文件、这些表和索引文件的大小限制为1 GB。每个表都有两个关联文件、后缀分别为<block ref="7b9b00c45b01f7b7c6d3a3c8ba2e9275" prefix=" " category="inline-code"></block> 和<block ref="a1d869a79e2f43693a6a416fcbdc2724" prefix=" " category="inline-code"></block>。它们称为可用空间映射和可见性映射。这些文件用于存储有关可用空间容量的信息、并可查看表文件中的每个页面。索引只具有单个可用空间映射、而不具有可见性映射。</block>
  <block id="048a7ed79caf84bb5c725efc5f474911" category="paragraph">。<block ref="c28f4f32219f5ff99fb4b116980b8549" prefix=" " category="inline-code"></block> 目录包含预写日志。预写日志用于提高数据库可靠性和性能。每当您更新表中的某一行时、PostgreSQL都会首先将更改写入预写日志、然后将修改写入实际数据页面到磁盘。。<block ref="f7223cfaa9416056a91e259e326ac5cf" prefix=" " category="inline-code"></block> 目录通常包含多个文件、但initdb仅创建第一个文件。根据需要添加其他文件。每个xlog文件的长度为16 MB。</block>
  <block id="789a6c7dd865d16eb1df122bcc5c9a3a" category="admonition">*如果需要NFSv4功能、NetApp建议*使用NFSv4.1。在NFSv4.1中、NFSv4协议有一些功能增强功能、可提高某些边缘情况下的故障恢复能力。</block>
  <block id="8e86e0aee135afb67c6a1d3d6e0f3306" category="inline-link-macro">NFS传输大小</block>
  <block id="d84b41126744795c4ee82f7b256e7234" category="inline-link-macro">FC SAN</block>
  <block id="2c8c2171fc87c96e58fb40d8714f85cf" category="doc">PostgreSQL架构</block>
  <block id="ee62b4420d426c21a46d892ac084872a" category="paragraph">PostgreSQL是基于客户端和服务器架构的RDBMS。PostgreSQL实例称为数据库集群、它是一组数据库、而不是一组服务器。</block>
  <block id="89c30c326e106773af32af40255b92a8" category="inline-image-macro">错误：未找到图形</block>
  <block id="54c2dd41fd1ad3efa25e80bee0bae549" category="paragraph">PostgreSQL数据库中有三个主要元素：PostMAIN、前端(客户端)和后端客户端向邮件服务器发送请求、并提供IP协议和要连接到的数据库等信息。邮件服务器对连接进行身份验证，并将其传递到后端进程以进行进一步的通信。后端进程执行查询并将结果直接发送到前端(客户端)。</block>
  <block id="9f96e07bbaf7c0237047d6d0f95301a8" category="paragraph">PostgreSQL实例基于多进程模型、而不是多线程模型。它会为不同的作业生成多个进程、每个进程都有自己的功能。主要进程包括客户端进程、WAL写入程序进程、后台写入程序进程和检查指针进程：</block>
  <block id="6aebf901bd4be26a765c56e4133b3798" category="list-text">当客户端(前台)进程向PostgreSQL实例发送读取或写入请求时、它不会直接向磁盘读取或写入数据。它首先将数据缓冲在共享缓冲区和预写日志记录(Write-Ahead Logging、WAL)缓冲区中。</block>
  <block id="458239ee6c634dc5fef96f9dfab275f0" category="list-text">WAL写入程序进程操纵共享缓冲区和WAL缓冲区的内容以写入WAL日志。WAL日志通常是PostgreSQL的事务日志、并按顺序写入。因此、为了缩短数据库的响应时间、PostgreSQL首先写入事务日志并确认客户端。</block>
  <block id="9ec2999256fe568cd596b42e7da2cc39" category="list-text">为了使数据库处于一致状态、后台写入程序进程会定期检查共享缓冲区中是否存在脏页。然后、它会将数据转储到存储在NetApp卷或LUN上的数据文件中。</block>
  <block id="5c852dd8ba7215c01dfde8e98f6c46c6" category="list-text">检查指针进程也会定期运行(比后台进程频率低)、并防止对缓冲区进行任何修改。它会向WAL写入程序进程发出信号、将检查点记录写入并刷新到NetApp磁盘上存储的WAL日志的末尾。它还会向后台写入程序进程发出信号、指示将所有脏页写入磁盘并将其刷新。</block>
  <block id="0a7b1215fd0b9621d4d7300f88b2906c" category="doc">数据保护软件</block>
  <block id="e265011e47d11db43ee112fd2fdc9d5b" category="paragraph">适用于PostgreSQL数据库的NetApp SnapCenter插件与Snapshot和NetApp FlexClone技术相结合、可为您提供以下优势：</block>
  <block id="4dcdaba06a92b8fecfdc823643a71723" category="list-text">快速备份和恢复。</block>
  <block id="aee746a577a1baebdc33197fb5f3a279" category="list-text">节省空间的克隆。</block>
  <block id="b96bb0cd2ebc0389b6670602ac80d983" category="list-text">构建快速有效的灾难恢复系统的能力。</block>
  <block id="9e060ad00fced94f2616dd71fbc49f76" category="paragraph">在以下情况下、您可能更愿意选择NetApp的高级备份合作伙伴、例如Veeam Software和Commvell：</block>
  <block id="0ee17b3b55ea2b0af3d90985bc347775" category="list-text">管理异构环境中的工作负载</block>
  <block id="88fbde7bbe0274fbe9e7ce01c563d03c" category="list-text">将备份存储到云或磁带以供长期保留</block>
  <block id="445e3e0cce7f959696dde65b3be27843" category="list-text">支持多种操作系统版本和类型</block>
  <block id="21c5d67cc22beaf7d7c9c84c8deaabbe" category="paragraph">适用于PostgreSQL的SnapCenter插件是社区支持的插件、安装和文档可从NetApp自动化商店获得。通过SnapCenter、用户可以远程备份数据库、克隆和还原数据。</block>
  <block id="7d334ca369e4a752ec91b1503183f0ed" category="summary">适用于SAP HANA和AnyDB的解决方案</block>
  <block id="1ac73696f4529e3901b0d4e5430365cb" category="doc">SAP HANA和采用AnyDB的SAP</block>
  <block id="2c1b27a986b5e37a810d61f72b23ee4b" category="paragraph">有关配置、管理和自动化SAP解决方案的最佳实践、请参见NetApp SAP解决方案页面。</block>
  <block id="6c92285fa6d3e827b198d120ea3ac674" category="inline-link-macro">此处</block>
  <block id="ee1e67308b27672a8f54eace4c615a98" category="paragraph">请单击 <block ref="c95e4a3e1de9e00fefc4bf8a7ce42893" category="inline-link-macro-rx"></block> 了解更多信息。</block>
  <block id="beb3ca55ed0a53a38a2b97540b05d6e4" category="summary">基于ONTAP的Microsoft SQL Server</block>
  <block id="7636ae91f443b605f05bed59d7d57a02" category="doc">Microsoft SQL Server灾难恢复</block>
  <block id="810304d54e0a61663cfc457b0894037b" category="paragraph">NetApp提供了各种方法来提高硬件、软件或站点出现故障时的数据可用性。</block>
  <block id="9c1e9d82d3220658621f72dca978adb0" category="section-title">NetApp SnapMirror</block>
  <block id="46983273062fdc8ce8561a9ce89cdc5b" category="paragraph">NetApp SnapMirror技术可提供快速灵活的企业级解决方案、用于通过LAN和广域网镜像或复制数据。在初始基本传输之后、SnapMirror技术仅会将修改后的4 KB数据块传输到目标、从而显著降低网络带宽要求。SnapMirror可根据所配置的复制更新间隔提供异步卷级复制。
下面是有关适用于SQL Server的SnapMirror的建议：</block>
  <block id="5f3bfe8f92842bdc2f9455d4102f2531" category="list-text">如果使用CIFS、则目标SVM必须是源SVM所属的同一Active Directory域的成员、以便在灾难恢复期间不会破坏NAS文件中存储的访问控制列表(ACL)。</block>
  <block id="e0fd410ebdc68e7ca628bbca66b63ff4" category="list-text">使用与源卷名称相同的目标卷名称并不是必需的、但这样可以简化将目标卷挂载到目标的过程、使其易于管理。如果使用CIFS、则必须使目标NAS命名空间与源命名空间的路径和目录结构完全相同。</block>
  <block id="14b01fb6bdbebef1f8a00c7f84926307" category="list-text">为保持一致、请勿从控制器计划SnapMirror更新。但是、请从SnapCenter启用SnapMirror更新、以便在完成完整备份或日志备份后更新SnapMirror。</block>
  <block id="18c6a681ea46e1ed394e092461bb53ef" category="list-text">将包含SQL Server数据的卷分布在集群中的不同节点上、以允许所有集群节点共享SnapMirror复制活动。此分布可优化节点资源的使用。</block>
  <block id="0a01e6837f5c691536f0b6cbdd0232ec" category="inline-link-macro">TR-4015：《适用于ONTAP 9的SnapMirror配置和最佳实践指南》</block>
  <block id="1cca1a3fad8c6dd7e2dadbd2aa08bf07" category="paragraph">有关SnapMirror的详细信息、请参见 <block ref="64b916f792bad525a069a243c092b62e" category="inline-link-macro-rx"></block>。</block>
  <block id="3d4b417d78ff0ef4c84f0c043de24b10" category="doc">数据库安全性</block>
  <block id="77641f4a3e4406855e878235cbd89b87" category="doc">CPU配置</block>
  <block id="a51adad5719779145ac252822e328611" category="section-title">超线程</block>
  <block id="fe520b79816bad6a21fbebcb205c7ca9" category="paragraph">超线程是英特尔专有的同步多线程(SMT)实施、它可以改进在x86微处理器上执行的并行化(多任务处理)。</block>
  <block id="005f484c2235e04f39d2e69256147281" category="paragraph">使用超线程的硬件允许逻辑超线程CPU在操作系统中显示为物理CPU。然后、SQL Server会看到操作系统提供的物理CPU、因此可以使用超线程处理器。</block>
  <block id="673c216e20d1cf8827f347c01dace664" category="paragraph">此处需要注意的是、每个SQL Server版本都有自己的计算能力限制。有关详细信息、请参见计算容量限制(按SQL Server版本)。</block>
  <block id="932a9271c08db114962ce3791480f371" category="paragraph">在许可SQL Server时、主要有两种思路。第一种称为服务器+客户端访问许可证(CAL)模式；第二种是按处理器核心模式。尽管使用server + CAL策略可以访问SQL Server中提供的所有产品功能、但每个插槽的硬件限制为20个CPU核心。即使每个插槽的CPU核心数超过20个的服务器具有SQL Server Enterprise Edition + CAL、应用程序也无法在该实例上一次使用所有这些核心。图显示了启动后指示核心限制强制实施的SQL Server日志消息。</block>
  <block id="d06fce44fdcf20791141e7585205a477" category="section-title">日志条目表示SQL Server启动后使用的核心数。</block>
  <block id="cf0e2551e639758cc3c4d82df655eccd" category="inline-link-macro">SQL Server 2022：您的现代数据平台</block>
  <block id="809c9e1f6ce0bc82bf42fae361c6f43e" category="paragraph">因此、要使用所有CPU、应使用每个处理器的核心许可证。有关SQL Server许可的详细信息、请参见 <block ref="457abfaf1083b1cbfc49f2783069c6cd" category="inline-link-macro-rx"></block>。</block>
  <block id="cb8d56a3511d402b7355db8502a54c5a" category="section-title">CPU关联性</block>
  <block id="884be48d06a17be095fb51de089dfc89" category="paragraph">除非遇到性能问题、否则您不太可能需要更改处理器关联性默认值、但仍然值得了解它们是什么以及它们的工作原理。</block>
  <block id="74f896768ee487acfd4c42370c202bed" category="paragraph">SQL Server通过两个选项支持处理器关联性：</block>
  <block id="cb315fb2b62c836ba51357d46f2e8c3f" category="list-text">CPU相关性掩码</block>
  <block id="cb00a2408ea648cf85edfd7dbb23fbe0" category="list-text">相关性I/O掩码</block>
  <block id="14ad08466dec6635067b988a82e91a8e" category="paragraph">SQL Server使用操作系统中可用的所有CPU (如果选择了按处理器核心许可证)。它会在所有CPU上创建计划程序、以便充分利用任何给定工作负载的资源。多任务处理时，操作系统或服务器上的其他应用程序可以将进程线程从一个处理器切换到另一个处理器。SQL Server是一个资源密集型应用程序、因此、发生这种情况时、性能可能会受到影响。为了最大限度地降低影响、您可以对处理器进行配置、使所有SQL Server负载都定向到一组预先选择的处理器。这可通过使用CPU相关性掩码来实现。</block>
  <block id="28a51b601de21080b76fe2d8b2ec8101" category="paragraph">相关性I/O掩码选项可将SQL Server磁盘I/O绑定到一部分CPU。在SQL Server OLTP环境中、此扩展可以提高发出I/O操作的SQL Server线程的性能。</block>
  <block id="49e103832576f4486179df8868372d17" category="section-title">最大平行度(MAXDOP)</block>
  <block id="f7e9f8e341a301aec4560db108b93020" category="paragraph">默认情况下、SQL Server会在查询执行期间使用所有可用的CPU (如果选择了按处理器的核心许可证)。</block>
  <block id="9bdcdbe52ea41cf96b314b7b7671bd2a" category="paragraph">尽管这非常适合大型查询、但它可能会出现发生原因性能问题并限制并发性。一种更好的方法是、将并行处理限制为单个CPU插槽中的物理核心数。例如、如果服务器具有两个物理CPU插槽、每个插槽具有12个核心、而不考虑超线程、则MAXDOP应设置为12。MAXDOP不能限制或指定要使用的CPU。相反、它会限制单个批处理查询可使用的CPU数量。</block>
  <block id="1a6b79859b80796a108bd348f98856f6" category="admonition">* NetApp建议*对于数据仓库等DSS，请从50左右的设置开始，然后根据需要进行调整或下调。请确保测量应用程序中的关键查询、并在必要时进行调整。</block>
  <block id="a99f7ebb3b0f5b0ecea93ed586b2a17d" category="section-title">最大工作线程数</block>
  <block id="aff27140f50a549b1331add8d5025f7e" category="paragraph">最大工作线程数选项有助于在大量客户端连接到SQL Server时优化性能。</block>
  <block id="aefc7f2ee96effbbbe49e6ece6d2f72a" category="paragraph">通常、系统会为每个查询请求创建一个单独的操作系统线程。如果与SQL Server同时建立了数百个连接、则每个查询请求一个线程会占用大量系统资源。最大工作线程数选项可使SQL Server创建一个工作线程池来处理大量查询请求、从而有助于提高性能。</block>
  <block id="decd79137325e1efbc7b994f946ea24f" category="paragraph">默认值为0、这允许SQL Server在启动时自动配置工作线程数。这适用于大多数系统。最大工作线程数是一个高级选项、没有经验丰富的数据库管理员(Database Administrator、DBa)的帮助、不得更改。</block>
  <block id="030a270970f70c1bd91d3689b6f95f3f" category="inline-link-macro">配置最大工作线程数服务器配置选项</block>
  <block id="2a0c648df721b9bc2643d59c4a3a310a" category="paragraph">应在何时配置SQL Server以使用更多工作线程？如果每个计划程序的平均工作队列长度超过1、则向系统添加更多线程可能会更有用、但前提是负载不受CPU制约或遇到任何其他繁重等待。如果出现上述任一情况、添加更多线程将毫无帮助、因为它们最终会等待其他系统瓶颈。有关最大工作线程数的详细信息、请参见 <block ref="77c391df5f9f06cdf367c2a7314ce351" category="inline-link-macro-rx"></block>。</block>
  <block id="29d04e616d2293c4c7538dd6226feac5" category="section-title">使用SQL Server Management Studio配置最大工作线程数。</block>
  <block id="5962130d833e0408cf58a87e342bc1f9" category="doc">Microsoft SQL Server tempdb文件</block>
  <block id="625156cc6cef9a3c56b1b535579bd2c9" category="paragraph">NetApp建议主动将tempdb文件增大到其全满大小、以避免磁盘碎片化。</block>
  <block id="ca75041d415f4dafabb49b7f06b634ed" category="paragraph">如果SQL Server必须向特殊系统页面写入数据以分配新对象、则全局分配映射(GAM)、共享全局分配映射(SGAM)或页面可用空间(PFS)页面上可能会发生页面争用。闩锁保护(锁定)内存中的这些页面。在繁忙的SQL Server实例上、可能需要很长时间才能在tempdb中的系统页面上获得锁定。这会导致查询运行时间变慢、并称为闩锁争用。请参见以下创建tempdb数据文件的最佳实践：</block>
  <block id="44dbc82801d84781083ed9e23b63be00" category="list-text">对于&lt;或=最多8个核心：tempdb数据文件=核心数</block>
  <block id="6203fcdbdad10bb603fd00edd2f0fcf5" category="list-text">对于超过8个核心：8个tempdb数据文件</block>
  <block id="b9f341e4fb0e6b384aa7ec0b5c33f964" category="paragraph">以下示例脚本通过创建八个tempdb文件并将tempdb移动到挂载点来修改tempdb<block ref="ae6fbe62f3ddc46fa9a9885244d23675" prefix=" " category="inline-code"></block> 适用于SQL Server 2012及更高版本。</block>
  <block id="0424163d6b24f29436021dfd7072863b" category="paragraph">从SQL Server 2016开始、安装期间会自动检测操作系统可见的CPU核心数、SQL Server会根据该数量计算和配置获得最佳性能所需的tempdb文件数。</block>
  <block id="1c5b37437282a3648dde78afd914e452" category="doc">Microsoft SQL Server概述</block>
  <block id="9aa5016539f88d8f1972a16ce9babd34" category="paragraph">SQL Server是Microsoft数据平台的基础、可通过内存技术提供任务关键型性能、并加快对任何数据(无论是内部数据还是云数据)的洞察力。</block>
  <block id="8133a02d7327679696821fb31b105177" category="paragraph">Microsoft SQL Server基于先前版本中提供的任务关键型功能构建、为任务关键型应用程序提供突破性的性能、可用性和易管理性。存储系统是影响SQL Server数据库整体性能的关键因素。NetApp提供了多种产品、使您的SQL Server数据库能够提供企业级性能、同时提供世界一流的工具来管理您的环境。</block>
  <block id="0bdfc026961d516d3d473152b4b6a87e" category="section-title">目的和范围</block>
  <block id="d0554e23b25bb82082a0cd9eaf810d0f" category="paragraph">本节介绍在运行NetApp ONTAP软件的NetApp存储系统上部署SQL Server的最佳实践、并深入介绍相关设计注意事项、目的是实现高效的存储部署以及端到端数据保护和保留规划。本指南的范围仅限于根据NetApp在部署SQL Server时为存储基础架构建议的设计原则和首选标准制定的技术设计准则。端到端实施不在本报告的讨论范围之内。</block>
  <block id="cf4cab9c6fd24025b34dfcae06e9b6fc" category="paragraph">通过本指南中介绍的最佳实践和建议、SQL Server架构师和NetApp存储管理员可以规划高度可用且易于管理的SQL Server环境、并满足严格的SLA要求。NetApp假定读者具备以下方面的实践知识：</block>
  <block id="9801f873fe2232da0de3cbab00483bfb" category="list-text">NetApp ONTAP软件</block>
  <block id="3b5b2ca12603a36517ce602ffe47361c" category="list-text">NetApp SnapCenter作为备份软件、其中包括：</block>
  <block id="36a92a010308100e1efc10d9eb98c369" category="list-text">适用于 Microsoft Windows 的 SnapCenter 插件</block>
  <block id="ec51578d7d8f930329548bf3d00d7038" category="list-text">适用于SQL Server的SnapCenter插件</block>
  <block id="a6d698a68f555339f6e91957f636ad69" category="list-text">Microsoft SQL Server架构和管理</block>
  <block id="697ea025ecb303d4f40d1bf3a8b4bde0" category="inline-link-macro">NetApp 互操作性表工具（ IMT ）</block>
  <block id="c02eaaaf0eed9e51c3a9e1e9ae8b9147" category="paragraph">有关整个NetApp堆栈的配置兼容性、请参见 <block ref="ea0e6fe442c1f7a042a8853ffcc2b382" category="inline-link-macro-rx"></block>。</block>
  <block id="fbd4c4f9516af91c6c3cb5fa35fb5720" category="doc">Microsoft SQL Server存储注意事项</block>
  <block id="8c2a9e7195a263b5d79d397f5c6a9f68" category="paragraph">通过将NetApp存储解决方案与Microsoft SQL Server相结合、可以创建企业级数据库存储设计、以满足当今最苛刻的应用程序要求。</block>
  <block id="8136e237a15b0f72e5d7a60392225d17" category="paragraph">要优化这两种技术、了解SQL Server I/O模式和特征至关重要。SQL Server数据库的存储布局设计合理、可支持SQL Server的性能以及SQL Server基础架构的管理。良好的存储布局还可以成功完成初始部署、并随着业务的增长逐步平稳地扩展环境。</block>
  <block id="3da07c62fca4dd242f7ffcfcf72998be" category="section-title">数据存储设计</block>
  <block id="9e45010900186b3cbbe04f954a6f3562" category="paragraph">对于不使用SnapCenter 执行备份的SQL Server数据库、Microsoft建议将数据和日志文件放置在不同的驱动器上。对于同时更新和请求数据的应用程序、日志文件会占用大量写入资源、而数据文件(取决于您的应用程序)会占用大量读/写资源。对于数据检索、不需要日志文件。因此、可以通过放置在其自己驱动器上的数据文件来满足数据请求。</block>
  <block id="df018ea4abdb71f91802ea1d4fb0fb37" category="inline-link-macro">将数据和日志文件放在不同的驱动器上</block>
  <block id="f2f25c68d67c561be1926b4b06e676b0" category="paragraph">创建新数据库时、Microsoft建议为数据和日志指定单独的驱动器。要在创建数据库后移动文件、必须使数据库脱机。有关Microsoft的更多建议、请参见 <block ref="04fab8828edf0d2e95eff3c4f124b372" category="inline-link-macro-rx"></block>。</block>
  <block id="d5350d8759b1ec84607e47908809058e" category="section-title">聚合</block>
  <block id="b8212b86fca1dcaeb0438529a03212c3" category="paragraph">聚合是NetApp存储配置的主存储容器、包含一个或多个RAID组、其中既包含数据磁盘、又包含奇偶校验磁盘。NetApp已使用数据文件和事务日志文件分开的共享和专用聚合执行了各种I/O工作负载特征化测试。测试表明、一个具有更多RAID组和磁盘轴的大型聚合可以优化和提高存储性能、并使管理员更易于管理、原因有两个：</block>
  <block id="5f9196be7c85ebe3a38375ace1f3a345" category="list-text">一个大型聚合可使所有磁盘轴的I/O功能对所有文件可用。</block>
  <block id="77f1d6b9cbcaf3663f6bdd19a821e773" category="list-text">一个大型聚合可以最高效地利用磁盘空间。</block>
  <block id="63d9962fabe500361986d05317bd65a5" category="paragraph">对于高可用性(HA)、请将SQL Server Always On可用性组二级同步副本放在聚合中的一个单独Storage Virtual Machine (SVM)上。为了实现灾难恢复、请将异步副本放置在灾难恢复站点中单独存储集群中的聚合上、并使用NetApp SnapMirror技术复制内容。NetApp建议在聚合中至少留出10%的可用空间、以获得最佳存储性能。</block>
  <block id="c6f01c78bfe0a0a495cb5d3ed77824a9" category="section-title">Volumes</block>
  <block id="5ec65e803efce0f0779c59e4df9b2a71" category="paragraph">NetApp FlexVol卷会创建并驻留在聚合中。可以在一个聚合中创建多个卷、并且每个卷都可以在聚合之间进行扩展、减少或移动、而无需用户停机。</block>
  <block id="17fce39141e6fa457c789ce2c3239b0c" category="section-title">卷设计注意事项</block>
  <block id="d1c9fdbcdbb8521971decf35c6d1c0c8" category="paragraph">在创建数据库卷设计之前、请务必了解SQL Server I/O模式和特征如何根据工作负载以及备份和恢复要求而有所不同。请参见以下适用于灵活卷的NetApp建议：</block>
  <block id="570f1006846b0d45ff44b4332b9b4d14" category="list-text">使用灵活卷存储SQL Server数据库文件、并避免在主机之间共享卷。</block>
  <block id="674343739e297abb52c536a453ebaad0" category="list-text">使用NTFS挂载点而不是驱动器盘符、以超过Windows中26个驱动器盘符的限制。使用卷挂载点时、一般建议为卷标签指定与挂载点相同的名称。</block>
  <block id="d5fe4f7f1c47df1ec78c926d21498f73" category="list-text">适当时、配置卷自动调整策略以帮助防止出现空间不足情况。17采用ONTAP的Microsoft SQL Server最佳实践指南©2022 NetApp、Inc. 保留所有权利。</block>
  <block id="fdb3a973962ea77cf56d76e12cff8c7d" category="list-text">当SQL Server数据库I/O配置文件大部分包含大型顺序读取(例如决策支持系统工作负载)时、在卷上启用读取重新分配。读取重新分配可优化块以提供更好的性能。</block>
  <block id="3a9320cf27fb328f77ec6153273784d5" category="list-text">如果在SMB共享上安装SQL Server、请确保在SMB/Cifis卷上启用了Unicode以创建文件夹。</block>
  <block id="08a6901e4e7b04d6170563bc57864093" category="list-text">将卷中的NetApp Snapshot副本预留值设置为零、以便于从操作角度进行监控。</block>
  <block id="156ce9adf6c474183396aa3cfb8f92f1" category="list-text">禁用存储Snapshot™副本计划和保留策略。请改用SnapCenter来协调SQL Server数据卷的Snapshot副本。</block>
  <block id="f2e00c12259a4bb11608f2a12fc8014a" category="list-text">将SQL Server系统数据库放在专用卷或VMDK上。</block>
  <block id="4176288dbc134524f79476ba4e57e3aa" category="list-text">tempdb是一个系统数据库、SQL Server会使用它作为临时工作空间、尤其是用于I/O密集型DBCC CHECKDB操作。因此、请将此数据库放在具有一组单独磁盘轴的专用卷上。在卷数量是一项挑战的大型环境中、您可以在仔细规划后将tempdb整合到较少的卷中、并将其与其他系统数据库存储在同一个卷中。tempdb的数据保护不是高优先级、因为每次重新启动SQL Server时都会重新创建此数据库。</block>
  <block id="57eda1aa66778bf3c77caa0294652ba8" category="list-text">将用户数据文件(.mdf)放在不同的卷上、因为它们是随机读/写工作负载。通常、创建事务日志备份的频率比创建数据库备份的频率更高。因此、请将事务日志文件(.ldf)放置在与数据文件不同的卷或VMDK上、以便可以为每个卷或VMDK创建独立的备份计划。这种分离还会将日志文件的顺序写入I/O与数据文件的随机读/写I/O隔离开来、并显著提高SQL Server性能。</block>
  <block id="b26e74ed6e2892c7e2bb95e414d460c6" category="section-title">LUN</block>
  <block id="b703a2ceaabee81dd9dfcfb3a4b738ee" category="list-text">确保用户数据库文件和用于存储日志备份的日志目录位于不同的卷上、以防止保留策略在SnapVault技术中使用快照时覆盖这些快照。</block>
  <block id="152bb9192ea87919eda3b4f97fd4e1bf" category="list-text">确保SQL Server数据库与包含非数据库文件(如全文搜索相关文件)的LUN驻留在不同的LUN上。</block>
  <block id="e2faf723544ceb1ea01ba41cef2d633a" category="list-text">将数据库二级文件(作为文件组的一部分)放在不同的卷上可提高SQL Server数据库的性能。只有当数据库的.mdf文件不与任何其他.mdf文件共享其LUN时、此分隔才有效。</block>
  <block id="ae72f885471636cbfd0dbe902ddf24e1" category="list-text">如果使用DiskManager或其他工具创建LUN、请确保在格式化LUN时将分区的分配单元大小设置为64K。</block>
  <block id="ac4782a9243acaaff52164f9e47417d5" category="inline-link-macro">Microsoft Windows和本机MPIO、并遵循适用于现代SAN的ONTAP最佳实践</block>
  <block id="934e206705ddafc720e4a8f25a4acded" category="list-text">请参见 <block ref="95506eaa4fca841adc20747ae4650d10" category="inline-link-macro-rx"></block> 在MPIO属性中将Windows上的多路径支持应用于iSCSI设备。</block>
  <block id="31a8d85b6a44cffc2c7dfc6387696f31" category="section-title">日志目录</block>
  <block id="973781a026becacffaae9fd5fd5c2b7b" category="paragraph">在SQL Server中指定日志目录、用于在主机级别存储事务日志备份数据。如果使用SnapCenter备份日志文件、则SnapCenter使用的每个SQL Server主机都必须配置一个主机日志目录、才能执行日志备份。SnapCenter 具有一个数据库存储库、因此与备份、还原或克隆操作相关的元数据存储在一个中央数据库存储库中。</block>
  <block id="29766ed5967263787fface0a4ad3396f" category="paragraph">主机日志目录的大小计算如下：
主机日志目录大小=((最大数据库LDF大小x每日日志更改率%) x (快照保留)÷(1 - LUN开销空间%)
主机日志目录规模估算公式假定LUN开销空间为10%</block>
  <block id="31333b887781902e13c263570523ddc1" category="paragraph">将日志目录放在专用卷或LUN上。主机日志目录中的数据量取决于备份的大小以及备份的保留天数。SnapCenter只允许每个SQL Server主机有一个主机日志目录。您可以在SnapCenter --&gt; Host --&gt; Configure Plug-in中配置主机日志目录。</block>
  <block id="e815059019027c04aa969a50787d5b34" category="paragraph">* NetApp建议*对主机日志目录执行以下操作：</block>
  <block id="07ae4edb1ccfbfe1f5da6006c95ee4a9" category="list-text">确保主机日志目录不会被任何可能损坏备份快照数据的其他类型的数据共享。</block>
  <block id="991bd1f492a593453f65c2a23c1f1612" category="list-text">请勿将用户数据库或系统数据库放置在托管挂载点的LUN上。</block>
  <block id="bdfdf6f1492d7a7beac0bce2c4109f95" category="list-text">在SnapCenter将事务日志复制到的专用FlexVol卷上创建主机日志目录。</block>
  <block id="7b01578e73f5081fecdcc6dedf28aa3c" category="list-text">使用SnapCenter向导将数据库迁移到NetApp存储、以便数据库存储在有效位置、从而成功执行SnapCenter备份和还原操作。请注意、迁移过程会造成系统中断、并且在迁移过程中、发生原因会使数据库脱机。</block>
  <block id="b2d0e2f60ee139155b728ef6933efe7c" category="list-text">对于SQL Server的故障转移集群实例(FCIS)、必须满足以下条件：</block>
  <block id="863fda0972208e1e15d0c4a16d6915af" category="list-text">如果您使用的是故障转移集群实例、则主机日志目录LUN必须是与要备份的SQL Server实例位于同一集群组中的集群磁盘资源SnapCenter。</block>
  <block id="ddb1104e1e71caabad3e7639c7675af8" category="list-text">如果您使用的是故障转移集群实例、则必须将用户数据库置于共享LUN上、这些共享LUN是分配给与SQL Server实例关联的集群组的物理磁盘集群资源。</block>
  <block id="bca5f9a18696e080113088282fe481de" category="doc">Microsoft SQL Server内存配置</block>
  <block id="02578ec0e8ce2fbef37ca792fd20c289" category="section-title">最大服务器内存</block>
  <block id="81dbc262a15fc545920141998ddd1c17" category="paragraph">最大服务器内存选项用于设置SQL Server实例可以使用的最大内存量。</block>
  <block id="c9fa383209ffc05f20049101298fec96" category="paragraph">通常、如果多个应用程序运行在运行SQL Server的同一服务器上、并且您希望保证这些应用程序具有足够的内存来正常运行、则使用此方法。</block>
  <block id="1ceeb5f5f18aefbc39e34d0d3c7b7e1c" category="paragraph">某些应用程序仅在启动时使用可用的内存、即使需要也不会请求更多内存。这就是最大服务器内存设置的作用所在。</block>
  <block id="6e345f11e9b2856a7ac40d6cf283606b" category="paragraph">在包含多个SQL Server实例的SQL Server集群上、每个实例可能会争用资源。为每个SQL Server实例设置内存限制有助于保证每个实例的最佳性能。</block>
  <block id="318b34a3511a1be6d179a73303da2077" category="admonition">*RAM NetApp建议*为操作系统至少保留4GB到6GB的内存，以避免出现性能问题。</block>
  <block id="cd151dbdf946ad6bd27e1d55ea1cd029" category="section-title">使用SQL Server Management Studio调整最小和最大服务器内存。</block>
  <block id="2e0d4de7d927936246f5537ba48015d2" category="paragraph">使用SQL Server Management Studio调整最小或最大服务器内存需要重新启动SQL Server服务。您可以使用Transact SQL (T-SQL)通过以下代码调整服务器内存：</block>
  <block id="998c5e632fa0f987c20c182fc9322f67" category="section-title">非一致内存访问</block>
  <block id="d92030bf70ac1cf1da30ce4c9ab2bbf6" category="paragraph">非一致内存访问(Nonun均匀 内存访问、NMA)是一种内存访问优化方法、可帮助提高处理器速度、而不增加处理器总线上的负载。</block>
  <block id="6ef102e61df24a50b0119558432f5623" category="paragraph">如果在安装了SQL Server的服务器上配置了NUMA、则无需进行其他配置、因为SQL Server可以识别NUMA、并且在NUMA硬件上性能良好。</block>
  <block id="b3b5cd113ed637ebe6cb28eab322307a" category="section-title">索引创建内存</block>
  <block id="8e7c0153e4b7aa851a5a62683c378d1c" category="paragraph">index create memory选项是另一个高级选项、通常不应更改。</block>
  <block id="631c6718cc62ad33b6e3b3b48d754569" category="paragraph">它控制最初为创建索引而分配的最大RAM量。此选项的默认值为0、这意味着它由SQL Server自动管理。但是，如果在创建索引时遇到困难，请考虑增加此选项的值。</block>
  <block id="8c91aa3f5264c57bd2d2e66bd70f2ad1" category="section-title">每个查询的最小内存</block>
  <block id="027d5a3eabe88aa0ab705b9c4a2fe096" category="paragraph">运行查询时、SQL Server会尝试分配最佳内存量、以使其高效运行。</block>
  <block id="4c7836a7e63c3ecb3f6860ec19643561" category="paragraph">默认情况下、每个查询的最小内存设置会为要运行的每个查询分配&gt;或=到1024KB的空间。最佳做法是、将此设置保留为默认值0、以允许SQL Server动态管理为索引创建操作分配的内存量。但是、如果SQL Server的RAM超过高效运行所需的RAM、则提高此设置可以提高某些查询的性能。因此、只要SQL Server、任何其他应用程序或操作系统未使用服务器上的可用内存、则提高此设置就可以提高SQL Server的整体性能。如果没有可用内存，则增加此设置可能会影响整体性能。</block>
  <block id="d2a88da9a0fcc96168f8f051909d5599" category="section-title">缓冲池扩展</block>
  <block id="11a3fdcfeb0715eaf26e855034f6ab9a" category="paragraph">通过缓冲池扩展、可以将NVRAM扩展与数据库引擎缓冲池无缝集成、从而显著提高I/O吞吐量。</block>
  <block id="c722da593d2f37b2c1ffc91a10c03dad" category="paragraph">并非每个SQL Server版本都提供缓冲池扩展。它仅适用于64位SQL Server Standard、Business Intelligence和Enterprise版本。</block>
  <block id="df07548a7c164cbe93b68c4cbebbdcf8" category="paragraph">缓冲池扩展功能可使用非易失性存储(通常为SSD)扩展缓冲池缓存。扩展后、缓冲池可以容纳更大的数据库工作集、从而强制在RAM和SSD之间分页I/O、并有效地将小型随机I/O从机械磁盘卸载到SSD。由于SSD的延迟较低且随机I/O性能较高、因此缓冲池扩展功能可显著提高I/O吞吐量。</block>
  <block id="54af95ef673718e2f8bf1cc873d8b3ce" category="paragraph">缓冲池扩展功能具有以下优势：</block>
  <block id="2c250b49dc6705e6d219cf2bf8d50bc5" category="list-text">提高了随机I/O吞吐量</block>
  <block id="93dce890e8c62b3a651edb9098201e58" category="list-text">降低I/O延迟</block>
  <block id="d7e49f79c1b78c9ead1e9541d2160307" category="list-text">提高了事务处理吞吐量</block>
  <block id="6643befb3c9dc2fbb68fe1107fe24842" category="list-text">利用更大的混合缓冲池提高读取性能</block>
  <block id="6609220b8670ffd627a3663b3beef46b" category="list-text">一种可利用现有和未来低成本内存的缓存架构</block>
  <block id="471bda18bb94c589b421edccb0e402fe" category="paragraph">* NetApp建议*将缓冲池扩展配置为：</block>
  <block id="12810c53d2afa05bd2a75aa3c0c55592" category="list-text">确保向SQL Server主机提供SSD支持的LUN (例如NetApp AFF)、以便将其用作缓冲池扩展目标磁盘。</block>
  <block id="824cfa1576a82f89ee0af13fb9f086dc" category="list-text">扩展文件的大小必须等于或大于缓冲池。</block>
  <block id="c7e0d87e723625072015431887edf349" category="paragraph">以下示例显示了一个T-SQL命令、用于设置32 GB的缓冲池扩展名。</block>
  <block id="7ef20d2374bc8b734222e4ec2f0f3643" category="doc">Microsoft SQL Server的ONTAP存储效率</block>
  <block id="e5bc122522e9ae1409590d9944ec4421" category="paragraph">存储效率是指存储和管理SQL Server数据的能力、其占用的存储空间最少、对系统整体性能几乎没有影响、甚至没有影响。</block>
  <block id="2d3c9d6f03cd640c224f5daf9c2352b0" category="paragraph">SQL Server还具有压缩和高效管理数据的功能。SQL Server目前支持两种类型的数据压缩：行压缩和页面压缩。</block>
  <block id="181341700086c5e2f2259774b2aaa59c" category="inline-link-macro">页面压缩实施</block>
  <block id="46c6aaf21d639d23d4f297a1f6922d9a" category="paragraph">行压缩会更改数据存储格式。例如、它会将整数和小数更改为可变长度格式、而不是其本机固定长度格式。此外、它还会通过消除空格将固定长度字符串更改为可变长度格式。页面压缩可实现行压缩和另外两种压缩策略(前缀压缩和词典压缩)。有关页面压缩的详细信息、请参见 <block ref="88eab602b149fe360da37498ad5cdeae" category="inline-link-macro-rx"></block>。</block>
  <block id="0d629ff07f9214182fa91977089ff029" category="paragraph">SQL Server 2008及更高版本的企业版、开发人员版和评估版目前支持数据压缩。虽然数据压缩可以由数据库本身执行、但在SQL Server环境中很少会出现这种情况。</block>
  <block id="c6757fbc56df4ba20f0ef165aeb214d0" category="paragraph">下面是管理SQL Server数据文件空间的建议</block>
  <block id="46344e63db1ea2128cc47543b10a0f96" category="list-text">在SQL Server环境中使用精简配置可提高空间利用率、并在使用空间保证功能时降低整体存储需求。</block>
  <block id="924e1b131d6b3a2846efd1a81de8eac1" category="list-text">对最常见的部署配置使用自动增长、因为存储管理员只需要监控聚合中的空间使用量。</block>
  <block id="13a233d96ce19e7530391105360d749b" category="list-text">建议不要在包含SQL Server数据文件的任何卷上启用重复数据删除、除非该卷已知包含同一数据的多个副本、例如、将数据库从备份还原到单个卷。</block>
  <block id="752d71c042ef775879f6db705ccf6b31" category="section-title">空间回收</block>
  <block id="89f8656e4e33094d6011ef9aaa8fa8de" category="paragraph">可以定期启动空间回收、以恢复LUN中未使用的空间。对于SnapCenter、您可以使用以下PowerShell命令启动空间回收。</block>
  <block id="aa864feb1e600aa376e91ac119da387b" category="paragraph">如果需要运行空间回收、则应在活动较少的时段运行此过程、因为它最初会占用主机上的周期。</block>
  <block id="a356c94dff23a233551ff221e74a144d" category="summary">使用ONTAP保护Microsoft SQL Server数据</block>
  <block id="731c00fe6475fb22aece82ffa9d74ef3" category="paragraph">保护数据库对于任何组织都至关重要。随着数据大小和数据库数量的增加、维护恢复时间目标(RTO)和恢复点目标(RPO)至关重要。</block>
  <block id="5c014f8939a89da0166a347a0237cf4f" category="section-title">SnapCenter</block>
  <block id="2ddb1872f6c378e74cb7269e9de4c4e5" category="paragraph">SnapCenter是适用于企业应用程序的NetApp数据保护软件。使用NetApp SnapCenter软件以及适用于SQL Server的插件和适用于Microsoft Windows的插件、可以快速轻松地保护SQL Server数据库。</block>
  <block id="bdc6c0cf646d837838203c2980eba84a" category="paragraph">此产品支持应用程序一致的备份、自动克隆以及SQL Server数据库、实例或可用性组的还原和恢复。</block>
  <block id="2450e19674db2a865555d3c04563e647" category="admonition">* NetApp建议*使用SnapCenter创建Snapshot副本。</block>
  <block id="1567bc0803275089d7cbc1ffc468158c" category="inline-link-macro">TR-4714：《使用NetApp SnapCenter的SQL Server最佳实践指南》</block>
  <block id="17f58c1b5cb5feb5dcaf49ca87298c00" category="paragraph">有关适用于SnapCenter的SQL Server插件的详细信息、请参见 <block ref="c94de7812b9bc9ed76b3c4005974958d" category="inline-link-macro-rx"></block>。</block>
  <block id="91a7baba41dc4b5f958101b261cf179b" category="section-title">使用T-SQL快照保护数据库</block>
  <block id="e158e137ead13fd14e064b875e45df20" category="paragraph">在SQL Server 2022中、Microsoft引入了T-SQL快照、与数据库管理员不易使用的传统方法相比、它具有内置优势。利用ONTAP REST API、您可以调用命令来创建卷快照。</block>
  <block id="02e19b2989ebddca9ad3778807bdc426" category="paragraph">以下是备份工作流示例：</block>
  <block id="17884d5a1cfc06145e718a49c8d6ac66" category="list-text">使用alter命令冻结数据库—提供在底层存储上执行一致快照的机会。之后、您可以使用backup命令解冻数据库并记录快照。</block>
  <block id="bd03301405e4dd8f2460ff1788765ac4" category="list-text">使用新的backup group和backup server命令同时对存储卷上的多个数据库执行快照。</block>
  <block id="a3b19be7df3ddff7295558d9934cd9b6" category="list-text">执行完整备份或copy_only完整备份。这些备份也会记录在msdb中。</block>
  <block id="e2d06152222f63515f4b83229cb5444c" category="list-text">在快照完整备份之后、使用通过正常流式传输方法创建的日志备份执行时间点恢复。如果需要、还支持流式差异备份。</block>
  <block id="a7a2496066febda8d325e0964e434481" category="inline-link-macro">了解T-SQL快照的Microsoft文档</block>
  <block id="bf06f3f95c5b653499bb4ac53ba44c95" category="paragraph">要了解更多信息，请参见 <block ref="2ba8392a398067f6d2e5f6e4167e9d00" category="inline-link-macro-rx"></block>。</block>
  <block id="450eb6d84ec721a20f17b7778b24b457" category="doc">Microsoft SQL Server工作负载</block>
  <block id="764e07fc8f1f5e2d1b9fc63f83b88cbd" category="paragraph">SQL Server数据库平台可以支持许多应用程序。</block>
  <block id="25343e3363b414e89943f5a4e46f51ad" category="paragraph">在部署SQL Server之前、您必须了解SQL Server实例支持的应用程序的数据库工作负载要求。每个应用程序对容量、性能和可用性有不同的要求、因此每个数据库的设计都应以最佳方式支持这些要求。许多组织使用应用程序要求定义SLA、将数据库分为多个管理层。SQL Server工作负载可以描述如下：</block>
  <block id="c6a1c5843ff7b078079edf24beeea746" category="list-text">OLTP数据库通常也是组织中最关键的数据库。这些数据库通常为面向客户的应用程序提供支持、并被视为公司核心运营的关键。任务关键型OLTP数据库及其支持的应用程序通常具有SLA、这些SLA要求高性能级别、并且对性能下降和可用性敏感。它们也可能是"无中断故障转移集群"或"无中断可用性"组的候选对象。这些类型数据库的I/O混合通常具有75%到90%的随机读取和25%到10%的写入特征。</block>
  <block id="96d864d235bcd68e1ef22c2c49aef352" category="list-text">决策支持系统(DSS)数据库也可以称为数据仓库。这些数据库在许多依靠分析来开展业务的企业中至关重要。在运行查询时、这些数据库对CPU利用率和磁盘读取操作非常敏感。在许多组织中、DSS数据库在月份、季度和年终都是最重要的此工作负载的读取I/O混合比例通常为100%。</block>
  <block id="da02a82356735ded82f6661108abe7ef" category="section-title">基准测试</block>
  <block id="b9a9b34816c2e5ebaecb45f376b52bc3" category="paragraph">交易流程委员会(Transaction Process Council、TPC)是一家非营利性公司、旨在定义交易处理和数据库基准、并向行业传播客观、可验证的TPC性能数据。TPC测试模拟了一个完整的计算环境、在该环境中、用户群对数据库执行事务。</block>
  <block id="427af860f9733f0c5427a1408195bb2b" category="cell">工作负载类型</block>
  <block id="54861efdd06fc309e1c9a420feff98eb" category="cell">场景</block>
  <block id="b130fcf8f0704ab887b72883b1eda2fa" category="cell">读/写比率(百分比)</block>
  <block id="3edb9cc3b98f151feb21dbde6323e82a" category="cell">OLTP</block>
  <block id="69e16af975a283d07a422bdbcc70aa33" category="cell">TPC-C</block>
  <block id="b1e04731135df8a16c5318612ec8654e" category="cell">~75/5</block>
  <block id="106ff1baff5c32dc414f262e0a710c54" category="cell">TPC-E</block>
  <block id="48e219d97cf4619f212471bafd4215ec" category="cell">~90/10</block>
  <block id="e71f0182ed04206cb78bd7ceb2d9f4f3" category="cell">DSS</block>
  <block id="5788057170990ecf5e4d921f2853c2ae" category="cell">TPC-H</block>
  <block id="492d66c3da61bdb9c69261aa1aa6f5f9" category="cell">~100/0</block>
  <block id="0737ef89fbed16c79fadf3568aad6ba0" category="inline-link-macro">HammerDB.com</block>
  <block id="45e5ae4569fb8a91cd5513654f31b764" category="paragraph">虽然可以使用各种工作负载生成选项、但我们通常会将精力集中在衡量处理事务处理工作负载时SQL Server数据库的性能上、并使用Microsoft的TPC-E工具或使用HAMmerDB (<block ref="af66be8e0834614cdd62ca4f34bc61ec" category="inline-link-macro-rx"></block>^)。有关如何使用这些特定基准的详细说明不在本文档的讨论范围之内。</block>
  <block id="1b1b4c822e9c1b28b845dcc038fec08e" category="doc">Microsoft SQL Server数据库文件和文件组</block>
  <block id="381c0738613a6b6a27d1c14f223e99ba" category="paragraph">SQL Server数据库是一组对象、可用于存储和操作数据。</block>
  <block id="5306de2e4bff067a10c1c9b5aafe5920" category="paragraph">从理论上讲、SQL Server (64位)支持每个实例32、767个数据库以及524、272 TB的数据库大小、尽管典型安装通常包含多个数据库。但是、SQL Server可以处理的数据库数量取决于负载和硬件。SQL Server实例托管数十个、数百个甚至数千个小型数据库的情况并不少见。</block>
  <block id="9a3f42cec243006996ab4580d3ce5d56" category="paragraph">每个数据库由一个或多个数据文件和一个或多个事务日志文件组成。事务日志存储有关数据库事务以及每个会话所做的所有数据修改的信息。每次修改数据时、SQL Server都会在事务日志中存储足够的信息、以便撤消(回滚)或重做(重放)操作。SQL Server事务日志是SQL Server在数据完整性和稳定性方面声誉的重要组成部分。事务日志对于SQL Server的运行异常、一致性、隔离和持久性(ACID)功能至关重要。一旦对数据页面进行任何更改、SQL Server就会写入事务日志。每个数据操作语言(DML)语句(例如SELECT、INSERT、UPDATE-DELETE)都是一个完整的事务、事务日志可确保执行整个基于集合的操作、从而确保事务的正常运行。</block>
  <block id="cbe6958e46fbab53cdbdb9deb2d75938" category="paragraph">每个数据库都有一个主数据文件、默认情况下、该文件的扩展名为.mdf。此外、每个数据库都可以具有二级数据库文件。默认情况下、这些文件的扩展名为.NDF。</block>
  <block id="811b578b6dfbb4a4ca16ba0c0911e3df" category="paragraph">所有数据库文件都分组到文件组中。文件组是逻辑单元、可简化数据库管理。它们允许在逻辑对象放置和物理数据库文件之间进行隔离。创建数据库对象表时、您可以指定应将其放置在哪个文件组中、而不必担心基础数据文件配置。</block>
  <block id="3717596742d438a1c8e77b0aeb58fcec" category="paragraph">通过将多个数据文件放在文件组中、您可以将负载分布在不同的存储设备上、这有助于提高系统的I/O性能。相反、事务日志不会从多个文件中受益、因为SQL Server会按顺序写入事务日志。</block>
  <block id="c136ffb510a6a465d338ab0affc16641" category="paragraph">通过将文件组中的逻辑对象放置与物理数据库文件分隔开、您可以微调数据库文件布局、从而最大程度地利用存储子系统。例如、将产品部署到不同客户的独立软件供应商(ISV)可以在部署阶段根据底层I/O配置和预期数据量调整数据库文件数量。这些更改对于应用程序开发人员来说是透明的、他们将数据库对象放在文件组中、而不是数据库文件中。</block>
  <block id="3ac46c2f04dec9d215efbe44d307a020" category="admonition">* NetApp建议*避免将主文件组用于除系统对象之外的任何其他对象。为用户对象创建单独的文件组或一组文件组可简化数据库管理和灾难恢复、尤其是在大型数据库的情况下。</block>
  <block id="e3fc56c012a5d0c9f92dff9b49bcc80d" category="paragraph">您可以在创建数据库或向现有数据库添加新文件时指定初始文件大小和自动增长参数。SQL Server在选择应将数据写入哪个数据文件时使用比例填充算法。它会将大量数据按比例写入文件中的可用空间。文件中的可用空间越多、它处理的写入就越多。</block>
  <block id="91d249de86b62102d6324849de2360fe" category="admonition">* NetApp建议*单个文件组中的所有文件都具有相同的初始大小和自动增长参数，并且增长大小以MB而不是百分比为单位定义。这有助于比例填充算法均匀地平衡数据文件之间的写入活动。</block>
  <block id="a39d73055b8dbbe112e749e7c3ededb8" category="paragraph">每当SQL Server增加文件大小时、它都会用零填充文件中新分配的空间。该进程会阻止所有需要写入相应文件的会话、或者在事务日志增长时生成事务日志记录。</block>
  <block id="54db492ee9e4d356cc8722d1f4126f77" category="paragraph">SQL Server始终将事务日志零、并且此行为无法更改。但是、您可以通过启用或禁用即时文件初始化来控制数据文件是否置零。启用即时文件初始化有助于加快数据文件增长速度、并减少创建或还原数据库所需的时间。</block>
  <block id="92208bd4d9c6fec3f7c1dedeca62e135" category="paragraph">即时文件初始化会带来较小的安全风险。启用此选项后、数据文件的未分配部分可能包含先前删除的操作系统文件中的信息。数据库管理员可以检查此类数据。</block>
  <block id="2b222ad4000e6e966783fd7bc480180e" category="paragraph">您可以通过向SQL Server启动帐户添加SA_Manage_volume_name权限(也称为"执行卷维护任务")来启用即时文件初始化。您可以在本地安全策略管理应用程序(secpol.msc)下执行此操作、如下图所示。打开"Perform volume Maintenance Task (执行卷维护任务)"权限的属性、并将SQL Server启动帐户添加到其中的用户列表中。</block>
  <block id="c622e0142ed854a10f98fcaa8b3487f8" category="paragraph">要检查权限是否已启用、您可以使用以下示例中的代码。此代码设置了两个跟踪标志、用于强制SQL Server将追加信息写入错误日志、创建小型数据库以及读取日志内容。</block>
  <block id="eba8c32bde087b29aaa1fe0d3bb32ef3" category="paragraph">如果未启用即时文件初始化、则SQL Server错误日志会显示、除了将ldf日志文件置零之外、SQL Server还会将MDF数据文件置零、如以下示例所示。启用即时文件初始化后、它仅显示日志文件置零。</block>
  <block id="cf346325be0652c6b6e9a04b9352bda3" category="paragraph">执行卷维护任务在SQL Server 2016中得到了简化、稍后在安装过程中作为一个选项提供。此图显示了为SQL Server数据库引擎服务授予执行卷维护任务权限的选项。</block>
  <block id="638b283700120d26a838f9cb56fca59d" category="paragraph">控制数据库文件大小的另一个重要数据库选项是自动缩放。启用此选项后、SQL Server会定期缩减数据库文件、减小其大小并向操作系统释放空间。此操作会占用大量资源、并且很少有用、因为新数据进入系统一段时间后、数据库文件会再次增长。绝不能在数据库上启用自动缩放。</block>
  <block id="3b6c913908f5844ccb31a4d3775cb34e" category="doc">Microsoft SQL Server共享实例与专用实例</block>
  <block id="8b58192b54b5dc25444ace0536a34893" category="paragraph">如果应用程序具有许多模式和存储过程、则可能会影响共享SQL Server实例的其他应用程序。</block>
  <block id="0f85d9701e2ca305652e98c4181097e4" category="paragraph">实例资源可能会被划分或锁定、进而导致在共享SQL Server实例上托管数据库的其他应用程序出现性能问题。</block>
  <block id="37fbf1be337695452699ab9df948aa25" category="paragraph">对性能问题进行故障排除可能非常复杂、因为您必须确定哪个实例是根发生原因。此问题会与操作系统许可证和SQL Server许可证的成本进行权衡。如果应用程序性能至关重要、则强烈建议使用专用实例。</block>
  <block id="c840abede1d1bcf78e7b3e30048c08b1" category="paragraph">Microsoft在服务器级别为每个核心(而不是每个实例)授予SQL Server许可证。因此、为了节省许可成本、数据库管理员尝试尽可能多地安装服务器可以处理的SQL Server实例、这可能会导致以后出现重大性能问题。</block>
  <block id="8a77155b45f0f2313c8ebf3d755463e5" category="admonition">*SQL NetApp建议*尽可能选择专用的SQL Server实例，以获得最佳性能。</block>
  <block id="df7423789cebcf51de121abdae4181c3" category="summary">ONTAP和企业级应用程序</block>
  <block id="6e1c62c6c9ec560b6b6cf47a8a8c83f8" category="summary">使用Solaris在ONTAP上运行Oracle</block>
  <block id="eaf36c98b91893b7f79bd5184a23d377" category="doc">Solaris</block>
  <block id="fb04d97697a77a89d0c3f5c09cd9ba47" category="paragraph">特定于Solaris OS的配置主题。</block>
  <block id="eefc332f1bd0a0aa81d0ce222989294f" category="section-title">Solaris NFS挂载选项</block>
  <block id="3e484486d582145f6d93ca5f8c71e228" category="paragraph">下表列出了单个实例的Solaris NFS挂载选项。</block>
  <block id="6622c14ce91b6b9683505626a5eebdd2" category="cell">文件类型</block>
  <block id="f18f8a29d3e2281d374f43c78cf8f0f1" category="cell">挂载选项</block>
  <block id="a45543a64530673135f37ff8f9e95e69" category="cell">ADr主页</block>
  <block id="93a02670f814a2df6c830194a7244ea9" category="cell"><block ref="623bbf58c0b2f552d891a1c276bcc3bc" prefix="" category="inline-code"></block></block>
  <block id="80d52d74fd5c383b43f91575d569b42c" category="cell">控制文件
数据文件
重做日志</block>
  <block id="73cf9d3814b8678439c37316096219b1" category="cell"><block ref="4c899c62e1ffeb12078476828bb54351" prefix="" category="inline-code"></block></block>
  <block id="72d33cb5c8b7ff5f7fd6a894094b0697" category="cell"><block ref="e1f651debac4f720c13ae930ff3ca14a" prefix="" category="inline-code"></block></block>
  <block id="3f490427e0bf55dc5c837e7b0d4c651c" category="cell"><block ref="b9ce73264210e6d0faa4115ce7525610" prefix="" category="inline-code"></block></block>
  <block id="b00b0ab6e8494db1a230bf3da7f42fd6" category="paragraph">的使用<block ref="545e1db0caafaa47ef37ce893c8fb92c" prefix=" " category="inline-code"></block> 经验证、通过消除与获取和释放存储系统锁定相关的延迟、可以显著提高客户环境的性能。在配置了大量服务器以挂载相同文件系统且Oracle配置为挂载这些数据库的环境中、请谨慎使用此选项。尽管这种配置非常少见、但也有少数客户使用。如果某个实例再次意外启动、则可能会发生数据损坏、因为Oracle无法检测到外部服务器上的锁定文件。NFS锁定不会在其他情况下提供保护；与NFS版本3一样、它们仅为建议使用。</block>
  <block id="f480015b57b289b7dad1473ee5c55216" category="paragraph">因为<block ref="545e1db0caafaa47ef37ce893c8fb92c" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 参数是互斥的、这一点很重要<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 中存在<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 文件<block ref="6887bae4cda2d09a283a165c5be3f2b8" prefix=" " category="inline-code"></block> 已使用。如果没有此参数、则会使用主机操作系统缓冲区缓存、并且可能会对性能产生不利影响。</block>
  <block id="5171d5dfdc21b0941b921796638c10a9" category="paragraph">下表列出了Solaris NFS RAC挂载选项。</block>
  <block id="38e4e10abf410c92cd13e9cb4d54ae35" category="cell"><block ref="41a82b9bd64cb001f8913a34614b00d1" prefix="" category="inline-code"></block></block>
  <block id="e72cc50c204d77a1e47f0dcc8ad28a56" category="cell">控制文件
数据文件
重做日志</block>
  <block id="98ee9e91a49f27abbd9dc831afa9fae5" category="cell"><block ref="f3a0fd4a197a2eae60d2ef904e5366f1" prefix="" category="inline-code"></block></block>
  <block id="f93eecf9c582d76d4e14292dc34c79f8" category="cell">CRS/表决</block>
  <block id="42c82995de255264e2a8690c3149c16a" category="cell">专用<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block></block>
  <block id="b71e04a676ec52e65edb52c138f2ad98" category="cell"><block ref="ac15a7c050732bc5169b6c17ce30f859" prefix="" category="inline-code"></block></block>
  <block id="273f714e976e2a709a6abe18d34e4b61" category="cell">共享<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block></block>
  <block id="2052aa052eee25e077178cd737b68f47" category="cell"><block ref="18f533bce293643d1004086db883dd03" prefix="" category="inline-code"></block></block>
  <block id="e9d3beba8b6a40da6f8074236ca3ddbc" category="paragraph">单实例挂载选项与RAC挂载选项之间的主要区别在于添加了<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 挂载选项。这种添加的效果是禁用主机操作系统缓存、从而使RAC集群中的所有实例都能获得一致的数据状态视图。但使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 参数<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 与禁用主机缓存具有相同的效果、但仍需要使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block>。</block>
  <block id="983c4ff0cb78851d95be06277152653f" category="paragraph">原因<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 对于共享为必填项<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是为了提高Oracle密码文件和spfile等文件的一致性。RAC集群中的每个实例都有一个专用<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，则不需要此参数。</block>
  <block id="5a11994cffaa4d0a9c8594d2223e3e96" category="section-title">Solaris UFS挂载选项</block>
  <block id="130c5ffb786e38c2e6648fd53593681a" category="paragraph">NetApp强烈建议使用日志记录挂载选项、以便在Solaris主机崩溃或FC连接中断时保持数据完整性。日志记录挂载选项还会保留Snapshot备份的可用性。</block>
  <block id="516f7006de2e9b1f7f871d961db4a1ca" category="section-title">Solaris ZFS</block>
  <block id="a92c2c52c7360246c6da2b1169e0fa50" category="paragraph">必须仔细安装和配置Solaris ZFS，才能提供最佳性能。</block>
  <block id="c9208a3ad95d5ce3d9e2ba1839426251" category="section-title">mvector</block>
  <block id="c54b9977f43cf2f9a1aa7cb0de8fec22" category="paragraph">Solaris 11对其处理大型I/O操作的方式进行了更改、这可能会导致SAN存储阵列出现严重的性能问题。NetApp错误报告“Solaris 11 ZFS性能回归”详细介绍了该问题。"解决方案将更改名为的操作系统参数<block ref="954f82599f7db0212a28fd448e03bdf3" prefix=" " category="inline-code"></block>。</block>
  <block id="17e692fa261653b11634297d15070637" category="paragraph">以root用户身份运行以下命令：</block>
  <block id="bc7e9b3c34345bf9ebe88467d6714f1b" category="paragraph">如果此更改出现任何意外问题、可以通过以root用户身份运行以下命令轻松反转此更改：</block>
  <block id="6ff9f4444ac481652f4412b5e1623846" category="section-title">内核</block>
  <block id="78d06f587305b9e5481c8cf660693a61" category="paragraph">要获得可靠的ZFS性能、需要对Solaris内核进行修补、以防止出现LUN对齐问题。此修复程序是在Solaris 10的修补程序147440-19以及Solaris 11的SRU 10.5中引入的。请仅将Solaris 10及更高版本与ZFS结合使用。</block>
  <block id="db8880d80ab20f2f01a010e5c454f7fb" category="section-title">LUN配置</block>
  <block id="3b296d65c0c37979abe39ac7f6d8e1d8" category="paragraph">要配置LUN、请完成以下步骤：</block>
  <block id="3bdc2a5622b76404f8b0ce2fc774e69a" category="list-text">创建类型为的LUN<block ref="7bee0477f82303aa43de5d78f7b9cb05" prefix=" " category="inline-code"></block>。</block>
  <block id="c06f6c6685c06bb821295b3a6d5e580c" category="list-text">安装指定的相应Host Utility Kit (HUK) <block ref="b5b16f3cdb0eb25a282348ba54f8c677" category="inline-link-macro-rx"></block>。</block>
  <block id="33db73c9b3936cb8eaae825d3101f60c" category="inline-link-macro">最新文档</block>
  <block id="c8646086dca29c1d978ab285faa93709" category="list-text">完全按照所述执行HUK中的说明。基本步骤概述如下、但请参见 <block ref="33574dfffc2cb6d01be0edb6738c51bb" category="inline-link-macro-rx"></block> 正确的操作步骤。</block>
  <block id="6c06455cad171d61eac3593147bd71d6" category="list-text">运行<block ref="3062dc928daa4d85f6e34b6dea110a00" prefix=" " category="inline-code"></block> 实用程序以更新<block ref="d5416d340f5bec1fcb3addb6ae7d059e" prefix=" " category="inline-code"></block> 文件这样可以使SCSI驱动器正确发现ONTAP LUN。</block>
  <block id="7ec6668202fa9a677238143b0445102f" category="list-text">按照提供的说明进行操作<block ref="3062dc928daa4d85f6e34b6dea110a00" prefix=" " category="inline-code"></block> 用于启用多路径输入/输出(MPIO)的实用程序。</block>
  <block id="b53abe6c0013125abea171427b351ccc" category="list-text">重新启动。要在整个系统中识别任何更改、必须执行此步骤。</block>
  <block id="b88caedbe9708683eed783eb534ae5f6" category="list-text">对LUN进行分区并验证它们是否已正确对齐。有关如何直接测试和确认对齐的说明，请参阅“附录B：WAFL对齐验证”。</block>
  <block id="a0c1c26e783204cf713b2e1f0823aab3" category="section-title">zpools</block>
  <block id="c81b8fe4a368c32102406e65fc41a227" category="inline-link-macro">LUN配置</block>
  <block id="869dc3a8daf591c7f33e5bb32a4a63c9" category="paragraph">的值<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 默认为9、表示2^9或512字节。为了获得最佳性能、<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 值必须为12 (2^12=4k)。此值在创建zpool时设置、并且无法更改、这意味着具有的zpool中的数据<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 应通过将数据复制到新创建的zpool来迁移12以外的文件。</block>
  <block id="6a00a2262e030c2656588743cb031710" category="paragraph">创建zpool后、请验证的值<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 然后继续。如果此值不是12、则表示未正确发现LUN。销毁zpool、确认相关Host Utilities文档中显示的所有步骤均已正确执行、然后重新创建zpool。</block>
  <block id="15ec722ce3f6694d12f89aeb5b621941" category="section-title">zpool和Solaris LDom</block>
  <block id="8826ef54a7d108df25ed6921b5129cb6" category="paragraph">Solaris LDOM还要求确保I/O对齐正确。虽然LUN可能会作为4K设备正确地被发现、但LDOM上的虚拟vdsk设备不会继承I/O域中的配置。基于该LUN的vdsk默认为512字节的块。</block>
  <block id="9a984f24f825e4f0bca1f36e11acbca9" category="paragraph">需要一个额外的配置文件。首先、必须为各个LLOM修补Oracle错误27824910、以启用其他配置选项。此修补程序已移植到所有当前使用的Solaris版本中。对LDOM进行修补后、即可按如下所示配置正确对齐的新LUN：</block>
  <block id="e0f306ab540315b015db849b1ae9099e" category="list-text">确定要在新zpool中使用的一个或多个LUN。在此示例中、它是C2D1设备。</block>
  <block id="f469046d419183a7be08ed5a13d2c65e" category="list-text">检索要用于ZFS池的设备的VDC实例：</block>
  <block id="bcaa63dcd5db76bffd8b867e8720a272" category="list-text">编辑<block ref="ebceeaa7b6ce5abf6c8de7177255fef5" prefix=" " category="inline-code"></block>：</block>
  <block id="ec960a08b4666fe258b6e005064378ab" category="paragraph">这意味着为设备实例1分配的块大小为4096。</block>
  <block id="3df4cdc476a0c3a5a930597e9d8da84c" category="paragraph">作为另一个示例、假设需要为vdsk实例1到6配置4K块大小和<block ref="74a491ed941b00d0c9909d488eee67bf" prefix=" " category="inline-code"></block> 内容如下：</block>
  <block id="dfed6d8974f03c5b31f20c9c5c2bbe66" category="list-text">最终版本<block ref="3328fba80b08b36663ffae0684f6c578" prefix=" " category="inline-code"></block> 文件应包含以下内容：</block>
  <block id="764a2caff05993fc0d3eff5de7b225e9" category="cell">小心</block>
  <block id="5c442834a7707cc96719e468c87b2ff6" category="cell">配置vdc.conf并创建vdsk后、必须重新启动LLOM。这一步是不可避免的。块大小更改仅在重新启动后生效。继续进行zpool配置、并确保将ashift正确设置为12、如上所述。</block>
  <block id="2138e0b461ac7e557539bb0b33bde81a" category="section-title">ZFS意图日志(ZIL)</block>
  <block id="5477cebfd480a13008afdd16bea2b3f9" category="paragraph">通常，没有理由在其他设备上查找ZFS意图日志(ZIL)。日志可以与主池共享空间。单独的ZIL主要用于使用在现代存储阵列中缺少写入缓存功能的物理驱动器。</block>
  <block id="26a004aeb043de19f767bd7daa39cf2f" category="section-title">对数偏差</block>
  <block id="07fff183bc4c01bf9bbb21a48b389845" category="paragraph">设置<block ref="26a004aeb043de19f767bd7daa39cf2f" prefix=" " category="inline-code"></block> 用于托管Oracle数据的ZFS文件系统上的参数。</block>
  <block id="ac01fbc5e98d6450f3b565d0617f4a55" category="paragraph">使用此参数可降低整体写入级别。在默认设置下、写入的数据会先提交到ZIL、然后再提交到主存储池。此方法适用于使用普通驱动器配置的配置、该配置包括基于SSD的ZIL设备和用于主存储池的旋转介质。这是因为它允许在可用延迟最低的介质上的单个I/O事务中进行提交。</block>
  <block id="c6cc0f147c42f124079d7fc1a0761886" category="paragraph">如果使用的是具有自身缓存功能的现代存储阵列、则通常不需要使用此方法。在极少数情况下、可能需要将具有单个事务的写入提交到日志中、例如由高度集中且对延迟敏感的随机写入组成的工作负载。写入放大会产生一定的后果、因为记录的数据最终会写入主存储池、从而导致写入活动增加一倍。</block>
  <block id="92b9531657a4ce6a31c623d889a2c55d" category="section-title">直接I/O</block>
  <block id="387f4a4c250ed7a5003f3f6a19abfd1f" category="paragraph">许多应用程序(包括Oracle产品)都可以通过启用直接I/O来绕过主机缓冲区缓存此策略无法按预期用于ZFS文件系统。尽管会绕过主机缓冲区缓存，但ZFS本身仍会继续缓存数据。在使用FIO或SIO等工具执行性能测试时、此操作可能会导致误导性的结果、因为很难预测I/O是到达存储系统还是在操作系统中本地缓存。此操作还会使使用此类综合测试来比较ZFS与其他文件系统的性能变得非常困难。实际上、在实际用户工作负载下、文件系统性能几乎没有差别。</block>
  <block id="ec79b30d56e7bae54aa7efedccc47e93" category="section-title">多个zpool</block>
  <block id="f5aa5b31f0536ddcdb748ae360d91358" category="paragraph">必须在zpool级别对基于ZFS的数据执行基于Snapshot的备份、还原、克隆和归档、并且通常需要多个zpool。zpool类似于LVM磁盘组、应使用相同的规则进行配置。例如、数据库的布局可能最好是将数据文件驻留在上<block ref="f1fb162e58045170396a0ac29d648fa5" prefix=" " category="inline-code"></block> 以及上的归档日志、控制文件和重做日志<block ref="92073f03d18c8eaec3eb5e0908210e1a" prefix=" " category="inline-code"></block>。此方法允许使用标准热备份、其中数据库将置于热备份模式、然后是的快照<block ref="f1fb162e58045170396a0ac29d648fa5" prefix=" " category="inline-code"></block>。然后、数据库将从热备份模式中删除、并强制执行日志归档和的快照<block ref="92073f03d18c8eaec3eb5e0908210e1a" prefix=" " category="inline-code"></block> 已创建。还原操作需要卸载zfs文件系统并使zpool完全脱机、然后执行SnapRestore还原操作。然后、可以将zpool重新联机并恢复数据库。</block>
  <block id="f1110589be196c2310808482067fce1b" category="section-title">filesystemio_options</block>
  <block id="c271ff9f255f2d215054d508448781a3" category="paragraph">Oracle参数<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 与ZFS的工作方式不同。条件<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block> 或<block ref="6887bae4cda2d09a283a165c5be3f2b8" prefix=" " category="inline-code"></block> 使用时、写入操作是同步的、并会绕过操作系统缓冲区缓存、但读取操作会由ZFS进行缓冲。此操作会导致性能分析出现困难、因为I/O有时会被ZFS缓存截获并提供服务、从而使存储延迟和总I/O比看起来要小。</block>
  <block id="22a7d37643562540ddbda52f511fb1fe" category="summary">使用HP-UX在ONTAP上运行Oracle</block>
  <block id="b1fd823d262032e04291313f72be9452" category="doc">HP-UX</block>
  <block id="5be7e182308e16aee80978c6a5ebe02b" category="paragraph">特定于HP-UX操作系统的配置主题。</block>
  <block id="8ec258cd0b6ab050fc478a415a20f2e9" category="section-title">HP-UX NFS挂载选项</block>
  <block id="7c5876d5737071c64af78562fe375386" category="paragraph">下表列出了单个实例的HP-UX NFS挂载选项。</block>
  <block id="9c9fb3cc18a83e4e46165b5c3d4ce8ef" category="cell">控制文件
数据文件
重做日志</block>
  <block id="55b835c747261995c0e1022d234e286d" category="cell"><block ref="fa8766c679857b7d589983df0ab5bcf4" prefix="" category="inline-code"></block></block>
  <block id="189dbd39cabd57c5d2e51714d9a5b85b" category="paragraph">下表列出了RAC的HP-UX NFS挂载选项。</block>
  <block id="fa9da3a6a7ef8986a94c7395577c322f" category="cell"><block ref="8b080dc74532d24847a6163dcc34d93f" prefix="" category="inline-code"></block></block>
  <block id="add42ff64fa5b57e5abeab49d154a9d9" category="cell"><block ref="acdef4af05a9f0c43f72b7c600f04d62" prefix="" category="inline-code"></block></block>
  <block id="c88a7b7f83f761f7fc2979815d210140" category="cell"><block ref="d29d7b7ed8c19a99fe17fd7f3d07ea7b" prefix="" category="inline-code"></block></block>
  <block id="af8831a1b8129b099114c3237a61db88" category="paragraph">单实例挂载选项与RAC挂载选项之间的主要区别在于添加了<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block> 挂载选项。这种添加的效果是禁用主机操作系统缓存、从而使RAC集群中的所有实例都能获得一致的数据状态视图。但使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 参数<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 与禁用主机缓存具有相同的效果、但仍需要使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="6698a391ee8befa0ca4646a86a1bbd66" prefix=" " category="inline-code"></block>。</block>
  <block id="b865c6aba24c3f61595471aab993d27c" category="paragraph">原因<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 对于共享为必填项<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是为了提高Oracle密码文件和spfile等文件的一致性。RAC集群中的每个实例都有一个专用<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，则不需要此参数。</block>
  <block id="898311d838a2fa2fa41b4b52a63a7f1d" category="section-title">HP-UX VxFS挂载选项</block>
  <block id="85b4a3d44370909d395ab8af28ff4927" category="paragraph">对于托管Oracle二进制文件的文件系统、请使用以下挂载选项：</block>
  <block id="6630bbc9a901be0d038b2c39e2faf65d" category="paragraph">对于包含数据文件、重做日志、归档日志和控制文件的文件系统、如果HP-UX版本不支持并发I/O、请使用以下挂载选项：</block>
  <block id="ed37730e0f28a631768a396e7898e197" category="paragraph">如果支持并发I/O (VxFS 5.0.1及更高版本或ServiceGuard Storage Management Suite)、请对包含数据文件、重做日志、归档日志和控制文件的文件系统使用以下挂载选项：</block>
  <block id="f51ddb98d92e83609db075add5fba4d8" category="admonition">参数<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 在VxFS环境中尤其重要。Oracle建议在Oracle 10g R1及更高版本中保持此参数未设置、除非另有明确指示。Oracle 8 KB块大小的默认值为128。如果此参数的值强制设置为16或更低、请删除<block ref="a6b02283cba560dcfdea44af66ec792c" prefix=" " category="inline-code"></block> 挂载选项、因为它可能会损坏顺序I/O性能。此步骤会损害性能的其他方面、仅当的值为时才应执行此步骤<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 必须更改默认值。</block>
  <block id="ca3fa25943498edb0ee62d0ea286bb7a" category="summary">在ONTAP上使用Linux和ASMlib/ASM筛选器驱动程序的Oracle</block>
  <block id="d7e9c72be485a5a848f1f7cd15a9a5ba" category="doc">ASMlib和ASM筛选器驱动程序</block>
  <block id="5802d9527a43305e9e1c903bc6b5a721" category="paragraph">特定于使用AFC和ASMlib的Linux操作系统的配置主题</block>
  <block id="2681013be5b0a9063a7ef0a8fe4d31da" category="section-title">ASMlib块大小</block>
  <block id="1943673cc25055e93f0129f2baa8f499" category="paragraph">ASMlib是一个可选的ASM管理库和关联实用程序。其主要价值是能够使用可读标签将LUN或基于NFS的文件标记为ASM资源。</block>
  <block id="51713fdb873939c9c333273947776b8e" category="paragraph">最新版本的ASMlib会检测到一个名为逻辑块/物理块指数(Logical Blocks Per Physical Block Exponent、LBPPBE)的LUN参数。直到最近、ONTAP SCSI目标才报告此值。现在、它将返回一个值、指示首选的块大小为4 KB。这不是块大小的定义、但对于使用LBPPBE的任何应用程序来说、这是一个提示、即可以更高效地处理特定大小的I/O。但是、ASMlib会将LBPPBE解释为块大小、并在创建ASM设备时持久标记ASM标头。</block>
  <block id="65242d5b49071240043eeef598415104" category="paragraph">此过程可能会在许多方面出现发生原因升级和迁移问题、所有这些问题都是由于无法在同一个ASM磁盘组中混用块大小不同的ASMlib设备。</block>
  <block id="ea884eec0628302adc731211dc4e2cc7" category="paragraph">例如、较早的阵列通常报告LBPPBE值为0、或者根本不报告此值。ASMlib会将此数据块大小解释为512字节。较新的阵列会被解释为块大小为4 KB。不能在同一个ASM磁盘组中混用512字节和4 KB设备。这样做会阻止用户使用两个阵列中的LUN或将ASM用作迁移工具来增加ASM磁盘组的大小。在其他情况下、RMAN可能不允许在块大小为512字节的ASM磁盘组与块大小为4 KB的ASM磁盘组之间复制文件。</block>
  <block id="f17ff15b23b87f35906ece98842a080f" category="paragraph">首选解决方案是修补ASMlib。Oracle错误ID为13999609、此修补程序位于oracleasm-support-2.1.8-1及更高版本中。此修补程序允许用户设置参数<block ref="442e2026c8afecc4611b52331b5d0d56" prefix=" " category="inline-code"></block> to<block ref="b326b5062b2f0e69046810717534cb09" prefix=" " category="inline-code"></block> 在中<block ref="92a59ba9a0643a344be2d72cfd504181" prefix=" " category="inline-code"></block> 配置文件。这样做会阻止ASMlib使用LBPPBE参数、这意味着新阵列上的LUN现在可识别为512字节块设备。</block>
  <block id="f140ff6b2b71e70e551e39dacb9561ef" category="admonition">选项不会更改先前由ASMlib标记的LUN上的块大小。例如、如果必须将包含512字节块的ASM磁盘组迁移到报告4 KB块的新存储系统、则可以选择此选项<block ref="442e2026c8afecc4611b52331b5d0d56" prefix=" " category="inline-code"></block> 必须在新LUN标记为ASMlib之前进行设置。  如果设备已标记为oracleasm，则必须先重新格式化，然后再重新添加新的块大小。首先、使用取消配置设备<block ref="41bd8c47b8e640da7bdb5c7dc995d435" prefix=" " category="inline-code"></block>，然后使用清除设备的第一个1GB<block ref="85c2e94baaf4d9c084e19d290907596e" prefix=" " category="inline-code"></block>。最后、如果设备之前已分区、请使用<block ref="9a287d63dabd6fbcbbe1b12344bfe922" prefix=" " category="inline-code"></block> 命令删除陈旧分区或仅重新启动操作系统。</block>
  <block id="75ad83418241561186f96dfed5229aaa" category="paragraph">如果无法修补ASMlib、则可以从配置中删除ASMlib。此更改会造成系统中断、需要取消ASM磁盘的附加服务、并确保<block ref="0802edf7303a95bdecde832bbbe3a89c" prefix=" " category="inline-code"></block> 参数设置正确。但是、这种更改不需要迁移数据。</block>
  <block id="ad9ac4c6d7ed2e11bdcf8c693658a482" category="section-title">ASM筛选驱动器((AFD)块大小</block>
  <block id="de59cd97a61c9f9964a35d2cd8b05c88" category="paragraph">AAutomatic是一个可选的ASM管理库、它将取代ASMlib。从存储角度来看、它与ASMlib非常相似、但它还包括一些其他功能、例如、可以阻止非Oracle I/O、从而降低用户或应用程序错误可能损坏数据的几率。</block>
  <block id="36dc27685773851e52f035f82e3deba2" category="section-title">设备块大小</block>
  <block id="1ef92cf7e561e179d6079cc937b2778a" category="paragraph">与ASMlib一样、ADAD还会读取LUN参数Logical Blocks Per Physical Block Exponent (LBPPBE)、默认情况下会使用物理块大小、而不是逻辑块大小。</block>
  <block id="b95ce6c503801cb15f2f9c0773c58f00" category="paragraph">如果在现有配置中添加了AAutomatic、而ASM设备已格式化为512字节块设备、则可能会出现问题。AAutomatic驱动程序会将LUN识别为4K设备、如果ASM标签与物理设备不匹配、则会阻止访问。同样、迁移也会受到影响、因为不能在同一个ASM磁盘组中混用512字节和4 KB设备。这样做会阻止用户使用两个阵列中的LUN或将ASM用作迁移工具来增加ASM磁盘组的大小。在其他情况下、RMAN可能不允许在块大小为512字节的ASM磁盘组与块大小为4 KB的ASM磁盘组之间复制文件。</block>
  <block id="7ef45d3a7c5fff234bf42bdf549b8339" category="paragraph">解决方案非常简单—AFAS包含一个参数、用于控制它使用的是逻辑块大小还是物理块大小。此全局参数会影响系统上的所有设备。要强制AfD使用逻辑块大小、请设置<block ref="722fc896569f3d455bb5ef8f5b8c3703" prefix=" " category="inline-code"></block> 在中<block ref="dcd5fd81543c5e08e927c54e89acdd40" prefix=" " category="inline-code"></block> 文件</block>
  <block id="47b0d7fc4c27720c4fc326722edad27c" category="section-title">多路径传输大小</block>
  <block id="7c329811bcc7bb2f50005da5a3aff250" category="paragraph">最近的Linux内核更改会强制实施发送到多路径设备的I/O大小限制、而AFD不会遵守这些限制。然后、I/O将被拒绝、从而导致LUN路径脱机。因此、无法安装Oracle Grid、配置ASM或创建数据库。</block>
  <block id="926e4b7a2822a39a07f61474b92e9d8c" category="paragraph">解决方案将在多路径.conf文件中为ONTAP LUN手动指定最大传输长度：</block>
  <block id="3d0c741146f1e8e31bc7d07128ca6e0a" category="admonition">即使当前不存在任何问题、如果使用AWAD来确保未来的Linux升级不会出现意外的发生原因问题、则应设置此参数。</block>
  <block id="72247c591c444399f3d42dffa31b644e" category="summary">使用AIX在ONTAP上运行Oracle</block>
  <block id="23802d94b756cf69028557bea156ab1a" category="doc">IBM AIX</block>
  <block id="5b8d4d99cdcb494ca636eb065004b165" category="paragraph">特定于IBM AIX操作系统的配置主题。</block>
  <block id="d99ae60d37a12f766bc2a1f1c228fb4f" category="section-title">并发I/O</block>
  <block id="0f3eb508f611e203aeffa91d5753648a" category="paragraph">要在IBM AIX上实现最佳性能、需要使用并发I/O如果不使用并发I/O、则性能可能会受到限制、因为AIX会执行序列化的原子I/O、从而产生大量开销。</block>
  <block id="ecdc41fc6a2adf7e41e7277e12eeb805" category="paragraph">最初、NetApp建议使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 挂载选项、用于强制在文件系统上使用并发I/O、但此过程存在缺点、不再需要。自AIX 5.2和Oracle 10gR1推出以来、AIX上的Oracle可以打开单个文件以实现并发IO、而不是强制在整个文件系统上执行并发I/O。</block>
  <block id="445b433b62b675f0ca0bda7acb56d41b" category="paragraph">启用并发I/O的最佳方法是设置<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 参数<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> to<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block>。这样、Oracle就可以打开特定文件、以便用于并发I/O</block>
  <block id="6206c23a0282b18352573158f9a8f9b3" category="paragraph">使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 作为挂载选项、会强制使用并发I/O、这可能会产生负面影响。例如、强制执行并发I/O会在文件系统上禁用预读、这可能会损害Oracle数据库软件之外发生的I/O的性能、例如复制文件和执行磁带备份。此外，Oracle GoldenGate和SAP BR*Tools等产品与不兼容<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 适用于某些Oracle版本的挂载选项。</block>
  <block id="770cb9a1e9321ca3012ecbb9ec65c422" category="list-text">请勿使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 文件系统级别的挂载选项。而是通过使用来启用并发I/O<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block>。</block>
  <block id="872080b7d5ec5585776f1426fb157842" category="list-text">仅使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 如果无法设置、则应设置挂载选项<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block>。</block>
  <block id="0c5d86482201f32acb30cd2f7de3048f" category="section-title">AIX NFS挂载选项</block>
  <block id="1ce07cafb2507c98c8b96ad5f35fb66a" category="paragraph">下表列出了Oracle单实例数据库的AIX NFS挂载选项。</block>
  <block id="9a8f040dae3f0f15b337fe69a85239c0" category="cell"><block ref="86d38d6e2b36f6557e583e005e23d258" prefix="" category="inline-code"></block></block>
  <block id="d45a1a2afa30c30042b28f028fe75953" category="cell"><block ref="915be14765d6133923d803e1221f1513" prefix="" category="inline-code"></block></block>
  <block id="b74f5956b4bcda2de3c82ee97e192ab6" category="paragraph">下表列出了RAC的AIX NFS挂载选项。</block>
  <block id="b547b55ba7f2a20602494777c5426eba" category="cell"><block ref="7e879bda961bd5b7d64d2ef4f5fb7869" prefix="" category="inline-code"></block></block>
  <block id="875abb256654bd3f6da7abcb1bd92f27" category="cell"><block ref="f93eecf9c582d76d4e14292dc34c79f8" prefix="" category="inline-code"></block></block>
  <block id="3ed8fb68917b28af138fb74ccde62e80" category="cell"><block ref="415e8eb8b9fc05cb48e633d31fd04944" prefix="" category="inline-code"></block></block>
  <block id="8102775fe4080f632332ab8d3312311a" category="paragraph">单实例挂载选项与RAC挂载选项之间的主要区别在于添加了<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 挂载选项。这种添加的效果是禁用主机操作系统缓存、从而使RAC集群中的所有实例都能获得一致的数据状态视图。</block>
  <block id="1e3f10dfa324520cb7261c0da5bf6ec7" category="paragraph">但使用<block ref="4482571a249db31b3abed938e4567a15" prefix=" " category="inline-code"></block> 挂载选项和<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 参数<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 与禁用主机缓存具有相同的效果、但仍需要使用<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block>。<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 对于共享为必填项<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署以提高Oracle密码文件和等文件的一致性<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 参数文件。RAC集群中的每个实例都有一个专用<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，则不需要此参数。</block>
  <block id="5365dd1a92461c9e6cf65017c4a11647" category="section-title">AIX jfs/JFS2挂载选项</block>
  <block id="d7a578263480a2003f05c459a8961298" category="paragraph">下表列出了AIX jfs/jfs2挂载选项。</block>
  <block id="0aabf727ab0a83c5f5d078e8b18445e0" category="cell">默认值</block>
  <block id="e1f651debac4f720c13ae930ff3ca14a" category="cell">ORACLE_HOME</block>
  <block id="27a7ffa293f5a4d2a5bb54354486dece" category="paragraph">使用AIX之前<block ref="b7cc91287fc99a8937a55e79376c6f54" prefix=" " category="inline-code"></block> 在任何环境(包括数据库)中、设备都应检查参数<block ref="9d51746070ef554ad4e93a16de4aed0f" prefix=" " category="inline-code"></block>。此参数不是HBA队列深度、而是与各个的SCSI队列深度相关<block ref="66ad66c6ace8456eae4ca6807552e54b" prefix=" " category="inline-code"></block> 可能太低、无法获得良好性能。测试表明、最佳值为64。</block>
  <block id="6e1dee25b21d0005970053df9e9384ba" category="summary">使用Microsoft Windows在ONTAP上运行Oracle</block>
  <block id="bb79f96acbff544ded541446c9c7c894" category="doc">Microsoft Windows</block>
  <block id="44959b8c12de9e1107621ee8c0337463" category="paragraph">特定于Microsoft Windows操作系统的配置主题。</block>
  <block id="14ce2582c2080a7f08fe9249f6565f40" category="paragraph">Oracle支持将Microsoft Windows与Direct NFS客户端结合使用。此功能提供了一条实现NFS管理优势的途径、其中包括跨环境查看文件、动态调整卷大小以及利用成本较低的IP协议。有关使用DNFS在Microsoft Windows上安装和配置数据库的信息、请参见Oracle官方文档。没有特别的最佳做法。</block>
  <block id="f854b764258138b512f30be71e1c7908" category="paragraph">为了获得最佳压缩效率、请确保NTFS文件系统使用8K或更大的分配单元。使用4K分配单元(通常为默认分配单元)会对压缩效率产生负面影响。</block>
  <block id="140def8362bd2cf6a999328e25572cfd" category="summary">使用Linux在ONTAP上运行Oracle</block>
  <block id="edc9f0a5a5d57797bf68e37364743831" category="doc">Linux</block>
  <block id="dfc95ed5e895617bbd0d4b1a8bfba8ca" category="paragraph">特定于Linux操作系统的配置主题。</block>
  <block id="5ecd4a6f4aedfdd45cce80a18b1a7942" category="section-title">插槽表</block>
  <block id="2518e65e64213437c921c39a097db167" category="section-title">Linux NFS挂载选项</block>
  <block id="29cd2e6d4fc96e749c4a0e622cad7f50" category="paragraph">下表列出了单个实例的Linux NFS挂载选项。</block>
  <block id="9fafd031075cede0e8a5a796ec45fbff" category="paragraph">下表列出了RAC的Linux NFS挂载选项。</block>
  <block id="f16135915fe2ca5c3b0d660acc0325d3" category="cell"><block ref="4c927b3193f1cd00c7cfd3ac2e7ba8ea" prefix="" category="inline-code"></block></block>
  <block id="fc1ea13514277ff14dc705f62c31c0fc" category="cell"><block ref="4d0511346ac74044d79c9bc297d59b09" prefix="" category="inline-code"></block></block>
  <block id="13c64659680c0bc3603209997cc22225" category="cell">CRS/表决</block>
  <block id="672c5eef2603018159295408f761324b" category="cell"><block ref="26b20bdf0b0e7d3ddef3749a70c17932" prefix="" category="inline-code"></block></block>
  <block id="f7085c7dc406f5b44813ac43c18b80c0" category="paragraph">单实例挂载选项与RAC挂载选项之间的主要区别在于添加了<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 挂载选项。这种添加的效果是禁用主机操作系统缓存、从而使RAC集群中的所有实例都能获得一致的数据状态视图。但使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 参数<block ref="b6a2b868e8bebfc19497b406a12a1071" prefix=" " category="inline-code"></block> 与禁用主机缓存具有相同的效果、但仍需要使用<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block>。</block>
  <block id="d2537738f34705bc9d100925252c0102" category="paragraph">原因<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 对于共享为必填项<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block> 部署是为了提高Oracle密码文件和spfile等文件的一致性。RAC集群中的每个实例都有一个专用<block ref="e1f651debac4f720c13ae930ff3ca14a" prefix=" " category="inline-code"></block>，则不需要此参数。</block>
  <block id="5084019c1051a9937b5ff77568ce579b" category="paragraph">通常、非数据库文件应使用与单实例数据文件相同的选项进行挂载、但特定应用程序可能具有不同的要求。避免使用挂载选项<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 如果可能、因为这些选项会禁用文件系统级预读和缓冲。这可能会发生原因为提取、转换和加载等过程带来严重的性能问题。</block>
  <block id="243de27c01fea05cc58186d2e5ad1ce5" category="section-title">access和getattr</block>
  <block id="59dcf78e97c197a0f240067da57a248f" category="paragraph">一些客户注意到、极高级别的其他IOPS (如访问和getATTR)可能会主导其工作负载。在极端情况下、读取和写入等操作可能只占总数的10%。这是包含使用的任何数据库的正常行为<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 和 / 或<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 在Linux上、因为这些选项会对Linux操作系统执行发生原因操作、以便不断地从存储系统中重新加载文件元数据。访问和getattr等操作是低影响操作、可通过数据库环境中的ONTAP缓存进行处理。不应将其视为真正的IOPS、例如读取和写入、因为它们会对存储系统产生真正的需求。但是、其他这些IOPS确实会产生一些负载、尤其是在RAC环境中。要解决这种情况、请启用DNFS、它会绕过操作系统缓冲区缓存并避免执行这些不必要的元数据操作。</block>
  <block id="041f371e212c70407e145ae9f752a8b4" category="section-title">Linux Direct NFS</block>
  <block id="dd2f3f344f14ae5daf12cb0a817a72e0" category="paragraph">一个额外的挂载选项、称为<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block>如果(a)启用了DNFS、并且(b)在单个服务器上多次挂载源卷(c)并使用嵌套NFS挂载、则需要使用此选项。此配置主要出现在支持SAP应用程序的环境中。例如、NetApp系统上的单个卷的目录可能位于<block ref="9f9f4ccb1fc3afcbfe0cc3f5eac4332c" prefix=" " category="inline-code"></block> 然后、再按<block ref="ac2f9bbcd397d8f6b39e6713658051ea" prefix=" " category="inline-code"></block>。条件<block ref="9f9f4ccb1fc3afcbfe0cc3f5eac4332c" prefix=" " category="inline-code"></block> 挂载于<block ref="9ad16912cc0ba54a259b1a15d233c264" prefix=" " category="inline-code"></block> 和<block ref="ac2f9bbcd397d8f6b39e6713658051ea" prefix=" " category="inline-code"></block> 挂载于<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>的结果是来自同一源的嵌套NFS挂载。</block>
  <block id="b06ff38483faff2d17d8de1fc966848e" category="paragraph">操作系统可以检测到这一事实<block ref="9ad16912cc0ba54a259b1a15d233c264" prefix=" " category="inline-code"></block> 和<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block> 位于同一个卷上、即同一个源文件系统。然后、操作系统会使用相同的设备句柄来访问数据。这样做可以改进操作系统缓存和某些其他操作的使用、但会干扰DNFS。如果DNFS必须访问某个文件、例如<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block>，开<block ref="1da707b60c3b55bd01cb7df7c171a368" prefix=" " category="inline-code"></block>，则可能会错误地尝试使用错误的数据路径。结果是I/O操作失败。在这些配置中、添加<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block> 将选项挂载到与该主机上的另一个NFS文件系统共享源FlexVol卷的任何NFS文件系统。这样做会强制Linux操作系统为该文件系统分配独立的设备句柄。</block>
  <block id="14dd7af30f62ec838445a1e167d2aff6" category="section-title">Linux Direct NFS和Oracle RAC</block>
  <block id="c6a209e4ad702c6424efb7d63d76feca" category="paragraph">使用DNFS对于Linux操作系统上的Oracle RAC具有特殊的性能优势、因为Linux没有强制执行直接I/O的方法、而RAC需要执行直接I/O才能在节点间保持一致。作为临时解决策、Linux需要使用<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 挂载选项、此选项会导致操作系统缓存中的文件数据立即过期。而此选项又会强制Linux NFS客户端不断重新读取属性数据、从而会损害延迟并增加存储控制器上的负载。</block>
  <block id="3070cb366c38db327b0cf057d63792c1" category="paragraph">启用DNFS会绕过主机NFS客户端并避免这种损坏。多家客户报告说、在启用DNFS时、RAC集群的性能显著提高、ONTAP负载显著降低(尤其是与其他IOPS相关的负载)。</block>
  <block id="e97ab7f94d503bbec4b013b5b77118c6" category="section-title">Linux Direct NFS和oranfstab文件</block>
  <block id="f63255b70940d25581e0cf5f81dd6cd6" category="paragraph">如果在Linux上使用DNFS和多路径选项、则必须使用多个子网。在其他操作系统上、可以使用建立多个DNFS通道<block ref="54b4c4075463b2e02cd69f5cd139b5b2" prefix=" " category="inline-code"></block> 和<block ref="bbf52a1a57a4eaa83512cab68fd52b70" prefix=" " category="inline-code"></block> 用于在一个子网上配置多个DNFS通道的选项。但是、这在Linux上不能正常工作、可能会导致意外的性能问题。在Linux中、用于DNFS流量的每个NIC都必须位于不同的子网上。</block>
  <block id="6c5cf31ca1af553b1f4a9b99e3cb054c" category="section-title">I/O计划程序</block>
  <block id="49bb1f5f4810e5f3d32dac84bd96005d" category="paragraph">Linux内核允许对块设备的I/O计划方式进行低级控制。各种Linux发行版的默认值差别很大。测试表明、截止日期通常会获得最佳结果、但NOOP有时会稍好一些。性能差异极小、但如果需要从数据库配置中提取尽可能高的性能、请同时测试这两个选项。CFQ是许多配置中的默认设置、它已证明数据库工作负载存在严重的性能问题。</block>
  <block id="38f25b8840d56fc601af1024115764b2" category="paragraph">有关配置I/O计划程序的说明、请参见相关的Linux供应商文档。</block>
  <block id="4150162ad42bffea7bb903b4c7a4ffd9" category="section-title">多路径</block>
  <block id="305482bf1c318f0a9a04f94987db06b2" category="paragraph">某些客户在网络中断期间遇到崩溃、因为多路径守护进程未在其系统上运行。在最新版本的Linux上、操作系统和多路径守护进程的安装过程可能会使这些操作系统容易受到此问题的影响。软件包安装正确、但未配置为在重新启动后自动启动。</block>
  <block id="6fb0bf499bef576f56e0fd6360eba0a6" category="paragraph">例如、RHEL5.5上的多路径守护进程的默认设置可能如下所示：</block>
  <block id="31026ba0b77cbe4c9d44ed6afc859ed6" category="paragraph">可使用以下命令更正此问题：</block>
  <block id="c759a9b7e4db09da8a25fb73d256f6b7" category="section-title">ASM镜像</block>
  <block id="f2f41836b42c08199948378b4a4a6e26" category="paragraph">ASM 镜像可能需要更改 Linux 多路径设置，以使 ASM 能够识别问题并切换到备用故障组。ONTAP 上的大多数 ASM 配置都使用外部冗余，这意味着数据保护由外部阵列提供，并且 ASM 不会镜像数据。某些站点使用正常冗余的 ASM 来提供双向镜像，通常在不同站点之间进行镜像。</block>
  <block id="25f47751ccd5df99e3c25a8eb2a21fc5" category="inline-link-macro">NetApp主机实用程序文档</block>
  <block id="066a79b72a430b074cdc0476b67bbde3" category="paragraph">中显示的Linux设置 <block ref="210658f6fe0d0061c73c19a9a6b263d1" category="inline-link-macro-rx"></block> 包括导致I/O无限期排队的多路径参数这意味着、没有活动路径的LUN设备上的I/O会根据需要等待I/O完成。这通常是可取的、因为Linux主机会根据需要等待很长时间、以便SAN路径更改完成、FC交换机重新启动或存储系统完成故障转移。</block>
  <block id="184ea23c04f24d03fc0123bc6eb30de2" category="paragraph">这种无限制排队行为会导致ASM镜像出现问题、因为ASM必须收到I/O故障、才能在备用LUN上重试I/O。</block>
  <block id="5616945ee545765b51d3fe1871cff4ec" category="paragraph">在Linux中设置以下参数<block ref="9ac80d53ede05256c28cf9e043eb423c" prefix=" " category="inline-code"></block> 用于ASM镜像的ASM LUN文件：</block>
  <block id="49af3bbe0c557480960d217b217502ff" category="paragraph">这些设置会为ASM设备创建120秒超时。超时计算为<block ref="e2f0125c5971e1ce714f86f145386ee3" prefix=" " category="inline-code"></block> *<block ref="9434de34302b4f40887a7277cf35a8fc" prefix=" " category="inline-code"></block> 以秒为单位。在某些情况下、可能需要调整确切的值、但120秒的超时时间对于大多数使用来说应该足以满足要求。具体来说、120秒应允许控制器接管或恢复发生、而不会产生会导致故障组脱机的I/O错误。</block>
  <block id="dbff1dc161f3f1d61258259b3a0b549c" category="paragraph">a较低<block ref="9434de34302b4f40887a7277cf35a8fc" prefix=" " category="inline-code"></block> 值可以缩短ASM切换到备用故障组所需的时间、但这也会增加在控制器接管等维护活动期间发生不必要故障转移的风险。可以通过仔细监控ASM镜像状态来缓解此风险。如果发生不必要的故障转移、并且重新同步执行速度相对较快、则可以快速重新同步镜像。对于追加信息、请参见有关使用的Oracle软件版本的ASM快速镜像重新同步的Oracle文档。</block>
  <block id="ec0b68df6b5a0fdd6d73ac710b9684da" category="section-title">Linux xfs、ext3和ext4挂载选项</block>
  <block id="278230e4238d02fcb49850454e7d79e0" category="admonition">* NetApp建议*使用默认挂载选项。</block>
  <block id="17361a1d111a3ff3a45b20c3a1efa11b" category="summary">Oracle和TCP/IP以及以太网配置。</block>
  <block id="fe586387f0871fa578f77ac2e26e624a" category="doc">Oracle数据库的TCP/IP和以太网配置</block>
  <block id="02a5a4d50c5112bb31ff9c94f5b47ce9" category="paragraph">许多基于ONTAP的Oracle客户使用以太网、即NFS、iSCSI、NVMe/TCP的网络协议、尤其是云。</block>
  <block id="8a1870adbe8a237106c32d72660a9c42" category="summary">Oracle数据库的逻辑接口设计</block>
  <block id="f46a94d438563c03413adfec27c6bfda" category="paragraph">Oracle数据库需要访问存储。逻辑接口(Logical Interface、Logical Interface、Logical Interface)是将Storage Virtual Machine (SVM)连接到网络并进而连接到数据库的网络管道。要确保每个数据库工作负载都有足够的带宽、并且故障转移不会导致存储服务丢失、需要正确的LIF设计。</block>
  <block id="f445528d334d486a14570735705e2223" category="summary">适用于Oracle数据库的FC网络配置</block>
  <block id="ee955933387c00b282dcfda69005517f" category="doc">适用于Oracle的FC配置</block>
  <block id="92cdde4ecc529b9f9379ed2bdb6aae34" category="paragraph">为Oracle数据库配置FC SAN主要是遵循日常SAN最佳实践。</block>
  <block id="953369199e3a71ad1ad58bc7d5ad2d9f" category="summary">NetApp ONTAP是一款功能强大的数据管理平台、具有本机功能、包括即时备份、还原和克隆功能、实时数据压缩等效率功能、无中断硬件升级以及从外部存储阵列导入LUN的功能。</block>
  <block id="9eaca569c6f5ca3388f5613da3aa008c" category="doc">基于ONTAP的Oracle数据库</block>
  <block id="528b35962f1679204260ddef6800eece" category="paragraph">ONTAP专为Oracle数据库而设计。几十年来、ONTAP针对关系数据库I/O的独特需求进行了优化、并专门为满足Oracle数据库的需求而创建了多种ONTAP功能、甚至是应Oracle Inc.本身的要求也是如此。</block>
  <block id="c9f8ef2db64ce19b15d2cc98fbd3d24c" category="admonition">本文档将取代以前发布的技术报告_TR-3633：《基于ONTAP的Oracle数据库》；TR-4591：《Oracle数据保护：备份、恢复、复制》；TR-4592：《基于MetroCluster的Oracle》；以及TR-4534：《将Oracle数据库迁移到NetApp存储系统》_</block>
  <block id="b42ad0517ef7394f97178fb9e1de8d78" category="paragraph">除了ONTAP为数据库环境带来价值的多种可能方式之外、还有各种各样的用户要求、包括数据库大小、性能要求和数据保护需求。NetApp存储的已知部署包括从在VMware ESX下运行的大约6、000个数据库的虚拟化环境到当前大小为996 TB且在不断增长的单实例数据仓库等所有内容。因此、在NetApp存储上配置Oracle数据库的明确最佳实践很少。</block>
  <block id="7bf0493f27e81fe4c3740e773e137a48" category="paragraph">在NetApp存储上运行Oracle数据库的要求可通过两种方式来满足。首先、当存在明确的最佳实践时、我们将专门予以说明。概括地说、我们将根据Oracle存储解决方案架构师的特定业务需求来说明他们必须考虑的许多设计注意事项。</block>
  <block id="633d94718c25247da5772ed6f2b244c9" category="summary">Oracle存储迁移简介</block>
  <block id="6ca08c212e9ec987ce485fd9c7705eff" category="doc">将Oracle数据库迁移到NetApp存储系统</block>
  <block id="9e099143017b5d9ff9c117de4ac659d7" category="paragraph">利用新存储平台的功能有一个不可避免的要求：必须将数据放置在新存储系统上。</block>
  <block id="08beeb11d62fd51ef2742eae3ee3719f" category="admonition">本文档将取代先前发布的技术报告_TR-4534：《将Oracle数据库迁移到NetApp存储系统》_</block>
  <block id="5f2a4190824fd64be3c8cabeb7dc62ff" category="paragraph">对于新的数据库项目、这不是问题、因为数据库和应用程序环境已构建到位。但是、迁移在业务中断、完成迁移所需的时间、所需的技能组合以及风险最小化方面带来了特殊挑战。</block>
  <block id="a83f1ca5ad00b39773d9e6a26b0e70b2" category="section-title">脚本</block>
  <block id="08293bec81c296b61f4a751175d9caa7" category="paragraph">本文档提供了示例脚本。这些脚本提供了一些示例方法、用于自动执行各个方面的迁移、以降低出现用户错误的几率。这些脚本可以降低对负责迁移的IT人员的总体需求、并加快整个过程。这些脚本全部取自NetApp专业服务和NetApp合作伙伴执行的实际迁移项目。本文档通篇展示了这些参数的用法示例。</block>
  <block id="b3978e376e381abd116a2ae7938d8a9c" category="summary">FLI Cutover—Oracle</block>
  <block id="c28b52826242c7cdffe5f3ae1e917f61" category="paragraph">由于需要更改FC网络配置、外部LUN导入期间不可避免地会发生某些中断。但是、中断的持续时间不必比重新启动数据库环境并更新FC分区以将主机FC连接从外部LUN切换到ONTAP所需的时间长。</block>
  <block id="a2248459756ffc1877beb9b39c77668b" category="paragraph">此过程可概括如下：</block>
  <block id="c9f77905e39abbada6c73a7a3d5f51f8" category="list-text">将外部LUN上的所有LUN活动置于静噪状态。</block>
  <block id="cff6e7c6c4f8dd7e57a0286f28712c58" category="list-text">将主机FC连接重定向到新的ONTAP系统。</block>
  <block id="9fea842823b73e1eb32307ab325f170e" category="list-text">触发导入过程。</block>
  <block id="df814ea2bf92d4f18e72a648e93103a2" category="list-text">重新发现LUN。</block>
  <block id="030a5009bbe6fb141ca5863ab6c59464" category="list-text">重新启动数据库。</block>
  <block id="f3bb22d18791c042e889671ad1963239" category="paragraph">您无需等待迁移过程完成。给定LUN的迁移开始后、该LUN便可在ONTAP上使用、并可在数据复制过程继续期间提供数据。所有读取都会传递到外部LUN、所有写入都会同步写入到两个阵列。复制操作速度非常快、重定向FC流量的开销也非常小、因此对性能的任何影响都应该是瞬时的、并且最小化。如果有问题、您可以延迟重新启动环境、直到迁移过程完成并删除导入关系之后。</block>
  <block id="b19e17ab765f91aa0bc0e7152f13779f" category="section-title">关闭数据库</block>
  <block id="2869cd69e0fec20ba28a42e74afef158" category="paragraph">在此示例中、静音环境的第一步是关闭数据库。</block>
  <block id="e20dab0880a91f5da2ea05170177576d" category="section-title">关闭网格服务</block>
  <block id="89c458e5176d6caf0690f1e61ecb0620" category="paragraph">要迁移的基于SAN的文件系统之一还包括Oracle ASM服务。暂停底层LUN需要卸载文件系统、这反过来意味着停止此文件系统上具有已打开文件的所有进程。</block>
  <block id="49f05bf7da4eacfa4c80bb987443eb5a" category="section-title">卸载文件系统</block>
  <block id="c5a09ac3ff0bb25c97951c7b7f815cd0" category="paragraph">如果所有进程均已关闭、则卸载操作将成功。如果权限被拒绝、则文件系统上必须存在一个具有锁定的进程。。<block ref="ace112f9725b6fa0b702e6b3970b2102" prefix=" " category="inline-code"></block> 命令有助于识别这些进程。</block>
  <block id="765e13ffc3361a9fd6c6088b2603ffbf" category="section-title">停用卷组</block>
  <block id="907e5f35f70dc2f5e4b67da56381bdf4" category="paragraph">卸载给定卷组中的所有文件系统后、可以停用该卷组。</block>
  <block id="ad80f935ccd133a802189e3c2f4421d7" category="section-title">FC网络更改</block>
  <block id="a497da6790d9ab4bb5cce3d04b0efd2e" category="paragraph">现在、可以更新FC分区、以删除主机对外部阵列的所有访问权限、并建立对ONTAP的访问权限。</block>
  <block id="3ef31115a10790468ad841ec2cdf566f" category="section-title">启动导入过程</block>
  <block id="5bc309ef1913ddc70534a0a7135ba938" category="paragraph">要启动LUN导入过程、请运行<block ref="76ffc50817aa4cd6214aa0061339fdf6" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="0a10f1ad4a0b45d384c5771ec0906c4c" category="section-title">监控导入进度</block>
  <block id="9a3a7545f4a7407ec022c4b2271e0c34" category="paragraph">可以使用监控导入操作<block ref="1ab15ef2c245a4434fcea3cc3149f4f4" prefix=" " category="inline-code"></block> 命令：如下图所示、所有20个LUN的导入正在进行中、这意味着现在可以通过ONTAP访问数据、即使数据复制操作仍在进行。</block>
  <block id="d36f98c8a305e33483232e7b5cd90c49" category="inline-link-macro">外部LUN导入—完成</block>
  <block id="24a74765303a8fc0e4b1e7afbb8e2205" category="paragraph">如果需要脱机进程、请将重新发现或重新启动服务延迟到<block ref="1ab15ef2c245a4434fcea3cc3149f4f4" prefix=" " category="inline-code"></block> 命令表示所有迁移均已成功完成。然后、您可以按照中所述完成迁移过程 <block ref="5b0017122426f8734e0358273adc6802" category="inline-link-macro-rx"></block>。</block>
  <block id="a9c97f84ee4958d39ed989b3da7ed0ba" category="paragraph">如果需要联机迁移、请继续在新主目录中重新发现LUN并启动服务。</block>
  <block id="d0369936c6fe8c292874e3bc647893b8" category="section-title">扫描SCSI设备更改</block>
  <block id="6d338faddede649cab4c5b498e8e4379" category="paragraph">在大多数情况下、重新发现新LUN的最简单方法是重新启动主机。这样做会自动删除旧的陈旧设备、正确发现所有新LUN并构建关联的设备、例如多路径设备。此处的示例显示了一个完全联机的流程、用于演示目的。</block>
  <block id="3b493a859f19779c1f7db7d1951785ee" category="paragraph">注意：重新启动主机之前、请确保中的所有条目都已启用<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 此参考迁移的SAN资源已被注释掉。如果不执行此操作、并且LUN访问出现问题、则操作系统可能无法启动。这种情况不会损坏数据。但是、启动到救援模式或类似模式并更正可能会非常不方便<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 以便可以启动操作系统以启用故障排除。</block>
  <block id="9d7b16568eb7edb80492b49cb02d7663" category="paragraph">可以使用重新扫描此示例中使用的Linux版本上的LUN<block ref="b6f75508bf2af141e9de6f862662661e" prefix=" " category="inline-code"></block> 命令：如果命令成功、则输出中应显示每个LUN路径。输出可能难以解释、但如果分区和igrop配置正确、则应显示许多LUN包含<block ref="971c047750d8e3b03c71d24020b3816f" prefix=" " category="inline-code"></block> 供应商字符串。</block>
  <block id="3384aa7c090758ad18028832967b143f" category="section-title">检查多路径设备</block>
  <block id="07a39d42e6d8cc61e0a880e43b83e2a3" category="paragraph">LUN发现过程还会触发多路径设备的重新创建、但已知Linux多路径驱动程序偶尔会出现问题。的输出<block ref="eeb30d005cab1d8c69785a3cd5818f55" prefix=" " category="inline-code"></block> 应进行检查、以验证输出是否如预期。例如、以下输出显示了与关联的多路径设备<block ref="971c047750d8e3b03c71d24020b3816f" prefix=" " category="inline-code"></block> 供应商字符串。每个设备都有四个路径、其中两个路径的优先级为50、两个路径的优先级为10。尽管不同版本的Linux的确切输出可能会有所不同、但此输出看起来与预期一致。</block>
  <block id="efd921479c3d57448954050760c568ca" category="admonition">请参考用于验证的Linux版本的Host Utilities文档<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 设置正确。</block>
  <block id="28751dc1e914a778d11ca0e69613690b" category="section-title">重新激活LVM卷组</block>
  <block id="a66a38e4056f28a310ef6d1fa8bbcc77" category="paragraph">如果已正确发现LVM LUN、则<block ref="5239f542d8edbc4b528b1f362153c0c7" prefix=" " category="inline-code"></block> 命令应成功。这是一个很好的逻辑卷管理器价值示例。更改LUN的WWN甚至序列号并不重要、因为卷组元数据会写入LUN本身。</block>
  <block id="1d374f8de5ba1b82ab4407b8c6efbd0d" category="paragraph">操作系统扫描了LUN、发现写入LUN上的少量数据、将其标识为属于的物理卷<block ref="83b7788c8e4de444d6cd4c69978eaf32" prefix=" " category="inline-code"></block>。然后构建所有必需的设备。只需重新激活卷组即可。</block>
  <block id="1f0285a57b2357507c3b77ce5130b548" category="section-title">重新挂载文件系统</block>
  <block id="a9047d68dc7e99f553b71590cff301d6" category="paragraph">重新激活卷组后、可以在挂载文件系统时保持所有原始数据完好无损。如前文所述、即使数据复制在后端组中仍处于活动状态、文件系统也能完全正常运行。</block>
  <block id="a787d65e2525ac6bc3a6328efe383b5c" category="section-title">重新扫描ASM设备</block>
  <block id="a25bb20f07ed95a633f623678855e8dc" category="paragraph">重新扫描SCSI设备时、应已重新发现ASMlib设备。可以通过重新启动ASMlib并扫描磁盘来联机验证重新发现。</block>
  <block id="37fb12a52b4a5371c12209e89e09b04f" category="admonition">此步骤仅与使用ASMlib的ASM配置相关。</block>
  <block id="6de48f39063d81d53fd0ff3e9938af13" category="paragraph">注意：如果未使用ASMlib、则为<block ref="9c9f766701f811ef6f170c7a3453c53f" prefix=" " category="inline-code"></block> 设备应已自动重新创建。但是、权限可能不正确。如果没有ASMlib、则必须在底层设备上为ASM设置特殊权限。通常通过任一中的特殊条目来完成此操作<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 或<block ref="ab775c875d5f89d991a670444dd32ad2" prefix=" " category="inline-code"></block> 规则、或者可能同时位于这两个规则集中。可能需要更新这些文件、以反映环境中的WWN或序列号变化、从而确保ASM设备仍具有正确的权限。</block>
  <block id="08b33d6af4ec78f99dbbc3533589aafc" category="paragraph">在此示例中、重新启动ASMlib并扫描磁盘会显示与原始环境相同的10个ASM LUN。</block>
  <block id="17c4ae76000d9a79a56195071665af32" category="section-title">重新启动网格服务</block>
  <block id="e8c3dc00e15826e3b77a2d41d7fde92a" category="paragraph">现在LVM和ASM设备已联机且可用、可以重新启动网格服务。</block>
  <block id="934317e45581988a01f54761705ca58a" category="section-title">重新启动数据库</block>
  <block id="41475a737e947d73c674b90e78e246a0" category="paragraph">重新启动网格服务后、可以启动数据库。在尝试启动数据库之前、可能需要等待几分钟、以便ASM服务完全可用。</block>
  <block id="0b986cf2a434b03b097578ad444e72f0" category="summary">正在完成FLI转换- Oracle</block>
  <block id="24bd7d2a01571aa270c81d8d9f8370e9" category="doc">FLI完成—Oracle</block>
  <block id="b171714b39ad4102aced4daceef8c678" category="paragraph">从主机角度来看、迁移已完成、但仍会从外部阵列提供I/O、直到删除导入关系为止。</block>
  <block id="f708d001227724fa0a8a3d57aacedb1a" category="paragraph">在删除关系之前、必须确认所有LUN的迁移过程均已完成。</block>
  <block id="85cf20229bc9008553794abdaed507f5" category="section-title">删除导入关系</block>
  <block id="b23ec325eb9c6278cb36e4c45c2c3499" category="paragraph">迁移过程完成后、删除此迁移关系。完成此操作后、I/O将专门从ONTAP上的驱动器提供。</block>
  <block id="40b98b0023a7eea7c432c29e3c44ba7d" category="section-title">取消注册外部LUN</block>
  <block id="5ccc14ae93ba94bd4183439a9f80f6c8" category="paragraph">最后、修改磁盘以删除<block ref="96ea0e5f46787e93e2970a086b47fdb6" prefix=" " category="inline-code"></block> 名称。</block>
  <block id="875bb561ba851d301052704e0ffb70f4" category="summary">通过日志传送实现Oracle迁移</block>
  <block id="e0f9c3b73fe5700df95f30eb98ca4034" category="doc">Oracle日志传送</block>
  <block id="8e42b5809657e127c7e2d24f30bc493e" category="paragraph">使用日志传送进行迁移的目标是、在新位置创建原始数据文件的副本、然后建立将更改传送到新环境的方法。</block>
  <block id="599df5f564506c95624dd78b0b75eeac" category="paragraph">建立日志后、可以自动进行日志传输和重放、以使副本数据库与源数据库大致保持同步。例如、可以计划cron作业：(a)将最新日志复制到新位置、(b)每15分钟重放一次。这样做可以最大程度地减少转换时的中断、因为回写的归档日志不能超过15分钟。</block>
  <block id="41bec1b4ddc17b3367c68a025c0ddfb9" category="paragraph">下面显示的操作步骤本质上也是一个数据库克隆操作。显示的逻辑类似于NetApp SnapManager for Oracle (SMO)和NetApp SnapCenter Oracle插件中的引擎。某些客户已使用脚本或WFA工作流中显示的操作步骤执行自定义克隆操作。虽然此操作步骤比使用SMO或SnapCenter更需要手动操作、但仍可随时编写脚本、ONTAP中的数据管理API进一步简化了此过程。</block>
  <block id="f0616883a5ca70aa97676de436a7fb9e" category="section-title">日志传送-文件系统到文件系统</block>
  <block id="8f922b64f0bc64f6bba1d555a61ee3bb" category="paragraph">此示例演示了将名为waffle的数据库从普通文件系统迁移到位于不同服务器上的另一个普通文件系统的过程。同时、还展示了如何使用SnapMirror快速复制数据文件、但这并不是整个操作步骤不可或缺的一部分。</block>
  <block id="60100e1b826a4b972fc113c391f932e7" category="section-title">创建数据库备份</block>
  <block id="80cf34e10dcfbc5e76c6b2f845f2708d" category="paragraph">第一步是创建数据库备份。具体来说、此操作步骤需要一组数据文件、可用于归档日志重放。</block>
  <block id="0ba29c6a1afacf586b03a26162c72274" category="section-title">environment</block>
  <block id="82f9b672d88793b2ca5716b2a5427056" category="paragraph">在此示例中、源数据库位于ONTAP系统上。创建数据库备份的最简单方法是使用Snapshot副本。数据库将处于热备份模式几秒钟、而处于<block ref="252ce13e6c150af4d3e7eea5fca266bc" prefix=" " category="inline-code"></block> 在托管数据文件的卷上执行此操作。</block>
  <block id="1fd3a22cf15d1e18a6507f539346c40d" category="paragraph">其结果是在名为的磁盘上生成一个Snapshot副本<block ref="a8b3bc9f12cd194b80d404c30e9015ee" prefix=" " category="inline-code"></block> 该映像包含处于热备份模式时的数据文件映像。如果将此Snapshot副本中的数据与相应的归档日志结合使用以使数据文件保持一致、则可以将其用作还原或克隆的基础。在这种情况下、它会复制到新服务器。</block>
  <block id="744a73803cdac4a5067725ca5814a2cf" category="section-title">还原到新环境</block>
  <block id="46228bb2ce31b0d397faad2b805e8a37" category="paragraph">现在、必须在新环境中还原备份。这可以通过多种方式实现、包括Oracle RMAN、从备份应用程序(如NetBackup)还原、或者对处于热备份模式的数据文件执行简单的复制操作。</block>
  <block id="ca7da361ad92f677545e12dd462c6e39" category="paragraph">在此示例中、使用SnapMirror将名为热备份的Snapshot副本复制到新位置。</block>
  <block id="1f255556546f1fdfb53692e41f35eb6c" category="list-text">创建新卷以接收快照数据。从初始化镜像<block ref="937e9fa808ccfe9a4f6b004a2a7caada" prefix=" " category="inline-code"></block> to<block ref="96f9dacb3cb1b1f6f9b4ad02992a1a0e" prefix=" " category="inline-code"></block>。</block>
  <block id="5b1944ec8c0ed933e5b2ea2e3e5fa76e" category="list-text">在SnapMirror设置状态(指示同步已完成)后、请根据所需的快照专门更新镜像。</block>
  <block id="f4d90c6c29b1f76ab9c87a9996c9751e" category="list-text">可以通过查看来验证同步是否成功<block ref="31952c255e722053d4cc3f82921e95db" prefix=" " category="inline-code"></block> 字段。</block>
  <block id="0934c3fcad3065c2a479125e4a80b259" category="list-text">然后、可以断开镜像。</block>
  <block id="fcf1f505b94151a36eba8e1563e7176f" category="list-text">挂载新文件系统。对于基于块的文件系统、具体过程因使用的LVM而异。必须配置FC分区或iSCSI连接。与LUN建立连接后、可以使用Linux等命令<block ref="302c49bbd5bcda5463eb5130804effc1" prefix=" " category="inline-code"></block> 可能需要查找哪些卷组或LUN需要正确配置才能被ASM发现。</block>
  <block id="20c4d1d4163c2463cf15ff7df6424459" category="paragraph">在此示例中、使用的是简单的NFS文件系统。可以直接挂载此文件系统。</block>
  <block id="b2dd88a1f03a5fb4c2e3c0d46f425161" category="section-title">创建控制文件创建模板</block>
  <block id="1c30e11140f1d0a1093bedee34eef1e4" category="paragraph">接下来必须创建控制文件模板。。<block ref="3177841b2335a6640ea3054199830f1c" prefix=" " category="inline-code"></block> 命令用于创建文本命令以重新创建控制文件。在某些情况下、此功能对于从备份还原数据库非常有用、并且通常与执行数据库克隆等任务的脚本结合使用。</block>
  <block id="3f51d58ec72b9d36cb5e0636525130b5" category="list-text">以下命令的输出用于为迁移的数据库重新创建控制文件。</block>
  <block id="cb395c3bf18fd427287caecc9b28058a" category="list-text">创建控制文件后，将文件复制到新服务器。</block>
  <block id="cf5c9046a3617a19c0ccc24e4cf54a33" category="section-title">备份参数文件</block>
  <block id="0d1d1a7db58f3f93ec977733f4909f5d" category="paragraph">在新环境中、还需要一个参数文件。最简单的方法是从当前的spfile或pfile创建一个pfile。在此示例中、源数据库使用的是spfile。</block>
  <block id="051a634cb1e9a53dbf139214e1d24001" category="section-title">创建oratab条目</block>
  <block id="2dabc26c8b55d44e25a184ba2624eed0" category="paragraph">要使oraenv等实用程序正常运行、必须创建oratab条目。要创建oratab条目、请完成以下步骤。</block>
  <block id="87ef75141d237e3b44e8310aad8fcf19" category="section-title">准备目录结构</block>
  <block id="12f833c44c11e6bbd970cc126bce2bcb" category="paragraph">如果所需目录不存在、则必须创建它们、否则数据库启动操作步骤将失败。要准备目录结构、请满足以下最低要求。</block>
  <block id="60225c364a012796a6d886e8cf4ec486" category="section-title">参数文件更新</block>
  <block id="e36ee2d9a95a6b672917862d714af383" category="list-text">要将参数文件复制到新服务器、请运行以下命令。默认位置为<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目录。在这种情况下、pfile可以放置在任何位置。它仅用作迁移过程中的中间步骤。</block>
  <block id="d437a40a59905247cfb39cf9dc9da256" category="list-text">根据需要编辑文件。例如、如果归档日志位置已更改、则必须更改pfile以反映新位置。在此示例中、仅重新定位控制文件、部分目的是在日志和数据文件系统之间分布控制文件。</block>
  <block id="55cc35656c3d28c1b3267c246b397521" category="list-text">编辑完成后、根据此pfile创建一个spfile。</block>
  <block id="a833a03e6af0b969524dcccb8f296f1c" category="section-title">重新创建控制文件</block>
  <block id="74a636ee3a009f08cd5623dc8066dd09" category="paragraph">在上一步中、是的输出<block ref="3177841b2335a6640ea3054199830f1c" prefix=" " category="inline-code"></block> 已复制到新服务器。所需输出的具体部分是<block ref="0ca1fba455d799b9a1cc2440b9ba7043" prefix=" " category="inline-code"></block> 命令：此信息可在标记的部分下的文件中找到<block ref="9fb76d62be749cec8bdd06f46c77bf5b" prefix=" " category="inline-code"></block>。它从行开始<block ref="13ac20c4a96b2ecfd703e831ad722907" prefix=" " category="inline-code"></block> 并应包含该词<block ref="c3c62948f78a7ccaabb9ef2eea80a895" prefix=" " category="inline-code"></block>。以分号(;)字符结尾。</block>
  <block id="bf4b2a006646a8e77166a2a596425074" category="list-text">在此示例操作步骤中、该文件如下所示。</block>
  <block id="a9a27c002ec883341220e267712250a7" category="list-text">根据需要编辑此脚本、以反映各种文件的新位置。例如、某些已知支持高I/O的数据文件可能会重定向到高性能存储层上的文件系统。在其他情况下、更改可能纯粹出于管理员原因、例如、将给定PDB的数据文件隔离到专用卷中。</block>
  <block id="2540fb1670d4f9ee8a704a7eb8d748fe" category="list-text">在此示例中、将显示<block ref="b86df74c6982de8dec7509d039294d7a" prefix=" " category="inline-code"></block> 虽然保持不变、但重做日志会移动到中的新位置<block ref="96bb85ed0fe822778c4e5a821e991ad8" prefix=" " category="inline-code"></block> 而不是与归档登录共享空间<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block>。</block>
  <block id="8d47ad079859f2976fdc7ebf742f768d" category="paragraph">如果任何文件放错位置或参数配置错误、则会生成错误、指示必须修复的问题。数据库已挂载、但尚未打开、无法打开、因为正在使用的数据文件仍标记为处于热备份模式。必须先应用归档日志、以使数据库保持一致。</block>
  <block id="6b7c2d588ac708b58f7ac889090608f6" category="section-title">初始日志复制</block>
  <block id="2db2d3d6001a06d1a027904fa66bc78c" category="paragraph">要使数据文件保持一致、至少需要执行一个日志回复操作。有许多选项可用于重放日志。在某些情况下、可以通过NFS共享原始服务器上的原始归档日志位置、并且可以直接进行日志回复。在其他情况下、必须复制归档日志。</block>
  <block id="5c394e6951584d114c6706d0768e30d7" category="paragraph">例如、一个简单的<block ref="8a444a43bdf534c0c6338bb7809659b3" prefix=" " category="inline-code"></block> 此操作可以将所有当前日志从源服务器复制到迁移服务器：</block>
  <block id="5fdb3158ed28dd3aa90b94556476b781" category="section-title">初始日志重放</block>
  <block id="c2f93ef52583f81f0eba05a39483e2d8" category="paragraph">文件位于归档日志位置后、可以发出命令来重新显示它们<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block> 然后是响应<block ref="e1f2d5134ed2543d38a0de9751cf75d9" prefix=" " category="inline-code"></block> 自动重放所有可用日志。</block>
  <block id="f30a45a22256018185c5d235292e4d5e" category="paragraph">最终归档日志回复报告错误、但这是正常的。日志指示<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 正在查找特定日志文件、但未找到它。原因很可能是日志文件尚不存在。</block>
  <block id="80bea8a60412cace54760b223b2d799e" category="paragraph">如果可以在复制归档日志之前关闭源数据库、则只能执行此步骤一次。归档日志会进行复制和重做、然后、该过程可以直接继续执行转换过程、以复制关键重做日志。</block>
  <block id="1e334141582a9dcb581c9b34ef2df071" category="section-title">增量日志复制和重放</block>
  <block id="5fd2b0bf662c2b1ebdc677ea888536ce" category="paragraph">在大多数情况下、不会立即执行迁移。迁移过程可能需要几天甚至几周才能完成、这意味着必须将日志持续运送到副本数据库并进行重新显示。因此、在转换完成后、必须传输和回显示最少的数据。</block>
  <block id="0c56d82ec6857bcef5475899b9f7b5cc" category="paragraph">这样做可以通过多种方式编写脚本、但更常见的方法之一是使用rsync、这是一个常见的文件复制实用程序。使用此实用程序的最安全方法是将其配置为守护进程。例如、<block ref="b31375af035ed8a698a803a491084f61" prefix=" " category="inline-code"></block> 下面的文件显示了如何创建名为的资源<block ref="260e23541ff372b9bc53b4bd3c0c38ba" prefix=" " category="inline-code"></block> 可通过Oracle用户凭据访问并映射到<block ref="488a4921a81e36fca411e6f13cefbbf2" prefix=" " category="inline-code"></block>。最重要的是、资源设置为只读、这样可以读取生产数据、但不会对其进行更改。</block>
  <block id="eabf1b424989b2c7113ba3a538079afa" category="paragraph">以下命令将新服务器的归档日志目标与rsync资源同步<block ref="260e23541ff372b9bc53b4bd3c0c38ba" prefix=" " category="inline-code"></block> 在原始服务器上。。<block ref="e358efa489f58062f10dd7316b65649e" prefix=" " category="inline-code"></block> 中的参数<block ref="293e33723231f0504effabb52b054a31" prefix=" " category="inline-code"></block> 根据时间戳比较文件列表、并且仅复制新文件。此过程会对新服务器进行增量更新。也可以在cron中计划定期运行此命令。</block>
  <block id="c775c44069da13c8f7ee5c5116e76e36" category="inline-link-macro">重放数据库上的日志</block>
  <block id="c3bf9b2ef3e3ae2ae6a02f7f77cfcbc6" category="paragraph">收到日志后、必须对其进行重新显示。前面的示例显示了如何使用sqlplus手动运行<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block>，一个可以轻松实现自动化的过程。此处显示的示例使用中所述的脚本 <block ref="3e57a2099043fa40c58f1e0d4eed995d" category="inline-link-macro-rx"></block>。这些脚本接受一个参数、用于指定需要重放操作的数据库。这样就可以在多数据库迁移工作中使用相同的脚本。</block>
  <block id="4ea2a6c39b10b3e3076f976f58a861d1" category="section-title">转换</block>
  <block id="5de3f1ba0bbef459baa93f04f63b9ea1" category="paragraph">准备好转换到新环境后、必须执行一次最终同步、其中包括归档日志和重做日志。如果原始重做日志位置尚不已知、则可按如下方式进行标识：</block>
  <block id="677f005cc0f8be0f891df5af72fb5688" category="list-text">关闭源数据库。</block>
  <block id="41b182875e12de118d17b3432cca93fa" category="list-text">使用所需的方法在新服务器上对归档日志执行一次最终同步。</block>
  <block id="37d6d9420cef8230249e7691315f0e13" category="list-text">必须将源重做日志复制到新服务器。在此示例中、重做日志已重新定位到的新目录中<block ref="96bb85ed0fe822778c4e5a821e991ad8" prefix=" " category="inline-code"></block>。</block>
  <block id="d0a5f1380bd67b0d0fd3bc72f22d88f2" category="list-text">在此阶段、新数据库环境包含将其恢复到与源完全相同状态所需的所有文件。归档日志必须最后一次重新显示。</block>
  <block id="c2721157205b2d2e96c656c45ca72992" category="list-text">完成后、必须重做日志。如果消息<block ref="975df7a5099101ffbe47981cd1d37c2c" prefix=" " category="inline-code"></block> 将返回、此过程将成功、数据库将同步并可打开。</block>
  <block id="6acab27c5f334c66f06f3f74bc62d6d8" category="section-title">日志传送- ASM到文件系统</block>
  <block id="a67ffcc8b155bb909a6f8c5d5ba2f334" category="paragraph">此示例演示了如何使用Oracle RMAN迁移数据库。它与前面的文件系统到文件系统日志传送示例非常相似、但主机无法识别ASM上的文件。迁移ASM设备上的数据的唯一方法是重新定位ASM LUN或使用Oracle RMAN执行复制操作。</block>
  <block id="1c51600a778919f7f3abb5b25175220a" category="paragraph">虽然从Oracle ASM复制文件时需要使用RMAN、但RMAN的使用并不限于ASM。RMAN可用于从任何类型的存储迁移到任何其他类型。</block>
  <block id="2cb6a5bfc4a76f651d496cddc685e078" category="paragraph">此示例显示了将名为pancake的数据库从ASM存储重新定位到位于路径不同服务器上的常规文件系统<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 和<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block>。</block>
  <block id="d1d789c37f1c96d0a5de07798c14fcc5" category="paragraph">第一步是为要迁移到备用服务器的数据库创建备份。由于源使用Oracle ASM、因此必须使用RMAN。可以按如下所示执行简单的RMAN备份。此方法会创建一个带标记的备份、稍后可通过RMAN在操作步骤中轻松识别该备份。</block>
  <block id="ed927706d8abc2bbf3a5a8bc55e1e562" category="paragraph">第一个命令用于定义备份的目标类型以及要使用的位置。第二个选项仅启动数据文件的备份。</block>
  <block id="db85d05166dd65559ae5f426b51198e6" category="section-title">备份控制文件</block>
  <block id="a0b95d36955723a82dde7bbe40b6ccb9" category="paragraph">稍后需要在的操作步骤中为备份控制文件<block ref="08de2bfcc2d52d5bc4f3f2dcb97558ad" prefix=" " category="inline-code"></block> 操作。</block>
  <block id="76ff543de72e62217293a1d0ceade0aa" category="paragraph">在新环境中、还需要一个参数文件。最简单的方法是从当前的spfile或pfile创建一个pfile。在此示例中、源数据库使用spfile。</block>
  <block id="d28f3a5b77909b45c50e6c711bef8b60" category="section-title">ASM文件重命名脚本</block>
  <block id="c242730c760d895368557f78141ff8b1" category="paragraph">移动数据库时，控制文件中当前定义的几个文件位置会发生变化。以下脚本将创建一个RMAN脚本、以便于执行此过程。此示例显示了一个数据文件数量非常少的数据库、但数据库通常包含数百甚至数千个数据文件。</block>
  <block id="359b84bcf7447a77b212e844aeaa9d89" category="inline-link-macro">ASM到文件系统名称转换</block>
  <block id="374a1a0facd7c604ac09ed0dca6efb3e" category="paragraph">此脚本可在中找到 <block ref="288325982fd7bee6cf9eb66ad33f6f7a" category="inline-link-macro-rx"></block> 它做了两件事。</block>
  <block id="42787fdca1cf792241ce03151ec7dbd3" category="paragraph">首先、它会创建一个参数来重新定义重做日志位置、该位置称为<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block>。它本质上是一个交替字段的列表。第一个字段是当前重做日志的位置、第二个字段是新服务器上的位置。然后、重复执行此模式。</block>
  <block id="cf444fd96c87609516f0ad8212f41b01" category="paragraph">第二个功能是为数据文件重命名提供模板。该脚本循环显示数据文件、提取名称和文件编号信息、并将其格式化为RMAN脚本。然后、它会对临时文件执行相同的操作。结果是生成一个简单的RMAN脚本、可以根据需要进行编辑、以确保文件还原到所需位置。</block>
  <block id="50614366822786a4f2ee3a5065543634" category="paragraph">捕获此屏幕的输出。。<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block> 参数将按如下所述放置在pfile中。必须相应地编辑RMAN数据文件重命名和重复脚本、才能将数据文件放置在所需位置。在此示例中、它们全部置于中<block ref="36c3572e381980ee1f1343988ae4a955" prefix=" " category="inline-code"></block>。</block>
  <block id="e60cd818b9f7ae02a73d8b3a6ea0a809" category="paragraph">这些脚本几乎已准备就绪、可以执行、但首先必须设置好目录结构。如果所需目录不存在、则必须创建它们、否则数据库启动操作步骤将失败。以下示例反映了最低要求。</block>
  <block id="2f2eed2ed14ba876a017aa9ea9515724" category="paragraph">要使oraenv等实用程序正常运行、需要使用以下命令。</block>
  <block id="f34a9f7c077457a54f8838b55b9fc025" category="section-title">参数更新</block>
  <block id="fd5c3a935e7374f8b1577e73e85ef375" category="paragraph">必须更新保存的pfile、以反映新服务器上的任何路径更改。数据文件路径更改由RMAN复制脚本进行更改、几乎所有数据库都需要对进行更改<block ref="d98137bd230dac4372cf20a2e7839463" prefix=" " category="inline-code"></block> 和<block ref="2d205df7ae2efff1576140524b40b93c" prefix=" " category="inline-code"></block> parameters此外、还可能需要更改审核文件位置以及参数、例如<block ref="40f8833ae28ec69bcc89eb0eba090fe4" prefix=" " category="inline-code"></block> 在ASM之外可能不相关。经验丰富的DBA应在继续操作之前仔细查看建议的变更。</block>
  <block id="b581dd429e9b4c24127b8940ca8e4346" category="paragraph">在此示例中、主要更改包括控制文件位置、日志归档目标以及的添加<block ref="0f2d7ef9b967c2d9fb1ad5aa5e9eb688" prefix=" " category="inline-code"></block> 参数。</block>
  <block id="bbba1f65801697ba3abd94d90c83ba71" category="paragraph">确认新参数后、必须将这些参数生效。虽然存在多个选项、但大多数客户都会根据文本pfile创建spfile。</block>
  <block id="3a17a12678d74dabb1032aaf373166d8" category="section-title">启动非挂载</block>
  <block id="a9dc570a0b3161e69edc31f3545cbf22" category="paragraph">复制数据库前的最后一步是启动数据库进程、但不挂载文件。在此步骤中、spfile可能会出现明显问题。如果<block ref="357eedab214bb515c5622e275bc19cdb" prefix=" " category="inline-code"></block> 命令因参数错误而失败、关闭、更正pfile模板、将其重新加载为spfile并重试非常简单。</block>
  <block id="0257eff4bf9bf0cb483f2544fd42f109" category="section-title">复制数据库</block>
  <block id="4632b675c558eda129fe6da4fbbae2b2" category="paragraph">与此过程中的其他步骤相比、将先前的RMAN备份还原到新位置所需的时间更长。必须在不更改数据库ID (DBID)或不重置日志的情况下复制数据库。这样可以防止应用日志、而这是完全同步副本所必需的步骤。</block>
  <block id="06206ea0cdea741420d9f7619503db89" category="paragraph">使用在上一步中创建的脚本、使用RMAN作为aux连接到数据库、并使用问题描述the DUKATE DATABASE命令。</block>
  <block id="5ae45dfed3c4aff7fe4fd6a7e3606cb0" category="paragraph">现在、您必须将更改从源数据库发送到新位置。这样做可能需要多个步骤。最简单的方法是让源数据库上的RMAN将归档日志写出到共享网络连接。如果共享位置不可用、另一种方法是使用RMAN写入本地文件系统、然后使用rcp或rsync复制文件。</block>
  <block id="e355807335e5f05930a748afe1c3b23d" category="paragraph">在此示例中、将显示<block ref="45987b06d5eae35fc3e3487749a9ba27" prefix=" " category="inline-code"></block> 目录是一个NFS共享、可供原始数据库和迁移的数据库使用。</block>
  <block id="49fffa356bcd041918ce24ef714f3f72" category="paragraph">其中一个重要的问题描述是<block ref="6761e3b36547cd115b3966fcbc7192b2" prefix=" " category="inline-code"></block> 条款。备份的磁盘格式为<block ref="9ae0f22d9fa2eac270499e74092af364" prefix=" " category="inline-code"></block>，表示必须使用数据库的线程编号、序列号和激活ID格式。尽管字母不同、但这与匹配<block ref="03e92f2c3a8cae5315f0e42bf6acf436" prefix=" " category="inline-code"></block> 参数。此参数还以线程编号、序列号和激活ID的格式指定归档日志。最终结果是、源上的日志文件备份会采用数据库预期的命名约定。这样做会执行等操作<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 更简单、因为sqlplus可以正确地预测要回显的归档日志的名称。</block>
  <block id="76d77393c7ffc6b0a0edd47ad09afe4d" category="paragraph">文件位于归档日志位置后、可以发出命令来重新显示它们<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block> 然后是响应<block ref="e1f2d5134ed2543d38a0de9751cf75d9" prefix=" " category="inline-code"></block> 自动重放所有可用日志。参数文件当前正在将归档日志定向到<block ref="e421a42fc6f604fcc78707336ed222b9" prefix=" " category="inline-code"></block>，但这与使用RMAN保存日志的位置不匹配。在恢复数据库之前、可以按如下所示临时重定向此位置。</block>
  <block id="0a96a4559ad3ab8c616a12a207e8daca" category="paragraph">最终归档日志回复报告错误、但这是正常的。此错误指示sqlplus正在查找特定日志文件、但未找到该文件。原因很可能是日志文件尚不存在。</block>
  <block id="e2a234d3299b9e66f0756db00c9ee8c7" category="paragraph">在大多数情况下、不会立即执行迁移。迁移过程可能需要几天甚至几周时间才能完成、这意味着必须将日志持续运送到副本数据库并进行重新显示。这样可以确保在转换到达时传输和回调的数据最少。</block>
  <block id="247e1695519da78866726a4dcb2c5252" category="paragraph">可以轻松编写此过程的脚本。例如、可以在原始数据库上计划以下命令、以确保用于日志传送的位置持续更新。</block>
  <block id="3ce19ecb7c874f75b9a46e29abe2012e" category="inline-link-macro">在备用数据库上重放日志</block>
  <block id="469d3082a0f3ad08223ba8fe69bf9311" category="paragraph">收到日志后、必须对其进行重新显示。前面的示例显示了如何使用sqlplus手动运行<block ref="5fea768eb2d353716ca623ae58ce382c" prefix=" " category="inline-code"></block>，可以轻松实现自动化。此处显示的示例使用中所述的脚本 <block ref="7c7730292e0135c86626e1771f7f02ec" category="inline-link-macro-rx"></block>。该脚本接受一个参数、用于指定需要重放操作的数据库。此过程允许在多数据库迁移工作中使用相同的脚本。</block>
  <block id="15d3442f7626bb62f4b255c7ed5c5098" category="paragraph">准备好转换到新环境后、必须执行一次最终同步。使用常规文件系统时、可以轻松确保迁移的数据库与原始数据库100%同步、因为原始重做日志会被复制和重做。使用ASM无法实现此目的。只能轻松地重新复制归档日志。为了确保不会丢失任何数据、必须谨慎地最终关闭原始数据库。</block>
  <block id="f9952f2469fbec5fc9dca180322ff9ee" category="list-text">首先、必须将数据库静机、以确保不会进行任何更改。此暂停可能包括禁用计划的操作、关闭侦听器和/或关闭应用程序。</block>
  <block id="58fd1c52efcde7151ac264a8f67b14ff" category="list-text">执行此步骤后、大多数数据库配置协议都会创建一个虚拟表、用作关闭标记。</block>
  <block id="442da9ab2cced82a6cbdd112be285bcf" category="list-text">强制进行日志归档、以确保在归档日志中记录虚拟表的创建。为此、请运行以下命令：</block>
  <block id="83fce8a41250d6af49205f9659468351" category="list-text">要复制最后一个归档日志、请运行以下命令。数据库必须可用、但未打开。</block>
  <block id="1b0e887c1394d4617c2a5243da19e44e" category="list-text">要复制归档日志、请运行以下命令：</block>
  <block id="86a7e05acb17098c514dd570b9220302" category="list-text">最后、在新服务器上重放其余归档日志。</block>
  <block id="a430882deb5403e7b4b8061dec17cc80" category="list-text">在此阶段、复制所有数据。数据库已准备好从备用数据库转换为活动操作数据库、然后再打开。</block>
  <block id="077c7bcbf9a94bb62aecadc85045886e" category="list-text">确认是否存在假表、然后将其放下。</block>
  <block id="6130a27b8ec8ccf18e06bb3389b0fbbd" category="section-title">无中断重做日志迁移</block>
  <block id="26c294f993888218237d5f9306bfcfc4" category="paragraph">有时、除了重做日志之外、数据库整体组织正确。发生这种情况的原因有很多、其中最常见的原因是与快照有关。SnapManager for Oracle、SnapCenter和NetApp Snap Creator存储管理框架等产品可以近乎即时地恢复数据库、但前提是您还原数据文件卷的状态。如果重做日志与数据文件共享空间、则无法安全地执行还原、因为它会导致重做日志被销毁、这可能意味着数据丢失。因此、必须重新定位重做日志。</block>
  <block id="2c56f5081b94b926c93c40f4c935a44a" category="paragraph">此操作步骤非常简单、可以无干扰地执行。</block>
  <block id="2986f9fe7ed4aab5aaa64c2ee9fe4841" category="section-title">当前重做日志配置</block>
  <block id="dd786d22c88a5f1fe0c10cfec58c1b44" category="list-text">确定重做日志组的数量及其相应的组编号。</block>
  <block id="3cd0f7a32a4f5ee026702f8125f3dda7" category="list-text">输入重做日志的大小。</block>
  <block id="7c2f6ada37d59f2be0bc1a3ead80f77c" category="section-title">创建新日志</block>
  <block id="106b215e5d87fb1256e47932f2ebf9cf" category="list-text">对于每个重做日志、创建一个大小和成员数量匹配的新组。</block>
  <block id="0851b65f20b98420968e488fc3c0085e" category="list-text">验证新配置。</block>
  <block id="cbccec9e0905e0b7f5cd630a3fa12f64" category="section-title">丢弃旧日志</block>
  <block id="00f63618719701ddae7fc2ff1d406ec2" category="list-text">丢弃旧日志(组1、2和3)。</block>
  <block id="f00c8361a8acc818247282bb6420a8c1" category="list-text">如果遇到错误、导致您无法删除活动日志、请强制切换到下一个日志以释放锁定并强制执行全局检查点。请参见以下此过程的示例。删除位于旧位置的日志文件组2的尝试被拒绝、因为此日志文件中仍有活动数据。</block>
  <block id="5d49a93437a42d2926c8be7eb3c7a56f" category="list-text">日志归档后加上检查点可用于删除日志文件。</block>
  <block id="e3898c187d7edf64fc8e4d4e409fd244" category="list-text">然后从文件系统中删除日志。执行此过程时应格外小心。</block>
  <block id="eb290dfcb2d35cffcb49a22fd05168b5" category="summary">Oracle迁移规划</block>
  <block id="dacc2a633e9981c9f91e43ac6b59e889" category="paragraph">Oracle数据迁移可在以下三个级别之一进行：数据库、主机或存储阵列。</block>
  <block id="5153193d50d4c628312db2d5bc0132ed" category="paragraph">不同之处在于、整个解决方案的哪个组件负责移动数据：数据库、主机操作系统或存储系统。</block>
  <block id="cc3e73ae592a355b9beb405232d08fe2" category="paragraph">下图显示了一个迁移级别和数据流示例。在数据库级别迁移的情况下、数据会从原始存储系统通过主机层和数据库层移动到新环境中。主机级迁移类似、但数据不会通过应用层、而是使用主机进程写入新位置。最后、对于存储级别迁移、NetApp FAS系统等阵列负责数据移动。</block>
  <block id="204415652114bfb773b51cd76c8c692e" category="paragraph"><block ref="204415652114bfb773b51cd76c8c692e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b059e0e23ffaa8fbd97f681942ce0018" category="paragraph">数据库级迁移通常是指通过备用数据库进行Oracle日志传送、以便在Oracle层完成迁移。主机级迁移可通过主机操作系统配置的本机功能来执行。此配置包括使用cp、tar和Oracle Recovery Manager (RMAN)等命令执行文件复制操作、或者使用逻辑卷管理器(LVM)重新定位文件系统的底层字节。Oracle自动存储管理(Automatic Storage Management、ASM)归类为主机级功能、因为它在数据库应用程序级别以下运行。ASM取代主机上常用的逻辑卷管理器。最后、数据可以在存储阵列级别进行迁移、这意味着可以在操作系统级别以下进行迁移。</block>
  <block id="228d9e0418aa12bae73676a5743558db" category="section-title">规划注意事项</block>
  <block id="ce7eea640cd6ee20e55cbe868f4026e9" category="paragraph">迁移的最佳选择取决于多种因素的组合、包括要迁移的环境的规模、避免停机的需求以及执行迁移所需的整体工作量。大型数据库显然需要更多的时间和精力进行迁移、但这种迁移的复杂性微乎其微。小型数据库可以快速迁移、但是、如果要迁移的数据库有数千个、工作的规模可能会带来复杂性。最后、数据库越大、越有可能成为业务关键型数据库、因此需要在保持备用路径的同时最大限度地减少停机时间。</block>
  <block id="d4b9b19593598d98059aae44d6a7bbe1" category="paragraph">此处将讨论规划迁移策略时的一些注意事项。</block>
  <block id="931c6f2c99380fbd899e3eaa31e97d98" category="section-title">数据大小</block>
  <block id="64e4d570abeebacf6bdcb19dfb73fcae" category="paragraph">要迁移的数据库的大小显然会影响迁移规划、但大小并不一定会影响转换时间。当需要迁移大量数据时、首要考虑因素是带宽。复制操作通常使用高效的顺序I/O来执行保守地估计、假设复制操作可用网络带宽的利用率为50%。例如、一个8 GB FC端口在理论上可以传输大约800 MBps。假设利用率为50%、则可以以大约400 Mbps的速率复制数据库。因此、以这种速率在大约7小时内即可复制一个10 TB的数据库。</block>
  <block id="84a80a048e7abc027dd6bdce55fda9d2" category="inline-link-macro">联机数据文件移动</block>
  <block id="1c169b76761527b28040655a783e50a2" category="section-title">数据库计数</block>
  <block id="da3770c5d6d1215e9f2524b9d7b7c3c5" category="paragraph">在许多情况下、移动大量数据的问题不在于数据大小、而在于支持数据库的配置的复杂性。仅仅知道必须迁移50 TB的数据库是不够的。它可以是一个50 TB的任务关键型数据库、4、000个原有数据库的集合、也可以是生产数据和非生产数据的混合。在某些情况下、大部分数据都由源数据库的克隆组成。这些克隆根本不需要迁移、因为它们可以轻松地重新创建、尤其是在新架构设计为利用NetApp FlexClone卷时。</block>
  <block id="a1739e745a7544d2432b2b990a715817" category="paragraph">对于迁移规划、您必须了解范围内有多少数据库以及必须如何确定这些数据库的优先级。随着数据库数量的增加、堆栈中的首选迁移选项往往会越来越少。例如、使用RMAN可以轻松复制单个数据库、但会短暂中断。这是主机级复制。</block>
  <block id="284723d6a05b50ace5e5b96c761d03ac" category="paragraph">如果有50个数据库、则可能更容易避免设置新的文件系统结构来接收RMAN副本并将数据移动到位。可以通过利用基于主机的LVM迁移将数据从旧LUN重新定位到新LUN来完成此过程。这样、数据库管理员(Database Administrator、DBA)团队就会将职责移交给操作系统团队、因此、数据会相对于数据库透明地进行迁移。文件系统配置保持不变。</block>
  <block id="8e734da04d394519001f47f723341e9d" category="paragraph">最后、如果必须迁移200个服务器中的500个数据库、则可以使用ONTAP外部LUN导入(FLI)功能等基于存储的选项来直接迁移LUN。</block>
  <block id="39f43935349622951e0f392c83b6e736" category="section-title">重新架构要求</block>
  <block id="50f1558a3f9d47464b5d57f9d9d0f9d1" category="paragraph">通常、必须更改数据库文件布局才能利用新存储阵列的功能；但是、情况并非总是如此。例如、EF系列全闪存阵列的功能主要针对SAN性能和SAN可靠性。在大多数情况下、数据库可以迁移到EF系列阵列、而无需考虑数据布局的特殊注意事项。唯一的要求是高IOPS、低延迟和强大的可靠性。尽管存在与RAID配置或动态磁盘池等因素相关的最佳实践、但EF系列项目很少需要对整体存储架构进行任何重大更改才能利用这些功能。</block>
  <block id="0e2c78f7e9948e19ccb1bf2e1b7f0faf" category="paragraph">相比之下、迁移到ONTAP通常需要更多地考虑数据库布局、以确保最终配置实现最大价值。ONTAP本身就可以为数据库环境提供许多功能、即使不需要任何特定的架构工作也是如此。最重要的是、它能够在当前硬件达到使用寿命时无故障迁移到新硬件。一般来说、迁移到ONTAP是您最后一次需要执行的迁移。后续硬件会原位升级、数据会无中断迁移到新介质。</block>
  <block id="ad93bd21d59f2286385dc519fd7e39fb" category="paragraph">通过一些规划、可以获得更多优势。有关快照的使用、最重要的注意事项是。快照是执行近乎即时的备份、还原和克隆操作的基础。作为快照功能的一个示例、已知的最大用途是在6个控制器上的大约250个LUN上运行一个996 TB的数据库。此数据库可以在2分钟内完成备份、在2分钟内完成还原、在15分钟内完成克隆。其他优势包括：能够根据工作负载的变化在集群中移动数据、以及应用服务质量(QoS)控制、以便在多数据库环境中提供稳定一致的良好性能。</block>
  <block id="6b48ce64da84423ce167ffb72f5f9a8b" category="inline-link-macro">Oracle迁移过程概述</block>
  <block id="1311d3b592e4da5950e91965dac1d593" category="paragraph">QoS控制、数据重新定位、快照和克隆等技术几乎适用于任何配置。但是、通常需要考虑一些问题才能获得最大的益处。在某些情况下、数据库存储布局可能需要进行设计更改、才能最大程度地提高对新存储阵列的投资。此类设计更改可能会影响迁移策略、因为基于主机或基于存储的迁移会复制原始数据布局。要完成迁移并提供针对ONTAP优化的数据布局、可能还需要执行其他步骤。中所示的过程 <block ref="d4d5600aaaced44e203002ec1910822d" category="inline-link-macro-rx"></block> 之后、我们将演示一些方法、这些方法不仅可以迁移数据库、还可以轻松地将数据库迁移到最佳最终布局中。</block>
  <block id="1fd9b0a8321228b5b8ad4be85e71cf64" category="section-title">转换时间</block>
  <block id="95b9194d9f06f6f70febc87c071f3050" category="paragraph">应确定转换期间允许的最大服务中断时间。假设整个迁移过程会造成中断、这是一个常见错误。许多任务都可以在任何服务中断开始之前完成、而且许多选项都支持在不中断或中断的情况下完成迁移。即使不可避免地发生中断、您仍必须定义允许的最大服务中断、因为转换时间的持续时间因操作步骤而异操作步骤。</block>
  <block id="9cfeaf56d2fc41c2695a69adf260c3f8" category="section-title">回退路径</block>
  <block id="f493e16f7e2caba820eba88a1c5f82d8" category="paragraph">任何迁移都不是完全无风险的。即使技术运行正常、也始终存在用户错误的可能性。必须考虑与所选迁移路径相关的风险以及迁移失败的后果。例如、Oracle ASM的透明联机存储迁移功能是其主要功能之一、而这种方法是已知最可靠的方法之一。但是、使用此方法可以不可逆地复制数据。如果ASM出现问题的可能性极小、则不存在轻松的回退路径。唯一的选择是还原原始环境或使用ASM将迁移反转回原始LUN。如果原始存储系统能够执行快照类型的备份、则可以通过在该系统上执行此类操作来最大程度地降低风险、但无法消除此类风险。</block>
  <block id="1886f1ab01daa4511ce537d1af675427" category="section-title">排练</block>
  <block id="dd5dac65febd7071311b1ae3be1eca90" category="paragraph">某些迁移过程在执行前必须进行全面验证。迁移和演练转换过程是任务关键型数据库的常见要求、对于这些数据库、迁移必须成功、停机时间必须降至最低。此外、用户验收测试通常会作为迁移后工作的一部分、整个系统只有在这些测试完成后才能恢复生产。</block>
  <block id="7d06b32cdd06d27f7c62fb110d831e60" category="paragraph">如果需要预演、几项ONTAP功能可以使流程更加简单。特别是、快照可以重置测试环境、并快速为数据库环境创建多个节省空间的副本。</block>
  <block id="440a667261bd94f099ef4dde5caf024f" category="summary">迁移单个Oracle数据文件</block>
  <block id="727bb4db430517995ca651c4f57b0c9f" category="doc">数据文件移动</block>
  <block id="fade70b277397e039e100bf0faa98d8e" category="paragraph">单个Oracle数据文件只需使用一个命令即可移动。</block>
  <block id="50c3d56e93d52f122bab9de1f2b35780" category="paragraph">例如、以下命令将数据文件IOPST.dbf从文件系统中移动<block ref="87941c54be03c9785752ea54ac9a2dd4" prefix=" " category="inline-code"></block> 文件系统<block ref="eff8b2f7c4da1cf002bdea257a43fd10" prefix=" " category="inline-code"></block>。</block>
  <block id="53784088a62519d581c3dac4640c41b5" category="paragraph">使用此方法移动数据文件可能会很慢、但通常不会产生足够的I/O、以致会干扰日常数据库工作负载。相比之下、通过ASM重新平衡进行迁移的速度会快得多、但代价是在移动数据时降低整个数据库的运行速度。</block>
  <block id="f92065612dfd409585ca08d95cc7a4dc" category="paragraph">可以通过创建测试数据文件并将其移动来轻松衡量移动数据文件所需的时间。操作所用时间记录在v$session数据中：</block>
  <block id="78fb69ccdf01155db62828d0bc182b84" category="paragraph">在此示例中、移动的文件为数据文件8、该文件大小为21 GB、需要大约6分钟才能完成迁移。所需时间显然取决于存储系统的功能、存储网络以及迁移时发生的整体数据库活动。</block>
  <block id="593b763e01de37a327966ee1abb3f8a2" category="summary">使用主机端存储堆栈迁移Oracle</block>
  <block id="174f3246d5f9cdf330404cb6158e67e2" category="doc">Oracle主机数据复制</block>
  <block id="3dc2d5f8d7209bb75e8d67aed68bc5ed" category="paragraph">与数据库级迁移一样、在主机层进行迁移也是一种独立于存储供应商的方法。</block>
  <block id="1686ceaaa0d8fb4f9a8adb5e717b029c" category="paragraph">换言之、有时"只复制文件"是最佳选择。</block>
  <block id="d5732a4ab4c633ceb871cebdbf9ae34f" category="paragraph">虽然这种低技术方法可能看起来过于简单、但它确实具有显著优势、因为无需使用特殊软件、而且在该过程中、原始数据始终保持安全不变。主要限制是、文件复制数据迁移过程会造成系统中断、因为在复制操作开始之前、必须关闭数据库。没有好的方法可以同步文件中的更改、因此、在开始复制之前、必须完全将文件置于静状态。</block>
  <block id="706e7514bb30a289d7ce786a1a5c2ca0" category="paragraph">如果不希望执行复制操作所需的关闭操作、则基于主机的下一个最佳选项是利用逻辑卷管理器(LVM)。存在许多LVM选项、包括Oracle ASM、所有这些选项都具有相似的功能、但也有一些必须考虑的限制。在大多数情况下、可以在不发生停机和中断的情况下完成迁移。</block>
  <block id="f58e97ac8406ca3e8f0bb7a019a81985" category="section-title">文件系统到文件系统复制</block>
  <block id="a08ab728e75c63a41ce7571cb781cda2" category="paragraph">不应低估简单复制操作的有用性。此操作需要在复制过程中停机、但这是一个高度可靠的过程、无需具备有关操作系统、数据库或存储系统的专业知识。此外、它非常安全、因为它不会影响原始数据。通常、系统管理员会将要挂载的源文件系统更改为只读、然后重新启动服务器以确保任何内容都不会损坏当前数据。可以为复制过程编写脚本、以确保其尽可能快地运行、而不会出现用户错误的风险。由于I/O类型是简单的顺序数据传输、因此具有高带宽效率。</block>
  <block id="ba0bd93801872993ce832352dd03b56a" category="paragraph">以下示例演示了安全快速迁移的一个选项。</block>
  <block id="d8cb8bcd239bbe7a2a488c1d68dbe420" category="paragraph">要迁移的环境如下：</block>
  <block id="3ffbdefc66ad1d1e707c1d6820afbdc0" category="list-text">当前文件系统</block>
  <block id="bdc9e98c6b17bb14a7bce916054413ba" category="list-text">新文件系统</block>
  <block id="3b878279a04dc47d60932cb294d96259" category="section-title">概述</block>
  <block id="e76912cd513cc8cbcabc2735b524e814" category="paragraph">数据库可以由数据库管理机构进行迁移、只需关闭数据库并复制文件即可、但如果必须迁移多个数据库、或者最短的停机时间至关重要、则可以轻松编写该过程的脚本。使用脚本还可以降低用户出错的几率。</block>
  <block id="d21aae9692f3b1d4e53fd73131414b93" category="paragraph">显示的示例脚本可自动执行以下操作：</block>
  <block id="66909ae9d06bad444f5a059b8ee2cd41" category="list-text">正在关闭数据库</block>
  <block id="ae737f3f8c04ccbefa99b2bbf87dccc2" category="list-text">将现有文件系统转换为只读状态</block>
  <block id="1dd90b7b28cbd03687df6538c66ff494" category="list-text">将源文件系统中的所有数据复制到目标文件系统、从而保留所有文件权限</block>
  <block id="741341be7809d7f5765b2352e6ab0aab" category="list-text">卸载新旧文件系统</block>
  <block id="7465bc030ca3fe236bcf3ecdf8aaebe4" category="list-text">使用与先前文件系统相同的路径重新挂载新文件系统</block>
  <block id="8c4271e6faf2cea4cfc8e5b7108d8ee9" category="section-title">操作步骤</block>
  <block id="b273f8d4284bd1f58cfbafe8065af9fa" category="list-text">关闭数据库。</block>
  <block id="67eadd4b70772835f318e6d3027e4308" category="inline-link-macro">将文件系统转换为只读</block>
  <block id="474aae6515223cc3ba71074c9d5abcae" category="list-text">将文件系统转换为只读。可以使用脚本更快地完成此操作、如所示 <block ref="2d6e37849c641071fe1cf71ac348d28c" category="inline-link-macro-rx"></block>。</block>
  <block id="4879ec77723fce4974f8ae2a7f87121a" category="list-text">确认文件系统现在为只读。</block>
  <block id="c91e7f5dba3c873d0978f4892bf8b3f2" category="list-text">将文件系统内容与同步<block ref="89a4551b0f29c1a652648b1cb8747021" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="91e702884985853b8a7091ed5f2beceb" category="inline-link-macro">替换文件系统</block>
  <block id="ea27cab9fe7b891870e0ce59aa34e853" category="list-text">卸载旧文件系统并重新定位复制的数据。可以使用脚本更快地完成此操作、如所示 <block ref="fa3b775593af4f3de8972aced258710d" category="inline-link-macro-rx"></block>。</block>
  <block id="5fe2431acb45422c46eadf66a93851af" category="list-text">确认新文件系统已就位。</block>
  <block id="2d53403ab873059f92ad884eb271e8dc" category="list-text">启动数据库。</block>
  <block id="40351c33ab81b8b374a20fd292057481" category="section-title">完全自动化转换</block>
  <block id="3f70361470a11fb351c83257cd7aa63e" category="paragraph">此示例脚本接受数据库SID的参数、后跟共同分隔的文件系统对。对于上面显示的示例、命令的发出方式如下：</block>
  <block id="5cddd7b314b7ae819e2cfcac85021426" category="paragraph">执行此示例脚本时、此示例脚本将尝试执行以下序列。如果在任何步骤中遇到错误、则会终止：</block>
  <block id="43d4fce7952ee09c0c8df60a17f5ea56" category="list-text">将当前文件系统转换为只读状态。</block>
  <block id="9d53d62d1e6dc69460f47c83e6c1919d" category="list-text">使用以逗号分隔的每对文件系统参数、并将第一个文件系统同步到第二个文件系统。</block>
  <block id="39ff0e6dfa9915344ec96f9e78a27267" category="list-text">卸载先前的文件系统。</block>
  <block id="e220fa2a2806386a64e9860f27372e43" category="list-text">更新<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 文件、如下所示：</block>
  <block id="232c2c4ddd45fc028ae13b58251c5f7e" category="list-text">在创建备份<block ref="9eb56e72a6bb8350a1453c2762d14178" prefix=" " category="inline-code"></block>。</block>
  <block id="d5082ae73767550813688202df21bc4d" category="list-text">注释掉先前和新文件系统的先前条目。</block>
  <block id="b8793b424d1738f1e00e545379867b0d" category="list-text">为使用旧装载点的新文件系统创建一个新条目。</block>
  <block id="29478980f354caa483bc0cfb827c7251" category="list-text">挂载文件系统。</block>
  <block id="a0ec0d8bede7d9d58172084de7d5ce53" category="paragraph">以下文本提供了此脚本的执行示例：</block>
  <block id="350265a378d2cb1183cd51d56f0e5843" category="section-title">Oracle ASM spfile和passwd迁移</block>
  <block id="f37bc722651f2fd86ba4da87f947c4db" category="paragraph">完成涉及ASM的迁移的一个困难是ASM专用的spfile和密码文件。默认情况下、这些关键元数据文件是在定义的第一个ASM磁盘组上创建的。如果必须清空并删除特定ASM磁盘组、则必须重新定位用于管理该ASM实例的spfile和密码文件。</block>
  <block id="88e2a97e52f9854b59ce63e74c4b0cac" category="paragraph">可能需要重新定位这些文件的另一个用例是在部署数据库管理软件(如SnapManager for Oracle或SnapCenter Oracle插件)期间。这些产品的功能之一是、通过还原托管数据文件的ASM LUN的状态来快速还原数据库。执行此操作需要先使ASM磁盘组脱机、然后再执行还原。只要给定数据库的数据文件隔离在专用ASM磁盘组中、就不会出现此问题。</block>
  <block id="24de04443b6bdae76336fcab04ae946c" category="paragraph">如果该磁盘组还包含ASM spfile/passwd文件、则使该磁盘组脱机的唯一方法是关闭整个ASM实例。此过程会造成系统中断、这意味着需要重新定位spfile/passwd文件。</block>
  <block id="a6221bf4332cc966c69066295a843480" category="list-text">数据库SID = TOAST</block>
  <block id="0af0da2831407b8130e7f2fabdfab87d" category="list-text">上的当前数据文件<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block></block>
  <block id="24aa2824a0b52b46b301afdb3af9336f" category="list-text">上的当前日志文件和控制文件<block ref="ad6062251d172504e3b3bed3a8256a5a" prefix=" " category="inline-code"></block></block>
  <block id="bb6de9ea84381f7d01fdd038f104e4ae" category="list-text">新的ASM磁盘组建立为<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block> 和<block ref="5e20ccf28224fc0cc564f9825c208dbd" prefix=" " category="inline-code"></block></block>
  <block id="8b14bd9d310bf8b211c19645576201e3" category="section-title">ASM spfile/passwd文件位置</block>
  <block id="7c7d8dd5d09a73f06678562b66dcdc68" category="paragraph">可以无系统地重新定位这些文件。但是、为了安全起见、NetApp建议关闭数据库环境、以便确保文件已重新定位、并且配置已正确更新。如果服务器上存在多个ASM实例、则必须重复执行此操作步骤。</block>
  <block id="3666b74ddcf77306328ac5d6db94fecd" category="section-title">确定ASM实例</block>
  <block id="9d19a85576af8e1b3dbd78e343a2b022" category="paragraph">根据中记录的数据确定ASM实例<block ref="9da4474b569071bcb2ece1d0bdfe7560" prefix=" " category="inline-code"></block> 文件ASM实例用+符号表示。</block>
  <block id="3fe2dd8cf6f82ac15544fd96f9b59b28" category="paragraph">此服务器上有一个名为+ASM的ASM实例。</block>
  <block id="35a557b0490d5a93931025eaaf712cac" category="section-title">确保所有数据库均已关闭</block>
  <block id="e6b0819ae1eca7d408a097efc2fbf2cf" category="paragraph">唯一可见的SMON进程应该是正在使用的ASM实例的SMON。如果存在另一个SMON进程、则表示数据库仍在运行。</block>
  <block id="97639c779a60f010af01997e2363f4eb" category="paragraph">唯一的SMON进程是ASM实例本身。这意味着没有其他数据库在运行、并且可以安全地继续运行、而不会造成数据库操作中断的风险。</block>
  <block id="a8d157790e55d19378ddbbdfeb675ef8" category="section-title">找到文件</block>
  <block id="12d8c982eb4072e31ac4bfe375193160" category="paragraph">使用确定ASM spfile和密码文件的当前位置<block ref="e258dbf5114b4df07f0d9e72deb386f2" prefix=" " category="inline-code"></block> 和<block ref="bb41cdf6c9bb75ee17856f938070f23d" prefix=" " category="inline-code"></block> 命令</block>
  <block id="bebe64e9d0d4ae3d44b4dfb3583e0109" category="paragraph">这两个文件都位于的底部<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 磁盘组。</block>
  <block id="558f28628ba8ab4cb8420949524832d3" category="section-title">复制文件</block>
  <block id="c0c2c850cb11c5bb52abbd55a9578e54" category="paragraph">使用将文件复制到新的ASM磁盘组<block ref="c0baea639672c84505e661b9e369c68a" prefix=" " category="inline-code"></block> 和<block ref="c7adee97d05083a7b65e4b6953045177" prefix=" " category="inline-code"></block> 命令如果新磁盘组是最近创建的、并且当前为空、则可能需要先挂载它。</block>
  <block id="3ed2faf3e1299edd7d92d6c4064f1579" category="paragraph">文件现在已从复制<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> to<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block>。</block>
  <block id="1dba5fc559232a8dae45d9f88ed36030" category="section-title">更新ASM实例</block>
  <block id="1fe2cc6cf436a4bcc6bdc41f947a416a" category="paragraph">现在、必须更新ASM实例以反映位置更改。。<block ref="c8b1affa9ec15d0c0e79347905e75d3e" prefix=" " category="inline-code"></block> 和<block ref="73fb08020d8535b4123a8968c596038c" prefix=" " category="inline-code"></block> 命令用于更新启动ASM磁盘组所需的ASM元数据。</block>
  <block id="626759f91a0458b0c068cce8a05a6468" category="section-title">使用更新的文件激活ASM</block>
  <block id="69f08287c6faa04381e5a05f4087abe1" category="paragraph">此时、ASM实例仍会使用这些文件的先前位置。必须重新启动实例、才能强制从文件的新位置重新查看这些文件、并释放对先前文件的锁定。</block>
  <block id="5505cf0c514193b89221f1cef3004c58" category="section-title">删除旧的spfile和密码文件</block>
  <block id="8f2d3ac58be7a91f51d7ce9ffa04e397" category="paragraph">如果已成功执行操作步骤、则先前的文件将不再锁定、现在可以删除。</block>
  <block id="cfca2b2eb0d694e70904ec82f5d1c34e" category="section-title">Oracle ASM到ASM副本</block>
  <block id="12632d520b8d9518b5622ac00dc764a8" category="paragraph">Oracle ASM本质上是一个轻型组合卷管理器和文件系统。由于文件系统不易显示、因此必须使用RMAN执行复制操作。虽然基于副本的迁移过程既安全又简单、但会造成一些中断。可以最大限度地减少中断、但不能完全消除中断。</block>
  <block id="152106ebb2aaa94cc87657d353331189" category="paragraph">如果您希望无中断迁移基于ASM的数据库、最佳选择是利用ASM的功能、在删除旧LUN的同时、将ASM块区重新平衡到新LUN。这样做通常是安全的、不会造成操作中断、但不会提供回退路径。如果遇到功能或性能问题、唯一的选择是将数据迁移回源。</block>
  <block id="81fe23a1ac3b2bb348e579b2c5b0f5d5" category="paragraph">可以通过将数据库复制到新位置而不是移动数据来避免此风险、从而使原始数据保持不变。数据库可以在上线之前在其新位置进行全面测试、如果发现问题、原始数据库可作为回退选项使用。</block>
  <block id="3028182db088e823770b3d02aa0eac9e" category="paragraph">此操作步骤是涉及RMAN的许多选项之一。它支持一个分两步进行的过程、即创建初始备份、然后通过日志重放进行同步。为了最大限度地减少停机时间、需要使用此过程、因为它可以使数据库在初始基线复制期间保持正常运行并提供数据。</block>
  <block id="634f50a6c6f112c46150a301d749dbcb" category="section-title">复制数据库</block>
  <block id="5f0bd85dd65afab1472713e8e034fff7" category="paragraph">Oracle RMAN会为当前位于ASM磁盘组上的源数据库创建一个级别0 (完整)副本<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 到上的新位置<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block>。</block>
  <block id="b51dc519efad4b151a05682b68f4b182" category="section-title">强制执行归档日志切换</block>
  <block id="10793485747151dfa2eaddb0854c84b2" category="paragraph">您必须强制执行归档日志切换、以确保归档日志包含使副本完全一致所需的所有数据。如果不使用此命令、重做日志中可能仍会显示关键数据。</block>
  <block id="c55a88a6b8fdc5972d4e2a4924f93dbf" category="section-title">关闭源数据库</block>
  <block id="9ec82bff06c706f42a8170befdd6cf39" category="paragraph">此步骤会导致中断、因为数据库已关闭并置于访问受限的只读模式。要关闭源数据库、请运行以下命令：</block>
  <block id="6ecf02e1343e82cf0cd95d7303346ff1" category="section-title">控制文件备份</block>
  <block id="e7bc82f6d1381df55ace121dc02368e6" category="paragraph">如果必须中止迁移并还原到原始存储位置、则必须备份控制文件。备份控制文件的副本并非100%必需、但它确实可以使将数据库文件位置重置回原始位置的过程更加轻松。</block>
  <block id="4e7a51f2c1ee60c69cd719d415f5e87a" category="paragraph">当前spfile包含对控制文件在旧ASM磁盘组中当前位置的引用。必须对其进行编辑、编辑中间的pfile版本即可轻松完成编辑。</block>
  <block id="253e30479f86461bc79f2fca58ee4cb1" category="section-title">更新pfile</block>
  <block id="35db8a54b9c7581f0f77b059233cc61b" category="paragraph">更新引用旧ASM磁盘组的所有参数、以反映新ASM磁盘组名称。然后保存更新后的pfile。确保<block ref="5fa1d01559c04dcdb3ba05775712b1ab" prefix=" " category="inline-code"></block> 参数存在。</block>
  <block id="bb607fbd46f48c3a4080ecda83288b69" category="paragraph">在以下示例中、引用了<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 已更改为<block ref="cb2eb5386826561ac7895f1c878e4252" prefix=" " category="inline-code"></block> 以黄色突出显示。两个关键参数是<block ref="5fa1d01559c04dcdb3ba05775712b1ab" prefix=" " category="inline-code"></block> 用于在正确位置创建任何新文件的参数。</block>
  <block id="5275e85db4d606621d8f074e44b95748" category="section-title">更新init.ora文件</block>
  <block id="17a2b5d1af48f7f8d1511d5372896f7a" category="paragraph">大多数基于ASM的数据库都使用<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 文件位于中<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目录、即指向ASM磁盘组上的spfile。此文件必须重定向到新ASM磁盘组上的某个位置。</block>
  <block id="6ad274256421918b584abff3b9446b09" category="paragraph">按如下所示更改此文件：</block>
  <block id="b6638505615764c377e2cf2585993fd0" category="section-title">重新创建参数文件</block>
  <block id="52b21c2e6103a3b8d888a4185e21a787" category="paragraph">现在、可以使用已编辑的pfile中的数据填充spfile。</block>
  <block id="37f4738eddd35e77d15af55a40e1ab1c" category="section-title">启动数据库以开始使用新的spfile</block>
  <block id="79f8a930424fe3b21dc30a72791171d4" category="paragraph">启动数据库、确保它现在使用新创建的spfile、并正确记录对系统参数所做的任何进一步更改。</block>
  <block id="231ef0ea12d142611eeea2fdfad67114" category="section-title">还原控制文件</block>
  <block id="33cdbbeabc7f2c647f20b3f8b924307f" category="paragraph">RMAN还可以将RMAN创建的备份控制文件直接还原到新spfile中指定的位置。</block>
  <block id="ce656b7f351ebdc7c599aff6a99e0f2a" category="paragraph">挂载数据库并验证新控制文件的使用情况。</block>
  <block id="fda1e79fe400519496075b7e2871092a" category="section-title">日志重放</block>
  <block id="daaec4441f16b5bac11476d4582a296c" category="paragraph">数据库当前使用旧位置的数据文件。在使用副本之前、必须对其进行同步。初始复制过程经过了一段时间、所做的更改主要记录在归档日志中。这些更改复制如下：</block>
  <block id="fca6726270a94f51cab3142509d32919" category="list-text">执行包含归档日志的RMAN增量备份。</block>
  <block id="8b8a5667b011b5f37163ff4da1004343" category="list-text">重放日志。</block>
  <block id="a9a62e70841c4d06dd16306a85700d36" category="section-title">激活</block>
  <block id="8fecb0145484a35b1d9d5926c945ca30" category="paragraph">恢复的控制文件仍引用原始位置的数据文件、并且还包含复制的数据文件的路径信息。</block>
  <block id="f590db5fdc10f6942f7cd173c0bb578b" category="list-text">要更改活动数据文件、请运行<block ref="7705ebb59373d0b1dfc71d86ef726f93" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="2c5c2b5174eafe321358329636e80f5e" category="paragraph">活动数据文件现在是复制的数据文件、但最终重做日志中可能仍包含更改。</block>
  <block id="fe83c5826bec1aa20e26802fa94a4a0f" category="list-text">要重放所有剩余日志、请运行<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 命令：如果消息<block ref="cef3519da39a73834e89a18ca91951f1" prefix=" " category="inline-code"></block> 显示、表示此过程已成功。</block>
  <block id="15434ad90ad32205a804fe96f265b91d" category="paragraph">此过程仅更改了普通数据文件的位置。临时数据文件必须重命名、但不需要复制、因为它们只是临时文件。数据库当前已关闭、因此临时数据文件中没有活动数据。</block>
  <block id="2a7c5560f8e4ad220c853666c46eb051" category="list-text">要重新定位临时数据文件、请首先确定其位置。</block>
  <block id="10b2632cf9c3bf6568b36f6a37e627c2" category="list-text">使用RMAN命令为每个数据文件设置新名称来重新定位临时数据文件。使用Oracle Managed Files (OMF)时、无需完整名称；ASM磁盘组就足够了。打开数据库后、OMF会链接到ASM磁盘组上的相应位置。要重新定位文件、请运行以下命令：</block>
  <block id="2c592b1e2841899b280deafe27eeefbf" category="section-title">重做日志迁移</block>
  <block id="3f53598059c3bf11ff505ad9dc0d6776" category="paragraph">迁移过程已接近完成、但重做日志仍位于原始ASM磁盘组上。重做日志无法直接重新定位。相反、系统会创建一组新的重做日志并将其添加到配置中、然后是一组旧日志。</block>
  <block id="d54f1c98a924385411a8488657b21dad" category="list-text">对于每个重做日志、使用匹配的配置创建一个新组。如果不使用OMF、则必须指定完整路径。此示例也使用<block ref="c9655c773db3ebd5871fbe76c0e38a52" prefix=" " category="inline-code"></block> parameters如前所示、此参数设置为+NEWLOGS。通过此配置、您可以使用以下命令创建新的联机日志、而无需指定文件位置、甚至无需指定特定ASM磁盘组。</block>
  <block id="3e0c7c8ee841e9919343fe45e3e04f2d" category="list-text">打开数据库。</block>
  <block id="7e4b38db083a404d0d628bdb1ad83311" category="list-text">丢弃旧日志。</block>
  <block id="37e48dd687a01e58ed329feebebf3198" category="list-text">如果遇到错误、导致您无法删除活动日志、请强制切换到下一个日志以释放锁定并强制执行全局检查点。下面显示了一个示例。删除位于旧位置的日志文件组3的尝试被拒绝、因为此日志文件中仍有活动数据。通过检查点后的日志归档、您可以删除日志文件。</block>
  <block id="79d08abfbe5fd73dc85c55cd20ad4974" category="list-text">查看环境以确保所有基于位置的参数均已更新。</block>
  <block id="799f5ce04f1d9cad4455676b2fd908d9" category="list-text">以下脚本演示了如何简化此过程：</block>
  <block id="9867dfc0eee2725f24f86d8114c356a0" category="list-text">如果ASM磁盘组已完全清空、则现在可以使用卸载这些磁盘组<block ref="ae709dc3414219bf2c9c8abc9ff6c67a" prefix=" " category="inline-code"></block>。但是、在许多情况下、属于其他数据库的文件或ASM spfile/passwd文件可能仍存在。</block>
  <block id="49f8dc5754bd205ea0da17521cb89a1f" category="section-title">Oracle ASM到文件系统的副本</block>
  <block id="0f5b1767a58e43cb548226e94441dc07" category="paragraph">Oracle ASM到文件系统副本操作步骤与ASM到ASM副本操作步骤非常相似、但具有类似的优势和限制。主要区别在于使用可见文件系统时与使用ASM磁盘组时不同命令和配置参数的语法。</block>
  <block id="b533404c568b600f9fceddeac9253964" category="paragraph">Oracle RMAN用于为当前位于ASM磁盘组上的源数据库创建级别0 (完整)副本<block ref="c097579d8cb34b312d396304e0b8f487" prefix=" " category="inline-code"></block> 到上的新位置<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block>。</block>
  <block id="f78b0ab71e2863c28dbe331056451135" category="paragraph">要确保归档日志包含使副本完全一致所需的所有数据、需要强制执行归档日志开关。如果不使用此命令、重做日志中可能仍会显示关键数据。要强制执行归档日志切换、请运行以下命令：</block>
  <block id="c37c761fc28428b9ead4533aba9ee148" category="paragraph">此步骤会导致中断、因为数据库已关闭并置于访问受限的只读模式。要关闭源数据库、请运行以下命令：</block>
  <block id="3abd8870d8a333edcaec6a1082520c67" category="paragraph">备份控制文件、以防您必须中止迁移并还原到原始存储位置。备份控制文件的副本并非100%必需、但它确实可以使将数据库文件位置重置回原始位置的过程更加轻松。</block>
  <block id="38825215f02e25ca63ff64387b01c1c2" category="paragraph">应更新引用旧ASM磁盘组的任何参数、在某些情况下、如果这些参数不再相关、则应将其删除。更新它们以反映新的文件系统路径并保存更新后的pfile。确保列出了完整的目标路径。要更新这些参数、请运行以下命令：</block>
  <block id="9d0dce3e570fa0ec18269ca508809401" category="section-title">禁用原始init.ora文件</block>
  <block id="03dda6526778417460fd0bbb7716b373" category="paragraph">此文件位于中<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目录中、通常位于一个pfile中、用作指向ASM磁盘组上spfile的指针。要确保原始spfile不再使用、请对其重命名。但是、请勿将其删除、因为如果必须中止迁移、则需要此文件。</block>
  <block id="6087f741090627369fd114fbc794abc4" category="paragraph">这是spfile重新定位的最后一步。不再使用原始spfile、数据库当前已使用中间文件启动(但未挂载)。此文件的内容可以按如下所示写出到新的spfile位置：</block>
  <block id="3f62847435205b7b2af1bd5aaf1d3277" category="paragraph">您必须启动数据库以释放中间文件上的锁定、并仅使用新的spfile文件启动数据库。启动数据库还可以证明新的spfile位置正确且其数据有效。</block>
  <block id="ea164abfd83078cd71a2f3ba5d237900" category="paragraph">在路径上创建了一个备份控制文件<block ref="7a1a1280501cff0194d8ce6e351f2a2c" prefix=" " category="inline-code"></block> 在操作步骤中的早期版本。新的spfile将控制文件位置定义为 <block ref="b4d54c88ccade13a82dcaf8f7c07cac5" prefix="/" category="inline-code"></block> 和<block ref="cd300fb0386526438b368e7a6d1b8ace" prefix=" " category="inline-code"></block>。但是、这些文件尚不存在。</block>
  <block id="f7ed72e578ca8d23dd45bfa2c0a61ed8" category="list-text">此命令会将控制文件数据还原到spfile中定义的路径。</block>
  <block id="c947c89cb4c7a595782d0be73bbe8cfa" category="list-text">问题描述挂载命令、以便正确发现控制文件并包含有效数据。</block>
  <block id="da4ae71a31a1286600968f8a340fddb2" category="paragraph">以验证<block ref="d98137bd230dac4372cf20a2e7839463" prefix=" " category="inline-code"></block> 参数中、运行以下命令：</block>
  <block id="c25a81770c591c46d6909aae84bf5814" category="paragraph">数据库当前正在使用旧位置的数据文件。必须先同步数据文件、然后才能使用副本。初始复制过程经过了一段时间、所做的更改主要记录在归档日志中。这些更改将通过以下两个步骤进行复制。</block>
  <block id="95ea23a5654037c0ab2a5418478d9da2" category="list-text">重放日志。</block>
  <block id="e726fdb8508ef59abc6d8ef533186382" category="list-text">要更改活动数据文件、请运行<block ref="7705ebb59373d0b1dfc71d86ef726f93" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="7fdba4cfea0e0d298cda23e7f46e40c4" category="list-text">尽管数据文件应完全一致、但要重放联机重做日志中记录的其余更改、需要执行最后一步。使用<block ref="81168dbef15af03d02c51a7447378e76" prefix=" " category="inline-code"></block> 命令以重放这些更改并使副本与原始副本完全相同。但是、该副本尚未打开。</block>
  <block id="8eb94d53286760da56ca9c892a49cd8b" category="section-title">重新定位临时数据文件</block>
  <block id="a1e7f15bee0eaa976661307aa884fd99" category="list-text">确定原始磁盘组上仍在使用的临时数据文件的位置。</block>
  <block id="89b79c94ceba42d5bc646c1b4b1acd24" category="list-text">要重新定位数据文件、请运行以下命令。如果存在许多临时文件、请使用文本编辑器创建RMAN命令、然后将其剪切并粘贴。</block>
  <block id="81aa65cb154a5f125bbf3ede064d4b3f" category="paragraph">迁移过程已接近完成、但重做日志仍位于原始ASM磁盘组上。重做日志无法直接重新定位。相反、系统会创建一组新的重做日志并将其添加到配置中、然后删除旧日志。</block>
  <block id="6e46687c6cc5deabe53fa42932683c4d" category="list-text">对于每个重做日志、使用与当前重做日志组相同的大小并使用新文件系统位置创建一个新组。</block>
  <block id="22fd48a866ce4d04edb57c15b2fad5da" category="list-text">删除仍位于先前存储上的旧日志文件组。</block>
  <block id="94158400e59555bf69ecd550887bd9f6" category="list-text">如果遇到阻止删除活动日志的错误、请强制切换到下一个日志以释放锁定并强制执行全局检查点。下面显示了一个示例。删除位于旧位置的日志文件组3的尝试被拒绝、因为此日志文件中仍有活动数据。日志归档后加上检查点可以删除日志文件。</block>
  <block id="326770a786c5933416b6a167c854e7b8" category="list-text">以下脚本演示了如何简化此过程。</block>
  <block id="ffdcdc8ee9653232a906773fa11358fd" category="list-text">如果ASM磁盘组已完全清空、则现在可以使用卸载这些磁盘组<block ref="ae709dc3414219bf2c9c8abc9ff6c67a" prefix=" " category="inline-code"></block>。在许多情况下、仍然存在属于其他数据库的文件或ASM spfile/passwd文件。</block>
  <block id="3d8b8f4734039817e35d5fb6993c8d08" category="section-title">数据文件清理操作步骤</block>
  <block id="637607e2203ac522fc9dbc88deb6c36f" category="inline-link-macro">ASM迁移清理</block>
  <block id="18325b8b206963bc1ae6cca25406f942" category="paragraph">迁移过程可能会导致数据文件的语法较长或比较隐秘、具体取决于Oracle RMAN的使用方式。在此处显示的示例中、备份是使用的文件格式执行的<block ref="1da91ad80bcfeb818066022a42cde773" prefix=" " category="inline-code"></block>。<block ref="432459869b7d0085e120ec9454032267" prefix=" " category="inline-code"></block> 指示RMAN应为每个数据文件创建一个默认唯一名称。结果与以下文本中所示结果类似。数据文件的传统名称嵌入在名称中。可以使用中所示的脚本化方法来清除此问题 <block ref="bf0c2c579af181f7d1e4d0267c1385fe" category="inline-link-macro-rx"></block>。</block>
  <block id="5e8488a95f83d2789417a1f3298f2f31" category="section-title">Oracle ASM重新平衡</block>
  <block id="2768938325db3a71a6713959a0f309d9" category="paragraph">如前文所述、可以通过重新平衡过程将Oracle ASM磁盘组透明地迁移到新存储系统。总之、重新平衡过程需要先向现有LUN组添加大小相等的LUN、然后再删除之前的LUN。Oracle ASM会以最佳布局自动将底层数据重新定位到新存储、然后在完成后释放旧LUN。</block>
  <block id="24a638b29b3c55f26c731aa4b9943a52" category="paragraph">迁移过程使用高效的顺序I/O、通常不会发生原因发生任何性能中断、但可以根据需要对迁移速率进行控制。</block>
  <block id="25d06b03dd002ad791b19500c58e9f72" category="section-title">确定要迁移的数据</block>
  <block id="3709d4034873467e8e6ae138da54a443" category="section-title">创建新LUN</block>
  <block id="32176bd565539329eafb96db9447e517" category="paragraph">创建大小相同的新LUN、并根据需要设置用户和组成员资格。LUN应显示为<block ref="bea4821516973214973a70aea8337c38" prefix=" " category="inline-code"></block> 磁盘。</block>
  <block id="6e59535a7b8dd239c67b8d015618f5e1" category="section-title">添加新LUN</block>
  <block id="71f7e1ff1a6e075f8364d083f145b655" category="paragraph">虽然可以同时执行添加和删除操作、但通过两个步骤添加新LUN通常更容易。首先、将新LUN添加到磁盘组。此步骤会将一半的块区从当前ASM LUN迁移到新LUN。</block>
  <block id="7989dfdf722e8bee00001dac817e4833" category="paragraph">重新平衡功率表示数据的传输速率。数量越多、数据传输的并行性就越高。迁移过程采用高效的顺序I/O操作来执行、这些操作不太可能会出现发生原因性能问题。但是、如果需要、可以使用调整正在进行的迁移的重新平衡能力<block ref="e20ea7dfbbe351f6a5275d7adc71efbd" prefix=" " category="inline-code"></block> 命令：典型迁移使用的值为5。</block>
  <block id="2b69f08c262a142b3fb0868f4d31ab4f" category="section-title">监控操作</block>
  <block id="a5097a0967c777285f74d63bf0cc26a1" category="paragraph">可以通过多种方式监控和管理重新平衡操作。在此示例中、我们使用了以下命令。</block>
  <block id="5d68829c11bdb5ae7a50b847bb126d44" category="paragraph">迁移完成后、不会报告重新平衡操作。</block>
  <block id="957310262614cddc1992368d2d0b14b3" category="section-title">丢弃旧LUN</block>
  <block id="260c16583c8eb689202ed5b4a44708b1" category="paragraph">迁移现已完成一半。可能需要执行一些基本性能测试、以确保环境运行状况良好。确认后、可以通过删除旧LUN来重新定位其余数据。请注意、这不会导致立即释放LUN。删除操作会通知Oracle ASM先重新定位块区、然后再释放LUN。</block>
  <block id="90423249814011b02ba06afd9fb2d617" category="paragraph">可以通过多种方式监控和管理重新平衡操作。在此示例中、我们使用了以下命令：</block>
  <block id="1544b3a52519b3856f1f7d1e704cb56f" category="section-title">删除旧LUN</block>
  <block id="983d704730b30910fc03d3ed444278f0" category="paragraph">在从磁盘组中删除旧LUN之前、应对标头状态执行一次最终检查。从ASM释放LUN后、该LUN不再具有列出的名称、而标头状态将列为<block ref="e2ffc99cf675f5f0f1a3456438551a9a" prefix=" " category="inline-code"></block>。这表示可以从系统中安全删除这些LUN。</block>
  <block id="22a67c375eff91d37f2363ea69b0c41f" category="section-title">LVM迁移</block>
  <block id="d52f83c78118c243801797ba9b795b72" category="paragraph">此处提供的操作步骤显示了对名为的卷组执行基于LVM的迁移的原则<block ref="ec2db4422261eae02091227fb9e53c88" prefix=" " category="inline-code"></block>。这些示例取自Linux LVM、但这些原则同样适用于AIX、HP-UX和VLVM。具体命令可能有所不同。</block>
  <block id="64a375907ede7a86c9e8a1b4b142f22e" category="list-text">确定中当前的LUN<block ref="ec2db4422261eae02091227fb9e53c88" prefix=" " category="inline-code"></block> 卷组。</block>
  <block id="0ae75856dd12545cdd98b8cad5c12ad8" category="list-text">创建物理大小相同或略大的新LUN、并将其定义为物理卷。</block>
  <block id="2426fa707e9d362c711977b79acd65bb" category="list-text">将新卷添加到卷组。</block>
  <block id="02443ebd7f86c3a688a1e3466d3f106a" category="list-text">问题描述<block ref="8167c9a6bd495f7ed235364201039099" prefix=" " category="inline-code"></block> 命令将每个当前LUN的块区重新定位到新LUN。。<block ref="1b464374742cfda0167b82bc6f9462f1" prefix=" " category="inline-code"></block> 参数用于监控操作的进度。</block>
  <block id="ce4a174d56245f6ba5b8808527919921" category="list-text">此过程完成后、使用从卷组中删除旧LUN<block ref="3a4d1e7b0af1cf3d80e419c09d238535" prefix=" " category="inline-code"></block> 命令：如果成功、现在可以从系统中安全地删除此LUN。</block>
  <block id="599a80136f745b38f35077e1c7eb020e" category="summary">Oracle迁移过程</block>
  <block id="329ffa7a9038afa62748f87628b749d5" category="paragraph">Oracle迁移数据库可以执行许多过程。选择合适的解决方案取决于您的业务需求。</block>
  <block id="48a2d08de8943e7ca4718c02e6b791b6" category="paragraph">在许多情况下、系统管理员和数据库管理员都有自己的首选方法来重新定位物理卷数据、镜像和脱机或利用Oracle RMAN复制数据。</block>
  <block id="79d01f6e7efcfef7db530c0b3c5ea516" category="paragraph">这些过程主要是为不熟悉某些可用选项的IT员工提供的指导。此外、这些过程还说明了每种迁移方法的任务、时间要求和技能要求。这样、NetApp和合作伙伴专业服务或IT管理人员等其他方就可以更充分地了解每个操作步骤的要求。</block>
  <block id="5604c71a7d9ae37df511cc85052c1894" category="paragraph">制定迁移策略没有单一的最佳实践。创建计划需要首先了解可用性选项、然后选择最适合业务需求的方法。下图显示了客户的基本注意事项和典型结论、但并非普遍适用于所有情况。</block>
  <block id="fa2e72668f7d48694bef3ba5474e3967" category="paragraph">例如、一个步骤可提高数据库总大小的问题描述。下一步取决于数据库是大于还是小于1 TB。建议的步骤就是根据典型客户实践提出的建议。大多数客户不会使用DataGuard复制小型数据库、但有些客户可能会使用。由于所需时间较长、大多数客户不会尝试复制50 TB的数据库、但有些客户可能有足够大的维护窗口来执行此类操作。</block>
  <block id="82f59f5f005a6ea06f0466a4ffc18b6c" category="paragraph">您可以查看迁移路径最佳注意事项类型的流程图 <block ref="d197151b12289ca0258c12e9b0e8fb1c" category="inline-link-macro-rx"></block>。</block>
  <block id="e38af1623479eee6cfe1782df43819d3" category="paragraph">Oracle 12cR1及更高版本可在数据库保持联机状态时移动数据文件。此外、它还适用于不同的文件系统类型。例如、可以将数据文件从xfs文件系统重新定位到ASM。由于需要执行的单个数据文件移动操作的数量众多、因此通常不会大规模使用此方法、但对于数据文件较少的小型数据库、这是一个值得考虑的选项。</block>
  <block id="5972a038819f045814401b2baea9ee09" category="paragraph">此外、对于迁移现有数据库的部分内容来说、只需移动数据文件是一个很好的选择。例如、活动较少的数据文件可以重新定位到更经济高效的存储、例如FabricPool卷、该卷可以将空闲块存储在对象存储中。</block>
  <block id="fcdd0d9eae6df775f1bdc52f950a0160" category="section-title">数据库级迁移</block>
  <block id="2b619622b2b8505c335acc8be3a2c3fd" category="paragraph">数据库级别的迁移意味着允许数据库重新定位数据。具体而言、这意味着日志传送。RMAN和ASM等技术是Oracle产品、但出于迁移目的、它们在主机级别运行、在主机级别复制文件和管理卷。</block>
  <block id="1048000638cc5357b8b2b36ab55cbc5a" category="section-title">日志传送</block>
  <block id="36f7294e33f88b462199b92362434684" category="paragraph">数据库级迁移的基础是Oracle归档日志、其中包含数据库更改的日志。大多数情况下、归档日志是备份和恢复策略的一部分。恢复过程首先会还原数据库、然后重播放一个或多个归档日志、以使数据库达到所需状态。这种基本技术也可用于执行迁移、操作中断极少甚至不会中断。更重要的是、此技术支持迁移、同时保持原始数据库不变、并保留一条回退路径。</block>
  <block id="d43de5ded302797939b76670bc488b51" category="paragraph">迁移过程从将数据库备份还原到二级服务器开始。您可以通过多种方式执行此操作、但大多数客户都使用其常规备份应用程序来还原数据文件。还原数据文件后、用户将建立日志传送方法。目标是为主数据库生成的归档日志创建一个持续源、并在还原的数据库中重放这些日志、以使它们接近相同的状态。转换时间到后、源数据库将完全关闭、最终归档日志(在某些情况下、重做日志)将被复制并重排。重做日志也要予以考虑、这一点非常重要、因为它们可能包含已提交的某些最终事务。</block>
  <block id="f6fc42763ddbd981d5803ee6676dc7c3" category="paragraph">在传输和回显示这些日志后、两个数据库将保持一致。此时、大多数客户都会执行一些基本测试。如果在迁移过程中发生任何错误、则日志重放应报告错误并失败。仍然建议根据已知查询或应用程序驱动型活动执行一些快速测试、以验证配置是否最佳。在关闭初始数据库之前创建一个最终测试表、以验证迁移的数据库中是否存在该表、这也是一种常见做法。此步骤可确保在最终日志同步期间不会发生任何错误。</block>
  <block id="d8e9d23b4beb4db3da15d77542782747" category="paragraph">可以针对原始数据库配置简单的日志传送迁移、这对于任务关键型数据库尤其有用。源数据库不需要更改配置、迁移环境的还原和初始配置对生产操作没有影响。配置日志传送后、它会对生产服务器提出一些I/O需求。但是、日志传送包含对归档日志的简单顺序读取、这不太可能对生产数据库性能产生任何影响。</block>
  <block id="2c31403002a9f424c6ef56460c6b3715" category="paragraph">事实证明、日志传送对于远距离、高变更率的迁移项目特别有用。在一个实例中、一个220 TB的数据库迁移到了大约500英里以外的新位置。更改率极高、而且安全限制阻止了使用网络连接。日志传送是使用磁带和信使执行的。源数据库的副本最初是使用下面概述的过程进行还原的。然后、派送员每周发送一次日志、直至转换时交付最后一组磁带并将日志应用于副本数据库。</block>
  <block id="b8efa655c4deb7af8a24fc241f8b53ff" category="section-title">Oracle DataGuard</block>
  <block id="d3165c4060fc6d19c0a6364e7c4580ee" category="paragraph">在某些情况下、需要一个完整的DataGuard环境。使用术语DataGuard来指代任何日志传送或备用数据库配置是不正确的。Oracle DataGuard是一种用于管理数据库复制的全面框架、但它不是一种复制技术。在迁移过程中、完整的DataGuard环境的主要优势是可以从一个数据库透明地切换到另一个数据库。此外、如果发现问题(例如新环境的性能或网络连接问题描述)、Dataguard还可以透明地切回原始数据库。完全配置的DataGuard环境不仅需要配置数据库层、还需要配置应用程序、以便应用程序能够检测到主数据库位置的更改。一般来说、不需要使用DataGuard完成迁移、但一些客户在内部拥有丰富的DataGuard专业知识、并已依赖它来执行迁移工作。</block>
  <block id="f17c0a1ce359c1a6665412f89234bf41" category="section-title">重新构建</block>
  <block id="ece8d784e248d63091fc0d248cdeebc3" category="paragraph">如前文所述、利用存储阵列的高级功能有时需要更改数据库布局。此外、存储协议的更改(例如从ASM迁移到NFS文件系统)也必然会更改文件系统布局。</block>
  <block id="71843fb61639ed5fe216bfebc85af16f" category="paragraph">日志传送方法(包括DataGuard)的主要优势之一是、复制目标不必与源匹配。使用日志传送方法从ASM迁移到常规文件系统时没有问题、反之亦然。可以在目标位置更改数据文件的精确布局、以优化可插拔数据库(PDB)技术的使用、或者有选择地对某些文件设置QoS控制。换言之、基于日志传送的迁移过程可让您轻松安全地优化数据库存储布局。</block>
  <block id="f00ec1b23f539163f4c748a85e49e2dd" category="section-title">服务器资源</block>
  <block id="76c5d43a72d856a95b0eed94694ae696" category="paragraph">数据库级迁移的一个限制是需要另一台服务器。可以通过两种方式使用第二台服务器：</block>
  <block id="6cb133f8b5045ef30c17e96ab281749e" category="list-text">您可以使用第二台服务器作为数据库的永久新主目录。</block>
  <block id="f5133929790fe62dbc76a73db4c88544" category="list-text">您可以使用第二个服务器作为临时暂存服务器。完成向新存储阵列的数据迁移并进行测试后、LUN或NFS文件系统将与暂存服务器断开连接、并重新连接到原始服务器。</block>
  <block id="48a00ba9881b62c610201cd833ee9c88" category="paragraph">第一种选择最简单、但在需要非常强大的服务器的超大型环境中使用它可能并不可行。第二个选项需要额外的工作才能将文件系统重新定位回原始位置。这可能是一个简单的操作、其中会使用NFS作为存储协议、因为文件系统可以从暂存服务器上卸载、然后重新挂载到原始服务器上。</block>
  <block id="c223252c2d577984b75caddbd1dff9dc" category="paragraph">基于块的文件系统需要额外的工作才能更新FC分区或iSCSI启动程序。使用大多数逻辑卷管理器(包括ASM)时、系统会自动检测LUN、并在原始服务器上提供这些LUN后将其置于联机状态。但是、某些文件系统和LVM实施可能需要更多的工作才能导出和导入数据。确切的操作步骤可能有所不同、但通常很容易建立一个简单、可重复的操作步骤来完成迁移并将数据重新归位到原始服务器上。</block>
  <block id="2d22ab8be3661ce5dfd8c9910d1cc003" category="paragraph">虽然可以在单个服务器环境中设置日志传送和复制数据库、但新实例必须具有不同的进程SID才能重放日志。可以使用不同的SID临时启动另一组进程ID下的数据库、并在以后进行更改。但是、这样做可能会导致许多复杂的管理活动、并使数据库环境面临用户错误的风险。</block>
  <block id="2660e825d3a58f68aeec49e1c749f477" category="section-title">主机级迁移</block>
  <block id="fae5bb68519bf78c1b3711566283f4ef" category="paragraph">在主机级别迁移数据意味着使用主机操作系统和相关实用程序完成迁移。此过程包括复制数据的任何实用程序、包括Oracle RMAN和Oracle ASM。</block>
  <block id="01070e0746a412afd171ccf162d3a170" category="section-title">数据复制</block>
  <block id="180e717e34d5e4bd2991c47960d00f51" category="paragraph">不应低估简单复制操作的价值。现代网络基础架构可以按每秒千兆字节的速率移动数据、文件复制操作基于高效的顺序读写I/O与日志传送相比、主机复制操作不可避免地会造成更多中断、但迁移不仅仅是数据移动。它通常包括对网络连接、数据库重新启动时间以及迁移后测试的更改。</block>
  <block id="750e04d167938f35054d1c30fd06af58" category="paragraph">复制数据所需的实际时间可能不多。此外、复制操作会保留有保障的回退路径、因为原始数据不会受到影响。如果在迁移过程中遇到任何问题、可以重新激活包含原始数据的原始文件系统。</block>
  <block id="5a3572c65171e06d99a4e055f9d35d32" category="section-title">重新平台化</block>
  <block id="d123cc133e4de7ab3a4b1a5af3bf37a7" category="paragraph">重新平台是指CPU类型的变化。将数据库从传统Solaris、AIX或HP-UX平台迁移到x86 Linux时、由于CPU架构发生更改、必须重新格式化数据。SPARC、IA64和POWER CPU称为大的恩第处理器、而x86和x86_64架构称为小恩第处理器。因此、根据所使用的处理器、Oracle数据文件中的某些数据的顺序会有所不同。</block>
  <block id="6a03806f9c4b1f0048478bab7863fd2c" category="paragraph">过去、客户一直使用DataPump跨平台复制数据。数据缓冲是一种实用程序、用于创建特殊类型的逻辑数据导出、可以在目标数据库中更快地导入。由于DataPump会为数据创建一个逻辑副本、因此会将处理器数据存储单的依赖关系置于身后。某些客户仍在使用数据缓冲区进行回滚、但Oracle 11g提供了一个速度更快的选项：跨平台可传输表空间。这种高级允许将表空间转换为不同的在位的字符格式。这是一种物理转换、其性能优于DataPump导出、DataPump导出必须先将物理字节转换为逻辑数据、然后再转换回物理字节。</block>
  <block id="713bf8ff4ea4c4ece861f3345e15e3ea" category="paragraph">有关DataPump和可传输表空间的完整讨论不在NetApp文档的讨论范围内、但NetApp根据我们在使用新CPU架构向新存储阵列日志迁移期间为客户提供帮助的经验提供了一些建议：</block>
  <block id="86b0ebca28354c7f55b4cc2fe79bee0e" category="list-text">如果正在使用DataPump、则应在测试环境中测量完成迁移所需的时间。客户有时会对完成迁移所需的时间感到惊讶。这种意外的额外停机可能会导致发生原因中断。</block>
  <block id="8a592f25a72fd6f3718b1b01869ade30" category="list-text">许多客户误以为跨平台可传输表空间不需要数据转换。如果使用具有不同ENDE的CPU、则为RMAN<block ref="31168275dcaac634489082b54c4c66d0" prefix=" " category="inline-code"></block> 必须事先对数据文件执行操作。这不是瞬时操作。在某些情况下、可以通过在不同数据文件上运行多个线程来加快转换过程、但无法避免该转换过程。</block>
  <block id="db7b3f86f4c9a2a6a76adac81614c03b" category="section-title">逻辑卷管理器驱动的迁移</block>
  <block id="86586aa50b0df80a7c68bcd3e86c8606" category="paragraph">LVM的工作原理是、创建一组LUN (由一个或多个LUN组成)并将其拆分为通常称为块区的小单元。然后、块区池将用作源、用于创建从本质上进行虚拟化的逻辑卷。此虚拟化层可通过多种方式提供价值：</block>
  <block id="68d083c44669b8b20f0421b0389c6ded" category="list-text">逻辑卷可以使用从多个LUN中绘制的块区。在逻辑卷上创建文件系统时、该文件系统可以使用所有LUN的全部性能功能。此外、它还可以均匀加载卷组中的所有LUN、从而提供更具可预测性的性能。</block>
  <block id="10d1e748082641ce33e82f457cabcbe7" category="list-text">可以通过添加和在某些情况下删除块区来调整逻辑卷的大小。在逻辑卷上调整文件系统大小通常不会造成中断。</block>
  <block id="5efed6e7bf2fda8321882aff35768721" category="list-text">通过移动底层块区、可以无干扰地迁移逻辑卷。</block>
  <block id="96371ba57b3d2f331cc9bd7b5e34708b" category="paragraph">使用LVM进行迁移的工作方式有两种：移动块区或镜像/取消块区镜像。LVM迁移使用高效的大型块顺序I/O、很少会产生任何性能问题。如果这确实成为问题描述、通常可以选择限制I/O速率。这样做不仅会增加完成迁移所需的时间、还会减轻主机和存储系统的I/O负担。</block>
  <block id="28084a93e6570f55c3923991e269816e" category="section-title">镜像和镜像</block>
  <block id="f5b05967100f74bb14ae26d5021ef4e3" category="paragraph">某些卷管理器(如AIX LVM)允许用户指定每个块区的副本数、并控制托管每个副本的设备。迁移的方法是：创建一个现有逻辑卷、将底层块区镜像到新卷、等待副本同步、然后删除旧副本。如果需要回退路径、则可以在删除镜像副本之前创建原始数据的快照。或者、也可以在强制删除包含的镜像副本之前短暂关闭服务器以屏蔽原始LUN。这样做会将数据的可恢复副本保留在其原始位置。</block>
  <block id="7151373ff69a9fafa4a579b40282beeb" category="section-title">块区迁移</block>
  <block id="682ba6adb168511d03877bdbf940a0b7" category="paragraph">几乎所有卷管理器都允许迁移块区、有时还存在多个选项。例如、某些卷管理器允许管理员将特定逻辑卷的各个块区从旧存储重新定位到新存储。Linux LVM2等卷管理器提供<block ref="8167c9a6bd495f7ed235364201039099" prefix=" " category="inline-code"></block> 命令、用于将指定LUN设备上的所有块区重新定位到新LUN。清空旧LUN后、可以将其删除。</block>
  <block id="8c232bd157fb78062260d11e1ec3fc2c" category="admonition">操作面临的主要风险是从配置中删除未使用的旧LUN。更改FC分区和删除陈旧的LUN设备时必须格外小心。</block>
  <block id="41175a8b2053bedbf868e340edf92f55" category="section-title">Oracle自动存储管理</block>
  <block id="dce3f0c1b1c85aaee6448197054602d1" category="paragraph">Oracle ASM是逻辑卷管理器和文件系统的组合。从较高层面来看、Oracle ASM会获取一组LUN、将其划分为多个小的分配单元、并将其呈现为一个称为ASM磁盘组的卷。ASM还可以通过设置冗余级别来镜像磁盘组。卷可以是未镜像(外部冗余)、镜像(正常冗余)或三向镜像(高冗余)。配置冗余级别时必须小心、因为创建后无法更改。</block>
  <block id="d0ac5c14a6207835f733f4366345089d" category="paragraph">ASM还提供文件系统功能。尽管文件系统不会直接从主机中显示、但Oracle数据库可以在ASM磁盘组上创建、移动和删除文件和目录。此外、还可以使用asmcmd实用程序来导航此结构。</block>
  <block id="e72c9da30cbec4daedddc9b6e6fdf03b" category="paragraph">与其他LVM实施方式一样、Oracle ASM通过在所有可用LUN之间对每个文件的I/O进行条带化和负载平衡来优化I/O性能。其次、可以重新定位底层块区、以便调整ASM磁盘组的大小以及进行迁移。Oracle ASM可通过重新平衡操作自动执行此过程。新的LUN将添加到ASM磁盘组、而旧的LUN将被丢弃、这将触发块区重新定位、并随后将清空的LUN从磁盘组中删除。此过程是经验证的迁移方法之一、ASM在提供透明迁移方面的可靠性可能是其最重要的功能。</block>
  <block id="d4ad443888b51ec4e13912c45da68f76" category="admonition">由于Oracle ASM的镜像级别是固定的、因此不能与镜像和镜像迁移方法结合使用。</block>
  <block id="048429277e643e20907317612c1f3318" category="section-title">存储级别迁移</block>
  <block id="623bb7ffbb3730716ea39b5086d26f18" category="paragraph">存储级别迁移是指在应用程序和操作系统级别以下执行迁移。过去、这有时意味着需要使用专用设备在网络级别复制LUN、但这些功能现在已在ONTAP本机提供。</block>
  <block id="794cb725c5631ad99b5b7c000307f0df" category="section-title">SnapMirror</block>
  <block id="963ce762febea70d619f1fd5c114d85c" category="paragraph">几乎可以使用NetApp SnapMirror数据复制软件在NetApp系统之间执行数据库迁移。此过程涉及到为要迁移的卷设置镜像关系、允许这些卷进行同步、然后等待转换窗口。到达后、源数据库将关闭、并执行一次最终镜像更新、同时镜像将断开。然后、可以通过挂载包含的NFS文件系统目录或发现包含的LUN并启动数据库来准备好使用副本卷。</block>
  <block id="1871452e5ea7e53152b5c874a12a890b" category="paragraph">在单个ONTAP集群中重新定位卷不会视为迁移、而是一项例行操作<block ref="0fc2ecb8aa71bddc595fbc39f593496a" prefix=" " category="inline-code"></block> 操作。SnapMirror用作集群中的数据复制引擎。此过程完全自动化。当卷的属性(例如LUN映射或NFS导出权限)随卷本身一起移动时、无需执行其他迁移步骤。重新定位不会中断主机操作。在某些情况下、必须更新网络访问、以确保以尽可能最高效的方式访问新重新定位的数据、但这些任务也不会造成中断。</block>
  <block id="19fee3ea4b7f4472b5c1853122e8f47b" category="section-title">外部LUN导入(FLI)</block>
  <block id="a73cf458eed5aeff5c15aa5d70298cce" category="paragraph">FLI功能允许运行8.3或更高版本的Data ONTAP系统从另一个存储阵列迁移现有LUN。操作步骤非常简单：ONTAP系统像任何其他SAN主机一样分区到现有存储阵列。然后、Data ONTAP会控制所需的原有LUN并迁移底层数据。此外、导入过程会在迁移数据时使用新卷的效率设置、这意味着可以在迁移过程中对数据进行实时压缩和重复数据删除。</block>
  <block id="0ee4b09881406835f151f103412a2f1e" category="paragraph">首次在Data ONTAP 8.3中实施FLI时、仅允许脱机迁移。虽然传输速度非常快、但这仍意味着在迁移完成之前LUN数据不可用。联机迁移是在Data ONTAP 8.3.1中推出的。此类迁移可使ONTAP在传输过程中提供LUN数据、从而最大限度地减少中断。重新分区主机以通过ONTAP使用LUN时、会发生短暂中断。但是、一旦进行了这些更改、数据就可以再次访问、并且在整个迁移过程中始终可以访问。</block>
  <block id="19d95ee75467fc2f9a06d150cc99d944" category="paragraph">读取I/O会通过ONTAP代理、直到复制操作完成、而写入I/O会同时写入外部LUN和ONTAP LUN。这两个LUN副本将以这种方式保持同步、直到管理员执行完全转换以释放外部LUN且不再复制写入。</block>
  <block id="5caad387757ca99ada41709ce30a31a5" category="paragraph">FLI可与FC结合使用、但如果需要更改为iSCSI、则迁移的LUN可以在迁移完成后轻松地重新映射为iSCSI LUN。</block>
  <block id="7fa6cfc683e0f5f9e3a79f6be14e23f4" category="paragraph">FLI的功能包括自动对齐检测和调整。在此上下文中、术语对齐是指LUN设备上的分区。要获得最佳性能、需要将I/O与4K块对齐。如果将分区放置在非4 k倍数的偏移位置、则会影响性能。</block>
  <block id="7b4ef266729f1ddfbc724cad17af4efc" category="paragraph">对齐的第二个方面无法通过调整分区偏移量(文件系统块大小)来更正。例如，ZFS文件系统通常默认为内部块大小512字节。使用AIX的其他客户偶尔会创建块大小为512字节或1、即1、即1、0 4字节的JFS2文件系统。尽管文件系统可能会与4 k边界对齐、但在该文件系统中创建的文件不会对齐、性能会受到影响。</block>
  <block id="1d6b28ed67b1d554df806b0b5a020711" category="paragraph">在这些情况下、不应使用FLI。尽管迁移后可以访问数据、但结果是文件系统存在严重的性能限制。一般来说、在ONTAP上支持随机覆盖工作负载的任何文件系统都应使用4 k块大小。这主要适用于数据库数据文件和VDI部署等工作负载。可以使用相关的主机操作系统命令来确定块大小。</block>
  <block id="4941562ef813562e0d6aaef673158b99" category="paragraph">例如、在AIX上、可以使用查看块大小<block ref="10c9a985c983a826424b496a708263ec" prefix=" " category="inline-code"></block>。使用Linux、<block ref="ba5265473f00b27178098cc38d3aef24" prefix=" " category="inline-code"></block> 和<block ref="1f8a87190704df357c64a49aee936874" prefix=" " category="inline-code"></block> 可用于<block ref="310201b6353c5f38bc039e0e51b079d3" prefix=" " category="inline-code"></block> 和<block ref="5382133ffbecb9bce9d47f2e44327b16" prefix=" " category="inline-code"></block>。使用<block ref="8cbc6ba7c8bba133ce2bc44780d88742" prefix=" " category="inline-code"></block>，则命令为<block ref="1615297782a0dff59b20451e2ca97ea7" prefix=" " category="inline-code"></block>。</block>
  <block id="033a4cb04b5225e2b7cf966f2ce16598" category="paragraph">用于控制块大小的参数为<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 通常默认为9、表示2^9或512字节。为了获得最佳性能、<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 值必须为12 (2^12=4k)。此值在创建zpool时设置、并且无法更改、这意味着数据zpool具有<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block> 应通过将数据复制到新创建的zpool来迁移12以外的文件。</block>
  <block id="8bd9661d8c8eb9924c62b8242191af4e" category="paragraph">Oracle ASM没有基本块大小。唯一的要求是构建ASM磁盘的分区必须正确对齐。</block>
  <block id="ea7f7e1e8119ee64585b6173afe720e8" category="section-title">7-模式过渡工具</block>
  <block id="75df51cc2f43b8dde951695f97b838c0" category="paragraph">7-模式过渡工具(7MTT)是一款自动化实用程序、用于将大型7-模式配置迁移到ONTAP。大多数数据库客户发现其他方法更容易、部分原因是他们通常会逐个数据库迁移环境数据库、而不是重新定位整个存储占用空间。此外、数据库通常只是大型存储环境的一部分。因此、数据库通常会单独迁移、然后可以使用7MTT移动其余环境。</block>
  <block id="85fd7dcbc2206c27059ae7f88712154d" category="paragraph">有少数客户拥有专用于复杂数据库环境的存储系统、但数量相当多。这些环境可能包含许多卷、快照和大量配置详细信息、例如导出权限、LUN启动程序组、用户权限和轻型目录访问协议配置。在这种情况下、7MTT的自动化功能可以简化迁移。</block>
  <block id="2c87fbdecbf0dfe299f9f89958d61085" category="paragraph">7MTT可在以下两种模式之一下运行：</block>
  <block id="dc818e71a5519d1b99c7e996cf21fd74" category="list-text">*基于副本的过渡(CBT)。*采用CBT的7MTT可在新环境中从现有7-模式系统设置SnapMirror卷。数据同步后、7MTT会编排转换过程。</block>
  <block id="453bbc96e365e25cc2d091dced3565a6" category="list-text">*无副本过渡(CFT)。*采用CFT的7MTT基于现有7-模式磁盘架的原位转换。不会复制任何数据、现有磁盘架可以重复使用。保留现有数据保护和存储效率配置。</block>
  <block id="16262236c3981cb3310b9320b5a67fd0" category="paragraph">这两种方案之间的主要区别在于、无副本过渡是一种大爆炸方法、在这种方法中、连接到原始7-模式HA对的所有磁盘架都必须重新定位到新环境。无法移动部分磁盘架。基于副本的方法允许移动选定卷。此外、无副本过渡的转换窗口可能会更长、因为重新对磁盘架进行转换和转换元数据需要关联。根据现场经验、NetApp建议留出1小时的时间来重新定位磁盘架并重新为其接通网络、而留出15分钟到2小时的时间来进行元数据转换。</block>
  <block id="c8365c28332d425fd91f2de2e2c22dfb" category="summary">准备ONTAP以进行FLI迁移</block>
  <block id="25c18537e56595b3e7f3ce78905917ba" category="doc">FLI规划—Oracle</block>
  <block id="f1033948d9d2d14612d27f1808720f12" category="inline-link">TR-4380：《使用外部LUN导入进行SAN迁移》</block>
  <block id="58fc59a248fefa86003ac1867e5bd279" category="paragraph">NetApp中介绍了使用FLI迁移SAN资源的过程<block ref="5abd855dd5d8332b78fa966ac34c0f22" category="inline-link-rx"></block>。</block>
  <block id="795bbfbd054829fad905065087ba2d5a" category="paragraph">从数据库和主机的角度来看、不需要执行任何特殊步骤。更新FC分区并使LUN在ONTAP上可用后、LVM应能够从LUN中读取LVM元数据。此外、卷组已准备就绪、无需执行其他配置步骤。在极少数情况下、环境可能会包含使用先前存储阵列的引用进行硬编码的配置文件。例如、包含的Linux系统<block ref="dd5ff67ba72768d33f75e645aa2b8e56" prefix=" " category="inline-code"></block> 必须更新引用给定设备的WWN的规则、以反映FLI所做的更改。</block>
  <block id="9e7ddc2ddefcd6f202fb11a82a80bc7e" category="admonition">有关支持的配置的信息、请参见NetApp兼容性列表。如果您的环境未包括在其中、请与NetApp代表联系以获得帮助。</block>
  <block id="0f5b3758229b3e28c8605b6c42398115" category="paragraph">此示例显示了Linux服务器上托管的ASM和LVM LUN的迁移。FLI在其他操作系统上受支持、尽管主机端命令可能不同、但原则相同、ONTAP过程相同。</block>
  <block id="f1036cd97e461d07351c9df32fc5948d" category="section-title">确定LVM LUN</block>
  <block id="88f7413f9621a816ee3d370703168647" category="paragraph">准备工作的第一步是确定要迁移的LUN。在此处显示的示例中、两个基于SAN的文件系统挂载在上<block ref="572f241ef88fdb17d16eba97133d861f" prefix=" " category="inline-code"></block> 和<block ref="d14bc7787c7396144583e99a7df52f67" prefix=" " category="inline-code"></block>。</block>
  <block id="ecad615a52fda392a9b7c1075d2cb2c5" category="paragraph">可以从设备名称中提取卷组的名称、该名称采用格式(卷组名称)-(逻辑卷名称)。在这种情况下、卷组称为<block ref="bb97320b8c517da828eae4ec543113db" prefix=" " category="inline-code"></block>。</block>
  <block id="b08986bb1757d5ae8de06d523c71803d" category="paragraph">。<block ref="f1e2c495108b111c930735e3a0f9a04e" prefix=" " category="inline-code"></block> 命令可按如下所示来确定支持此卷组的LUN。在这种情况下、包含10个LUN<block ref="bb97320b8c517da828eae4ec543113db" prefix=" " category="inline-code"></block> 卷组。</block>
  <block id="8b47fac6803dfff2e8d2cdad6f297cfa" category="section-title">确定ASM LUN</block>
  <block id="a23d0124954ecdbfe9d0f3aceb9e17a2" category="paragraph">此外、还必须迁移ASM LUN。要以sysasm用户身份从sqlplus获取LUN和LUN路径数、请运行以下命令：</block>
  <block id="918841992da84786f00de7c4c7d83dbf" category="paragraph">当前环境包含20个要迁移的LUN。更新当前SAN、以便ONTAP可以访问当前LUN。尚未迁移数据、但ONTAP必须从当前LUN中读取配置信息、才能为该数据创建新的主目录。</block>
  <block id="5816768a5d83977f34ffa5025c14f430" category="paragraph">至少必须将AF/FAS系统上的一个HBA端口配置为启动程序端口。此外、必须更新FC分区、以便ONTAP可以访问外部存储阵列上的LUN。某些存储阵列配置了LUN屏蔽、用于限制哪些WWN可以访问给定LUN。在这种情况下、还必须更新LUN屏蔽以授予对ONTAP WWN的访问权限。</block>
  <block id="030a992b1340f67584d67ef6230e9adf" category="paragraph">完成此步骤后、ONTAP应能够使用查看外部存储阵列<block ref="d90ba20b63acab53952d68665c50ec47" prefix=" " category="inline-code"></block> 命令：它返回的关键字段是用于标识系统上的外部LUN的前缀。在以下示例中、是外部阵列上的LUN<block ref="25103eba8d70e82b5bd837be0d2f63c4" prefix=" " category="inline-code"></block> 在ONTAP中显示、并使用前缀<block ref="6b35470d99880c4630ed3ca7b4c842e7" prefix=" " category="inline-code"></block>。</block>
  <block id="c1a0f5174323df40a8b659eb65ac5155" category="section-title">确定外部阵列</block>
  <block id="6c1b8919e2e706972b3ec48cb7f014ba" category="section-title">确定外部LUN</block>
  <block id="63841e312d3a8531331e35bd826268d1" category="paragraph">通过传递、可以列出这些LUN<block ref="907702f5103a7823393b8dd296a75c26" prefix=" " category="inline-code"></block> 到<block ref="242f4ce1948273386f8bb487bdd3732f" prefix=" " category="inline-code"></block> 命令：在迁移操作步骤期间、系统会多次引用返回的数据。</block>
  <block id="e5e94f7e2098883f0d621e064b1104f4" category="section-title">将外部阵列LUN注册为候选导入阵列</block>
  <block id="c968ec41c1c0c449b0263962966d8293" category="paragraph">外部LUN最初归类为任何特定的LUN类型。在导入数据之前、必须将LUN标记为外部LUN、从而使其成为导入过程的候选LUN。此步骤可通过将序列号传递到来完成<block ref="93c633f7fa188f1b27df574c0e5e929a" prefix=" " category="inline-code"></block> 命令、如以下示例所示。请注意、此过程仅会将LUN标记为ONTAP中的外部LUN。不会向外部LUN本身写入任何数据。</block>
  <block id="33380a523841f23815f2f83c9de1a628" category="section-title">创建卷以托管迁移的LUN</block>
  <block id="2c2ba8ca6bdd77da1da981b91a3fae4a" category="paragraph">托管迁移的LUN需要一个卷。确切的卷配置取决于利用ONTAP功能的整体计划。在此示例中、ASM LUN放置在一个卷中、而LVM LUN放置在另一个卷中。这样、您就可以将LUN作为独立的组进行管理、以实现分层、创建快照或设置QoS控制等目的。</block>
  <block id="8bc7d64e68e4be8f4908effd57293a2a" category="paragraph">设置<block ref="fb983ebeedc63d8723c0d4aa558a4c02" prefix=" " category="inline-code"></block>。迁移过程中可能会涉及大量的数据周转。因此、如果由于在快照中捕获不需要的数据而意外创建快照、则空间消耗可能会大幅增加。</block>
  <block id="8c0675d07e44f55f1f5aa6d45abe0cdb" category="section-title">创建ONTAP LUN</block>
  <block id="0b799020dac78a5e12a3d1a6400fd0c8" category="paragraph">创建卷后、必须创建新的LUN。通常、创建LUN需要用户指定LUN大小等信息、但在这种情况下、外部磁盘参数会传递到命令。因此、ONTAP会从指定序列号复制当前LUN配置数据。它还会使用LUN几何结构和分区表数据来调整LUN对齐并建立最佳性能。</block>
  <block id="5272a1dc3854f1eddc353c8073234e03" category="paragraph">在此步骤中、必须对照外部阵列交叉引用序列号、以确保正确的外部LUN与正确的新LUN匹配。</block>
  <block id="f6ee70ec9fce7bd34fa5a33d8969fb5e" category="section-title">创建导入关系</block>
  <block id="94700a911b95416221efe4064acbc2ba" category="paragraph">LUN现在已创建、但尚未配置为复制目标。在执行此步骤之前、必须先将LUN置于脱机状态。这一额外步骤旨在保护数据免受用户错误的影响。如果ONTAP允许对联机LUN执行迁移、则会存在一个风险、即因出现输入错误而可能会覆盖活动数据。强制用户首先使LUN脱机这一额外步骤有助于验证是否将正确的目标LUN用作迁移目标。</block>
  <block id="85255e52054af9c6ffd3c4e79c723a34" category="paragraph">LUN脱机后、您可以通过将外部LUN序列号传递到来建立导入关系<block ref="04c2f87857699971f5aedd525e65690a" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="8e3c921431d2b7f66fa0cc85f3ae5c9d" category="paragraph">建立所有导入关系后、可以将LUN重新置于联机状态。</block>
  <block id="ea382cbfdb353cee0cf25eaae9bba150" category="section-title">创建启动程序组</block>
  <block id="152c4728a5fb152525a639439b9d7cb9" category="inline-link-macro">协议转换</block>
  <block id="298a1c3c736859f2cfa3cb8eb1f3fdcc" category="paragraph">在此示例中、创建了一个igrop、其中包含两个WWN、分别对应于主机HBA上的两个可用端口。</block>
  <block id="4f6f03762bfcdc7174cdd30240ce45b3" category="section-title">将新LUN映射到主机</block>
  <block id="c22fee2d07a149be91ae1ae2ada1cb57" category="paragraph">创建igroup后、LUN将映射到定义的igroup。这些LUN仅可供此igrop中包含的WWN使用。在迁移过程的这一阶段、NetApp会假定主机尚未分区到ONTAP。这一点非常重要、因为如果将主机同时分区到外部阵列和新的ONTAP系统、则可能会在每个阵列上发现具有相同序列号的LUN。这种情况可能会导致多路径故障或数据损坏。</block>
  <block id="ecca392290c36269e0489c0b1cf36f50" category="summary">用于自动执行Oracle迁移操作的示例脚本</block>
  <block id="fc53c036602508ed6c2afc18e2fbdf51" category="doc">示例脚本</block>
  <block id="6f78af00b87bcad5d08c95c7b6066ad0" category="paragraph">提供的脚本是如何为各种操作系统和数据库任务编写脚本的示例。它们按原样提供。如果特定操作步骤需要支持、请联系NetApp或NetApp经销商。</block>
  <block id="3146889e40b3ca2b78c56a19178bff84" category="section-title">数据库关闭</block>
  <block id="5b98b9877c0c74dc3a3daf46cf943d3f" category="paragraph">以下Perl脚本仅使用Oracle SID的一个参数、并关闭数据库。它可以作为Oracle用户或root用户运行。</block>
  <block id="7df41a3619af59182fb5df6d1920d11a" category="section-title">数据库启动</block>
  <block id="57249fb9cdac8ddc9ea8843636c4e088" category="section-title">将文件系统转换为只读</block>
  <block id="f2977a22ba44544ca8921e2d75bce435" category="paragraph">以下脚本采用文件系统参数、并尝试卸载它、然后将其重新挂载为只读。在迁移过程中、这样做非常有用、因为在迁移过程中、文件系统必须保持可用性以复制数据、同时必须防止意外损坏。</block>
  <block id="4eac395595a8d266839db0b88fae31e4" category="section-title">替换文件系统</block>
  <block id="988d7030a130298e1641007b5b0aae20" category="paragraph">以下脚本示例用于将一个文件系统替换为另一个文件系统。由于它会编辑`/etc/fstab `文件、因此必须以root用户身份运行。它接受新旧文件系统的一个逗号分隔参数。</block>
  <block id="149c75d086adf78a50a16bcb5e349158" category="list-text">要替换文件系统、请运行以下脚本：</block>
  <block id="67a4c588434c781febb12c165c3e860a" category="paragraph">作为此脚本用法的示例、假设中的数据<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 将迁移到<block ref="27df80f143a5812bda1553d09c712efc" prefix=" " category="inline-code"></block> 和<block ref="0e62afc91abe157ef67895cca0a7f912" prefix=" " category="inline-code"></block> 将迁移到<block ref="1c988fc7a325635f00f9b55992128a08" prefix=" " category="inline-code"></block>。执行此任务的最简单方法之一是、使用简单的文件复制操作将新设备重新定位回原始装载点。</block>
  <block id="4a3d90c30a5e921650fe8ad0decf4827" category="list-text">假设中存在新旧文件系统<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 文件、如下所示：</block>
  <block id="4588a4e3d2f8d0f7c036f59c1be2163f" category="list-text">运行时、此脚本会卸载当前文件系统并将其替换为新的：</block>
  <block id="2d808cb44231d0a80164567e7220fc44" category="list-text">该脚本还会更新<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 相应地归档。在此处所示的示例中、它包括以下更改：</block>
  <block id="840967a448e36b9efeaacf7673f825aa" category="section-title">自动化数据库迁移</block>
  <block id="1107dd36fe8ba0c18ea8abc8734986e2" category="paragraph">此示例说明了如何使用关闭、启动和文件系统替换脚本来完全自动执行迁移。</block>
  <block id="36881541e7d9c7bced65fcac337ac327" category="section-title">显示文件位置</block>
  <block id="1e9a1acc40d4943a73e6865cdebaf560" category="paragraph">此脚本会收集大量关键数据库参数、并以易于阅读的格式打印这些参数。此脚本在查看数据布局时非常有用。此外、还可以修改此脚本以供其他用途。</block>
  <block id="6172b49b7fdf806b59af0aeef8de71e3" category="section-title">ASM迁移清理</block>
  <block id="dd8d75d6766af495b5442e67eb27d387" category="section-title">ASM到文件系统名称转换</block>
  <block id="abc3fc91423668bb4bd49e6e837fa3e4" category="section-title">重放数据库上的日志</block>
  <block id="cc7b9a518bb2532f61662a9893248133" category="paragraph">此脚本接受处于挂载模式的数据库的Oracle SID的一个参数、并尝试重放所有当前可用的归档日志。</block>
  <block id="2a5bd3a209a1ed33b81c5306780227ce" category="section-title">重放备用数据库上的日志</block>
  <block id="ea7bebed0b4151a9b28acbde55fc0eb3" category="paragraph">此脚本与前面的脚本相同、只是它是为备用数据库设计的。</block>
  <block id="109be8945d38cda6c034a22373bdbd3b" category="summary">在FLI迁移后更改SAN协议</block>
  <block id="b5e65fbdff41aa940dad918d9f7c0b9e" category="doc">FLI协议转换—Oracle</block>
  <block id="2adcfd589637337984e39e94dd14ae33" category="paragraph">更改用于访问LUN的协议是一项常见要求。</block>
  <block id="38fe6838f11a6023172d11d806adbfcf" category="paragraph">在某些情况下、将数据迁移到云是整体战略的一部分。TCP/IP是云协议、从FC更改为iSCSI可以更轻松地迁移到各种云环境。在其他情况下、iSCSI可能是利用IP SAN降低的成本的理想选择。有时、迁移可能会使用不同的协议作为临时措施。例如、如果外部阵列和基于ONTAP的LUN不能同时位于同一HBA上、则可以使用iSCSI LUN足够长的时间来从旧阵列复制数据。从系统中删除旧LUN后、您可以将其转换回FC。</block>
  <block id="832c81bd0db3ad98a3804ff5ce996a58" category="paragraph">以下操作步骤演示了从FC到iSCSI的转换、但总体原则适用于从iSCSI到FC的反向转换。</block>
  <block id="e21180783b17ea695cf9275fce8a0bc7" category="section-title">安装iSCSI启动程序</block>
  <block id="0e1ddcc32a3ef636c9ca084a3d7706f5" category="paragraph">默认情况下、大多数操作系统都包含软件iSCSI启动程序、但如果未包含、则可以轻松安装。</block>
  <block id="289fe013df899f5f74fb362d4efcdd5d" category="section-title">确定iSCSI启动程序名称</block>
  <block id="8242e97b190184a6c7b8ec96c5662886" category="paragraph">在安装过程中会生成一个唯一的iSCSI启动程序名称。在Linux上、它位于中<block ref="22565a44e8f73044eb2029acbb069639" prefix=" " category="inline-code"></block> 文件此名称用于标识IP SAN上的主机。</block>
  <block id="721a96eb0b922b337fa815839839b328" category="section-title">创建新启动程序组</block>
  <block id="cda1311d977b7b77ad3aebe4a813b3bd" category="paragraph">启动程序组(igroGroup)是ONTAP LUN屏蔽架构的一部分。除非先授予主机访问权限、否则无法访问新创建的LUN。完成此步骤的方法是创建一个igrop、其中列出了需要访问的FC WWN或iSCSI启动程序名称。</block>
  <block id="6548788f050643897f7354b6df4488db" category="paragraph">在此示例中、创建了一个igrop、其中包含Linux主机的iSCSI启动程序。</block>
  <block id="da8490d81c1ef6b559b09c2ab94631d2" category="section-title">关闭环境</block>
  <block id="0bf211160ad57fedca3499176f213b11" category="paragraph">在更改LUN协议之前、必须将LUN完全置于静状态。要转换的LUN之一上的任何数据库都必须关闭、文件系统必须卸载、卷组必须停用。如果使用ASM、请确保已卸载ASM磁盘组并关闭所有网格服务。</block>
  <block id="2ba1c509ee5f5e31f05b24aed2d23054" category="section-title">取消LUN与FC网络的映射</block>
  <block id="2f9e42c479a76dd54d7946c181049dd4" category="paragraph">在LUN完全静置后、从原始FC igrop中删除映射。</block>
  <block id="5f889f52ef85be290c3e5c0211bbb8fa" category="section-title">将LUN重新映射到IP网络</block>
  <block id="4ac84701530b31d8d33d9aa742715d25" category="paragraph">将对每个LUN的访问权限授予新的基于iSCSI的启动程序组。</block>
  <block id="3d59eaa280c8b75d8e997eac2cf5b3e6" category="section-title">发现iSCSI目标</block>
  <block id="981b782c3eacf8b87d8231b887873f03" category="paragraph">iSCSI发现分为两个阶段。第一种方法是发现目标、这与发现LUN不同。。<block ref="f88921f58beaaae5bcb9dffac54bf5ad" prefix=" " category="inline-code"></block> 下面显示的命令用于探测由指定的门户组<block ref="24e12535882a30ad33a21d76d76bd0ff" prefix=" " category="inline-code"></block> 和用于存储提供iSCSI服务的所有IP地址和端口的列表。在这种情况下、有四个IP地址在默认端口3260上提供iSCSI服务。</block>
  <block id="0ab5dd035c7f92f4dce1026744c01604" category="admonition">如果无法访问任何目标IP地址、则此命令可能需要几分钟才能完成。</block>
  <block id="1dba8f39914c5f44e3cb635e7ac7563e" category="section-title">发现iSCSI LUN</block>
  <block id="68307bef4b9dc4071d875a0c2aadd321" category="paragraph">发现iSCSI目标后、重新启动iSCSI服务以发现可用的iSCSI LUN并构建关联设备、例如多路径或ASMlib设备。</block>
  <block id="25d811252f87ae85dda97f2ab9dd1f3a" category="section-title">重新启动环境</block>
  <block id="8a9aae851d31dae8baf96171f114955e" category="paragraph">通过重新激活卷组、重新挂载文件系统、重新启动RAC服务等方式重新启动环境。作为预防措施、NetApp建议您在转换过程完成后重新启动服务器、以确保所有配置文件均正确无误、并且所有陈旧设备均已删除。</block>
  <block id="00f4c8378b0bf837cee4b0aed8886f31" category="paragraph">注意：重新启动主机之前、请确保中的所有条目都已启用<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 此参考迁移的SAN资源已被注释掉。如果未执行此步骤、并且LUN访问出现问题、则可能会导致操作系统无法启动。此问题描述不会损坏数据。但是、启动到救援模式或类似模式并进行更正可能非常不方便<block ref="816a3ef77b62ade41c3f936c958aa555" prefix=" " category="inline-code"></block> 以便可以启动操作系统、以便开始故障排除工作。</block>
  <block id="7e712b6bec5dd0821f1822121da9f0c6" category="summary">采用QoS的Oracle性能管理</block>
  <block id="ff8b87ff7571fb54e71c9589f1b886a3" category="doc">Oracle数据库的服务质量</block>
  <block id="08e3cfb3c3dfa08d34bcbbfe07fe5f28" category="paragraph">安全高效地管理多个Oracle数据库需要有效的QoS策略。原因在于现代存储系统的性能不断提高。</block>
  <block id="3408fe4b6e4b2ed9366356f08e3b9ab0" category="summary">Oracle数据库和存储效率</block>
  <block id="151654fbc652cca26707bd7a060073d3" category="doc">Oracle数据库和ONTAP效率功能</block>
  <block id="4564218d346b0ef8263512ebe659337d" category="paragraph">ONTAP空间效率功能针对Oracle数据库进行了优化。在几乎所有情况下、最佳方法都是保留默认值并启用所有效率功能。</block>
  <block id="794c6d3bb54da92d9a4a4022bc5c4e94" category="summary">RAID和Oracle数据库</block>
  <block id="ead1ce56c368cc12c4f8932e01c92f65" category="doc">Oracle RAID要求</block>
  <block id="e959fe6bb794f67f31a0d4e6bc5d5bf4" category="paragraph">RAID是指使用冗余来保护数据不受驱动器丢失的影响。</block>
  <block id="b60b0e7c75501fe2f322675f2e6da6d7" category="paragraph">在配置用于Oracle数据库和其他企业应用程序的NetApp存储时、有时会出现有关RAID级别的问题。有关存储阵列配置的许多传统Oracle最佳实践都包含有关使用RAID镜像和(或)避免使用某些类型的RAID的警告。尽管这些来源可以提供有效的支持、但它们并不适用于RAID 4以及ONTAP中使用的NetApp RAID DP和RAID-TEC技术。</block>
  <block id="6de6bcceac7c1a53ecb774d42b8d5c9a" category="summary">Oracle和ONTAP精简配置</block>
  <block id="e04c5c8668870edf8392b07169f96644" category="doc">使用Oracle进行精简配置</block>
  <block id="26c71bfc140fc9f2d56f83f7aedffd53" category="paragraph">对Oracle数据库进行精简配置需要仔细规划、因为这样会导致在存储系统上配置的空间超过实际可用的空间。这是非常值得的努力、因为如果操作正确、可以显著节省成本并提高易管理性。</block>
  <block id="c9a6446e7a1a2aa2d3d06c76b3dd02ae" category="summary">为Oracle数据库配置SVM</block>
  <block id="eaa6380760494a867d1be23523aaba3e" category="doc">Oracle数据库和Storage Virtual Machine</block>
  <block id="ffa2dec61afa63c15c9906328e62e2e8" category="paragraph">Oracle数据库存储管理集中在Storage Virtual Machine (SVM)上</block>
  <block id="ba0fd7b6bfa61ad7f7ad5326a0934d01" category="summary">要确保Oracle数据库操作不会被这些操作中断、需要了解存储接管和切换功能。此外、如果使用不当、接管和切换操作使用的参数可能会影响数据完整性。</block>
  <block id="75f921b4326183319e82bc907e80cc42" category="doc">Oracle和ONTAP控制器故障转移/切换</block>
  <block id="999548558d2844d78a3b5f9186c231a4" category="summary">数据库和ONTAP存储容量和可用空间</block>
  <block id="3736e7d9912dca1541f3d86788010d1d" category="doc">Oracle和存储容量管理</block>
  <block id="360612d74cdd78953036946ec943f795" category="paragraph">要使用可预测、可管理的高性能企业存储管理数据库或其他企业应用程序、需要在驱动器上留出一些可用空间来管理数据和元数据。所需的可用空间量取决于使用的驱动器类型和业务流程。</block>
  <block id="655dc175973dc3d055e6e798ce1399a6" category="summary">Oracle多块读取参数</block>
  <block id="d3cc759510a3aba837fc8efeb2e24b91" category="doc">db_file_multiblock_read_count</block>
  <block id="32faf0a922da10425f2be9f86a5f5e18" category="paragraph">。<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 参数用于控制Oracle在顺序I/O期间单次操作读取的Oracle数据库块的最大数量</block>
  <block id="36cb03af3dc688208e0e94fda31ca7a4" category="paragraph">但是、此参数不会影响Oracle在任何和所有读取操作期间读取的块数、也不会影响随机I/O只有顺序I/O的块大小会受到影响。</block>
  <block id="2565c992b3732464484104f4c846d9b4" category="paragraph">Oracle建议用户不要设置此参数。这样可以使数据库软件自动设置最佳值。这通常意味着、将此参数设置为一个可产生1 MB I/O大小的值。例如、读取1 MB的8 KB块需要读取128个块、因此、此参数的默认值为128。</block>
  <block id="0fd26e725a6c1a81508e013094776e2c" category="paragraph">NetApp在客户站点发现的大多数数据库性能问题都与此参数的设置不正确有关。在Oracle版本8和9中更改此值有充分的理由。因此、参数可能会在不为人所用的情况下出现在中<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 文件、因为数据库已原位升级到Oracle 10及更高版本。与默认值128相比、原有设置8或16会严重损害顺序I/O性能。</block>
  <block id="3f594bb922365c7a9f095f44822fa22e" category="admonition">* NetApp建议*设置<block ref="d3cc759510a3aba837fc8efeb2e24b91" prefix=" " category="inline-code"></block> 参数不应出现在中<block ref="b6bd7c570605affc5b50bbd3e436f0c0" prefix=" " category="inline-code"></block> 文件NetApp从未遇到过更改此参数可提高性能的情况、但在许多情况下、它会明显损坏顺序I/O吞吐量。</block>
  <block id="669ebbf33c0b19005e2ccaf02ba69e5f" category="summary">使用网络存储的Oracle RAC设置</block>
  <block id="5c87e825763ec1e41a459f6baa4b2a44" category="doc">Oracle Real Application Clusters （ RAC ）</block>
  <block id="0eec903bb9d87349e379892ca99ef9ec" category="paragraph">Oracle RAC是一款集群软件产品、它具有多种类型的内部检测信号进程、用于监控集群的运行状况。</block>
  <block id="7c13d022c9fda6e792c4349a043a6c74" category="inline-link-macro">MissCount</block>
  <block id="bab4ae46619fcbbb84e3375ef205e61c" category="admonition">中的信息 <block ref="9cd17d807316d35ef47b12cbecab4ec8" category="inline-link-macro-rx"></block> 第节介绍了有关使用网络存储的Oracle RAC环境的重要信息、在许多情况下、需要更改默认Oracle RAC设置、以确保RAC集群在网络路径更改和存储故障转移/切换操作后不会受到影响。</block>
  <block id="0494651671c3dc7f1ccdf99a4368a2cf" category="section-title">磁盘超时</block>
  <block id="1973cfff3b7c6d828ede9d420b8481b5" category="paragraph">与存储相关的主RAC参数是<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。此参数用于控制表决文件I/O必须完成的阈值。如果<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 超过此参数后、RAC节点将从集群中逐出。此参数的默认值为200。此值对于标准存储接管和回用过程应足够。</block>
  <block id="4aa33fc988e36b9531d36da80d35ec2f" category="paragraph">NetApp强烈建议在将RAC配置投入生产之前对其进行全面测试、因为许多因素会影响接管或恢复。除了完成存储故障转移所需的时间之外、传播链路聚合控制协议(Link Aggregate Control Protocol、LACP)更改也需要额外的时间。此外、SAN多路径软件必须检测到I/O超时、然后在备用路径上重试。如果数据库非常活跃、则在处理表决磁盘I/O之前、必须对大量I/O进行排队和重试。</block>
  <block id="655a10764a0781d26dca3bfb939457b7" category="paragraph">如果无法执行实际的存储接管或恢复、则可以在数据库服务器上执行缆线拉拔测试来模拟这种影响。</block>
  <block id="b2a9e8dd67b2d9a7333cb2c2495c2aa5" category="list-text">退出<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 参数、默认值为200。</block>
  <block id="971a52f4b805c654dd133cf142457c53" category="list-text">始终全面测试RAC配置。</block>
  <block id="cd7a91511dbfbe5c79de12fa7d394dc0" category="paragraph">。<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 参数通常仅影响RAC节点之间的网络检测信号。默认值为30秒。如果网格二进制文件位于存储阵列上或操作系统启动驱动器不在本地、则此参数可能会变得很重要。这包括启动驱动器位于FC SAN上的主机、NFS启动的操作系统以及启动驱动器位于VMDK文件等虚拟化数据存储库上的主机。</block>
  <block id="9c1fd24d7d8e04847dadb944a6643121" category="paragraph">如果存储接管或恢复中断了对启动驱动器的访问、则网格二进制位置或整个操作系统可能会暂时挂起。ONTAP完成存储操作以及操作系统更改路径和恢复I/O所需的时间可能会超过<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 阈值。因此、在恢复与启动LUN或网格二进制文件的连接后、节点会立即被逐出。在大多数情况下、发生逐出和后续重新启动时不会记录任何日志消息来指示重新启动的原因。并非所有配置都会受到影响、因此、请在RAC环境中测试任何SAN启动、NFS启动或基于数据存储库的主机、以便在与启动驱动器的通信中断时RAC保持稳定。</block>
  <block id="2b875dbca82565f3d7e2fa51633bc2c9" category="paragraph">对于非本地启动驱动器或托管的非本地文件系统<block ref="ff4a008470319a22d9cf3d14af485977" prefix=" " category="inline-code"></block> 二进制文件、<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 需要更改才能匹配<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。如果更改了此参数、请执行进一步测试、以确定对RAC行为的任何影响、例如节点故障转移时间。</block>
  <block id="08d7a86ed9292993deaa28bee18d5ce5" category="list-text">离开<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 参数、默认值为30、除非满足以下条件之一：</block>
  <block id="5b46e861366ffd98cd94c26abf2bf550" category="list-text"><block ref="ff4a008470319a22d9cf3d14af485977" prefix="" category="inline-code"></block> 二进制文件位于网络连接驱动器上、包括NFS、iSCSI、FC和基于数据存储库的驱动器。</block>
  <block id="7ace6d79e63cb29c86093526fbddf845" category="list-text">操作系统通过SAN启动。</block>
  <block id="985511d6258bbf659d35bd76e0b0cea1" category="list-text">在这种情况下、请评估影响操作系统或访问的网络中断的影响<block ref="9599929f8663b5e2093f7bc5cb20b0c2" prefix=" " category="inline-code"></block> 文件系统。在某些情况下、此类中断发生原因会使Oracle RAC守护进程发生拖延、从而可能导致出现<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block>基于的超时和逐出。超时默认为27秒、即的值<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 减号<block ref="c9333b0a26b9f9e9fd808e6238d613b0" prefix=" " category="inline-code"></block>。在这种情况下，增加<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 至200以匹配<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block>。</block>
  <block id="6cde0106c3eb71034259ac34de5e6a2c" category="summary">Oracle文件系统io_options</block>
  <block id="a3f7c31b8d967e0ac9f9dd30fc81c061" category="paragraph">Oracle初始化参数<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 控制异步和直接I/O的使用</block>
  <block id="d1fa3441fd96418a75a509ac2907d644" category="paragraph">与通常的看法相反、异步I/O和直接I/O并不互相排斥。NetApp发现、在客户环境中、此参数经常配置不当、这种配置不当直接导致许多性能问题。</block>
  <block id="0775b72ddf51e2a16e466ee2df8f75ab" category="paragraph">异步I/O意味着可以并行处理Oracle I/O操作。在各种操作系统上提供异步I/O之前、用户配置了大量dbwriter进程并更改了服务器进程配置。使用异步I/O时、操作系统本身会代表数据库软件以高度高效的并行方式执行I/O。此过程不会使数据面临风险、Oracle重做日志记录等关键操作仍会同步执行。</block>
  <block id="6b72950206966c1983e559eb6886ec69" category="paragraph">直接I/O会绕过操作系统缓冲区缓存。UNIX系统上的I/O通常流经操作系统缓冲区缓存。这对于不维护内部缓存的应用程序非常有用、但Oracle在SGA中具有自己的缓冲区缓存。在几乎所有情况下、最好启用直接I/O并将服务器RAM分配给SGA、而不是依赖操作系统缓冲区缓存。Oracle SGA可以更高效地使用内存。此外、当I/O流经操作系统缓冲区时、它会受到额外处理的影响、从而增加了缓存。当低延迟是一项关键要求时、对于写入I/O负载繁重的情况、延迟增加尤为明显。</block>
  <block id="d8590a940a5bb30d8a845f4359f3c779" category="paragraph">的选项<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 是：</block>
  <block id="0aea10c6719256027228a859db38f291" category="list-text">*async.* Oracle将I/O请求提交给操作系统进行处理。此过程允许Oracle执行其他工作、而不是等待I/O完成、从而提高I/O并行处理能力。</block>
  <block id="00cb0cc309682c42b3b936a19a042434" category="list-text">*directio.* Oracle直接对物理文件执行I/O、而不是通过主机操作系统缓存路由I/O。</block>
  <block id="f9941e1b6cc84711e95db0e757efc36a" category="list-text">*无。* Oracle使用同步和缓冲I/O在这种配置中、在共享和专用服务器进程之间进行选择以及dbwriter的数量更重要。</block>
  <block id="f0939ff6231565c83c5c8c9ce1eddc9d" category="list-text">*setall.* Oracle同时使用异步和直接I/O在几乎所有情况下、使用<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block> 最佳。</block>
  <block id="8647b2eaf101a9425f69e6f2e67aeb9d" category="admonition">。<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> 参数在DNFS和ASM环境中无效。使用DNFS或ASM会自动导致同时使用异步和直接I/O</block>
  <block id="6dd5604aa0be2956f8b1b41c74fa648e" category="paragraph">某些客户过去遇到过异步I/O问题、尤其是在以前的Red Hat Enterprise Linux 4 (RHEL4)版本中。互联网上的一些过时建议仍然建议避免异步IO、因为信息过时。异步I/O在所有当前操作系统上均保持稳定。如果操作系统没有已知错误、则没有理由禁用它。</block>
  <block id="1ea377466376b194b2d1bfc3ab2fa4c4" category="paragraph">如果数据库一直在使用缓冲I/O、则切换到直接I/O可能还需要更改SGA大小。禁用缓冲的I/O可消除主机操作系统缓存为数据库提供的性能优势。将RAM重新添加到SGA可修复此问题。最终结果应该是I/O性能有所提高。</block>
  <block id="787b3d8b62af05ac3efd1c9ca7a8fc7e" category="paragraph">尽管Oracle SGA使用RAM几乎总是优于操作系统缓冲区缓存、但可能无法确定最佳值。例如、在具有许多间歇性活动Oracle实例的数据库服务器上、最好使用SGA大小非常小的缓冲I/O。这种安排允许所有正在运行的数据库实例灵活地使用操作系统上剩余的可用RAM。这是一种非常少见的情况、但在某些客户站点上也发现过。</block>
  <block id="d4157ab77eb31459bd406aa0f873e20c" category="admonition">* NetApp建议*设置<block ref="f1110589be196c2310808482067fce1b" prefix=" " category="inline-code"></block> to<block ref="aef8f91b1e026cc1bb55e8b08c491d35" prefix=" " category="inline-code"></block>但请注意，在某些情况下，丢失主机缓冲区缓存可能需要增加Oracle SGA。</block>
  <block id="caa6d47f2f011d5d1b5fb830e85a37f0" category="summary">Oracle块大小</block>
  <block id="6db776dab2989df63d245511a4dccf08" category="doc">Oracle块大小</block>
  <block id="f8b42f9efd1a05ede10b0e0c11dfa8b0" category="paragraph">ONTAP在内部使用可变块大小、这意味着可以为Oracle数据库配置所需的任何块大小。但是、文件系统块大小可能会影响性能、在某些情况下、较大的重做块大小可以提高性能。</block>
  <block id="0944aedb4703c4a5e94fb90de9d7a22f" category="section-title">数据文件块大小</block>
  <block id="cc4662c047050e0082701ce6f052dcb7" category="paragraph">某些操作系统可选择文件系统块大小。对于支持Oracle数据文件的文件系统、使用数据压缩时、块大小应为8 KB。如果不需要数据压缩、则可以使用8 KB或4 KB的块大小。</block>
  <block id="e1a001cf8c7e2072c7a44ee65e8fee11" category="paragraph">如果将数据文件放置在具有512字节块的文件系统上、则可能会出现文件错位。LUN和文件系统可能已根据NetApp建议正确对齐、但文件I/O可能错位。这种错位会导致发生原因出现严重的性能问题。</block>
  <block id="9514c8638f798f68108498dd218ec793" category="paragraph">支持重做日志的文件系统所使用的块大小必须是重做块大小的倍数。这通常要求重做日志文件系统和重做日志本身都使用512字节的块大小。</block>
  <block id="cac7d87a1164763b666ca7d02109d153" category="section-title">重做块大小</block>
  <block id="fa06b9584ea36af182742c07894220f0" category="paragraph">在重做率非常高的情况下、4 KB块大小的性能可能会更好、因为重做率较高、可以在更少、更高效的操作中执行I/O。如果重做速率大于50 Mbps、请考虑测试4 KB的块大小。</block>
  <block id="781000593b4913b5625dd5ed9eebe87e" category="paragraph">在块大小为4 KB的文件系统上使用块大小为512字节的重做日志和许多非常小的事务时、客户发现了一些数据库问题。对一个4 KB文件系统块应用多个512字节更改所涉及的开销导致了性能问题、这些问题通过将文件系统更改为使用512字节的块大小得以解决。</block>
  <block id="a02416fde36b174cf1196213fcf1bef6" category="admonition">* NetApp建议*不要更改重做块大小、除非相关客户支持或专业服务组织建议您更改块大小、或者更改基于官方产品文档。</block>
  <block id="00783c075f877e6e69c64079296967ed" category="summary">借助ONTAP实现Oracle灾难恢复</block>
  <block id="6a87f84ba62b57e5643d5bfa5967c7a8" category="doc">使用ONTAP进行灾难恢复</block>
  <block id="65a6ece62f52a5e2ff74baaae821ae86" category="paragraph">灾难恢复是指在发生灾难性事件(例如火灾、导致存储系统甚至整个站点遭到破坏)后恢复数据服务。</block>
  <block id="e168b3b0b2f075f39012df52c5ea3c0a" category="admonition">本文档可替代先前发布的技术报告_TR-4591：《Oracle数据保护》_和_TR-4592：《基于MetroCluster的Oracle》</block>
  <block id="a91982f09e6a0341a90dae002865ea11" category="paragraph">灾难恢复可以通过使用SnapMirror轻松复制数据来实现、当然、许多客户每小时更新一次镜像副本。</block>
  <block id="0f1b72a875a2bcb3d0e844ca2dcee233" category="paragraph">对于大多数客户而言、灾难恢复不仅需要拥有远程数据副本、还需要能够快速利用这些数据。NetApp提供了两种技术来满足这一需求—MetroCluster和SnapMirror业务连续性(SM-BC)</block>
  <block id="ad2c5e9521f13e89cd84fdd65ec96c7d" category="paragraph">MetroCluster是指硬件配置中的ONTAP、其中包括低级同步镜像存储和许多附加功能。MetroCluster等集成解决方案简化了当今复杂的横向扩展数据库、应用程序和虚拟化基础架构。它将多个外部数据保护产品和策略替换为一个简单的中央存储阵列。此外、它还可以在一个集群模式存储系统中提供集成的备份、恢复、灾难恢复和高可用性(HA)功能。</block>
  <block id="05be1e741eba1ac3f0b7c924f261403b" category="paragraph">SnapMirror业务连续性(SM-BC)基于SnapMirror同步。通过MetroCluster、每个ONTAP控制器都负责将其驱动器数据复制到远程位置。使用SM-BC、您实际上拥有两个不同的ONTAP系统、这些系统维护LUN数据的独立副本、但会合作提供该LUN的一个实例。从主机角度来看、它是一个LUN实体。</block>
  <block id="70f47db03a0843fec433c8cc41a54635" category="paragraph">尽管SM-BC和MetroCluster在内部的工作方式截然不同、但对于主机来说、结果却非常相似。主要区别在于粒度。如果您只需要选择要同步复制的工作负载、则SM-BC是更好的选择。如果您需要复制整个环境甚至数据中心、MetroCluster是一个更好的选择。此外、SM-BC目前仅支持SAN、而MetroCluster支持多协议、包括SAN、NFS和SMB。</block>
  <block id="7389dc8e47495ffdde7fd2e0fc19df20" category="summary">使用SM-BC进行Oracle故障转移</block>
  <block id="0a54809bbd5dc721967217b79aa04429" category="paragraph">在SM-BC上托管Oracle数据库的主要原因是、在计划内和计划外存储事件期间提供透明的故障转移。</block>
  <block id="cfb8f86af03363ef2c73933e34108390" category="summary">ONTAP上的Oracle单个实例、使用SM-BC</block>
  <block id="f25228759326d365adf4dca6b7b2cb8b" category="doc">采用SM-BC的单实例Oracle</block>
  <block id="a38cb04f35bd24313f90398cdc07e149" category="paragraph">下图显示了一种简单的部署模式、其中、存储设备会从Oracle数据库的主存储集群和远程存储集群进行分区或连接。</block>
  <block id="ac38db4f14e512b48d088eedb84cd611" category="paragraph">Oracle仅在主系统上配置。此模式可在发生存储端灾难时实现无缝存储故障转移、不会丢失任何数据、也不会造成任何应用程序停机。但是、在站点发生故障期间、此模型不会提供数据库环境的高可用性。这种类型的架构对于希望获得零数据丢失解决方案且存储服务具有高可用性的客户非常有用、但客户也认为数据库集群完全丢失需要手动操作。</block>
  <block id="ccc53ca027c7d8fb1e0d647249fd67cd" category="paragraph"><block ref="ccc53ca027c7d8fb1e0d647249fd67cd" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4e072ef2eba1c46e59475046cd4fb880" category="paragraph">这种方法还可以节省Oracle许可成本。在远程站点上预配置Oracle数据库节点需要根据大多数Oracle许可协议为所有核心授予许可。如果可以接受因安装Oracle数据库服务器和挂载无故障数据副本所需时间而导致的延迟、则此设计可能非常经济高效。</block>
  <block id="5e2dd7c2fa063e6d7af964efc0e488a0" category="summary">基于采用SM-BC的ONTAP的Oracle RAC</block>
  <block id="f7d366254f13816be07d3c8dff4ef00c" category="doc">采用SM-BC的Oracle RAC</block>
  <block id="67bbc9e19672ee6c9c548cae8a472396" category="paragraph">SM-BC可精细控制数据集复制、以实现负载平衡或单个应用程序故障转移等目的。整体架构看起来像一个扩展的RAC集群、但某些数据库专用于特定站点、整体负载是分布式的。</block>
  <block id="9331b3ad2bcf259818157930e1c82ad3" category="paragraph">例如、您可以构建一个Oracle RAC集群来托管六个单独的数据库。其中三个数据库的存储主要托管在站点A上、其余三个数据库的存储将托管在站点B上此配置可最大限度地减少跨站点流量、从而确保性能最佳。此外、应用程序将配置为使用具有活动路径的存储系统本地数据库实例。这样可以最大程度地减少RAC互连流量。最后、这种整体设计可确保所有计算资源的使用均匀。随着工作负载的变化、数据库可以有选择地在各个站点之间来回故障转移、以确保负载均匀。</block>
  <block id="4278792a47efb1e599476fe07109dca4" category="inline-link-macro">基于MetroCluster的Oracle RAC</block>
  <block id="1c6753ccdcc6629af3e1febabbf271b5" category="paragraph">除了粒度之外、使用SM-BC的Oracle RAC的基本原则和选项与相同 <block ref="f7453402f1e4779ea0ec67d873358932" category="inline-link-macro-rx"></block></block>
  <block id="7e544b57620f5cdeb71865606eab0549" category="summary">采用SnapMirror业务连续性(SM-BC)的Oracle</block>
  <block id="33aa8b7a84723347d228956fab2a4de8" category="doc">Oracle和SnapMirror业务连续性</block>
  <block id="41eec95e0dbb542c5cd25248ec5759d5" category="paragraph">SM-BC为各个Oracle数据库和应用程序环境提供了选择性的RPO = 0同步镜像。</block>
  <block id="563d0bf19fd5d623a031d90c30128dc1" category="summary">Oracle SM-BC故障场景</block>
  <block id="3c1ea312a3c6648fc3f94a1ccd12bebc" category="doc">Oracle SM-BC故障场景</block>
  <block id="87777c84375810d8b6fd65f604dd2561" category="paragraph">存在多种SnapMirror业务连续性(SM-BC)故障情形、每种情形的结果各不相同。</block>
  <block id="8eea62084ca7e541d918e823422bd82e" category="cell">结果</block>
  <block id="ee70ac41df7240931fee4110b599c39f" category="cell">复制链路故障</block>
  <block id="e79e76eca171f3e596eb56ba4bb24743" category="cell">调解器可识别这种脑裂情形、并恢复持有主副本的节点上的I/O。当站点之间的连接恢复联机后、备用站点将执行自动重新同步。</block>
  <block id="98a638ba6cee257a8f751bcf8d30e1f2" category="cell">主站点存储故障</block>
  <block id="b92af6cefecfe68535bbd851b797379f" category="cell">调解器会启动自动计划外故障转移。

无I/O中断。</block>
  <block id="ce9a584219636ca5b159a27f2dd8c445" category="cell">远程站点存储故障</block>
  <block id="68a293bd16c4e2589057d43506a5afbd" category="cell">不会造成I/O中断。由于网络导致同步复制中止、并且主节点确定它是继续提供I/O (协商一致)的合法所有者、因此会出现短暂的暂停。因此、I/O会暂停几秒钟、然后I/O将恢复。

站点联机时会自动重新同步。</block>
  <block id="64f4e3573d0b569ef7b5a08476fb9f7d" category="cell">调解器丢失或调解器与存储阵列之间的链路丢失</block>
  <block id="7e7abe23ef8e465ee1b6879b35e6bab3" category="cell">I/O将继续并保持与远程集群同步、但如果没有调解器、则无法自动执行计划外/计划内故障转移和故障恢复。</block>
  <block id="96b352ebd03c8c5b7589a527b18f1a2d" category="cell">丢失HA集群中的一个存储控制器</block>
  <block id="426c4468c3cc76191842240593fcfec3" category="cell">HA集群中的配对节点尝试接管(NDo)。如果接管失败、调解器会注意到存储中的两个节点均已关闭、并自动向远程集群执行计划外故障转移。</block>
  <block id="0e578c93ab393c3d449d484e9fa4b84e" category="cell">磁盘丢失</block>
  <block id="3d5fea5d89ec844fc92c08a585050e4e" category="cell">IO最多会连续发生三次磁盘故障。这是RAID-TEC的一部分。</block>
  <block id="bd300f92769c0ee071832cadaff91f04" category="cell">在典型部署中丢失整个站点</block>
  <block id="9cfa40a514d333ea10de6fc8a75ac663" category="cell">故障站点上的服务器显然将不再可用。支持集群的应用程序可以配置为在两个站点上运行、并在备用站点上继续运行、但大多数此类应用程序都需要第三个站点的Tieb破碎 机、就像SM-BC需要调解器一样。

如果没有应用程序级集群、则需要在运行正常的站点上启动应用程序。这会影响可用性、但会保留RPO = 0。不会丢失任何数据。</block>
  <block id="f2762385d394491398659925e75d5d01" category="summary">MetroCluster物理架构—Oracle</block>
  <block id="5be41b602a41d06df45e8986ec09a8dc" category="doc">MetroCluster物理架构—Oracle</block>
  <block id="d12be40db836559c628e8024f5d6ff56" category="paragraph">要了解Oracle数据库在MetroCluster环境中的运行方式、需要对MetroCluster系统的物理设计进行一些说明。</block>
  <block id="5e33c0d8a2417ce5fb6e7a211ad063bb" category="admonition">本文档可替代先前发布的技术报告_TR-4592：《基于MetroCluster的Oracle》</block>
  <block id="bdec122112fe3ad35d588380dc643e48" category="summary">MetroCluster逻辑架构—Oracle</block>
  <block id="141402e8d9fa946970f252a09a01a462" category="doc">MetroCluster逻辑架构—Oracle</block>
  <block id="37fa92fc2662529308c62c84eb1b38ea" category="paragraph">要了解Oracle数据库如何在MetroCluster环境alsop中运行、需要对MetroCluster系统的逻辑功能进行一些说明。</block>
  <block id="2623b589ddbc1cdb6184ba32aa06e83f" category="inline-link-macro">NVFAIL</block>
  <block id="6ddd3d6bc3ad92b983699970b1596e0f" category="summary">采用MetroCluster的Oracle</block>
  <block id="c1fac7a72cd91bcd345e567f6d6d93a3" category="doc">使用MetroCluster进行Oracle故障转移</block>
  <block id="7a60cb119af7ddcdfe38fc872d2027a1" category="paragraph">使用MetroCluster并不一定会增加或更改企业级应用程序和数据库的任何最佳操作实践。</block>
  <block id="a4feacea8b05d0f24e5a4612a164a055" category="paragraph">通常的最佳实践仍然适用、如果您的需求仅需要RPO = 0数据保护、则MetroCluster可以满足该需求。但是、大多数客户使用MetroCluster不仅可以实现RROT=0的数据保护、还可以在灾难情形下提高RTO、并在站点维护活动中提供透明的故障转移。</block>
  <block id="3ff8bcf18c694581aa25b0a347508e0f" category="section-title">使用预配置的操作系统进行故障转移</block>
  <block id="9bd9ad7f296a0e8ac3df804b3c6a392f" category="paragraph">SyncMirror在灾难恢复站点提供数据的同步副本、但要使数据可用、需要使用操作系统和相关应用程序。基本自动化可以显著缩短整个环境的故障转移时间。Oracle RAC、Veritas Cluster Server (VCS)或VMware HA等集群软件产品通常用于在站点间创建集群、在许多情况下、可以使用简单的脚本来驱动故障转移过程。</block>
  <block id="c5a2f3b867d990c681a218d29a55fcfa" category="paragraph">如果主节点丢失、则会将集群软件(或脚本)配置为在备用站点使应用程序联机。一种选择是、创建为构成应用程序的NFS或SAN资源预先配置的备用服务器。如果主站点发生故障、则集群软件或脚本化备用站点将执行一系列类似以下内容的操作：</block>
  <block id="442f34633164f1be348a442b2c62d29d" category="list-text">强制执行MetroCluster切换</block>
  <block id="e081e79ea1b1040c51d4a452e46de76d" category="list-text">发现FC LUN (仅限SAN)</block>
  <block id="6f3fd86521759fc98ed93853eaf8a03a" category="list-text">挂载文件系统</block>
  <block id="9d9ea7a9c532a3cec63305130018a45b" category="list-text">正在启动应用程序</block>
  <block id="b8eca7b573624230962095fcadb03ddf" category="paragraph">此方法的主要要求是在远程站点上运行操作系统。它必须预配置应用程序二进制文件、这也意味着必须在主站点和备用站点上执行修补等任务。或者、可以将应用程序二进制文件镜像到远程站点、并在声明发生灾难时进行挂载。</block>
  <block id="e60946bf73021e18706a6ac33386b376" category="paragraph">实际激活操作步骤非常简单。LUN发现等命令只需对每个FC端口执行几个命令即可。文件系统挂载只不过是一个<block ref="19822b1b15d9eefc54c07ab49f87b100" prefix=" " category="inline-code"></block> 命令、数据库和ASM均可通过CLI使用一个命令来启动和停止。如果在切换之前灾难恢复站点未使用卷和文件系统、则无需设置<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 卷上。</block>
  <block id="486eed21f55b6fb544db5504294592e6" category="section-title">使用虚拟化操作系统进行故障转移</block>
  <block id="bf65e943f86f26b49698bfdac9b95f81" category="paragraph">数据库环境的故障转移可以扩展到包括操作系统本身。理论上、这种故障转移可以使用启动LUN来完成、但大多数情况下、这种故障转移是通过虚拟化操作系统来完成的。操作步骤类似于以下步骤：</block>
  <block id="7c37589384e83d2b43bba430c18a45aa" category="list-text">挂载托管数据库服务器虚拟机的数据存储库</block>
  <block id="3d4d04d6cdab90b7ca0deb0344f04eec" category="list-text">启动虚拟机</block>
  <block id="ba2f22f63087151f0a0694be5f35fcf2" category="list-text">手动启动数据库或将虚拟机配置为自动启动数据库</block>
  <block id="810078f3b19b93e24de8638d68f727b5" category="paragraph">例如、ESX集群可以跨越多个站点。发生灾难时、可以在切换后将灾难恢复站点上的虚拟机置于联机状态。只要在发生灾难时托管虚拟化数据库服务器的数据存储库未在使用中、就不需要进行设置<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 在关联卷上。</block>
  <block id="681afe3bdc351138642f233429d64762" category="summary">Oracle和SyncMirror</block>
  <block id="bc8a6c6eac662831d2ddce97adbd4324" category="doc">SyncMirror—Oracle</block>
  <block id="c702c387f07bcb4f18482e68d69a155a" category="paragraph">使用MetroCluster系统进行Oracle数据保护的基础是SyncMirror、这是一种性能最高的横向扩展同步镜像技术。</block>
  <block id="9028b52caaa7bdbfb9be779eeb1fe00e" category="summary">采用MetroCluster的Oracle扩展RAC</block>
  <block id="dbcedb2fd86e6012347a3c9ad111f3a8" category="doc">基于MetroCluster的扩展Oracle RAC</block>
  <block id="4d4d8a609e5b2ac58e622eb1e90f9e39" category="paragraph">许多客户通过跨站点扩展Oracle RAC集群来优化其RTO、从而形成完全主动-主动配置。整体设计变得更加复杂、因为它必须包括Oracle RAC的仲裁管理。此外、还可以从两个站点访问数据、这意味着强制切换可能会导致使用过时的数据副本。</block>
  <block id="89ffaa1a7d089080e9a1ce912bb8c2d3" category="paragraph">尽管两个站点上都存在数据副本、但只有当前拥有聚合的控制器才能提供数据。因此、对于扩展RAC集群、远程节点必须通过站点到站点连接执行I/O。结果会增加I/O延迟、但这种延迟通常不是问题。RAC互连网络还必须跨站点延伸、这意味着无论如何都需要一个高速、低延迟的网络。如果增加的延迟使发生原因出现问题、则可以主动-被动方式运行集群。然后、需要将I/O密集型操作定向到拥有聚合的控制器本地的RAC节点。然后、远程节点会执行较轻的I/O操作、或者纯粹用作热备用服务器。</block>
  <block id="375c3caa97162bd0c2c07869d9c5b026" category="paragraph">如果需要主动-主动扩展RAC、则应考虑使用ASM镜像代替MetroCluster。ASM镜像允许首选使用特定的数据副本。因此、可以构建一个扩展RAC集群、在该集群中、所有读取操作都在本地进行。读取I/O不会跨越站点、从而尽可能地降低延迟。所有写入活动仍必须传输站点间连接、但使用任何同步镜像解决方案时、此类流量都是不可避免的。</block>
  <block id="f441d5fdc388f3419fb87e071534f3ce" category="inline-link-macro">采用ONTAP的Oracle RAC</block>
  <block id="59d934fc4614a6275fef2828bfab30cf" category="admonition">如果在Oracle RAC中使用启动LUN (包括虚拟化启动磁盘)、则<block ref="7c13d022c9fda6e792c4349a043a6c74" prefix=" " category="inline-code"></block> 可能需要更改参数。有关RAC超时参数的详细信息、请参阅 <block ref="75080d28a1748f78cf8a666ababf51af" category="inline-link-macro-rx"></block>。</block>
  <block id="58285fb769eb7fb05ab12d9e0efb3e50" category="section-title">双站点配置</block>
  <block id="af1184f29d838fbfec8d5b5bf5225f66" category="paragraph">双站点扩展RAC配置可以提供主动-主动数据库服务、这些服务可以在许多(并非所有)灾难情形下无系统地经受住。</block>
  <block id="7544489c7854fcae445508015240a865" category="section-title">RAC投票文件</block>
  <block id="8b6e46422f88dab6ea82f2dbcadfc76b" category="paragraph">在MetroCluster上部署扩展RAC时、首要考虑事项应该是仲裁管理。Oracle RAC有两种管理仲裁的机制：磁盘检测信号和网络检测信号。磁盘检测信号可使用表决文件监控存储访问。对于单站点RAC配置、只要底层存储系统提供HA功能、单个表决资源就足够了。</block>
  <block id="fafd618b82d1827eeb8197e1c38722bc" category="paragraph">在早期版本的Oracle中、投票文件放置在物理存储设备上、但在当前版本的Oracle中、投票文件存储在ASM磁盘组中。</block>
  <block id="aeab2391a07321ac474989b9c9047226" category="admonition">NFS支持Oracle RAC。在网格安装过程中、会创建一组ASM进程、以将网格文件使用的NFS位置显示为ASM磁盘组。此过程对最终用户几乎是透明的、安装完成后无需持续进行ASM管理。</block>
  <block id="42aca4aae768d5ec1cb0c50d41b7b8b7" category="paragraph">双站点配置的第一个要求是、确保每个站点始终可以访问一半以上的表决文件、并确保灾难恢复过程不会中断。在表决文件存储在ASM磁盘组中之前、此任务非常简单、但如今管理员需要了解ASM冗余的基本原则。</block>
  <block id="60a723853bb2c173648452baf2199e73" category="paragraph">ASM磁盘组有三个冗余选项<block ref="6a21b6995a068148bbb65c8f949b3fb2" prefix=" " category="inline-code"></block>，<block ref="fea087517c26fadd409bd4b9dc642555" prefix=" " category="inline-code"></block>，和<block ref="8d966b2253a917086c8604959e152243" prefix=" " category="inline-code"></block>。换言之、未镜像、镜像和三向镜像。名为的新选项<block ref="09d2bd168181f1e64c2b1651a80a8aa8" prefix=" " category="inline-code"></block> 也可用、但很少使用。冗余设备的冗余级别和放置位置控制了在故障情形下发生的情况。例如：</block>
  <block id="32cdeb2c0245b51a0b590e6054f03c21" category="list-text">将表决文件放置在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 使用<block ref="6a21b6995a068148bbb65c8f949b3fb2" prefix=" " category="inline-code"></block> 冗余资源可确保在站点间连接断开时逐出一个站点。</block>
  <block id="a549b4f1fc0c2d14bc333c70bbde73dc" category="list-text">将表决文件放置在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 使用<block ref="fea087517c26fadd409bd4b9dc642555" prefix=" " category="inline-code"></block> 每个站点只有一个ASM磁盘的冗余可确保在站点间连接断开时在两个站点上逐出节点、因为两个站点都不会有多数仲裁。</block>
  <block id="c15f1c43a368db0ab3dde90eca52582d" category="list-text">将表决文件放置在上<block ref="d4f266c5956ee60df748738c483f3dc0" prefix=" " category="inline-code"></block> 使用<block ref="8d966b2253a917086c8604959e152243" prefix=" " category="inline-code"></block> 如果一个站点上有两个磁盘、而另一个站点上有一个磁盘、则可以在两个站点均正常运行且可相互访问时执行主动-主动操作。但是、如果单磁盘站点与网络隔离、则该站点将被逐出。</block>
  <block id="478ced47a1ea1d6f0db02af749bfdaec" category="section-title">RAC网络检测信号</block>
  <block id="2432333dc52d6150fb3d58051bc8b0c2" category="paragraph">Oracle RAC网络检测信号可监控集群互连中的节点可访问情况。要保留在集群中、一个节点必须能够与一半以上的其他节点联系。在双站点架构中、此要求会为RAC节点数创建以下选项：</block>
  <block id="3e36a59c8a51ee9cc2cba0e7051ed35f" category="list-text">如果在每个站点上放置相同数量的节点、则会在网络连接断开时在一个站点上执行逐出。</block>
  <block id="4955aede919912b3c62fadbc1039671b" category="list-text">将N个节点放置在一个站点上、而将N+1个节点放置在另一个站点上、可以确保站点间连接断开会导致站点中剩余的网络仲裁节点数量增加、而将节点数量减少。</block>
  <block id="80bd651a66488201c928634689e2e5cc" category="paragraph">在Oracle 12cR2之前的版本中、无法控制站点丢失期间哪一端会发生逐出。如果每个站点的节点数相等、则逐出操作由主节点控制、主节点通常是要启动的第一个RAC节点。</block>
  <block id="d128c05245b2e633856a5061db176b7e" category="paragraph">Oracle 12cR2引入了节点加权功能。通过此功能、管理员可以更好地控制Oracle如何解决脑裂问题。例如、以下命令可为RAC中的特定节点设置首选项：</block>
  <block id="104c5747f0d9dbb47b0d09953c709a8d" category="paragraph">重新启动Oracle高可用性服务后、配置如下所示：</block>
  <block id="693cce334ab6658c73ea67674775156b" category="paragraph">Node<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 现在指定为关键服务器。如果两个RAC节点彼此隔离、<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 不会影响、和<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 被逐出。</block>
  <block id="386839b09451962d03e26b7bbfabce74" category="admonition">有关完整的详细信息、请参见Oracle白皮书《Oracle Clusterware 12c Release 2 Technical Overview》。"</block>
  <block id="11f65689342acc8f71c8014eeb7945ee" category="paragraph">对于12cR2之前的Oracle RAC版本、可通过按如下所示检查CRS日志来识别主节点：</block>
  <block id="c8b8cd80b31dac17fb85459c341042bd" category="paragraph">此日志指示主节点为<block ref="c81e728d9d4c2f636f067f89cc14862c" prefix=" " category="inline-code"></block> 和节点<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> ID为<block ref="c4ca4238a0b923820dcc509a6f75849b" prefix=" " category="inline-code"></block>。这一事实意味着<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> 不是主节点。可以使用命令确认主节点的标识<block ref="08e7c60bbf8289a563b25cc033d431f7" prefix=" " category="inline-code"></block>。</block>
  <block id="fdf6179b59d3f4873b042609a5f09bc4" category="paragraph">ID为的节点<block ref="c81e728d9d4c2f636f067f89cc14862c" prefix=" " category="inline-code"></block> 为<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block>，即主节点。在每个站点上具有相同节点数的配置中、站点使用<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 是指在两组因任何原因丢失网络连接时仍可正常运行的站点。</block>
  <block id="f2932b43ad604fa01d57212558608ed6" category="paragraph">标识主节点的日志条目可能会在系统中过期。在这种情况下、可以使用Oracle集群注册表(OCR)备份的时间戳。</block>
  <block id="50cd29958db0c1dcb6505d470f553e54" category="paragraph">此示例显示主节点为<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block>。此外、它还表示主节点与发生了变化<block ref="a31853cdea7badfc68b560e70cbbeb02" prefix=" " category="inline-code"></block> to<block ref="bf38e7432ba60433c4c8967fc8da0258" prefix=" " category="inline-code"></block> 5月4日2：05到21：39之间的某个时间。只有在检查了CRS日志后、才能安全地使用这种标识主节点的方法、因为主节点可能在上次OCR备份后发生更改。如果发生了此更改、则OCR日志中应该会显示此更改。</block>
  <block id="df044a3c3d7f7f244db7c42b347b9a90" category="paragraph">大多数客户都选择一个投票磁盘组来为整个环境提供服务、并在每个站点上选择相同数量的RAC节点。磁盘组应放置在数据库所在的站点上。其结果是、连接断开会导致在远程站点上发生逐出。远程站点将不再具有仲裁、也无法访问数据库文件、但本地站点仍会照常运行。恢复连接后、远程实例可以重新联机。</block>
  <block id="84a24276bfdfbe485b9d961c1a57a830" category="paragraph">发生灾难时、需要执行切换、以使运行正常的站点上的数据库文件和表决磁盘组联机。如果灾难允许AUSO触发切换、则不会触发NVFAIL、因为集群已知处于同步状态、并且存储资源正常联机。此操作速度非常快、应在之前完成<block ref="0494651671c3dc7f1ccdf99a4368a2cf" prefix=" " category="inline-code"></block> 期限到期。</block>
  <block id="6244ee13e435dcc768edbc9b0b38b73e" category="paragraph">由于只有两个站点、因此无法使用任何类型的自动外部中断软件、这意味着强制切换必须手动操作。</block>
  <block id="568c8c12fdb7c74f65125732ee717ad3" category="section-title">三站点配置</block>
  <block id="2c7696fb04f52eb5687d059415066fa7" category="paragraph">使用三个站点构建扩展RAC集群更容易。托管MetroCluster系统一半的两个站点也支持数据库工作负载、而第三个站点则充当数据库和MetroCluster系统的断路器。Oracle TiebREAKER配置可能非常简单、只需将ASM磁盘组的一个成员放置在第三个站点上即可进行表决、也可能包括在第三个站点上运行的实例、以确保RAC集群中的节点数为奇数。</block>
  <block id="6265611ca77e9ad52249c5fdd4780da9" category="admonition">有关在扩展RAC配置中使用NFS的重要信息、请参阅Oracle文档中的"Quorum Failure group"(仲裁故障组)。总之、可能需要修改NFS挂载选项以包括软选项、以确保与托管仲裁资源的第三站点断开连接不会挂起主Oracle服务器或Oracle RAC进程。</block>
  <block id="d84d0eea463e72a6e15018c70a45af46" category="doc">Oracle、MetroCluster和NVFAIL</block>
  <block id="ee6c613c07239c0923d940dfd448493f" category="paragraph">NVFAIL是ONTAP中的一项常规数据完整性功能、对于数据库工作负载尤为重要。</block>
  <block id="9dc6a9986107298da2a22e7c5a3efb00" category="summary">基于MetroCluster的Oracle单个实例</block>
  <block id="f8b28e31633ae72c2971ee8b815ed4af" category="paragraph">如前所述、MetroCluster系统的存在并不一定会增加或更改数据库的任何最佳操作实践。客户MetroCluster系统上当前运行的大多数数据库都是单个实例、并遵循Oracle on ONTAP文档中的建议。</block>
  <block id="f4872c843923dd8d8731ef66462b5a99" category="paragraph">SyncMirror在灾难恢复站点提供数据的同步副本、但要使数据可用、需要使用操作系统和相关应用程序。基本自动化可以显著缩短整个环境的故障转移时间。通常会使用Veritas Cluster Server (VCS)等集群软件产品在各个站点之间创建集群、在许多情况下、可以使用简单的脚本来驱动故障转移过程。</block>
  <block id="c50820a41eb4f23d0a3acc1eeddb391b" category="paragraph">如果主节点丢失、则会将集群软件(或脚本)配置为在备用站点使数据库联机。一种方法是、创建为构成数据库的NFS或SAN资源预先配置的备用服务器。如果主站点发生故障、则集群软件或脚本化备用站点将执行一系列类似以下内容的操作：</block>
  <block id="2a6f458321ddf666cb0c876ee39255f3" category="list-text">挂载文件系统和/或挂载ASM磁盘组</block>
  <block id="3dee93bd9bc9b8b50dcdd2066a86009f" category="list-text">正在启动数据库</block>
  <block id="620515885465a26daea6cc6441403e34" category="paragraph">此方法的主要要求是在远程站点上运行操作系统。它必须预配置Oracle二进制文件、这也意味着必须在主站点和备用站点上执行Oracle修补等任务。或者、也可以将Oracle二进制文件镜像到远程站点、并在声明发生灾难时进行挂载。</block>
  <block id="edb5332feef69c0aa60ea10ed5d31a9f" category="list-text">手动启动数据库或将虚拟机配置为自动启动数据库、例如、ESX集群可以跨越多个站点。发生灾难时、可以在切换后将灾难恢复站点上的虚拟机置于联机状态。只要在发生灾难时托管虚拟化数据库服务器的数据存储库未在使用中、就不需要进行设置<block ref="3b93661df04b698b1340ff2da3238d16" prefix=" " category="inline-code"></block> 在关联卷上。</block>
  <block id="6c2e01aca4f10a83d34e3f3046435e82" category="summary">SnapMirror和SyncMirror</block>
  <block id="64bba30b717cb45555458da4fed880a1" category="paragraph">几乎每个应用程序都需要数据复制。</block>
  <block id="25fb1fa02f326334533a22c105ad3e69" category="paragraph">在最基本的层面上、复制可以是在异地存储的磁带上进行复制、也可以是应用程序级复制到备用位置。灾难恢复是指在服务发生灾难性丢失时使用这些副本使服务联机。</block>
  <block id="eab6cb3a1168ef2311865e6155b8272c" category="paragraph">ONTAP提供了多种复制选项、可在存储阵列中本机满足各种要求、从而满足各种需求。这些选项可以包括将备份简单地复制到远程站点、甚至可以复制到一个完全自动化的同步解决方案、从而在同一平台上提供灾难恢复和高可用性。</block>
  <block id="32df0c1cabf839652741a56bdaac7def" category="paragraph">适用于应用程序的主要ONTAP复制技术是NetApp SnapMirror和NetApp SyncMirror技术。这些不是附加产品、而是完全集成到ONTAP中、只需添加一个许可证密钥即可激活。存储级别复制也不是唯一的选项。应用程序级复制(例如使用Oracle DataGuard)还可以集成到基于ONTAP的数据保护策略中。</block>
  <block id="a2259fa074bae962e46ca7fc7aa31be1" category="paragraph">正确的选择取决于特定的复制、恢复和保留要求。</block>
  <block id="0d3b37ff5855bf299f3c4a154373c1e2" category="section-title">ONTAP SnapMirror</block>
  <block id="296e89e943f5160d338484b3b705a44e" category="paragraph">SnapMirror是NetApp异步复制解决方案、非常适合保护大型、复杂的动态数据集、例如数据库及其关联应用程序。其关键值如下：</block>
  <block id="d9f36dae2818ace926c4259271530724" category="list-text">*易管理性。* SnapMirror是存储软件的本机组成部分、易于配置和管理。不需要附加产品。复制关系只需几分钟即可建立、并可直接在存储系统上进行管理。</block>
  <block id="8f761eff026903aa0140319f597d1fb0" category="list-text">*精简性。*复制基于FlexVol卷、这些卷是LUN或文件的容器、作为一个一致的组进行复制。</block>
  <block id="8b737d6a9db3de6436966db508cb51d4" category="list-text">*效率。*建立初始复制关系后、仅复制更改。此外、重复数据删除和数据压缩等效率功能也会保留下来、从而进一步减少必须传输到远程站点的数据量。</block>
  <block id="0783dadb67ff77ed26bbfc5d80fa0cbd" category="list-text">*灵活性。*镜像可以暂时断开、以便测试灾难恢复过程、然后可以轻松地重新建立镜像、而无需进行完整的重新镜像。只需应用更改后的数据即可使镜像恢复同步。也可以反转镜像、以便在灾难结束且原始站点恢复使用后快速重新同步。最后、复制数据的读写克隆可用于测试和开发。</block>
  <block id="8a00f09d8937e890f2cfb4d7acf72733" category="paragraph">ONTAP提供多种不同的复制技术、但最灵活的是SnapMirror、这是一种卷到卷异步镜像选项。</block>
  <block id="80c8fae3d0b5dd100cc984d9ba3eced7" category="paragraph">如前所述、FlexVol卷是基于Snapshot的备份和基于SnapRestore的恢复的基本管理单元。FlexVol卷也是基于SnapMirror的复制的基本单元。第一步是建立源卷到目标卷的基线镜像。初始化此镜像关系后、所有后续操作都将仅基于对已更改数据的复制。</block>
  <block id="c1020b1755f65f23643158ce6a4d22cc" category="paragraph">从恢复角度来看、SnapMirror的关键值如下：</block>
  <block id="50bde20b37cd4d57fbff2b95f2f8ec97" category="list-text">SnapMirror操作易于理解、并且可以轻松实现自动化。</block>
  <block id="66162be45733f65fee4abb22e989eb78" category="list-text">只需更新SnapMirror副本即可、只需复制增量更改即可、从而降低了对带宽的需求、并允许更频繁地进行更新。</block>
  <block id="a3b4fbe416387a4991ccaa8b325a68be" category="list-text">SnapMirror具有高度粒度。它基于简单的卷到卷关系、可以创建数百个独立管理的副本并按复制间隔进行复制。复制不需要"一刀切"。</block>
  <block id="4e3785883ef3ccad9938d7e35e493057" category="list-text">镜像方向可以轻松反转、同时保留仅根据更改更新关系的能力。这样、在发生灾难(例如断电)后、主站点恢复正常运行后、便可提供快速故障恢复功能。只需将所做的更改同步回源。</block>
  <block id="8b8325381cf528eff12c1e678a3112f9" category="list-text">镜像可以轻松断开并高效地重新同步、以便预演灾难恢复过程。</block>
  <block id="b1f45b7d95bfc815351fb649fa94b671" category="list-text">在完整块级复制模式下运行的SnapMirror不仅可以复制卷中的数据、还可以复制快照。此功能可在灾难恢复站点上提供数据副本和一组完整备份。</block>
  <block id="ffafd9ae31dee51209961eb2453ac806" category="paragraph">在版本灵活模式下运行的SnapMirror允许复制特定快照、从而允许在主站点和二级站点上使用不同的保留时间。</block>
  <block id="974658d7ac018cb945e78365b0a760fb" category="section-title">SnapMirror 同步</block>
  <block id="ffbf9d0ce29a631b6eae8b22c41ec95e" category="paragraph">SnapMirror同步(SM-S)是对SnapMirror的一项增强功能、可提供RPO = 0的同步复制。它最常用于存储架构、在这些架构中、只有一部分数据需要同步镜像。</block>
  <block id="e8a45c4c0391895df78421904703c933" category="paragraph">SM-S可以在两种略有不同的模式下运行：Sync和StrictSync。</block>
  <block id="15a4e16195fb9d30c5df0e11df5c2166" category="paragraph">在Sync模式下、更改会在确认之前进行复制。这样可以保证RPO为零、只要复制正常运行即可。如果无法复制更改、SM-S可以退出同步模式并允许操作继续。这允许在正常情况下RPO = 0、但如果复制目标不可用、则数据进程不会完全暂停。</block>
  <block id="115455025d4664c0dd6deaaf3c1fc93c" category="paragraph">StrictSync可保证RPO = 0。无法复制更改会导致I/O错误、这通常会导致应用程序关闭。</block>
  <block id="1b1ea0d1ad6e5cfb06253a14fcdcfe71" category="inline-link">TR-4733</block>
  <block id="9ccd61d6efc86cc37743fdff385832e8" category="paragraph">有关SM-S的完整说明、请参见<block ref="4459b84726c651a8047a6486e87e48fb" category="inline-link-rx"></block> 以及ONTAP官方文档。新版本的ONTAP会不断增加功能。</block>
  <block id="6165c4352e1504dbaeef34d0cc50c187" category="section-title">一致性组</block>
  <block id="0651e813e385dbd62a9bca9baee23c6c" category="paragraph">ONTAP允许创建一致性组快照、从9.13.1开始、ONTAP可以将卷组(请记住、ONTAP术语中的卷不是LUN、而是由一个或多个文件或LUN组成的管理容器)复制为一致的组。</block>
  <block id="80c6d3e933105ad9a2c104ec78444b8c" category="paragraph">SnapMirror复制和中断CG SnapMirror关系可保持卷之间的一致性、而SnapMirror同步和SnapMirror业务连续性都可保持成分卷之间的一致性。</block>
  <block id="455c7758003d6ebd974e8858f5ef1d7d" category="paragraph">这样、您就可以复制多卷数据集、并确保所有卷都是交叉一致的。此外、这还允许"中断镜像并开始"灾难恢复操作、而无需执行其他应用程序或数据库恢复步骤。</block>
  <block id="c44a2da164b7b770fce6338a987670ee" category="section-title">MetroCluster和SyncMirror</block>
  <block id="b1a1cfbf3988d8abdfdedaabc1742ae9" category="paragraph">MetroCluster也是一种同步复制解决方案、适用于大规模任务关键型工作负载。复制基于SyncMirror。最简单的一层是、SyncMirror会在两个不同的位置创建两组受RAID保护的完整数据。它们可以位于数据中心内的相邻房间内、也可以相距数公里。</block>
  <block id="89b8adf28db7abb0febecafdca5871ad" category="paragraph">SyncMirror与ONTAP完全集成、在RAID级别以上运行。因此、所有常见的ONTAP功能(例如Snapshot副本、SnapRestore和NetApp FlexClone)均可无缝运行。它仍然是ONTAP、只是增加了一层同步数据镜像。</block>
  <block id="75c677fa68f5d15c17efbf6fd1fe1765" category="paragraph">管理SyncMirror数据的一组ONTAP控制器称为NetApp MetroCluster配置。MetroCluster的主要目的是、在各种典型故障情形和灾难恢复故障情形下、为同步镜像数据提供高可用性访问。</block>
  <block id="af845652f0234e1f71bc37e241ab63dc" category="paragraph">使用MetroCluster和SyncMirror进行数据保护的关键值如下：</block>
  <block id="9ab80c5e33e343c3415c21be433c4447" category="list-text">在正常操作中、SyncMirror可在不同位置之间提供有保障的同步镜像。写入操作只有在两个站点的非易失性介质上存在后才会得到确认。</block>
  <block id="680ccf94624c9f922ed236c8cc0c1af2" category="list-text">如果站点之间的连接发生故障、SyncMirror会自动切换到异步模式、以使主站点始终提供数据、直到连接恢复为止。还原后、它可以高效更新主站点上累积的更改、从而实现快速重新同步。不需要完全重新初始化。</block>
  <block id="c18ec55908c635b68abe8c6edbf6476e" category="paragraph">SnapMirror还与基于SyncMirror的系统完全兼容。例如、主数据库可能运行在分布在两个地理站点的MetroCluster集群上。此数据库还可以将备份作为长期归档复制到第三个站点、或者用于在DevOps环境中创建克隆。</block>
  <block id="0660b44d1a6d7e0d905c3fe28eef63ab" category="summary">基于ONTAP DR操作步骤的Oracle、具有日志传送功能</block>
  <block id="54bae719e8fa53582d5b2781b4952c6b" category="doc">通过日志重放实现灾难恢复</block>
  <block id="3a8111f0b903472ec78531619bf984f6" category="paragraph">Oracle数据库的复制过程与备份过程基本相同。主要要求是、必须将构成可恢复备份的快照复制到远程存储系统。</block>
  <block id="c62b3abab4fdbaf8f0a84e8c3559b5fd" category="paragraph">如前面有关本地数据保护的文档所述、可以使用热备份过程或利用针对快照优化的备份来创建可恢复的备份。</block>
  <block id="3d8f8c6a5c90bcd85a22fbd17390a864" category="inline-link-macro">数据布局</block>
  <block id="30394da99a39ca8264b8f7c0e6f679e0" category="paragraph">最重要的要求是将数据文件隔离到一个或多个专用卷中。它们必须未受任何其他文件类型的污染。其原因是、要确保数据文件复制完全独立于其他数据类型(如归档日志)的复制。有关文件布局的追加信息以及有关确保存储布局便于快照的重要详细信息、请参见  <block ref="5a4fdf6a1fc411e544cf6d70d47a8289" category="inline-link-macro-rx"></block>。</block>
  <block id="f3f227cc5c07a040d61c36679053a58a" category="paragraph">假设数据文件封装在专用卷中、下一个问题是如何管理重做日志、归档日志和控制文件。最简单的方法是将所有这些数据类型放在一个卷中。这样做的好处是、复制的重做日志、归档日志和控制文件可以实现完美同步。不要求恢复不完整或使用备份控制文件、但对于其他可能的恢复场景、可能还需要使用脚本创建备份控制文件。</block>
  <block id="927992cbeccc8211e382c97e81514ef9" category="section-title">双卷布局</block>
  <block id="fe1cf96940a710dc95fd30bbb7533b52" category="paragraph">下图显示了最简单的布局。</block>
  <block id="57f1db4bdf2ce49a98f375d8393f02bf" category="paragraph">这是最常见的方法。从数据库管理角度来看、将重做日志和归档日志的所有副本放在同一个卷上似乎并不常见。但是、如果文件和LUN仍都位于同一个底层驱动器集上、则隔离不会提供太多额外保护。</block>
  <block id="bc46e4831ef5654d084e456c4c544a42" category="section-title">三卷布局</block>
  <block id="f6e969769d9d166122489505d676769b" category="paragraph">有时、由于数据保护问题或需要在控制器之间分布重做日志I/O、需要分离重做日志。如果是、则下图所示的三卷布局将用于复制、同时仍然避免执行不完整的恢复或依赖备份控制文件的任何要求。</block>
  <block id="4957c2feaa2cb72d80a0ab65228ad43f" category="paragraph">这样、可以在源上的一组独立磁盘轴和控制器之间对重做日志和控制文件进行条带化。但是、归档日志以及一组控制文件和重做日志仍可与归档日志同步进行复制。</block>
  <block id="39128da64bc55500b4b11391aa54a011" category="paragraph">在此模型中、不会复制重做日志B卷。</block>
  <block id="c0ce858e99375deac8274c96b7e5d0ee" category="section-title">灾难恢复过程—热备份</block>
  <block id="6993729228512b7e23e3ff3ec9099f33" category="paragraph">要使用热备份执行灾难恢复、请使用以下基本操作步骤：</block>
  <block id="ee68e5b99222bbc29a480fcb0d1d6ee2" category="section-title">前提条件</block>
  <block id="41bde9c586a860264c425700c48bd375" category="list-text">Oracle二进制文件安装在灾难恢复服务器上。</block>
  <block id="cebf7cec81152da2cadffd580d81937f" category="list-text">中列出了数据库实例<block ref="2c0b0433aa1c96a2be6f40d9e71bc6af" prefix=" " category="inline-code"></block>。</block>
  <block id="17f8e5eda67237f2ca94c7dcce3e4022" category="list-text">。<block ref="76a2173be6393254e72ffa4d6df1030a" prefix=" " category="inline-code"></block> 和<block ref="6b2f852f7f63f2e5d4be597bbca97bb6" prefix=" " category="inline-code"></block> 或<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 实例必须位于中<block ref="45c7302d9c2e8745b3a2bff0f992b6df" prefix=" " category="inline-code"></block> 目录。。</block>
  <block id="645a84975202e30700b572b49a5ee29d" category="section-title">灾难恢复</block>
  <block id="25d18766964d7515e1f5acd893094f6e" category="list-text">中断数据文件和通用日志卷的镜像。</block>
  <block id="8fc655e4752d521563db3bfa138ba62e" category="list-text">将数据文件卷还原到数据文件的最新热备份快照。</block>
  <block id="68a9c75816a16f6d4f7572fe287961bf" category="list-text">如果使用SAN、请激活卷组和/或挂载文件系统。</block>
  <block id="312007510a0f0dc7878d4ed6a7a01554" category="list-text">将归档日志重放至所需位置。</block>
  <block id="e54b793d8bfa83bbb1bd965992c3474e" category="list-text">如果需要完全恢复、则重放当前重做日志。</block>
  <block id="72e5734d53581f86093de5c97d8a3a24" category="paragraph">使用NFS可以显著简化操作步骤、因为数据文件和日志文件的NFS文件系统可以随时挂载到灾难恢复服务器上。镜像中断后、它将变为读/写状态。</block>
  <block id="de4735bc5bbfdcae3d690313c739ad67" category="section-title">灾难恢复过程—针对快照优化的备份</block>
  <block id="6b2b8ef11e5ded8a083372ba49d488d2" category="paragraph">从快照优化的备份中恢复与热备份恢复操作步骤几乎相同、但进行了以下更改：</block>
  <block id="af1e49e7bc2b25ce36bd93df09433fb4" category="list-text">将数据文件卷还原到当前日志卷副本之前创建的快照。</block>
  <block id="5e09669c98226c5d3a748f7e0f0333ad" category="paragraph">这些差异简化了整体恢复操作步骤、因为无需确保在数据库处于热备份模式时在源上正确创建快照。灾难恢复操作步骤基于灾难恢复站点上快照的时间戳。创建快照时数据库的状态并不重要。</block>
  <block id="81d6beef7eaf28bbce692d4b59888f3e" category="section-title">使用热备份快照进行灾难恢复</block>
  <block id="dc711b77f0d6a9c9ccf88b424509440a" category="paragraph">这是一个基于热备份快照复制的灾难恢复策略示例。它还可以作为简单且可扩展的本地备份策略的示例。</block>
  <block id="edaef18e1c956b9284405fd664c4ca4a" category="paragraph">示例数据库位于基本的双卷架构上。<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 包含数据文件和<block ref="894db1fc1592356880976f1b92c3e6a2" prefix=" " category="inline-code"></block> 用于合并的重做日志、归档日志和控制文件。</block>
  <block id="fc0e7b6cd7cd15929987b1429d1c3a7e" category="paragraph">需要两个计划、一个用于每晚数据文件备份、另一个用于日志文件备份。分别称为午夜和15分钟。</block>
  <block id="44c0956347a70c78d2124c1041321049" category="paragraph">然后、在快照策略中使用这些计划<block ref="44dc83cda2d6b3ce99cc25803e824061" prefix=" " category="inline-code"></block> 和<block ref="9b055600529d69c4ae0d2a9408dc7aa3" prefix=" " category="inline-code"></block>，如下所示：</block>
  <block id="180e86b8e3c5049779c98c2c1006bb15" category="paragraph">最后、这些快照策略将应用于卷。</block>
  <block id="2887f2c14c7efbc97d53ac2f914c5657" category="paragraph">此选项用于定义卷的备份计划。数据文件快照在午夜创建并保留60天。日志卷包含72个以15分钟为间隔创建的快照、这些快照的覆盖时间最长可达18小时。</block>
  <block id="e1e5ef0e7100311d950b4ffebe040670" category="paragraph">然后、确保在创建数据文件快照时数据库处于热备份模式。这可通过一个小脚本来完成、该脚本接受一些基本参数、用于在指定SID上启动和停止备份模式。</block>
  <block id="683cdd7abd993faf3ace355cd6870b6f" category="paragraph">此步骤可确保数据库在围绕午夜快照的四分钟窗口内处于热备份模式。</block>
  <block id="ccff7eb3ad0059a184886709c87f4889" category="paragraph">复制到灾难恢复站点的配置如下：</block>
  <block id="42d3752a745fb0cdae528f6cc425b569" category="paragraph">日志卷目标每15分钟更新一次。这样可实现大约15分钟的RPO。根据更新期间必须传输的总数据量、确切的更新间隔略有不同。</block>
  <block id="e272424001d72919ad498e0e9d3c2cc4" category="paragraph">数据文件卷目标每六小时更新一次。这不会影响RPO或RTO。如果需要进行灾难恢复、首先要做的一个步骤是将数据文件卷还原回热备份快照。更新间隔更频繁的目的是使此卷的传输速率保持平稳。如果计划每天更新一次、则必须立即传输当天累积的所有更改。更新频率越高、所做的更改就会在一天中逐渐复制。</block>
  <block id="ce176ff569d716c1fa73d0754aba684b" category="paragraph">如果发生灾难、第一步是中断两个卷的镜像：</block>
  <block id="4b9cdb6e2096c0828aeccd2ee5eecf42" category="paragraph">副本现在为读写副本。下一步是验证日志卷的时间戳。</block>
  <block id="b4d461e48f5be5d08f677045d11e8200" category="paragraph">日志卷的最新副本是3月14日13：30：00。</block>
  <block id="96f75a4b63f4377efdf64d571d71caec" category="paragraph">接下来、确定在日志卷的状态之前创建的热备份快照。这是必需的、因为日志重放过程需要在热备份模式下创建所有归档日志。因此、日志卷副本必须早于热备份映像、否则不会包含所需的日志。</block>
  <block id="d358e4eb10a2f4e0b591e16941d7782c" category="paragraph">最近创建的快照为<block ref="c001e27abf0e66d13790bb8a7e00da54" prefix=" " category="inline-code"></block>。这是数据文件的最新热备份映像、然后按如下所示进行还原：</block>
  <block id="d2037035a976c9be71cf6f372300c8c3" category="paragraph">在此阶段、数据库现已准备好进行恢复。如果是SAN环境、下一步将包括激活卷组和挂载文件系统、这是一个轻松自动化的过程。由于此示例使用的是NFS、因此文件系统已挂载并变为读写状态、在镜像中断后不再需要挂载或激活。</block>
  <block id="2edce22eade45b42bc6b2665057fa082" category="paragraph">现在、可以将数据库恢复到所需的时间点、也可以根据所复制的重做日志副本将其完全恢复。此示例说明了归档日志、控制文件和重做日志卷的组合值。恢复过程显著简化、因为无需依赖备份控制文件或重置日志文件。</block>
  <block id="51f74a82c7125b3b288755b6668091b1" category="section-title">使用针对快照优化的备份进行灾难恢复</block>
  <block id="3680a4757ddad43934237ab6a0ca955c" category="paragraph">使用针对快照优化的备份的灾难恢复操作步骤与热备份灾难恢复操作步骤几乎相同。与热备份快照操作步骤一样、它也是本地备份架构的基本扩展、在该架构中、备份会进行复制以用于灾难恢复。以下示例显示了详细的配置和恢复操作步骤。此示例还说明了热备份与针对快照优化的备份之间的主要差异。</block>
  <block id="330dadae5e2585726f41ed1f90e88f9f" category="paragraph">示例数据库位于基本的双卷架构上。<block ref="f006bf17b06c884c47190c4225d3215a" prefix=" " category="inline-code"></block> 包含数据文件、和<block ref="894db1fc1592356880976f1b92c3e6a2" prefix=" " category="inline-code"></block> 用于合并的重做日志、归档日志和控制文件。</block>
  <block id="1669f47e046ce7e069e9d143f42e025d" category="paragraph">需要两个计划：一个用于每晚数据文件备份、一个用于日志文件备份。分别称为午夜和15分钟。</block>
  <block id="ef4adcab3e9bd572d0670f9f2073c311" category="paragraph">此选项用于控制卷的最终备份计划。快照在午夜创建并保留60天。日志卷包含72个以15分钟为间隔创建的快照、这些快照的覆盖时间最长可达18小时。</block>
  <block id="f9d5149b630a43ff5996adc26c6e1f08" category="paragraph">日志卷目标每15分钟更新一次。这样可以实现大约15分钟的RPO、精确更新间隔略有不同、具体取决于更新期间必须传输的总数据量。</block>
  <block id="992398ebd9e9f825f0aa4415519abdba" category="paragraph">数据文件卷目标每6小时更新一次。这不会影响RPO或RTO。如果需要灾难恢复、则必须先将数据文件卷还原回热备份快照。更新间隔更频繁的目的是使此卷的传输速率保持平稳。如果计划每天更新一次、则必须立即传输当天累积的所有更改。更新频率越高、所做的更改就会在一天中逐渐复制。</block>
  <block id="9e85b8590ac2f9ff5ebc8d1def51ae82" category="paragraph">如果发生灾难、第一步是中断所有卷的镜像：</block>
  <block id="fd2834dcadb39f00eb897fdcdc07a03d" category="paragraph">日志卷的最新副本是3月14日13：30。接下来、确定在日志卷状态之前创建的数据文件快照。这是必需的、因为日志重放过程需要从快照之前到所需恢复点的所有归档日志。</block>
  <block id="810e47566b9cd5aa3b28e6514ec95735" category="paragraph">最近创建的快照为<block ref="c001e27abf0e66d13790bb8a7e00da54" prefix=" " category="inline-code"></block>。还原此快照。</block>
  <block id="87d83a0406ac6622efcdf91c42784ecd" category="paragraph">数据库现在可以恢复了。如果是SAN环境、则可以激活卷组并挂载文件系统、这是一个轻松自动化的过程。但是、此示例使用的是NFS、因此文件系统已挂载并变为读写状态、不再需要在镜像中断后挂载或激活。</block>
  <block id="7a2e97f17454be76b7e522ce612ff961" category="paragraph">现在、可以将数据库恢复到所需的时间点、也可以根据所复制的重做日志副本将其完全恢复。此示例说明了归档日志、控制文件和重做日志卷的组合值。恢复过程显著简化、因为不需要依赖备份控制文件或重置日志文件。</block>
  <block id="d6597945276340ba33115e737eb4b489" category="summary">Oracle数据库的一致性组复制</block>
  <block id="fc506ae4ea109f50758acc176bcb5341" category="doc">一致性组灾难恢复</block>
  <block id="5eda890cc07e4b7cd409730d8af8ddc3" category="paragraph">一致性组复制可以像通过SnapMirror计划复制单个卷一样简单。这包括数据文件、控制文件、归档日志和重做日志。每次SnapMirror更新都会在目标站点生成一个新的数据库副本、该副本保持一致、并可通过中断镜像来激活。</block>
  <block id="89cb1432594ce7c25dadf229401874e7" category="paragraph">如果数据库必须跨越多个卷、则需要一致性组快照(CG快照)。</block>
  <block id="f96b125d1bacc785389957041be148e9" category="paragraph">在块级复制模式下与SnapMirror结合使用时、此策略的另一个优势是、可以完全复制源存储系统上的所有快照。除了灾难恢复副本之外、还会复制完整的备份副本。</block>
  <block id="77fda44088666155052f9d4224878cbc" category="summary">Oracle归档日志层</block>
  <block id="113d9dffdeb8fa14877fc8cf8ca7c9d5" category="doc">Oracle日志层</block>
  <block id="8625af69ad0b5f76799d87df777e3c86" category="paragraph">FabricPool最重要的用途或许是提高已知冷数据(如数据库事务日志)的效率。</block>
  <block id="a98d546484d238b37b7e2584ae8d399d" category="summary">Oracle备份层</block>
  <block id="9f409a250e4be99904c9e90259cb747d" category="paragraph">传统应用程序备份包括Oracle Recovery Manager等产品、这些产品可在原始数据库位置之外创建基于文件的备份。</block>
  <block id="6cddb309df5eb8791dc990f72ef2deb2" category="summary">Oracle分层策略</block>
  <block id="7ba3322dbc0b3c33a66f1963e80b7a2a" category="doc">Oracle数据库分层策略</block>
  <block id="4627801bdbb24a1991e64f30a2d80cb1" category="paragraph">ONTAP提供了四个策略、用于控制性能层上的Oracle数据如何成为重新定位到容量层的候选对象。</block>
  <block id="47f6817eca23122cc683f7c2759e6ecb" category="summary">Oracle完整图块层</block>
  <block id="1def0ac22a738b54cce584e969065918" category="doc">Oracle完整文件层</block>
  <block id="2eea2725f31529888b5e57b36492819f" category="paragraph">虽然FabricPool分层在块级运行、但在某些情况下、可用于提供文件级分层。</block>
  <block id="468853d9ed2134af17ede5fd165a8dff" category="summary">使用FabricPool进行部分文件分层</block>
  <block id="5638b2f30ee966b3ff84bac350092971" category="doc">Oracle部分文件分层</block>
  <block id="f935a501eae76f9c13d430bc3879cd0d" category="paragraph">由于FabricPool在块级别工作、因此可能会更改的文件可以部分分层到对象存储、同时也可以部分保留在性能层上。</block>
  <block id="dd22ff2cf158f98efbd92f4522b3064b" category="summary">对象存储访问中断期间的数据库访问</block>
  <block id="cc4e17c26faf6b70b383529b6215ba0f" category="doc">对象存储访问中断</block>
  <block id="bbb21240a2cc48eb7a229ec824e70cdf" category="summary">《采用FabricPool的Oracle的层管理概述》</block>
  <block id="ec2ffb259f21d115e5481eb0f215aa0d" category="doc">Oracle层概述</block>
  <block id="ec35a176f3e7c086273baee0c7f374d5" category="paragraph">要了解FabricPool层如何影响Oracle和其他数据库、需要了解低级别FabricPool架构。</block>
  <block id="cd6b77e4d343896571bc445479f24588" category="summary">Pr神奇 分层检索策略</block>
  <block id="3bf6f5a455b1889775d79713ad4e19ed" category="doc">检索策略</block>
  <block id="6edf1821ddc55278229c2156f42905f0" category="paragraph">分层策略用于控制将哪些Oracle数据库块从性能层分层到容量层。检索策略控制读取已分层的块时发生的情况。</block>
  <block id="95ab96ac5aaeae15f7b499d0fa0313cf" category="summary">Oracle快照层</block>
  <block id="d01cbb2be77343ccdb1d3372c4b9891e" category="summary">Oracle数据库LUN大小调整和LUN计数准则</block>
  <block id="b9e88e2eb3d5eef807fc42db706d866a" category="doc">Oracle LUN规模估算和LUN计数</block>
  <block id="51f96d1f8b50084e3a2ddc21ceef8b2f" category="paragraph">要获得Oracle数据库的最佳性能和易管理性、选择最佳LUN大小和要使用的LUN数量至关重要。</block>
  <block id="3d1bd23e74923cdc48fe992d0687809f" category="summary">Oracle数据库和NFS租用和锁定</block>
  <block id="472f36eb81330c2c27f02245ce8a911e" category="doc">NFS租用和锁定—Oracle</block>
  <block id="cec6f8a988408ba212798e1cc32658c7" category="paragraph">NFSv3处于无状态。这实际上意味着、NFS服务器(ONTAP)不会跟踪挂载了哪些文件系统、由谁挂载或哪些锁定真正到位。</block>
  <block id="7c96331bd03e63c4eb3505c526b42244" category="paragraph">ONTAP确实具有一些记录挂载尝试的功能、因此您可以了解哪些客户端可能正在访问数据、并且可能存在建议锁定、但该信息并不能保证100%完整。此操作无法完成、因为跟踪NFS客户端状态不是NFSv3标准的一部分。</block>
  <block id="20733ad7135aa0ede95fd8637fe05cf6" category="section-title">NFSv4状态</block>
  <block id="3f7c11f662fc6e07a91179fdf2322ef5" category="paragraph">相反、NFSv4是有状态的。NFSv4服务器可跟踪哪些客户端正在使用哪些文件系统、哪些文件存在、哪些文件和/或文件区域被锁定等 这意味着NFSv4服务器之间需要定期进行通信、以使状态数据保持最新。</block>
  <block id="6f7e4a1e570f45fa3db0b8a0ed80a38f" category="paragraph">NFS服务器所管理的最重要状态是NFSv4锁定和NFSv4租约、它们彼此交织在一起。您需要了解每种方法本身的工作原理、以及它们之间的关系。</block>
  <block id="0d55fd4062f29237d0fb3b7f666fb8eb" category="section-title">NFSv4锁定</block>
  <block id="bf4139ff42e411ae5483e062387b3f70" category="paragraph">对于NFSv3、建议使用锁定。NFS客户端仍可修改或删除"锁定"文件。NFSv3锁定本身不会过期、必须将其删除。这会造成问题。例如、如果您有一个集群应用程序创建了NFSv3锁定、而其中一个节点发生故障、您该怎么办？您可以对运行正常的节点上的应用程序进行编码、以解除锁定、但您如何知道这是安全的？可能是"故障"节点正常运行、但未与集群的其余部分通信？</block>
  <block id="11d1c33ac6b190a233c00cdbdd6a355b" category="paragraph">对于NFSv4、锁定的持续时间有限。只要持有锁定的客户端继续向NFSv4服务器签入、就不允许任何其他客户端获取这些锁定。如果客户端无法签入NFSv4、则锁定最终会被服务器撤消、其他客户端将能够请求并获取锁定。</block>
  <block id="c17985911e0182dc5e96c4d60aadf139" category="section-title">NFSv4租约</block>
  <block id="596bcfef3aaccfe299bb45a969afcaf0" category="paragraph">NFSv4锁定与NFSv4租约关联。当NFSv4客户端与NFSv4服务器建立连接时、它将获得租约。如果客户端获得锁定(锁定类型有多种)、则锁定与租约关联。</block>
  <block id="b5248856b1835e14738aa32e053e30e0" category="paragraph">此租约已定义超时。默认情况下、ONTAP会将超时值设置为30秒：</block>
  <block id="7e2a66190f452806ac1183721a43eaa1" category="paragraph">这意味着、NFSv4客户端需要每30秒与NFSv4服务器签入一次、才能续订其租约。</block>
  <block id="809c552ae0a4d377e87f495b4e3ac62b" category="paragraph">任何活动都会自动续订租约、因此、如果客户端正在执行工作、则无需执行添加操作。如果某个应用程序变得安静并且没有执行实际工作、则需要执行某种保活操作(称为序列)。基本上只是说"我还在这里、请刷新我的租约"。</block>
  <block id="70cb78bb7e91dcafab559f9b72e40bb6" category="paragraph">NFSv3处于无状态。它不需要来自客户端的通信。NFSv4是有状态的、租赁期过后、租约将过期、锁定将被撤消、锁定的文件将提供给其他客户端使用。</block>
  <block id="2ee5d81cfa6306ae71ce534ed9b31431" category="paragraph">借助NFSv3、您可以四处移动网络缆线、重新启动网络交换机、更改配置、并确保不会发生任何不良事件。应用程序通常只需耐心等待网络连接重新工作即可。</block>
  <block id="8900ff182e4197f8eb2acd7d2b7fd902" category="paragraph">使用NFSv4时、您有30秒的时间(除非您已在ONTAP中增加了该参数的值)来完成工作。如果超过此限制、您的租约将超时。通常、这会导致应用程序崩溃。</block>
  <block id="ffa8c7744b3e2d43b18c67aec0fe7743" category="paragraph">例如、如果您有一个Oracle数据库、并且网络连接丢失(有时称为"网络分区")、超过租约超时时间、则数据库将崩溃。</block>
  <block id="33b9897348039594b4b17bf1e1629c74" category="paragraph">下面是一个示例、说明在发生这种情况时Oracle警报日志中会发生什么情况：</block>
  <block id="85608585bf8e790a579c49ba9af705c6" category="paragraph">如果您查看系统日志、应会看到以下几个错误：</block>
  <block id="e19b338de53dada4cf4da3837aaba76d" category="paragraph">日志消息通常是问题的第一个迹象、而不是应用程序冻结。通常、网络中断期间不会显示任何内容、因为尝试访问NFS文件系统的进程和操作系统本身会被阻止。</block>
  <block id="7a3c8c17a9dd10fa565f79e0ebb5bba7" category="paragraph">网络重新正常运行后、将显示这些错误。在上面的示例中、重新建立连接后、操作系统尝试重新获取锁定、但太晚了。租约已过期、锁定已被删除。这会导致错误传播到Oracle层、并在警报日志中显示此消息。根据数据库的版本和配置、这些模式可能会有所不同。</block>
  <block id="4bec5e793e34a5819aefb68e4f65db26" category="paragraph">总之、NFSv3可以承受网络中断、但NFSv4更敏感、并会规定一个明确的租赁期限。</block>
  <block id="069de2d717910b2677190b9a9b5ed1cf" category="paragraph">如果30秒超时不可接受、该怎么办？如果您管理的网络动态变化、交换机重新启动或缆线重新定位会导致网络偶尔中断、该怎么办？您可以选择延长租赁期限、但是否要延长、需要说明NFSv4宽限期。</block>
  <block id="4b84416146795544deb5c9de89187f91" category="section-title">NFSv4宽限期</block>
  <block id="7d98e091c5f7be92cd5fb85b985d8d20" category="paragraph">如果重新启动NFSv3服务器、它几乎可以立即提供IO。它并没有保持任何关于客户的状态。这样、ONTAP接管操作通常看起来接近瞬时。一旦控制器准备好开始提供数据、它就会向网络发送一个ARP、以指示拓扑发生变化。客户端通常会近乎即时地检测到这一点、数据将恢复流动。</block>
  <block id="173d4fd05086441236dbee4710639d10" category="paragraph">但是、NFSv4会短暂暂停。这只是NFSv4工作原理的一部分。</block>
  <block id="21483115213b27583a07dc2ca994671c" category="paragraph">NFSv4服务器需要跟踪租约、锁定以及谁在使用哪些数据。如果NFS服务器发生故障并重新启动、断电片刻或在维护活动期间重新启动、则会导致租用/锁定以及其他客户端信息丢失。在恢复操作之前、服务器需要确定哪个客户端正在使用哪些数据。这就是宽限期的所在。</block>
  <block id="09b6f386094bd895d3c9694f28bfdf65" category="paragraph">如果您突然关闭并重新启动NFSv4服务器。恢复后、尝试恢复IO的客户端将收到一个响应、该响应本质上说："我丢失了租用/锁定信息。是否要重新注册您的锁？" 这是宽限期的开始。在ONTAP上、默认为45秒：</block>
  <block id="e4f8aa90af36d76254e2f02e56232aed" category="paragraph">因此、在重新启动后、控制器将暂停IO、而所有客户端都将回收其租约和锁定。宽限期结束后、服务器将恢复IO操作。</block>
  <block id="bb2b26fdcb4e947cda6f8e38724ecfc9" category="section-title">租赁超时与宽限期</block>
  <block id="563494d7f0f6ebcb6698cac7f9705aaa" category="paragraph">宽限期和租赁期是连接的。如上所述、默认租约超时为30秒、这意味着NFSv4客户端必须至少每30秒向服务器签入一次、否则它们将失去租约、进而失去锁定。有一个宽限期、允许NFS服务器重建租用/锁定数据、默认为45秒。ONTAP要求宽限期比租赁期长15秒。这样可以确保设计为至少每30秒续订一次租约的NFS客户端环境能够在重新启动后与服务器签入。45秒的宽限期可确保所有希望至少每30秒续订一次租约的客户都有机会续订租约。</block>
  <block id="5e6b60906bbbb9a41b140c0749591489" category="paragraph">如果不接受30秒的超时时间、您可以选择延长租赁期限。如果要将租约超时时间增加到60秒、以承受60秒网络中断、则必须将宽限期至少增加到75秒。ONTAP要求该期限比租赁期高15秒。这意味着、在控制器故障转移期间、IO暂停时间将更长。</block>
  <block id="4611c7c931fc15a6feba513fe72e22de" category="paragraph">这通常不会是问题。通常、用户每年只更新ONTAP控制器一次或两次、并且很少会因硬件故障而发生计划外故障转移。此外、如果您的网络可能会发生60秒的网络中断、并且您需要将租赁超时时间设置为60秒、则可能不会反对偶尔发生的存储系统故障转移、从而导致75秒的暂停。您已确认您的网络经常暂停60秒以上。</block>
  <block id="c4fb6f7d31d205bc07dbff47d0ae4bb3" category="summary">Oracle Direct NFS</block>
  <block id="f58bdad9659176e411f064fdb414233f" category="doc">Oracle (Oracle)</block>
  <block id="1bd6ec1185ba67395dc6f9cd2b458ec8" category="paragraph">Oracle数据库可以通过两种方式使用NFS。</block>
  <block id="96997ca5c577dd19a3ba5f7ff771f27a" category="paragraph">首先、它可以使用通过操作系统中的本机NFS客户端挂载的文件系统。这有时称为内核NFS或kNFS。Oracle数据库挂载和使用NFS文件系统的方式与任何其他应用程序使用NFS文件系统的方式完全相同。</block>
  <block id="95c17c63df7ceea39a175b1d96955bb7" category="paragraph">第二种方法是Oracle Direct NFS (DNFS)。这是在Oracle数据库软件中实施的NFS标准。它不会更改数据库管理程序配置或管理Oracle数据库的方式。只要存储系统本身具有正确的设置、DNFS的使用就应该对DBA团队和最终用户透明。</block>
  <block id="43539d2fca21e5b644484efb94614a7b" category="paragraph">启用了DNFS功能的数据库仍会挂载常见的NFS文件系统。数据库打开后、Oracle数据库将打开一组TCP/IP会话并直接执行NFS操作。</block>
  <block id="26e7ebad3936387b4b3f7c4f5688ef27" category="section-title">直接NFS</block>
  <block id="6d431a52c8a41a7c2335f98e2ae8c454" category="paragraph">Oracle的直接NFS的主要价值是绕过主机NFS客户端、直接在NFS服务器上执行NFS文件操作。要启用此功能、只需更改Oracle磁盘管理器(ODM)库即可。Oracle文档提供了此过程的说明。</block>
  <block id="8401d91735209aeccbe56f33b4e2db73" category="paragraph">使用DNFS可以显著提高I/O性能、并减少主机和存储系统上的负载、因为I/O是以尽可能最高效的方式执行的。</block>
  <block id="b0dedecb00787180a9e0c657cfb278c9" category="paragraph">此外，Oracle DNFS还包括一个*选项*，用于实现网络接口多路径和容错。例如、可以将两个10 Gb接口绑定在一起、以提供20 Gb的带宽。一个接口发生故障会导致在另一个接口上重试I/O。整体操作与FC多路径非常相似。多路径早在几年前就已很常见、当时1 Gb以太网是最常用的标准。10 Gb NIC足以满足大多数Oracle工作负载的需求、但如果需要更多NIC、则可以绑定10 Gb NIC。</block>
  <block id="11e50b3c816105439151db3a3b4fdda3" category="paragraph">使用DNFS时、请务必安装Oracle文档1495104.1中所述的所有修补程序。如果无法安装修补程序、则必须对环境进行评估、以确保该文档中所述的错误不会出现发生原因问题。在某些情况下、无法安装所需的修补程序会导致无法使用DNFS。</block>
  <block id="8f98002fee392ad6151679875de1a7cc" category="paragraph">请勿将DNFS与任何类型的轮叫名称解析结合使用、包括DNS、DDNS、NIS或任何其他方法。其中包括ONTAP中提供的DNS负载平衡功能。当使用DNFS的Oracle数据库将主机名解析为IP地址时、它在后续查找中不得更改。这可能会导致Oracle数据库崩溃并可能导致数据损坏。</block>
  <block id="e80ad3efb180dc2d016b27506b7b24ce" category="section-title">直接NFS和主机文件系统访问</block>
  <block id="4c38a8c0a49e721bf2a378d0b4fb2010" category="paragraph">对于依赖主机上挂载的可见文件系统的应用程序或用户活动、使用DNFS有时可能会出现发生原因问题、因为DNFS客户端会从主机操作系统带外访问文件系统。DNFS客户端可以在不了解操作系统的情况下创建、删除和修改文件。</block>
  <block id="c03389fdb295f2acb079603123e6d0e3" category="paragraph">如果使用单实例数据库的挂载选项、则可以缓存文件和目录属性、这也意味着可以缓存目录的内容。因此、DNFS可以创建文件、在操作系统重新读取目录内容和文件对用户可见之前、存在一个短暂的延迟。这通常不是问题，但在极少数情况下，SAP BR*Tools等实用程序可能会出现问题。如果发生这种情况、请更改挂载选项以使用针对Oracle RAC的建议来解决此问题。此更改会导致禁用所有主机缓存。</block>
  <block id="a370a203383b565c3fb746c1c2e1a64b" category="paragraph">只有在以下情况下才更改挂载选项：(a)使用DNFS；(b)问题是由于文件可见性滞后而导致的。如果未使用DNFS、则在单实例数据库上使用Oracle RAC挂载选项会导致性能下降。</block>
  <block id="b1ced01e4bbcd95ec43a2756131f8f9d" category="admonition">请参见有关的注释<block ref="4740c034d97ca90a96b8050082816605" prefix=" " category="inline-code"></block> 在中 <block ref="657185beb26ec14433f7e083717fa98b" category="inline-link-macro-rx"></block> 适用于可能会产生异常结果的Linux专用DNFS问题描述。</block>
  <block id="22a7a03175addfd9aa5b1fa2c351e833" category="summary">适用于Oracle数据库的NFS配置</block>
  <block id="6cb2edd2369a17890dce007723d98a6f" category="paragraph">NetApp提供企业级NFS存储已超过30年、由于其精简性、随着向基于云的基础架构的推进、其使用量也在不断增长。</block>
  <block id="95e0ac965f4d3a739263ba13584b6411" category="inline-link-macro">TR-4067：《基于NetApp ONTAP的NFS最佳实践》</block>
  <block id="c46e4d65876bc5d9253e8e293f59b613" category="paragraph">NFS协议包含多个版本、但要求各不相同。有关使用ONTAP的完整NFS配置问题描述、请参见 <block ref="e3fa0577f1d5ea8870d93a30eb76667f" category="inline-link-macro-rx"></block>。以下各节介绍了一些更关键的要求和常见的用户错误。</block>
  <block id="0f8a941fcc56687ad8e3914162c19a41" category="section-title">NFS版本</block>
  <block id="d0972be450ccf257fb73d4878bce204e" category="paragraph">NetApp必须支持操作系统NFS客户端。</block>
  <block id="7722a2ae10cef9bccea115dfdfe78a99" category="list-text">遵循NFSv3标准的操作系统支持NFSv3。</block>
  <block id="a3550edc6962850398d217f78cc4ad0d" category="list-text">Oracle DNFS客户端支持NFSv3。</block>
  <block id="89c45ebba54478419aa679a7ece8593d" category="list-text">遵循NFSv4标准的所有操作系统均支持NFSv4。</block>
  <block id="471ff51c89daf6e35e8e2b5111039744" category="inline-link-macro">NetApp IMT</block>
  <block id="8594659e8c4292db778973052a30ab86" category="list-text">NFSv4.1和NFSv4.2需要特定的操作系统支持。请参见 <block ref="d98f827de8e80b3365d5f4160c243cdc" category="inline-link-macro-rx"></block> 支持的操作系统。</block>
  <block id="d1eb4c2a4d74705a5aa7945f734eff7c" category="list-text">为NFSv4.1提供Oracle DNFS支持需要Oracle 12.2.0.2或更高版本。</block>
  <block id="d8bacc1a7a9d6baaeb962e367920593b" category="inline-link-macro">NetApp支持表</block>
  <block id="f16dcce07ca44aa38c7ebe3016b981b2" category="admonition">。 <block ref="f1e4f72fb4419d4270270c5ed1e0d9f6" category="inline-link-macro-rx"></block> 对于NFSv3和NFSv4、不包括特定的操作系统。通常支持所有符合RFC的操作系统。在联机IMT中搜索NFSv3或NFSv4支持时、请勿选择特定操作系统、因为不会显示任何匹配项。常规策略隐式支持所有操作系统。</block>
  <block id="26ed9768d6a659a9768842d903d0025f" category="section-title">Linux NFSv3 TCP插槽表</block>
  <block id="c56ec9836fbbd9c0a426a40fc71c265c" category="paragraph">TCP插槽表相当于主机总线适配器(Host Bus Adapter、HBA)队列深度的NFSv3。这些表可控制任何时候都可以处理的NFS操作的数量。默认值通常为16、该值太低、无法实现最佳性能。在较新的Linux内核上会出现相反的问题、这会自动将TCP插槽表限制增加到使NFS服务器充满请求的级别。</block>
  <block id="5270700baa50d07af667096293a27564" category="paragraph">为了获得最佳性能并防止出现性能问题、请调整控制TCP插槽表的内核参数。</block>
  <block id="5b29db1d99e19013580fa375a5f87fa5" category="paragraph">运行<block ref="1a1e44f7a3390ed4647a7d5b7e8b08ed" prefix=" " category="inline-code"></block> 命令、并观察以下参数：</block>
  <block id="8821adf56df4952370cfaa57ccaac68d" category="paragraph">所有Linux系统都应包括<block ref="c5f48b899461d4c2b9ddc0b24ea87744" prefix=" " category="inline-code"></block>，但只有部分包括<block ref="6f72acaebcb9a0de6696aaf3508a6144" prefix=" " category="inline-code"></block>。它们都应设置为128。</block>
  <block id="3a954c4e5e8d5ac3af590651efc5a2cb" category="cell">如果未设置这些参数、可能会对性能产生显著影响。在某些情况下、性能会受到限制、因为Linux操作系统发出的I/O不足在其他情况下、随着Linux操作系统尝试问题描述的I/O数超过可处理的I/O数、I/O时间会增加。</block>
  <block id="837f157b2f309f5415420467f7643e3a" category="section-title">ADr和NFS</block>
  <block id="c0e7bb1383be0bf1268d1d70280bef6d" category="paragraph">一些客户报告了因中的数据量过多而导致的性能问题<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 位置。通常、只有在积累了大量性能数据之后、才会出现此问题。I/O过多的原因未知、但此问题似乎是由Oracle进程反复扫描目标目录以查找更改引起的。</block>
  <block id="99be2ae95d50120a7c33c818afda1834" category="paragraph">卸下<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 和 / 或<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 挂载选项允许进行主机操作系统缓存并降低存储I/O级别。</block>
  <block id="8950578c587f9503f949dfc6a274b611" category="admonition">* NetApp建议*不要放置<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 使用的文件系统上的数据<block ref="79fea224ffd9e8111e4e87cab732464b" prefix=" " category="inline-code"></block> 或<block ref="3504e2b0e7c968444314433be465518d" prefix=" " category="inline-code"></block> 因为可能会出现性能问题。分开<block ref="18ca3ed022c239421418de608ceb49c5" prefix=" " category="inline-code"></block> 如果需要、可将数据迁移到其他挂载点。</block>
  <block id="cdb92b4a73ae99cde4df55c06e20dd3c" category="section-title">NFS-rootonly和mount-rootonly</block>
  <block id="c1f0a21ee026237bef11139a30b07040" category="paragraph">ONTAP包含一个名为的NFS选项<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 用于控制服务器是否接受来自高端口的NFS流量连接。作为一项安全措施、只有root用户才允许使用1024以下的源端口打开TCP/IP连接、因为此类端口通常保留供操作系统使用、而不是供用户进程使用。此限制有助于确保NFS流量来自实际操作系统NFS客户端、而不是模拟NFS客户端的恶意进程。Oracle DNFS客户端是用户空间驱动程序、但该进程以root用户身份运行、因此通常不需要更改的值<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block>。这些连接是从低端口进行的。</block>
  <block id="832b4524bcec11d28ca777ef9cdb4084" category="paragraph">。<block ref="eb6c1a5ecd1e17d4cd46fa5c9d415816" prefix=" " category="inline-code"></block> 仅选件适用场景NFSv3。它控制是否从大于1024的端口接受RPC挂载调用。使用DNFS时、客户端将再次以root身份运行、因此它可以打开1024以下的端口。此参数无效。</block>
  <block id="57c47a1451485bec1ebb060afdf65cb4" category="paragraph">通过NFS 4.0及更高版本打开与DNFS连接的进程不会以root身份运行、因此需要1024以上的端口。。<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 必须将参数设置为disabled、DNFS才能完成连接。</block>
  <block id="4dd73247734d116e5039cc04c4979f2c" category="paragraph">条件<block ref="77743dec92afc92eca95c255fd9333d7" prefix=" " category="inline-code"></block> 处于启用状态、则会在打开DNFS连接的挂载阶段挂起。sqlplus输出类似于：</block>
  <block id="f62d72479920ff0f8dc9a3ca6f301b5d" category="paragraph">可以按如下方式更改此参数：</block>
  <block id="47fc6c6691aed3ba0dbdc66c7896c61b" category="admonition">在极少数情况下、您可能需要将NFS-rootonly和mount-rootonly更改为disabled。如果服务器管理的TCP连接数量非常多、则可能没有低于1024的可用端口、并且操作系统会强制使用更高的端口。要完成连接、需要更改这两个ONTAP参数。</block>
  <block id="10b4eb170fe7bd035f21e7d863796683" category="section-title">NFS导出策略：super用户 和set_id</block>
  <block id="98bfec37486e95443730cc3d462022fb" category="paragraph">如果Oracle二进制文件位于NFS共享上、则导出策略必须包括超级用户和set_id权限。</block>
  <block id="3c0699ba2c56cb17c145bbda5580ed67" category="paragraph">用于用户主目录等通用文件服务的共享NFS导出通常会强制转换root用户。这意味着挂载了文件系统的主机上的root用户发出的请求会重新映射为权限较低的其他用户。这有助于防止特定服务器上的root用户访问共享服务器上的数据、从而保护数据安全。在共享环境中、set_id位也可能存在安全风险。set_id位允许以与调用命令的用户不同的用户身份运行进程。例如、由root用户拥有且具有set_id位的shell脚本以root用户身份运行。如果其他用户可以更改该shell脚本、则任何非root用户都可以通过更新脚本以root用户身份问题描述命令。</block>
  <block id="e341736b7d51c23cb7ef95615832e502" category="paragraph">Oracle二进制文件包含root用户拥有的文件、并使用set_id位。如果在NFS共享上安装了Oracle二进制文件、则导出策略必须包含适当的超级用户和set_id权限。在以下示例中、此规则同时包含这两者<block ref="1efaeada4e3307369aca511f5da0498a" prefix=" " category="inline-code"></block> 和许可<block ref="0baea2f0ae20150db78f58cddac442a9" prefix=" " category="inline-code"></block> 使用系统身份验证的NFS客户端的(root)访问权限。</block>
  <block id="f1a0fa258c785ac546835a1a75017faf" category="section-title">NFSv4/4.1配置</block>
  <block id="52f9ad2e353a42e61d9bf7dd9f59d0cb" category="paragraph">对于大多数应用程序、NFS3和NFSv4之间的差别非常小。应用程序I/O通常非常简单、不会从NFSv4中提供的某些高级功能中显著受益。从数据库存储角度来看、较高版本的NFS不应视为"升级"、而应视为包含其他功能的NFS版本。例如、如果需要Kerberos隐私模式(krb5p)的端到端安全性、则需要NFSv4。</block>
  <block id="5cee42a6ee353ec8d6538898f8e63d2d" category="inline-link">TR-4067：《基于NetApp ONTAP的NFS最佳实践》</block>
  <block id="1ca271e9db310f8a7fb925b114fd6811" category="paragraph">与简单地将挂载选项从vs=3更改为vs=4.1相比、切换到NFSv4更为复杂。有关使用ONTAP配置NFSv4的更完整说明、包括有关配置操作系统的指导、请参见<block ref="2d2395ce3ab8a9852abebca9822b9553" category="inline-link-rx"></block>。本技术报告的以下各节介绍了使用NFSv4的一些基本要求。</block>
  <block id="a1dc4350330c061ae52050f5a3400e25" category="section-title">NFSv4域</block>
  <block id="c30669603c950b31f6093d8beaf8060a" category="paragraph">有关NFSv4/4.1配置的完整说明不在本文档的讨论范围之内、但一个常见问题是域映射不匹配。从sysadmin的角度来看、NFS文件系统似乎运行正常、但应用程序会报告有关某些文件的权限和/或set_id的错误。在某些情况下、管理员错误地得出结论、认为应用程序二进制文件的权限已损坏、并在实际问题是域名时运行了chown或chmod命令。</block>
  <block id="f0c6c8a632eeaa954640907ee1da277d" category="paragraph">在ONTAP SVM上设置NFSv4域名：</block>
  <block id="97a98ebe6ac1f4a8eaf69158419dd818" category="paragraph">主机上的NFSv4域名在中进行设置<block ref="60969252b5b8391a3378335ae420d2e8" prefix=" " category="inline-code"></block></block>
  <block id="4ade50e8135e817e75aa3086851eaaa8" category="paragraph">域名必须匹配。否则、中将显示类似以下内容的映射错误<block ref="452905a167cf4509fd08acb964fdb20c" prefix=" " category="inline-code"></block>：</block>
  <block id="c0eb73bb35a4c58d87b330cd00f1986a" category="paragraph">应用程序二进制文件(如Oracle数据库二进制文件)包括root用户拥有的具有set_id位的文件、这意味着NFSv4域名不匹配会导致Oracle启动失败、并显示有关名为的文件的所有权或权限的警告<block ref="dd440398b298ff16eb1188ba8afca6df" prefix=" " category="inline-code"></block>，位于中<block ref="002f94d606ac06f290f33a5fcc67b264" prefix=" " category="inline-code"></block> 目录。它应如下所示：</block>
  <block id="21cc6f8790de2a7022b344914915604e" category="paragraph">如果此文件的所有权为mody、则可能存在NFSv4域映射问题。</block>
  <block id="203f1cdb2421d34e9eb7391e03ffcaf6" category="paragraph">要修复此问题、请选中<block ref="60969252b5b8391a3378335ae420d2e8" prefix=" " category="inline-code"></block> 根据ONTAP上的v4-id-domain设置创建文件、并确保它们一致。如果不是、请进行所需的更改、然后运行<block ref="1c7ebfbcaa2681599e41320ed491ca91" prefix=" " category="inline-code"></block>，然后等待片刻，让更改传播。然后、文件所有权应正确识别为root。如果用户尝试运行<block ref="05f0da969f2e0e6ecf3ab445e1e665ad" prefix=" " category="inline-code"></block> 更正NFS域配置之前、可能需要在此文件上运行<block ref="05f0da969f2e0e6ecf3ab445e1e665ad" prefix=" " category="inline-code"></block> 再次重申。</block>
  <block id="51fb8677d45bb006235a9f8cbe477f6f" category="summary">NFS属性缓存数据库</block>
  <block id="4da0a3b9c2e8fc0df8844a41ac133401" category="doc">数据库的NFS缓存</block>
  <block id="748f6387bf49161b9a69b7bfd691dcd2" category="paragraph">如果存在以下任一挂载选项、则会禁用主机缓存：</block>
  <block id="9f75df502ef11eaef4292c94110cb673" category="paragraph">这些设置可能会对软件安装、修补和备份/还原操作的速度产生严重的负面影响。在某些情况下、尤其是对于集群应用程序、由于需要在集群中的所有节点之间实现缓存一致性、因此必然需要使用这些选项。在其他情况下、客户会错误地使用这些参数、从而导致不必要的性能损害。</block>
  <block id="8d23519d53d6611bc42fef8dc4a432df" category="paragraph">许多客户会在安装或修补应用程序二进制文件期间临时删除这些挂载选项。如果用户验证在安装或修补过程中没有其他进程正在使用目标目录、则可以安全地执行此删除。</block>
  <block id="f73bede4039d47664f70de3c2d1f2b46" category="summary">Oracle数据库的LVM条带配置</block>
  <block id="7844f2cc495a938f3039da5801958506" category="doc">使用Oracle数据库执行LVM带</block>
  <block id="1b5681ffc153e25d2a48ae3f3f01b9f5" category="paragraph">LVM条带化是指在多个LUN之间分布数据。结果是、许多数据库的性能显著提高。</block>
  <block id="358b9a846de3e04b423c68bac9bc6d53" category="summary">LUN与Oracle数据库对齐</block>
  <block id="c4cb2c6af5d7b6c38cd7e588d846e8b4" category="doc">Oracle I/O的LUN对齐</block>
  <block id="3e00e4d28b17eedd6f6c2c38233e06a8" category="paragraph">LUN对齐是指针对底层文件系统布局优化I/O。</block>
  <block id="a6c7e85d51ae3b98197ceb3eafa3686a" category="inline-link-macro">效率</block>
  <block id="6e2524d5663b2bdc0c7985fa3e57cc55" category="section-title">未对齐警告</block>
  <block id="79e721357e358d77c4700c25c863fc37" category="inline-link">ONTAP SAN 主机配置</block>
  <block id="268b1da3f1ff11d32e385d0223101718" category="paragraph">Solaris环境中的对齐更为复杂。请参见<block ref="2d33e0364c07dc165b4079892340d4fe" category="inline-link-rx"></block> 有关详细信息 ...</block>
  <block id="6d017248f1e4f0ec7e2cd19d967b6bee" category="cell">在Solaris x86环境中，请格外注意正确对齐，因为大多数配置都有多个分区层。Solaris x86分区片通常位于标准主引导记录分区表之上。</block>
  <block id="b1230060a0220caf9d68d64b9dd85e6f" category="summary">使用Oracle时的NFS传输大小</block>
  <block id="fabe34ed4a5e432f4d1c4f6584956d8d" category="doc">Oracle数据库的NFS传输大小</block>
  <block id="1e207db9a7c8127a6c43c771b89254fb" category="paragraph">默认情况下、ONTAP会将NFS I/O大小限制为64K。</block>
  <block id="72d22e3b9af95e272859e64eb1d82df7" category="paragraph">大多数应用程序和数据库的随机I/O使用的块大小要小得多、远远低于64K的最大值。大型块I/O通常会并行处理、因此最大64K也不会限制获得最大带宽。</block>
  <block id="ebf61afddb34d070825eb696bea48813" category="paragraph">在某些工作负载中、最大64K会产生限制。特别是、如果数据库执行的I/O数量较少但规模较大、则单线程操作(例如备份或恢复操作或数据库完整表扫描)运行速度会更快、效率也会更高。ONTAP的最佳I/O处理大小为256K。</block>
  <block id="b0a5b394f3a29e64573049cda19fbacc" category="paragraph">给定ONTAP SVM的最大传输大小可按如下方式进行更改：</block>
  <block id="b070b82d66be7116d5fd6dfd8172351b" category="cell">请勿将ONTAP上允许的最大传输大小减小到低于当前挂载的NFS文件系统的rsize/wsize值。在某些操作系统中、这可能会导致挂起甚至数据损坏。例如、如果NFS客户端当前设置为rsize/wsize 65536,则ONTAP最大传输大小可以在65536- 1048576之间进行调整,但不会产生任何影响,因为客户端本身是有限的。将最大传输大小减小至65536,可能会损坏可用性或数据。</block>
  <block id="a5c97d9c3645b9a26e3febeb4bc95e24" category="summary">带有ONTAP的ASM Recasation实用程序</block>
  <block id="861a5ecc95a8478c750be41bf2ddd6f5" category="doc">ASM Recandation Utility和零块检测</block>
  <block id="8eb703f2756cafd21dbac4f23c0d6416" category="paragraph">启用实时压缩后、ONTAP可以高效删除写入文件或LUN的置零块。Oracle ASM Recasation Utility (ARU)等实用程序的工作方式是向未使用的ASM块区写入零。</block>
  <block id="9de53c14f2bae0c5d4b6e19be495ee94" category="paragraph">从数据库角度来看、ASM磁盘组包含零、读取这些LUN区域会产生零流、但ONTAP不会将零存储在驱动器上。而是进行简单的元数据更改、以便在内部将LUN的置零区域标记为任何数据为空。</block>
  <block id="06348c6e795160187e298a91b25a37a3" category="paragraph">出于类似的原因、涉及置零数据的性能测试无效、因为零块实际上不会在存储阵列中作为写入进行处理。</block>
  <block id="cee584f1e6223f6dbb73c0d64d599228" category="admonition">使用ARU时、请确保已安装Oracle建议的所有修补程序。</block>
  <block id="17ff263bc6eb701aecb8e79f9ef53efd" category="summary">使用Oracle数据库调整LUN和LVM大小</block>
  <block id="e0327f97ac271a738dd1ac6b182a4369" category="doc">调整LUN大小和基于LVM的大小</block>
  <block id="ff15e8b125dae74c1231f09380e48886" category="paragraph">当基于SAN的文件系统达到其容量限制时、可通过两种方法增加可用空间：</block>
  <block id="4182200437c090276a01ad8ca54076b0" category="summary">配置NVFAIL以保护Oracle数据库</block>
  <block id="60e002164f8988e984cf4a95b240f19d" category="doc">Oracle和NVFAIL</block>
  <block id="370bdf5dd39278264774ea595054e243" category="paragraph">NVFAIL是ONTAP中的一项功能、可确保在灾难性故障转移情形下的完整性。</block>
  <block id="80250c1f1d70fc693877be6f22cc134e" category="paragraph">数据库在存储故障转移事件期间容易损坏、因为它们会维护大量内部缓存。如果在发生灾难性事件时需要强制执行ONTAP故障转移或强制执行MetroCluster切换、而不管整体配置的运行状况如何、则先前确认的结果可能会被有效丢弃。存储阵列的内容会及时向后跳转、数据库缓存的状态不再反映磁盘上数据的状态。此不一致性会导致数据损坏。</block>
  <block id="68114defc717054e7e3b02df438cdbe1" category="paragraph">缓存可以在应用程序层或服务器层进行。例如、如果Oracle Real Application Cluster (RAC)配置中的服务器在主站点和远程站点上都处于活动状态、则该配置会在Oracle SGA中缓存数据。如果强制切换操作导致数据丢失、则会使数据库面临损坏的风险、因为存储在SGA中的块可能与磁盘上的块不匹配。</block>
  <block id="162de6d405c04ce8f152f1d246ed9187" category="paragraph">在操作系统文件系统层使用缓存不太明显。装载的NFS文件系统中的块可能会缓存在操作系统中。或者、可以将基于主站点上LUN的集群文件系统挂载到远程站点的服务器上、然后再次缓存数据。在这些情况下、NVRAM故障、强制接管或强制切换可能会导致文件系统损坏。</block>
  <block id="04ca8d9ad570a3bdf1d76e23bc108ae5" category="paragraph">ONTAP通过NVFAIL及其关联设置、保护数据库和操作系统免受这种情况的影响。</block>
  <block id="45293b650c7dacd88d269bebf219b8ef" category="summary">NetApp SnapRestore技术可在ONTAP中从Snapshot副本快速恢复Oracle数据库。</block>
  <block id="82ef718f4ebe0c276814ee3d51e33361" category="doc">SnapRestore</block>
  <block id="863696626734d6591db8be57b41c7eec" category="paragraph">NetApp SnapRestore技术可在ONTAP中从快照快速恢复数据。</block>
  <block id="9099b669f87419bc03914f11f5779c60" category="paragraph">当关键数据集不可用时、关键业务运营将中断。磁带可能会中断、甚至从基于磁盘的备份中恢复的速度也可能很慢、无法通过网络传输。SnapRestore通过近乎即时地还原数据集来避免这些问题。即使是PB级数据库、也只需几分钟的时间即可完全还原。</block>
  <block id="b02fb7dec22d0e276ca01cc60b9efb48" category="paragraph">SnapRestore有两种形式：基于文件/LUN和基于卷。</block>
  <block id="520e4b70b10aa2755a82b77e438a510f" category="list-text">单个文件或LUN可以在几秒钟内还原、无论它是2 TB LUN还是4 KB文件。</block>
  <block id="45e8a84fe4ac58c8b30a7bdaf17c0b7f" category="list-text">文件或LUN容器可以在几秒钟内还原、无论数据大小是10 GB还是100 TB。</block>
  <block id="4be4677be8cd434956b9b9af515b971a" category="paragraph">"文件或LUN容器"通常指FlexVol卷。例如、一个卷中可能有10个LUN构成一个LVM磁盘组、或者一个卷可能会存储包含1000个用户的NFS主目录。您可以将整个卷作为一个操作来还原、而不是对每个文件或LUN执行还原操作。此过程还适用于包含多个卷的横向扩展容器、例如FlexGroup或ONTAP一致性组。</block>
  <block id="a8d6a4d1b7fc6e1f60bb0ab716b4e72f" category="paragraph">SnapRestore之所以能够如此快速高效地工作、是因为Snapshot副本具有一定的特性、从本质上说、它是一个在特定时间点对卷内容进行并行只读查看的视图。活动块是可以更改的实际块、而快照是创建快照时构成文件和LUN的块的状态的只读视图。</block>
  <block id="55abea92d64d6738f9e0ed48799696e7" category="paragraph">ONTAP仅允许对快照数据进行只读访问、但可以使用SnapRestore重新激活这些数据。快照将重新启用为数据的读写视图、从而将数据恢复到先前的状态。SnapRestore可以在卷或文件级别运行。该技术本质上是相同的、但行为略有不同。</block>
  <block id="f10f2af75e2770a8ed3c2fde594e986d" category="section-title">Volume SnapRestore</block>
  <block id="ca9846346bc3b03cdec10f9fff456866" category="paragraph">基于卷的SnapRestore会将整个数据卷返回到先前的状态。此操作不需要移动数据、这意味着还原过程基本上是瞬时的、尽管处理API或CLI操作可能需要几秒钟时间。还原1 GB的数据并不比还原1 PB的数据更复杂、也不会更耗时。这一功能是许多企业客户迁移到ONTAP存储系统的主要原因。即使是最大的数据集、它也能以秒为单位提供一个RTO。</block>
  <block id="627436e77bb011a6a312ae87b12f98ea" category="paragraph">基于卷的SnapRestore的一个缺点是、卷内的更改会随着时间的推移而累积。因此、每个快照和活动文件数据都取决于到那时为止所做的更改。将卷还原到早期状态意味着、系统将会先对数据进行所有后续更改、然后再进行相应的更改。但是、不太明显的是、这包括随后创建的快照。这并不总是可取的。</block>
  <block id="5c956f2c1cfc5b9e5bac32ad1acba314" category="paragraph">例如、数据保留SLA可能指定30天的夜间备份。如果将数据集还原到五天前使用卷SnapRestore创建的快照、则会丢弃前五天创建的所有快照、从而违反SLA。</block>
  <block id="8bf9e697004f47ed6133aef724a8a42c" category="paragraph">有许多选项可用于解决此限制：</block>
  <block id="ad3b75456e625de5fe347fb918f59a22" category="list-text">可以从先前的快照复制数据、而不是对整个卷执行SnapRestore。此方法最适合较小的数据集。</block>
  <block id="90541eb74c7c56cadc2f90ec6fb6f0c0" category="list-text">快照可以克隆、而不是还原。此方法的限制是、源快照是克隆的依赖项。因此、除非同时删除克隆或将其拆分成独立的卷、否则无法将其删除。</block>
  <block id="ab6045d3463c0f68ce2fa405dce9d554" category="list-text">使用基于文件的SnapRestore。</block>
  <block id="7f7599a8b92846b691484dc91e090164" category="section-title">File SnapRestore</block>
  <block id="f03eebe4f07d362dbfe4c1d4e76c724d" category="paragraph">基于文件的SnapRestore是一种基于快照的更精细还原过程。系统会还原单个文件或LUN的状态、而不是还原整个卷的状态。无需删除任何快照、此操作也不会对先前的快照创建任何依赖关系。文件或LUN将立即在活动卷中可用。</block>
  <block id="e432fdcc277fc74a1b2b94cfeec8a7d2" category="paragraph">在对文件或LUN执行SnapRestore还原期间、不需要移动数据。但是、需要进行一些内部元数据更新、以反映文件或LUN中的底层块现在同时位于快照和活动卷中这一事实。此过程不会对性能产生任何影响、但会阻止创建快照、直到创建完成为止。根据所还原文件的总大小、处理速率约为5 Gbps (18 TB/小时)。</block>
  <block id="a68b31b502bf7555cda2514354e553c2" category="summary">ONTAP数据保护策略</block>
  <block id="6bb9a5aec98309d1414b32f7e0751415" category="doc">数据保护规划</block>
  <block id="45c46768a1cb073f0d13245a0dc816f2" category="paragraph">正确的企业级数据保护架构取决于数据保留、可恢复性以及在各种事件期间对中断的承受能力方面的业务要求。</block>
  <block id="46e1b2893bdb002c0ede448cbfe1cb14" category="paragraph">例如、考虑范围内的应用程序、数据库和重要数据集的数量。为单个数据集构建备份策略以确保符合典型SLA要求相当简单、因为无需管理太多对象。随着数据集数量的增加、监控变得更加复杂、管理员可能不得不花费越来越多的时间来解决备份故障。随着环境达到云和服务提供商规模、需要采用完全不同的方法。</block>
  <block id="b70d233428e03d072b1134a97d853ab2" category="paragraph">数据集大小也会影响策略。例如、由于数据集非常小、因此对于使用100 GB数据库进行备份和恢复、有许多选项可供选择。只需使用传统工具从备份介质中复制数据、通常就能提供足够的恢复回路(Recovery)。100 TB数据库通常需要完全不同的策略、除非RTO允许发生多天中断、在这种情况下、可以使用基于副本的传统备份和恢复操作步骤。</block>
  <block id="64848fee9c168231f5d0f13322ed0a87" category="paragraph">最后、备份和恢复过程本身之外还有其他因素。例如、是否存在支持关键生产活动的数据库、从而使恢复成为仅由熟练的数据库管理人员执行的罕见事件？或者、数据库是否属于一个大型开发环境、在该环境中、恢复频繁发生、并由一个通才型IT团队进行管理？</block>
  <block id="e26b57887de9a65c0316a87d49bf6c44" category="section-title">快照是否为备份？</block>
  <block id="c3fd105ab426caff0a0ade2e93476543" category="paragraph">对于将快照用作数据保护策略、一个常见的异议是、"实际"数据和快照数据位于同一个驱动器上。丢失这些驱动器将导致主数据和备份均丢失。</block>
  <block id="12d1adb01d24027626b2a47660fb5b81" category="paragraph">这是一个合理的问题。本地快照用于满足日常备份和恢复需求、在这方面、快照是备份。在NetApp环境中、几乎99%的恢复方案都依靠快照来满足最苛刻的恢复时间要求。</block>
  <block id="fc34c9966c8ecb7307468637d9e79933" category="paragraph">但是、本地快照绝不是唯一的备份策略、这就是NetApp提供SnapMirror复制等技术来快速高效地将快照复制到一组独立驱动器的原因。在采用快照和快照复制功能且架构合理的解决方案中、磁带的使用量可以降至最低、甚至可以每季度归档一次、也可以完全避免。</block>
  <block id="1ea948130a9dbbc02e3a80648a99ff57" category="section-title">一致性组备份</block>
  <block id="9b234a126e57777ab83807827d4e7078" category="paragraph">一致性组备份涉及捕获一个或多个数据集在一个原子时间点的状态。作为数据库示例、这包括所有数据库组件、例如数据文件、日志文件以及与数据库直接关联的其他文件。这几乎适用于所有关系数据库产品、包括Oracle RDBMS、Microsoft SQL Server、SAP HANA、PostgreSQL、 MySQL和MariaDB。使用一致性组备份保护VMware配置的方法与此类似、即在一个原子时间点捕获所有数据存储库、并可能捕获ESX启动LUN。</block>
  <block id="5a1f7038c74e54c08669efa6722f1091" category="paragraph">创建此类一致性组快照本质上是模拟崩溃、因此、此类备份经常称为崩溃状态一致的备份。有时、对恢复方案的支持存在顾虑、但请务必了解、通常不需要恢复操作步骤。当应用程序在还原一致性组备份后启动时、它会执行常规日志恢复过程、文件系统日志重放以及其他任务、以重放备份时传输中的任何I/O。然后、应用程序将照常启动。</block>
  <block id="aebdbddec25f7eba6434244a989fb659" category="paragraph">从本质上说、可以通过这种方式保护任何能够承受电源故障或服务器崩溃而不会损坏数据的应用程序。许多不同供应商提供的同步和异步镜像产品所保护的大量应用程序也证明了这一点。如果主站点突然发生灾难、则副本站点将包含发生灾难时原始环境的一致映像。同样、不需要特殊的恢复操作步骤。</block>
  <block id="e085ffefd89f8fb66260a9720e3fb6f8" category="paragraph">此方法的RPO通常仅限于备份点。一般来说、单卷快照的最小RPO为一小时。例如、48个每小时快照加上另外30天的每晚快照是合理的、不需要保留过多的快照。低于一小时的RPO将更难实现、因此、如果事先未咨询NetApp专业服务以了解环境、扩展和数据保护要求、则不建议这样做。</block>
  <block id="1fe119a790b393b7dd7e79b63f15f52b" category="paragraph">通常、可以以秒为单位测量RTO。应用程序关闭、卷还原、应用程序重新启动。</block>
  <block id="444cd304758b7607c8f7a3f627a5bc1f" category="paragraph">最简单的方法是将所有文件或LUN放在一个卷一致性组中、这样便可直接在ONTAP中计划快照创建。如果数据集必须跨越多个卷、则需要一致性组快照(CG快照)。这可以使用System Manager或还原API调用进行配置、此外、SnapCenter还能够在定义的卷列表上创建简单的一致性组快照。</block>
  <block id="689b0155b42a554594a44cddc736eb67" category="section-title">复制和灾难恢复架构</block>
  <block id="1749d12df3df2319d3eee218a277ff83" category="inline-link-macro">MetroCluster</block>
  <block id="7b8111b0a2fc76252bbacbbc9de542a4" category="inline-link-macro">SnapMirror 业务连续性</block>
  <block id="96a7c86d5bc52a478876c48dc6dcc9f0" category="paragraph">本节将介绍远程数据保护、即将数据复制到远程站点以实现安全异地存储和灾难恢复。请注意、这些表不涉及同步镜像数据保护。有关此要求、请参见NetApp MetroCluster文档、包括 <block ref="5c964f26ec7fbbad5ac67aaa5dcf9269" category="inline-link-macro-rx"></block> 和 <block ref="30831ec866621e18e7521d6c2750acaa" category="inline-link-macro-rx"></block></block>
  <block id="f443592081a2b3ddc55b94abe49ba128" category="paragraph">灾难恢复RPO受可用网络带宽和所保护数据的总大小限制。创建初始基线传输后、更新仅基于更改后的数据、尽管存在例外情况、但更改后的数据在总数据占用空间中所占的百分比通常很低。</block>
  <block id="89e87a831dae60244ba34496d70fd45d" category="paragraph">例如、一个每周变更率为10%的10 TB数据库平均每小时总变更大约为6 GB。如果使用10 Gb连接、则此数据库需要大约6分钟的传输时间。更改率随数据库更改率的波动而变化、但整体更新间隔为15分钟、因此应可实现15分钟RPO。如果有100个此类数据库、则需要600分钟来传输数据。因此、无法实现1小时的RPO。同样、一个大小为100 TB且每周变更率为10%的数据库的副本无法在一小时内可靠地更新。</block>
  <block id="3c886a803aef21f5ac9f7bcea7408cbb" category="paragraph">其他因素可能会影响复制、例如复制开销和并发复制操作数限制。但是、单卷复制策略的整体规划可以基于可用带宽、通常可以实现一小时的复制RPO。低于一小时的RPO将更难实现、只能在咨询NetApp专业服务后执行。在某些情况下、如果站点间网络连接良好、则15分钟是可行的。但是、总体而言、如果需要的RPO低于一小时、则多卷日志重放架构可以获得更好的结果。</block>
  <block id="5e2cbdd214e7a73bca1af8ed5cc04626" category="paragraph">在灾难恢复场景中、具有一致性组复制的恢复时间(从存储角度来看、通常以秒为单位)非常出色。最直接的方法是简单地中断镜像、数据库已准备就绪、可以启动。数据库启动时间通常约为10秒、但包含大量记录事务的大型数据库可能需要几分钟的时间。</block>
  <block id="1c18c939e73ddb1ceee34e8a33079d1a" category="paragraph">确定ROTO的更重要因素不是存储系统、而是运行它的应用程序和主机操作系统。例如、复制的数据可以在一两秒钟内提供、但这仅表示数据。此外、还必须有一个配置正确的操作系统、其中包含可用于数据的应用程序二进制文件。</block>
  <block id="6fab898feea25b9d7fd4477911b90b31" category="paragraph">在某些情况下、客户会提前准备灾难恢复实例、并在操作系统上预先发现存储。在这些情况下、激活灾难恢复方案只需要中断镜像并启动应用程序即可。在其他情况下、操作系统和关联应用程序可能会作为ESX虚拟机磁盘(VMDK)与数据库一起镜像。在这些情况下、RPO取决于客户在自动化方面的投入、以快速启动VMDK、从而可以启动应用程序。</block>
  <block id="c7d5d755b896edf43189fbb020202913" category="paragraph">保留时间部分由快照限制控制。例如、ONTAP中的卷限制为1024个快照。在某些情况下、客户会通过多路复用复制来增加限制。例如、如果需要2000天的备份、则可以将一个源复制到两个卷、并在备用日期进行更新。这需要增加初始所需空间、但与涉及多个完整备份的传统备份系统相比、这种方法的效率要高得多。</block>
  <block id="7ec0f114b69016879106b5018cdf10b9" category="section-title">单卷一致性组</block>
  <block id="cd70f3e596e275fe80fbbe5d7858ce1a" category="paragraph">最简单的方法是将所有文件或LUN放在一个卷一致性组中、这样可以直接在存储系统上计划SnapMirror和SnapVault更新。不需要外部软件。</block>
  <block id="909e8df57072d0b3c6d7d64b11acb571" category="section-title">多卷一致性组</block>
  <block id="c7371eded617935ace6c71a33cfbf3fd" category="paragraph">如果数据库必须跨越多个卷、则需要一致性组快照(CG快照)。如上所述、可以使用System Manager或还原API调用来配置此功能、此外、SnapCenter还能够在定义的卷列表上创建简单的一致性组快照。</block>
  <block id="9c991b38c054d7bec0632efd6667540c" category="paragraph">此外、还需要考虑将多卷一致快照用于灾难恢复的问题。在更新多个卷时、可能会在传输过程中发生灾难。结果将是一组彼此不一致的卷。如果发生这种情况、则必须将某些卷还原到先前的快照状态、以提供崩溃状态一致且可供使用的数据库映像。</block>
  <block id="fad8a5f46ebd89f74383b461e32dd6b9" category="section-title">灾难恢复：激活</block>
  <block id="5ac319591298468b0af89c2c469201f8" category="paragraph">激活灾难恢复副本的过程取决于存储类型。通过NFS、可以在灾难恢复服务器上预挂载文件系统。它们处于只读状态、并在镜像中断后变为读写状态。这样可实现极低的RPO、而且由于需要管理的部件较少、因此整个灾难恢复过程更可靠。</block>
  <block id="b829fc11ff11b57af8d4632d38d7d7e8" category="paragraph">在发生灾难恢复时激活SAN配置会变得更加复杂。最简单的方法通常是临时中断镜像并挂载SAN资源、包括发现LVM配置(包括Oracle自动存储管理[ASM]等应用程序专用功能)以及向/etc/fstab中添加条目等步骤。</block>
  <block id="335a5796fb106a877544d121062534be" category="paragraph">这样、目标服务器就可以识别LUN设备路径、卷组名称和其他设备路径。然后、可以关闭这些资源、然后还原镜像。这样、服务器就会处于可以快速使应用程序联机的状态。激活卷组、挂载文件系统或启动数据库和应用程序的步骤可以轻松实现自动化。</block>
  <block id="b1a175c5f42da29f6c27f4ea29684b63" category="paragraph">必须注意确保灾难恢复环境是最新的。例如、可能会向源服务器添加新的LUN、这意味着必须在目标上预先发现新的LUN、以确保灾难恢复计划按预期运行。</block>
  <block id="90426ba53f908049843b3ea392578d04" category="doc">Oracle灾难恢复</block>
  <block id="7fe779a487e8f113f1ffdff0fb80353f" category="summary">基于ONTAP的Oracle一致性组备份</block>
  <block id="773f9afa3df0cf82ed853c988183c73f" category="doc">Oracle一致性组备份</block>
  <block id="5afd3dc3f8d489d47587e10e6663c512" category="paragraph">要进行最简单的备份、只需将整个Oracle数据库放在一个卷中即可。</block>
  <block id="2a4fa9d9434561574119e3086112023f" category="paragraph">使用单个快照保护数据文件、归档日志、重做日志和控制文件是一种有效的备份、还原和复制方法。  但是、RPO仅限于备份本身的时间点。它适用于一小时或更长时间的RPO。如果数据库跨越多个卷、则需要使用前面讨论的工具之一创建CG快照。</block>
  <block id="93310f4cebc752304c164f00d67e0bca" category="paragraph">例如、整个数据库可以位于具有以下快照计划的单个卷中：</block>
  <block id="a33821be4b3522d65daed1ec317299f6" category="list-text">72个每小时快照</block>
  <block id="0eea0679ac7bf43c19d603cd78e81de9" category="list-text">30个夜间快照</block>
  <block id="c4546c401776d279c5577011584577fa" category="list-text">12个月快照</block>
  <block id="b63db1b650d128c342617b377baf928a" category="paragraph">这样、在前72小时的滚动期间便可实现1小时的RPO、并可提供额外的每晚和每月备份。还可以在单个卷或一组CG快照中包含多个数据库或应用程序文件、以便在更大的环境中提供一致的备份。</block>
  <block id="5eb532bcede5a8d57b8fb4429d5cc7ec" category="summary">借助基于ONTAP的Oracle最大限度地提高可用性</block>
  <block id="b4343a8438e1b9cc9e9486f85831f2a1" category="doc">借助ONTAP实现Oracle数据可用性</block>
  <block id="686540783626106489734a1990d4930d" category="paragraph">ONTAP旨在最大程度地提高Oracle数据库的可用性。本文档不会介绍完整的ONTAP高可用性功能问题描述。但是、与数据保护一样、在设计数据库基础架构时、基本了解此功能非常重要。</block>
  <block id="b049fcbe8198301adc6bf87634a02845" category="section-title">HA 对</block>
  <block id="1a7c11d1e2d03d3d1b57cff284ebd761" category="paragraph">高可用性的基本单位是HA对。每个对都包含冗余链路、以支持将数据复制到NVRAM。NVRAM不是写入缓存。控制器中的RAM用作写入缓存。NVRAM的用途是临时记录数据、以防止发生意外系统故障。在这方面、它类似于数据库重做日志。</block>
  <block id="cd2e54027dfcfeddd07ddd580db527c0" category="paragraph">NVRAM和数据库重做日志均用于快速存储数据、从而可以尽快提交对数据的更改。直到稍后在ONTAP和大多数数据库平台上的一个称为检查点的过程中、才会更新驱动器(或数据文件)上的永久性数据。在正常操作期间、不会读取NVRAM数据和数据库重做日志。</block>
  <block id="4e044ec0c36e513506c77c0a97d53539" category="paragraph">如果控制器突然出现故障、NVRAM中可能会存储一些尚未写入驱动器的待处理更改。配对控制器会检测到故障、控制驱动器并应用NVRAM中存储的所需更改。</block>
  <block id="310e46747ebab6a43d5a15998f6e2b33" category="section-title">接管和交还</block>
  <block id="1d739263e44469ad28f77fe7329fa78d" category="paragraph">接管和交还是指在HA对中的节点之间转移存储资源职责的过程。接管和返回有两个方面：</block>
  <block id="f2d43d90397aa8140414437eda14febb" category="list-text">管理允许访问驱动器的网络连接</block>
  <block id="6e1c794c81468e3286a23138460bb3fb" category="list-text">驱动器本身的管理</block>
  <block id="89d3f6c60c53a11e16a6756bde03ca00" category="paragraph">支持CIFS和NFS流量的网络接口配置了主位置和故障转移位置。接管包括将网络接口移动到与原始位置位于同一子网的物理接口上的临时主端口。交还包括将网络接口移回其原始位置。可以根据需要调整确切的行为。</block>
  <block id="108018656caf59cc565f1172047dab38" category="paragraph">在接管和回放期间、不会重新定位支持iSCSI和FC等SAN块协议的网络接口。而是应使用包含完整HA对的路径来配置LUN、从而生成主路径和二级路径。</block>
  <block id="80795d5dd590e432b4f5945aba47caf4" category="admonition">此外、还可以配置指向其他控制器的其他路径、以支持在较大集群中的节点之间重新定位数据、但这不是HA过程的一部分。</block>
  <block id="aae63904d16fd1c522dc5ff53eb695b5" category="paragraph">接管和返回的第二个方面是磁盘所有权的传输。具体过程取决于多个因素、包括接管/还原的原因以及发出的命令行选项。目标是尽可能高效地执行操作。虽然整个过程看起来可能需要几分钟时间、但驱动器所有权从一个节点转换到另一个节点的实际时刻通常可以以秒为单位进行衡量。</block>
  <block id="61775b9e8f759f26eafd6b03448d1f30" category="section-title">接管时间</block>
  <block id="3224b51e62790c4ce988d8c1876fb36e" category="paragraph">在接管和备份操作期间、主机I/O会短暂暂停、但在配置正确的环境中、不应发生应用程序中断。I/O延迟的实际过渡过程通常以秒为单位、但主机可能需要更多时间来识别数据路径中的更改并重新提交I/O操作。</block>
  <block id="40f291752a9848bfecb7264cfd9aa8ee" category="paragraph">中断的性质取决于协议：</block>
  <block id="cb44db7841f8fb68230a260c4c68bfe0" category="list-text">在过渡到新物理位置后、支持NFS和CIFS流量的网络接口会向网络发出地址解析协议(Address Resolution Protocol、ARP)请求。这会导致网络交换机更新其介质访问控制(MAC)地址表并恢复处理I/O在计划内接管和移交的情况下、中断通常以秒为单位进行衡量、在许多情况下、无法检测到。某些网络可能较慢、无法完全识别网络路径的变化、而某些操作系统可能会在很短的时间内排队等待大量I/O、必须重试。这会延长恢复I/O所需的时间</block>
  <block id="6a410522094e0b0f874dab5784e81ab8" category="list-text">支持SAN协议的网络接口不会过渡到新位置。主机操作系统必须更改正在使用的一个或多个路径。主机观察到的I/O暂停取决于多个因素。从存储系统角度来看、无法提供I/O的时间段仅为几秒。但是、不同的主机操作系统可能需要额外的时间才能使I/O在重试之前超时。较新的操作系统能够更快地识别路径更改、但较旧的操作系统通常需要长达30秒才能识别更改。</block>
  <block id="cabc4f9cda7d4bfb99181166c863a374" category="paragraph">下表显示了存储系统无法为应用程序环境提供数据的预期接管时间。在任何应用程序环境中都不应出现任何错误、接管应显示为IO处理中的短暂暂停。</block>
  <block id="c8984126713ed072b9cb0a44a162be4d" category="cell">AFF</block>
  <block id="b7b46ce5d1a547db89c0bc615ff272a5" category="cell">ASA</block>
  <block id="ed3467fac861f6a32cd66093ac415805" category="cell">计划内接管</block>
  <block id="57a915dfa0e8469b25c1b8b947f7ee2c" category="cell">15秒</block>
  <block id="cd5dce62294e9a79e9c2165ee0903f5f" category="cell">第个问题</block>
  <block id="cbfdbb11fd5eab0d9fdd078ae66a1c69" category="cell">2-3秒</block>
  <block id="1a066f0304c1d3a279466c70359c5103" category="cell">计划外接管</block>
  <block id="0f4a6e109a34d3483995e427b6581130" category="cell">30秒</block>
  <block id="a4985782267828ce03a3d13f37392de1" category="summary">校验和和和和Oracle数据保护</block>
  <block id="407941abab873f61b271b481e105eb33" category="doc">校验和和和和Oracle数据完整性</block>
  <block id="b93232347a11497969d0ea20d34cd16e" category="paragraph">NetApp经常遇到的一个问题是如何确保Oracle数据库的数据完整性。</block>
  <block id="dbfb054670bc82c6e08a7e101c0f0ef4" category="paragraph">ONTAP中的逻辑数据保护包括三个关键要求：</block>
  <block id="b6cc6762545d78ab663e39c37d172bd2" category="list-text">必须防止数据损坏。</block>
  <block id="e7c7e14f4b6ca1b3ae32b2279243dba6" category="list-text">必须保护数据免受驱动器故障的影响。</block>
  <block id="1168469b387027a850496f6cac9f3529" category="list-text">必须防止对数据所做的更改丢失。</block>
  <block id="864a6ca5da4b36656beba11c90f4c4e5" category="paragraph">以下各节将讨论这三种需求。</block>
  <block id="a05b54004946aa523bfe7c1e92a52f52" category="section-title">网络损坏：校验和</block>
  <block id="ed95581a613a4f19be367c10cd063cc2" category="paragraph">最基本的数据保护级别是校验和、校验和是随数据一起存储的一种特殊错误检测代码。使用校验和(在某些情况下、使用多个校验和)检测网络传输期间的数据损坏。</block>
  <block id="c1343e51090396cf011509389bc0adab" category="paragraph">例如、FC帧包含一种称为循环冗余校验(CRC)的校验和形式、用于确保有效负载在传输过程中不会损坏。发射器会同时发送数据和数据的CRC。FC帧的接收器重新计算已接收数据的CRC、以确保其与已传输的CRC匹配。如果新计算的CRC与附加到帧的CRC不匹配、则数据将损坏、FC帧将被丢弃或拒绝。iSCSI I/O操作包括TCP/IP和以太网层的校验和、并且为了提供额外保护、还可以在SCSI层提供可选的CRC保护。TCP层或IP层会检测到线路上的任何位损坏、从而导致数据包重新传输。与FC一样、SCSI CRC中的错误会导致丢弃或拒绝操作。</block>
  <block id="1f08639c540e47068c16c3ac48ea7bbe" category="section-title">驱动器损坏：校验和</block>
  <block id="c5d50bc8d916a4b26166bbda091cd6d4" category="paragraph">校验和还用于验证存储在驱动器上的数据的完整性。写入驱动器的数据块使用校验和功能进行存储、该功能会产生与原始数据相关的不可预测的数字。从驱动器中读取数据时、将重新计算校验和并将其与存储的校验和进行比较。如果不匹配、则数据已损坏、必须由RAID层进行恢复。</block>
  <block id="8edc44db01815f20f6508db8b5630cfe" category="section-title">数据损坏：写入丢失</block>
  <block id="972eab86b2aecd693914feabc5a3b65c" category="paragraph">最难检测的损坏类型之一是写入丢失或放错位置。确认写入后、必须将其写入到正确位置的介质中。通过使用随数据存储的简单校验和、可以相对容易地检测原位数据损坏。但是、如果只是写入丢失、则先前版本的数据可能仍存在、校验和将是正确的。如果将写入放置在错误的物理位置、则关联的校验和将再次对存储的数据有效、即使写入操作已销毁其他数据。</block>
  <block id="53830741c46fbc560962b086f582e79a" category="paragraph">应对此挑战的解决方案如下：</block>
  <block id="656d064400822ca2ffb25f52c9fc95db" category="list-text">写入操作必须包含元数据、用于指示预期写入位置。</block>
  <block id="37a60b1c7392a26270880a361f85db55" category="list-text">写入操作必须包含某种版本标识符。</block>
  <block id="4275b2e68761baa23b112833facf4ca1" category="paragraph">当ONTAP写入块时、它会包含有关块所属位置的数据。如果后续读取发现某个块、但在位置456发现元数据时、元数据指示该块属于位置123、则表示该写入已放错位置。</block>
  <block id="009b13bf07c7db21c1e4769526e60694" category="paragraph">检测完全丢失的写入操作会更加困难。解释非常复杂、但从本质上说、ONTAP存储元数据的方式是、写入操作会导致更新到驱动器上的两个不同位置。如果写入丢失、则后续读取的数据和关联元数据将显示两个不同的版本标识。这表示驱动器未完成写入。</block>
  <block id="3b04a99c209a31ad69e7865ea94e5c94" category="paragraph">丢失和放错位置的写入损坏极为少见、但随着驱动器不断增长、数据集逐渐扩展到EB级、风险也会增加。支持数据库工作负载的任何存储系统都应包括失写检测。</block>
  <block id="e978ccc010ec4d37148d52e2fbf439dd" category="section-title">驱动器故障：RAID、RAID DP和RAID-TEC</block>
  <block id="a9fffaaf2b1b518afb56ef273736c0c2" category="paragraph">如果发现驱动器上的数据块已损坏、或者整个驱动器发生故障且完全不可用、则必须重新生成数据。这在ONTAP中通过使用奇偶校验驱动器来实现。数据在多个数据驱动器之间进行条带化、然后生成奇偶校验数据。该数据与原始数据分开存储。</block>
  <block id="54abdf00b7122c16619266482eb09f43" category="paragraph">ONTAP最初使用的是RAID 4、该RAID 4会为每组数据驱动器使用一个奇偶校验驱动器。这样、组中的任何一个驱动器都可能发生故障、而不会导致数据丢失。如果奇偶校验驱动器发生故障、则不会损坏任何数据、可以构建新的奇偶校验驱动器。如果一个数据驱动器发生故障、则其余驱动器可与奇偶校验驱动器结合使用来重新生成缺失的数据。</block>
  <block id="6d1ccb512ce2b25e53d90e6d8d459e18" category="paragraph">如果驱动器较小、则两个驱动器同时发生故障的统计几率可以忽略不计。随着驱动器容量的增长、在驱动器发生故障后重建数据所需的时间也会相应增加。这增加了第二个驱动器故障导致数据丢失的时间范围。此外、重建过程会在无故障驱动器上创建大量额外的I/O。随着驱动器老化、导致第二个驱动器故障的额外负载风险也会增加。最后、即使持续使用RAID 4不会增加数据丢失的风险、数据丢失的后果也会更加严重。RAID组发生故障时丢失的数据越多、恢复数据所需的时间就越长、从而延长业务中断时间。</block>
  <block id="caef9e75bcd55d5a9a4ec855b5a6385c" category="paragraph">这些问题促使NetApp开发了NetApp RAID DP技术、这是RAID 6的变体。此解决方案包含两个奇偶校验驱动器、这意味着RAID组中的任何两个驱动器都可能发生故障、而不会造成数据丢失。驱动器的大小持续增长、这最终导致NetApp开发了NetApp RAID-TEC技术、该技术引入了第三个奇偶校验驱动器。</block>
  <block id="704c2697ee323569003b7b7ea203ae0f" category="paragraph">一些历史数据库最佳实践建议使用RAID-10、也称为条带化镜像。这提供的数据保护比RAID DP更少、因为存在多种双磁盘故障情形、而在RAID DP中则没有。</block>
  <block id="3d0147402d7506d1d3a5227fe447427a" category="paragraph">还有一些历史数据库最佳实践表明、出于性能考虑、RAID-10优于RAID-4/5/6选项。这些建议有时会提及RAID惩罚。虽然这些建议通常是正确的、但不适用于在ONTAP中实施RAID。性能问题与奇偶校验重新生成有关。在传统RAID实施中、处理数据库执行的例行随机写入需要多次磁盘读取才能重新生成奇偶校验数据并完成写入。惩罚定义为执行写入操作所需的额外读取IOPS。</block>
  <block id="84ff015d2df40fc0ebb34485173f39e4" category="paragraph">ONTAP不会产生RAID惩罚、因为写入会暂存到内存中、在该内存中会生成奇偶校验、然后作为单个RAID条带写入磁盘。完成写入操作不需要执行任何读取操作。</block>
  <block id="b7fe11ecbd8b434a231195335b4894ac" category="paragraph">总之、与RAID 10相比、RAID DP和RAID-TEC可提供更多的可用容量、更好地防止驱动器故障、并且不会影响性能。</block>
  <block id="e5e0dc0629a299f8e56ebe7de38f49f9" category="section-title">硬件故障保护：NVRAM</block>
  <block id="1db5fde40e489d805029f9d5be6375e7" category="paragraph">任何为数据库工作负载提供服务的存储阵列都必须尽快为写入操作提供服务。此外、必须保护写入操作、使其不会因意外事件(例如断电)而丢失。这意味着任何写入操作都必须安全地存储在至少两个位置。</block>
  <block id="ff540b857af868ec85f8f53ddc1f1bd1" category="paragraph">AFF和FAS系统依靠NVRAM来满足这些要求。写入过程的工作原理如下：</block>
  <block id="049f2df0de743a6be8d3ec69864f234a" category="list-text">入站写入数据存储在RAM中。</block>
  <block id="976be2293c2f4499d079224003644acf" category="list-text">必须对磁盘上的数据所做的更改会记录到本地节点和配对节点上的NVRAM中。NVRAM不是写入缓存、而是类似于数据库重做日志的日志。在正常情况下、不会读取它。它仅用于恢复、例如在I/O处理期间发生电源故障后。</block>
  <block id="8ae87ed4a421bec56e020cd0e83bd748" category="list-text">然后、写入操作会向主机确认。</block>
  <block id="3a7682bcbb490353074b5ee69e18f01c" category="paragraph">从应用程序角度来看、此阶段的写入过程已完成、数据会受到保护、不会丢失、因为数据会存储在两个不同的位置。更改最终会写入磁盘、但从应用程序角度来看、此过程是带外过程、因为它发生在确认写入之后、因此不会影响延迟。此过程再次类似于数据库日志记录。对数据库所做的更改会尽快记录在重做日志中、然后确认已提交更改。数据文件的更新发生得更晚、不会直接影响处理速度。</block>
  <block id="c17f09622da5f1e0064f7b6a65cb8b01" category="paragraph">如果某个控制器发生故障、配对控制器将接管所需磁盘的所有权、并在NVRAM中回显已记录的数据、以恢复发生故障时正在进行的任何I/O操作。</block>
  <block id="24e6592d53b3bd56ed8827d2f51bb1ab" category="section-title">硬件故障保护：NVFAIL</block>
  <block id="7965eb54acae120d25d0c77b012b8f90" category="paragraph">如前文所述、写入操作只有在至少另一个控制器上记录到本地NVRAM和NVRAM后才会得到确认。此方法可确保硬件故障或断电不会导致传输中I/O丢失如果本地NVRAM发生故障或与HA配对节点的连接发生故障、则不会再镜像此传输中的数据。</block>
  <block id="307b6d3e63c12ada7fbcf75cdda0b574" category="paragraph">如果本地NVRAM报告错误、则此节点将关闭。此关闭会导致故障转移到HA配对控制器。由于发生故障的控制器尚未确认写入操作、因此不会丢失任何数据。</block>
  <block id="6e0c6c8fe69a50581a4ac18acb2c04dd" category="paragraph">除非强制执行故障转移、否则ONTAP不允许在数据不同步时进行故障转移。以这种方式强制更改条件即表示数据可能会留在原始控制器中、并且数据丢失是可以接受的。</block>
  <block id="a3961862ed464a06ef6fa4e23935fef2" category="paragraph">如果强制执行故障转移、数据库尤其容易受到损坏的影响、因为数据库会在磁盘上保留大量内部数据缓存。如果发生强制故障转移、先前确认的更改将被有效丢弃。存储阵列的内容会及时有效地向后跳转、数据库缓存的状态不再反映磁盘上数据的状态。</block>
  <block id="b46ce3019d702ee3ece327e5df990be0" category="paragraph">为了保护数据免受这种情况的影响、ONTAP允许对卷进行配置、以便针对NVRAM故障提供特殊保护。触发此保护机制后、卷将进入名为NVFAIL的状态。此状态会导致I/O错误、即发生原因A应用程序会关闭、以使其不使用陈旧数据。数据不应丢失、因为存储阵列上应存在任何已确认的写入。</block>
  <block id="322e1f85910dfc206274f8bd58a54a9d" category="list-text">给定站点上的每组驱动器都会自动配置为一个或多个完全冗余的RAID-DP或RAID-TEC组、而与镜像的使用无关。这样可以提供持续的数据保护、即使在站点丢失后也是如此。</block>
  <block id="dee2dfce5ab0c47301b3c12970a57aa6" category="paragraph">上图显示了一个示例SyncMirror配置。在控制器上创建了一个包含24个驱动器的聚合、其中12个驱动器来自站点A上分配的磁盘架、12个驱动器来自站点B上分配的磁盘架这些驱动器被分组为两个镜像RAID组。RAID组0在站点A上包含一个6驱动器丛、该丛镜像到站点B上的6驱动器丛同样、RAID组1在站点A上包含一个6驱动器丛、该丛镜像到站点B上的6驱动器丛</block>
  <block id="4fbc0abe91c0c1381d0a742f58b4e537" category="paragraph">SyncMirror通常用于为MetroCluster系统提供远程镜像、每个站点有一个数据副本。有时、它会用于在单个系统中提供额外的冗余级别。尤其是、它可以提供磁盘架级冗余。驱动器架已包含双电源和控制器、总体比金属板稍多、但在某些情况下、可能需要额外保护。例如、一家NetApp客户为汽车测试期间使用的移动实时分析平台部署了SyncMirror。该系统分为两个物理机架、由独立UPS系统的独立电源供电。</block>
  <block id="95a3cc99b05998d49d8e035b994815bc" category="paragraph">=校验和</block>
  <block id="0cac56685de94a3ef0e1fd2bfca0c112" category="paragraph">对于习惯于使用Oracle RMAN流式备份并迁移到基于快照的备份的数据库用户来说、校验和主题特别重要。RMAN的一项功能是、它会在备份操作期间执行完整性检查。尽管此功能具有一定的价值、但其主要优势是用于未在现代存储阵列上使用的数据库。将物理驱动器用于Oracle数据库时、几乎可以肯定、随着驱动器老化、最终会发生损坏、而在真正的存储阵列中、基于阵列的校验和可以解决这一问题。</block>
  <block id="58d7088c13cf2013ef373d85e3c27de7" category="paragraph">对于真正的存储阵列、数据完整性可通过在多个级别使用校验和来保护。如果基于IP的网络中的数据损坏、则传输控制协议(TCP)层会拒绝数据包数据并请求重新传输。FC协议包括校验和、封装的SCSI数据也是如此。将ONTAP置于阵列上后、它将具有RAID和校验和保护功能。可能会发生损坏、但与大多数企业阵列一样、系统会检测到并更正此问题。通常、整个驱动器发生故障、提示重建RAID、数据库完整性不受影响。ONTAP检测校验和错误的频率较低、这意味着驱动器上的数据已损坏。然后、驱动器将出现故障、并开始RAID重建。同样、数据完整性也不受影响。</block>
  <block id="8b7b33533c2b36c157a0a482bdd52a8e" category="paragraph">Oracle数据文件和重做日志架构还旨在提供尽可能高级别的数据完整性、即使在极端情况下也是如此。在最基本的层面上、Oracle块包括对几乎每个I/O进行校验和和和基本逻辑检查如果Oracle未崩溃或使表空间脱机、则数据完好无损。数据完整性检查的程度可以调整、Oracle也可以配置为确认写入。因此、几乎所有崩溃和故障情形都可以恢复、在极少数情况下发生不可恢复的情况时、系统会立即检测到损坏。</block>
  <block id="4066c36b811913c85aa86346e30cee4d" category="paragraph">大多数使用Oracle数据库的NetApp客户在迁移到基于快照的备份之后不再使用RMAN和其他备份产品。在使用SnapCenter执行块级恢复时、仍然可以使用RMAN。但是、在日常工作中、RMAN、NetBackup和其他产品仅偶尔用于创建每月或每季度归档副本。</block>
  <block id="d0cf0e689669c61d564607d2ef7deb79" category="paragraph">有些客户选择运行<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block> 定期对其现有数据库执行完整性检查。NetApp不建议采用这种做法、因为它会产生不必要的I/O负载。如上所述、如果数据库之前未遇到问题、则可能会出现<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block> 检测问题几乎为零、此实用程序会在网络和存储系统上创建非常高的顺序I/O负载。除非有理由认为存在损坏、例如暴露于已知的Oracle错误、否则没有理由运行<block ref="d308cbfce7e270e5b41a84d84385645f" prefix=" " category="inline-code"></block>。</block>
  <block id="db97518eeb3e040b5a78c451efd4b252" category="summary">针对Snapshot优化的备份</block>
  <block id="431bbcf828b8d3513280cb1207824991" category="doc">Oracle Storage Snapshot优化的备份</block>
  <block id="52fb042c0d82d8e7bdf9ae239c387729" category="paragraph">使用Oracle 12c时、基于Snapshot的备份和恢复变得更加简单、因为无需将数据库置于热备份模式。因此、可以直接在存储系统上计划基于快照的备份、同时仍保留执行完整或时间点恢复的能力。</block>
  <block id="c9447fe684870cf68e9cb4f23f44db43" category="paragraph">尽管数据库管理器(操作步骤)对数据库管理器(数据库管理器)比较熟悉、但长期以来、可以使用数据库处于热备份模式时未创建的快照。在恢复期间、需要对Oracle 10g和11g执行额外的手动步骤、才能使数据库保持一致。采用Oracle 12c、<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 和<block ref="075b7d3bd3bbe7767f7ef62f430bc22b" prefix=" " category="inline-code"></block> 包含额外的逻辑、用于重放未处于热备份模式的数据文件备份上的归档日志。</block>
  <block id="5c7dba68615d3fa5c4c90a36dab57bcb" category="paragraph">如前文所述、恢复基于快照的热备份需要两组数据：</block>
  <block id="50a7086972cada154c8164dc1c6b3539" category="list-text">在备份模式下创建的数据文件的快照</block>
  <block id="c72d009669a638aab75c21a28a2101de" category="list-text">数据文件处于热备份模式时生成的归档日志</block>
  <block id="b8de4b1201e5595bc3de878f2bf59d9b" category="paragraph">在恢复期间、数据库会从数据文件读取元数据、以选择恢复所需的归档日志。</block>
  <block id="66ee0a6fd90f3cfab8320e1de1341cbd" category="paragraph">经过存储快照优化的恢复需要略有不同的数据集才能实现相同的结果：</block>
  <block id="6030a1d9761fca3806ef0a0329438071" category="list-text">数据文件的快照、以及用于标识快照创建时间的方法</block>
  <block id="4e822d4c19600b654f176d335c158829" category="list-text">从最近的数据文件检查点到快照的确切时间的归档日志</block>
  <block id="604432b50055c69f34df17a8ed5befb5" category="paragraph">在恢复期间、数据库会从数据文件中读取元数据、以确定所需的最早归档日志。可以执行完全恢复或时间点恢复。执行时间点恢复时、了解数据文件快照的时间至关重要。指定恢复点必须在快照创建时间之后。NetApp建议为快照时间至少添加几分钟、以考虑时钟变化。</block>
  <block id="08bfe39c49a2dc07b08bd2ccd77d8281" category="paragraph">有关完整的详细信息、请参见Oracle 12c文档各个版本中有关"使用存储Snapshot优化进行恢复"主题的Oracle文档。另请参见Oracle文档ID 604683.1、了解有关Oracle第三方快照支持的信息。</block>
  <block id="d22a890163762fcf7a4cb7605c29b7e6" category="section-title">数据布局</block>
  <block id="6a7fc1f74262f6973420f4fc849ba7f7" category="paragraph">最简单的布局是将数据文件隔离到一个或多个专用卷中。它们必须未受任何其他文件类型的污染。这是为了确保数据文件卷可以通过SnapRestore操作快速还原、而不会销毁重要的重做日志、控制文件或归档日志。</block>
  <block id="ff6fb5d2136ab516e182f4b23f45886d" category="paragraph">SAN对专用卷中的数据文件隔离具有类似要求。对于Microsoft Windows等操作系统、一个卷可能包含多个数据文件LUN、每个LUN都具有一个NTFS文件系统。对于其他操作系统、通常也会有一个逻辑卷管理器。例如、对于Oracle ASM、最简单的选择是将磁盘组限制为一个卷、该卷可以作为一个单元进行备份和还原。如果出于性能或容量管理原因需要更多卷、则在新卷上创建更多磁盘组可简化管理。</block>
  <block id="a06956ba6de69aec2dc2b015074e5821" category="paragraph">如果遵循这些准则、则可以直接在ONTAP上计划快照、而无需执行一致性组快照。原因是针对快照优化的备份不需要同时备份数据文件。</block>
  <block id="9e422c12420f1bd8c73e3c0f63da55e9" category="paragraph">如果ASM磁盘组分布在多个卷中、则会出现复杂情况。在这些情况下、必须执行cG-Snapshot、以确保ASM元数据在所有成分卷之间保持一致。</block>
  <block id="7a7969d6a47ed242c25f6a38f2da0e36" category="paragraph">[注]验证ASM spfile和passwd文件是否不在托管数据文件的磁盘组中。这会影响有选择地还原数据文件和仅还原数据文件的能力。</block>
  <block id="12eb3ceede91a01c74368e0fab03dbe4" category="section-title">本地恢复过程—NFS</block>
  <block id="e1a03fcc478ae212f07b5044b11ff369" category="paragraph">此操作步骤可以手动驱动、也可以通过SnapCenter等应用程序驱动。基本操作步骤如下所示：</block>
  <block id="abb0083d6ab87bbe9d906632fea121ae" category="list-text">将数据文件卷恢复到所需还原点之前的快照。</block>
  <block id="3450fe1e1eea00fa55cfb5cb835a3d80" category="paragraph">此操作步骤假定所需的归档日志仍存在于活动文件系统中。否则、必须还原归档日志、或<block ref="075b7d3bd3bbe7767f7ef62f430bc22b" prefix=" " category="inline-code"></block> 或<block ref="a84f4f3da79386c29ab6dfa560af786e" prefix=" " category="inline-code"></block> 可以定向到中的数据<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 目录。</block>
  <block id="e43e33171833b26f6b024d28cb8b1afd" category="paragraph">此外、对于较小的数据库、最终用户可以直接从中恢复数据文件<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 目录、而无需借助自动化工具或存储管理员来执行SnapRestore命令。</block>
  <block id="097230f6ad5345abbe261eabbf533a68" category="section-title">本地恢复过程—SAN</block>
  <block id="4e3110543ebf2a771c16b3b2101f1f88" category="list-text">将托管数据文件的磁盘组静置。操作步骤因所选的逻辑卷管理器而异。使用ASM时、此过程需要卸载磁盘组。对于Linux、必须卸载文件系统、并停用逻辑卷和卷组。目标是停止要还原的目标卷组上的所有更新。</block>
  <block id="1d0ecd206531f96737f8e8002be4a047" category="list-text">将数据文件磁盘组还原到所需还原点之前的快照。</block>
  <block id="946fe41f610ab658e270a1844c992bcc" category="list-text">重新激活新还原的磁盘组。</block>
  <block id="c21d8f41541fc2a0259e7ea5e51edac3" category="paragraph">此操作步骤假定所需的归档日志仍存在于活动文件系统中。否则、必须通过使归档日志LUN脱机并执行还原来还原归档日志。这也是一个将归档日志划分为专用卷非常有用的示例。如果归档日志与重做日志共享一个卷组、则必须在还原整个LUN集之前将重做日志复制到其他位置、以避免丢失最终记录的事务。</block>
  <block id="3fd5b2a08b3d7c4db29da8590ef6013f" category="section-title">完全恢复示例</block>
  <block id="31679daa394b7091acfd728d940b7322" category="paragraph">假设数据文件已损坏或销毁、需要完全恢复。要执行此操作的操作步骤如下所示：</block>
  <block id="aa09ca247daac25fc18c2633124ca9b6" category="section-title">时间点恢复示例</block>
  <block id="935ff627038d1f5001220c8df7f0e1b9" category="paragraph">整个恢复操作步骤只需一个命令：<block ref="3df448f0a5ec82cac76d91ba14c0fa1d" prefix=" " category="inline-code"></block>。</block>
  <block id="dcd27cf8b8ceae2cd84c898d3c1b9fdb" category="paragraph">如果需要时间点恢复、则快照的时间戳必须已知、并且可按如下方式进行标识：</block>
  <block id="17108ef3ad2e1e613b844beb5f2c6d29" category="paragraph">快照创建时间显示为3月9日和10：10：06。为了安全起见、快照时间增加了一分钟：</block>
  <block id="904b0a17b003c70e398ea85996f0f9ba" category="paragraph">此时将启动恢复。考虑到可能的时钟差异、它指定了10：11：00的快照时间(比记录的时间晚一分钟)和10：44的目标恢复时间。接下来、sqlplus请求所需的归档日志、以达到所需的恢复时间10：44。</block>
  <block id="91f99c5ad04365fb4d00e509963e2a0c" category="admonition">使用使用快照完成数据库恢复<block ref="3df448f0a5ec82cac76d91ba14c0fa1d" prefix=" " category="inline-code"></block> 命令不需要特定的许可、但需要使用进行时间点恢复<block ref="72104026d9850e8c478c23b2e2e4e8e9" prefix=" " category="inline-code"></block> 需要Oracle高级压缩许可证。</block>
  <block id="87161b635cff9308859c719a20929913" category="summary">Oracle和NetApp备份工具</block>
  <block id="9173402b63dc5f55506a692258f185e8" category="doc">SnapCenter和其他工具</block>
  <block id="400937771ac8b3d4e7be82bf39033db5" category="paragraph">ONTAP在应用程序环境中的主要价值来自核心ONTAP技术、例如即时Snapshot副本、简单的SnapMirror复制和高效创建FlexClone卷。</block>
  <block id="5459c1727c923baa303ff472498dbe97" category="paragraph">在某些情况下、直接在ONTAP上配置这些核心功能即可满足要求、但更复杂的需求则需要一个业务流程层。</block>
  <block id="aeeb3212c35c26d321183e81d4926e57" category="paragraph">SnapCenter是NetApp的旗舰级数据保护产品。从很低的层面来看、它在执行数据库备份的方式上与SnapManager产品类似、但它是从头开始构建的、用于在NetApp存储系统上提供单一管理平台来进行数据保护管理。</block>
  <block id="e538db970e1ed1ffe018725fdf223f9e" category="paragraph">SnapCenter包括一些基本功能、例如基于Snapshot副本的备份和还原、SnapMirror和SnapVault复制、以及大型企业大规模运行所需的其他功能。这些高级功能包括扩展的基于角色的访问控制(Role-Based Access Control、RBAC)功能、可与第三方业务流程产品集成的REST API、对数据库主机上的SnapCenter插件进行无中断集中管理、以及专为云规模环境设计的用户界面。</block>
  <block id="50780f47f6839d47d60bc4555ee00c3f" category="section-title">REST</block>
  <block id="a0bac638f30c704da8e03aba136da86d" category="paragraph">ONTAP还包含丰富的ESTful API集。这样、第三方供应商就可以创建与ONTAP深度集成的数据保护和其他管理应用程序。此外、希望创建自己的自动化工作流和实用程序的客户也可以轻松使用这种ESTful API。</block>
  <block id="e4cea644160fe9fa4ccd92ab3f079363" category="summary">基于Oracle快照的备份和恢复</block>
  <block id="9adc36f162691b8ed14a886b6068f368" category="doc">Oracle联机备份</block>
  <block id="a3b43ae3d4028e3c7ccac3d5720e9fb0" category="paragraph">在备份模式下保护和恢复Oracle数据库需要两组数据。请注意、这不是唯一的Oracle备份选项、但最常见。</block>
  <block id="8e523970ff7c41dba74e723511d14717" category="list-text">备份模式下数据文件的快照</block>
  <block id="deeddf207b1a29c63ae7c1943f90f3d9" category="list-text">数据文件处于备份模式时创建的归档日志</block>
  <block id="fa1229103a2e02a4ed8790098c98f71f" category="paragraph">如果需要完全恢复(包括所有已提交的事务)、则需要第三项：</block>
  <block id="7c11b244c2549a2cc477c134ec4c5635" category="list-text">一组当前的重做日志</block>
  <block id="8522faf14bc9d4ab497945bb48adc870" category="paragraph">可以通过多种方法恢复联机备份。许多客户使用ONTAP命令行界面还原快照、然后使用Oracle RMAN或sqlplus完成恢复。在大型生产环境中、这种情况尤为常见、在这些环境中、数据库还原的概率和频率极低、任何还原操作步骤都由技能娴熟的数据库管理人员来处理。为了实现完全自动化、NetApp SnapCenter等解决方案包括一个具有命令行和图形界面的Oracle插件。</block>
  <block id="f88f41d4801183a5d53a4b71f383d144" category="paragraph">一些大型客户采用了一种更简单的方法、即在主机上配置基本脚本、以便在特定时间将数据库置于备份模式、以便为计划的快照做准备。例如、计划命令<block ref="56f72994c4cc84b13a4c20dab49fea35" prefix=" " category="inline-code"></block> 23：58时、<block ref="84c8391d82cbfe300a9615844e0a167f" prefix=" " category="inline-code"></block> 00：02、然后将快照直接计划在午夜在存储系统上。这样、便形成了一个简单、高度可扩展的备份策略、无需外部软件或许可证。</block>
  <block id="719fbeb74939b8c065321f175de3d222" category="paragraph">最简单的布局是将数据文件隔离到一个或多个专用卷中。它们必须未受任何其他文件类型的污染。这是为了确保数据文件卷可以通过SnapRestore操作快速还原、而不会销毁重要的重做日志、控制文件或归档日志。</block>
  <block id="19156bdcbf322e8e3189909bbb7a69e8" category="paragraph">SAN对专用卷中的数据文件隔离具有类似要求。对于Microsoft Windows等操作系统、一个卷可能包含多个数据文件LUN、每个LUN都具有一个NTFS文件系统。对于其他操作系统、通常会有一个逻辑卷管理器。例如、对于Oracle ASM、最简单的选择是将ASM磁盘组的LUN限制为一个可作为一个单元进行备份和还原的卷。如果出于性能或容量管理原因需要更多卷、则在新卷上创建更多磁盘组可简化管理。</block>
  <block id="993afa8643b7200c5c9e527c24c1d8b2" category="paragraph">如果遵循这些准则、则可以直接在存储系统上计划快照、而无需执行一致性组快照。原因是Oracle备份不需要同时备份数据文件。联机备份操作步骤旨在使数据文件能够持续更新、因为它们会在数小时内缓慢流式传输到磁带。</block>
  <block id="a2ea5ea024e4a68e4d7f4abeca3441a1" category="paragraph">如果使用分布在卷之间的ASM磁盘组、则会出现复杂情况。在这些情况下、必须执行cG-Snapshot、以确保ASM元数据在所有成分卷之间保持一致。</block>
  <block id="0a3ecb97c1b7c97e5075bae0daaa45aa" category="paragraph">*注意：*验证ASM<block ref="1737629d60b511cf45957529a8f046e2" prefix=" " category="inline-code"></block> 和<block ref="76a2173be6393254e72ffa4d6df1030a" prefix=" " category="inline-code"></block> 文件不在托管数据文件的磁盘组中。这会影响有选择地还原数据文件和仅还原数据文件的能力。</block>
  <block id="2f8a5e254c86a42ebcc8b7d3c84cd22e" category="paragraph">此操作步骤假定所需的归档日志仍存在于活动文件系统中。否则、必须还原归档日志、或者可以将RMAN/sqlplus定向到快照目录中的数据。</block>
  <block id="a67a69f712a877950e94edd27310b40e" category="paragraph">此外、对于较小的数据库、最终用户可以直接从中恢复数据文件<block ref="a15da8cecb1f1192c4d913b8ba676121" prefix=" " category="inline-code"></block> 目录、而无需自动化工具或存储管理员协助即可执行<block ref="a4c0ce4da6fb04943b499690fb3afd6e" prefix=" " category="inline-code"></block> 命令：</block>
  <block id="6da8ebf3245e4fbe4654e7f92f0330d7" category="list-text">将托管数据文件的磁盘组静置。操作步骤因所选的逻辑卷管理器而异。使用ASM时、此过程需要卸载磁盘组。对于Linux、必须卸载文件系统、并且必须停用逻辑卷和卷组。目标是停止要还原的目标卷组上的所有更新。</block>
  <block id="931ab211ac6773d20c03a998f9f921ce" category="list-text">如果需要完全恢复、请重放所有重做日志。</block>
  <block id="b6575c3fca5eaaa56eeb8e9ce8867f05" category="paragraph">此操作步骤假定所需的归档日志仍存在于活动文件系统中。否则、必须通过使归档日志LUN脱机并执行还原来还原归档日志。这也是一个将归档日志划分为专用卷非常有用的示例。如果归档日志与重做日志共享一个卷组、则必须先将重做日志复制到其他位置、然后才能还原整个一组LUN。此步骤可防止丢失这些最终记录的事务。</block>
  <block id="1536f0d3e3ee227abdec76f432b89cae" category="summary">Oracle数据保护SLA</block>
  <block id="e9c8b7044dfae7a21f1a9c4d08628a66" category="doc">恢复时间目标、恢复点目标和服务级别协议</block>
  <block id="020e620c60ad38b75f0ff2a2fe4067b0" category="paragraph">数据保护策略应根据业务要求进行定义。</block>
  <block id="65fd6f7f97414140b4d6060b743dc645" category="paragraph">这些要求包括恢复速度、允许的最大数据丢失量以及备份保留需求等因素。数据保护计划还必须考虑数据保留和还原方面的各种法规要求。最后、必须考虑不同的数据恢复场景、从因用户或应用程序错误而导致的典型和可预见的恢复到包括站点完全丢失在内的灾难恢复场景。</block>
  <block id="2bd1d35ff88de136066c33905c0fd677" category="paragraph">对数据保护和恢复策略进行微小更改可能会对存储、备份和恢复的整体架构产生显著影响。在开始设计工作之前、必须定义并记录标准、以避免使数据保护架构复杂化。不必要的功能或保护级别会导致不必要的成本和管理开销、而最初被忽视的要求可能会导致项目方向错误或需要在最后一刻更改设计。</block>
  <block id="a60e6b87ede45aef49d8d095435db22b" category="section-title">恢复时间目标</block>
  <block id="3d3b341e14c584d1edcea9fe13619ee1" category="paragraph">恢复时间目标(Recovery Time目标、Recovery Time目标、Recovery Time目标、Recovery Time目标、Recovery Time目标、Recovery Time目标)定义了恢复服务所允许的最长时间。例如、人力资源数据库的RTO可能为24小时、因为虽然在工作日无法访问此数据会非常不便、但业务仍可继续运营。相比之下、支持银行总分类账的数据库将以分钟甚至几秒钟计量的最短时间。RTO不可能为零、因为必须有方法区分实际服务中断和例行事件(例如网络数据包丢失)。但是、RTO接近零是一项典型要求。</block>
  <block id="5a27873285a0397cc06f9f47280c9426" category="section-title">恢复点目标</block>
  <block id="f3ae061e139f47d793058ee596a5243f" category="paragraph">恢复点目标(RPO)定义了可容忍的最大数据丢失。在许多情况下、RPO完全取决于快照或SnapMirror更新的频率。</block>
  <block id="2d68fbd3cefeb34bfd64c8f89caba64d" category="paragraph">在某些情况下、可以通过更频繁地有选择地保护某些数据来提高RPO的主动性。在数据库环境中、RPO通常是指在特定情况下可能丢失多少日志数据的问题。在典型的恢复情形中、如果数据库因产品错误或用户错误而损坏、则RPO应为零、这意味着不会丢失任何数据。恢复操作步骤包括还原数据库文件的早期副本、然后重影日志文件、以使数据库状态达到所需的时间点。此操作所需的日志文件应已位于原始位置。</block>
  <block id="57df8b025934bcd0f7e96bae19cf0688" category="paragraph">在异常情况下、日志数据可能会丢失。例如、意外事件或恶意事件<block ref="4609acba202877f99742342f4195d95e" prefix=" " category="inline-code"></block> 数据库文件的数量可能会导致所有数据被删除。唯一的选择是从备份(包括日志文件)进行还原、而某些数据将不可避免地丢失。在传统备份环境中、要提高RPO、唯一的选择是对日志数据执行重复备份。但是、由于数据会不断移动、而且很难将备份系统作为一项持续运行的服务来维护、因此这一点存在一些限制。高级存储系统的优势之一是能够保护数据免受文件意外或恶意损坏、从而提供更好的RPO、而无需移动数据。</block>
  <block id="3d08c71e26ac92e34925e02570c4bd22" category="paragraph">灾难恢复包括在发生物理灾难时恢复服务所需的IT架构、策略和过程。这可能包括洪水、火灾或有恶意或疏忽意图的人员。</block>
  <block id="78f4e749ec0c6bb2627abbbc00bce296" category="paragraph">灾难恢复不仅仅是一组恢复过程。它是一个完整的过程、可以识别各种风险、定义数据恢复和服务连续性要求、并提供具有相关过程的正确架构。</block>
  <block id="75bcd60b234aba82b5827cd7a5171563" category="paragraph">在确定数据保护要求时、必须区分典型的RPO和RTO要求以及灾难恢复所需的RPO和RTO要求。某些应用程序环境要求RPO为零、RTO接近零、以应对从相对正常的用户错误到破坏数据中心的火灾等数据丢失情形。然而，这种高水平的保护会产生成本和行政后果。</block>
  <block id="756651fea87d05811d7a42451d074b60" category="paragraph">通常、非灾难数据恢复要求应严格、原因有两个。首先、破坏数据的应用程序错误和用户错误是可以预见的、几乎是不可避免的。其次、只要存储系统不被销毁、设计一个能够实现零RPO和低RTO的备份策略不难。没有理由不解决容易补救的重大风险、这就是为什么本地恢复的RPO和RTO目标应该积极主动的原因。</block>
  <block id="cb6faee28dd34d25f06bd0b33abe1c2f" category="paragraph">根据发生灾难的可能性以及相关数据丢失或业务中断的后果、灾难恢复RTO和RPO要求的差别更大。RPO和RTO要求应基于实际业务需求、而不是一般原则。它们必须考虑多种逻辑和物理灾难情形。</block>
  <block id="68f31611fc8a5e6a20793905280a7001" category="section-title">逻辑灾难</block>
  <block id="07f5727077caaf8dedf895542181d26b" category="paragraph">逻辑灾难包括由用户、应用程序或操作系统错误以及软件故障导致的数据损坏。逻辑灾难还可能包括外部人员利用病毒或蠕虫或利用应用程序漏洞进行的恶意攻击。在这些情况下、物理基础架构未损坏、但底层数据不再有效。</block>
  <block id="3cb5ee5f24e42f56ba6dac48b7b046d2" category="paragraph">一种日益常见的逻辑灾难类型称为勒索软件、在这种情况下、攻击向量用于对数据进行加密。加密不会损坏数据、但在向第三方付款之前、加密将使数据不可用。越来越多的企业正成为勒索软件黑客攻击的专门目标。针对这种威胁、NetApp提供防篡改快照、在这些快照中、即使存储管理员也无法在配置的到期日期之前更改受保护的数据。</block>
  <block id="91c87f53ce0a1f416308a67ce119c623" category="section-title">物理灾难</block>
  <block id="79055ca11f54a97d22617a656eab8b9b" category="paragraph">物理灾难包括基础架构的组件发生故障、导致其冗余能力超出范围、从而导致数据丢失或服务长时间丢失。例如、RAID保护可提供磁盘驱动器冗余、而使用HBA可提供FC端口和FC缆线冗余。此类组件的硬件故障是可以预见的、不会影响可用性。</block>
  <block id="3f7c55fe5f35f94cd2c4bd73b9cbb11b" category="paragraph">在企业环境中、通常可以使用冗余组件保护整个站点的基础架构、直到唯一可预见的物理灾难情形是站点完全丢失。灾难恢复规划则取决于站点到站点复制。</block>
  <block id="7f3dd7bdd41f7af6853732a383bbd7e2" category="section-title">同步和异步数据保护</block>
  <block id="c5ac17d5693914368f39b40a07af23d4" category="paragraph">理想情况下、所有数据都会在地理位置分散的站点之间同步复制。由于以下几个原因、此类复制并不总是可行甚至不可能实现：</block>
  <block id="28c59a675d03e1f62a48958bb53ae523" category="list-text">同步复制不可避免地会增加写入延迟、因为必须先将所有更改复制到这两个位置、然后应用程序/数据库才能继续处理。所产生的性能影响有时是不可接受的、从而排除了使用同步镜像的可能性。</block>
  <block id="50a05ceeb998c4dac7e8b5d706fe2029" category="list-text">随着100% SSD存储的采用率不断提高、更有可能注意到额外的写入延迟、因为性能预期包括数十万次IOPS和亚微秒延迟。要充分发挥使用100% SSD的优势、可能需要重新审视灾难恢复策略。</block>
  <block id="04d90fe6288ce6cceba54a2b71e55727" category="list-text">数据集的字节数持续增长、在确保足够的带宽来支持同步复制方面面临着挑战。</block>
  <block id="d3aaae220bd5b3d68dd4ccec3bf78197" category="list-text">数据集的复杂性也在不断增加、在管理大规模同步复制方面也面临着挑战。</block>
  <block id="c3a841e0bfc640f91b0a00c4af8c6f5c" category="list-text">基于云的策略通常涉及更长的复制距离和延迟、进一步排除了同步镜像的使用。</block>
  <block id="7df1515e247dfa2063c433b9339c2d4a" category="paragraph">NetApp提供的解决方案既包括可满足最严苛数据恢复需求的同步复制、也包括可提高性能和灵活性的异步解决方案。此外、NetApp技术还可以与许多第三方复制解决方案(例如Oracle DataGuard)无缝集成</block>
  <block id="4d2c802af835583121763e1a6acc3f9b" category="section-title">保留时间</block>
  <block id="123dbb4c09a5c8fb993a856cf65c9d25" category="paragraph">数据保护策略的最后一个方面是数据保留时间、数据保留时间可能差别很大。</block>
  <block id="d3a424909a8559a2d076e5d9a28d834f" category="list-text">通常要求在主站点上执行14天的夜间备份、在二级站点上执行90天的备份。</block>
  <block id="1d7c2d97c3bfd5ca9489e0ffeb06b150" category="list-text">许多客户创建独立的季度归档、存储在不同的介质上。</block>
  <block id="61ae175e4a0c88c4624184a0cb9b04d2" category="list-text">不断更新的数据库可能不需要历史数据、备份只需保留几天。</block>
  <block id="8bb85c2149e1e808032e7025b0a27b80" category="list-text">根据法规要求、可能需要在365天内恢复到任意事务的时间点。</block>
  <block id="a83f7a3ea63946cbdc1977d641e8460c" category="summary">基于ONTAP的Oracle和快照的角色</block>
  <block id="05280349760feacdd6227fb8012e39d7" category="doc">基于Snapshot的备份</block>
  <block id="5e3f0537b2a1927f4a24b28e9157cc0b" category="paragraph">基于ONTAP的Oracle数据保护的基础是NetApp Snapshot技术。</block>
  <block id="a4c2aeedbfeeda21f232cbf45be91693" category="paragraph">关键值如下：</block>
  <block id="d06c89cff665ecdde6eded3c9d44cd2b" category="list-text">*精简性。*快照是指特定时间点数据容器内容的只读副本。</block>
  <block id="175888ba89c31a851f719bdd271cae9c" category="list-text">*效率。*创建快照时不需要任何空间。只有在数据发生更改时才会占用空间。</block>
  <block id="d853e9e275a6e58b3a9a56fa641cbb9f" category="list-text">*易管理性。*基于快照的备份策略易于配置和管理、因为快照是存储操作系统的本机部分。如果存储系统已启动、则它可以随时创建备份。</block>
  <block id="b564e5fbab71af776ed54a19d09b268c" category="list-text">*可扩展性。*一个文件和LUN容器最多可保留1024个备份。对于复杂的数据集、可以通过一组一致的快照来保护多个数据容器。</block>
  <block id="7159872a568b97a971b9ea182fb23b7c" category="list-text">无论卷包含1024个快照还是无快照、性能都不受影响。</block>
  <block id="1a54f7e14e6e652bb32b12df22faf387" category="paragraph">虽然许多存储供应商都提供快照技术、但ONTAP中的快照技术是独一无二的、可为企业级应用程序和数据库环境带来显著优势：</block>
  <block id="d77b23e355dc2f65b90fb52ed9a90f9c" category="list-text">Snapshot副本是底层任意位置写入文件布局(Write-Anywhere File Layout、WAFL)的一部分。它们不是附加技术或外部技术。由于存储系统是备份系统、因此可简化管理。</block>
  <block id="8b888e6a2d883c0111428c101532294a" category="list-text">Snapshot副本不会影响性能、但某些边缘情形除外、例如、快照中存储的数据量如此之多、以致于底层存储系统会填满。</block>
  <block id="2283ea50a243a5d1ad551f7d21f39895" category="list-text">术语"一致性组"通常用于指作为一致的数据集合进行管理的一组存储对象。特定ONTAP卷的快照构成一致性组备份。</block>
  <block id="ac72c83a8204d600d567261b41c5488c" category="paragraph">ONTAP快照的扩展能力也优于竞争技术。客户可以存储5个、50个或500个快照、而不会影响性能。卷中当前允许的最大快照数为1024。如果需要额外保留快照、可以选择将快照级联到其他卷。</block>
  <block id="3b7ff39ba50f1bc3f56d38c41ba51855" category="paragraph">因此、保护ONTAP上托管的数据集非常简单、并且具有高度可扩展性。备份不需要移动数据、因此可以根据业务需求定制备份策略、而不是网络传输速率、大量磁带驱动器或磁盘暂存区的限制。</block>
  <block id="55c5bbb3aad88266600eaa1a526406d4" category="paragraph">有关将快照用作数据保护策略的一个常见问题是、"实际"数据和快照数据位于同一个驱动器上。丢失这些驱动器将导致主数据和备份均丢失。</block>
  <block id="68870deb35eeb53373325a314030bd11" category="paragraph">但是、本地快照绝不是唯一的备份策略、这就是NetApp提供SnapMirror和SnapVault复制等技术来快速高效地将快照复制到一组独立驱动器的原因。在采用快照和快照复制功能且架构合理的解决方案中、磁带的使用量可以降至最低、甚至可以每季度归档一次、也可以完全避免。</block>
  <block id="73d3fd255835ca3dc926f59d50223f91" category="paragraph">使用ONTAP Snapshot副本保护数据有多种选择、快照是复制、灾难恢复和克隆等许多其他ONTAP功能的基础。本文档不会介绍有关Snapshot技术的完整问题描述、但以下各节将提供一般概述。</block>
  <block id="7441577327d1d49b71cc2f6403e17e7b" category="paragraph">创建数据集快照的主要方法有两种：</block>
  <block id="b38ba43128207852ef5149e6c578ba89" category="list-text">崩溃状态一致的备份</block>
  <block id="dc64a2f6075820724476e435a1ebd7fa" category="list-text">应用程序一致的备份</block>
  <block id="7733cc553d118547b64c858cb4281f24" category="paragraph">崩溃状态一致的数据集备份是指在一个时间点捕获整个数据集结构。如果数据集存储在单个NetApp FlexVol卷中、则此过程非常简单；可以随时创建Snapshot。如果数据集跨越多个卷、则必须创建一致性组(CG)快照。创建CG快照的选项有多种、包括NetApp SnapCenter软件、本机ONTAP一致性组功能以及用户维护的脚本。</block>
  <block id="32561979f55bc68c4f028fd26a9975f6" category="paragraph">当备份点恢复足以满足要求时、主要使用崩溃状态一致的备份。当需要更精细的恢复时、通常需要应用程序一致的备份。</block>
  <block id="367735591e5e6e04c17b7930acb29b7d" category="paragraph">"应用程序一致"中的"一致"一词通常用词不当。例如、将Oracle数据库置于备份模式称为应用程序一致的备份、但数据不会以任何方式保持一致或处于静态。数据在整个备份过程中持续更改。相比之下、大多数MySQL和Microsoft SQL Server备份确实会在执行备份之前将数据置于静噪状态。VMware可能会使某些文件保持一致、也可能不会使其保持一致。</block>
  <block id="ebf90723e7659cb5381545104b618612" category="paragraph">术语"一致性组"是指存储阵列能够将多个存储资源作为一个映像进行管理。例如、一个数据库可能包含10个LUN。阵列必须能够以一致的方式备份、还原和复制这10个LUN。如果LUN的映像在备份时不一致、则无法还原。复制这10个LUN要求所有副本之间完全同步。</block>
  <block id="3f8a43f1defaa984435092f616876545" category="paragraph">在讨论ONTAP时、不经常使用术语"一致性组"、因为一致性一直是ONTAP中卷和聚合架构的基本功能。许多其他存储阵列将LUN或文件系统作为单独的单元进行管理。然后、可以选择将其配置为"一致性组"以实现数据保护、但这是配置中的一个额外步骤。</block>
  <block id="74e816c3c784f5c30c79dca4590d7f59" category="paragraph">ONTAP始终能够捕获一致的本地和复制数据映像。虽然ONTAP系统上的各种卷通常不会正式描述为一致性组、但它们就是一致性组。该卷的快照是一致性组映像、该快照的还原是一致性组还原、SnapMirror和SnapVault均提供一致性组复制。</block>
  <block id="15cc4389a08c3f4748e98622e630ad3e" category="section-title">一致性组快照</block>
  <block id="d286b747757ef3d8d3abac27bfae65f9" category="paragraph">一致性组快照(CG快照)是基本ONTAP快照技术的扩展。标准快照操作会为单个卷中的所有数据创建一致的映像、但有时需要在多个卷甚至多个存储系统之间创建一组一致的快照。这样就会生成一组快照、这些快照的使用方式与仅包含一个卷的快照相同。它们可用于本地数据恢复、为灾难恢复目的进行复制或作为一个一致的单元进行克隆。</block>
  <block id="7c199465bc6344e648e2f73c88131605" category="paragraph">已知的最大CG-Snapsh图 用途是用于大小约为1 PB且跨越12个控制器的数据库环境。在此系统上创建的CG快照已用于备份、恢复和克隆。</block>
  <block id="e5c199b4a97409f33d5caae984957744" category="paragraph">大多数情况下、如果数据集跨越多个卷且必须保留写入顺序、则选定管理软件会自动使用CG快照。在这种情况下、无需了解CG快照的技术详细信息。但是、在某些情况下、复杂的数据保护要求需要对数据保护和复制过程进行详细控制。可以选择自动化工作流或使用自定义脚本来调用CG-Snapshot API。要了解cG-Snapshot的最佳选项和角色、需要对该技术进行更详细的说明。</block>
  <block id="cf3c30ea5c240a8aef02d240f42cdff7" category="paragraph">创建一组CG快照的过程分为两步：</block>
  <block id="f30455406a91bd776afbc88e60b9697e" category="list-text">在所有目标卷上建立写入隔离。</block>
  <block id="c7afe45d94f2fd172a01e851d7f92a2f" category="list-text">在隔离状态下创建这些卷的快照。</block>
  <block id="c464d4671e489eaad9a8cbf0a8086ea9" category="paragraph">写入隔离是按序列建立的。这意味着、在多个卷之间设置隔离过程时、写入I/O会冻结在序列中的第一个卷上、因为它会继续提交到稍后显示的卷。最初、这可能看起来违反了保留写入顺序的要求、但只有在主机上异步发出的适用场景I/O、而不依赖于任何其他写入。</block>
  <block id="688656b1f8644ee299edf7be87a8fc75" category="paragraph">例如、数据库可能会对大量异步数据文件更新进行问题描述、并允许操作系统重新排列I/O、然后根据自己的计划程序配置完成这些更新。无法保证此类I/O的顺序、因为应用程序和操作系统已释放保留写入顺序的要求。</block>
  <block id="599ce07d1bae0fa6169959e2bdb97ada" category="paragraph">作为一个计数器示例、大多数数据库日志记录活动都是同步的。在确认I/O并保留这些写入顺序之前、数据库不会继续进行日志写入。如果日志I/O到达隔离的卷、则不会进行确认、应用程序会阻止进一步写入。同样、文件系统元数据I/O通常是同步的。例如、文件删除操作不能丢失。如果带有xfs文件系统的操作系统删除了某个文件、而更新了xfs文件系统元数据以删除对该文件的引用的I/O则会登录到隔离的卷上、则文件系统活动将暂停。这样可以保证CG快照操作期间文件系统的完整性。</block>
  <block id="0f0c0f05310f9cf257d65bfd936f15c5" category="paragraph">在目标卷之间设置写入隔离后、这些卷便可创建快照了。无需同时创建快照、因为从依赖写入的角度来看、卷的状态是冻结的。为了防止创建CG快照的应用程序出现缺陷、初始写入隔离包括一个可配置的超时时间、在此超时时间内、ONTAP会自动释放隔离并在定义的秒数后恢复写入处理。如果所有快照都是在超时期限到期之前创建的、则生成的一组快照是有效的一致性组。</block>
  <block id="df4925d1c6c3f3258e80ff35ce62b17d" category="section-title">从属写入顺序</block>
  <block id="6c78ee478b93fbb573157b85fb1114db" category="paragraph">从技术角度来看、一致性组的关键在于保留写入顺序、尤其是依赖写入顺序。例如、向10个LUN写入数据的数据库会同时向所有LUN写入数据。许多写入操作是异步发出的、这意味着它们的完成顺序并不重要、实际完成顺序会因操作系统和网络行为而异。</block>
  <block id="69d87c00869001f3f06ad4a1494eac21" category="paragraph">在数据库继续执行其他写入操作之前、磁盘上必须存在某些写入操作。这些关键写入操作称为依赖写入。后续写入I/O取决于磁盘上是否存在这些写入。对这10个LUN执行任何快照、恢复或复制操作都必须确保依赖写入顺序得到保证。文件系统更新是依赖写入顺序写入的另一个示例。必须保留文件系统更改的顺序、否则整个文件系统可能会损坏。</block>
  <block id="74fbae5d0b3c16e1774c5f4dce2c1c36" category="section-title">战略</block>
  <block id="53e858edb9bd9ff3f9ead52cebf5731d" category="paragraph">基于快照的备份有两种主要方法：</block>
  <block id="f87f61f625a005bd32c53f808d235eea" category="list-text">受Snapshot保护的热备份</block>
  <block id="c81725eb350a685210d69762bd5d725d" category="paragraph">崩溃状态一致的数据库备份是指在一个时间点捕获整个数据库结构、包括数据文件、重做日志和控制文件。如果数据库存储在单个NetApp FlexVol卷中、则此过程非常简单；可以随时创建Snapshot。如果数据库跨越多个卷、则必须创建一致性组(CG)快照。创建CG快照的选项有多种、包括NetApp SnapCenter软件、本机ONTAP一致性组功能以及用户维护的脚本。</block>
  <block id="c32eba270db95747b471fd53e203a47b" category="paragraph">崩溃状态一致的Snapshot备份主要在备份点恢复已足够时使用。在某些情况下、可以应用归档日志、但在需要更精细的时间点恢复时、最好使用联机备份。</block>
  <block id="82cc23cd5dc667cc9fb78ff6e76ac15b" category="paragraph">基于快照的联机备份的基本操作步骤如下所示：</block>
  <block id="dbaf4855045e45fbcf678fa4cd1ab2db" category="list-text">将数据库放置在中<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 模式。</block>
  <block id="c3e07fb8aef84ef3d94e3f9d5376c091" category="list-text">为托管数据文件的所有卷创建快照。</block>
  <block id="2d0e58ff1a25bd9fd8a85ad8ce6f2665" category="list-text">退出<block ref="402051f4be0cc3aad33bcf3ac3d6532b" prefix=" " category="inline-code"></block> 模式。</block>
  <block id="4196c5674aaa9e4317b2b4c54f94a905" category="list-text">运行命令<block ref="9d2840394bc37850da4e360dbf60c0dc" prefix=" " category="inline-code"></block> 强制日志归档。</block>
  <block id="f2736e795871e2fc2d36addb9436f337" category="list-text">为托管归档日志的所有卷创建快照。</block>
  <block id="f24880a3fe8b242fdd1aba5a2d11196f" category="paragraph">此操作步骤将生成一组快照、其中包含处于备份模式的数据文件以及处于备份模式时生成的关键归档日志。这是恢复数据库的两项要求。为方便起见、还应保护控制文件等文件、但唯一的绝对要求是保护数据文件和归档日志。</block>
  <block id="0c32649da44277db19fcfa3fe4dac28f" category="paragraph">虽然不同的客户可能有非常不同的策略、但几乎所有这些策略最终都基于下面所述的相同原则。</block>
  <block id="88f451afed04f47352987f617f805826" category="section-title">基于Snapshot的恢复</block>
  <block id="c092a9763068c8382be82f9c77bb9658" category="paragraph">在为Oracle数据库设计卷布局时、首先要决定是否使用基于卷的NetApp SnapRestore (VBSR)技术。</block>
  <block id="15a0b8dc4d1b340d403bf6515f7e61b8" category="paragraph">基于卷的SnapRestore可以将卷几乎即时还原到较早的时间点。由于卷上的所有数据均已还原、因此VBSR可能并不适用于所有使用情形。例如、如果整个数据库(包括数据文件、重做日志和归档日志)存储在单个卷上、而此卷通过VBSR还原、则数据会丢失、因为较新的归档日志和重做数据会被丢弃。</block>
  <block id="e63c0ca12b07a654ccadd92527a95c47" category="paragraph">还原不需要VBSR。许多数据库都可以通过使用基于文件的单文件文件系统(Single File SnapRestore、SFSR)进行还原、或者只需将文件从快照复制回活动文件系统即可。</block>
  <block id="2093e578085fede0f022c4efdb79c336" category="paragraph">当数据库非常大或必须尽快恢复时、最好使用VBSR、而使用VBSR需要隔离数据文件。在NFS环境中、给定数据库的数据文件必须存储在未受任何其他类型文件污染的专用卷中。在SAN环境中、数据文件必须存储在专用FlexVol卷上的专用LUN中。如果使用卷管理器(包括Oracle自动存储管理[ASM])、则磁盘组还必须专用于数据文件。</block>
  <block id="b38bd603a952c93872eae2ea858cb15f" category="paragraph">通过以这种方式隔离数据文件、可以将其还原到早期状态、而不会损坏其他文件系统。</block>
  <block id="5755a6275c3ecd99e8159efc58a8ff6c" category="section-title">Snapshot 预留</block>
  <block id="957abb72f2db3a20e0b570a5fa3a1dcc" category="paragraph">对于SAN环境中包含Oracle数据的每个卷、<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 应设置为零、因为在LUN环境中为快照预留空间没有用处。如果预留百分比设置为100、则包含LUN的卷的快照需要该卷中具有足够的可用空间(不包括快照预留)来吸收所有数据的100%周转率。如果预留百分比设置为较低的值、则所需的可用空间量相应较少、但始终不包括Snapshot预留。这意味着会浪费LUN环境中的快照预留空间。</block>
  <block id="d5a06adf11e69f265f3ee3277212764e" category="paragraph">在NFS环境中、有两种选择：</block>
  <block id="7631336a8e2e03f6ac500c145445b2d7" category="list-text">设置<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 基于预期的Snapshot空间消耗。</block>
  <block id="acc4c5d06fc4a9ac93880c9c2d0a6e76" category="list-text">设置<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 将活动空间和快照空间占用情况统一置零并进行管理。</block>
  <block id="44806986c5abfcd6261803f4f75a7b56" category="paragraph">使用第一个选项时、<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 设置为非零值、通常约为20%。然后、此空间将对用户隐藏。但是、此值不会对利用率造成限制。如果预留百分比为20%的数据库的周转率为30%、则快照空间可能会超出预留百分比的界限并占用未预留空间。</block>
  <block id="c8910acb0bfa30f82b423ff09a9710ca" category="paragraph">将预留设置为20%这样的值的主要优势是、验证某些空间始终可用于快照。例如、预留为20%的1 TB卷仅允许数据库管理员(Database Administrator、DBA)存储800 GB数据。此配置可确保至少为快照占用200 GB的空间。</block>
  <block id="be233226a8cb890c0a8bbf041c06ac6b" category="paragraph">时间<block ref="9ca25b30dcc119f9115aad6d85fd12ce" prefix=" " category="inline-code"></block> 设置为零时、卷中的所有空间均可供最终用户使用、从而提高可见性。数据库管理员必须了解、如果发现1 TB卷利用快照、则这1 TB空间将在活动数据和Snapshot周转率之间共享。</block>
  <block id="b10efee713968b90d211d08ec8345d20" category="paragraph">最终用户之间没有明确的首选方案一和备选方案二。</block>
  <block id="8112d08173571f2d01372cadea3ea76d" category="section-title">ONTAP和第三方快照</block>
  <block id="0cc082f7cc7618a904f6cde556295cbd" category="paragraph">Oracle文档ID 604683.1介绍了第三方快照支持的要求以及可用于备份和还原操作的多个选项。</block>
  <block id="130a02f8381e6c54b2ea07d2bdaf6f0b" category="paragraph">第三方供应商必须保证公司的快照符合以下要求：</block>
  <block id="97eb59a0f249226523b31dd52d557e00" category="list-text">快照必须与Oracle建议的还原和恢复操作集成。</block>
  <block id="083e9332dc2b6bf064139ac2e670eee9" category="list-text">快照必须在快照点保持数据库崩溃状态一致。</block>
  <block id="9dae8634b638a6949dab0f7eaf7988bd" category="list-text">系统会为快照中的每个文件保留写入顺序。</block>
  <block id="7bc868657652757ca8505ddcd297456f" category="paragraph">ONTAP和NetApp Oracle管理产品符合这些要求。</block>
  <block id="9e19caeb431a5e29a1a63e3cee4b36c9" category="doc">借助ONTAP实现Oracle数据保护</block>
  <block id="6f1383567177df0041e76e845c3629f2" category="paragraph">最关键的任务数据位于数据库中。</block>
  <block id="848aab87f65bfade12f80d4e864ec046" category="paragraph">企业无法在不访问其数据的情况下运营、有时数据决定了业务。这些数据必须受到保护；但是、数据保护不仅仅是确保备份可用、它还需要快速可靠地执行备份、同时还要安全地存储这些备份。</block>
  <block id="28a0304f97f876b27cf541f4ad9a30d7" category="paragraph">数据保护的另一面是数据恢复。如果无法访问数据、则企业会受到影响、并且可能无法运行、直到数据还原为止。此过程必须快速可靠。最后、必须保护大多数数据库免受灾难的影响、这意味着需要维护数据库的副本。副本必须足够最新。使副本成为一个完全正常运行的数据库还必须快速而简单。</block>
  <block id="3d601b26d05eac41fc6a7eba92fdc8b9" category="admonition">本文档可替代先前发布的技术报告_TR-4591：《Oracle数据保护：备份、恢复和复制》</block>
  <block id="21d28aa03f67eb242b1c95a6a0594ff5" category="section-title">规划</block>
  <block id="0bf5784d6c307e4ee0371d46053937c0" category="summary">Oracle性能测试</block>
  <block id="355ba59494fea8b20be391a73cc755eb" category="paragraph">准确测试数据库存储性能是一个极其复杂的主题。它需要了解以下问题：</block>
  <block id="b57041cc3b57577b5c21eff44739e3f9" category="list-text">IOPS和吞吐量</block>
  <block id="236e7fd957ada95e8094e302623980d3" category="list-text">前台和后台I/O操作之间的区别</block>
  <block id="902f90cc4ab59808cac5606f767f61c4" category="list-text">延迟对数据库的影响</block>
  <block id="196198dbaa1d1ea17cfc478fbb2f419f" category="list-text">许多操作系统和网络设置也会影响存储性能</block>
  <block id="5ff18eadb2ef3fc20e13bed3e5b61d79" category="paragraph">此外、还需要考虑执行非存储数据库任务。有时、优化存储性能不会带来任何有用的优势、因为存储性能不再是性能的限制因素。</block>
  <block id="32a993d3f497a6dd4392d3348b05ebc3" category="list-text">网络带宽日益成为性能限制的常见来源。例如、旋转磁盘解决方案通常会成为数据库性能的瓶颈、因为I/O延迟非常高。当全闪存阵列消除延迟限制后、障碍往往会转移到网络上。在虚拟化环境和刀片式系统中、这一点尤为明显、因为它们的真正网络连接很难直观地呈现出来。如果由于带宽限制而无法充分利用存储系统本身、则可能会使性能测试复杂化。</block>
  <block id="8caa382fb0f5f7a8279424d306dd003d" category="list-text">由于全闪存阵列的延迟显著缩短、因此通常无法将全闪存阵列与包含旋转磁盘的阵列进行性能比较。测试结果通常没有意义。</block>
  <block id="bc2b8b37bdda467f2ce639ab28bf4646" category="list-text">将峰值IOPS性能与纯闪存阵列进行比较通常不是一项有用的测试、因为数据库不受存储I/O的限制例如、假设一个阵列可以承受50万次随机IOPS、而另一个阵列可以承受30万次随机IOPS。如果数据库将99%的时间花在CPU处理上、则这种差异在实际环境中无关紧要。这些工作负载从不充分利用存储阵列的全部功能。相反、在整合平台中、峰值IOPS功能可能至关重要、在该平台中、存储阵列应加载到其峰值功能。</block>
  <block id="0c2cbb26e6baa58b7d3a3309f95a2786" category="list-text">在任何存储测试中、始终考虑延迟和IOPS。市场上的许多存储阵列都声称IOPS达到了极高水平、但延迟会使这些IOPS在这种水平下毫无用处。全闪存阵列的典型目标为1毫秒标记。更好的测试方法不是测量可能的最大IOPS、而是确定在平均延迟超过1毫秒之前存储阵列可以承受的IOPS数。</block>
  <block id="e6d8362588e550c19912b0f3f0e1a129" category="section-title">Oracle自动工作负载存储库和基准测试</block>
  <block id="d035df494751722dd56d4cf4a8d1f795" category="paragraph">Oracle性能比较的黄金标准是Oracle自动工作负载存储库(Automatic Workload Repository、AWR)报告。</block>
  <block id="95f7e55383674168e90b01b708bc88db" category="paragraph">AWR报告有多种类型。从存储角度来看、是指通过运行生成的报告<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> 命令功能最全面、最有价值、因为它针对特定数据库实例、并包含一些详细的直方图、这些直方图可按延迟细分存储I/O事件。</block>
  <block id="7b79802e5668e6e5b990081db481505d" category="paragraph">比较两个性能阵列时、理想情况下需要在每个阵列上运行相同的工作负载、并生成一个准确针对该工作负载的AWR报告。如果工作负载运行时间非常长、则可以使用一个AWR报告、其中经过的时间包含开始和停止时间、但最好将AWR数据细分为多个报告。例如、如果批处理作业从午夜运行到早上6点、请创建一系列从午夜到凌晨1点、从凌晨1点到凌晨2点的一小时AWR报告、依此类推。</block>
  <block id="e39ecb86ad7d25413ba8ad2976fd3e4a" category="paragraph">在其他情况下、应优化非常短的查询。最佳选择是基于查询开始时创建的AWR快照和查询结束时创建的第二个AWR快照创建AWR报告。否则、数据库服务器应保持安静、以最大限度地减少后台活动、因为后台活动会掩盖正在分析的查询的活动。</block>
  <block id="2fe7152c186ec1b5b0451e13ec8b968b" category="admonition">如果AWR报告不可用、则Oracle statspack报告是一个很好的替代方案。它们包含与AWR报告大部分相同的I/O统计信息。</block>
  <block id="8b8c73ac7e509a897688356d1d283d75" category="section-title">Oracle AWR和故障排除</block>
  <block id="42a92c79ee82f4343e7d65f2f1cf2dd2" category="paragraph">AWR报告也是分析性能问题的最重要工具。</block>
  <block id="ad5387afbab7c506c781c8b12b0a4b24" category="paragraph">与基准测试一样、性能故障排除要求您精确测量特定工作负载。如果可能、请在向NetApp支持中心报告性能问题或与NetApp或合作伙伴客户团队合作购买新的解决方案时提供AWR数据。</block>
  <block id="6471146c0e33e2a8ec8a5c6635c837bc" category="paragraph">提供AWR数据时、请考虑以下要求：</block>
  <block id="5c3ba265890805919f93c246b3f8d2d6" category="list-text">运行<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> 命令以生成报告。输出可以是文本或HTML。</block>
  <block id="25db65f9a36910f3e488a8b7407130de" category="list-text">如果使用Oracle Real Application Clusters (RAC)、请为集群中的每个实例生成AWR报告。</block>
  <block id="96d55341f8208c60720e68b3155f3aa1" category="list-text">确定问题存在的具体时间。AWR报告的最长可接受用时通常为一小时。如果问题持续数小时或涉及多小时操作(例如批处理作业)、请提供多个涵盖要分析的整个期间的一小时AWR报告。</block>
  <block id="4533b15b837909c68a0171d2638494d2" category="list-text">如果可能、将AWR快照间隔调整为15分钟。此设置允许执行更详细的分析。这还需要执行更多的<block ref="5053a9940effa118d38161a53f3b80f8" prefix=" " category="inline-code"></block> 以提供每15分钟间隔的报告。</block>
  <block id="97eb6d04cc93934c1be4ab95054cd0b0" category="list-text">如果问题是运行时间非常短的查询、请根据操作开始时创建的AWR快照和操作结束时创建的第二个AWR快照提供AWR报告。否则、数据库服务器应保持安静、以最大限度地减少后台活动、因为后台活动会掩盖所分析操作的活动。</block>
  <block id="5186f459ce7d75e587a083bcb7c5927a" category="list-text">如果在特定时间报告了性能问题、但在其他时间未报告、请提供其他证明性能良好的AWR数据以供比较。</block>
  <block id="108a72dad388aa310cc52ee3bac7d1cc" category="section-title">CALIBRAT_IO</block>
  <block id="f1c07dfccef6a6c47a5ccef938e10e3d" category="paragraph">。<block ref="108a72dad388aa310cc52ee3bac7d1cc" prefix=" " category="inline-code"></block> 切勿使用命令测试、比较存储系统或对其进行基准测试。如Oracle文档中所述、此操作步骤会校准存储的I/O功能。</block>
  <block id="872892cce56a2665ad7ceecc44b38166" category="paragraph">校准与基准测试不同。此命令的目的是通过问题描述I/O来帮助校准数据库操作、并通过优化向主机发出的I/O级别来提高其效率。因为执行的I/O类型<block ref="108a72dad388aa310cc52ee3bac7d1cc" prefix=" " category="inline-code"></block> 操作不代表实际的数据库用户I/O、结果不可预测、而且经常甚至无法重现。</block>
  <block id="e66807fad19acd41db50eedff918a4dd" category="section-title">SLOB2</block>
  <block id="0a6192ff5412539c31db2c7a98f408b3" category="inline-link-macro"><block ref="0a6192ff5412539c31db2c7a98f408b3" category="inline-link-rx"></block></block>
  <block id="d1f6fb23f52090ffd944dc54549735b8" category="paragraph">SOLB2 (Song Little Oracle基准)已成为评估数据库性能的首选工具。它由Kevin Clsson开发、可从获取 <block ref="3ccce0719b1965cd915da75778e4e706" category="inline-link-macro-rx"></block>。安装和配置只需几分钟、它会使用实际的Oracle数据库在用户可定义的表空间上生成I/O模式。它是少数几个可以使全闪存阵列的I/O饱和的测试选项之一此外、它还有助于生成低得多的I/O级别、以模拟IOPS低但对延迟敏感的存储工作负载。</block>
  <block id="baffd8ac40ca7b966340e7b257b4c7b4" category="section-title">Swingbench</block>
  <block id="905a59d6f73f4e2aea1dc232a3bcd195" category="paragraph">Swingbench可用于测试数据库性能、但要以对存储造成压力的方式使用Swingbench、则极为困难。NetApp尚未从Swingbench中检测到任何测试产生足够的I/O来为任何AFF阵列带来大量负载。在有限情况下、可以使用订单输入测试(Order Entry Test、OOT)从延迟角度评估存储。如果数据库对特定查询具有已知的延迟依赖关系、则此功能可能会很有用。必须注意确保主机和网络配置正确、以实现全闪存阵列的潜在延迟。</block>
  <block id="e3cf940afa524b20b15c43b20405be77" category="section-title">HammerDB</block>
  <block id="5c9408da71d2ff7554b9fd11add795cf" category="paragraph">HAMmerDB是一款数据库测试工具、用于模拟TPC-C和TPC-H基准测试等。构建一个足够大的数据集可能需要花费大量时间才能正确执行测试、但它可以作为一个有效的工具来评估OLTP和数据仓库应用程序的性能。</block>
  <block id="7e1ad070b7fff621d9d64a71cec87684" category="section-title">猎户座</block>
  <block id="56fedcbec2842fb62a743c5f84311597" category="paragraph">Oracle ORION工具通常与Oracle 9一起使用、但尚未对其进行维护、以确保与各种主机操作系统中的更改兼容。由于与操作系统和存储配置不兼容、因此很少与Oracle 10或Oracle 11结合使用。</block>
  <block id="38622bf572fa7bec2dc7f3915ebd345f" category="paragraph">Oracle重新编写了该工具、默认情况下会随Oracle 12c一起安装。虽然此产品已得到改进、并使用了与实际Oracle数据库相同的许多调用、但它使用的代码路径或I/O行为与Oracle不同。例如、大多数Oracle I/O都是同步执行的、这意味着数据库会暂停、直到I/O完成、因为I/O操作在前台完成。简单地将随机I/O充斥存储系统并不是真正的Oracle I/O、也不提供比较存储阵列或衡量配置更改影响的直接方法。</block>
  <block id="bb68dfada5ca20e256bbd3ffbbfab9e6" category="paragraph">尽管如此、也有一些适用于ORION的用例、例如、对特定主机-网络-存储配置的最大可能性能进行常规测量、或者对存储系统的运行状况进行评估。通过仔细测试、可以设计出可用的ORION测试来比较存储阵列或评估配置更改的影响、前提是这些参数包括考虑IOPS、吞吐量和延迟、并尝试忠实地复制真实的工作负载。</block>
  <block id="6b64090d226d30776368e89b08c7c71b" category="summary">Oracle数据库的WAFL对齐</block>
  <block id="03a35ba2b6191f8cfbd1cca378eefc91" category="doc">Oracle数据库的WAFL对齐验证</block>
  <block id="219900dcd21cee2f958254a708ad36f6" category="paragraph">正确对齐WAFL对于获得良好性能至关重要。尽管ONTAP以4 KB单位管理块、但这并不意味着ONTAP以4 KB单位执行所有操作。事实上、ONTAP支持不同大小的块操作、但底层记帐由WAFL以4 KB单位进行管理。</block>
  <block id="5d3a5c290e14d74acf49b20d15120886" category="paragraph">术语"对齐"是指Oracle I/O与这些4 KB单位的对应关系。要获得最佳性能、需要将一个Oracle 8 KB块驻留在驱动器上的两个4 KB WAFL物理块上。如果块偏移2 KB、则此块位于一个4 KB块的一半、一个单独的完整4 KB块、然后是第三个4 KB块的一半。这种排列会导致性能下降。</block>
  <block id="0073ce99d632b066d5ac09a4ad0cf7fc" category="paragraph">对齐不是NAS文件系统的问题。Oracle数据文件会根据Oracle块的大小与文件开头对齐。因此、8 KB、16 KB和32 KB的块大小始终对齐。所有块操作都会与文件开头偏移、以4 KB为单位。</block>
  <block id="d7f7edd61ab216efc34578584a7d0e7c" category="paragraph">与此相反、LUN通常在开始时包含某种类型的驱动程序标头或文件系统元数据、以创建偏移。在现代操作系统中、对齐很少会成为问题、因为这些操作系统专为可能使用本机4 KB扇区的物理驱动器而设计、这也需要将I/O与4 KB边界对齐以获得最佳性能。</block>
  <block id="38b3d1cd67903560954ad297a92e3de1" category="paragraph">但也有一些例外情况。数据库可能是从未针对4 KB I/O进行优化的旧版操作系统迁移的、或者分区创建期间的用户错误可能导致偏移量大小不以4 KB为单位。</block>
  <block id="612eeadd26ceeace7b043d37f8e24b1f" category="paragraph">以下示例是Linux专用的、但操作步骤可适用于任何操作系统。</block>
  <block id="1d5b772bea21e5e949413e09eedf17de" category="section-title">已对齐</block>
  <block id="594b0fc1af44897ff4b26f2e6b866685" category="paragraph">以下示例显示了对具有单个分区的单个LUN的对齐检查。</block>
  <block id="dc2c18402c86861702fc1d94a6495ac3" category="paragraph">首先、创建使用驱动器上所有可用分区的分区。</block>
  <block id="adff8cc6319e96d2685fd082a5aa043c" category="paragraph">可以使用以下命令以数学方式检查对齐情况：</block>
  <block id="4bc7aba328a710bb7d0935cf830634aa" category="paragraph">输出显示单位为512字节、分区起始单位为32。这是总共32 x 512 = 16、834字节、是4 KB WAFL块的整数倍。此分区已正确对齐。</block>
  <block id="dd343941469b5360af52eb1b94fe5de6" category="paragraph">要验证是否正确对齐、请完成以下步骤：</block>
  <block id="7d84e72acd05d0c93d99e414f5b092b5" category="list-text">确定LUN的通用唯一标识符(UUID)。</block>
  <block id="92af2a93f00a6297c490ba0be5fd7a8a" category="list-text">在ONTAP控制器上输入节点Shell。</block>
  <block id="5274579d5eff6fe6d1e8ecbf54e84993" category="list-text">对第一步中确定的目标UUID启动统计收集。</block>
  <block id="52df0a2ea976123bf02330300b2392e3" category="list-text">执行一些I/O使用非常重要<block ref="3c908d68ba53922b92c5595b72fa011c" prefix=" " category="inline-code"></block> 用于确保I/O是同步的且不缓冲的参数。</block>
  <block id="fac8a5b490ea29eca93ec213d79e6ff2" category="admonition">使用此命令时请格外小心。反转<block ref="39c8942e1038872a822c0dc75eedbde3" prefix=" " category="inline-code"></block> 和<block ref="8bf8854bebe108183caeb845c7676ae4" prefix=" " category="inline-code"></block> 参数会销毁数据。</block>
  <block id="4f7dce34a21e3de727f3e3ad05e6e7d8" category="list-text">停止统计信息并查看对齐直方图。所有I/O都应位于中<block ref="c6bd178b372b0ddd17fff48819badc6a" prefix=" " category="inline-code"></block> 存储分段、表示I/O与4 KB块边界对齐。</block>
  <block id="5df81374c01d1b7c20fe8cb3883117eb" category="section-title">未对齐</block>
  <block id="5ff266dadf965b3c304513f516a13c12" category="paragraph">以下示例显示了未对齐的I/O：</block>
  <block id="25be03b87e6a5d8170ce85b16ea506ab" category="list-text">创建不与4 KB边界对齐的分区。这不是现代操作系统上的默认行为。</block>
  <block id="4adda0e871000c2b13a4faef6ce4e21b" category="paragraph">未对齐情况很明显。I/O大部分落在*中 <block ref="66c8d76cad709856ccec680cab8ab35a" prefix="*" category="inline-code"></block> 存储分段、与预期偏移匹配。创建分区时、该分区会比优化默认值更远地移动到设备中512字节、这意味着直方图偏移512字节。</block>
  <block id="b53cb977228ac351c16dfacc3c427a99" category="paragraph">此外、还可以使用<block ref="20e637b3ddd562732de038fba736c7ee" prefix=" " category="inline-code"></block> 统计信息不为零、这意味着执行的I/O未填满整个4 KB块。</block>
  <block id="d3d92f87c5235ad11c8bc69e85fb2fd0" category="section-title">重做日志记录</block>
  <block id="162b54d51a30629d78e153f8da201780" category="paragraph">此处介绍的过程适用于数据文件。Oracle重做日志和归档日志具有不同的I/O模式。例如、重做日志记录是对单个文件的循环覆盖。如果使用默认的512字节块大小、则写入统计信息如下所示：</block>
  <block id="d36dbaa617441d3308f5a9b50cb6f5ca" category="paragraph">I/O将分布在所有直方图分段中、但这不是性能问题。但是、使用4 KB块大小可能会有利于极高的重做日志记录速率。在这种情况下、需要确保重做日志记录LUN正确对齐。但是、这对于获得良好性能并不像数据文件对齐那样重要。</block>
  <block id="f64f1c647516f5a47c00be152fdbf488" category="summary">Oracle和过时的NFSv3锁定</block>
  <block id="91d9710c9fee248ae3e9c4b810ae704f" category="doc">过时的NFSv3锁定和Oracle数据库</block>
  <block id="3f9e1e3abd12ad7445baea4b681b9ceb" category="paragraph">如果Oracle数据库服务器崩溃、则在重新启动时、陈旧的NFS锁定可能会出现问题。通过仔细注意服务器上的名称解析配置、可以避免此问题。</block>
  <block id="288ebefc25180862eb0448b786b1b9fc" category="paragraph">出现此问题的原因是、创建锁定和清除锁定使用两种略有不同的名称解析方法。其中涉及两个进程、即网络锁定管理器(Network Lock Manager、NLM)和NFS客户端。NLM使用<block ref="e5caaf154dfeed411b9eec65b903a22a" prefix=" " category="inline-code"></block> 要确定主机名、请使用<block ref="d49331f31f40041ebcee19fca74fd9d4" prefix=" " category="inline-code"></block> 流程使用<block ref="330c4316ae6124616389eb1ca9912f7a" prefix=" " category="inline-code"></block>。这些主机名必须匹配、操作系统才能正确清除陈旧锁定。例如、主机可能正在查找属于的锁定<block ref="c7169a6dd344d0f0a38071a1262e4973" prefix=" " category="inline-code"></block>，但主机已将锁定注册为<block ref="0c32c65f5ac66d0bdb4e63bd5fde7f75" prefix=" " category="inline-code"></block>。条件<block ref="330c4316ae6124616389eb1ca9912f7a" prefix=" " category="inline-code"></block> 返回的值与不相同<block ref="5c020b5bb8d1ce1ace51c2a2f4c06fc2" prefix=" " category="inline-code"></block>，则锁定释放过程未成功。</block>
  <block id="19b9a1f540971d74c69042125bab2abc" category="paragraph">以下示例脚本将验证名称解析是否完全一致：</block>
  <block id="ee04b3fa3b28391874763596275e09c9" category="paragraph">条件<block ref="b64c6f211add16fd66ac17ef14c2a2b4" prefix=" " category="inline-code"></block> 不匹配<block ref="4040592cec1880aa70936989f05e7c31" prefix=" " category="inline-code"></block>，可能是陈旧的锁定。例如、此结果揭示了一个潜在问题：</block>
  <block id="2b500e5914ea5a219ade17dea0808f51" category="paragraph">通常、可以通过更改主机在中的显示顺序来查找解决方案<block ref="ad942c725cd0cae65ca4c63717ec464c" prefix=" " category="inline-code"></block>。例如、假设主机文件包含以下条目：</block>
  <block id="22b58ec1cec48707dfc018e6e216e966" category="paragraph">要解析此问题描述、请更改完全限定域名和短主机名的显示顺序：</block>
  <block id="e357ccd0745db58f22ea5c0947b613ee" category="paragraph"><block ref="330c4316ae6124616389eb1ca9912f7a" prefix="" category="inline-code"></block> 现在返回短<block ref="c7169a6dd344d0f0a38071a1262e4973" prefix=" " category="inline-code"></block> 主机名、与的输出匹配<block ref="4040592cec1880aa70936989f05e7c31" prefix=" " category="inline-code"></block>。因此、锁定会在服务器崩溃后自动清除。</block>
  <block id="547b870352d8464aadbe7bee63d6f3d1" category="summary">数据库虚拟化简介</block>
  <block id="ea4c55be196897a16d86999f5c16d582" category="doc">虚拟化</block>
  <block id="4a478889a2e46bee771126a78eda2911" category="paragraph">使用VMware ESX、Oracle OVM或KVM对数据库进行虚拟化是NetApp客户越来越普遍的选择、他们选择对其任务关键型数据库进行虚拟化。</block>
  <block id="0f976e587b1e7af0949904e76d91384b" category="paragraph">在虚拟化支持策略(尤其是VMware产品)方面存在许多误解。事实上、听说Oracle不支持任何虚拟化、这种情况并不少见。这一概念是不正确的、会导致错失虚拟化机会。Oracle文档ID 249212.1讨论了Oracle环境中的已知问题、并指定了对RAC的支持。</block>
  <block id="02ea3d7754e6bc1c99ff77393e49e373" category="paragraph">如果客户遇到Oracle未知的问题、可能会被要求在物理硬件上重现该问题。运行尖端产品版本的Oracle客户可能不想使用虚拟化、因为可能会发现新的错误。但是、对于使用公开发布的产品版本的虚拟化客户来说、这种情况实际上并不是问题。</block>
  <block id="9e28dbd7a4f5940eeaf6d3893c5c4b1f" category="section-title">存储表示</block>
  <block id="8fdbc6d55014a06c15b9f130e5bedd12" category="paragraph">考虑将数据库虚拟化的客户应根据业务需求制定存储决策。虽然这对于所有IT决策来说都是一个正确的表述、但对于虚拟化来说尤其重要、因为项目的规模和范围差别很大。</block>
  <block id="6cf53ad2948792abdf4a8668365b8396" category="paragraph">存储表示有四个基本选项：</block>
  <block id="151ae53a4100e0a6e83bde4d78083f81" category="list-text">由虚拟机上的iSCSI启动程序(而不是虚拟机管理程序)管理的iSCSI LUN</block>
  <block id="73014dc1e7381cfd107ba79742a873e3" category="list-text">VM挂载的NFS文件系统、而不是虚拟机磁盘(VMDK)</block>
  <block id="810f0004f0e8e215c676ac0621d5836b" category="list-text">虚拟机管理程序数据存储库</block>
  <block id="8e2a0eba3eaebd64066d020ab225dd78" category="paragraph">一般情况下、请避免对Oracle文件使用数据存储库。此建议的原因有很多：</block>
  <block id="98b171e836c6656f9cf88835666c6345" category="list-text">*Transparency。*当VM拥有其文件系统时，数据库管理员或系统管理员可以更轻松地确定其数据的文件系统源。</block>
  <block id="ec6a3b593d5584a2e15651852e384082" category="list-text">*性能。*测试表明、通过虚拟机管理程序数据存储库输送所有I/O会对性能产生影响。</block>
  <block id="47464ddf615c138c6c06d3bfea555b2d" category="list-text">*易管理性。*如果虚拟机拥有其文件系统、则使用或不使用虚拟机管理程序层会影响易管理性。配置、监控、数据保护等过程同样适用于整个资产、包括虚拟化和非虚拟化环境。</block>
  <block id="3d04d7019fbc0d27880dcc5c0881f87b" category="list-text">*稳定性和故障排除。*当虚拟机拥有其文件系统时、由于虚拟机上存在整个存储堆栈、因此提供良好、稳定的性能和故障排除会更加简单。虚拟机管理程序的唯一角色是传输FC或IP帧。如果配置中包含数据存储库、则会引入另一组超时、参数、日志文件和潜在错误、从而使配置复杂。</block>
  <block id="36f9cea3dc0f65698a9fbe15460591c1" category="list-text">*可移动性。*当VM拥有其文件系统时、移动Oracle环境的过程将变得更加简单。文件系统可以轻松地在虚拟化和非虚拟化子系统之间移动。</block>
  <block id="cb90f9e52412940f028394174f31ec2f" category="list-text">*受制于供应商。*将数据放入数据存储库后、使用不同的虚拟机管理程序或将数据完全从虚拟化环境中取出将变得非常困难。</block>
  <block id="4308dde96d1bdae6ac436a611c834331" category="list-text">*启用Snapshot。*在某些情况下、由于带宽相对有限、虚拟化环境中的备份可能会成为一个问题。例如、四端口10GbE中继可能足以满足许多虚拟化数据库的日常性能需求。但是、此类中继不足以使用RMAN或其他需要流式传输完整大小数据副本的备份产品执行备份。</block>
  <block id="872c95c8713fd14a0bef21fe92a55ab7" category="paragraph">使用虚拟机拥有的文件系统可以更轻松地利用基于Snapshot的备份和恢复。虚拟机拥有的文件系统会将执行备份的工作卸载到存储系统上。无需纯粹为了满足备份窗口中的带宽和CPU要求而过度构建虚拟机管理程序配置。</block>
  <block id="3522f960cdbaf08c375bd70214f8db2f" category="admonition">*Oracle建议*避免将NetApp数据放置在数据存储库上以实现最佳性能和易管理性。使用子系统拥有的文件系统、例如由子系统管理的NFS或iSCSI文件系统、或者将其与RDM结合使用。</block>
  <block id="f114856edc6cd8d6a9add5ec3f67656f" category="section-title">部分驱动程序</block>
  <block id="beeb10ceee6c9aabe178fb51edea7d22" category="paragraph">为了获得最佳性能、使用完全虚拟化的网络驱动程序至关重要。使用数据存储库时、需要使用一个虚拟化的SCSI驱动程序。与虚拟化驱动程序相比、超虚拟化设备驱动程序可以使子系统更深入地集成到虚拟机管理程序中、而在模拟驱动程序中、虚拟机管理程序会花费更多的CPU时间来模拟物理硬件的行为。</block>
  <block id="59b3d62404749c3e899b7e4c9ee10146" category="paragraph">大多数数据库的性能都受存储限制。因此、网络或SCSI驱动程序带来的额外延迟尤为明显。NetApp客户支持遇到了许多性能问题、这些问题通过安装虚拟化驱动程序得到了解决。在一次客户概念验证中、数据库在ESX环境下的性能优于与裸机运行相同硬件的性能。这些测试需要大量I/O、性能差异是由于使用了ESX超虚拟化网络驱动程序所致。</block>
  <block id="4e27b04a271416c5701a99234f8a23e6" category="admonition">*SCSI建议*始终使用虚拟化网络驱动程序和NetApp驱动程序。</block>
  <block id="7c5996fc15a24ce96b30160b60ac2b96" category="section-title">过量使用RAM</block>
  <block id="5bccdd812c4af1cb5b9e36ddce656b60" category="paragraph">过量使用RAM意味着在不同主机上配置的虚拟化RAM要多于物理硬件上的虚拟化RAM。否则可能会出现发生原因意外的性能问题。对数据库进行虚拟化时、虚拟机管理程序不得将Oracle SGA的底层块交换到存储中。这样做会导致性能结果高度不稳定。</block>
  <block id="31db92967e891f0a122e0329d819842e" category="admonition">* NetApp建议*不要以允许交换Oracle SGA块的方式配置虚拟机管理程序。</block>
  <block id="be493f1fc0b02ae45602c7c13f7b5dc7" category="summary">TR-4792为在由NVIDIA图形处理单元(GPU)和虚拟化软件提供支持的VMware Horizon环境中使用NetApp HCI 615C处理3D图形工作负载提供了指导。</block>
  <block id="ff1d278a485c443dc5d8fc9f10f1a702" category="doc">适用于采用VMware Horizon 7的虚拟桌面基础架构的NetApp HCI —为高级用户提供3D图形功能</block>
  <block id="e3162938e0d7b1bbc74111cc5b5871c5" category="paragraph">TR-4792提供了在由NVIDIA图形处理单元(GPU)和虚拟化软件提供支持的VMware Horizon环境中使用NetApp H615C计算节点处理3D图形工作负载的指导。此外、还提供了对H615C的SPECviewperf 13进行的初步测试的结果。</block>
  <block id="1de37c09602b46db5de57a946efe2768" category="paragraph"><block ref="1de37c09602b46db5de57a946efe2768" category="inline-link-macro-rx"></block></block>
  <block id="93b94e62ad8cb02a1d1a7b0944a5445d" category="summary">本文档讨论适用于 VMware vSphere 的 ONTAP 工具的产品安全性。</block>
  <block id="57a033c33a8be6110be46b2914cc4989" category="doc">将ONTAP 与虚拟卷结合使用</block>
  <block id="69556d50c944e0a07ade0bea62f078a3" category="paragraph">要将VVOLS与ONTAP 结合使用、关键在于适用于VMware vSphere虚拟设备的ONTAP 工具附带的VASA Provider软件。</block>
  <block id="5e484430124a3d64541b75bbf3c8f529" category="paragraph">ONTAP 工具还包括vCenter UI扩展、REST API服务器、适用于VMware Site Recovery Manager的存储复制适配器、监控和主机配置工具以及一系列可帮助您更好地管理VMware环境的报告。</block>
  <block id="21247c4392dc3c243f693dbf5b762553" category="section-title">产品和文档</block>
  <block id="4fc5e15c4dc0d227bc5f8f26e4337083" category="paragraph">ONTAP FlexClone许可证(随ONTAP One提供)和ONTAP 工具设备是在NetApp ONTAP 中使用所需的唯一附加产品。最新版本的ONTAP 工具作为一个在ESXi上运行的统一设备提供、可提供以前三个不同设备和服务器的功能。对于vvol、请务必将ONTAP 工具vCenter UI扩展或REST API与提供特定vvol功能的VASA Provider结合使用、作为用于vSphere中ONTAP 功能的常规管理工具和用户界面。传统数据存储库会附带SRA组件、但VMware Site Recovery Manager不会对VVO尔 使用SRA、而是在SRM 8.3及更高版本中实施新服务、从而利用VASA Provider进行VVO尔 复制。</block>
  <block id="bf03408d75f93f6e28c07c3c2300b98a" category="section-title">使用iSCSI或FCP时、可使用ONTAP 工具VASA Provider架构</block>
  <block id="94ef809dc16e728151bda996f8b4f8aa" category="inline-image-macro">ONTAP 工具VASA Provider架构,240</block>
  <block id="d78de3410d86d345a548abdf67aff375" category="paragraph"><block ref="d78de3410d86d345a548abdf67aff375" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5e5421e75636200787a4449a2cdaa1f1" category="section-title">产品安装</block>
  <block id="3ef3033a2b9a744a1e4e7e93fa01f909" category="paragraph">对于全新安装、请将虚拟设备部署到vSphere环境中。当前版本的ONTAP 工具会自动将自身注册到vCenter中、并默认启用VASA Provider。除了ESXi主机和vCenter Server信息之外、您还需要设备的IP地址配置详细信息。如前文所述、VASA Provider要求您已在计划用于VVO尔 的任何ONTAP 集群上安装ONTAP FlexClone许可证。此设备具有一个内置的监视程序来确保可用性、作为最佳实践、应配置VMware高可用性功能和可选的容错功能。有关更多详细信息、请参见第4.1节。请勿将ONTAP 工具设备或vCenter Server设备(VCSAS)安装或移动到VVOl存储中、因为这样可能会阻止设备重新启动。</block>
  <block id="6a5c862f634c8967f7246f42eb9de6e1" category="paragraph">可以使用可从NetApp 支持站点 (NSS)下载的升级ISO文件原位升级ONTAP 工具。按照《部署和设置指南》说明升级设备。</block>
  <block id="3c07c9b4b562a16890d9fee571f0441e" category="inline-link">适用于VMware vSphere的ONTAP 工具规模估算指南</block>
  <block id="e4e51979718d88ce483f9477be981a76" category="paragraph">要估算虚拟设备的规模并了解配置限制、请参阅以下知识库文章：<block ref="a75738ed95b0811ed0edd1b8ef0d9568" category="inline-link-rx"></block></block>
  <block id="72333dadacbc964761fb14f718f6d411" category="section-title">产品文档</block>
  <block id="e0644c46fdc2ced2c094f7db15e15a8a" category="paragraph">以下文档可帮助您部署ONTAP 工具。</block>
  <block id="09e308ed60d47b80b6cd16eb233f1bb9" category="inline-link">有关完整的文档库和amp；#44；请访问docs.netapp.com链接</block>
  <block id="7f21741a70426baea3ee41488da86af4" category="paragraph"><block ref="56b49132b20e341764c8aa067751e8a5" category="inline-link-rx"></block></block>
  <block id="be11c74c1dd7f307bb80183a90dc2067" category="section-title">入门</block>
  <block id="7d0ee6fed10d3d4e5c9ee496729ab519" category="inline-link">发行说明</block>
  <block id="2645deadffb8af180b8a35da3d034ad8" category="list-text"><block ref="2645deadffb8af180b8a35da3d034ad8" category="inline-link-rx"></block></block>
  <block id="b1555cd6358e57b76c72e343dbe31846" category="inline-link">了解适用于VMware vSphere的ONTAP 工具</block>
  <block id="a0aaeda90fe2ef02fba791bc7c35645c" category="list-text"><block ref="a0aaeda90fe2ef02fba791bc7c35645c" category="inline-link-rx"></block></block>
  <block id="e695b432b77d6bddfcb785c76f5e5442" category="inline-link">ONTAP 工具快速入门</block>
  <block id="324b0410f22fb210bbf88e1ee7e97428" category="list-text"><block ref="324b0410f22fb210bbf88e1ee7e97428" category="inline-link-rx"></block></block>
  <block id="3d7fe3e43f9f24fffe5ed0d546d12f13" category="inline-link">部署 ONTAP 工具</block>
  <block id="354336d78d1f0a156dcd5221d341dfd0" category="list-text"><block ref="354336d78d1f0a156dcd5221d341dfd0" category="inline-link-rx"></block></block>
  <block id="a2fa58344be7fbd9a2be0320a8df0f77" category="inline-link">升级 ONTAP 工具</block>
  <block id="33a77e1014f1325d6ba19639a6c95d48" category="list-text"><block ref="33a77e1014f1325d6ba19639a6c95d48" category="inline-link-rx"></block></block>
  <block id="21e2a89d708329706ec6ed3fc989a1f6" category="section-title">使用 ONTAP 工具</block>
  <block id="91a9cfdbaaa44e0a9ad72e92533f763f" category="inline-link">配置传统数据存储库</block>
  <block id="f27fe8f858d8a91950e214753b95722c" category="list-text"><block ref="f27fe8f858d8a91950e214753b95722c" category="inline-link-rx"></block></block>
  <block id="fc7d7e475ac8c3868d7426bb41df9b09" category="inline-link">配置 VVOL 数据存储库</block>
  <block id="0c2552c3930f472b2d120f30d7aa0415" category="list-text"><block ref="0c2552c3930f472b2d120f30d7aa0415" category="inline-link-rx"></block></block>
  <block id="317bbf73ff27c5f981628c8fb83ebf22" category="inline-link">配置基于角色的访问控制</block>
  <block id="644ae78061acbb2254be4de3ea454b06" category="list-text"><block ref="644ae78061acbb2254be4de3ea454b06" category="inline-link-rx"></block></block>
  <block id="48bc2d028cb2a507ef974230ca3ba793" category="inline-link">配置远程诊断</block>
  <block id="fc0330812838aba14025bd70d41b943d" category="list-text"><block ref="fc0330812838aba14025bd70d41b943d" category="inline-link-rx"></block></block>
  <block id="641e9457539249e880725760f91d5ee2" category="inline-link">配置高可用性</block>
  <block id="5027a18a60c68e05df84cd699af74497" category="list-text"><block ref="5027a18a60c68e05df84cd699af74497" category="inline-link-rx"></block></block>
  <block id="04edeb5424c826c14a69edb777edf395" category="section-title">保护和管理数据存储库</block>
  <block id="e17534281670c5ea4e8d55420a63c98f" category="inline-link">保护传统数据存储库</block>
  <block id="c8ac931d575d89c007212a35c8dde74c" category="list-text"><block ref="8f91d2113ff32de18906bad1cd446b0d" category="inline-link-rx"></block> 使用SRM</block>
  <block id="bff05cbbc19cad2bd10b9fe25dc34a1b" category="inline-link">保护基于虚拟卷的虚拟机</block>
  <block id="710b15d782f0c2c0411066b86644a12d" category="list-text"><block ref="7741c74d7508dc983fa4af0dff0bdda1" category="inline-link-rx"></block> 使用SRM</block>
  <block id="5267febc97a2cc385cc5c73995dc64df" category="inline-link">监控传统数据存储库和虚拟机</block>
  <block id="bac3b262bb348a54f9986c2b5dbf6024" category="list-text"><block ref="bac3b262bb348a54f9986c2b5dbf6024" category="inline-link-rx"></block></block>
  <block id="3123ece3c3b36f605758cb0c9a28f904" category="inline-link">监控 VVOL 数据存储库和虚拟机</block>
  <block id="75c07b623699e1947d011983a7823584" category="list-text"><block ref="75c07b623699e1947d011983a7823584" category="inline-link-rx"></block></block>
  <block id="73751ced5959ea3089346b01d42dde76" category="paragraph">除了产品文档之外、还有一些可能有用的支持知识库文章。</block>
  <block id="dd5138e8a4207a5b2fde43b411a4b5e1" category="section-title">VASA Provider信息板</block>
  <block id="6da01a643ea28efe37fa2d6fd06a634b" category="paragraph">VASA Provider包括一个信息板、其中包含各个VVO尔VM的性能和容量信息。此信息直接来自ONTAP 中有关VVOL文件 和LUN的信息、包括前5个虚拟机的延迟、IOPS、吞吐量和正常运行时间以及前5个数据存储库的延迟和IOPS。使用ONTAP 9.7或更高版本时、默认情况下会启用此功能。检索初始数据并将其显示在信息板中可能需要长达30分钟的时间。</block>
  <block id="9b78e1fecb2bcc40733f2180691c7507" category="section-title">ONTAP 工具的虚拟卷信息板</block>
  <block id="4adf016da96258b45a1cf762298729b5" category="inline-image-macro">ONTAP 工具、vols信息板、400</block>
  <block id="73c1e14ddf3f32984f869ac3f122b2ca" category="paragraph"><block ref="73c1e14ddf3f32984f869ac3f122b2ca" category="inline-image-macro-rx" type="image"></block></block>
  <block id="cd47dd01745339787e4c7300389401f2" category="section-title">最佳实践</block>
  <block id="9ae938622297e9d4b14dd0006a8f0bf4" category="paragraph">*限制*</block>
  <block id="b4f52a4fd0b07c9d904b95fc98a1cd45" category="inline-link">配置最大值</block>
  <block id="bc8259e306c73b2969e7ac6297000e64" category="paragraph">一般来说、ONTAP 支持VMware定义的vvol限制(请参见已发布的<block ref="a6efdd9b1a19df6105024b4869e0582b" category="inline-link-rx"></block>）。下表汇总了ONTAP 在大小和数量方面的特定限制。请始终检查<block ref="bb9c67b5a4c15a85b5e6aa6c9afd0285" category="inline-link-rx"></block> 更新了有关LUN和文件数量和大小的限制。</block>
  <block id="9b7ad553354519b31ec860eef39e5f6b" category="paragraph">* ONTAP 虚拟卷限制*</block>
  <block id="130b78bfd6c9b050a912fec77e285e3f" category="cell">容量 / 功能</block>
  <block id="6231ad61105cd983d3f0042762d3233d" category="cell">SAN (SCSI或NVMe-oF)</block>
  <block id="75d4e7871261a858356a58d682ab71de" category="cell">最大卷大小</block>
  <block id="9cfd7100738cee4daf7acd5e01d31e14" category="cell">62 TiB*</block>
  <block id="9a728251ad1e90577975ae9395374772" category="cell">每个FlexVol 卷的最大虚拟卷数</block>
  <block id="021bbc7ee20b71134d53e20206bd6feb" category="cell">1024</block>
  <block id="46ba990c143630f55072434a6ea958c0" category="cell">20亿</block>
  <block id="cdbcf58620f0b4b0bbf3291386a99407" category="cell">每个ONTAP 节点的最大虚拟卷数</block>
  <block id="342264031889898ec1a553b4dd58d98c" category="cell">最多12 288个**</block>
  <block id="659e5faa0bdb08327ba0719230e95be2" category="cell">500亿</block>
  <block id="43b49f27d93c6f55f54a68e8983d5479" category="cell">每个ONTAP 对的最大虚拟卷数</block>
  <block id="3941694d19c2d1fc406f055ab62cb9eb" category="cell">最多24 576个**</block>
  <block id="d6b3e65f296fd23975dd6f1a915c4b22" category="cell">每个ONTAP 集群的最大虚拟卷数</block>
  <block id="2702ff8627a3990fc940d6f53463925e" category="cell">最多98、304个**</block>
  <block id="4f0c25d6c688cf50460d11fecaa97fa8" category="cell">无特定集群限制</block>
  <block id="855ecc47bb0d239e1fdf6fee84e24c75" category="cell">最大QoS对象数(共享策略组和单个虚拟卷服务级别)</block>
  <block id="26890bd9dcb27c05f1ab5bcc859501b8" category="cell">12、000到ONTAP 9.3；40、000到ONTAP 9.4及更高版本</block>
  <block id="0e38f856cb713ce9eea79fa1c6b7dc32" category="list-text">大小限制取决于运行ONTAP 9.12.1P2及更高版本的ASA 系统或AFF 和FAS 系统。</block>
  <block id="d27c43bb3cdcbfa3852bb91192ffb849" category="list-text">SAN VMvol (NVMe命名库或LUN)的数量因平台而异。请始终检查<block ref="bb9c67b5a4c15a85b5e6aa6c9afd0285" category="inline-link-rx"></block> 更新了有关LUN和文件数量和大小的限制。</block>
  <block id="72e0ee397942f7233122887584f94b8b" category="paragraph">在vSphere中使用ONTAP vvol非常简单、并且遵循已发布的vSphere方法(请参见适用于您的ESXi版本的VMware文档中的在vSphere存储下使用虚拟卷)。以下是与ONTAP 结合使用时需要考虑的一些其他实践。</block>
  <block id="83583580d98b69cb8317f9b285f3c8df" category="cell">*使用适用于VMware vSphere的UI扩展或REST API的ONTAP 工具来配置vvol数据存储库*和协议端点*</block>
  <block id="9507d4f97aceb8d05fc962dd53f082af" category="cell">虽然可以使用常规vSphere界面创建vvol数据存储库、但使用ONTAP工具将根据需要自动创建协议端点、并根据您定义的存储功能配置文件根据ONTAP最佳实践创建FlexVol卷。只需右键单击主机/集群/数据中心、然后选择_ ONTAP tools_和_配置数据存储库_。您只需在向导中选择所需的卷选项即可。</block>
  <block id="e8d5f9dc0bff953a9e59755813c7e8bf" category="cell">*切勿将ONTAP 工具设备或vCenter Server设备(VCSA)存储在其所管理的VVOLs数据存储库中。*</block>
  <block id="c6ac0465bff03857ee851d98f6bd782b" category="cell">如果您需要重新启动设备、因为它们在重新启动期间无法重新绑定自己的虚拟卷、这可能会导致出现"鸡肉和鸡蛋的情况"。您可以将其存储在由其他ONTAP 工具和vCenter部署管理的Vvol数据存储库中。</block>
  <block id="ab8d352870fb5334773c7177d3d5dcd1" category="cell">*避免在不同ONTAP 版本之间执行虚拟卷操作。*</block>
  <block id="8b2bcef781b7e1f6d64739147d50aae7" category="cell">VASA Provider的各个版本中支持的存储功能(例如QoS、特性等)发生了变化、其中一些功能取决于ONTAP 版本。在ONTAP 集群中使用不同版本或在具有不同版本的集群之间移动虚拟卷可能会导致意外行为或合规性警报。</block>
  <block id="b2da0eca57c759eff034e6fe26f153e6" category="cell">*对光纤通道网络结构进行分区、然后再对其使用NVMe/FC或FCP来创建卷。*</block>
  <block id="cd7bf0e1e61341c1aa3fa23401af8a27" category="inline-image-macro">具有四个节点的单个启动程序分区、400</block>
  <block id="51591d05b7e084ba8e5ae7f63172177e" category="inline-link">_TR-4080：《现代SAN ONTAP 9_最佳实践》</block>
  <block id="c1723e6a0e1d3dd28232b33e0cb6e61d" category="inline-link">_TR-4684使用NVMe-oF实施和配置现代SAN</block>
  <block id="9a36c8f0464a7ffce114044f1859c7ff" category="cell">*根据需要规划您的后备FlexVol。*</block>
  <block id="03d2e894fa9a05efefa4e8d6b2008a19" category="cell">最好向您的ONTAP 数据存储库添加多个后备卷、以便在集群中分布工作负载、支持不同的策略选项或增加允许的LUN或文件数量。但是、如果需要最大的存储效率、请将所有备份卷放在一个聚合上。或者、如果需要最大的克隆性能、则可以考虑使用一个FlexVol 卷、并将模板或内容库保留在同一个卷中。VASA Provider会将许多VVOLs存储操作(包括迁移、克隆和快照)卸载到ONTAP。如果在一个FlexVol 卷中执行此操作、则会使用节省空间的文件克隆、并且这些克隆几乎可以即时使用。在FlexVol 卷之间执行此操作时、这些副本可以快速可用并使用实时重复数据删除和数据压缩、但只有在使用后台重复数据删除和数据压缩的卷上运行后台作业后、才能最大程度地恢复存储效率。根据源和目标、某些效率可能会降级。</block>
  <block id="80b15469535d95a1690f308427545c7e" category="cell">*保持存储功能配置文件(SCP)简单。*</block>
  <block id="33e2905cb722c14575a9bff81ba78b39" category="cell">通过将功能设置为任何、避免指定不需要的功能。这样可以最大程度地减少选择或创建FlexVol 卷时出现的问题。例如、在VASA Provider 7.1及更早版本中、如果将数据压缩保留在默认SCP设置为No、则会尝试禁用数据压缩、即使在AFF 系统上也是如此。</block>
  <block id="5a6d5fdddf6fbd82f1952b532b03c9ef" category="cell">*使用默认的SCP作为示例模板来创建您自己的模板。*</block>
  <block id="ee3cbda1c3c4a14ae024478c7ada6d11" category="cell">*遵循所有协议最佳实践。*</block>
  <block id="6a2c1ac1da51eca0c1a65afffab8dfab" category="inline-image-macro">使用基于NFS v3、500的vvol进行网络配置</block>
  <block id="6cacb3f1edd09835a2ad07d72f488e2a" category="paragraph">二十年来、NetApp ONTAP软件一直是适用于VMware vSphere环境的领先存储解决方案、并不断增加创新功能、以简化管理并降低成本。</block>
  <block id="918febfed3d070cf1250909e5cdcf31d" category="paragraph">本文档介绍了适用于VMware vSphere虚拟卷(vvol)的ONTAP 功能、包括最新的产品信息和用例以及最佳实践和其他可简化部署和减少错误的信息。</block>
  <block id="c7448b194ba68bddce48f1d11d5d7db7" category="admonition">本文档将取代先前发布的技术报告_TR-4400：《使用NetApp ONTAP的VMware vSphere虚拟卷(Vvol)》_</block>
  <block id="d30f04665be7a6d9663004b1b5e61a9a" category="paragraph">最佳实践是指南和兼容性列表等其他文档的补充。它们是根据 NetApp 工程师和客户的实验室测试和丰富的现场经验开发的。它们可能不是唯一有效或受支持的实践、但通常是最简单的解决方案、可满足大多数客户的需求。</block>
  <block id="b010d2e253827dbb44b7ba4e1332e24e" category="admonition">本文档已进行更新、加入了vSphere 8.0 Update 1中的新vvol功能、这些功能在ONTAP 工具9.12版本中受支持。</block>
  <block id="cc713c330b9c4e00d3ed7233bc54a889" category="section-title">虚拟卷(Virtual Volume、Virtual Volume、Virtual Volume)概述</block>
  <block id="64f0863a7fb5f52a7ac6a911e1ad6862" category="paragraph">NetApp于2012年开始与VMware合作、为适用于vSphere 5的vSphere APIS for Storage AWARMIVAIVAICHUIAICHUDE(VASA )提供支持。通过早期的VASA Provider、可以在配置文件中定义存储功能、这些功能可用于在配置时筛选数据存储库、并在此后检查是否符合策略。随着时间的推移、这种情况不断发展、增加了一些新功能、以便在配置以及添加虚拟卷或vvol (其中、各个存储对象用于虚拟机文件和虚拟磁盘)方面实现更大的自动化。这些对象可以是LUN和文件、现在在vSphere 8中、NVMe namespaces.NetApp与VMware密切合作、作为2015年随vSphere 6发布的vvol的参考合作伙伴、并再次作为在vSphere 8中基于网络结构使用NVMe的vvol的设计合作伙伴。NetApp将继续增强ONTAP 以利用其最新功能。</block>
  <block id="cbf0aa9daeb855e4eace1a3bdc474ce2" category="paragraph">需要注意以下几个组件：</block>
  <block id="e2f6b83160ea0712fbc59dd84410c4b2" category="cell">*VASA Provider*</block>
  <block id="919601826e1d58bccaaab76d787871d2" category="cell">这是一个软件组件、用于处理VMware vSphere与存储系统之间的通信。对于ONTAP 、VASA Provider在一种称为适用于VMware vSphere的ONTAP 工具(简称ONTAP 工具)的设备中运行。ONTAP 工具还包括一个vCenter插件、一个适用于VMware Site Recovery Manager的存储复制适配器(Storage Replication Adapter、SRA)以及用于构建您自己的自动化的REST API服务器。配置ONTAP 工具并将其注册到vCenter后、几乎不再需要直接与ONTAP 系统交互、因为几乎所有存储需求都可以直接在vCenter UI中进行管理、或者通过REST API自动化进行管理。</block>
  <block id="05ad8543ff165c6b8cd0cc5e976d3245" category="cell">*协议端点(PE)*</block>
  <block id="3b2cd9018385f55c53c9a8b756df8bb5" category="cell">协议端点是ESXi主机和VMware数据存储库之间的I/O代理。ONTAP VASA Provider会自动创建这些LUN、可以是VVOL数据存储库的每个FlexVol卷一个协议端点LUN (大小为4 MB)、也可以是托管此数据存储库中的FlexVol卷的存储节点上的每个NFS接口(NFS挂载点、LIF)一个。ESXi主机直接装载这些协议端点、而不是装载单个VVOLLUN和虚拟磁盘文件。协议端点由VASA Provider自动创建、挂载、卸载和删除、因此无需对这些端点进行管理、同时也无需管理任何必要的接口组或导出策略。</block>
  <block id="d3f051e8316cfd36651af1e65be24a75" category="cell">*虚拟协议端点(VPE)*</block>
  <block id="71afca0aa1a505ea2ac3ce5a1a681549" category="paragraph">vSphere 8中的新增功能是、在将基于网络结构的NVMe (NVMe-oF)与vvol结合使用时、协议端点的概念在ONTAP 中不再适用。相反、ESXi主机会在第一个虚拟机启动后自动为每个ANA组建立虚拟PE。ONTAP 会自动为数据存储库使用的每个FlexVol 卷创建ANA组。</block>
  <block id="8202498953d2ebcf9968c37a7e47f4f6" category="paragraph">使用NVMe-oF for VVOLs的另一个优势是、VASA Provider不需要任何绑定请求。相反、ESXi主机会根据VPE在内部处理VVOl绑定功能。这样可以减少VVOV绑定风暴影响服务的机会。</block>
  <block id="70532c0374111d897ef1176b34b6396c" category="inline-link">NVMe和虚拟卷</block>
  <block id="50ec55042a7f4e8c2c66219ac096cfb3" category="inline-link">vmware.com</block>
  <block id="113c9d4e642d1ba4cc469267fb7fd0de" category="paragraph">有关详细信息，请参见<block ref="f8d477cd77073d731aafe4f52026608a" category="inline-link-rx"></block> 开启<block ref="1f1565cca975c4a703345d21e7f273b8" category="inline-link-rx"></block></block>
  <block id="61def0b14af00df4eb90bcd79d858a8b" category="cell">*虚拟卷数据存储库*</block>
  <block id="b945cda41d7a84e7152e09343a17cbe6" category="cell">虚拟卷数据存储库是由VASA Provider创建和维护的VVOl容器的逻辑数据存储库表示形式。容器表示从由VASA Provider管理的存储系统配置的存储容量池。ONTAP 工具支持将多个FlexVol 卷(称为后备卷)分配给一个数据存储库、这些FlexVol数据存储库可以跨越ONTAP 集群中的多个节点、从而将具有不同功能的闪存和混合系统组合在一起。管理员可以使用配置向导或REST API创建新的FlexVol 卷、或者选择预创建的FlexVol 卷作为后备存储(如果有)。</block>
  <block id="c25d2cc7c6540f6ac98af67455eecc39" category="cell">*虚拟卷(Vvol)*</block>
  <block id="9664cdf7951789389813facac649fec1" category="cell">虚拟卷是指存储在虚拟卷数据存储库中的实际虚拟机文件和磁盘。术语VVOL(单个)是指单个特定文件、LUN或命名空间。ONTAP 会根据数据存储库使用的协议创建NVMe命名空间、LUN或文件。Vvol有几种不同的类型；最常见的类型是配置(元数据文件)、数据(虚拟磁盘或VMDK)和交换(在启动VM时创建)。受VMware VM加密保护的Vvol的类型为其他。不应将VMware VM加密与ONTAP 卷或聚合加密相混淆。</block>
  <block id="937251054fa0c1a7b946f8928cc857b9" category="section-title">基于策略的管理</block>
  <block id="34d2b7d8b570ede7a638d070656b7b81" category="paragraph">通过VMware vSphere APIS for Storage AWARMIVAIVIAPI(VASA)、VM管理员可以轻松地使用配置VM所需的任何存储功能、而无需与其存储团队进行交互。在使用VASA之前、VM管理员可以定义VM存储策略、但必须与其存储管理员一起确定适当的数据存储库、通常使用文档或命名约定。通过使用VASA、具有适当权限的vCenter管理员可以定义一系列存储功能、然后vCenter用户可以使用这些功能来配置VM。通过在VM存储策略和数据存储库存储功能配置文件之间进行映射、vCenter可以显示兼容数据存储库列表以供选择、并支持Aria (以前称为vReise) Automation或Tanzu Kubernetes Grid等其他技术自动从分配的策略中选择存储。这种方法称为基于存储策略的管理。虽然存储功能配置文件和策略也可用于传统数据存储库、但我们在此重点关注的是虚拟卷数据存储库。</block>
  <block id="631bdc7de6608fd57c3fa0b397c3c26f" category="paragraph">有两个要素：</block>
  <block id="a156a7f38a3727ce705b5466eb11e0bf" category="cell">*存储功能配置文件(SCP)*</block>
  <block id="43a258e66ca875fa9c5d3e35e06ba2b7" category="cell">存储功能配置文件(SCP)是一种存储模板形式、通过该模板、vCenter管理员可以定义所需的存储功能、而无需实际了解如何在ONTAP 中管理这些功能。通过采用模板模式方法、管理员可以轻松地以一致且可预测的方式提供存储服务。SCP中介绍的功能包括性能、协议、存储效率和其他功能。具体功能因版本而异。它们是使用vCenter UI中的适用于VMware vSphere的ONTAP 工具菜单创建的。您还可以使用REST API创建SCP。它们可以通过选择各个功能手动创建、也可以从现有(传统)数据存储库中自动生成。</block>
  <block id="8f50a0757d99fe5dd0df8d19478d4921" category="cell">*VM存储策略*</block>
  <block id="f99c5cf9298b040025bd3dfe966cb86e" category="cell">VM存储策略在vCenter中的策略和配置文件下创建。对于虚拟卷、请使用NetApp虚拟卷存储类型提供程序中的规则创建一个规则集。ONTAP 工具提供了一种简化的方法、您只需选择SCP、而无需强制指定各个规则。</block>
  <block id="5dda8b04866334dc92ee08001b15701a" category="paragraph">如上所述、使用策略有助于简化配置卷的任务。只需选择一个适当的策略、VASA Provider就会显示支持该策略的VVOs数据存储库、并将VVOV放入一个合规的FlexVol 卷中(图1)。</block>
  <block id="2ce0d6ec59cca7e0b6e0bdc389301e63" category="section-title">使用存储策略部署虚拟机</block>
  <block id="e0795f8b847058e171dec5a519757ece" category="image-alt">使用存储策略部署虚拟机</block>
  <block id="f0d0f0a6174a5a9dde27782042e22ccf" category="paragraph">配置VM后、VASA Provider将继续检查合规性、并在后备卷不再符合策略时在vCenter中向VM管理员发出警报(图2)。</block>
  <block id="941431bc1cecb0ec5e89e78e9a5a96fc" category="section-title">虚拟机存储策略合规性</block>
  <block id="bfd6dec22a6a1724ff1b67f1f289cdfc" category="image-alt">虚拟机存储策略合规性</block>
  <block id="e08bc5b354c3e8058003a662e0f7cade" category="section-title">NetApp虚拟卷支持</block>
  <block id="234ad0324c313ec05d0fa6fe8d430967" category="paragraph">自2012年首次发布以来、NetApp ONTAP 便一直支持此VASA规范。虽然其他NetApp存储系统可能支持VASA、但本文档重点介绍当前受支持的ONTAP 9版本。</block>
  <block id="7b02ea300aef2e0bff0d7f6111053284" category="section-title">NetApp ONTAP</block>
  <block id="4d53a8e49ac64213ffccdd970a35171e" category="paragraph">除了AFF 、ASA 和FAS 系统上的ONTAP 9之外、NetApp还支持ONTAP Select 上的VMware工作负载、Amazon FSx for NetApp ONTAP 与VMware Cloud on AWS、Azure NetApp Files 与Azure VMware解决方案 、Cloud Volumes Service 与Google Cloud VMware Engine以及Equinox中的NetApp私有存储。 但是、具体功能可能会因服务提供商和可用网络连接而异。此外、vSphere子系统还可以访问这些配置以及Cloud Volumes ONTAP 中存储的数据。</block>
  <block id="9fe1fd556b933358881222d5c3da127c" category="paragraph">在本报告发布时、超规模云环境仅限于传统NFS v3数据存储库、因此、Vvol仅适用于内部ONTAP 系统或提供内部系统全部功能的云连接系统、例如由全球NetApp合作伙伴和服务提供商托管的系统。</block>
  <block id="274bc582ca884fc158ea9ac9f79f9067" category="inline-link">ONTAP 产品文档</block>
  <block id="5ca60fe92dec435059ba5acefa4ce2c9" category="paragraph">_有关ONTAP 的详细信息，请参见<block ref="8a9b15dc18a16e0b1acfa438e27f6aa6" category="inline-link-rx"></block>_</block>
  <block id="3dffa984dadf9ff0006ee9cebd3b04b9" category="inline-link">TR-4597</block>
  <block id="9a03bb7ec5329e35d98c7b12b63c4df0" category="paragraph">_有关ONTAP 和VMware vSphere最佳实践的详细信息、请参见<block ref="fc9815e7b1405959c49ad47e9a23e3a5" category="inline-link-rx"></block>_</block>
  <block id="d3fb76da5fbbcd6fa32e40910b5b9a47" category="section-title">将ONTAP与虚拟卷结合使用的优势</block>
  <block id="d0f004282063136e91d76d1d43d7c95f" category="paragraph">VMware在2015年将VVOL支持引入到了ASA 2.0中、他们将其称为"一个集成和管理框架、为外部存储(SAN/NAS)提供了新的运营模式。" 此操作模式与ONTAP 存储相结合、可提供多种优势。</block>
  <block id="6a74f7c0a9021e009a9c030e54084978" category="paragraph">如第1.2节所述、基于策略的管理允许使用预定义的策略配置VM、然后对其进行管理。这可以从几个方面帮助IT运营：</block>
  <block id="e0eb51b6d319e14c2fbfc1f628021a26" category="list-text">*加快速度。* ONTAP 工具无需vCenter管理员向存储团队开立存储配置活动的服务单。但是、vCenter和ONTAP 系统中的ONTAP 工具RBAC角色仍然允许独立的团队(例如存储团队)、或者允许同一团队通过根据需要限制对特定功能的访问来进行独立的活动。</block>
  <block id="3f4dbd6687bd0d55bf69fe5fdd0137c4" category="list-text">*更智能的配置。*存储系统功能可通过VASAAPI公开、使配置工作流可以利用高级功能、而虚拟机管理员无需了解如何管理存储系统。</block>
  <block id="a13fcc9220d042cae454e9ac073636ca" category="list-text">*配置速度更快。*单个数据存储库可支持不同的存储功能、并根据虚拟机策略自动为虚拟机选择相应的存储功能。</block>
  <block id="eb4c052226108afebf26e670208b9a55" category="list-text">*避免出错。*存储和VM策略是提前制定的、并根据需要应用、而无需在每次配置VM时自定义存储。如果存储功能偏离定义的策略、则会发出合规警报。如前文所述、通过使用SCP、初始配置可预测且可重复、而根据SCP制定VM存储策略可确保准确放置。</block>
  <block id="9c520768a1d84268417335cf19a423b9" category="list-text">*更好的容量管理。*通过使用VASA和ONTAP 工具、可以根据需要查看低至细小聚合级别的存储容量、并在容量开始不足时提供多层警报。</block>
  <block id="f9878e32fdf258284c007eaae38773cd" category="section-title">在现代SAN上进行VM粒度管理</block>
  <block id="7e673a7c12cc256f29bcd7b2028d9d5a" category="paragraph">使用光纤通道和iSCSI的SAN存储系统是VMware支持的第一个ESX存储系统、但它们无法从存储系统管理各个VM文件和磁盘。而是配置LUN、并由VMFS管理各个文件。这样、存储系统就很难直接管理各个VM的存储性能、克隆和保护。利用ONTAP 强大的高性能SAN功能、虚拟卷可以为使用NFS存储的客户带来已有的存储粒度。</block>
  <block id="25a46370807e0eab0dfe3853abfb9b6e" category="paragraph">现在、借助适用于VMware vSphere 9.12及更高版本的vSphere 8和ONTAP 工具、在使用基于网络结构的NVMe的现代光纤通道SAN中、可以使用vvol对基于SCSI的传统协议所使用的相同粒度控制、从而获得更大的规模化性能。借助vSphere 8.0 Update 1、现在可以使用vvol部署完整的端到端NVMe解决方案 、而无需在虚拟机管理程序存储堆栈中进行任何I/O转换。</block>
  <block id="f61f57f748f5f0b52c7f11f1f1bd43f0" category="section-title">更出色的存储卸载功能</block>
  <block id="911fa02c34dda38cd69be06e524ed9d0" category="inline-link">效率担保</block>
  <block id="3170031d77f241bc872afcb490c0a806" category="paragraph">虽然VAAI提供了多种卸载到存储的操作、但VASA Provider可以解决一些差距。SAN VAAI无法将VMware托管的快照卸载到存储系统。NFS VAAI可以卸载VM托管的快照、但使用存储本机快照的VM存在一些限制。由于Vvol会对虚拟机磁盘使用单个LUN、命名空间或文件、因此ONTAP 可以快速高效地克隆文件或LUN、以创建不再需要增量文件的VM粒度快照。NFS VAAI也不支持卸载热(已启动) Storage vMotion迁移的克隆操作。在将VAAI与传统NFS数据存储库结合使用时、必须关闭VM电源、以实现迁移负载分流。ONTAP 工具中的VASA Provider支持近乎即时的高效存储克隆、用于热迁移和冷迁移、还支持近乎即时的副本、以便跨卷迁移VVO尔。由于具有这些显著的存储效率优势、您可以充分利用下的虚拟卷工作负载<block ref="9d1af7a9d4f98887e53c1a9bedbce044" category="inline-link-rx"></block> 计划。同样、如果使用VAAI的跨卷克隆不能满足您的要求、您或许能够通过改进Vvol的复制体验来解决业务挑战。</block>
  <block id="a8567b4dc683947384ef2e1dd0fc6ac1" category="section-title">常见的卷使用情形</block>
  <block id="48e535b80538b088fd868fde9372715c" category="paragraph">除了这些优势之外、我们还会看到VVOV存储的以下常见使用情形：</block>
  <block id="441f01ec38e91fad1b235a0e7422a178" category="list-text">*按需配置虚拟机*</block>
  <block id="bd652a918164d8fa5176b5f9b92c2e61" category="list-text">私有云或服务提供商的IaaS。</block>
  <block id="fddccd9595370687015a5ab02bcff60f" category="list-text">通过Aria (原vReise)套件、OpenStack等利用自动化和流程编排</block>
  <block id="4fbc1141a40f5259e3ab1545de52b1ea" category="list-text">*一流磁盘(FCD)*</block>
  <block id="e83f2e4e8676ee8faac4d6af599fd7e7" category="list-text">VMware Tanzu Kubernetes Grid [TKG]永久性卷。</block>
  <block id="b2b81490f2245d3d566e0ccc6a29cfc2" category="list-text">通过独立的VMDK生命周期管理提供类似于Amazon EBS的服务。</block>
  <block id="2511e4e8cbb72027ae20f24008d4b939" category="list-text">*按需配置临时虚拟机*</block>
  <block id="eeb1044cc319a5d53503e45dbf762291" category="list-text">测试/开发实验室</block>
  <block id="858d314810762abccaa7baf230e3dc18" category="list-text">培训环境</block>
  <block id="ab7bbc294bf0f0354980a3014e8f4219" category="section-title">使用卷的常见优势</block>
  <block id="ccd6ea8c57e93a5401d07aab9c60f371" category="paragraph">在充分发挥其优势时(例如在上述使用情形中)、此类卷可提供以下具体改进：</block>
  <block id="13491b3af50183642ea0035b2d1f95f9" category="list-text">克隆可以在一个卷内或ONTAP 集群中的多个卷之间快速创建、与启用了VAAI的传统克隆相比、这是一个优势。它们还具有高效存储的特点。卷中的克隆会使用ONTAP文件克隆、这与FlexClone卷类似、只会存储源VVOL/LUN /命名空间中的更改。因此、可以快速创建用于生产或其他应用程序目的的长期VM、占用的空间极少、并可受益于VM级别保护(使用适用于VMware vSphere的NetApp SnapCenter 插件、VMware托管快照或VADP备份)和性能管理(使用ONTAP QoS)。</block>
  <block id="1c21847cdc5616af138ba0c03aad7adb" category="list-text">在将TKG与vSphere CSI结合使用时、Vvol是理想的存储技术、可提供由vCenter管理员管理的离散存储类和容量。</block>
  <block id="d5f068caef73978a5483badd927a7e98" category="list-text">类似于Amazon EBS的服务可以通过FCD提供、因为顾名思义、FCD VMDK是vSphere中的一流公民、其生命周期可以独立于可能连接到的VM进行管理。</block>
  <block id="7e7040600922b2a78715f856613a3c08" category="doc">保护卷</block>
  <block id="de92c927f248723e4668aec459709995" category="section-title">VASA Provider高可用性</block>
  <block id="f4d4cb8868f07cad16bd7de7e36c5201" category="paragraph">NetApp VASA Provider与vCenter插件和REST API服务器(以前称为Virtual Storage Console [VSC])以及Storage Replication Adapter一起作为虚拟设备的一部分运行。如果VASA Provider不可用、则使用vvol的VM将继续运行。但是、无法创建新的vvol数据存储库、也无法创建vvol或将其绑定到vSphere。这意味着、由于vCenter无法请求创建交换vVol、因此无法启动使用vVol的VM。并且正在运行的VM无法使用vMotion迁移到其他主机、因为vvol无法绑定到新主机。</block>
  <block id="3958bf41787d7fcc6a9f8dd9348c947f" category="paragraph">VASA Provider 7.1及更高版本支持一些新功能、可确保服务在需要时可用。它包括用于监控VASA Provider和集成数据库服务的新监视程序进程。如果检测到故障、则会更新日志文件、然后自动重新启动服务。</block>
  <block id="1acc458c695b0d3dfbf588309801fda2" category="paragraph">vSphere管理员必须使用与保护其他任务关键型VM免受软件、主机硬件和网络故障影响相同的可用性功能来配置进一步的保护。要使用这些功能、无需对虚拟设备进行其他配置；只需使用标准vSphere方法进行配置即可。它们已通过测试、并受NetApp支持。</block>
  <block id="ff43afff832597ff45e5abeab2826ccf" category="inline-link">适用于VMware vSphere的ONTAP 工具文档(为ONTAP 工具配置高可用性)</block>
  <block id="d516ca4c9c18446a82d9fc9ee85bd955" category="paragraph">vSphere High Availability可轻松配置为在发生故障时在主机集群中的另一主机上重新启动虚拟机。vSphere Fault Tolvance可通过创建一个持续复制并可随时接管的二级虚拟机来提高可用性。有关这些功能的追加信息 、请参见<block ref="b6d78cbf1d5afb52929c529b32a350ad" category="inline-link-rx"></block>以及VMware vSphere文档(请在ESXi和vCenter Server下查找vSphere可用性)。</block>
  <block id="97ba24d475ff6fdc7743099992cc301f" category="paragraph">ONTAP 工具VASA Provider会自动实时将vvol配置备份到托管ONTAP 系统、其中vvol信息存储在FlexVol 卷元数据中。如果ONTAP 工具设备因任何原因而不可用、您可以轻松快速地部署新设备并导入配置。有关VASA Provider恢复步骤的详细信息、请参见此知识库文章：</block>
  <block id="6799b6ec743f9159edf3b43790210a11" category="inline-link">如何执行VASA Provider灾难恢复—解决方案指南</block>
  <block id="9462790a7557a7eb2fe9daad4b875817" category="paragraph"><block ref="9462790a7557a7eb2fe9daad4b875817" category="inline-link-rx"></block></block>
  <block id="029a7740ecd792264454f9dbe194e980" category="section-title">卷复制</block>
  <block id="c7b26217fd0c9041b6f779a0f669de5c" category="paragraph">许多ONTAP 客户使用NetApp SnapMirror将其传统数据存储库复制到二级存储系统、然后在发生灾难时使用二级系统恢复单个VM或整个站点。在大多数情况下、客户会使用软件工具来管理此问题、例如适用于VMware vSphere的NetApp SnapCenter插件等备份软件产品或VMware Site Recovery Manager等灾难恢复解决方案(以及ONTAP工具中的存储复制适配器)。</block>
  <block id="bc6303e4538280b1b01d45a5f7d20039" category="paragraph">这种对软件工具的要求对于管理vols复制更为重要。虽然某些方面可以通过本机功能进行管理(例如、由VMware管理的vvol快照会卸载到使用快速、高效的文件或LUN克隆的ONTAP)、但通常需要通过业务流程来管理复制和恢复。有关vvol的元数据受ONTAP 和VASA Provider保护、但要在二级站点上使用这些元数据、需要进行额外处理。</block>
  <block id="c6a26835eb364bad22b16cb127b74135" category="paragraph">ONTAP 工具9.7.1与VMware Site Recovery Manager (SRM) 8.3版结合使用、可利用NetApp SnapMirror技术增加对灾难恢复和迁移工作流流程编排的支持。</block>
  <block id="2803a799fd66056eff404a17ba640c2b" category="paragraph">在ONTAP 工具9.7.1的SRM支持初始版本中、需要先预先创建FlexVol并启用SnapMirror保护、然后再将其用作VVO尔 数据存储库的后备卷。从ONTAP 工具9.10开始、不再需要此过程。现在、您可以向现有备份卷添加SnapMirror保护、并更新VM存储策略、以便利用与SRM集成的灾难恢复和迁移流程编排及自动化功能、实现基于策略的管理。</block>
  <block id="8142fcf496d02a58ce02a17558db863e" category="paragraph">目前、VMware SRM是NetApp支持的唯一适用于vvol的灾难恢复和迁移自动化解决方案 、ONTAP 工具将检查是否存在已向vCenter注册的SRM 8.3或更高版本服务器、然后再允许您启用vvol复制。 虽然可以利用ONTAP 工具REST API创建您自己的服务。</block>
  <block id="7d8e8eced8d8b1a50f20640ffb5d363a" category="section-title">使用SRM进行的卷复制</block>
  <block id="4d30574e6d5bc9a71718858eeb30774c" category="inline-image-macro">使用SRM进行的卷复制、300</block>
  <block id="5844b0ec1ad8db5185ec67effeb9a7b7" category="paragraph"><block ref="5844b0ec1ad8db5185ec67effeb9a7b7" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c95aede1de7a41511c9d962deba49054" category="section-title">MetroCluster 支持</block>
  <block id="3f15bb720adb42bd521a2ce1cb3a2974" category="paragraph">虽然ONTAP 工具无法触发MetroCluster 切换、但它支持在统一vSphere Metro Storage Cluster (VMSC)配置中使用NetApp MetroCluster 系统作为Vvol的后备卷。MetroCluster 系统的切换将按常规方式进行。</block>
  <block id="cde16c5ee89c209c821e120caf65bb81" category="paragraph">虽然NetApp SnapMirror业务连续性(SM-BC)也可用作VMSC配置的基础、但Vvol目前不支持它。</block>
  <block id="c859f5cd725cb2d1b163e4b066bede9a" category="paragraph">有关NetApp MetroCluster 的详细信息、请参见以下指南：</block>
  <block id="e5e0fb3ae5564674a6548ade7c601578" category="inline-link">_TR-4689 MetroCluster IP解决方案 架构和设计_</block>
  <block id="e64de4e49a37e62ff7f8c37e859bbeb9" category="paragraph"><block ref="e64de4e49a37e62ff7f8c37e859bbeb9" category="inline-link-rx"></block></block>
  <block id="0229efec9dc9b9a7fdf144b025157176" category="inline-link">_TR-4705 NetApp MetroCluster 解决方案 架构和设计_</block>
  <block id="6aee4b78ffdfaf193918978472d660a7" category="paragraph"><block ref="6aee4b78ffdfaf193918978472d660a7" category="inline-link-rx"></block></block>
  <block id="876341bac548f230eb390348e8b075ad" category="inline-link">_VMware知识库2031038 NetApp MetroCluster 的VMware vSphere支持_</block>
  <block id="5e68486fffeebad2ed145408dc250367" category="paragraph"><block ref="5e68486fffeebad2ed145408dc250367" category="inline-link-rx"></block></block>
  <block id="50c323f7050912164118ba47eab75888" category="section-title">《vCenter Server备份概述》</block>
  <block id="6751e706567f4773c4f3138b4de51a0f" category="paragraph">保护VM有多种方法、例如使用子系统内备份代理、将VM数据文件附加到备份代理或使用定义的API (如VMware VADP)。可以使用相同的机制来保护V卷、许多NetApp合作伙伴都支持VM备份、包括Vvol。</block>
  <block id="416d27c872769e934ac8a49ec98ccb53" category="paragraph">如前文所述、VMware vCenter管理的快照会卸载到节省空间的快速ONTAP 文件/LUN克隆。这些快照可用于快速手动备份、但受vCenter限制、最多不超过32个快照。您可以使用vCenter根据需要创建快照和还原。</block>
  <block id="8f3d5ae5bd7d8922841975ccd84b8526" category="paragraph">从适用于VMware vSphere (SCV) 4.6的SnapCenter 插件开始、如果与ONTAP 工具9.10及更高版本结合使用、则可通过支持SnapMirror和SnapVault 复制的ONTAP FlexVol 卷快照为基于Vvol的VM添加崩溃状态一致的备份和恢复功能。每个卷最多支持1023个快照。SCV还可以使用SnapMirror和镜像存储策略在二级卷上存储更多快照、保留时间更长。</block>
  <block id="1429a9379faa8e82f8b198e93eebdf61" category="paragraph">vSphere 8.0支持是在SCV 4.7中引入的、它使用一个隔离的本地插件架构。vSphere 8.0U1支持已添加到SCV 4.8中、并已完全过渡到新的远程插件架构。</block>
  <block id="de1d77d00dae616276b6ceb6296a18f2" category="section-title">适用于VMware vSphere的vvol Backup with SnapCenter 插件</block>
  <block id="02f41838319aab980999b60967d7fd53" category="paragraph">现在、借助NetApp SnapCenter、您可以基于标记和/或文件夹为Vvol创建资源组、以便为基于Vvol的VM自动利用ONTAP基于FlexVol的快照。这样、您可以定义备份和恢复服务、当VM在环境中动态配置时、这些服务将自动保护VM。</block>
  <block id="4549a2943666c4815098331d30a872da" category="paragraph">适用于VMware vSphere的SnapCenter 插件部署为注册为vCenter扩展的独立设备、可通过vCenter UI或REST API进行管理、以实现备份和恢复服务自动化。</block>
  <block id="26e2418d177df1dddb008e455ce28752" category="section-title">SnapCenter 架构</block>
  <block id="3b345c0fb5d2f0451ef84d991b21dcac" category="inline-image-macro">SnapCenter 架构、300</block>
  <block id="af9bca7d8452705ba7f607cd036dba01" category="paragraph"><block ref="af9bca7d8452705ba7f607cd036dba01" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c32197281aa44f57ae568a9a42c7b3b6" category="paragraph">由于其他SnapCenter插件在撰写本文时尚不支持虚拟卷、因此我们将在本文档中重点介绍独立部署模式。</block>
  <block id="6750052f2c0fb06d80a8efd7cb871190" category="paragraph">由于SnapCenter 使用ONTAP FlexVol 快照、因此vSphere不会产生任何开销、也不会像使用vCenter托管快照的传统VM那样对性能造成任何影响。此外、由于选择控制阀的功能通过REST API公开、因此可以使用VMware Aia Automation、Ansable、Terraform等工具以及几乎任何其他能够使用标准REST API的自动化工具轻松创建自动化工作流。</block>
  <block id="0c889d77d71512ceb7241bd0f6d6ca23" category="inline-link">REST API 概述</block>
  <block id="35eab4195b135718da016e20979f9031" category="paragraph">有关 SnapCenter REST API 的信息，请参见<block ref="33852d6f529e96c0b816da3945bcb1e5" category="inline-link-rx"></block></block>
  <block id="4ee2d383554981f4ea8eff4f35db6832" category="inline-link">适用于 VMware vSphere 的 SnapCenter 插件 REST API</block>
  <block id="63ae61e98eec102c39264a819a3c522e" category="paragraph">有关适用于 VMware vSphere 的 SnapCenter 插件 REST API 的信息，请参见<block ref="40a6c7462de67e21480b7a31e406f8f9" category="inline-link-rx"></block></block>
  <block id="bdf03d5c2a7086b6c916dc96d06a0a6c" category="paragraph">以下最佳实践可帮助您充分利用SnapCenter 部署。</block>
  <block id="60af6a4208b610da54a63a7e3658d5a5" category="list-text">SCV同时支持vCenter Server RBAC和ONTAP RBAC、并包括预定义的vCenter角色、这些角色会在注册插件时自动为您创建。您可以阅读有关支持的RBAC类型的更多信息<block ref="a8ef9d6a500bd8288101245a3828ddb1" category="inline-link-rx"></block></block>
  <block id="0ed0835259b5b8c4b0f0910e7bfe2b17" category="list-text">使用vCenter UI使用所述的预定义角色分配特权最低的帐户访问权限<block ref="17b3487f3493b9c198e03f92348bfca0" category="inline-link-rx"></block>。</block>
  <block id="d53326766687d6bc7fa2e28ee177e809" category="list-text">如果在SnapCenter 服务器中使用SCV，则必须分配_SnapCenterAdmin_角色。</block>
  <block id="61ba6cb0b6021c205d41ed7f6fc1eb71" category="list-text">ONTAP RBAC是指用于添加和管理SCV使用的存储系统的用户帐户。ONTAP RBAC不适用于基于虚拟卷的备份。阅读有关ONTAP RBAC和SCV的更多信息<block ref="e4e865178d3962f87ac5cef3d6d68942" category="inline-link-rx"></block>。</block>
  <block id="1c89ba258526186ea0ec98325b61371b" category="list-text">使用SnapMirror将备份数据集复制到另一个系统、以创建源卷的完整副本。如前所述、您还可以使用镜像存储策略长期保留备份数据、而不受源卷快照保留设置的影响。这两种机制都支持使用这两种方法的卷。</block>
  <block id="9792eeb3b91469abf77746b005d82d77" category="list-text">由于SCV还需要适用于VMware vSphere的ONTAP 工具来实现Vvol功能、因此请始终查看NetApp互操作性表工具(IMT)以了解特定版本的兼容性</block>
  <block id="71c989bd68059e2ddfa4200c60b736c7" category="list-text">如果要将vvol复制与VMware SRM结合使用、请注意策略RPO和备份计划</block>
  <block id="604eb779cbb9af378f7bda71633b5b31" category="list-text">使用符合组织定义的恢复点目标(Recovery Point目标、Recovery Point目标、RPO)的保留设置设计备份策略</block>
  <block id="067ff91a08d3ff453b59d81993b96182" category="list-text">在资源组上配置通知设置、以便在备份运行时收到状态通知(请参见下面的图10)</block>
  <block id="c3add00693172bbbb4dd864bf0ad9116" category="section-title">资源组通知选项</block>
  <block id="c728df76dc3609672a7969e320e39e32" category="inline-image-macro">资源组通知选项,300</block>
  <block id="45281309785094533b5880fe6d0fd1ea" category="paragraph"><block ref="45281309785094533b5880fe6d0fd1ea" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6eae9510711f8df8f55a15e1761875d9" category="section-title">使用这些文档开始使用选择控制阀</block>
  <block id="235a656535515ab3518937c09836e60d" category="inline-link">了解适用于 VMware vSphere 的 SnapCenter 插件</block>
  <block id="79eb02d2a96cc634df87bec5bd511bbe" category="paragraph"><block ref="79eb02d2a96cc634df87bec5bd511bbe" category="inline-link-rx"></block></block>
  <block id="04e7bb0411c1c8f56ca4fc8000c62ad8" category="inline-link">部署适用于 VMware vSphere 的 SnapCenter 插件</block>
  <block id="d4ba0aa084ae1145248006481c881d29" category="paragraph"><block ref="d4ba0aa084ae1145248006481c881d29" category="inline-link-rx"></block></block>
  <block id="231cf4c70d866b616c21baddaeed0696" category="doc">故障排除</block>
  <block id="9d2169c1c2855b78a7aeaa4f42d27dc7" category="section-title">NetApp 支持站点</block>
  <block id="ed9018b2e8611a3d2c03bb6a205b9715" category="inline-link">适用于 VMware vSphere 的 ONTAP 工具</block>
  <block id="890eb741924c425abbb11e4618560181" category="paragraph">除了有关NetApp虚拟化产品的各种知识库文章之外、NetApp 支持站点 还为提供了一个方便的登录页面<block ref="6e90053136fd326e5d581844ca21966d" category="inline-link-rx"></block> 产品。此门户可通过链接访问NetApp社区中的文章、下载内容、技术报告和VMware解决方案讨论。可从以下位置获取：</block>
  <block id="fff460b039580a1bd42725a397b4c8be" category="inline-link">_ NetApp 支持站点 _</block>
  <block id="897515b5a8a03f8d5cbed44fd47ef9f3" category="paragraph"><block ref="897515b5a8a03f8d5cbed44fd47ef9f3" category="inline-link-rx"></block></block>
  <block id="4020fd07f5ee2361dd23956e6a334ffd" category="paragraph">有关其他解决方案 文档、请访问：</block>
  <block id="503a41e1e31e362793f7e86af9102c41" category="inline-link">_NetApp虚拟化解决方案_</block>
  <block id="33d455bce1363bad4500664eb6208860" category="paragraph"><block ref="33d455bce1363bad4500664eb6208860" category="inline-link-rx"></block></block>
  <block id="baf17f6d2396be5fd3676baf863a331f" category="section-title">产品故障排除</block>
  <block id="9d6d7fa1a5253698556ac2b0cda2207d" category="paragraph">ONTAP 工具的各种组件(例如vCenter插件、VASA Provider和Storage Replication Adapter)都记录在NetApp文档库中。但是、每个都有一个单独的知识库子部分、并且可能具有特定的故障排除过程。这些说明解决了使用VASA Provider时可能遇到的最常见问题。</block>
  <block id="ae2a93a809929192ecc7b468f234af84" category="section-title">VASA Provider UI问题</block>
  <block id="92a2b5cb9c6906035c2864fa225e1940" category="inline-link">文章</block>
  <block id="69aecee18a55993c779487758eb051cc" category="paragraph">有时、vCenter vSphere Web Client会遇到与Serenity组件相关的问题、从而导致无法显示适用于ONTAP 的VASA Provider菜单项。请参见部署指南或本知识库中的解决VASA Provider注册问题<block ref="c8979f1604396ce5570d07774ba255f0" category="inline-link-rx"></block>。</block>
  <block id="03cc611b90575ea37b55959adaa1c754" category="section-title">配置卷数据存储库失败</block>
  <block id="281b890be0e8280eea1aebb82de90961" category="paragraph">有时、在创建Vvol数据存储库时、vCenter服务可能会超时。要更正此错误、请重新启动vmware-sps服务、然后使用vCenter菜单("Storage"(存储)&gt;"New DataStorage"(新建数据存储库)重新挂载Vvol数据存储库。此问题将在《管理指南》中的"使用vCenter Server 6.5配置Vvol数据存储库失败"一节中进行介绍。</block>
  <block id="3152add163cd8aaf116a259d85ebf8fb" category="section-title">升级Unified Appliance无法挂载ISO</block>
  <block id="ffaa56a3f5a1157f2eb3955773bb41da" category="paragraph">由于vCenter中的错误、用于将Unified Appliance从一个版本升级到下一个版本的ISO可能无法挂载。如果ISO能够连接到vCenter中的设备、请按照本知识库中的过程进行操作<block ref="9839383ed04f777c0132b57ad0cb14ac" category="inline-link-rx"></block> 以解决此问题。</block>
  <block id="cacba1b456347ce8f32c7f5ed0d81e64" category="doc">部署Virtual Storage</block>
  <block id="2a5f3dc8d46246216b293c9e41979269" category="paragraph">对于对传统数据存储库使用ONTAP 的现有vSphere环境、可能不需要执行前两个步骤。您可能已经在使用ONTAP工具来管理、自动化和报告VMFS或基于NFS的传统存储。下一节将更详细地介绍这些步骤。</block>
  <block id="841db3655338a0c3dc36cf2761bfdafd" category="list-text">创建Storage Virtual Machine (SVM)及其协议配置。您将选择NVMe/FC、NFSv3、NFSv4.1、iSCSI、FCP、 或这些选项的组合。您可以使用ONTAP系统管理器向导或集群Shell命令行。</block>
  <block id="10818a8ad4f650a48d78d728278d4cb3" category="list-text">对于每个交换机/网络结构连接、每个节点至少需要一个LIF。作为最佳实践、为每个节点创建两个或更多基于FCP、iSCSI或NVMe的协议。</block>
  <block id="612705dd95888cdc6345d01c93c84c39" category="list-text">此时可以创建卷、但使用_ProVision数据存储库_向导创建卷会更简单。此规则的唯一例外情况是、您计划将vvol复制与VMware Site Recovery Manager结合使用。对于具有现有SnapMirror关系的已有FlexVol 卷、设置起来更容易。请注意、不要在要用于虚拟卷的任何卷上启用QoS、因为这是要由SPBM和ONTAP 工具管理的。</block>
  <block id="16421df834af873175559b678c2b3cd9" category="list-text">使用从NetApp 支持站点 下载的OVA部署适用于VMware vSphere的ONTAP 工具。</block>
  <block id="8bdb69b5934ff84bbaafd84585965a90" category="list-text">为您的环境配置ONTAP 工具。</block>
  <block id="dd07accb290c9c1e3900692630a70767" category="list-text">将ONTAP 集群添加到_Storage Systems_下的ONTAP 工具中</block>
  <block id="731ce7392ae254e2050191ae92cafb14" category="list-text">虽然ONTAP 工具和SRA支持集群级别和SVM级别的凭据、但VASA Provider仅支持存储系统的集群级别凭据。这是因为用于vvol的许多API仅在集群级别可用。因此、如果您计划使用ONTAP、则必须使用集群范围的凭据添加此集群。</block>
  <block id="869ce78032d85111f09ceb58bdb59a36" category="list-text">如果ONTAP 数据LIF与VMkernel适配器位于不同子网上、则必须将VMkernel适配器子网添加到ONTAP 工具的设置菜单中的选定子网列表中。默认情况下、ONTAP 工具仅允许本地子网访问、从而确保存储流量的安全。</block>
  <block id="5a6d084090f063797fc6b863d2817d98" category="list-text">ONTAP工具附带了多个预定义策略、您可以使用这些策略、也可以查看这些策略 <block ref="434866eb159632a70c4db034544336ef" category="inline-xref-macro-rx"></block> 有关创建SCP的指导。</block>
  <block id="ef51190e4c839596248fc4173ed12a3c" category="list-text">使用vCenter中的_ ONTAP tools_菜单启动_配置数据存储库_向导。</block>
  <block id="66edaf6f622057aeadab950977c1f3e8" category="list-text">请提供有意义的名称并选择所需协议。您也可以提供数据存储库的问题描述。</block>
  <block id="d22d6de0c8f11375907a1c10d8d0f251" category="list-text">选择一个或多个要由此卷数据存储库支持的SCP。此操作将筛选出无法与配置文件匹配的所有ONTAP 系统。从显示的列表中、选择所需的集群和SVM。</block>
  <block id="6a016a18a0c20e3b805cd9b8e713fb3e" category="list-text">使用向导为每个指定的FlexVol 创建新的SCP卷、或者通过选择相应的单选按钮使用现有卷。</block>
  <block id="2527effe721902a77755b8d628fdad93" category="list-text">在vCenter UI的_policies and Profiles _菜单中、为要在数据存储库中使用的每个SCP创建VM策略。</block>
  <block id="642dadaf5095b4c11730dca0ffcb0d27" category="list-text">选择"NetApp.Clustered.Data.ONTAP VP.VVol"存储规则集。"NetApp.Clustered.Data.ONTAP .VP.VASE10"存储规则集用于为非VVOLs数据存储库提供SPBM支持</block>
  <block id="c9565e0957e6e02cf12aef618bd30c3f" category="list-text">在创建VM存储策略时、您需要按名称指定存储功能配置文件。在此步骤中、您还可以使用复制选项卡配置SnapMirror策略匹配、并使用标记选项卡配置基于标记的匹配。请注意、必须已创建标记、才能进行选择。</block>
  <block id="af70f7acdeed8e2a702372f9bc85d960" category="list-text">创建VM、在Select storage下选择VM存储策略和兼容数据存储库。</block>
  <block id="3db9849d9f30bfc6e05c4e0b36d28848" category="section-title">将VM从传统数据存储库迁移到Vvol</block>
  <block id="7be42b7840cc093ce6d05a247df8e63d" category="paragraph">将VM从传统数据存储库迁移到Vvol数据存储库就像在传统数据存储库之间移动VM一样简单。只需选择虚拟机、然后从操作列表中选择迁移、并选择迁移类型_change storage only"。对于SAN VMFS到Vvol的迁移、迁移副本操作将随vSphere 6.0及更高版本卸载、但不会从NAS VMDK卸载到Vvol。</block>
  <block id="58f2a764a13ec89d3c5ead5343e75637" category="section-title">使用策略管理VM</block>
  <block id="4b746813f1085683be4f71c8affea233" category="paragraph">要通过基于策略的管理自动配置存储、我们需要：</block>
  <block id="10b68fb9cbee818a044f91644423640c" category="list-text">使用存储功能配置文件(Storage Capability Profiles、ONTAP)定义存储(Storage Node和FlexVol 卷)的功能。</block>
  <block id="2e415dc7a6f21b4fd03f963858c9f680" category="list-text">创建映射到定义的SRP的VM存储策略。</block>
  <block id="67c819108c4ef294ac28a51197046dfc" category="paragraph">从VASA Provider 7.2开始、NetApp简化了这些功能和映射、并在更高版本中不断进行改进。本节重点介绍这一新方法。早期版本支持更多功能、并允许将这些功能单独映射到存储策略、但不再支持此方法。</block>
  <block id="0bd86c4955ab0bdce52b49644ce9396d" category="section-title">按ONTAP 工具版本列出的存储功能配置文件功能</block>
  <block id="4a6af8a6e216dcc53a63f04143c13222" category="cell">*SCP功能*</block>
  <block id="048424cc97a54b673c837ee7d4c19de0" category="cell">*功能值*</block>
  <block id="098e77f7c5d9e0c2ad5454817edf0767" category="cell">*支持的版本*</block>
  <block id="28f44037af103f0c930309365629f8ef" category="cell">* 注释 *</block>
  <block id="d031377688b064b729a0cc60fb7fbbff" category="cell">* 数据压缩 *</block>
  <block id="cc6aee5037bdc5b051433a266ec7d4a3" category="cell">是、否、任何</block>
  <block id="7778bddb1c205e9f74d08bd30be0aca3" category="cell">对于7.2及更高版本的AFF 为必填项。</block>
  <block id="221baf8ad30299306e725e4fb395bf34" category="cell">* 重复数据删除 *</block>
  <block id="6868f879256c802b106616a006671848" category="cell">M andatory for AFF in 7.2及更高版本。</block>
  <block id="504897d4a6b59afadffd3cf9e5d3ea85" category="cell">* 加密 *</block>
  <block id="95fddd53c531d6efe15e3ac7ace1d9eb" category="cell">7.2及更高版本</block>
  <block id="b3870ec121aeafa2e7ca8cb3894c0e3a" category="cell">选择/创建加密的FlexVol 卷。需要ONTAP 许可证。</block>
  <block id="e2dcc78cf70dac34550234c95443ac37" category="cell">* 最大 IOPS*</block>
  <block id="b78a981cc40fc4e66208bf5ee6d1a1eb" category="cell">&lt;number&gt;</block>
  <block id="130b32bc15d3fbe6d2e80ecda94135cc" category="cell">7.1及更高版本、但存在差异</block>
  <block id="c0f84018aff4ff4a1cf4012a8b82e509" category="cell">在7.2及更高版本的QoS策略组下列出。请参见 <block ref="8fdd8868d80d04eecf1b4189862f536c" category="inline-xref-macro-rx"></block> 有关详细信息 ...</block>
  <block id="993c56850c1da5de36e798b0c5a72513" category="cell">*个人设置*</block>
  <block id="8485fa08bf8c556b7b2275349d11eb05" category="cell">A FF、FAS</block>
  <block id="c0acd03e8ba6b951b8c6dff3e95b9560" category="cell">FAS 还包括其他非AF系统、例如ONTAP Select。AFF 包括ASA。</block>
  <block id="dce365633ffb688b7532470dfaf4e118" category="cell">*协议*</block>
  <block id="7cff0b96b4a6467ea880f49dd365a81f" category="cell">NFS、NFS 4.1、iSCSI、FCP、NVMe/FC、 任何</block>
  <block id="be18de5e88c84ba55eeb5bc42cca4c0d" category="cell">7.1及更早版本、9.10及更高版本</block>
  <block id="cfca0bc0c0b481555ba52be1f4e21da6" category="cell">7.2-9.8实际上是"任意"。从9.10开始、NFS 4.1和NVMe/FC已添加到原始列表中。</block>
  <block id="3dd301ae5682df79e8687ead5b6a3ddf" category="cell">*空间预留(精简配置)*</block>
  <block id="03868a080fbf4cdbc006da45e13cfad7" category="cell">精简、厚、(任意)</block>
  <block id="0a74dc1caf6ce891d5cbd3878cae2221" category="cell">所有、但存在差异</block>
  <block id="4b370bcc260aa96e343bbb24d3af2cc5" category="cell">在7.1及更早版本中称为精简配置、该配置也允许使用任何值。在7.2中称为空间预留。所有版本均默认为精简。</block>
  <block id="40e2e283d064264dd51846580adb367d" category="cell">* 分层策略 *</block>
  <block id="06b815f81a7e7aceb1489e3888fb9534" category="cell">任意、无、快照、自动</block>
  <block id="00917abc35f0d57db6562a886997c4e8" category="cell">用于FabricPool -需要使用AFF或ASA以及ONTAP 9.4或更高版本。除非使用NetApp StorageGRID 等内部部署S3解决方案 、否则建议仅使用Snapshot。</block>
  <block id="ffb0d092d584c15937dfacd5be3c684a" category="section-title">正在创建存储功能配置文件</block>
  <block id="ad0b6bb809400347fc4806f18385015c" category="paragraph">NetApp VASA Provider附带了多个预定义的SCP。可以使用vCenter UI手动创建新的SCP、也可以使用REST API通过自动化方式创建新的SCP。通过在新配置文件中指定功能、克隆现有配置文件或从现有传统数据存储库自动生成配置文件。可使用ONTAP 工具下的菜单来完成此操作。使用_Storage Capability Profiles _创建或克隆配置文件、使用_Storage Mapping_自动生成配置文件。</block>
  <block id="62351556db3b0f6f13da226ca3e2df24" category="section-title">ONTAP 工具9.10及更高版本的存储功能</block>
  <block id="14b49e2a6b56b1177a77be03a29dfc83" category="inline-image-macro">"Storage Capabilities for ONTAP tools 9.10及更高版本"、300</block>
  <block id="2a53cbcd07a15d9f13f0cc630c7cc44d" category="paragraph"><block ref="2a53cbcd07a15d9f13f0cc630c7cc44d" category="inline-image-macro-rx" type="image"></block></block>
  <block id="12bb128f53dfaac0a251798e4b4e6954" category="paragraph"><block ref="12bb128f53dfaac0a251798e4b4e6954" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4e6d46028a015a7f3860fc8fdf214b3c" category="paragraph"><block ref="4e6d46028a015a7f3860fc8fdf214b3c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="64ca5ade59a3a7351134cf0db3a8e06a" category="paragraph"><block ref="64ca5ade59a3a7351134cf0db3a8e06a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2c8f597441425c22b4ae09f872f8bcc4" category="paragraph"><block ref="2c8f597441425c22b4ae09f872f8bcc4" category="inline-image-macro-rx" type="image"></block></block>
  <block id="fd59d4e26c472ef1e14cadb688283604" category="paragraph"><block ref="fd59d4e26c472ef1e14cadb688283604" category="inline-image-macro-rx" type="image"></block></block>
  <block id="049b6d7b78dd8ffebadb5a0be2261637" category="paragraph">*正在创建Svols存储库*
创建必要的FlexVol 后、可以使用它们创建此数据存储库(也可以是此数据存储库的Snapshot卷)。右键单击要创建ONTAP 数据存储库的主机、集群或数据中心、然后选择_VMware tools_&gt;_ProVision DataData存储 库_。选择要由数据存储库支持的一个或多个FlexVol 、然后从现有FlexVol 卷中进行选择和/或为此数据存储库配置新的SCP卷。最后、为数据存储库指定默认SCP、此SCP将用于策略未指定SCP的虚拟机以及交换Vvol (这些虚拟机不需要高性能存储)。</block>
  <block id="a4332a81dbc3a9888be608dea640cd3d" category="section-title">正在创建VM存储策略</block>
  <block id="b4f6f65777757af7630fae901718e51e" category="paragraph">早期版本与此类似、但如中所述 <block ref="68072d20e775e4558feadbec7ba8f768" category="inline-xref-macro-rx"></block>，您的选择将有所不同。</block>
  <block id="52896487a6472798e1d6cbc9a95ec51e" category="section-title">使用ONTAP工具创建VM存储策略VASA Provider 9.10.</block>
  <block id="c0c5e719ad5439106e5a00588402f206" category="inline-image-macro">"使用ONTAP 工具VASA Provider 9.10"、300创建VM存储策略</block>
  <block id="378e30f2a60dc28c4afc9ae4f11a39e1" category="paragraph"><block ref="378e30f2a60dc28c4afc9ae4f11a39e1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="95ac22478e141fde0d2878c71530a13a" category="section-title">使用ONTAP 工具9.10及更高版本进行性能管理</block>
  <block id="c153012a9aa13e8ed8ce3f3e471a70b4" category="list-text">ONTAP 工具9.10使用自己的平衡放置算法将新的VVOV放置在VVOLS数据存储库中最佳的FlexVol 卷中。放置基于指定的SCP和匹配的FlexVol 卷。这样可以确保数据存储库和后备存储满足指定的性能要求。</block>
  <block id="e65bde48b0a84fcc60d957de90c3a128" category="list-text">更改性能功能(如最小和最大IOPS)需要注意特定配置。</block>
  <block id="c43f1c590aab42b849ee038e863a567d" category="list-text">可以在SCP中指定*最小和最大IOPs*，并在VM策略中使用。</block>
  <block id="404e0fefd61512a9f144586382a62641" category="list-text">在SCP中更改IOPS不会更改Vvol上的QoS、除非编辑了VM策略、然后将其重新应用于使用它的VM (请参见 <block ref="2358041c73953300d39d98366deee80d" category="inline-xref-macro-rx"></block>）。或者、使用所需的IOPS创建一个新的SCP、并将策略更改为使用它(然后重新应用于VM)。通常、建议只为不同的服务层定义单独的SCP和VM存储策略、只需更改VM上的VM存储策略即可。</block>
  <block id="0e05d638b7a9c7a5c32e6c22679eeb82" category="list-text">AFF 和FAS 个性化设置具有不同的IOPS设置。最小值和最大值在AFF 上均可用。但是、非Af系统只能使用最大IOPS设置。</block>
  <block id="97659fa3c3a5aaf088f6020a38faf086" category="list-text">在某些情况下、可能需要在策略更改(手动或由VASA Provider和ONTAP 自动迁移)后迁移VVOR：</block>
  <block id="81c975fc79a19102fa04ad9c49f7538b" category="list-text">某些更改不需要迁移(例如、更改最大IOPS、可如上所述立即应用于虚拟机)。</block>
  <block id="a426b56f86a12c200f3484efb990e81f" category="list-text">如果存储VVOR的当前FlexVol 卷不支持此策略更改(例如、此平台不支持所请求的加密或分层策略)、则您需要在vCenter中手动迁移此虚拟机。</block>
  <block id="7de504873f20af5c8ce6dadd2f79b29a" category="list-text">ONTAP 工具使用当前支持的ONTAP 版本创建单个非共享QoS策略。因此、每个单独的VMDK都将收到自己分配的IOPS。</block>
  <block id="63a33ddbd2c3ccd2daac06020248049f" category="section-title">正在重新应用虚拟机存储策略</block>
  <block id="d0f5986c3378364e5cb0eda0e98fd0fd" category="inline-image-macro">"重新应用虚拟机存储策略"、300</block>
  <block id="2a8c2026166e178134c7e19c2f4a2c15" category="paragraph"><block ref="2a8c2026166e178134c7e19c2f4a2c15" category="inline-image-macro-rx" type="image"></block></block>
  <block id="50b6e1c7f2e81842d993d8ce88acc979" category="summary">ONTAP 支持用于虚拟化的所有主要存储协议，例如 iSCSI ，光纤通道（ FC ），以太网光纤通道（ FCoE ）或适用于 SAN 环境的非易失性光纤通道快速内存（ NVMe/FC ），以及 NFS （ v3 和 v4.1 ）和 SMB 或 S3 （用于子系统连接）。客户可以自由选择最适合其环境的协议，并可以根据需要在一个系统上组合协议。</block>
  <block id="ee8cc65cae83009c275cd4748f4c58ae" category="doc">适用于 ONTAP 的虚拟化工具</block>
  <block id="0894f8dfb7dd501a78dc2416b7b90c2a" category="paragraph">NetApp 提供了多种独立软件工具，可与 ONTAP 和 vSphere 结合使用来管理虚拟化环境。</block>
  <block id="236e1a1bf6abf86968baf738af47b78c" category="paragraph">ONTAP 许可证附带了以下工具，无需额外付费。有关这些工具在 vSphere 环境中如何协同工作的说明，请参见图 1 。</block>
  <block id="f364e3337f5237c93d7b5439c82d444b" category="paragraph">适用于 VMware vSphere 的 ONTAP 工具是一组用于将 ONTAP 存储与 vSphere 结合使用的工具。无论您使用的是 SAN 还是 NAS ， vCenter 插件（以前称为 Virtual Storage Console （ VSC ））均可简化存储管理和效率功能，提高可用性并降低存储成本和运营开销。它使用最佳实践配置数据存储库，并为 NFS 和块存储环境优化 ESXi 主机设置。为了获得所有这些优势， NetApp 建议在将 vSphere 与运行 ONTAP 软件的系统结合使用时，最佳做法是使用这些 ONTAP 工具。它包括服务器设备、vCenter的用户界面扩展、VASA Provider和Storage Replication Adapter。ONTAP 工具中的几乎所有内容都可以通过简单的REST API实现自动化、而大多数现代自动化工具都可以使用这些API。</block>
  <block id="0b266371a133b176a2ee883ccf72b46c" category="list-text">* vCenter UI扩展。* ONTAP 工具UI扩展通过直接在vCenter UI中加入易于使用的上下文相关菜单来管理主机和存储、信息Portlet以及本机警报功能、简化了操作团队和vCenter管理员的工作、从而简化了工作流。</block>
  <block id="e08c666b5127e745f8aacbacfce37dcf" category="list-text">*适用于ONTAP 的VASA Provider。*适用于ONTAP 的VASA Provider支持VMware vStorage APIs for Storage Awareness (VASA)框架。它作为适用于 VMware vSphere 的 ONTAP 工具的一部分提供，作为一个虚拟设备，易于部署。VASA Provider 可将 vCenter Server 与 ONTAP 连接起来，以帮助配置和监控 VM 存储。它支持 VMware 虚拟卷（ VVOL ）支持，管理存储功能配置文件和单个 VM VVOL 性能，并提供警报以监控容量和配置文件合规性。</block>
  <block id="1c7bb8764fc089dda8481678ad1ea0b5" category="list-text">*存储复制适配器。* SRA与VMware Site Recovery Manager (SRM)结合使用、用于管理生产站点和灾难恢复站点之间的数据复制、并无中断地测试灾难恢复副本。它有助于自动执行发现，恢复和重新保护任务。它包括适用于 Windows SRM 服务器和 SRM 设备的 SRA 服务器设备和 SRA 适配器。</block>
  <block id="a1c13ec555198266776a3a7b904810dd" category="paragraph">下图显示了适用于 vSphere 的 ONTAP 工具。</block>
  <block id="f7e876d450acee7c9ed7b18438440fb2" category="paragraph"><block ref="f7e876d450acee7c9ed7b18438440fb2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="dd55e255500b9ec15305dc69dfa0e15b" category="section-title">适用于 VMware VAAI 的 NFS 插件</block>
  <block id="4fbfd4c228f22ff3f2841908e853d895" category="paragraph">适用于VMware VAAI的NetApp NFS插件是一个适用于ESXi主机的插件、可用于在ONTAP 上对NFS数据存储库使用VAAI功能。它支持克隆操作的副本卸载、厚虚拟磁盘文件的空间预留以及快照卸载。将副本操作卸载到存储不一定会更快完成、但它会降低网络带宽要求、并减轻CPU周期、缓冲区和队列等主机资源的负载。您可以使用适用于VMware vSphere的ONTAP 工具在ESXi主机或vSphere Lifecycle Manager (如果支持)上安装此插件。</block>
  <block id="00cdd3f66e02711548cf72d579ec0df8" category="summary">使用 SnapCenter ，您可以创建可应用于多个作业的备份策略。这些策略可以定义计划，保留，复制和其他功能。它们仍然允许选择虚拟机一致的快照、从而利用虚拟机管理程序在创建VMware快照之前将I/O置于静修状态的功能。</block>
  <block id="f1d1eddd608fe98b6fa2bc3436ce81d0" category="doc">基于存储策略的管理和虚拟卷</block>
  <block id="2bdce8d6813e7a3d93783119529cf146" category="paragraph">通过 VMware vSphere 存储感知 API （ VASA ），存储管理员可以轻松地为数据存储库配置定义明确的功能，并允许 VM 管理员在需要时使用这些功能来配置 VM ，而无需彼此交互。</block>
  <block id="871db14a81b3510676400538c6f07073" category="paragraph">值得一看的是、这种方法可以帮助您简化虚拟化存储操作、避免大量琐碎的工作。</block>
  <block id="ad0bd815b4fb6f01acc94f160af3dca7" category="paragraph">在使用 VASA 之前， VM 管理员可以定义 VM 存储策略，但他们必须与存储管理员合作，通常使用文档或命名约定来确定适当的数据存储库。借助 VASA ，存储管理员可以定义一系列存储功能，包括性能，分层，加密和复制。一个卷或一组卷的一组功能称为存储功能配置文件（ Storage Capability Profile ， SCP ）。</block>
  <block id="44d75bdf4feecabe2de10427870ae623" category="paragraph">SCP支持为VM的数据Vvol设置最小和/或最大QoS。只有 AFF 系统才支持最低 QoS 。适用于 VMware vSphere 的 ONTAP 工具包含一个信息板，用于显示 ONTAP 系统上 VVol 的 VM 粒度性能和逻辑容量。</block>
  <block id="4240fa68f6d9919e6d039c4038175025" category="paragraph">下图显示了适用于 VMware vSphere 9.8 VVol 的 ONTAP 工具信息板。</block>
  <block id="d3fcb217aa8b45eb8a95f8958c1f7746" category="paragraph"><block ref="d3fcb217aa8b45eb8a95f8958c1f7746" category="inline-image-macro-rx" type="image"></block></block>
  <block id="50e0e66922b3b12510a128829d1fdc70" category="paragraph">定义存储功能配置文件后，可以使用该配置文件来使用存储策略来配置 VM ，以确定其要求。通过 VM 存储策略与数据存储库存储功能配置文件之间的映射， vCenter 可以显示一个兼容数据存储库列表以供选择。这种方法称为基于存储策略的管理。</block>
  <block id="794b6e2fc393d40a552fc58975920cb0" category="paragraph">VASA 提供了查询存储并将一组存储功能返回到 vCenter 的技术。VASA 供应商提供程序可在存储系统 API 和构造与 vCenter 可识别的 VMware API 之间进行转换。适用于ONTAP的NetApp VASA Provider是作为适用于VMware vSphere设备VM的ONTAP工具的一部分提供的、vCenter插件提供了用于配置和管理VVOP数据存储库的界面、并能够定义存储功能配置文件(Storage Capability profile、SCP)。</block>
  <block id="dad160104969c39365dd2cd4c98dd300" category="inline-link">TR-4400</block>
  <block id="79f0d5feb7ec25a16c407f3f585eabb2" category="paragraph">ONTAP 同时支持 VMFS 和 NFS VVol 数据存储库。将 VVOL 与 SAN 数据存储库结合使用可带来 NFS 的一些优势，例如虚拟机级别粒度。下面是一些需要考虑的最佳实践，您可以在中找到追加信息<block ref="4f23d4db151ca74200684ac8aef53fed" category="inline-link-rx"></block>：</block>
  <block id="bd490c925219bcb312338a370589bf70" category="list-text">一个 VVOL 数据存储库可以在多个集群节点上包含多个 FlexVol 卷。最简单的方法是使用一个数据存储库，即使卷具有不同的功能也是如此。SPBM 可确保为 VM 使用兼容的卷。但是，这些卷都必须属于一个 ONTAP SVM ，并使用一个协议进行访问。对于每个协议，每个节点一个 LIF 就足够了。避免在一个 VVOL 数据存储库中使用多个 ONTAP 版本，因为存储功能可能因版本而异。</block>
  <block id="0cc956d6da91fefae9dad9b2c8c9519b" category="list-text">使用适用于 VMware vSphere 的 ONTAP 工具插件创建和管理 VVOL 数据存储库。除了管理数据存储库及其配置文件之外，它还会根据需要自动创建一个协议端点来访问 VVol 。如果使用 LUN ，请注意， LUN PE 会使用 LUN ID 300 及更高版本进行映射。验证ESXi主机的高级系统设置<block ref="ce913b4e625461a33f54f9e4ac38c2d7" prefix=" " category="inline-code"></block> 允许LUN ID号大于300 (默认值为1、024)。执行此步骤的方法是、在vCenter中选择ESXi主机、然后选择配置选项卡并查找<block ref="ce913b4e625461a33f54f9e4ac38c2d7" prefix=" " category="inline-code"></block> 在高级系统设置列表中。</block>
  <block id="fac85f355a1eb47127ef1b94e7603924" category="list-text">请勿将适用于 VMware vSphere 的 VASA Provider ， vCenter Server （设备或基于 Windows ）或 ONTAP 工具本身安装或迁移到 VVOL 数据存储库中，因为它们相互依赖，因此会限制您在发生断电或其他数据中心中断时对其进行管理的能力。</block>
  <block id="dd76252ea7a50def2a98f218cb1505b4" category="inline-link">知识库文章</block>
  <block id="15ef75dd3d20b8278c16cd01a708e13e" category="list-text">定期备份 VASA Provider 虚拟机。至少每小时为包含VASA Provider的传统数据存储库创建一次快照。有关保护和恢复 VASA Provider 的详细信息，请参见此部分<block ref="9d642870dca1748c69f7aa0b6fb95a89" category="inline-link-rx"></block>。</block>
  <block id="2d2d2e356f9ab117b7d2a58d42cc5988" category="paragraph">下图显示了 VVOL 组件。</block>
  <block id="6aadcb77504dae1dbfed2e4d1c969158" category="paragraph"><block ref="6aadcb77504dae1dbfed2e4d1c969158" category="inline-image-macro-rx" type="image"></block></block>
  <block id="7be2e69e5d19c282db8d81c60a51c862" category="summary">本页介绍在 VMware vSphere 环境中实施 NetApp ONTAP Storage 解决方案的最佳实践。</block>
  <block id="d3ba101543fc97ba1dd9272c87bf65da" category="doc">虚拟卷（ VVOL ）和基于存储策略的管理（ SPBM ）</block>
  <block id="a42f13867ea459821488608dc4d1b7c4" category="paragraph">NetApp 是 VMware 在开发 vSphere 虚拟卷（ VVOL ）方面的早期设计合作伙伴，为 VVOL 和 VMware vSphere 存储感知 API （ VASA ）提供架构输入和早期支持。这种方法不仅可以为VMFS实现VM粒度存储管理、还支持通过基于存储策略的管理(Storage Policy Based Management、SPBM)实现存储配置自动化。</block>
  <block id="ce09fc365ce48a9d89c0fdb5222c3909" category="paragraph">SPBM 提供了一个框架，可用作虚拟化环境可用存储服务与通过策略配置的存储元素之间的抽象层。通过这种方法，存储架构师可以设计具有不同功能的存储池， VM 管理员可以轻松地使用这些功能。然后，管理员可以将虚拟机工作负载要求与配置的存储池进行匹配，从而可以在每个 VM 或虚拟磁盘级别精细控制各种设置。</block>
  <block id="2902acda09b9786460c2dd928a2d8f1a" category="paragraph">ONTAP 在 VVOL 规模方面处于存储行业的领先地位，在一个集群中支持数十万个 VVOL ，而企业级阵列和小型闪存阵列供应商支持的每个阵列仅支持数千个 VVOL 。NetApp 还在推动 VM 粒度管理的发展，即将推出支持 VVOL 3.0 的功能。</block>
  <block id="fda9c21a4aefd4a1f42ad0b195e6ef0a" category="inline-link">TR-4400 ：采用 ONTAP 的 VMware vSphere 虚拟卷</block>
  <block id="69173613658292fc2adeb513b12f29ca" category="admonition">有关 VMware vSphere 虚拟卷， SPBM 和 ONTAP 的详细信息，请参见<block ref="354226c2546b1aed39f1c0c484e6a98a" category="inline-link-rx"></block>。</block>
  <block id="61823c0f572643e0ce2e4edcb74cae51" category="paragraph">使用快照快速创建虚拟机或数据存储库的副本而不影响性能、然后使用SnapMirror将其发送到二级系统、以实现长期异地数据保护。这种方法只存储更改后的信息，从而最大限度地减少存储空间和网络带宽。</block>
  <block id="0aef2da721f0ab14676f8d6ffb9e7e8c" category="inline-link">建议</block>
  <block id="022e604112aa3d1870f0da5e7806f48b" category="paragraph">使用 SnapCenter ，您可以创建可应用于多个作业的备份策略。这些策略可以定义计划，保留，复制和其他功能。它们仍然允许选择虚拟机一致的快照、从而利用虚拟机管理程序在创建VMware快照之前将I/O置于静修状态的功能。但是，由于 VMware 快照对性能的影响，通常不建议使用这些快照，除非您需要暂停子文件系统。而是使用快照进行常规保护、并使用SnapCenter插件等应用程序工具来保护SQL Server或Oracle等事务数据。这些快照与VMware (一致性)快照不同、适用于长期保护。  VMware 快照仅为<block ref="75f5ad475d959e2ecb55267e1a9a54f1" category="inline-link-rx"></block> 因性能和其他影响而短期使用。</block>
  <block id="26aae91a7d92b32a60b1fbc86c29ee81" category="paragraph">这些插件提供了扩展功能，可在物理和虚拟环境中保护数据库。借助 vSphere ，您可以使用它们来保护 SQL Server 或 Oracle 数据库，其中的数据存储在 RDM LUN 上，直接连接到子操作系统的 iSCSI LUN 或 VMFS 或 NFS 数据存储库上的 VMDK 文件上。通过这些插件，可以指定不同类型的数据库备份，支持联机或脱机备份，以及保护数据库文件和日志文件。除了备份和恢复之外，这些插件还支持出于开发或测试目的克隆数据库。</block>
  <block id="1556ba0bf6ea4783cda0ff40e96f0265" category="paragraph">下图显示了 SnapCenter 部署的一个示例。</block>
  <block id="54ee9d8cd5db70a761321f3e7d168445" category="paragraph"><block ref="54ee9d8cd5db70a761321f3e7d168445" category="inline-image-macro-rx" type="image"></block></block>
  <block id="6c1bef29e8dc34a00e17b06c221d5efe" category="paragraph">要增强灾难恢复功能，请考虑将适用于 ONTAP 的 NetApp SRA 与 VMware Site Recovery Manager 结合使用。除了支持将数据存储库复制到灾难恢复站点之外，它还可以通过克隆复制的数据存储库在灾难恢复环境中进行无中断测试。通过 SRA 中内置的自动化功能，还可以轻松地从灾难中恢复并在中断解决后重新保护生产。</block>
  <block id="650062685b0df8284f1b87f62fa3f9f3" category="inline-link">TR-4128</block>
  <block id="886a3fd32ec402d87ea2b090f8f701b2" category="paragraph">最后，要获得最高级别的数据保护，请考虑使用 NetApp MetroCluster 的 VMware vSphere 城域存储集群（ VMSC ）配置。VMSC 是一款经过 VMware 认证的解决方案，它将同步复制与基于阵列的集群相结合，可提供与高可用性集群相同的优势，但分布在不同的站点上以防止站点灾难。NetApp MetroCluster 可为同步复制提供经济高效的配置，可从任何单个存储组件故障中透明恢复，并在发生站点灾难时提供单命令恢复。中详细介绍了 VMSC<block ref="737e6eedc4568d5bb72c6a6cf1fe681a" category="inline-link-rx"></block>。</block>
  <block id="d336a329d910c32fb90337a372f596fc" category="summary">近 20 年来， NetApp ONTAP 软件一直是 VMware vSphere 环境中的领先存储解决方案，并不断增加创新功能来简化管理，同时降低成本。本文档介绍了适用于 vSphere 的 ONTAP 解决方案，其中包括用于简化部署，降低风险和简化管理的最新产品信息和最佳实践。</block>
  <block id="92515b597b8c0784d6000b89ee47c5fd" category="doc">统一存储</block>
  <block id="8b02311a9d2f587eb4c447455c3df68f" category="paragraph">运行 ONTAP 软件的系统在多个重要方面实现了统一。</block>
  <block id="7242358e2514a48e7044717140cacb4b" category="paragraph">最初，这种方法是指在一个存储系统上同时支持 NAS 和 SAN 协议，而 ONTAP 仍然是 SAN 的领先平台，同时也是其在 NAS 中的原始优势。</block>
  <block id="4947dc197f31edea82b3fdab9dc68fdc" category="paragraph">Storage Virtual Machine （ SVM ）是一种逻辑构造，允许客户端访问运行 ONTAP 软件的系统。SVM 可以通过多个数据访问协议通过逻辑接口（ Logical Interface ， LIF ）同时提供数据。SVM 可通过 CIFS 和 NFS 等 NAS 协议提供文件级数据访问，并通过 iSCSI ， FC/FCoE 和 NVMe 等 SAN 协议提供块级数据访问。SVM 可以同时单独为 SAN 和 NAS 客户端提供数据。</block>
  <block id="d6154a0901f9ca6bb5d8fb15c113581e" category="paragraph"><block ref="d6154a0901f9ca6bb5d8fb15c113581e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3c46d272642e0999c025f67e9de315c9" category="paragraph">在 vSphere 环境中，这种方法还可能意味着为虚拟桌面基础架构 (VDI) 和虚拟服务器基础架构（ VSI ）提供一个统一的系统。与传统企业阵列相比，运行 ONTAP 软件的系统的 VSI 成本通常更低，但具有高级存储效率功能，可以在同一系统中处理 VDI 。ONTAP 还统一了从 SSD 到 SATA 的各种存储介质，并可轻松地将其扩展到云。无需购买一个闪存阵列即可实现高性能、一个SATA阵列可用于归档、而单独的系统则可用于云。ONTAP 将所有这些问题联系在一起。</block>
  <block id="e9e0f5f2c513c7138ea70b4c929d6fef" category="inline-link">存储虚拟化</block>
  <block id="54c9439ad8fb4842a5a86c34d2401e36" category="admonition">有关 SVM ，统一存储和客户端访问的详细信息，请参见<block ref="2843f934dec816d79f9c394ad0533c28" category="inline-link-rx"></block> 在 ONTAP 9 文档中心。</block>
  <block id="400cc516a4a40acd605aef2cfd4ba4c0" category="doc">VMware Storage Distributed Resource Scheduler</block>
  <block id="6e210af5c49ef2b81c06b57f989ed5c6" category="paragraph">VMware Storage Distributed Resource Scheduler （ SDRS ）是一项 vSphere 功能，可根据当前 I/O 延迟和空间使用情况将 VM 放置在存储上。</block>
  <block id="e7649bfbacc438bf8e20ba3564db4bdd" category="paragraph">然后，它会在数据存储库集群（也称为 Pod ）中的数据存储库之间无中断地移动虚拟机或 VMDK ，从而选择最佳数据存储库，以便将虚拟机或 VMDK 放置在数据存储库集群中。数据存储库集群是一组相似的数据存储库、从vSphere管理员的角度来看、这些数据存储库会聚合到一个使用单元中。</block>
  <block id="5735cfd4d72f50fd28717ac30361b503" category="paragraph">在将 SDRS 与适用于 VMware vSphere 的 NetApp ONTAP 工具结合使用时，您必须先使用此插件创建数据存储库，使用 vCenter 创建数据存储库集群，然后将此数据存储库添加到其中。创建数据存储库集群后，可以直接从详细信息页面上的配置向导将其他数据存储库添加到数据存储库集群中。</block>
  <block id="b028cce2007c32457c41f20d2954c0c2" category="paragraph">有关 SDRS 的其他 ONTAP 最佳实践包括：</block>
  <block id="d11eff5be5178b7ba95b06270611ffc8" category="list-text">集群中的所有数据存储库都应使用相同类型的存储（例如 SAS ， SATA 或 SSD ），可以是所有 VMFS 或 NFS 数据存储库，并且具有相同的复制和保护设置。</block>
  <block id="76db7ce67615bbc16da685df79ed0aa9" category="list-text">请考虑在默认（手动）模式下使用 SDRS 。通过此方法，您可以查看建议并决定是否应用这些建议。请注意 VMDK 迁移的以下影响：</block>
  <block id="97f4ed95cb52bb29629002a25cb5039f" category="list-text">在数据存储库之间移动 VMDK 时，通过 ONTAP 克隆或重复数据删除节省的任何空间都将丢失。您可以重新运行重复数据删除以重新获得这些节省。</block>
  <block id="38f492286c3edf236c76e993ce0f0bf2" category="list-text">在SDRS移动VMDK后、NetApp建议在源数据存储库中重新创建快照、因为空间会被移动的VM锁定。</block>
  <block id="09a99cbc4fb85d10c7af970e79032a05" category="list-text">在同一聚合上的数据存储库之间移动 VMDK 没有什么优势， SDRS 无法查看可能共享该聚合的其他工作负载。</block>
  <block id="09b616c445ab7efa8240062532e526e4" category="doc">采用ONTAP的VMware vSphere</block>
  <block id="48e29772cebbf1133d022577e278d5c1" category="admonition">本文档可替代先前发布的技术报告_TR-4597：《适用于ONTAP的VMware vSphere》_</block>
  <block id="bfa7e7fc7c6bf4cc4e4c5c74b09763eb" category="paragraph">最佳实践是指南和兼容性列表等其他文档的补充。它们是根据 NetApp 工程师和客户的实验室测试和丰富的现场经验开发的。它们可能并不是在每个环境中都能使用的唯一受支持的实践，但它们通常是最简单的解决方案，可满足大多数客户的需求。</block>
  <block id="9ed4a475dd3705157a9fed8811f63ce2" category="inline-link">NetApp 互操作性表工具</block>
  <block id="e08175c6fa64cba68719dea85ebd9d34" category="inline-link">VMware 兼容性指南</block>
  <block id="c7e9d53e7f1a53451fa25cb6340fbf6f" category="paragraph">本文档重点介绍在vSphere 7.0或更高版本上运行的ONTAP (9.x)的最新版本中的功能。请参见<block ref="37aa2814221d042697a27bc81e148f64" category="inline-link-rx"></block> 和<block ref="e1593898142109fc8cd8025356d3f312" category="inline-link-rx"></block> 有关特定版本的详细信息。</block>
  <block id="74587fa4ad90f8713c0446529a3670e0" category="section-title">为什么选择适用于 vSphere 的 ONTAP ？</block>
  <block id="a110ecc6d4ce7014019c560e5fedf572" category="paragraph">成千上万的客户选择ONTAP作为其vSphere存储解决方案的原因有很多、例如、支持SAN和NAS协议的统一存储系统、使用节省空间的快照的强大数据保护功能以及大量可帮助您管理应用程序数据的工具。使用与虚拟机管理程序不同的存储系统，您可以卸载许多功能，并最大程度地提高对 vSphere 主机系统的投资。这种方法不仅可以确保主机资源专注于应用程序工作负载，还可以避免存储操作对应用程序造成随机性能影响。</block>
  <block id="0f50acddbdbb9aa9712a471f2276e655" category="paragraph">将 ONTAP 与 vSphere 结合使用是一个很好的组合，可帮助您降低主机硬件和 VMware 软件支出。您还可以通过稳定一致的高性能以更低的成本保护数据。由于虚拟化工作负载是移动的，因此您可以使用 Storage vMotion 探索不同的方法，以便在 VMFS ， NFS 或 VVOL 数据存储库之间移动 VM ，所有这些都位于同一存储系统上。</block>
  <block id="90977175b761542615a11f2b96cc4cbd" category="paragraph">以下是客户目前重视的关键因素：</block>
  <block id="442c1f0ac31c3d71b638125e0a8b51da" category="list-text">* 统一存储。 * 运行 ONTAP 软件的系统在多个重要方面实现了统一。最初，这种方法既指 NAS 协议，也指 SAN 协议，而 ONTAP 除了在 NAS 中具有最初的优势之外，仍然是 SAN 的领先平台。在 vSphere 环境中，这种方法还可能意味着为虚拟桌面基础架构 (VDI) 和虚拟服务器基础架构（ VSI ）提供一个统一的系统。与传统企业阵列相比，运行 ONTAP 软件的系统的 VSI 成本通常更低，但具有高级存储效率功能，可以在同一系统中处理 VDI 。ONTAP 还统一了从 SSD 到 SATA 的各种存储介质，并可轻松地将其扩展到云。无需购买一个闪存阵列即可实现高性能、一个SATA阵列可用于归档、而单独的系统则可用于云。ONTAP 将所有这些问题联系在一起。</block>
  <block id="0ce37df1cd9b66a2abde8244f17fc051" category="list-text">*基于虚拟卷和存储策略的管理。* NetApp是VMware的早期设计合作伙伴、参与了vSphere虚拟卷(vvol)的开发、为vvol和VMware vSphere APIS for Storage AWAREIVAINVAL (vasa)提供了架构建议和早期支持。这种方法不仅可以为VMFS提供精细的VM存储管理、还可以通过基于存储策略的管理来实现存储配置自动化。通过这种方法，存储架构师可以设计具有不同功能的存储池， VM 管理员可以轻松地使用这些功能。ONTAP 在 VVOL 规模方面处于存储行业的领先地位，在一个集群中支持数十万个 VVOL ，而企业级阵列和小型闪存阵列供应商则支持每个阵列仅支持数千个 VVOL 。此外， NetApp 还在推动细粒度虚拟机管理的发展，即将推出支持 VVOL 3.0 的功能。</block>
  <block id="9eeea06a6a7f860f801343c04af5d7d2" category="list-text">*存储效率。*虽然NetApp是第一家为生产工作负载提供重复数据删除的公司、但这项创新并非该领域的第一项或最后一项创新。它从快照开始、这是一种节省空间的数据保护机制、不会影响性能、同时还采用了FlexClone技术、可即时为VM创建读/写副本、以供生产和备份使用。NetApp 继续提供包括重复数据删除，数据压缩和零块重复数据删除在内的实时功能，以从昂贵的 SSD 中挤出最大的存储空间。最近， ONTAP 增加了使用数据缩减将较小的 I/O 操作和文件打包到磁盘块中的功能。这些功能相结合，客户发现 VSI 可节省高达 5 ： 1 的空间， VDI 可节省高达 30 ： 1 的空间。</block>
  <block id="bb73602f3344c326a7b63c94db24362a" category="list-text">* 混合云。 * 无论是用于内部私有云，公有云基础架构还是结合两者优势的混合云， ONTAP 解决方案均可帮助您构建数据网络结构，以简化和优化数据管理。从高性能全闪存系统开始，然后将其与磁盘或云存储系统结合使用，以实现数据保护和云计算。您可以选择 Azure ， AWS ， IBM 或 Google 云来优化成本并避免受制于云。根据需要利用对 OpenStack 和容器技术的高级支持。NetApp 还为 ONTAP 提供基于云的备份（ SnapMirror 云， Cloud Backup Service 和 Cloud Sync ）以及存储分层和归档工具（ FabricPool ），以帮助降低运营支出并利用云的广泛覆盖范围。</block>
  <block id="7a61ec7965eebc0b5486cb78f096c770" category="list-text">等等。 * 利用 NetApp AFF A 系列阵列的极致性能，在管理成本的同时加快虚拟化基础架构的运行速度。使用横向扩展 ONTAP 集群享受从维护到升级到完全更换存储系统的无中断运行。利用 NetApp 加密功能保护空闲数据，无需额外付费。通过精细的服务质量功能确保性能满足业务服务级别要求。它们都是行业领先的企业级数据管理软件ONTAP提供的广泛功能的一部分。</block>
  <block id="6104c8ef7be4222a76596ab6a22bb422" category="doc">建议的 ESXi 主机和其他 ONTAP 设置</block>
  <block id="0416d04b345b434b120840c30ddaf0a1" category="paragraph">NetApp 已根据 NetApp 测试开发出一组 ESXi 主机多路径和 HBA 超时设置，用于正确处理 ONTAP 。可以使用适用于 VMware vSphere 的 ONTAP 工具轻松设置这些设置。在摘要信息板中，单击主机系统 portlet 中的编辑设置，或者右键单击 vCenter 中的主机，然后导航到 ONTAP tools &gt; Set recommended values 。下面是当前在 9.8 版中建议的主机设置。</block>
  <block id="678582eb0cbbe0e063e618d230b63223" category="cell">*主机设置*</block>
  <block id="dfe49b73bd7e747701b49f9ed21ea2d6" category="cell">* NetApp建议值*</block>
  <block id="edceae57d92287f4f6200f94d3259cd0" category="cell">*需要重新启动*</block>
  <block id="dc3a6955a23583876d020db0f6b80d4d" category="cell">* ESXi高级配置*</block>
  <block id="73663d0d00956f0632e4ae75d811d53f" category="cell">VMFS3.HardwareAcceleratedLocking</block>
  <block id="59b1aceaef0203fdc32e11df232b16e6" category="cell">保留默认值(1)</block>
  <block id="bafd7322c6e97d25b6299b5d6fe8920b" category="cell">否</block>
  <block id="1b50110aedae4d8d2043a4eb9beb20af" category="cell">VMFS3.EnableBlockDelete</block>
  <block id="5d1b81f1885499e392018ebd7124ad37" category="inline-link-macro">VMware知识库2007427</block>
  <block id="3aca64366573d9850e0148ce2a38164c" category="cell">保留默认值(0)、但可以根据需要进行更改。
有关详细信息，请参见 <block ref="68c2cf0ecb6a1c6abaf6e56c035d5866" category="inline-link-macro-rx"></block></block>
  <block id="316084648bbafe451240702bd19c6ee9" category="cell">VMFS3.EnableVMFS6Unmap</block>
  <block id="befd90cd01403237f6fdf296822efbee" category="inline-link-macro">VMware vSphere API：阵列集成(VAAI)</block>
  <block id="e385d2442208cc1e23ca841b1f217380" category="cell">保留默认值(1)
有关详细信息，请参见 <block ref="d124e203790e5f214a195f69cd068c6d" category="inline-link-macro-rx"></block></block>
  <block id="571cc1d48c6d1ff3cf7e3a54cb035753" category="cell">*NFS设置*</block>
  <block id="c3b49a515dd0046685e06092642aa139" category="cell">Net.TcpipHeapSize</block>
  <block id="875f6b98e20edfecb56f9013d00987f6" category="cell">vSphere 6.0 或更高版本，设置为 32 。
所有其他NFS配置、设置为30</block>
  <block id="93cba07454f06a4a960172bbd6e2a435" category="cell">是的。</block>
  <block id="504e96cc79e7efe30a8271cea152d9d1" category="cell">Net.TcpipHeapMax</block>
  <block id="a8af33a99dd728969fd947da27a2f69f" category="cell">对于大多数vSphere 6.X版本、设置为512 MB。
对于6.5U3、6.7U3和7.0或更高版本、设置为1024 MB。</block>
  <block id="5f1e7b6431061565550e292d05c73588" category="cell">NFS.MaxVolumes</block>
  <block id="e787d5b0d643685421632a1af3914963" category="cell">vSphere 6.0或更高版本、请设置为256
所有其他NFS配置、设置为64。</block>
  <block id="3058676a1cf088aa4a73312ac36f2a58" category="cell">NFS41.MaxVolumes</block>
  <block id="62c07f94c64184ee5d530e4c0917093f" category="cell">vSphere 6.0或更高版本、请设置为256。</block>
  <block id="e18600af98c17fae10fdba0dc89979ed" category="cell">NFS.MaxQueueDepth^1^</block>
  <block id="be7707fa525d0124489c9fe3072f78de" category="cell">vSphere 6.0或更高版本、设置为128</block>
  <block id="18e1fb6924459470760771b20ab0c379" category="cell">nfs.HeartbeatMaxFailures</block>
  <block id="138989cbe5dd3a4997662e0f65c17878" category="cell">对于所有NFS配置、均设置为10</block>
  <block id="1aa26eb281359ba3b9a9a4b83a09ed46" category="cell">nfs.Heartbeat频率</block>
  <block id="7ea6e8664542e3beb1aea10425efb4db" category="cell">对于所有NFS配置、请设置为12</block>
  <block id="eb4182715f8cde98563dc59ea36461d3" category="cell">nfs.HeartbeatTimeout</block>
  <block id="45aa5481fa55802a29a96aefd2f5dab1" category="cell">对于所有NFS配置、设置为5。</block>
  <block id="54a08b15243d9078d3b5a47f8242da6f" category="cell">SUNRPC.MaxConnPerIP</block>
  <block id="9a9ccbecb3f315797ff8e709d85a0e18" category="cell">vSphere 7.0或更高版本、请设置为128。</block>
  <block id="c0b3fd5512c2093847f753f398290f30" category="cell">* FC/FCoE 设置 *</block>
  <block id="2e556ad678160413b32dcca55c7d1f5f" category="cell">路径选择策略</block>
  <block id="fb62337a3ef32f4701b639339a4ceb33" category="cell">如果使用采用 ALUA 的 FC 路径，则设置为 RR （轮循）。对于所有其他配置，设置为 FIXED 。
将此值设置为 RR 有助于在所有主动 / 优化路径之间实现负载平衡。
固定值适用于较旧的非 ALUA 配置，有助于防止代理 I/O换言之、它有助于防止I/O流向在7-模式下运行Data ONTAP 的环境中高可用性(HA)对的另一节点</block>
  <block id="117704664d6cada78ac3107380f63d23" category="cell">disk.qFullSampSize</block>
  <block id="0e82e1f81de2159b0e9bee0b7be00dc9" category="cell">对于所有配置，均设置为 32 。
设置此值有助于防止出现 I/O 错误。</block>
  <block id="f66a3c183f0e736240b77f8b755c880e" category="cell">disk.qFullThreshold</block>
  <block id="bdd8c1d08eabb5e1923ed8f0c4b10ba4" category="cell">对于所有配置、均设置为8。
设置此值有助于防止出现 I/O 错误。</block>
  <block id="19c08de7404551288e1274186e039ef4" category="cell">Emulex FC HBA 超时</block>
  <block id="b4dbfc2d52627e923cbb563a31ff756d" category="cell">使用默认值。</block>
  <block id="d46cddda4da7ec11f17472d11df95b68" category="cell">QLogic FC HBA 超时</block>
  <block id="19b5aaf3e2cb86809996ca63a2a416b0" category="cell">* iSCSI 设置 *</block>
  <block id="2aa077454308383f1e82025427cd7362" category="cell">对于所有 iSCSI 路径，设置为 RR （轮循）。
将此值设置为 RR 有助于在所有主动 / 优化路径之间实现负载平衡。</block>
  <block id="0340eb1bcbfc6cd3c62b8a878d8d643b" category="cell">对于所有配置，均设置为 32 。
设置此值有助于防止出现I/O错误</block>
  <block id="891c10448731ad57490b9a932dabfff8" category="inline-link-macro">VMware知识库86331</block>
  <block id="2c572e3c397fe100b075a09359c9cc23" category="admonition">1—使用VMware vSphere ESXi 7.0.1和VMware vSphere ESXi 7.0.2时、NFS高级配置选项MaxQueueDepth可能无法按预期工作。请参考 <block ref="861055760f3cd527823fd34a49459992" category="inline-link-macro-rx"></block> 有关详细信息 ...</block>
  <block id="fb55ee99c04280ac638757869929785d" category="paragraph">在创建 ONTAP FlexVol 卷和 LUN 时， ONTAP 工具还会指定某些默认设置：</block>
  <block id="3f7502a5f109d7a73706aba1c0741a4b" category="cell">* ONTAP Tool*</block>
  <block id="485577e97e8efcd504fc8e8b13e613f1" category="cell">*默认设置*</block>
  <block id="5938fe448c8661febcef3f4e779e3adb" category="cell">Snapshot 预留（ -percent-snapshot-space ）</block>
  <block id="cfcd208495d565ef66e7dff9f98764da" category="cell">0</block>
  <block id="7218aec62575561a6de1cae8d5658390" category="cell">预留百分比（ -fractional-reserve ）</block>
  <block id="3a7e09ff0fa38663ffe6d91324ea75d9" category="cell">访问时间更新（ -atime-update ）</block>
  <block id="f8320b26d30ab433c5a54546d21f414c" category="cell">false</block>
  <block id="e93200d5b0d16915bf04236790544b2f" category="cell">最小预读（ -min-readahead ）</block>
  <block id="c877d89702fdd14e51b02028a20c7d07" category="cell">计划快照</block>
  <block id="fd18465573ec21a6218982055981f6b1" category="cell">存储效率</block>
  <block id="00d23a76e43b46dae9ec7aa9dcbebb32" category="cell">enabled</block>
  <block id="f65fd63b63c9e9f25bf6bc141e83de34" category="cell">卷保证</block>
  <block id="c2410aebdf425dabcc65e546e506b03e" category="cell">无（精简配置）</block>
  <block id="f97c03bf3e9580446d70d479f5aad1e0" category="cell">卷自动调整大小</block>
  <block id="d89f4f8b1d7c18847b88b46142f61535" category="cell">grow_shrink</block>
  <block id="ace72ec54e17777d27eb8bdb9d57e782" category="cell">LUN 空间预留</block>
  <block id="b9f5c797ebbf55adccdd8539a65a0241" category="cell">已禁用</block>
  <block id="514aa7792a71ab4ab677eb2385131aae" category="cell">LUN 空间分配</block>
  <block id="dbe1e98b00264bd496095ed5c95f9350" category="section-title">多路径性能设置</block>
  <block id="de9f44b08eec22d6b405acff2c925d56" category="paragraph">虽然当前未使用可用的ONTAP工具进行配置、但NetApp建议使用以下配置选项：</block>
  <block id="840731ae1cb9e4b23e19f645ab018b6f" category="inline-link">2069356</block>
  <block id="5073fc9da327263a7db04fd449991e6a" category="list-text">在高性能环境中或使用单个 LUN 数据存储库测试性能时，请考虑将轮循（ VMW_PSP_RR ）路径选择策略（ PSP ）的负载平衡设置从默认 IOPS 设置 1000 更改为 1 。请参见 VMware 知识库<block ref="f3f4762788a6845119bdb5b9c9179bda" category="inline-link-rx"></block> 了解更多信息。</block>
  <block id="1ea3eb55b985cf75e100607ee8bd935d" category="inline-link">路径选择插件和策略</block>
  <block id="249afbf456bd04d574e8d362d5bf133c" category="list-text">在 vSphere 6.7 Update 1 中， VMware 为轮循 PSP 引入了一种新的延迟负载平衡机制。新选项会在选择最佳 I/O 路径时考虑 I/O 带宽和路径延迟如果在具有非等效路径连接的环境中使用该工具，则可能会受益，例如，一条路径上的网络跃点多于另一条路径，或者使用 NetApp 全 SAN 阵列系统时。请参见<block ref="f5ecc69f2970e2e9c8638ad278ec38f7" category="inline-link-rx"></block> 有关详细信息 ...</block>
  <block id="01d954fb2edbf283d121f0651b04de83" category="section-title">其他文档</block>
  <block id="40db5019ed68654f4eb2cf21ec5021db" category="inline-link">将VMware vSphere 7.x与ONTAP结合使用</block>
  <block id="30d85838b9488ee908d075559c8978cd" category="inline-link">将VMware vSphere 8.x与ONTAP结合使用</block>
  <block id="000c9205416c1ea85f6841a7ca379c17" category="inline-link">对于NVMe-oF、有关详细信息、请参见适用于采用ONTAP的ESXi 7.x的NVMe-oF主机配置</block>
  <block id="5a27e6dbe6279e323aec51d205b2b455" category="inline-link">对于NVMe-oF、有关详细信息、请参见适用于采用ONTAP的ESXi 8.x的NVMe-oF主机配置</block>
  <block id="842acd8b4932f6c9329df8e0fefe8b9b" category="paragraph">对于vSphere 7中的FCP和iSCSI、有关详细信息、请参见<block ref="f3eae508de4d3c1748a9c65337197b21" category="inline-link-rx"></block>
对于采用vSphere 8的FCP和iSCSI、有关详细信息、请参见<block ref="3f8db75ee0177b85df9cdf31ddb51abe" category="inline-link-rx"></block>
对于采用vSphere 7的NVMe-oF、有关详细信息、请参见<block ref="6c040a6e611e78bb9d0ad92946e613ea" category="inline-link-rx"></block>
对于采用vSphere 8的NVMe-oF、有关详细信息、请参见<block ref="030788e4c7bbe3137759b534ea62d7d9" category="inline-link-rx"></block></block>
  <block id="99a66df20e19a8e18fae37a7f714750a" category="doc">虚拟机和数据存储库克隆</block>
  <block id="fe12a277656562082ad50b980c227a84" category="paragraph">在 vSphere 中，您可以克隆虚拟机，虚拟磁盘， VVol 或数据存储库。克隆后，通常可以通过自动化过程进一步自定义对象。vSphere 既支持完整副本克隆，也支持链接克隆，在这些克隆中，它可以独立于原始对象跟踪更改。</block>
  <block id="883a97a36ab0c59ec785b03161a1cc32" category="paragraph">链接克隆非常有助于节省空间，但它们会增加 vSphere 为虚拟机处理的 I/O 量，从而影响该虚拟机的性能，甚至整个主机的性能。因此、NetApp客户经常使用基于存储系统的克隆来充分利用这两种环境：高效利用存储和提高性能。</block>
  <block id="17e1a153b5d05c5a642c93ba9ce3c6de" category="paragraph">下图显示了 ONTAP 克隆。</block>
  <block id="8ee3cd3dba25fb32f1bc38cb528ac998" category="paragraph"><block ref="8ee3cd3dba25fb32f1bc38cb528ac998" category="inline-image-macro-rx" type="image"></block></block>
  <block id="76ee7355875ad5e9f56186ff7da961f6" category="paragraph">可以通过多种机制将克隆卸载到运行 ONTAP 软件的系统，通常是在 VM ， VVOL 或数据存储库级别。其中包括：</block>
  <block id="d957242cd67db8ffccec78d93c14449d" category="list-text">使用 NetApp vSphere APIs for Storage Awareness （ VASA ） Provider 的 VVOL 。  ONTAP克隆用于支持由vCenter管理的VVol快照、这些快照可节省空间、并且创建和删除这些快照时的I/O影响极小。  此外，还可以使用 vCenter 克隆 VM ，这些 VM 也会卸载到 ONTAP ，无论是在单个数据存储库 / 卷中还是在数据存储库 / 卷之间。</block>
  <block id="059e5a6b7f963e9876ba0129dc1b667d" category="list-text">使用 vSphere API —阵列集成（ VAAI ）进行 vSphere 克隆和迁移。在 SAN 和 NAS 环境中， VM 克隆操作均可卸载到 ONTAP （ NetApp 提供了一个 ESXi 插件，用于为 NFS 启用 VAAI ）。  vSphere 仅会卸载 NAS 数据存储库中冷（已关闭） VM 上的操作，而热 VM （克隆和存储 vMotion ）上的操作也会卸载到 SAN 上。ONTAP 会根据源，目标和已安装的产品许可证使用最高效的方法。VMware Horizon View 也使用此功能。</block>
  <block id="a603c207c7b5801942ff108502676c12" category="list-text">SRA （与 VMware Site Recovery Manager 结合使用）。此处，克隆用于无中断测试灾难恢复副本的恢复情况。</block>
  <block id="bb300d356d258c084dbe5da2ca367e08" category="list-text">使用 SnapCenter 等 NetApp 工具进行备份和恢复。VM 克隆用于验证备份操作以及挂载 VM 备份，以便可以复制单个文件。</block>
  <block id="524b5b8bc03312baeafbea86df667c4b" category="paragraph">VMware ， NetApp 和第三方工具可以调用 ONTAP 卸载克隆。卸载到 ONTAP 的克隆具有多个优势。在大多数情况下，它们节省空间，只需要存储即可更改对象；读取和写入它们不会产生额外的性能影响，在某些情况下，通过在高速缓存中共享块来提高性能。它们还会从 ESXi 服务器卸载 CPU 周期和网络 I/O 。使用 FlexVol 卷在使用 FlexClone 的传统数据存储库中进行副本卸载速度快，效率高，但 FlexVol 卷之间的副本卸载速度可能较慢。如果您将 VM 模板维护为克隆源，请考虑将其放置在数据存储库卷中（使用文件夹或内容库对其进行组织），以实现节省空间的快速克隆。</block>
  <block id="f3968368501d882b3969da59138db6e2" category="paragraph">您也可以直接在 ONTAP 中克隆卷或 LUN 以克隆数据存储库。使用 NFS 数据存储库时， FlexClone 技术可以克隆整个卷，并且可以从 ONTAP 导出克隆并由 ESXi 作为另一个数据存储库挂载该克隆。对于 VMFS 数据存储库， ONTAP 可以克隆卷或整个卷中的 LUN ，包括其中的一个或多个 LUN 。包含 VMFS 的 LUN 必须映射到 ESXi 启动程序组（ igroup ），然后由 ESXi 重新签名，才能挂载并用作常规数据存储库。对于某些临时使用情形，可以挂载克隆的 VMFS 而无需重新签名。克隆数据存储库后，可以注册，重新配置和自定义数据存储库中的 VM ，就像它们是单独克隆的 VM 一样。</block>
  <block id="2d506b6088a383ccf08479b0f80c0ff4" category="paragraph">在某些情况下，可以使用其他许可功能来增强克隆功能，例如用于备份的 SnapRestore 或 FlexClone 。这些许可证通常包含在许可证包中，无需额外付费。要执行vVol克隆操作以及支持vVol的受管快照(从虚拟机管理程序卸载到ONTAP)、需要FlexClone许可证。在数据存储库 / 卷中使用 FlexClone 许可证还可以改进某些基于 VAAI 的克隆（创建节省空间的即时副本，而不是块副本）。  此外， SRA 还会使用它来测试灾难恢复副本的恢复，并使用 SnapCenter 来执行克隆操作，以及浏览备份副本以还原单个文件。</block>
  <block id="5dd57c2a315d3af44c2eb40eefc47111" category="doc">网络配置：</block>
  <block id="66507f357c74ee12194270cfe053b98d" category="paragraph">需要考虑以下几点：</block>
  <block id="7c4904daaa282388097ad83bf382e1a5" category="list-text">如果您的网络需要并支持巨型帧，则可以使用巨型帧，尤其是在使用 iSCSI 时。如果使用这些协议，请确保在存储和 ESXi 主机之间的路径中的所有网络设备， VLAN 等上对其进行相同的配置。否则，您可能会看到性能或连接问题。此外，还必须在 ESXi 虚拟交换机， VMkernel 端口以及每个 ONTAP 节点的物理端口或接口组上以相同的方式设置 MTU 。</block>
  <block id="8b6e7f43d1d697e8f99164f0aa2ab1b6" category="inline-link">TR-4182</block>
  <block id="3745abd352adaa2cdec42c798060eef6" category="list-text">NetApp 仅建议在 ONTAP 集群中的集群网络端口上禁用网络流量控制。对于用于数据流量的其余网络端口， NetApp 不提供其他最佳实践建议。您应根据需要启用或禁用。请参见<block ref="bdfb81665a0ef86d871a52c0e6ebc591" category="inline-link-rx"></block> 了解有关流量控制的更多背景信息。</block>
  <block id="730a8287f758961d602b1b050bbe2751" category="list-text">当 ESXi 和 ONTAP 存储阵列连接到以太网存储网络时， NetApp 建议将这些系统连接到的以太网端口配置为快速生成树协议（ RSTP ）边缘端口或使用 Cisco PortFast 功能。NetApp 建议在使用 Cisco PortFast 功能且为 ESXi 服务器或 ONTAP 存储阵列启用了 802.1Q VLAN 中继的环境中启用生成树 PortFast 中继功能。</block>
  <block id="ac4976538e1fc8726f77afc202561afc" category="list-text">NetApp 建议采用以下链路聚合最佳实践：</block>
  <block id="301c77ecc6cdfa6ebde6c8164cffae0c" category="list-text">使用支持在两个独立交换机机箱上对端口进行链路聚合的交换机、并采用多机箱链路聚合组方法、例如Cisco的虚拟端口通道(vPC)。</block>
  <block id="19d137845c7f6687c99b386dfad0aa97" category="list-text">对连接到ESXi的交换机端口禁用LACP、除非您使用的是配置了LACP的dvSwitches 5.1或更高版本。</block>
  <block id="30254a2bb3e4b3b958b06d08c724e7db" category="list-text">使用LACP为具有IP哈希的动态多模式接口组的ONTAP 存储系统创建链路聚合。</block>
  <block id="d608421cceb8e4c584a2a32d9127879e" category="list-text">在ESXi上使用IP哈希绑定策略。</block>
  <block id="2432030fc6183a1a6c52cf5e93f3e9ae" category="paragraph">下表汇总了网络配置项，并指出了这些设置的应用位置。</block>
  <block id="7d74f3b92b19da5e606d737d339a9679" category="cell">项目</block>
  <block id="1aa66ef3a8e34a7a538960a80d2e1e31" category="cell">ESXi</block>
  <block id="bbc155fb2b111bf61c4f5ff892915e6b" category="cell">交换机</block>
  <block id="6c3a6944a808a7c0bbb6788dbec54a9f" category="cell">Node</block>
  <block id="0b7e67b6cdcf0432b624d53588d520fb" category="cell">SVM</block>
  <block id="75ba8d70e3692ba200f0e0df37b4d2ae" category="cell">IP 地址</block>
  <block id="ee6c0f25c2881cc69947a2ef23be5b8c" category="cell">VMkernel</block>
  <block id="e11f298a5bd5344d2d975b5157c27b69" category="cell">否</block>
  <block id="d6f0876f76c273b8962b749c36153157" category="cell">链路聚合</block>
  <block id="fabd320b3b2249377e53e93099e27657" category="cell">虚拟交换机</block>
  <block id="b1b40427c8eb8d0a083ddb16e250325b" category="cell">否 *</block>
  <block id="9881f82f0dd89588831f9d1682bd5492" category="cell">VLAN</block>
  <block id="5fc0d231160fa9650ea5c877f146bbe6" category="cell">VMkernel 和 VM 端口组</block>
  <block id="39a3e05f380e583ae2887c79c7443f11" category="cell">流量控制</block>
  <block id="220071ab44b426f80ef21f1c552c363c" category="cell">NIC</block>
  <block id="6f2c08412f489e52a17a30217f50b3c1" category="cell">生成树</block>
  <block id="4b1c0df98ba3f3d1681c3c3dbdc97746" category="cell">MTU （适用于巨型帧）</block>
  <block id="7d6feaf896df4a937157d4ee5b91f4e1" category="cell">虚拟交换机和 VMkernel 端口（ 9000 ）</block>
  <block id="0110e50bd8629573701e73a4ba8b056f" category="cell">是（设置为最大值）</block>
  <block id="061ff5255adf00e4ae68469f43a7bf55" category="cell">是（ 9000 ）</block>
  <block id="bcc0e5a3e08cd34e80692195d056b06d" category="cell">故障转移组</block>
  <block id="a4d1a66a448e327c12d3e287098a31d5" category="cell">是（创建）</block>
  <block id="465d5674eb6808b997037470f4dace73" category="cell">是（选择）</block>
  <block id="ba78d695573c8d4f1205452c675fa539" category="paragraph">* SVM LIF连接到具有VLAN、MTU和其他设置的端口、接口组或VLAN接口。但是、这些设置不会在SVM级别进行管理。</block>
  <block id="50ecdab93bf5a2f1bfb4cd8f81b9bd3d" category="paragraph">这些设备具有自己的 IP 地址进行管理，但这些地址不会在 ESXi 存储网络环境中使用。</block>
  <block id="efd0bde36323238fec688b9cdf0c75a3" category="section-title">SAN （ FC ， FCoE ， NVMe/FC ， iSCSI ）， RDM</block>
  <block id="29cdd488736a6111699f7348320bbed7" category="paragraph">在 vSphere 中，可以通过三种方式使用块存储 LUN ：</block>
  <block id="8982d243303f9d1a8c2470b7d55278e6" category="list-text">使用 VMFS 数据存储库</block>
  <block id="9a0098c8c1be287e8d1da1aaf3bd2e59" category="list-text">使用原始设备映射（ RDM ）</block>
  <block id="93e209176746ac6f25c618631a02643b" category="list-text">作为 LUN ，由软件启动程序从 VM 子操作系统访问和控制</block>
  <block id="c25dc676ca39a05ee6067ac9a50dbce0" category="paragraph">VMFS 是一种高性能集群文件系统，可提供共享存储池中的数据存储库。可以为 VMFS 数据存储库配置 LUN ，这些 LUN 可通过 NVMe/FC 协议访问的 FC ， iSCSI ， FCoE 或 NVMe 命名空间进行访问。VMFS 允许集群中的每个 ESX 服务器同时访问传统 LUN 。ONTAP 最大 LUN 大小通常为 16 TB ；因此，使用四个 16 TB LUN （所有 SAN 阵列系统均支持最大 VMFS LUN 大小为 64 TB ）来创建最大 64 TB 的 VMFS 5 数据存储库（请参见本节中的第一个表）。由于 ONTAP LUN 架构不具有较小的单个队列深度，因此 ONTAP 中的 VMFS 数据存储库可以以相对简单的方式扩展到比传统阵列架构更大的程度。</block>
  <block id="43f67f108e50dab0978a343603cbfec9" category="paragraph">vSphere 内置了对存储设备的多条路径的支持，称为原生多路径（ NMP ）。NMP 可以检测受支持存储系统的存储类型，并自动配置 NMP 堆栈以支持正在使用的存储系统的功能。</block>
  <block id="6bf646772584de04f877d166e564b5ff" category="paragraph">NMP 和 NetApp ONTAP 均支持非对称逻辑单元访问（ Asymmetric Logical Unit Access ， ALUA ）来协商优化和非优化路径。在 ONTAP 中，经过 ALUA 优化的路径遵循直接数据路径，并使用托管所访问 LUN 的节点上的目标端口。默认情况下，在 vSphere 和 ONTAP 中均已启用 ALUA 。NMP会将ONTAP集群识别为ALOA、并使用ALOA存储阵列类型插件 <block ref="d4f7bd3bf4872a2f8cd0cbe400fb23d0" prefix="(" category="inline-code"></block>)、然后选择轮循环路径选择插件 <block ref="4646bb781f9a95f64c182af129e43c7c" prefix="(" category="inline-code"></block>）。</block>
  <block id="b284ee628d89c3e804c4def2a90f0520" category="paragraph">ESXi 6 最多支持 256 个 LUN 以及 1 ， 024 个 LUN 的总路径。ESXi 无法识别超出这些限制的任何 LUN 或路径。假设 LUN 数量达到最大值，则路径限制允许每个 LUN 使用四个路径。在较大的 ONTAP 集群中，可以在达到 LUN 限制之前达到路径限制。为了解决此限制， ONTAP 在 8.3 及更高版本中支持选择性 LUN 映射（ SLM ）。</block>
  <block id="8466b1e5abb4751e931c5feb1af4e469" category="inline-link">TR-4080</block>
  <block id="e9e7de5d01d51034d9114fd8f16c9144" category="paragraph">SLM 会限制向给定 LUN 公布路径的节点。NetApp 最佳实践是，每个 SVM 的每个节点至少具有一个 LIF ，并使用 SLM 限制向托管 LUN 的节点及其 HA 配对节点公布的路径。虽然存在其他路径、但默认情况下不会公布这些路径。可以使用 SLM 中的添加和删除报告节点参数修改公布的路径。请注意，在 8.3 之前的版本中创建的 LUN 会公布所有路径，需要进行修改，以便仅向托管 HA 对公布这些路径。有关 SLM 的详细信息，请查看的第 5.9 节<block ref="c6b12416d518b4689065ffe16afe88db" category="inline-link-rx"></block>。也可以使用先前的端口集方法进一步减少 LUN 的可用路径。端口集有助于减少 igroup 中启动程序可通过的可见路径数。</block>
  <block id="4157f0c23fc104508f492dc846f187f3" category="list-text">默认情况下， SLM 处于启用状态。除非使用端口集，否则不需要进行其他配置。</block>
  <block id="597f1433ad810b3b86c7ae0f8f95afa8" category="list-text">对于在Data ONTAP 8.3之前创建的LUN、请通过运行手动应用SLM<block ref="886fd385b633a0746a8a08f8f00c67cd" prefix=" " category="inline-code"></block> 命令以删除LUN报告节点并将LUN访问限制为LUN所属节点及其HA配对节点。</block>
  <block id="43919b4d4d6d446ed498e26bff62db84" category="paragraph">块协议（ iSCSI ， FC 和 FCoE ）使用 LUN ID 和序列号以及唯一名称来访问 LUN 。FC 和 FCoE 使用全球通用名称（ WWPN 和 WWPN ）， iSCSI 使用 iSCSI 限定名称（ IQN ）。存储中 LUN 的路径对于块协议没有意义，并且不会显示在协议的任何位置。因此，只包含 LUN 的卷根本无需在内部挂载，而包含数据存储库中使用的 LUN 的卷则不需要接合路径。ONTAP 中的 NVMe 子系统的工作原理类似。</block>
  <block id="ed0e76ed86e852bd7317a09d856ec4e8" category="paragraph">要考虑的其他最佳实践：</block>
  <block id="93586ad57931e0f16fff61cdba9d77df" category="list-text">确保为 ONTAP 集群中每个节点上的每个 SVM 创建一个逻辑接口（ LIF ），以最大程度地提高可用性和移动性。ONTAP SAN 最佳实践是，每个节点使用两个物理端口和 LIF ，每个网络结构使用一个。ALUA 用于解析路径并识别活动优化（直接）路径与活动非优化路径。ALUA 用于 FC ， FCoE 和 iSCSI 。</block>
  <block id="b3cebb7381bddbabb1e950a46d264190" category="list-text">对于 iSCSI 网络，如果存在多个虚拟交换机，请在采用 NIC 绑定的不同网络子网上使用多个 VMkernel 网络接口。您还可以使用连接到多个物理交换机的多个物理 NIC 来提供 HA 并提高吞吐量。下图提供了多路径连接的示例。在 ONTAP 中，使用连接到两个或更多交换机的两个或更多链路配置一个单模式接口组以进行故障转移，或者使用 LACP 或其他具有多模式接口组的链路聚合技术来提供 HA 和链路聚合的优势。</block>
  <block id="2968b9f3c141bf23bc73d0e6e15a174a" category="list-text">如果在ESXi中使用质询握手身份验证协议(Challenge-Handshake Authentication Protocol、CHAP)进行目标身份验证、则还必须在ONTAP中使用命令行界面配置此协议 <block ref="199c9b970eacf1c35d84a383b7ceb210" prefix="(" category="inline-code"></block>)或使用System Manager (在"Storage"&gt;"SVM"&gt;"SVM Settings"(SVM设置)&gt;"Protocols"(协议)&gt;"iSCSI"下编辑"Initiator Security"(启动程序安全性)。</block>
  <block id="d31f2e075df4ca75ca0874fa08f74b12" category="list-text">使用适用于 VMware vSphere 的 ONTAP 工具创建和管理 LUN 和 igroup 。此插件会自动确定服务器的 WWPN 并创建适当的 igroup 。它还会根据最佳实践配置 LUN 并将其映射到正确的 igroup 。</block>
  <block id="de78559e8aed2cd62fbf852f73dc58c2" category="inline-link">物理和虚拟兼容模式</block>
  <block id="905221150fdd103b5241870a0a1f2c42" category="list-text">请谨慎使用VMM、因为它们更难管理、而且它们还会使用路径、如前文所述、这些路径会受到限制。ONTAP LUN 支持这两者<block ref="27e1f8e5a88cfbb2836b083145b004c9" category="inline-link-rx"></block> RDM 。</block>
  <block id="636da39a2033c6179a718983c5ce1222" category="inline-link">《 ONTAP NVMe/FC 主机配置指南》</block>
  <block id="81ef6507a13da5635951bc5b533deb59" category="inline-link">TR-4684.</block>
  <block id="15483b0826bb9a4b11d1c89af2029c5c" category="list-text">有关将 NVMe/FC 与 vSphere 7.0 结合使用的详细信息，请参见此部分<block ref="6b4ed262d14e47ef641cd57b65c32c38" category="inline-link-rx"></block> 和<block ref="7a29b2f31035a451d5b068728d2b79a7" category="inline-link-rx"></block>下图显示了从 vSphere 主机到 ONTAP LUN 的多路径连接。</block>
  <block id="f9fd9ea22ea7a2e8ec9e95254a449831" category="paragraph"><block ref="f9fd9ea22ea7a2e8ec9e95254a449831" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f2a693e1f056b96566c4551fcab418f2" category="paragraph">通过 vSphere ，客户可以使用企业级 NFS 阵列为 ESXi 集群中的所有节点提供对数据存储库的并发访问。如数据存储库一节所述，在将 NFS 与 vSphere 结合使用时，可以获得一些易用性和存储效率可见性优势。</block>
  <block id="743fa5a7bc7d4ba215b096e34779d298" category="paragraph">将 ONTAP NFS 与 vSphere 结合使用时，建议采用以下最佳实践：</block>
  <block id="c05061b6d3055b83136fa96cb38f0f9a" category="list-text">为 ONTAP 集群中每个节点上的每个 SVM 使用一个逻辑接口（ LIF ）。不再需要以往为每个数据存储库建议的 LIF 。虽然直接访问(LIF和同一节点上的数据存储库)是最佳选择、但无需担心间接访问、因为对性能的影响通常很小(微秒)。</block>
  <block id="7b997b3be9c993d49799dd9d71d8c3f6" category="list-text">自 VMware Infrastructure 3 以来， VMware 一直支持 NFSv3 。vSphere 6.0 增加了对 NFSv4.1 的支持，该支持可实现 Kerberos 安全性等一些高级功能。如果 NFSv3 使用客户端锁定，则 NFSv4.1 使用服务器端锁定。虽然 ONTAP 卷可以通过这两种协议导出，但 ESXi 只能通过一种协议挂载。此单协议挂载并不会阻止其他 ESXi 主机通过不同版本挂载同一数据存储库。请务必指定挂载时要使用的协议版本，以便所有主机都使用相同的版本，从而使用相同的锁定模式。请勿在主机之间混用 NFS 版本。如果可能，请使用主机配置文件检查合规性。</block>
  <block id="ae4c5baa79e370d8f601cc7082f8123e" category="list-text">由于 NFSv3 和 NFSv4.1 之间不会自动转换数据存储库，因此请创建一个新的 NFSv4.1 数据存储库，并使用 Storage vMotion 将 VM 迁移到新数据存储库。</block>
  <block id="8065bff4940ae8d7161f926b0df47ac4" category="inline-link">NetApp 互操作性表工具</block>
  <block id="1479ddf58c038ab7d220ff734c74deaf" category="list-text">请参见中的 NFS v4.1 互操作性表注释<block ref="8813559f5b95abb5411182be29200aff" category="inline-link-rx"></block> 支持所需的特定 ESXi 修补程序级别。</block>
  <block id="24aaa4a688e881fa13d31656a85d40a9" category="list-text">NFS 导出策略用于控制 vSphere 主机的访问。您可以对多个卷（数据存储库）使用一个策略。对于 NFSv3 ， ESXi 使用 sys （ UNIX ）安全模式，并需要根挂载选项来执行 VM 。在 ONTAP 中，此选项称为超级用户，使用超级用户选项时，无需指定匿名用户 ID 。请注意、的导出策略规则具有不同的值<block ref="ea72d12ecaa06afdb0c8a3b15e485e95" prefix=" " category="inline-code"></block> 和<block ref="df809a941c1287d18c08bb5927b639dc" prefix=" " category="inline-code"></block> ONTAP 工具是否存在发生原因 SVM发现问题。下面是一个策略示例：</block>
  <block id="822366735aef72f1a9429ac86dda7338" category="list-text">访问协议： nfs3.</block>
  <block id="69abbd5c7cd9c1b3828b9aa5a894ff47" category="list-text">客户端匹配规范： 192.168.42.21</block>
  <block id="bd6cc42f9cd65cca72cbd56d2f4bf43d" category="list-text">RO 访问规则： sys</block>
  <block id="581c470a5099548fc9865a4bab8761f8" category="list-text">RW访问规则：sys</block>
  <block id="0bbc71e6a4ea49af70dd616d3807e524" category="list-text">匿名UID</block>
  <block id="59d5d8c898df18115bd4ced36c6bc0de" category="list-text">超级用户： sys</block>
  <block id="c184ce6b86d2e6fbf8681d61637c101b" category="list-text">如果使用适用于VMware VAAI的NetApp NFS插件、则此协议应设置为<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block> 创建或修改导出策略规则时。要使VAAI副本卸载正常工作、需要使用NFSv4协议、并将协议指定为<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block> 自动包括NFSv3和NFSv4版本。</block>
  <block id="6670a317619282ec228a9ef492af0a76" category="list-text">NFS 数据存储库卷是从 SVM 的根卷接合的；因此， ESXi 也必须有权访问根卷，才能导航和挂载数据存储库卷。根卷以及嵌套了数据存储库卷接合的任何其他卷的导出策略必须包含一条或多条适用于ESXi服务器的规则、以便为其授予只读访问权限。下面是根卷的示例策略、该策略也使用VAAI插件：</block>
  <block id="8c93fb3ff528165613797962f5a0ed9c" category="list-text">访问协议：NFS (包括nfs3和nfs4)</block>
  <block id="80e6a4f964e826c69c1c62bd5ea67590" category="list-text">RW访问规则：从不(根卷的最佳安全性)</block>
  <block id="f96625174b4a06d13267f9b0a5a96d59" category="list-text">超级用户：sys (使用VAAI的根卷也需要此功能)</block>
  <block id="4c571520a8128d1692fc709ffbfb2b1e" category="list-text">使用适用于 VMware vSphere 的 ONTAP 工具（最重要的最佳实践）：</block>
  <block id="b8d278c6184cb65727ca5ae729db92d7" category="list-text">使用适用于 VMware vSphere 的 ONTAP 工具配置数据存储库，因为它可以自动简化导出策略的管理。</block>
  <block id="23aa7b9aeed3fba2a1ec43e630313af7" category="list-text">使用此插件为VMware集群创建数据存储库时、请选择集群、而不是单个ESX服务器。选择此选项会将数据存储库自动挂载到集群中的所有主机。</block>
  <block id="e4e62770daaf9887c7868fbc8e248a4b" category="list-text">使用插件挂载功能将现有数据存储库应用于新服务器。</block>
  <block id="928562eb576ed6ae31cb1a149d3e751a" category="list-text">如果不对 VMware vSphere 使用 ONTAP 工具，请对所有服务器或需要额外访问控制的每个服务器集群使用一个导出策略。</block>
  <block id="7bccab0fa4c0864835c645c9fde7ebf6" category="list-text">虽然 ONTAP 提供了一个灵活的卷命名空间结构，可以使用接合在树中排列卷，但这种方法对于 vSphere 来说毫无价值。无论存储的命名空间层次结构如何，它都会在数据存储库的根目录下为每个 VM 创建一个目录。因此，最佳实践是，只需将 vSphere 卷的接合路径挂载到 SVM 的根卷，即适用于 VMware vSphere 的 ONTAP 工具如何配置数据存储库。如果没有嵌套的接合路径，也意味着任何卷都不依赖于根卷以外的任何卷，即使有意使某个卷脱机或销毁该卷，也不会影响指向其他卷的路径。</block>
  <block id="ea6fc1288f1d3b21238d29ff28cb867a" category="list-text">对于 NFS 数据存储库上的 NTFS 分区，块大小为 4k 是可以的。下图显示了从 vSphere 主机到 ONTAP NFS 数据存储库的连接。</block>
  <block id="16c864cb4f3b00c59e1124932e49f342" category="paragraph"><block ref="16c864cb4f3b00c59e1124932e49f342" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e54433644e830ed1503561b778e9ded4" category="paragraph">下表列出了 NFS 版本和支持的功能。</block>
  <block id="9fb9dac7513c7ef8452aade8a52ad40d" category="cell">vSphere 功能</block>
  <block id="5b12ee0369243579651edca43ff65c85" category="cell">NFSv3</block>
  <block id="de841868c2911da76b8ae2da9fa3166d" category="cell">NFSv4.1</block>
  <block id="64e3cc476958b05086721cd6070004cf" category="cell">VMotion 和 Storage vMotion</block>
  <block id="05807e454c19f244770adae059b3c330" category="cell">高可用性</block>
  <block id="45a75e44a713fdf94dbf1dbaa0749188" category="cell">容错</block>
  <block id="f1e3446c69e4d87279ff7863482f9dcb" category="cell">DRS</block>
  <block id="6ca09f98e8925b2cb78bbf24eccc0186" category="cell">主机配置文件</block>
  <block id="ec8420797e3b089812499cce4047ded8" category="cell">存储 DRS</block>
  <block id="7c19bf1cbe62a87a42857ef0b4fe22ae" category="cell">存储 I/O 控制</block>
  <block id="56d43ad1a280ada5e16fd2960ae44b32" category="cell">SRM</block>
  <block id="d595c8f30866b71ea121ced5cde66b1d" category="cell">虚拟卷</block>
  <block id="6ad5114acf73f68a85c72f11646920cb" category="cell">硬件加速（ VAAI ）</block>
  <block id="ad37ded9046268d8e5ea7cb253bb5dda" category="cell">Kerberos 身份验证</block>
  <block id="45701e6ef9bc09dca07f8f4abe661dc6" category="cell">是（在 vSphere 6.5 及更高版本中进行了增强，可支持 AES ， krb5i ）</block>
  <block id="76969a36155d2f41fc6cc3bd3faff244" category="cell">多路径支持</block>
  <block id="8a18e0a50dc5755c294477cb16507a6c" category="doc">FlexGroup</block>
  <block id="f9ac230f370c7937167d25093c4ce9b9" category="paragraph">FlexGroup 简化了大型数据存储库的创建，并自动创建了大量成分卷，以便从 ONTAP 系统中获得最大性能。将 FlexGroup 与 vSphere 结合使用，可用于一个具有完整 ONTAP 集群功能的可扩展 vSphere 数据存储库。</block>
  <block id="6829bc8d3038be0130fd2b409ad5e560" category="paragraph">除了对 vSphere 工作负载进行大量系统测试之外， ONTAP 9.8 还为 FlexGroup 数据存储库添加了一种新的副本卸载机制。这样可以使用经过改进的复制引擎在后台的成分卷之间复制文件，同时允许在源和目标上进行访问。如果需要，多个副本会根据规模在成分卷中使用可立即使用且节省空间的文件克隆。</block>
  <block id="760383437e8e5cbe4a2560753da783fb" category="paragraph">ONTAP 9.8 还为 FlexGroup 文件添加了基于文件的新性能指标（ IOPS ，吞吐量和延迟），这些指标可在适用于 VMware vSphere 的 ONTAP 工具信息板和 VM 报告中查看。适用于 VMware vSphere 的 ONTAP 工具插件还允许您结合使用最大和 / 或最小 IOPS 来设置服务质量（ QoS ）规则。可以在数据存储库中的所有 VM 之间设置这些值，也可以为特定 VM 单独设置这些值。</block>
  <block id="50783a97403d748762dff691da2d3723" category="paragraph">以下是 NetApp 开发的其他一些最佳实践：</block>
  <block id="d190c5fcdf8146c1dd7aad1140be4e64" category="list-text">使用 FlexGroup 配置默认值。虽然建议使用适用于 VMware vSphere 的 ONTAP 工具，因为它可以在 vSphere 中创建和挂载 FlexGroup ，但也可以使用 ONTAP System Manager 或命令行来满足特殊需求。即使如此，也可以使用默认值，例如每个节点的成分卷成员数，因为这是已通过 vSphere 测试的结果。</block>
  <block id="9f3fa65c2cc36eabd2228b984c30c5e1" category="list-text">在估算 FlexGroup 数据存储库的规模时，请记住， FlexGroup 由多个较小的 FlexVol 卷组成，这些卷会创建一个较大的命名空间。因此，请将数据存储库的大小至少设置为最大虚拟机的 8 倍。例如，如果您的环境中有一个 6 TB 的 VM ，请将 FlexGroup 数据存储库的大小调整为不小于 48 TB 。</block>
  <block id="5fbee6b763967c822bb1e4a31665b11d" category="list-text">允许 FlexGroup 管理数据存储库空间。已使用 vSphere 数据存储库测试自动调整大小和弹性调整。如果数据存储库容量接近全满，请使用适用于 VMware vSphere 的 ONTAP 工具或其他工具调整 FlexGroup 卷的大小。FlexGroup 可在成分卷之间保持容量和索引节点的平衡，并在容量允许的情况下优先将文件夹（ VM ）中的文件分配给同一成分卷。</block>
  <block id="b48b55db402c8085e1d333cad214232b" category="list-text">VMware 和 NetApp 目前不支持通用的多路径网络连接方法。对于 NFSv4.1 ， NetApp 支持 pNFS ，而 VMware 支持会话中继。NFSv3 不支持通过多个物理路径访问一个卷。对于采用 ONTAP 9.8 的 FlexGroup ，我们建议的最佳实践是让适用于 VMware vSphere 的 ONTAP 工具进行一次挂载，因为间接访问的影响通常很小（微秒）。可以使用循环DNS在FlexGroup中不同节点上的不同FlexGroup之间分布ESXi主机、但这需要在不使用适用于VMware vSphere的ONTAP工具的情况下创建和挂载ESXi主机。然后，性能管理功能将不可用。</block>
  <block id="f5f11bb6aa98d02453eca36d5d1d2e19" category="list-text">在 9.8 版中，最多已对 1500 个 VM 的 FlexGroup vSphere 数据存储库支持进行了测试。</block>
  <block id="f48591b3ae898f29a551a2995a7dcfe8" category="list-text">使用适用于 VMware VAAI 的 NFS 插件执行副本卸载。请注意，在 FlexGroup 数据存储库中增强了克隆功能，但在 FlexVol 和 / 或 FlexGroup 卷之间复制虚拟机时，与 ESXi 主机副本相比， ONTAP 不会提供显著的性能优势。</block>
  <block id="57a0d1deb8da99d321814990d26d21ed" category="list-text">使用适用于 VMware vSphere 9.8 的 ONTAP 工具使用 ONTAP 指标（信息板和 VM 报告）监控 FlexGroup VM 的性能，并管理各个 VM 上的 QoS 。目前无法通过 ONTAP 命令或 API 获得这些指标。</block>
  <block id="ad971da24ec0a38449ebf31e4e2c9332" category="list-text">此时，可以在数据存储库中的各个 VM 或所有 VM 上设置 QoS （最大 / 最小 IOPS ）。在所有 VM 上设置 QoS 将取代任何单独的每 VM 设置。将来，设置不会扩展到新的或迁移的虚拟机；可以在新虚拟机上设置 QoS ，也可以将 QoS 重新应用于数据存储库中的所有虚拟机。</block>
  <block id="3c9d41390700cbdfb2c273f00df0d6fd" category="list-text">适用于 VMware vSphere 的 SnapCenter 插件 4.4 版支持在主存储系统上的 FlexGroup 数据存储库中备份和恢复 VM 。虽然可以手动使用 SnapMirror 将 FlexGroup 复制到二级系统，但 4 号选择控制器不管理二级副本。</block>
  <block id="be0ec3d9251292dd856ea0924ecc6873" category="doc">服务质量（ QoS ）</block>
  <block id="8fdd6138f63aa45f1c51b48d9a01b19d" category="paragraph">吞吐量限制对于在部署之前控制未知或测试工作负载非常有用、可确保它们不会影响其他工作负载。它们还可用于在确定抢占资源的工作负载后对其进行限制。此外，还支持基于 IOPS 的最低服务级别，以便为 ONTAP 9.2 中的 SAN 对象和 ONTAP 9.3 中的 NAS 对象提供稳定一致的性能。</block>
  <block id="3e4a2dc31acddb628ba286d25b1bd36e" category="paragraph">对于 NFS 数据存储库，可以将 QoS 策略应用于整个 FlexVol 卷或其中的单个 VMDK 文件。对于使用 ONTAP LUN 的 VMFS 数据存储库，可以将 QoS 策略应用于包含 LUN 或单个 LUN 的 FlexVol 卷，但不能应用于单个 VMDK 文件，因为 ONTAP 无法识别 VMFS 文件系统。使用 VVOL 时，可以使用存储功能配置文件和 VM 存储策略在各个 VM 上设置最小和 / 或最大 QoS 。</block>
  <block id="534ecd446aac2f9c809eef9064f44aab" category="paragraph">可以使用 MBps 和 / 或 IOPS 设置对象的 QoS 最大吞吐量限制。如果同时使用这两者，则 ONTAP 会强制实施达到的第一个限制。一个工作负载可以包含多个对象，一个 QoS 策略可以应用于一个或多个工作负载。将一个策略应用于多个工作负载时，这些工作负载将共享此策略的总限制。不支持嵌套对象（例如，卷中的文件不能各自具有自己的策略）。QoS 最小值只能以 IOPS 为单位进行设置。</block>
  <block id="040f184b126879657b253b6d258661d9" category="paragraph">目前，以下工具可用于管理 ONTAP QoS 策略并将其应用于对象：</block>
  <block id="de134183bea5df515a6756a539ce6f18" category="list-text">ONTAP 命令行界面</block>
  <block id="6ad5e0a20f49ad6a370454bb3afc9a9e" category="list-text">ONTAP 系统管理器</block>
  <block id="8e23e05fc0865e950d6a3581e0dd8ce9" category="list-text">OnCommand Workflow Automation</block>
  <block id="5ecb6b24c169667ff1a176768115659e" category="list-text">Active IQ Unified Manager</block>
  <block id="8cc4e713850f67a131e9dbf8b997f61e" category="list-text">适用于 ONTAP 的 NetApp PowerShell 工具包</block>
  <block id="fcdb48d0d22627e4910a8352c80bd87a" category="list-text">适用于 VMware vSphere VASA Provider 的 ONTAP 工具</block>
  <block id="e6defd03e0f49585b6d47614713e97f7" category="paragraph">要将 QoS 策略分配给 NFS 上的 VMDK ，请注意以下准则：</block>
  <block id="10509998e8d4c4d7be30fc1d0b6b2a1e" category="list-text">必须将此策略应用于<block ref="a1bb63c284b58c32f1afb554a12e3e9a" prefix=" " category="inline-code"></block> 包含实际虚拟磁盘映像、而不是<block ref="aa26c73336ecfd98ed727b3e249c7f90" prefix=" " category="inline-code"></block> (虚拟磁盘描述符文件)或<block ref="092eb4dd2ca488962f4c22b3e8cc4ca0" prefix=" " category="inline-code"></block> (VM描述符文件)。</block>
  <block id="2175e0e29bc4b213fa8b9c7afd591b6b" category="list-text">不要将策略应用于其他虚拟机文件、例如虚拟交换文件 <block ref="aa33c3c1850a3f99cec7426e2c411d08" prefix="(" category="inline-code"></block>）。</block>
  <block id="8230e9b5c1e9862fedb2c69f7cc5d3d1" category="list-text">在使用vSphere Web Client查找文件路径("数据存储库"&gt;"文件")时、请注意、它会合并的信息<block ref="f149d7424e10a266ec998ca5b32b81bb" prefix=" " category="inline-code"></block> 和<block ref="4a78be158c13cd6b2dc2100a80bb7070" prefix=" " category="inline-code"></block> 只需显示一个名为的文件<block ref="4a78be158c13cd6b2dc2100a80bb7070" prefix=" " category="inline-code"></block> 但的大小<block ref="f149d7424e10a266ec998ca5b32b81bb" prefix=" " category="inline-code"></block>。添加<block ref="4fc4e556dbb9dcede037ccd80fabd784" prefix=" " category="inline-code"></block> 以获取正确的路径。</block>
  <block id="1d4614aca13104c98d5d8cc2d415b941" category="paragraph">要为 LUN （包括 VMFS 和 RDM ）分配 QoS 策略，可以从适用于 VMware vSphere 的 ONTAP 工具主页上的存储系统菜单获取 ONTAP SVM （显示为 Vserver ）， LUN 路径和序列号。选择存储系统(SVM)、然后选择相关对象&gt; SAN。  使用 ONTAP 工具之一指定 QoS 时，请使用此方法。</block>
  <block id="cc97a1a52adc0bd6f188de1545eea887" category="paragraph">使用适用于 VMware vSphere 的 ONTAP 工具或 Virtual Storage Console 7.1 及更高版本，可以轻松地为基于 VVOL 的虚拟机分配最大和最小 QoS 。在为VVOV容器创建存储功能配置文件时、请在性能功能下指定一个最大和/或最小IOPS值、然后使用虚拟机的存储策略引用此SCP。在创建虚拟机时使用此策略或将此策略应用于现有虚拟机。</block>
  <block id="421c9efa4ff1b039a5378be7bc1e2e49" category="paragraph">在使用适用于 VMware vSphere 9.8 及更高版本的 ONTAP 工具时， FlexGroup 数据存储库可提供增强的 QoS 功能。您可以轻松地在数据存储库中的所有 VM 或特定 VM 上设置 QoS 。有关详细信息，请参见本报告的 FlexGroup 一节。</block>
  <block id="77bb2ba950959bd3f1c55da523ace0be" category="section-title">ONTAP QoS 和 VMware SIOC</block>
  <block id="b2e21dac6070ea83831ff6521a66a447" category="paragraph">ONTAP QoS 和 VMware vSphere 存储 I/O 控制（ SIOC ）是 vSphere 和存储管理员可以结合使用的补充技术，用于管理运行 ONTAP 软件的系统上托管的 vSphere VM 的性能。每个工具都有自己的优势，如下表所示。由于 VMware vCenter 和 ONTAP 的作用域不同，因此某些对象可以由一个系统查看和管理，而不能由另一个系统查看和管理。</block>
  <block id="5ad234cb2cde4266195252a23ca7d84e" category="cell">属性</block>
  <block id="b8b8d1ba8fa345f03438a90f29af5784" category="cell">ONTAP QoS</block>
  <block id="c2a4cb962db2a4a6782b69864f0e411c" category="cell">VMware SIIOC</block>
  <block id="aa628d5a66888444926b4dc042458200" category="cell">处于活动状态时</block>
  <block id="688b10fcfff927dee65634e3b3636064" category="cell">策略始终处于活动状态</block>
  <block id="a981c4aa67c29ff2d36fc614d8b28808" category="cell">存在争用时处于活动状态（数据存储库延迟超过阈值）</block>
  <block id="f46e64a82c96db56f3d6657d4fb53f00" category="cell">单位类型</block>
  <block id="878b4223bb85b95d8caf0429d9406cd5" category="cell">IOPS ， MBps</block>
  <block id="3e189a34f422a141311dad231f9ad5b5" category="cell">IOPS ，共享</block>
  <block id="7367a0ec46339213625cbc77d56a9572" category="cell">vCenter 或应用程序范围</block>
  <block id="1faff19290bb64ce8ff6bc1220496881" category="cell">多个 vCenter 环境，其他虚拟机管理程序和应用程序</block>
  <block id="1e664a3cc0ab109fcabcc81b488cebb1" category="cell">单个 vCenter 服务器</block>
  <block id="ebccc9f5c939841d86e5382988dfcc47" category="cell">是否在虚拟机上设置 QoS ？</block>
  <block id="cddd0980ce99890d2ea90288f6b03117" category="cell">仅限 NFS 上的 VMDK</block>
  <block id="928629d8a2a889f5274cad9940a06da0" category="cell">NFS 或 VMFS 上的 VMDK</block>
  <block id="305e85b992089534091855224f60cf75" category="cell">是否为 LUN 设置 QoS （ RDM ）？</block>
  <block id="e798014243cf5682e7fb3aaf4ee7cecf" category="cell">是否为 LUN （ VMFS ）设置 QoS ？</block>
  <block id="9cd021ea9d3c88de723fe9a2e50a2380" category="cell">是否为卷（ NFS 数据存储库）设置 QoS ？</block>
  <block id="c352b53c32380efcf4436926da6d0414" category="cell">是否在 SVM （租户）上设置 QoS ？</block>
  <block id="5dad340ee8f9e8fa9b65bf86a9fd5341" category="cell">基于策略的方法？</block>
  <block id="b31c76176f26196c6379a9bcce212d99" category="cell">是；可以由策略中的所有工作负载共享，也可以将其全部应用于策略中的每个工作负载。</block>
  <block id="1ff33557bad923d68973872cacf2e43a" category="cell">是，在 vSphere 6.5 及更高版本中。</block>
  <block id="d5f1465492190ee9d30a09b36f64f4b7" category="cell">需要许可证</block>
  <block id="4cec76d82991abd453484c23f7e3788a" category="cell">随 ONTAP 提供</block>
  <block id="6bb36803f4670824ff9ebdf665654829" category="cell">Enterprise Plus</block>
  <block id="d4d4b5b65bebf236590d70c702a6ba6b" category="paragraph">VMware Storage Distributed Resource Scheduler （ SDRS ）是一项 vSphere 功能，可根据当前 I/O 延迟和空间使用情况将 VM 放置在存储上。然后，它会在数据存储库集群（也称为 Pod ）中的数据存储库之间无中断地移动虚拟机或 VMDK ，从而选择最佳数据存储库，以便将虚拟机或 VMDK 放置在数据存储库集群中。数据存储库集群是一组相似的数据存储库、从vSphere管理员的角度来看、这些数据存储库会聚合到一个使用单元中。</block>
  <block id="01e838e1c124042f75adb374a81f72a6" category="paragraph">通过 VMware vSphere 存储感知 API （ VASA ），存储管理员可以轻松地为数据存储库配置定义明确的功能，并允许 VM 管理员在需要时使用这些功能来配置 VM ，而无需彼此交互。值得一看的是、这种方法可以帮助您简化虚拟化存储操作、避免大量琐碎的工作。</block>
  <block id="0ce8b0e3e0d7dc7f39c62fb74a28b3bf" category="section-title">云迁移和备份</block>
  <block id="4fe11b4a91ff38ec9933009a15dd5b0b" category="paragraph">ONTAP 的另一个优势是广泛支持混合云，将内部私有云中的系统与公有云功能相结合。以下是可与 vSphere 结合使用的一些 NetApp 云解决方案：</block>
  <block id="e18ab5f123ad4ce169202479f07f3f0f" category="list-text">*云卷。*适用于Amazon Web Services或Google云平台的NetApp Cloud Volumes Service和适用于ANF的Azure NetApp Files可在领先的公共云环境中提供高性能、多协议托管存储服务。它们可以直接由 VMware Cloud VM 子系统使用。</block>
  <block id="9625e7e8b7b951b4ac75beee0139b407" category="list-text">* Cloud Volumes ONTAP 。 * NetApp Cloud Volumes ONTAP 数据管理软件可在您选择的云中控制，保护，灵活性和效率您的数据。Cloud Volumes ONTAP 是基于 NetApp ONTAP 存储软件构建的云原生数据管理软件。与 Cloud Manager 结合使用，可与内部 ONTAP 系统一起部署和管理 Cloud Volumes ONTAP 实例。利用高级NAS和iSCSI SAN功能以及统一数据管理、包括快照和SnapMirror复制。</block>
  <block id="2a11701c0c01affc0ce96eb0d0c16ed9" category="list-text">* 云服务。 * 使用 Cloud Backup Service 或 SnapMirror 云保护数据免受使用公有云存储的内部系统的影响。Cloud Sync 有助于在 NAS ，对象存储和 Cloud Volumes Service 存储之间迁移和保持数据同步。</block>
  <block id="99c6c4d349151c1f4a6694e424aef741" category="inline-link">为VM存储更多快照</block>
  <block id="01fa297dbdab5aceb83a45a98161efe0" category="list-text">* FabricPool 。 * FabricPool 可为 ONTAP 数据快速轻松地分层。冷块可以迁移到公有云或私有StorageGRID对象存储中的对象存储、并在再次访问ONTAP数据时自动重新调用。或者，使用对象层作为已由 SnapVault 管理的数据的第三级保护。这种方法可以让您做到<block ref="60d027dbb3c3f076cbb70c6b246eb433" category="inline-link-rx"></block> 在主和 / 或二级 ONTAP 存储系统上。</block>
  <block id="1a7072854c9dd945a98f4314b3f77408" category="list-text">* ONTAP Select 。 * 使用 NetApp 软件定义的存储将您的私有云扩展到 Internet 上的远程设施和办公室，您可以在这些设施和办公室使用 ONTAP Select 支持块和文件服务以及您在企业数据中心拥有的相同 vSphere 数据管理功能。</block>
  <block id="79aec220098057ef8c0e46281a45d6c2" category="paragraph">在设计基于 VM 的应用程序时，请考虑未来的云移动性。例如，与其将应用程序和数据文件放在一起，不如对数据使用单独的 LUN 或 NFS 导出。这样，您就可以将虚拟机和数据单独迁移到云服务。</block>
  <block id="af63597853dc0983258c8f86a12aae0b" category="section-title">vSphere 数据加密</block>
  <block id="63a07ab9352c9297cea3894d6cd41c3f" category="paragraph">如今，通过加密保护空闲数据的需求日益增长。虽然最初的关注点是金融和医疗保健信息、但人们越来越关注保护所有信息、无论是存储在文件、数据库中还是其他数据类型中。</block>
  <block id="f131c8f285a9ebc44140235877aecbe5" category="paragraph">运行 ONTAP 软件的系统可通过空闲加密轻松保护任何数据。NetApp 存储加密（ NetApp Storage Encryption ， NSE ）使用带有 ONTAP 的自加密磁盘驱动器来保护 SAN 和 NAS 数据。NetApp 还提供 NetApp 卷加密和 NetApp 聚合加密，这是一种基于软件的简单方法，用于对任何磁盘驱动器上的卷进行加密。这种软件加密不需要特殊的磁盘驱动器或外部密钥管理器、ONTAP客户可以免费使用。您可以在不中断客户端或应用程序的情况下升级并开始使用它，并且它们已通过 FIPS 140-2 1 级标准（包括板载密钥管理器）的验证。</block>
  <block id="937a352e0f824ff55e4cd50c8e3b051e" category="paragraph">可以通过多种方法保护在 VMware vSphere 上运行的虚拟化应用程序的数据。一种方法是在子操作系统级别使用虚拟机中的软件保护数据。vSphere 6.5 等较新的虚拟机管理程序现在支持在 VM 级别进行加密，这是另一种替代方案。但是， NetApp 软件加密简单易用，并且具有以下优势：</block>
  <block id="6eda79cc710edc32583cf567b00e7672" category="list-text">* 对虚拟服务器 CPU 没有影响。 * 某些虚拟服务器环境需要为其应用程序提供每个可用的 CPU 周期，但测试表明，使用虚拟机管理程序级别的加密最多需要 5 倍的 CPU 资源。即使加密软件支持英特尔的AES-NI指令集来卸载加密工作负载(就像NetApp软件加密一样)、但由于需要新CPU来与旧服务器不兼容、因此这种方法可能不可行。</block>
  <block id="6abee98aea26f85e6f0fe8d4db70f998" category="list-text">* 包括板载密钥管理器。 * NetApp 软件加密包括板载密钥管理器，无需额外付费，无需购买和使用复杂的高可用性密钥管理服务器即可轻松启动。</block>
  <block id="c216121021de8554d33503ef6616b256" category="list-text">* 对存储效率没有影响。 * 重复数据删除和数据压缩等存储效率技术目前已广泛应用，是经济高效地使用闪存磁盘介质的关键。但是，加密数据通常无法进行重复数据删除或压缩。与其他方法不同， NetApp 硬件和存储加密的运行级别较低，并允许充分利用行业领先的 NetApp 存储效率功能。</block>
  <block id="5f9aa8333f218d1c21e67c8608a48672" category="list-text">* 轻松的数据存储库粒度加密。 * 借助 NetApp 卷加密，每个卷都获得自己的 AES 256 位密钥。如果需要更改，只需使用一个命令即可。如果您有多个租户或需要为不同部门或应用程序证明独立加密，则此方法非常适合。此加密在数据存储库级别进行管理，比管理单个虚拟机要简单得多。</block>
  <block id="de2b3baa1cd4980c36e8bbf7c827ae0c" category="paragraph">软件加密入门非常简单。安装许可证后，只需通过指定密码短语来配置板载密钥管理器，然后创建新卷或移动存储端卷以启用加密即可。NetApp 正在努力在其未来版本的 VMware 工具中增加对加密功能的集成支持。</block>
  <block id="c95fa5b56a01e5c1a80c540c1ab1a750" category="paragraph">通过 Active IQ Unified Manager 可以查看虚拟基础架构中的虚拟机，并监控虚拟环境中的存储和性能问题并对其进行故障排除。</block>
  <block id="be75250c2f30870dc1e359b4ade2a767" category="paragraph">ONTAP 上的典型虚拟基础架构部署包含多个组件，这些组件分布在计算层，网络层和存储层上。VM 应用程序中的任何性能滞后都可能是由于各个层的各个组件同时面临的延迟造成的。</block>
  <block id="d1734f6f2e65a1488896f74695db5254" category="paragraph">以下屏幕截图显示了 Active IQ Unified Manager 虚拟机视图。</block>
  <block id="8aa017c9f67ad32dd7301ecf52b61d72" category="paragraph"><block ref="8aa017c9f67ad32dd7301ecf52b61d72" category="inline-image-macro-rx" type="image"></block></block>
  <block id="2118336fa447fcc0f213cb8c40c516af" category="paragraph">Unified Manager 以拓扑视图形式呈现虚拟环境的底层子系统，用于确定计算节点，网络或存储是否发生延迟问题描述。此视图还会突出显示导致执行补救步骤和解决底层问题描述时出现性能滞后的特定对象。</block>
  <block id="d8a78b994fcd4e04901203a2e7bc6414" category="paragraph">以下屏幕截图显示了 AIQUM 扩展拓扑。</block>
  <block id="e9659be2b7d3d69eccdb443ed2acec75" category="paragraph"><block ref="e9659be2b7d3d69eccdb443ed2acec75" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f02207fb26160d7e47cf5ea35d07df03" category="doc">数据存储库和协议</block>
  <block id="af8dcb8c7a1e8b7e614e570806d8dcee" category="paragraph">在运行ONTAP 软件的系统上、可以使用七种协议将VMware vSphere连接到数据存储库：</block>
  <block id="a7c815fafe60ae637d38216fa6300395" category="list-text">FCP</block>
  <block id="14eae6ee278098bfad4f8a10fd6c1195" category="list-text">FCoE</block>
  <block id="26bcb9f1cb6f391f4b2c18e676bb458d" category="list-text">NVMe/FC</block>
  <block id="8b7c42123642e2e4ea7dd426aeb2de58" category="list-text">NVMe/TCP</block>
  <block id="e4e1c13bb0b14f6cb7608cbecea948ef" category="list-text">iSCSI</block>
  <block id="f7d773fd2896401c143676940bc001fc" category="list-text">NFS v3</block>
  <block id="0b99b245267ef194ca3b9f6e694b0983" category="list-text">NFS v4.1</block>
  <block id="cfa070ed8af17c3125cfd1530fbd387a" category="paragraph">FCP、FCoE、NVMe/FC、NVMe/TCP和iSCSI是块协议、它们使用vSphere虚拟机文件系统(VMFS)将VM存储在ONTAP FlexVol 卷中包含的ONTAP LUN或NVMe命名空间中。请注意，从 vSphere 7.0 开始， VMware 不再支持在生产环境中使用软件 FCoE 。NFS 是一种文件协议，无需使用 VMFS 即可将虚拟机放置到数据存储库（即 ONTAP 卷）中。SMB (CIFS)、iSCSI、NVMe/TCP或NFS也可以从子操作系统直接使用到ONTAP。</block>
  <block id="2b19cb432f68f1ba3dc7b0f175a14778" category="inline-link">VMware配置最大值</block>
  <block id="f8ca1b19553d4c965e40e9eeb1eb5aca" category="paragraph">下表介绍了ONTAP支持vSphere的传统数据存储库功能。此信息不适用于VVOL数据存储库、但它通常适用于使用受支持的ONTAP 版本的适用场景 vSphere 6.x及更高版本。您也可以参考<block ref="61b579b455015dfa2bbf16bf62f07f93" category="inline-link-rx"></block> 用于确认特定限制的特定 vSphere 版本。</block>
  <block id="9da73946f1bc3be4a41898d06c9d2e8b" category="cell">功能 / 功能</block>
  <block id="c982f804d02e2d7e937f125d2cac1024" category="cell">FC/FCoE</block>
  <block id="6151632541dcd80356c6c76b34d69d0c" category="cell">NVMe-oF</block>
  <block id="520d0db389f362bf79ef56ca0af3dcab" category="cell">格式。</block>
  <block id="99a3142584ca8ad0a3afadeaa6f2ef69" category="cell">VMFS 或原始设备映射（ RDM ）</block>
  <block id="26aae26f61844ac20ab7b04ba6f5c515" category="cell">VMFS 或 RDM</block>
  <block id="18263a30df8afc60a733e59c60676ac0" category="cell">VMFS</block>
  <block id="382b0f5185773fa0f67a8ed8056c7759" category="cell">不适用</block>
  <block id="8dc6d0c66219ddb809322c0d248e55e6" category="cell">数据存储库或 LUN 的最大数量</block>
  <block id="aa23f9914ce1939ea7a4d479edfdc915" category="cell">每个主机1024个LUN</block>
  <block id="1af3b27207afc48a363629a315d76b59" category="cell">每个服务器1024个LUN</block>
  <block id="0705fd627c25b5fba17cd9a022ed7d72" category="cell">每个服务器256个命名空间</block>
  <block id="2774ddb6f193789c5d9a480b9e53a38d" category="cell">256个挂载
默认NFS。最大卷数为 8 。使用适用于 VMware vSphere 的 ONTAP 工具将其增加到 256 。</block>
  <block id="51c0dc217976e27de06e262947947a62" category="cell">最大数据存储库大小</block>
  <block id="856c997f909830b8249756c07dc9452b" category="cell">64 TB</block>
  <block id="8e5d3a4b085389c59a1a7af7c4067a9b" category="cell">使用 FlexGroup 卷时为 100 TB 或更高的 FlexVol 卷</block>
  <block id="b4fb1d41fedaec79072964cbb4d16e3d" category="cell">最大数据存储库文件大小</block>
  <block id="d10549beb2f7bd1e91e5ef8965edd84a" category="cell">62 TB</block>
  <block id="18301e675ce7d51c23071d7b135edbdc" category="cell">使用ONTAP 9.12.1P2及更高版本时为62 TB</block>
  <block id="9aa56a79640231adaec83bc53e59c929" category="cell">每个 LUN 或文件系统的最佳队列深度</block>
  <block id="c7dfde106afbb4e1d55096403af252e0" category="cell">64－256</block>
  <block id="ca6e77250a239af7b4aed9a1ac058825" category="cell">已自动协商</block>
  <block id="bad19bc2587cd465cab5cec5a13aa306" category="cell">请参见中的NFS.MaxQueueDepth<block ref="0391a4aaf03ed2bf80fb4efb215797d0" category="inline-link-rx"></block>。</block>
  <block id="edc5121cb9b42a76b718b8ece9d67437" category="paragraph">下表列出了支持的 VMware 存储相关功能。</block>
  <block id="6c1a84b789b54fd42511ce582be94d21" category="cell">VMotion</block>
  <block id="e95b58d02782c970bb339c6cc587ff39" category="cell">存储 vMotion</block>
  <block id="0486e0e3dc3e86859f43b6d8e32b8071" category="cell">VMware HA</block>
  <block id="8be6bd7f20474cbefdd496cb9fd495ca" category="cell">存储分布式资源计划程序（ Storage Distributed Resource Scheduler ， SDRS ）</block>
  <block id="4244919a64848265426dfd82a14f8248" category="cell">支持 VMware vStorage APIs for Data Protection （ VADP ）的备份软件</block>
  <block id="28c2f8ab9cdbf296aa4261bc3c58ba0d" category="cell">虚拟机中的 Microsoft 集群服务（ MSCS ）或故障转移集群</block>
  <block id="01a9a3b8d0fcae3055dc91935e8ec6c6" category="cell">是 *</block>
  <block id="aa7f77e663b832d5b0e544c5511e680c" category="cell">不支持</block>
  <block id="aa18abedec09bd4f85e612c307e2eaa6" category="cell">容错</block>
  <block id="bfd52522de4ac6efd6f680e0e754eeb5" category="cell">Site Recovery Manager</block>
  <block id="d6407966cf588d8d78d4f7e65f1ea6fd" category="cell">仅v3</block>
  <block id="17d495427086fa21259b9df40b27e00a" category="cell">精简配置的 VM （虚拟磁盘）</block>
  <block id="4ee7af004efef335d6a14c60ee758f5e" category="cell">是的。
如果不使用VAAI、则此设置是NFS上所有VM的默认设置。</block>
  <block id="13bc264ff420559de4156ec40980a4b9" category="cell">VMware 原生多路径</block>
  <block id="50ed43e1a7a22335069a344bc706b600" category="cell">是、使用新的高性能插件(HPP)</block>
  <block id="a06819d91a165d0491c5816c54b41234" category="paragraph">下表列出了支持的 ONTAP 存储管理功能。</block>
  <block id="f8d61013f1a3bbf1342f4ced3279c7cf" category="cell">重复数据删除</block>
  <block id="72167540968147afed9deb59f0e9fe00" category="cell">阵列中的节省量</block>
  <block id="9a5473a6abaea16b736f096913a749be" category="cell">数据存储库中的节省量</block>
  <block id="6cd880eabbec3488232c6cba3fbcf998" category="cell">精简配置</block>
  <block id="5caeb11c4ed379b808d7f7cdca7cfbf0" category="cell">数据存储库或 RDM</block>
  <block id="8a5227cc82d14862956938caffc1acf2" category="cell">数据存储库</block>
  <block id="b71ba22dcd42deceac87150206f7bd12" category="cell">调整数据存储库大小</block>
  <block id="c6b792bfd7aac8067d36337e67d11545" category="cell">仅增长</block>
  <block id="29e23534878bb63341e0b689426b7fb0" category="cell">增长，自动增长和缩减</block>
  <block id="76021405cc62a4b8c542e7f65e3d24ed" category="cell">适用于 Windows 和 Linux 应用程序的 SnapCenter 插件（在子系统中）</block>
  <block id="c0b3c629432c82a9e8500242abb35eaf" category="cell">使用适用于 VMware vSphere 的 ONTAP 工具监控和主机配置</block>
  <block id="5a915a8215e9a66bcff0f034e8adff18" category="cell">使用适用于 VMware vSphere 的 ONTAP 工具进行配置</block>
  <block id="6495c7cda42bf1b80bc1c2af6166ef58" category="paragraph">下表列出了支持的备份功能。</block>
  <block id="ad336d1fccea3e918d07055edac855a3" category="cell">ONTAP快照</block>
  <block id="bf22a1b5bc2b72a75825094826a942de" category="cell">复制的备份支持 SRM</block>
  <block id="60d3f7d9f265eb34e826da352cb545be" category="cell">卷 SnapMirror</block>
  <block id="fabf31a57c142c986c5d88cb089b3d7b" category="cell">VMDK 映像访问</block>
  <block id="40b655e79545b3922b8095be28d59428" category="cell">支持 VADP 的备份软件</block>
  <block id="8215e73d220182794dfbd75ad494c727" category="cell">启用了 VADP 的备份软件， vSphere Client 和 vSphere Web Client 数据存储库浏览器</block>
  <block id="d7605580ecad0fcb4528789d74cdcad5" category="cell">vmdk 文件级访问</block>
  <block id="906ece32da286d6c4b323bc0d6443b7c" category="cell">启用了 VADP 的备份软件，仅限 Windows</block>
  <block id="d17e2fa63a62622f88bf170612132383" category="cell">支持 VADP 的备份软件和第三方应用程序</block>
  <block id="4e3d259d82a536e12c5c9c948b62e26a" category="cell">NDMP 粒度</block>
  <block id="90d45e02e50c81603c36a4e4ad3649d9" category="cell">数据存储库或虚拟机</block>
  <block id="8339c514e73f5cced3b83d504d60441b" category="inline-link">Windows Server 故障转移集群设置</block>
  <block id="45f7e6f7f6f0f4093754d7d48810e17f" category="paragraph">* NetApp建议对Microsoft集群使用来宾iSCSI、而不是在VMFS数据存储库中使用启用了多写入程序的VMDK。Microsoft 和 VMware 完全支持这种方法，并可通过 ONTAP （ SnapMirror 到内部或云中的 ONTAP 系统）提供极大的灵活性，易于配置和自动化，并可通过 SnapCenter 进行保护。vSphere 7 添加了一个新的集群模式 VMDK 选项。这与启用了多写入程序的VMDK不同、它需要一个通过FC协议提供的数据存储库、该协议已启用集群模式VMDK支持。其他限制适用。请参见VMware<block ref="b158594c147457b5b6417413cb30f800" category="inline-link-rx"></block> 配置准则文档。</block>
  <block id="e2bd40041a6472b580305ce9017b0b2e" category="paragraph">*使用NVMe-oF和NFS v4.1的数据存储库需要vSphere复制。SRM不支持基于阵列的复制。</block>
  <block id="54b3e11ce37eaaa9884f4086e72dd2be" category="section-title">选择存储协议</block>
  <block id="4bbd62e7748dbf2416c644698342b5f9" category="paragraph">运行 ONTAP 软件的系统支持所有主要存储协议，因此客户可以根据现有和计划的网络基础架构以及员工技能选择最适合其环境的存储协议。NetApp 测试通常表明，以相似的线路速度运行的协议之间差别不大，因此，与原始协议性能相比，最好重点关注您的网络基础架构和员工能力。</block>
  <block id="0212b4e8bc965dcd8a7ff771dd96bf21" category="paragraph">在考虑选择协议时，以下因素可能会很有用：</block>
  <block id="0425ddb6dbbe7f13280e19e1f925b0a8" category="list-text">* 当前的客户环境。 * 尽管 IT 团队通常擅长管理以太网 IP 基础架构，但并非所有团队都擅长管理 FC SAN 网络结构。但是、如果使用的是不针对存储流量设计的通用IP网络、则可能效果不会很好。请考虑您已有的网络基础架构，任何计划内的改进，以及管理这些改进的人员的技能和可用性。</block>
  <block id="774f1348caf3e145710073eb634c4fa1" category="list-text">* 易于设置。 * 除了 FC 网络结构的初始配置（额外的交换机以及 HBA 和固件的布线，分区以及互操作性验证）之外，块协议还需要创建和映射 LUN 以及通过子操作系统进行发现和格式化。创建并导出 NFS 卷后，它们将由 ESXi 主机挂载并准备好使用。NFS 没有特殊的硬件资格认定或固件可供管理。</block>
  <block id="bf5169ce5bb544313eaf17435f756da2" category="list-text">* 易于管理。 * 使用 SAN 协议时，如果需要更多空间，则需要执行几个步骤，包括增加 LUN ，重新扫描以发现新大小，然后增加文件系统大小。虽然可以增加 LUN 的大小，但不能减小 LUN 的大小，因此恢复未使用的空间可能需要额外的工作。NFS 可以轻松地进行大小调整，存储系统可以自动调整大小。SAN 可通过子操作系统剪切 /UNMAP 命令提供空间回收，从而允许将已删除文件中的空间返回到阵列。使用 NFS 数据存储库时，这种类型的空间回收会更加困难。</block>
  <block id="530c759326761c6ac026b313985b255f" category="list-text">* 存储空间透明度。 * 在 NFS 环境中，存储利用率通常更容易查看，因为精简配置可以立即实现节省。同样，重复数据删除和克隆节省的空间可立即用于同一数据存储库中的其他虚拟机或其他存储系统卷。NFS 数据存储库中的虚拟机密度通常也会更高，这样可以减少要管理的数据存储库数量，从而节省重复数据删除的空间，并降低管理成本。</block>
  <block id="16ee928b12bc598bf52b0f312879ec95" category="section-title">数据存储库布局</block>
  <block id="b8c499c7b537f5bd4e51b0a6d6a1e9d0" category="list-text">使用 ONTAP NFS 数据存储库部署 vSphere 可实现高性能，易于管理的实施，从而提供基于块的存储协议无法实现的虚拟机与数据存储库比率。此架构可将数据存储库密度提高十倍，并相应地减少数据存储库数量。虽然较大的数据存储库可以提高存储效率并提供运营优势，但请考虑至少使用四个数据存储库（ FlexVol 卷）将虚拟机存储在一个 ONTAP 控制器上，以便从硬件资源中获得最大性能。通过这种方法，您还可以使用不同的恢复策略建立数据存储库。根据业务需求、某些备份或复制的频率比其他备份或复制的频率要高。FlexGroup 卷不需要多个数据存储库来提高性能、因为它们可以根据设计进行扩展。</block>
  <block id="e15ed0ec7af4278259b7618024b3e7ce" category="list-text">NetApp建议对大多数NFS数据存储库使用FlexVol卷。从ONTAP 9.8开始、也支持将FlexGroup卷用作数据存储库、并且通常建议在某些使用情形下使用。通常不建议使用其他ONTAP存储容器、例如qtrees、因为适用于VMware vSphere的ONTAP工具或适用于VMware vSphere的NetApp SnapCenter插件目前均不支持这些存储容器。尽管如此、在一个卷中将数据存储库部署为多个qtrees可能会对高度自动化的环境非常有用、这些环境可以从数据存储库级别的配额或VM文件克隆中受益。</block>
  <block id="dc4d78be836807b32c7ef7f42028b1ef" category="list-text">对于 FlexVol 卷数据存储库，大小合适的数据存储库大约为 4 TB 到 8 TB 。这种大小可以很好地平衡性能，易管理性和数据保护。从小规模入手（例如 4 TB ），然后根据需要扩展数据存储库（最大 100 TB ）。较小的数据存储库可以更快地从备份中或发生灾难后进行恢复，并可在集群中快速移动。请考虑使用 ONTAP 自动调整大小功能在已用空间发生变化时自动增长和缩减卷。默认情况下，适用于 VMware vSphere 数据存储库配置向导的 ONTAP 工具会对新数据存储库使用自动调整大小。可以使用 System Manager 或命令行对增长和缩减阈值以及大小上限和下限进行其他自定义。</block>
  <block id="964a81e46088ae1cc6306072464a9d73" category="list-text">或者，也可以为 VMFS 数据存储库配置由 FC ， iSCSI 或 FCoE 访问的 LUN 。VMFS 允许集群中的每个 ESX 服务器同时访问传统 LUN 。VMFS 数据存储库的大小最多可达 64 TB ，并且最多可包含 32 个 2 TB LUN （ VMFS 3 ）或一个 64 TB LUN （ VMFS 5 ）。大多数系统上的ONTAP 最大LUN大小为16 TB、而全SAN阵列系统上的最大LUN大小为128 TB。因此，可以使用四个 16 TB LUN 在大多数 ONTAP 系统上创建最大大小的 VMFS 5 数据存储库。尽管具有多个LUN (使用高端FAS 或AFF 系统)的高I/O工作负载可获得性能优势、但创建、管理和保护数据存储库LUN的管理复杂性增加以及可用性风险增加、抵消了这一优势。NetApp 通常建议为每个数据存储库使用一个大型 LUN ，并且只有在特殊需要超过 16 TB 数据存储库时才会跨越。与 NFS 一样，请考虑使用多个数据存储库（卷），以便在一个 ONTAP 控制器上最大限度地提高性能。</block>
  <block id="c74cab014e402128efd8102b941c0b0c" category="list-text">较旧的子操作系统（ OS ）需要与存储系统对齐，以获得最佳性能和存储效率。但是， Microsoft 和 Linux 分销商（例如 Red Hat ）提供的现代供应商支持的操作系统不再需要进行调整，以便在虚拟环境中将文件系统分区与底层存储系统的块对齐。如果您使用的旧操作系统可能需要对齐，请使用 "VM 对齐 " 在 NetApp 支持知识库中搜索文章，或者向 NetApp 销售人员或合作伙伴联系人请求 TR-3747 的副本。</block>
  <block id="8c761039ef4dd69451490b849ace1f82" category="list-text">避免在子操作系统中使用碎片整理实用程序、因为这不会带来任何性能优势、并会影响存储效率和快照空间使用量。此外，还应考虑在子操作系统中关闭虚拟桌面的搜索索引。</block>
  <block id="14abb814748566a24367c4459a54840b" category="list-text">ONTAP 凭借创新的存储效率功能引领行业发展，帮助您充分利用可用磁盘空间。AFF 系统通过默认实时重复数据删除和数据压缩进一步提高了这种效率。数据会在聚合中的所有卷之间进行重复数据删除，因此您无需再将相似的操作系统和类似应用程序分组到一个数据存储库中，即可最大程度地节省空间。</block>
  <block id="446548f2b1301893641e29657fc7fe53" category="inline-link-macro">基于 ONTAP 的 Oracle 数据库</block>
  <block id="6cda576d2fd323c1a728b7ac67d6034f" category="list-text">一级磁盘（或经过改进的虚拟磁盘）支持独立于运行 vSphere 6.5 及更高版本的 VM 的 vCenter 管理磁盘。虽然它们主要由 API 管理，但对于 VVOL 很有用，尤其是在由 OpenStack 或 Kubernetes 工具管理时。ONTAP 以及适用于 VMware vSphere 的 ONTAP 工具均支持这些功能。</block>
  <block id="71318121439b39fdf872bb0bd57494f2" category="section-title">数据存储库和 VM 迁移</block>
  <block id="e8824ce2062c6d1fc536163f7b8940bd" category="paragraph">将 VM 从另一个存储系统上的现有数据存储库迁移到 ONTAP 时，请记住以下一些实践：</block>
  <block id="73b729fbc964c7d78dd90b64aaaeb785" category="list-text">使用 Storage vMotion 将虚拟机的批量移动到 ONTAP 。这种方法不仅不会对正在运行的 VM 造成中断，而且还可以通过实时重复数据删除和数据压缩等 ONTAP 存储效率功能在数据迁移时对其进行处理。请考虑使用 vCenter 功能从清单列表中选择多个 VM ，然后在适当的时间计划迁移（单击操作时使用 Ctrl 键）。</block>
  <block id="e512c890754c686d8deccac97d84a290" category="list-text">虽然您可以仔细规划迁移到适当的目标数据存储库，但批量迁移之后再根据需要进行组织往往会更简单。如果您有特定的数据保护需求(例如不同的Snapshot计划)、则可能需要使用此方法来指导您迁移到不同的数据存储库。</block>
  <block id="616b2180a0659911fed5aa758dba722c" category="list-text">大多数 VM 及其存储可以在运行时进行迁移（热迁移），但从另一个存储系统迁移连接的存储（不在数据存储库中），例如 ISO ， LUN 或 NFS 卷可能需要冷迁移。</block>
  <block id="fbb88da5639930a05f510729e473a216" category="inline-link">TR-4534</block>
  <block id="096f2185af16e07c387a7fbe50df957a" category="list-text">需要更仔细迁移的虚拟机包括使用连接存储的数据库和应用程序。一般情况下、请考虑使用应用程序的工具来管理迁移。对于 Oracle ，请考虑使用 RMAN 或 ASM 等 Oracle 工具迁移数据库文件。请参见<block ref="6b3f565e7a7ce633fa62f4114c295216" category="inline-link-rx"></block> 有关详细信息 ...同样，对于 SQL Server ，请考虑使用 SQL Server Management Studio 或 NetApp 工具，例如适用于 SQL Server 的 SnapManager 或 SnapCenter 。</block>
  <block id="09485b54473eee31422696bf0217d714" category="paragraph">将 vSphere 与运行 ONTAP 软件的系统结合使用时，最重要的最佳实践是安装和使用适用于 VMware vSphere 的 ONTAP 工具插件（以前称为虚拟存储控制台）。无论使用 SAN 还是 NAS ，此 vCenter 插件均可简化存储管理，提高可用性并降低存储成本和运营开销。它使用最佳实践来配置数据存储库，并针对多路径和 HBA 超时优化 ESXi 主机设置（这些内容在附录 B 中进行了介绍）。由于它是vCenter插件、因此可供连接到vCenter Server的所有vSphere Web Client使用。</block>
  <block id="9fb2cc2ced88ce872ef16c37d8284360" category="paragraph">此插件还可帮助您在 vSphere 环境中使用其他 ONTAP 工具。您可以通过此插件安装适用于VMware VAAI的NFS插件、以便将副本卸载到ONTAP以执行VM克隆操作、为厚虚拟磁盘文件预留空间以及卸载ONTAP快照。</block>
  <block id="9baea886f208a41896164d4ade5b3fde" category="paragraph">一般来说， NetApp 建议在 vCenter 中使用适用于 VMware vSphere 的 ONTAP 工具来配置传统数据存储库和 VVOL 数据存储库，以确保遵循最佳实践。</block>
  <block id="6161d374e9022f89382fd63b4be15aa1" category="section-title">常规网络连接</block>
  <block id="f0cd6847f2a7a0773ad0b58d0f9dc67d" category="paragraph">在将 vSphere 与运行 ONTAP 软件的系统结合使用时，配置网络设置非常简单，与其他网络配置类似。需要考虑以下几点：</block>
  <block id="c7949782ad094d3ffc126bee722642a3" category="list-text">使用支持在两个独立交换机机箱上对端口进行链路聚合的交换机、并采用多机箱链路聚合组方法、例如Cisco的虚拟端口通道(vPC)。</block>
  <block id="9dc1904e0c3ace141704b477cd9b345d" category="inline-link">网络管理</block>
  <block id="68ecdb0d7a96e68318a53d12e9fab5b5" category="list-text">使用LACP为具有端口或IP哈希动态多模式接口组的ONTAP存储系统创建链路聚合。请参见<block ref="b87480ad0ff34784c4be1445a72a3aaf" category="inline-link-rx"></block> 以获得进一步指导。</block>
  <block id="3b407fe7c9654197902b1dd26af6dc81" category="list-text">如果对vSphere分布式交换机使用静态链路聚合(例如EtherChannel)和标准vswitch或基于LACP的链路聚合、请在ESXi上使用IP哈希绑定策略。如果未使用链路聚合、请改用"基于源虚拟端口ID路由"。</block>
  <block id="ee1ef6cf0f3971b44eb2abcac958fb8d" category="section-title">FlexGroup 卷</block>
  <block id="bf985cdd1506d49ea0773c8997e0b723" category="paragraph">ONTAP 9.8增加了对vSphere中FlexGroup卷数据存储库的支持、并支持适用于VMware vSphere的ONTAP工具和适用于VMware vSphere的SnapCenter插件。FlexGroup 简化了大型数据存储库的创建，并自动创建了大量成分卷，以便从 ONTAP 系统中获得最大性能。如果您需要一个具有完整ONTAP集群功能的可扩展vSphere数据存储库、或者您的克隆工作负载非常庞大、可以从新的FlexGroup克隆机制中受益、请将FlexGroup与vSphere结合使用。</block>
  <block id="83bcea036e70c0f011b083b2325b7a4b" category="paragraph">除了对 vSphere 工作负载进行大量系统测试之外， ONTAP 9.8 还为 FlexGroup 数据存储库添加了一种新的副本卸载机制。此操作会使用经过更新的复制引擎、该引擎会使用前几个克隆在每个成分卷中填充本地缓存。然后、可以使用此本地缓存根据需要快速例化VM克隆。</block>
  <block id="dd9bd4a686bdeb1c7f11dc3cd0cda75f" category="paragraph">请考虑以下情形：</block>
  <block id="6b277580cb59b13790b36344e827e22f" category="list-text">您已创建一个包含8个成分卷的新FlexGroup</block>
  <block id="32efd8b10cc3b73c344f4c7e6c4b741e" category="list-text">新FlexGroup的缓存超时设置为160分钟</block>
  <block id="879f959734466d50681eae9b95e7e591" category="paragraph">在这种情况下、要完成的前8个克隆将是完整副本、而不是本地文件克隆。在160秒超时时间到期之前对该VM执行任何其他克隆操作都将使用每个成分卷中的文件克隆引擎以循环方式创建几乎即时的副本、这些副本均匀分布在各个成分卷上。</block>
  <block id="b368b4dbd46dd778776d405dc46d2033" category="paragraph">卷收到的每个新克隆作业都会重置超时。如果示例FlexGroup中的成分卷在超时之前未收到克隆请求、则会清除该特定虚拟机的缓存、并且需要重新填充该卷。此外、如果原始克隆的源发生更改(例如、您已更新模板)、则每个成分卷上的本地缓存都将失效、以防止发生任何冲突。此缓存可进行调整、并可根据您的环境需求进行设置。</block>
  <block id="0f98175ace2dd0d56e47961b22b2544b" category="paragraph">如果您无法充分利用FlexGroup缓存、但仍需要快速跨卷克隆、请考虑使用虚拟卷。与使用传统数据存储库相比、使用FlexVol进行跨卷克隆的速度要快得多、并且不依赖于缓存。</block>
  <block id="189aae773e13462525f07e99fcd9e90f" category="inline-link">VAAI：如何对FlexGroup卷使用缓存？</block>
  <block id="718103d957da7fb9e8210a49a85aedab" category="paragraph">有关将FlexGroup与VAAI结合使用的详细信息、请参阅此知识库文章：<block ref="23db52497ce446299e31ecc0b7572649" category="inline-link-rx"></block></block>
  <block id="eafcbe529f542610c50d02e4a2fffcd6" category="paragraph">ONTAP 9.8还为FlexGroup卷文件添加了新的基于文件的性能指标(IOPS、吞吐量和延迟)、您可以在适用于VMware vSphere的ONTAP工具信息板和VM报告中查看这些指标。适用于 VMware vSphere 的 ONTAP 工具插件还允许您结合使用最大和 / 或最小 IOPS 来设置服务质量（ QoS ）规则。可以在数据存储库中的所有 VM 之间设置这些值，也可以为特定 VM 单独设置这些值。</block>
  <block id="b8c631b88d7be5f1105be2f8c7ff3213" category="list-text">使用FlexGroup卷配置默认值。虽然建议使用适用于 VMware vSphere 的 ONTAP 工具，因为它可以在 vSphere 中创建和挂载 FlexGroup ，但也可以使用 ONTAP System Manager 或命令行来满足特殊需求。即使如此、也应使用默认值、例如每个节点的成分卷成员数、因为这是在vSphere中经过最全面测试的内容。尽管如此、仍然完全支持非默认设置、例如更改成分卷的数量或放置。</block>
  <block id="301593c45668093a7eb242d138c597a3" category="list-text">在估算基于FlexGroup的数据存储库的规模时、请记住、FlexGroup由多个较小的FlexVol卷组成、这些卷会创建一个较大的命名空间。因此、如果使用包含八个成分卷的FlexGroup、请确保数据存储库大小至少是最大虚拟机大小的八倍。例如，如果您的环境中有一个 6 TB 的 VM ，请将 FlexGroup 数据存储库的大小调整为不小于 48 TB 。</block>
  <block id="04cc9e0b9478cc704d42735886027630" category="list-text">使用适用于 VMware VAAI 的 NFS 插件执行副本卸载。请注意、如前文所述、虽然FlexGroup数据存储库中的克隆功能得到了增强、但在FlexVol和/或FlexGroup卷之间复制VM时、ONTAP与ESXi主机副本相比、不会提供显著的性能优势。因此、在决定使用VAai或FlexGroup时、请考虑克隆工作负载。修改成分卷的数量是针对基于FlexGroup的克隆进行优化的一种方法。调整缓存超时。</block>
  <block id="b9e0a0134c0815e50bb71d8dd7e367b6" category="list-text">此时，可以在数据存储库中的各个 VM 或所有 VM 上设置 QoS （最大 / 最小 IOPS ）。在所有 VM 上设置 QoS 将取代任何单独的每 VM 设置。将来，设置不会扩展到新的或迁移的虚拟机；可以在新虚拟机上设置 QoS ，也可以将 QoS 重新应用于数据存储库中的所有虚拟机。如果虚拟机迁移到另一个数据存储库、则FlexGroup QoS策略也不会随虚拟机而变化。这一点与此不同、在迁移到其他数据存储库时、可以保留其QoS策略设置。</block>
  <block id="1133ff8355478000111c8b1969e32770" category="list-text">适用于VMware vSphere的SnapCenter插件4.4及更高版本支持备份和恢复主存储系统上FlexGroup数据存储库中的VM。4．6号选择控制阀为基于FlexGroup的数据存储库增加了SnapMirror支持。</block>
  <block id="ce4df831657d2621e80bbef9271c33cd" category="summary">从传统虚拟设备过渡后， ONTAP 工具可提供大量新功能，更高的限制以及新的 VVOL 支持。</block>
  <block id="45b1565c472fff4046d0f7ddbe1342f2" category="doc">SRM 和 ONTAP 工具的新增功能</block>
  <block id="116d20fc387d73c8e4a86e7998913947" category="section-title">最新版本的 vSphere 和 Site Recovery Manager</block>
  <block id="57359b8d2b77ce83f2e854fdd323377f" category="paragraph">对于SRM 8.7及更高版本以及ONTAP工具9.12及更高版本、您现在可以保护在VMware vSphere 8 Update 1上运行的VM。</block>
  <block id="96ca6fcc2ffdab3c06d0875be8d4fe29" category="paragraph">近二十年来， NetApp 与 VMware 建立了深厚的合作关系，并努力尽快为最新版本提供支持。请始终查看 NetApp 互操作性表工具（ IMT ）以了解最新的合格软件组合。</block>
  <block id="4ada3eb5b908caaedb757052562dfcf5" category="inline-link-macro"><block ref="4ada3eb5b908caaedb757052562dfcf5" category="inline-link-rx"></block></block>
  <block id="0a0a2a299629bed81a283fcd3b7833e9" category="paragraph">NetApp IMT位于 <block ref="83e08b5e992bc41d59feec38bb24f26d" category="inline-link-macro-rx"></block>。</block>
  <block id="9d6e1631f68d52fd0f82222bf276cdc4" category="section-title">支持Virtual Storage Policy Based Management (SPBM)的原因(即使使用SRM也如此)</block>
  <block id="b0b7bc3c901f340c708b7560d1f2b7e1" category="paragraph">从8.3版开始、SRM现在支持对使用iSCSI、FCP和NFS v3的数据存储库使用vvol和基于阵列的复制进行基于存储策略的复制管理(Storage Policy Based Management、SPBM)。为此、对SRM服务器进行了更新、加入了一个新的SRM VVO尔 提供程序服务、该服务可与vCenter Server的SMS服务进行通信、以执行与VASA相关的任务。</block>
  <block id="4567f5576b4577c63b126cac3f6aa5fa" category="paragraph">此架构的一个优势是不再需要 SRA ，因为所有内容都使用 VASA 进行处理。</block>
  <block id="e04031e1cecdb6732f91d44b204dbcf3" category="paragraph">SPBM 是 vSphere 工具箱中的一款功能强大的工具，可提供简化，可预测且一致的存储服务，供私有云和混合云环境中的自动化框架使用。从根本上说， SPBM 允许您定义满足不同客户群需求的服务级别。现在，您可以通过 SRM 向客户展示复制功能，以处理需要强大的行业标准灾难恢复流程编排和自动化功能的关键工作负载。</block>
  <block id="1b6204fa76bd422416757c4e2d6187bd" category="paragraph">使用FCP或iSCSI的卷架构示例：</block>
  <block id="6f1ad7cac2af0e3b92a3936efc393a0e" category="paragraph"><block ref="6f1ad7cac2af0e3b92a3936efc393a0e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9abbd7aed7e9791d9c52e8e17f34a756" category="section-title">支持基于设备的SRM服务器</block>
  <block id="925c477f139cce0692e13946a7f75eac" category="paragraph">除了基于 Windows 的传统平台之外，现在还支持基于 Photon OS 的 SRM 服务器。</block>
  <block id="62c2c4203aebe081ddbc6cdd489f8ad7" category="paragraph">现在，无论首选 SRM 服务器类型如何，您都可以安装 SRA 适配器。</block>
  <block id="7cb1700928c008eb817bc79250cc9002" category="section-title">支持 IPv6</block>
  <block id="ea9aacd1495949730de8eeab11e66459" category="paragraph">现在支持 IPv6 ，但有以下限制：</block>
  <block id="d6d7f3d43de975c07655ebba1936867a" category="list-text">vCenter 6.7 或更高版本</block>
  <block id="eb26ee1a20fe3dbde98204ec8b3ab838" category="list-text">SRM 8.2 （ 8.1 ， 8.3 和 8 ）不支持。支持 4 个）</block>
  <block id="918d32b75f0ab883abba3a8dc0c3ae8d" category="inline-link">互操作性表工具</block>
  <block id="02e7e71042609d3158020ab7befe45c6" category="list-text">检查<block ref="218f4ad7153f69cdc5467065434cd2f0" category="inline-link-rx"></block> 适用于最新的合格版本。</block>
  <block id="e887aed8f9c3dbecd37e8896d96b6637" category="section-title">提高了性能</block>
  <block id="2a71574e89a69c8218fbac3f604b5728" category="paragraph">运行性能是执行 SRM 任务的关键要求。为了满足现代RTU和远程遥控器(RPO)的要求、SRA和ONTAP工具新增了三项改进功能。</block>
  <block id="bd403c539a0c414afacd7477bf3d311f" category="list-text">* 支持并发重新保护操作。 * SRA 9.1.1 首次推出此功能，通过启用此功能，您可以同时对两个或多个恢复计划运行重新保护，从而缩短故障转移或迁移后重新保护数据存储库所需的时间，并使其保持在 RTO 和 RPO 参数范围内。</block>
  <block id="f63b947f655a5aee2cf69d4f30d7f96b" category="list-text">ONTAP 工具 9.8 新增了一种仅限 NAS 的新优化模式。 * 如果使用 SVM 范围的帐户并连接到仅包含基于 NFS 的数据存储库的 ONTAP 集群，则可以在支持的环境中启用仅 NAS 优化模式以实现峰值性能。</block>
  <block id="c82379d922d9cdc55fa21affe9f9b8bf" category="list-text">* ONTAP工具9.12增加了对ONTAP SnapMirror快速重新同步功能的支持。*这样、可以快速重新同步镜像、而不必在处理后重新计算存储效率节省量。默认情况下不使用此功能、但可以在传统重新同步用时过长或超时的大规模环境中启用此功能。</block>
  <block id="4a4842d7448ef71eb69b013e560b18bb" category="section-title">扩展性更强</block>
  <block id="26738e8d40ae8035805f13bdbf185c30" category="paragraph">现在，在与 SRM 8.3 及更高版本结合使用时， ONTAP 工具 SRA 最多可支持 500 个保护组（ PG ）。</block>
  <block id="96cb4d41ca97bd9d3d446984d3170a57" category="paragraph">期待已久的一项新功能是采用 ONTAP 9.5 及更高版本的 SnapMirror 同步（ SM-S ），该功能可为任务关键型应用程序提供卷粒度零 RPO 数据复制解决方案。SM-S 需要使用 ONTAP 工具 9.8 或更高版本。</block>
  <block id="b9832b10a87d0c3793ed3b413ee1d839" category="section-title">REST API 支持</block>
  <block id="0065ce57adc813187a8e9c640ba6223a" category="paragraph">现在， SRA 服务器配置可通过 REST API 进行管理。我们添加了Swagger UI、可帮助您构建自动化工作流、您可以在ONTAP工具设备上找到此UI、网址为<block ref="579ce3ee0a7c1521f3dce6a507ea64a0" prefix=" " category="inline-code"></block>。</block>
  <block id="dcaf091737df278b1b4bdd2e37c10a75" category="summary">NetApp ONTAP 自 2002 年引入现代数据中心以来，一直是 VMware vSphere 环境中的领先存储解决方案，它不断增加创新功能来简化管理，同时降低成本。</block>
  <block id="0a0e655ee9ba6467857ebf014a268f29" category="doc">采用NetApp ONTAP的VMware Site Recovery Manager</block>
  <block id="5bdb12cbb14efa98a61e7c5e3b4de108" category="admonition">本文档将取代先前发布的技术报告_TR-4900:《使用ONTAP的VMware Site Recovery Manager_》</block>
  <block id="e3445c3aa798f5ad98665e33d34dd952" category="paragraph">最佳实践是指南和兼容性工具等其他文档的补充。它们是根据 NetApp 工程师和客户的实验室测试和丰富的现场经验开发的。在某些情况下，建议的最佳实践可能不适合您的环境；但是，它们通常是最简单的解决方案，可满足大多数客户的需求。</block>
  <block id="10b8f80c23f8a44dfa6b10ae56d7dbe9" category="paragraph">本文档重点介绍与适用于VMware vSphere 9.12的ONTAP工具(包括NetApp存储复制适配器[SRA ]和VASA Provider [VP])以及VMware Site Recovery Manager 8.7结合使用时、ONTAP 9最新版本中的功能。</block>
  <block id="c40f8c2af56356193284f6b46865d954" category="section-title">为什么要将 ONTAP 与 SRM 结合使用？</block>
  <block id="36c28121fc6c9b02a38c0b6c92654e9a" category="paragraph">由 ONTAP 软件提供支持的 NetApp 数据管理平台是 SRM 采用最广泛的一些存储解决方案。原因很多：一个安全、高性能、统一协议(NAS和SAN结合使用)的数据管理平台、可提供行业定义的存储效率、多租户、服务质量控制、利用节省空间的快照保护数据、以及利用SnapMirror进行复制。利用原生混合多云集成来保护 VMware 工作负载，以及触手可及的大量自动化和流程编排工具。</block>
  <block id="2242b80f4627736a48c4c9a36b7428f6" category="paragraph">使用SnapMirror进行基于阵列的复制时、您可以利用ONTAP最成熟、最成熟的技术之一。SnapMirror 可以让您获得安全高效的数据传输优势，只复制更改过的文件系统块，而不是复制整个 VM 或数据存储库。即使这些块也可以利用重复数据删除，数据压缩和数据缩减等空间节省。现代 ONTAP 系统现在使用与版本无关的 SnapMirror ，让您可以灵活地选择源集群和目标集群。SnapMirror 确实已成为灾难恢复可用的最强大工具之一。</block>
  <block id="36b04390d6103d8075862e4b825a485e" category="paragraph">无论您使用的是传统 NFS ， iSCSI 还是光纤通道连接的数据存储库（现在支持 VVol 数据存储库）， SRM 都可以提供强大的第一方产品，充分利用 ONTAP 的最佳功能进行灾难恢复或数据中心迁移规划和编排。</block>
  <block id="5d111e8a6885460b43ecf1f7abb6377e" category="section-title">SRM 如何利用 ONTAP 9</block>
  <block id="16d4ec242c9f020f3a1fade311c776ed" category="paragraph">SRM 可通过与适用于 VMware vSphere 的 ONTAP 工具集成来利用 ONTAP 系统的高级数据管理技术， VMware vSphere 是一种虚拟设备，其中包括三个主要组件：</block>
  <block id="d54038ba1f2a04a5b5f26c96627ae3e7" category="list-text">无论您使用的是 SAN 还是 NAS ， vCenter 插件（以前称为 Virtual Storage Console （ VSC ））均可简化存储管理和效率功能，提高可用性并降低存储成本和运营开销。它使用最佳实践配置数据存储库，并为 NFS 和块存储环境优化 ESXi 主机设置。为了获得所有这些优势， NetApp 建议在将 vSphere 与运行 ONTAP 软件的系统结合使用时使用此插件。</block>
  <block id="a106bb15d6dc2b11535ed4fefc81fbf4" category="list-text">适用于 ONTAP 的 VASA Provider 支持 VMware vStorage APIs for Storage Awareness （ VASA ）框架。VASA Provider 可将 vCenter Server 与 ONTAP 连接起来，以帮助配置和监控 VM 存储。它支持 VMware 虚拟卷（ VVOL ），并可管理存储功能配置文件（包括 VVOL 复制功能）和单个 VM VVOL 性能。此外，它还提供警报，用于监控容量以及配置文件合规性。与 SRM 结合使用时，适用于 ONTAP 的 VASA Provider 支持基于 VVOL 的虚拟机，而无需在 SRM 服务器上安装 SRA 适配器。</block>
  <block id="f2007951062862f5f0d593acbb23bcb4" category="list-text">SRA 与 SRM 结合使用，用于管理传统 VMFS 和 NFS 数据存储库的生产站点和灾难恢复站点之间的 VM 数据复制，并用于无中断测试灾难恢复副本。它有助于自动执行发现，恢复和重新保护任务。它包括适用于 Windows SRM 服务器和 SRM 设备的 SRA 服务器设备和 SRA 适配器。</block>
  <block id="8ccaa60ee78ecc93c4870b3b2ad15284" category="paragraph">在 SRM 服务器上安装并配置 SRA 适配器以保护非 VVOL 数据存储库和 / 或在 VASA Provider 设置中启用 VVOL 复制后，您可以开始配置 vSphere 环境以实现灾难恢复的任务。</block>
  <block id="0a1e25166326359cd5f50d0ab83e6a37" category="paragraph">SRA 和 VASA Provider 为 SRM 服务器提供了一个命令和控制界面，用于管理包含 VMware 虚拟机（ VM ）的 ONTAP FlexVol 以及保护它们的 SnapMirror 复制。</block>
  <block id="38db855935949f86c5db7bfe7d49873e" category="paragraph">从 SRM 8.3 开始， SRM 服务器引入了一个新的 SRM VVol Provider 控制路径，使其可以与 vCenter 服务器进行通信，并通过该服务器与 VASA Provider 进行通信，而无需 SRA 。这样， SRM 服务器就可以比以前更深入地控制 ONTAP 集群，因为 VASA 可提供一个完整的 API 来实现紧密耦合的集成。</block>
  <block id="1c27364cc3705aff403c6ef131c347ff" category="paragraph">SRM可以使用NetApp的专有FlexClone技术无干扰地测试您的灾难恢复计划、以便为灾难恢复站点上受保护的数据存储库创建近乎即时的克隆。SRM 会创建一个沙盒来进行安全测试，以便在发生真正灾难时保护您的组织和客户，从而让您对组织在发生灾难时执行故障转移的能力充满信心。</block>
  <block id="04a8f82007ed4bec45053912a49b6f85" category="paragraph">如果发生真正的灾难甚至是计划内迁移， SRM 允许您通过最终 SnapMirror 更新（如果您选择这样做）向数据集发送任何最后一分钟的更改。然后，它会中断镜像并将数据存储库挂载到灾难恢复主机。此时，您可以根据预先规划的策略按任意顺序自动启动 VM 。</block>
  <block id="b2560426a08ae6ceb167dad2bfb5e8ae" category="section-title">采用 ONTAP 的 SRM 以及其他使用情形：混合云和迁移</block>
  <block id="ed4c730bd8636c27d3eaa876c63b3d45" category="inline-link">Equinix 中的 NetApp 私有存储</block>
  <block id="b422e05bc5c6f52208b66ff51d718b9d" category="paragraph">与本地存储选项相比，将 SRM 部署与 ONTAP 高级数据管理功能相集成，可以显著提高扩展能力和性能。除此之外，它还带来了混合云的灵活性。通过混合云，您可以使用 FabricPool 将未使用的数据块从高性能阵列分层到首选超大规模存储器，从而节省资金。 StorageGRID 可以是 NetApp 等内部 S3 存储。您还可以使用 Cloud Volumes ONTAP （ CVO ）或对基于边缘的系统使用 SnapMirror ，并使用软件定义的 ONTAP Select 或基于云的灾难恢复<block ref="37a666d3a37f1c4a8c4c8dba379664a4" category="inline-link-rx"></block> 适用于 Amazon Web Services （ AWS ）， Microsoft Azure 和 Google Cloud Platform （ GCP ），可在云中创建完全集成的存储，网络和计算服务堆栈。</block>
  <block id="87a7b114355b836acefe833c497611bb" category="paragraph">借助FlexClone、您可以在云服务提供商的数据中心内执行测试故障转移、存储占用空间接近零。现在，保护您的组织的成本比以往任何时候都低。</block>
  <block id="12d0cbcf61df7df30bf9b020f6fbb051" category="paragraph">SRM 还可用于执行计划内迁移，方法是利用 SnapMirror 将 VM 从一个数据中心高效地传输到另一个数据中心，甚至在同一个数据中心内高效地传输 VM ，无论您自己还是通过任意数量的 NetApp 合作伙伴服务提供商。</block>
  <block id="160f88ca0bed5b24e94c809f4e22f1e7" category="summary">在 ONTAP 9 中，集群管理员可以看到集群的物理组件，但使用集群的应用程序和主机无法直接看到这些物理组件。</block>
  <block id="89fafdb11a7e8cd8abebb1d4df053dad" category="doc">复制拓扑</block>
  <block id="be01acd2f018d38f9446f06b99ee4a2a" category="paragraph">在 ONTAP 9 中，集群管理员可以看到集群的物理组件，但使用集群的应用程序和主机无法直接看到这些物理组件。物理组件提供了一个共享资源池，用于构建逻辑集群资源。应用程序和主机仅通过包含卷和 LIF 的 SVM 访问数据。</block>
  <block id="7758fc02779ee5917b0a09ee22b52221" category="paragraph">在 VMware vCenter Site Recovery Manager 中，每个 NetApp SVM 都被视为一个阵列。SRM 支持某些阵列到阵列（或 SVM 到 SVM ）复制布局。</block>
  <block id="58c0b55a67f4331cc49b073a7183e06c" category="paragraph">一个虚拟机不能在多个 SRM 阵列上拥有虚拟机磁盘（ Virtual Machine Disk ， VMDK ）或 RDM 数据，原因如下：</block>
  <block id="880aeda0b58c0b30120b6319ae5f3beb" category="list-text">SRM 只能识别 SVM ，而不能识别单个物理控制器。</block>
  <block id="6f55124e085dbeb640e4cb8ad2c97905" category="list-text">SVM 可以控制跨越集群中多个节点的 LUN 和卷。</block>
  <block id="39d9903201320a83d45d3b36d512f051" category="cell">最佳实践</block>
  <block id="d86019fe4ba86b184ac71cf24a22f0c6" category="cell">要确定可支持性，请牢记以下规则：要使用 SRM 和 NetApp SRA 保护 VM ， VM 的所有部分都必须仅位于一个 SVM 上。此规则适用于受保护站点和恢复站点。</block>
  <block id="2e4472d35f80aa8b7eca52ae3dd43dc6" category="section-title">支持的 SnapMirror 布局</block>
  <block id="d070ad9d8397892aa7f317cbb9046661" category="paragraph">下图显示了 SRM 和 SRA 支持的 SnapMirror 关系布局方案。复制卷中的每个 VM 在每个站点上仅拥有一个 SRM 阵列（ SVM ）上的数据。</block>
  <block id="39d3085abe6ccb914d8535de8a5f3e37" category="paragraph"><block ref="39d3085abe6ccb914d8535de8a5f3e37" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1ae7670cf947a397bdf6a882fbcc912a" category="paragraph"><block ref="1ae7670cf947a397bdf6a882fbcc912a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="111d3212464dba203cbd675a0338dcbc" category="paragraph"><block ref="111d3212464dba203cbd675a0338dcbc" category="inline-image-macro-rx" type="image"></block></block>
  <block id="c5dc3a606b05b41db22793ed3c1a72db" category="paragraph"><block ref="c5dc3a606b05b41db22793ed3c1a72db" category="inline-image-macro-rx" type="image"></block></block>
  <block id="86cf5bd2bdb1b1d67f8f907f41099509" category="section-title">支持的阵列管理器布局</block>
  <block id="aacc8f18d659f75715d91a983e872233" category="paragraph">在 SRM 中使用基于阵列的复制（ ABR ）时，保护组会隔离到一个阵列对中，如以下屏幕截图所示。在此情景中、<block ref="129864522ed0e4ac80f306ecfa130ef7" prefix=" " category="inline-code"></block> 和<block ref="ec87aa7f4c8e70a139fd988f87b6549f" prefix=" " category="inline-code"></block> 与建立对等关系<block ref="387d04b65848414d4697f145a3782f90" prefix=" " category="inline-code"></block> 和<block ref="58bdbfcb72c2dd3d883a7ca754443a4c" prefix=" " category="inline-code"></block> 在恢复站点上。但是，在创建保护组时，您只能选择两个阵列对中的一个。</block>
  <block id="68a1b289711a591ed50627014cd01ce9" category="paragraph"><block ref="68a1b289711a591ed50627014cd01ce9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1ceb46f3e1c6c7995de4ec5f05601227" category="section-title">不支持的布局</block>
  <block id="611b9b35ac984f20e6594baec9181dbf" category="paragraph">不受支持的配置会在单个虚拟机所拥有的多个 SVM 上包含数据（ VMDK 或 RDM ）。在下图所示的示例中、<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block> 无法配置为使用SRM进行保护、因为<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block> 数据位于两个SVM上。</block>
  <block id="5c251a65e8394fbeaf104ba1a1cad2e1" category="paragraph"><block ref="5c251a65e8394fbeaf104ba1a1cad2e1" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f5f5fe64e0e9d0ae7ce2a0777d0ccf62" category="paragraph"><block ref="f5f5fe64e0e9d0ae7ce2a0777d0ccf62" category="inline-image-macro-rx" type="image"></block></block>
  <block id="69851ac8c2fa81b32799efc8522798d5" category="paragraph">如果任何复制关系将单个 NetApp 卷从一个源 SVM 复制到同一 SVM 或不同 SVM 中的多个目标，则称为 SnapMirror 扇出。SRM 不支持扇出。在下图所示的示例中、<block ref="df777c4d2477e55571925353ce589f7e" prefix=" " category="inline-code"></block> 无法在SRM中配置保护、因为它已通过SnapMirror复制到两个不同位置。</block>
  <block id="688890bdbdfd2d73a05a09883f3c4b40" category="paragraph"><block ref="688890bdbdfd2d73a05a09883f3c4b40" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3f88384b0d5cdcdc25895c644126c1b0" category="section-title">SnapMirror 级联</block>
  <block id="7ebde774ad43c45667d5544308a6d688" category="paragraph">SRM 不支持 SnapMirror 关系的级联，即，将源卷复制到目标卷，同时使用 SnapMirror 将目标卷复制到另一个目标卷。在下图所示的情形中，不能使用 SRM 在任何站点之间进行故障转移。</block>
  <block id="2990fc44e9ba827a397e96e1c278a02a" category="paragraph"><block ref="2990fc44e9ba827a397e96e1c278a02a" category="inline-image-macro-rx" type="image"></block></block>
  <block id="8bd15e818d377a0a5cf6ebc429555f79" category="section-title">SnapMirror 和 SnapVault</block>
  <block id="d440734d1f5d9c6e59aa97f7cbbcd525" category="paragraph">NetApp SnapVault 软件支持在 NetApp 存储系统之间对企业数据进行基于磁盘的备份。SnapVault 和 SnapMirror 可以同时位于同一环境中；但是， SRM 仅支持 SnapMirror 关系的故障转移。</block>
  <block id="7878dfbf4b6ad3bc60d095cf89d79202" category="admonition">NetApp SRA支持<block ref="e7d3e049f94ce3ff8a47f209f012173d" prefix=" " category="inline-code"></block> 策略类型。</block>
  <block id="883e69a285ae2d5fd23c80cd29285804" category="paragraph">SnapVault 是为 ONTAP 8.2 从头开始重建的。虽然以前的 Data ONTAP 7- 模式用户应该发现相似之处，但此版本的 SnapVault 已进行了重大改进。其中一项重大进步是，能够在 SnapVault 传输期间保持主数据的存储效率。</block>
  <block id="9bc21373e0e299579a7ac86dcd4f513d" category="paragraph">一个重要的架构变化是， ONTAP 9 中的 SnapVault 在卷级别进行复制，而不是像 7- 模式 SnapVault 那样在 qtree 级别进行复制。此设置意味着 SnapVault 关系的源必须为卷，并且该卷必须复制到 SnapVault 二级系统上其自身的卷。</block>
  <block id="d447048519c85a2fb3bea0790cd109fb" category="paragraph">在使用SnapVault的环境中、会在主存储系统上创建专门命名的快照。根据所实施的配置、可以通过SnapVault计划或NetApp Active IQ Unified Manager等应用程序在主系统上创建命名快照。然后、在主系统上创建的命名快照会复制到SnapMirror目标、并从该目标存储到SnapVault目标。</block>
  <block id="5dd37b7cd36f7d38ba2e6a63c603be4c" category="paragraph">可以在级联配置中创建源卷，在级联配置中，卷会复制到灾难恢复站点中的 SnapMirror 目标，然后从该位置存储到 SnapVault 目标。也可以在扇出关系中创建源卷，其中一个目标是 SnapMirror 目标，另一个目标是 SnapVault 目标。但是，在发生 SRM 故障转移或复制反转时， SRA 不会自动重新配置 SnapVault 关系以使用 SnapMirror 目标卷作为存储源。</block>
  <block id="5bc66b9c84b3f7cc0b375e729376b68d" category="inline-link">TR-4015 《适用于 ONTAP 9 的 SnapMirror 配置最佳实践指南》。</block>
  <block id="0d510e96259254d285c6aaeb8458f45d" category="paragraph">有关适用于 ONTAP 9 的 SnapMirror 和 SnapVault 的最新信息，请参见<block ref="32e7c991f675bf983c547a2a174c2caf" category="inline-link-rx"></block></block>
  <block id="75f8a2d99eea9f336120aec69d8c1010" category="cell">如果在同一环境中使用 SnapVault 和 SRM ， NetApp 建议使用 SnapMirror 到 SnapVault 级联配置，其中通常会从灾难恢复站点的 SnapMirror 目标执行 SnapVault 备份。发生灾难时，此配置会使主站点无法访问。通过将 SnapVault 目标保留在恢复站点上，可以在故障转移后重新配置 SnapVault 备份，以便在恢复站点上运行时可以继续执行 SnapVault 备份。</block>
  <block id="e082a67e3ddd7f4f92096536440cbb34" category="paragraph">在 VMware 环境中，每个数据存储库都有一个通用唯一标识符（ UUID ），每个 VM 都有一个唯一的受管对象 ID （ MOID ）。在故障转移或故障恢复期间， SRM 不会维护这些 ID 。由于 SRM 在故障转移期间不会维护数据存储库 UUID 和 VM MOID ，因此，在 SRM 故障转移后，必须重新配置依赖这些 ID 的所有应用程序。例如， NetApp Active IQ Unified Manager 可将 SnapVault 复制与 vSphere 环境进行协调。</block>
  <block id="657a41cce55646ab17754ac1427970af" category="paragraph">下图显示了 SnapMirror 到 SnapVault 的级联配置。如果 SnapVault 目标位于灾难恢复站点或不受主站点中断影响的三级站点上，则可以重新配置环境，以便在故障转移后继续备份。</block>
  <block id="b56afb9a43332c671116b9fa3d597867" category="paragraph"><block ref="b56afb9a43332c671116b9fa3d597867" category="inline-image-macro-rx" type="image"></block></block>
  <block id="e068178460f103498576eac8ddb7fb82" category="paragraph">下图显示了使用 SRM 将 SnapMirror 复制反转回主站点后的配置。此外，还对环境进行了重新配置，使 SnapVault 备份从现在的 SnapMirror 源进行。此设置为 SnapMirror SnapVault 扇出配置。</block>
  <block id="0ffa07ffd89b136d0ed8f2ac5ebcabb8" category="paragraph"><block ref="0ffa07ffd89b136d0ed8f2ac5ebcabb8" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b4607a4ee7e1830ab6ba0007df206956" category="paragraph">在 SRM 执行故障恢复并再次反转 SnapMirror 关系后，生产数据将返回到主站点。现在，此数据将通过 SnapMirror 和 SnapVault 备份获得与故障转移到灾难恢复站点之前相同的保护方式。</block>
  <block id="63fd1f18d5d53fa97fd05a7fd96090b4" category="section-title">在 Site Recovery Manager 环境中使用 qtree</block>
  <block id="2d88570ceb2de0d8699a068b0140454b" category="paragraph">qtree 是一种特殊目录，可用于为 NAS 应用文件系统配额。ONTAP 9 允许创建 qtree ，而 qtree 可以存在于使用 SnapMirror 复制的卷中。但是， SnapMirror 不允许复制单个 qtree 或 qtree 级复制。所有 SnapMirror 复制仅在卷级别进行。因此， NetApp 不建议在 SRM 中使用 qtree 。</block>
  <block id="345cb3f040f9f7f3f1a4261ed260aa79" category="section-title">FC 和 iSCSI 混合环境</block>
  <block id="a60b166c2b69b4fdfbb733dc2193668a" category="paragraph">借助支持的 SAN 协议（ FC ， FCoE 和 iSCSI ）， ONTAP 9 可提供 LUN 服务，即创建 LUN 并将其映射到连接的主机。由于集群由多个控制器组成，因此，多路径 I/O 可管理多个逻辑路径，并将其连接到任何单个 LUN 。主机上使用非对称逻辑单元访问（ ALUA ），以便选择 LUN 的优化路径并使其处于活动状态以进行数据传输。如果指向任何 LUN 的优化路径发生变化（例如，由于移动了包含 LUN 的卷）， ONTAP 9 会自动识别此更改并无中断地进行调整。如果优化路径不可用， ONTAP 可以无中断地切换到任何其他可用路径。</block>
  <block id="b9921ac732e72656bc2836f83bb09522" category="paragraph">VMware SRM 和 NetApp SRA 支持在一个站点使用 FC 协议，而在另一个站点使用 iSCSI 协议。但是，不支持在同一 ESXi 主机或同一集群中的不同主机中混合使用 FC 连接的数据存储库和 iSCSI 连接的数据存储库。SRM 不支持此配置，因为在 SRM 故障转移或测试故障转移期间， SRM 会在请求中包括 ESXi 主机中的所有 FC 和 iSCSI 启动程序。</block>
  <block id="fccd44a96243e459128798803dca70aa" category="cell">SRM 和 SRA 支持在受保护站点和恢复站点之间混合使用 FC 和 iSCSI 协议。但是，每个站点只能配置一个 FC 或 iSCSI 协议，而不能在同一站点上同时配置这两个协议。如果要求在同一站点同时配置 FC 和 iSCSI 协议， NetApp 建议某些主机使用 iSCSI ，而其他主机使用 FC 。在这种情况下， NetApp 还建议设置 SRM 资源映射，以便将 VM 配置为故障转移到一组主机或另一组主机。</block>
  <block id="963739e9818c0bf4d8959b5cdf6a7956" category="summary">使用 VVOL 复制时， SRM 中的工作流与使用 SRA 和传统数据存储库时的工作流有明显不同。</block>
  <block id="56687c1a324f03f5d1429500efea710e" category="doc">对使用 VVol 复制的 SRM 进行故障排除</block>
  <block id="14acf40cbe69d8682b4c844ac7fbf7f6" category="paragraph">使用 VVOL 复制时， SRM 中的工作流与使用 SRA 和传统数据存储库时的工作流有明显不同。例如，没有阵列管理器概念。因此，<block ref="0ec64480a9620a1430c0ae1b6603ea01" prefix=" " category="inline-code"></block> 和<block ref="ba6c59072f543cb828e47d5bac560371" prefix=" " category="inline-code"></block> 无法看到命令。</block>
  <block id="ef74d715544e3b067a6bec3218ac5044" category="paragraph">在进行故障排除时，了解下面列出的新工作流非常有用：</block>
  <block id="47f0942d341ee10381b2eff35089d75d" category="list-text">queryReplicationPeer ：发现两个故障域之间的复制协议。</block>
  <block id="136a299aae29998a147852cb0cba5b4a" category="list-text">queryFaultDomain ：发现故障域层次结构。</block>
  <block id="c071098c5df923c31f6245e4db2f3861" category="list-text">queryReplicationGroup ：发现源域或目标域中的复制组。</block>
  <block id="792cfe9ad3a3dc8528080a262e92989a" category="list-text">syncReplicationGroup ：同步源和目标之间的数据。</block>
  <block id="39afb1e1e3b180a6230e07bb8571667e" category="list-text">queryPointInTimeReplica ：发现目标上的时间点副本。</block>
  <block id="9fb25fe2ff084dc9ccfb99eaccba7212" category="list-text">testFailoverReplicationGroupStart ：开始测试故障转移。</block>
  <block id="bd4e1dacaca4c37a53b5286b6ae0239d" category="list-text">testFailoverReplicationGroupStop ：结束测试故障转移。</block>
  <block id="887f376a43cf9de1d6e14a8d69e588f6" category="list-text">promoteReplicationGroup ：将当前正在测试的组提升为生产组。</block>
  <block id="17ab16c5c0786ff381e6a085318bad9b" category="list-text">prepareFailoverReplicationGroup ：准备灾难恢复。</block>
  <block id="665dd64ebcc4016bda94e0e8020d8c8e" category="list-text">failoverReplicationGroup ：执行灾难恢复。</block>
  <block id="6936cf00e30b7cd4421225113a023c3e" category="list-text">reverseReplicateGroup ：启动反向复制。</block>
  <block id="61ac8950a043e6998b458d4f8171154c" category="list-text">queryMatchingContainer ：查找可能使用给定策略满足配置请求的容器（以及主机或复制组）。</block>
  <block id="05c9efdc056d2af4640bc441ab61b53a" category="list-text">queryResourceMetadata ：从 VASA 提供程序中发现所有资源的元数据，资源利用率可以作为问题解答返回给 queryMatchingContainer 函数。</block>
  <block id="01fa56986f885c588b1be8c206623de8" category="paragraph">配置 VVOL 复制时，最常见的错误是无法发现 SnapMirror 关系。之所以出现这种情况，是因为卷和 SnapMirror 关系是在 ONTAP 工具的权限范围之外创建的。因此，最佳做法是，在尝试创建复制的 VVOL 数据存储库之前，始终确保 SnapMirror 关系已完全初始化，并且您已在两个站点的 ONTAP 工具中运行重新发现。</block>
  <block id="3e4627f6667f830baceaaf35890b575a" category="summary">要了解有关本文档中所述信息的更多信息，请查看以下文档和 / 或网站：</block>
  <block id="092bf78f9c97ba171b8232ddff585392" category="doc">追加信息</block>
  <block id="7d5b957cd473f6eaf5ad335a9c63c4ff" category="paragraph">要了解有关本文档中所述信息的更多信息，请查看以下文档和 / 或网站：</block>
  <block id="ccc4b678df8ad6453b7f71661f118ae1" category="inline-link"><block ref="ccc4b678df8ad6453b7f71661f118ae1" category="inline-link-rx"></block></block>
  <block id="b17e2a7e5f42c90b40de5971850339ae" category="list-text">TR-4597 ：适用于 ONTAP 的 VMware vSphere
<block ref="5938ff9651f6c5e53544676ba8504afc" category="inline-link-rx"></block></block>
  <block id="7d9ee37e3155d571b441d63bcbc54709" category="inline-link"><block ref="7d9ee37e3155d571b441d63bcbc54709" category="inline-link-rx"></block></block>
  <block id="52c629361849219069b336f56f1556d0" category="list-text">TR-4400 ：采用 ONTAP 的 VMware vSphere 虚拟卷
<block ref="b7bf139d6051615d8c8e01b6b63dacc3" category="inline-link-rx"></block></block>
  <block id="18df8e05a5400abd9d0980b1c5bc9ef3" category="list-text">TR-4015 《适用于 ONTAP 9 的 SnapMirror 配置最佳实践指南》
<block ref="e361bd9d6f7b20da762bc23fcb3d09c2" category="inline-link-rx"></block></block>
  <block id="cbe2f6eb2a73f4a2c871a06264f10dc7" category="inline-link"><block ref="cbe2f6eb2a73f4a2c871a06264f10dc7" category="inline-link-rx"></block></block>
  <block id="249b98331fa56dc46bf6ba51dc6c39d5" category="list-text">适用于 ONTAP 的 RBAC User Creator
<block ref="6b15b91279acfce2bbee060bdb17db43" category="inline-link-rx"></block></block>
  <block id="c88037eb28ae3cceb0e32c2cd3c322d7" category="inline-link"><block ref="c88037eb28ae3cceb0e32c2cd3c322d7" category="inline-link-rx"></block></block>
  <block id="1a57e0f74e725c1a5e2d53b4d4b4460d" category="list-text">适用于 VMware vSphere 的 ONTAP 工具资源
<block ref="80c496cd9ab75e5683007d8f66ca6fbf" category="inline-link-rx"></block></block>
  <block id="9aa6e8f8fac5c131e5924ee033660d29" category="inline-link"><block ref="9aa6e8f8fac5c131e5924ee033660d29" category="inline-link-rx"></block></block>
  <block id="91a48e1708df22b7464bced79c745ad2" category="list-text">VMware Site Recovery Manager 文档
<block ref="92ad802ced4838839b492be6d0bf427d" category="inline-link-rx"></block></block>
  <block id="c9dd6bad4c7d561872f2e2d498a990bf" category="inline-link">互操作性表工具（ IMT ）</block>
  <block id="97cd1357ea4a16b44bd9e360127a1a9d" category="paragraph">请参见<block ref="99cfde592e1d7fa7832b186d73ee4002" category="inline-link-rx"></block> 在 NetApp 支持站点上，验证您的特定环境是否支持本文档中所述的确切产品和功能版本。NetApp IMT 定义了可用于构建 NetApp 支持的配置的产品组件和版本。具体结果取决于每个客户是否按照已发布的规格进行安装。</block>
  <block id="1f82b18dcba5f32a085bc502cdd0c6b7" category="summary">借助 ONTAP ， Storage Virtual Machine （ SVM ）的概念可在安全多租户环境中提供严格的分段。</block>
  <block id="7520e12a140ccf3de279fe2fd48889e4" category="doc">部署最佳实践</block>
  <block id="1b4574c516231b685bb37b013b789b06" category="section-title">SMT 的 SVM 布局和分段</block>
  <block id="446e04546ec0567eeeeef8e07368ab40" category="paragraph">借助 ONTAP ， Storage Virtual Machine （ SVM ）的概念可在安全多租户环境中提供严格的分段。一个 SVM 上的 SVM 用户无法从另一个 SVM 访问或管理资源。这样，您就可以利用 ONTAP 技术，为在同一集群上管理自己 SRM 工作流的不同业务单位创建单独的 SVM ，从而提高整体存储效率。</block>
  <block id="f98c1d223f34b2fdaf90eab1a3bc6a25" category="paragraph">请考虑使用 SVM 范围的帐户和 SVM 管理 LIF 管理 ONTAP ，这样不仅可以改进安全控制，还可以提高性能。使用 SVM 范围的连接时，性能本身就会更高，因为处理整个集群中的所有资源（包括物理资源）并不需要 SRA 。相反，它只需要了解抽象到特定 SVM 的逻辑资产。</block>
  <block id="849d4d5e8a5d5b2747d8375d2ec03b29" category="paragraph">仅使用 NAS 协议（无 SAN 访问）时，您甚至可以通过设置以下参数来利用新的 NAS 优化模式（请注意，此名称是如此，因为 SRA 和 VASA 在设备中使用相同的后端服务）：</block>
  <block id="05f551a655f40911851a53ba0c721997" category="list-text">登录到控制面板<block ref="501a3478972ee5e3d6f109bdc0514bdc" prefix=" " category="inline-code"></block> 然后单击基于Web的命令行界面。</block>
  <block id="b0cc185c73ca964d1429a601551c68f5" category="list-text">运行命令<block ref="4f35e9b3adeccfaf0287d002b134221c" prefix=" " category="inline-code"></block>。</block>
  <block id="5f7e35f90689bef91afe9f01257c61ac" category="list-text">运行命令<block ref="aa610e3ab4e5162f432950793f30a387" prefix=" " category="inline-code"></block>。</block>
  <block id="ba2a1e4d95dc56709260e82cca20a789" category="list-text">运行命令<block ref="6d83e9fce5e947159c3c34b9f499e80e" prefix=" " category="inline-code"></block>。</block>
  <block id="2d14ca751c8ce5a724606e4f75f02c50" category="section-title">部署适用于 VVOL 的 ONTAP 工具和注意事项</block>
  <block id="fa3a193f1892cf0f45f4a95a35aa3c4b" category="paragraph">如果要将 SRM 与 VVol 结合使用，则必须使用集群范围的凭据和集群管理 LIF 来管理存储。这是因为 VASA Provider 必须了解底层物理架构，才能满足 VM 存储策略的策略要求。例如，如果您的策略需要全闪存存储，则 VASA Provider 必须能够查看哪些系统全闪存。</block>
  <block id="31d279d1cc3bc5a4281567ba697f678d" category="paragraph">另一个部署最佳实践是，切勿将 ONTAP 工具设备存储在其管理的 VVOL 数据存储库上。这可能导致无法启动 VASA Provider ，因为您无法为设备创建交换 VVol ，因为设备已脱机。</block>
  <block id="97399fb37deca0d463aa5c7dc8d064a6" category="section-title">管理 ONTAP 9 系统的最佳实践</block>
  <block id="18f8b81b7fb7ea92f333e127583df17c" category="paragraph">如前所述，您可以使用集群或 SVM 范围的凭据和管理 LIF 来管理 ONTAP 集群。为了获得最佳性能、您可能需要考虑在不使用Vvol的情况下使用SVM范围的凭据。但是，在执行此操作时，您应了解一些要求，并且确实会丢失某些功能。</block>
  <block id="fec05e53ca7d96aaf3e4c1a1b2502bea" category="list-text">默认 vsadmin SVM 帐户没有执行 ONTAP 工具任务所需的访问级别。因此，您需要创建新的 SVM 帐户。</block>
  <block id="d508cbe8ee8a3aa0f975b96403baf33c" category="list-text">如果您使用的是ONTAP 9.8或更高版本、NetApp建议使用ONTAP System Manager的"用户"菜单以及ONTAP工具设备上提供的JSON文件创建一个RBAC权限最低的用户帐户、网址为<block ref="137f8d4bb89dcc34c3bfe48f2a61c95e" prefix=" " category="inline-code"></block>。使用您的管理员密码下载 JSON 文件。这可以用于 SVM 或集群范围的帐户。</block>
  <block id="a7a83b5e4f375c0585588b9c7ff92219" category="inline-link">NetApp 支持站点工具箱</block>
  <block id="fdfe9ba9104df6a32fff0f859291ea3c" category="paragraph">如果您使用的是 ONTAP 9.6 或更早版本，则应使用中提供的 RBAC User Creator （ RUC ）工具<block ref="bdbf96c18cf8ac76d01fba7057b81b87" category="inline-link-rx"></block>。</block>
  <block id="ea7a3d08d55dc3e8ecf89d2a5d5e302d" category="list-text">由于 vCenter UI 插件， VASA Provider 和 SRA 服务器都是完全集成的服务，因此您必须按照在 vCenter UI for ONTAP Tools 中添加存储的方式在 SRM 中向 SRA 适配器添加存储。否则， SRA 服务器可能无法识别通过 SRA 适配器从 SRM 发送的请求。</block>
  <block id="b473de4177eeaa79a66448798a446db3" category="list-text">使用 SVM 范围的凭据时，不会执行 NFS 路径检查。这是因为物理位置从 SVM 中进行了逻辑抽象。不过，这并不是一个值得关注的发生原因，因为现代 ONTAP 系统在使用间接路径时不再出现任何明显的性能下降。</block>
  <block id="6e62430b92a7c5a0b8512436b163a10d" category="list-text">可能不会报告因存储效率而节省的聚合空间。</block>
  <block id="93d86aa51e0909549d1b1210f887aef3" category="list-text">如果支持，则无法更新负载共享镜像。</block>
  <block id="647d380b52e259fe7ed2e2582bc54b27" category="list-text">可能不会在使用 SVM 范围的凭据管理的 ONTAP 系统上执行 EMS 日志记录。</block>
  <block id="c5cd657df037c277c37216b73efb0b08" category="summary">如果可能，请始终使用 ONTAP 工具配置数据存储库和卷。这样可以确保卷，接合路径， LUN ， igroup ，导出策略， 以及其他设置均以兼容的方式进行配置。</block>
  <block id="d3b26e9021e83573a3d2a9050400a33a" category="doc">操作最佳实践</block>
  <block id="4d15db58f26b374b36c283df6b5a5fc1" category="paragraph">通过 SRA 使用基于阵列的复制时， SRM 支持在 ONTAP 9 中使用 iSCSI ，光纤通道和 NFS 版本 3 。对于使用传统或 VVol 数据存储库的 NFS 版本 4.1 ， SRM 不支持基于阵列的复制。</block>
  <block id="61f54ceeb0338787a2ee2d801cbc62cd" category="paragraph">要确认连接，请始终验证您是否可以从目标 ONTAP 集群在灾难恢复站点挂载和卸载新的测试数据存储库。测试要用于数据存储库连接的每个协议。最佳做法是使用 ONTAP 工具创建测试数据存储库，因为它正在按照 SRM 的指示执行所有数据存储库自动化。</block>
  <block id="0ac3e8abbf45a28af68d22b0f59a973e" category="paragraph">每个站点的 SAN 协议都应是同构的。您可以混合使用 NFS 和 SAN ，但不应在站点内混合使用 SAN 协议。例如，您可以在站点 A 中使用 FCP ，在站点 B 中使用 iSCSI站点 A 不应同时使用 FCP 和 iSCSI原因是 SRA 不会在恢复站点创建混合 igroup ，并且 SRM 不会筛选为 SRA 提供的启动程序列表。</block>
  <block id="62a631034cae40cfcee909c69c12c5b3" category="paragraph">可以将NetApp ONTAP 9配置为在自动调整大小无法提供足够的紧急容量时自动删除快照、以便在空间不足的情况下保持正常运行时间。此功能的默认设置不会自动删除由SnapMirror创建的快照。如果删除了SnapMirror快照、则NetApp SRA将无法反转和重新同步受影响卷的复制。要防止ONTAP删除SnapMirror快照、请将Snapshot自动删除功能配置为尝试。</block>
  <block id="63b6c8d5e17ef7185a34c4ddd86f9d19" category="inline-link-macro">将卷配置为自动增长或缩减</block>
  <block id="a1874a28c8389c5c687d10167e80dc1f" category="paragraph">卷自动调整大小应设置为<block ref="4d200fce73a8e1cc965cfc2c43343824" prefix=" " category="inline-code"></block> 对于包含SAN数据存储库和的卷<block ref="d89f4f8b1d7c18847b88b46142f61535" prefix=" " category="inline-code"></block> 对于NFS数据存储库。了解更多信息 <block ref="ebd664f1c7cf128a3758282775d35e72" category="inline-link-macro-rx"></block>。</block>
  <block id="e401bd7c98141814eaf5528ddb318da6" category="section-title">基于存储策略的管理(Storage Policy Based Management、SPBM)和虚拟卷</block>
  <block id="b180e7f35111dca8acd6c56cdbcabb3e" category="paragraph"><block ref="b180e7f35111dca8acd6c56cdbcabb3e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="be41c3baf700984021c43e2e6b661b0a" category="paragraph">以下屏幕截图提供了创建 VM 存储策略向导中显示的 SnapMirror 计划示例。</block>
  <block id="43c130b36e9e2b3d61409aa974f89fc7" category="paragraph"><block ref="43c130b36e9e2b3d61409aa974f89fc7" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f6292d9eb6ea467a3c3560a65b7f63b5" category="paragraph">ONTAP VASA Provider 支持故障转移到不同的存储。例如，系统可以从边缘位置的 ONTAP Select 故障转移到核心数据中心的 AFF 系统。无论存储相似性如何，您都必须始终为启用了复制的 VM 存储策略配置存储策略映射和反向映射，以确保在恢复站点提供的服务满足预期和要求。以下屏幕截图突出显示了一个示例策略映射。</block>
  <block id="783a951245ce43eb84161804072a38c6" category="paragraph"><block ref="783a951245ce43eb84161804072a38c6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1eb90dc8f7adfd00c74af3b815e2ac15" category="section-title">为 VVOL 数据存储库创建复制的卷</block>
  <block id="dd5e006520a09e3975e52f6fb8991fd2" category="paragraph"><block ref="dd5e006520a09e3975e52f6fb8991fd2" category="inline-image-macro-rx" type="image"></block></block>
  <block id="550d51e15336d4a33bcbb0f26a6810f7" category="paragraph">对于 VVOL 和 SRM ，应注意一个事项。切勿在同一个 VVOL 数据存储库中混用受保护和未受保护的 VM 。原因是，在使用 SRM 故障转移到灾难恢复站点时，灾难恢复中只会使属于保护组的 VM 联机。因此，在重新保护（将 SnapMirror 从灾难恢复反转至生产环境）时，您可能会覆盖未进行故障转移且可能包含有价值数据的 VM 。</block>
  <block id="6d717f70d89096b731dfc63d7a1379e1" category="section-title">关于阵列对</block>
  <block id="2219228418c053eb593ce0a1f318da47" category="paragraph">在 SRM 中配置阵列对时，应始终按照将其添加到 ONTAP 工具的方式在 SRM 中添加这些阵列对，也就是说，它们必须使用相同的用户名，密码和管理 LIF 。此要求可确保 SRA 与阵列正确通信。以下屏幕截图说明了集群在 ONTAP 工具中的显示方式以及如何将其添加到阵列管理器中。</block>
  <block id="7ec48584a43ed8a9b1dda55398d97cf4" category="paragraph"><block ref="7ec48584a43ed8a9b1dda55398d97cf4" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3b34135c8c4d2b14ceb7ebf595f00193" category="section-title">关于复制组</block>
  <block id="6be59afd3c8bb91501f55a7e77ebe794" category="paragraph">复制组包含同时恢复的虚拟机的逻辑集合。ONTAP 工具 VASA Provider 会自动为您创建复制组。由于 ONTAP SnapMirror 复制是在卷级别进行的，因此卷中的所有 VM 都位于同一个复制组中。</block>
  <block id="c727c1020d3128dd7495a6e3e6f23736" category="paragraph">对于复制组，最后要考虑的一点是，每个复制组本身都是一个逻辑一致性组（不要与 SRM 一致性组相混淆）。这是因为卷中的所有 VM 都会使用同一个快照一起传输。因此，如果您的虚拟机必须彼此一致，请考虑将其存储在同一个 FlexVol 中。</block>
  <block id="9f8a350a2113ea4be6b4e5e5112514a3" category="section-title">关于保护组</block>
  <block id="df77671ab2743af7f1d1457c200eb12c" category="paragraph">保护组用于定义从受保护站点一起恢复的组中的 VM 和数据存储库。受保护站点是指在正常稳定状态操作期间，在保护组中配置的 VM 所在的站点。请务必注意，即使 SRM 可能会为一个保护组显示多个阵列管理器，一个保护组也不能跨越多个阵列管理器。因此，您不应将 VM 文件跨越不同 SVM 上的数据存储库。</block>
  <block id="b148467d645c3613c1c7a2607764c515" category="section-title">关于恢复计划</block>
  <block id="fd28cd9834ad3aa213c4fec2881064b5" category="paragraph">恢复计划定义了在同一过程中恢复的保护组。可以在同一恢复计划中配置多个保护组。此外，要为执行恢复计划提供更多选项，可以在多个恢复计划中包含一个保护组。</block>
  <block id="77aa84394124509e5e4006dcfd18789f" category="paragraph">通过恢复计划， SRM 管理员可以定义恢复工作流，方法是将 VM 分配给优先级组，优先级组从 1 （最高）到 5 （最低）不等，默认值为 3 （中等）。在优先级组中，可以为 VM 配置依赖关系。</block>
  <block id="030d749269f8866de516a551b0286001" category="paragraph">NetApp 强烈建议您与应用程序团队合作，了解故障转移场景中所需的操作顺序，并相应地构建恢复计划。</block>
  <block id="cebb1167d3e78885137c837f0abf8026" category="section-title">测试故障转移</block>
  <block id="6ae8acfc86f5df3426d525fb95767506" category="paragraph">NetApp 还建议偶尔确认子系统中的应用程序功能，尤其是在重新配置 VM 存储之后。</block>
  <block id="bd47371bcd8b3d08d6b4b15481b08d93" category="paragraph">执行测试恢复操作时，会在 ESXi 主机上为 VM 创建一个专用测试气泡网络。但是，此网络不会自动连接到任何物理网络适配器，因此不会在 ESXi 主机之间提供连接。为了允许在灾难恢复测试期间不同 ESXi 主机上运行的 VM 之间进行通信，在灾难恢复站点的 ESXi 主机之间创建了一个物理专用网络。要验证测试网络是否为专用网络，可以通过物理方式或使用 VLAN 或 VLAN 标记来隔离测试气泡网络。必须将此网络与生产网络隔离，因为在恢复 VM 后，不能将其放置在 IP 地址可能与实际生产系统冲突的生产网络上。在 SRM 中创建恢复计划时，可以选择创建的测试网络作为测试期间 VM 连接到的专用网络。</block>
  <block id="2be58fc410ddf2ba9c350135a617944a" category="paragraph">验证测试并使其不再需要后，请执行清理操作。运行清理会将受保护的 VM 恢复到其初始状态，并将恢复计划重置为就绪状态。</block>
  <block id="6f07b53963ee80903f0f13654de2cc3a" category="section-title">故障转移注意事项</block>
  <block id="9d33d94019b4a595a1ea232926a4da1b" category="paragraph">除了本指南中所述的操作顺序之外，在对站点进行故障转移时还需要考虑其他几个注意事项。</block>
  <block id="74abdd5cb502cd65bcf1d7ca484ab0c2" category="paragraph">您可能需要应对的一个问题描述是站点之间的网络差异。某些环境可能能够在主站点和灾难恢复站点使用相同的网络 IP 地址。此功能称为延伸型虚拟 LAN （ VLAN ）或延伸型网络设置。其他环境可能要求主站点使用与灾难恢复站点相对的不同网络 IP 地址（例如，在不同的 VLAN 中）。</block>
  <block id="9b8890fe5b1ab29543118b12a7bd0a07" category="inline-link-macro">SRM的NSX-T选项</block>
  <block id="25154023650451d6cc971fc54bff8898" category="paragraph">VMware 提供了多种方法来解决此问题。例如， VMware NSX-T Data Center 等网络虚拟化技术可从操作环境中将整个网络堆栈从第 2 层抽象为第 7 层，从而提供更便携的解决方案。了解更多信息 <block ref="3e6a2bd8e1acf69d423b7944c6543271" category="inline-link-macro-rx"></block>。</block>
  <block id="b56336aa967325217297d8725b64eb0b" category="inline-link-macro">VMware文档</block>
  <block id="d32598436410006707b2ad1d79395f02" category="paragraph">要将 SRM 配置为对多个 VM 应用不同的网络设置，而无需编辑恢复计划中每个 VM 的属性， VMware 提供了一个名为 dr-ip-customizer 的工具。要了解如何使用此实用程序、请参见 <block ref="837c7339284b78d4fd5550c5d0fb1a68" category="inline-link-macro-rx"></block>。</block>
  <block id="3c8c527afa8ce5009c8f707f7fd4fabf" category="section-title">重新保护</block>
  <block id="3b496038cb575fc404f8b0783e570f7a" category="paragraph">恢复后，恢复站点将成为新的生产站点。由于恢复操作中断了 SnapMirror 复制，因此新生产站点不会受到任何未来灾难的影响。最佳实践是，在恢复后立即将新生产站点保护到另一站点。如果原始生产站点正常运行， VMware 管理员可以使用原始生产站点作为新的恢复站点来保护新生产站点，从而有效地反转保护方向。只有在发生非灾难性故障时，才可重新保护。因此，原始 vCenter Server ， ESXi 服务器， SRM 服务器和相应的数据库最终必须可恢复。如果没有可用的保护组和新的恢复计划，则必须创建新的保护组和恢复计划。</block>
  <block id="2bf236f8aceaaff2b305848df524c42e" category="paragraph">从根本上说，故障恢复操作是指方向与以前不同的故障转移。作为最佳实践，在尝试故障恢复或换句话说，故障转移到原始站点之前，您应验证原始站点是否已恢复到可接受的功能级别。如果原始站点仍然受到影响，您应延迟故障恢复，直到故障得到充分修复为止。</block>
  <block id="cb03753531bad31391d7156433b98ae6" category="paragraph">另一个故障恢复最佳实践是，始终在完成重新保护之后以及执行最终故障恢复之前执行测试故障转移。此操作将验证原始站点上的系统是否可以完成此操作。</block>
  <block id="900a3b65ea54b6dcff72ed0d6ac66fdf" category="section-title">重新保护原始站点</block>
  <block id="12d059a2c7519f2e3497b30a71121503" category="paragraph">在故障恢复后运行重新保护实际上会使环境恢复到最初的状态，同时重新运行从生产站点到恢复站点的 SnapMirror 复制。</block>
  <block id="1a79eb278bc02ebdbd2ab32925e316f6" category="paragraph">使用适用于 VMware vSphere 的 NetApp ONTAP 工具进行软件工程时，需要执行以下安全开发活动：</block>
  <block id="39e5fc9eb192f011ab14dae6c2974c4e" category="list-text">威胁建模。 * 威胁建模的目的是在软件开发生命周期早期发现功能，组件或产品中的安全缺陷。威胁模型是影响应用程序安全性的所有信息的结构化表示。从本质上说，它是从安全性角度来看待应用程序及其环境的。</block>
  <block id="9f16ab3a50bca32d19c4729319035c8d" category="list-text">* 动态应用程序安全测试（ DAST ）。 * 此技术用于检测处于运行状态的应用程序上的易受到攻击的情况。Dast 会测试 Web 应用程序公开的 HTTP 和 HTML 接口。</block>
  <block id="267bed0525e4dab477e4c24ca5a1794e" category="list-text">* 第三方代码货币。 * 作为开源软件（ OSS ）软件开发的一部分，您必须解决可能与产品中包含的任何 OSS 相关的安全漏洞。这是一项持续努力，因为新的 OSS 版本可能会随时报告新发现的漏洞。</block>
  <block id="db7bc87c89c1ee76d313865a32fc0e06" category="list-text">* 漏洞扫描。 * 漏洞扫描的目的是在 NetApp 产品发布给客户之前检测其常见和已知安全漏洞。</block>
  <block id="1a4c104571630526efc77b84e82380fe" category="list-text">* 渗透测试。 * 渗透测试是指评估系统， Web 应用程序或网络以发现攻击者可能利用的安全漏洞的过程。NetApp 的渗透测试（笔测试）由一组经过批准且值得信赖的第三方公司执行。其测试范围包括使用复杂的利用方法或工具对与恶意入侵者或黑客类似的应用程序或软件发起攻击。</block>
  <block id="7e98fc3ea1ec077cfd1727a58e9c9020" category="section-title">产品安全功能</block>
  <block id="85d61648687f15050da0b86741b90358" category="paragraph">适用于 VMware vSphere 的 NetApp ONTAP 工具在每个版本中都包含以下安全功能。</block>
  <block id="dff88c2ef0b49b09246ffd6f9ec55195" category="list-text">默认情况下， * 登录横幅。 * SSH 处于禁用状态，如果从 VM 控制台启用，则仅允许一次性登录。用户在登录提示符中输入用户名后，将显示以下登录横幅：</block>
  <block id="399875025e8e96cc13102a4dd72f2434" category="paragraph">* 警告： * 禁止未经授权访问此系统，并将受到法律的起诉。访问此系统即表示您同意，如果怀疑未经授权使用，您的操作可能会受到监控。</block>
  <block id="2d8330ed99c80a842ffbd1362e038e5e" category="paragraph">用户通过SSH通道完成登录后、将显示以下文本：</block>
  <block id="677528ad13d460c058ac50e8a62092cf" category="list-text">* 基于角色的访问控制（ Role-Based Access Control ， RBAC ）。 * ONTAP 工具与两种类型的 RBAC 控制相关联：</block>
  <block id="ac38773d017495a97d5b88f242578cb8" category="list-text">原生 vCenter Server 特权</block>
  <block id="c2e2fce3a995f59900d7afbbe58683f5" category="inline-link">此链接。</block>
  <block id="31cedac82fef311cb790a12f96897223" category="list-text">vCenter 插件的特定特权。有关详细信息，请参见<block ref="e5f6920797dbff91ef59367270a82669" category="inline-link-rx"></block>。</block>
  <block id="5d32469f8a65b884a8f70abf95fe485a" category="list-text">* 加密通信通道。 * 所有外部通信均使用 TLS 1.2 版通过 HTTPS 进行。</block>
  <block id="600d4f98483fae8e58054f976d7e0c0e" category="list-text">* 最小端口暴露。 * 只有必要的端口在防火墙上处于打开状态。</block>
  <block id="0406f8902379502d1eba01f043c232b7" category="paragraph">下表介绍了打开的端口详细信息。</block>
  <block id="69fc9fe9cbb7709e97a433352aecf77d" category="cell">TCP v4/v6 端口号</block>
  <block id="02674a4ef33e11c879283629996c8ff8" category="cell">方向</block>
  <block id="86408593c34af77fdd90df932f8b5261" category="cell">功能</block>
  <block id="0c95054981de037de06e544a52eb3613" category="cell">8143.</block>
  <block id="a8e6fe5b9e68f30a146cefebaa7edcc3" category="cell">入站</block>
  <block id="d16c4afdc5f340936b747baf91efc843" category="cell">用于 REST API 的 HTTPS 连接</block>
  <block id="5bd529d5b07b647a8863cf71e98d651a" category="cell">8043</block>
  <block id="1f4deeb2f64336d4ff65ea3d2b4ffe2f" category="cell">HTTPS 连接</block>
  <block id="cb4b69eb9bd10da82c15dca2f86a1385" category="cell">9060</block>
  <block id="5852f8019b572f4cdef5bab783fa799f" category="cell">HTTPS 连接
用于基于 https 的 SOAP 连接
必须打开此端口、客户端才能连接到ONTAP工具API服务器。</block>
  <block id="b6d767d2f8ed5d21a44b0e5886680cb9" category="cell">22.</block>
  <block id="f4e339608b243f9b57b78ffaf061b498" category="cell">SSH （默认为禁用）</block>
  <block id="d82d678e9583c1f5f283ec56fbf1abb7" category="cell">9080</block>
  <block id="ef34781e03f49b5db5dd8fa267c4c41b" category="cell">HTTPS 连接— VP 和 SRA —仅从环回进行内部连接</block>
  <block id="a44ba9086b2b83ccf2baf7c678723449" category="cell">9083.</block>
  <block id="fe01ac95967cd8cb5f5b5669b685277a" category="cell">HTTPS 连接— VP 和 SRA
用于基于 https 的 SOAP 连接</block>
  <block id="abea47ba24142ed16b7d8fbf2c740e0d" category="cell">1162.</block>
  <block id="4a0724da5c6f4e4817663ae822550800" category="cell">VP SNMP 陷阱数据包</block>
  <block id="5cce8dede893813f879b873962fb669f" category="cell">1527.</block>
  <block id="91c15b8eb529bf2100c10383d1010a1e" category="cell">仅限内部</block>
  <block id="60135f95267c6e0711bf5a2858dfff2f" category="cell">Derby 数据库端口，仅在此计算机与自身之间，不接受外部连接—仅限内部连接</block>
  <block id="13f3cf8c531952d72e5847c4183e6910" category="cell">443.</block>
  <block id="1ef2b5426b0824e93e33753fa87ddbf5" category="cell">双向</block>
  <block id="e4b8a8d8761aab7733e317b585d5d606" category="cell">用于连接到 ONTAP 集群</block>
  <block id="bf6184406d1e18fffc86ecf770fbb391" category="inline-link">知识库文章</block>
  <block id="fedac49792829de4ff38fcf7a3846faa" category="list-text">* 支持证书颁发机构（ CA ）签名证书。 * 适用于 VMware vSphere 的 ONTAP 工具支持 CA 签名证书。请参见此内容<block ref="0903a062b2072644a9b744a7fece4216" category="inline-link-rx"></block> 有关详细信息 ...</block>
  <block id="9fca19988370da2a459b24505e9d23d5" category="list-text">* 审核日志记录。 * 支持包可以下载，并且非常详细。ONTAP 工具会将所有用户登录和注销活动记录在一个单独的日志文件中。VASA API 调用会记录在专用的 VASA 审核日志（本地 CXF.log ）中。</block>
  <block id="7d60a2806aedd934b75cce55d6693689" category="list-text">* 密码策略。 * 遵循以下密码策略：</block>
  <block id="f82f7513742f08b9d2784923213bdc75" category="list-text">密码不会记录在任何日志文件中。</block>
  <block id="83040c348e071499488a8128db207545" category="list-text">密码不会以纯文本形式传达。</block>
  <block id="bc319862df3312f423a50fece7730db9" category="list-text">密码是在安装过程本身期间配置的。</block>
  <block id="853c2ea85b86882d0ea73b606a9800a4" category="list-text">密码历史记录是一个可配置的参数。</block>
  <block id="b3d3877bc96752ae50a409c72597d47a" category="list-text">密码最短期限设置为 24 小时。</block>
  <block id="fb0bdec50022a37424a405b53da7c9c8" category="list-text">已禁用密码字段的自动完成。</block>
  <block id="3a04f054be8ad983ea82fd5079519810" category="list-text">ONTAP 工具使用 SHA256 哈希对所有存储的凭据信息进行加密。</block>
  <block id="46e61d6e7c848d43ddcede8efd36c3d8" category="doc">SnapCenter插件VMware vSphere</block>
  <block id="ae9e79ac4b60eba67cf1c7508417b42c" category="paragraph">适用于VMware vSphere的NetApp SnapCenter 插件软件工程部门使用以下安全开发活动：</block>
  <block id="b25a1098aff7d0c5ee590f1e1a114bb9" category="list-text">*动态应用程序安全测试(DAST)。*用于检测处于运行状态的应用程序上的易受到攻击的情况的技术。Dast 会测试 Web 应用程序公开的 HTTP 和 HTML 接口。</block>
  <block id="6cc1fee6b4fc48755d78e93170bbed93" category="list-text">*第三方代码货币。*在开发软件和使用开源软件(OSS)的过程中、解决可能与您的产品中所含的OSS相关的安全漏洞非常重要。这是一项持续努力、因为OSS组件的版本可能随时报告新发现的漏洞。</block>
  <block id="87bd0fb9b4198f33535e0e1888a809f5" category="list-text">*渗透测试。*渗透测试是指评估系统、Web应用程序或网络以发现攻击者可能利用的安全漏洞的过程。NetApp 的渗透测试（笔测试）由一组经过批准且值得信赖的第三方公司执行。其测试范围包括使用复杂的利用方法或工具对恶意入侵者或黑客等应用程序或软件发起攻击。</block>
  <block id="e3a3be4b4b04c5e0b6a5f1b5ea388380" category="list-text">*产品安全意外事件响应活动。*在公司内部和外部发现安全漏洞、如果不及时解决这些漏洞、可能会给NetApp€的声誉带来严重风险。为了便于执行此过程、产品安全意外事件响应团队(PSIRT)会报告并跟踪漏洞。</block>
  <block id="e91db3b3278f7bd95cc704d74c5c9597" category="paragraph">适用于VMware vSphere的NetApp SnapCenter 插件在每个版本中都包含以下安全功能：</block>
  <block id="4abd7d1d5d223683d3346671efb7e89c" category="list-text">*限制Shell访问。*默认情况下、SSH处于禁用状态、只有在从VM控制台启用一次性登录后、才允许进行此类登录。</block>
  <block id="8c264fa5ca2c588d960d98bd30cbc897" category="list-text">*登录横幅中显示访问警告。*用户在登录提示符中输入用户名后、将显示以下登录横幅：</block>
  <block id="0d6633ada3a9803e206b2359d859e892" category="paragraph">用户通过SSH通道完成登录后、将显示以下输出：</block>
  <block id="83e463bb73b12d9ca6e419327073c8a4" category="list-text">*基于角色的访问控制(Role-Based Access Control、RBAC)。*与NetApp ONTAP 工具关联的RBAC控制有两种：</block>
  <block id="b883bf79639dfce77e395b8458ee69e4" category="list-text">本机vCenter Server特权。</block>
  <block id="721796b1cb3468f0daf819180184d460" category="inline-link">基于角色的访问控制（ Role-Based Access Control ， RBAC ）</block>
  <block id="1d08c46b7567a29be0690a92b9722a58" category="list-text">VMware vCenter插件的特定特权。有关详细信息，请参见<block ref="f351263ad3706bd0a472039400dece78" category="inline-link-rx"></block>。</block>
  <block id="acab4c655c4a7b4db67fc07e22b86222" category="list-text">*加密通信通道。*所有外部通信均使用TLS通过HTTPS进行。</block>
  <block id="47a37e2d5fc8b7c936ad9b2b7a569a08" category="paragraph">下表提供了打开的端口详细信息。</block>
  <block id="10bd16a816f831080065e807daa36a9a" category="cell">TCP v4/v6端口号</block>
  <block id="edf0320adc8658b25ca26be5351b6c4a" category="cell">8144.</block>
  <block id="d4a973e303ec37692cc8923e3148eef7" category="cell">8080</block>
  <block id="2c25c3d66f80eeaa8d6e5a144c6f942e" category="cell">用于OVA GUI的HTTPS连接</block>
  <block id="14b3e670eec63cc0cc456fd904bbfbd9" category="cell">SSH (默认情况下处于禁用状态)</block>
  <block id="16fc18d787294ad5171100e33d05d4e2" category="cell">3306.</block>
  <block id="4cbf9c234f6b34c242a110cb993252bd" category="cell">MySQL (仅限内部连接；默认情况下、外部连接处于禁用状态)</block>
  <block id="29ab4efbdb7c727c81ee1382593bc5e2" category="cell">nginx (数据保护服务)</block>
  <block id="89f152cad33314315b4995ed1ca71535" category="inline-link">如何创建和/或将SSL证书导入到适用于VMware vSphere的SnapCenter 插件(SCV)</block>
  <block id="450adc59e39f23172756ac9369494a2d" category="list-text">*支持证书颁发机构(CA)签名证书。*适用于VMware vSphere的SnapCenter 插件支持CA签名证书的功能。请参见<block ref="9f83d87d5d9f604d96288df21d450fac" category="inline-link-rx"></block>。</block>
  <block id="05a1aa8021df4579874c4eeb8788e5c9" category="list-text">*密码策略。*以下密码策略有效：</block>
  <block id="2c87609dbbc3630573c64e271de8207d" category="list-text">所有凭据信息均使用SHA256哈希进行存储。</block>
  <block id="0f1a6fa0a65f9d5c3c4a16b070104d7a" category="list-text">*基本操作系统映像。*本产品随附Debian基础操作系统、用于OVA、但访问受限且Shell访问已禁用。这样可以减少攻击占用空间。每个SnapCenter 版本基础操作系统都会更新最新的安全修补程序、以最大限度地提高安全性。</block>
  <block id="83cd5867ba912e517fa1100299fd1cf3" category="paragraph">NetApp针对适用于VMware vSphere设备的SnapCenter 插件开发软件功能和安全修补程序、然后将其作为捆绑软件平台发布给客户。由于这些设备包括特定的Linux子操作系统依赖关系以及我们的专有软件、因此NetApp建议您不要更改子操作系统、因为这很可能会影响NetApp设备。这可能会影响NetApp支持此设备的能力。NetApp建议测试和部署我们最新的设备代码版本、因为发布这些代码版本是为了修补任何与安全相关的问题。</block>
  <block id="1bc6cee680286aae1b12889369b7f18a" category="summary">基于ONTAP的MySQL</block>
  <block id="dac8ea4fbfd87a535663c227b91f50e3" category="doc">I/O计划程序</block>
  <block id="215dca219378b291ae287eb076489fdd" category="paragraph">Linux内核允许对块设备的I/O计划方式进行低级控制。</block>
  <block id="dc36d23ef487690f1698c69d9e49cee2" category="paragraph">各种Linux发行版上的默认值差别很大。MySQL建议您使用<block ref="722d122e81cbbe543bd5520bb8678c0e" prefix=" " category="inline-code"></block> 或<block ref="30e482a8ab57cfc19075dece53b0a56b" prefix=" " category="inline-code"></block> 在Linux上具有本机异步I/O (AIO)的I/O计划程序。一般来说、使用NoOps时、NetApp客户和内部测试的结果会更好。</block>
  <block id="6def78482bd1915cb81f0f5c19ee8fe6" category="paragraph">MySQL的InnoDB存储引擎使用Linux上的异步I/O子系统(本机AIO)对数据文件页面执行预读和写入请求。此行为由控制<block ref="2c03186a22d036ce7dad84be5de2f2ce" prefix=" " category="inline-code"></block> 配置选项、默认情况下处于启用状态。使用本机AIO时、I/O计划程序的类型对I/O性能的影响更大。执行基准测试、确定哪个I/O计划程序可以为您的工作负载和环境提供最佳结果。</block>
  <block id="e7b09beaf26efc7d8bee91786cf794b5" category="paragraph">有关配置I/O计划程序的说明、请参见相关的Linux和MySQL文档。</block>
  <block id="6e8775bd755a8835ce86806d669677ea" category="doc">存储配置</block>
  <block id="2f09ac000b4a1808cb795b7bdbb20ecc" category="doc">InnoDB_log_file_size</block>
  <block id="b8674b2897b288ca55b74328df4780b3" category="paragraph">为InnoDB日志文件大小选择合适的大小对于写入操作以及在服务器崩溃后有适当的恢复时间非常重要。</block>
  <block id="b61bad6f7bf48bf9abda0c86c9beed79" category="paragraph">由于登录到该文件的事务太多、因此日志文件大小对于写入操作非常重要。修改记录后、所做的更改不会立即写入表空间。而是将更改记录在日志文件的末尾、并将页面标记为脏。InnoDB使用其日志将随机I/O转换为顺序I/O</block>
  <block id="e87d83a3c0af4df83efb4784b5182f8f" category="paragraph">日志已满时、脏页会按顺序写出到表空间中、以释放日志文件中的空间。例如、假设服务器在事务处理期间崩溃、而写入操作仅记录在日志文件中。在服务器恢复运行之前、它必须经过恢复阶段、在此阶段中、系统将重写记录在日志文件中的更改。日志文件中的条目越多、服务器恢复所需的时间就越长。</block>
  <block id="8321756b7fedf72543a1b0917bf92613" category="paragraph">在此示例中、日志文件大小会影响恢复时间和写入性能。在为日志文件大小选择正确的数字时、请平衡恢复时间与写入性能。通常、128 M到512 M之间的值都很好。</block>
  <block id="d4ae77cd65c244ceb4277b27553d6931" category="doc">基于ONTAP的MySQL数据库</block>
  <block id="598132a821e8cc696fbbae934047d991" category="paragraph">MySQL及其变体(包括MariaDB和Percona MySQL)是世界上最受欢迎的数据库。</block>
  <block id="478f00c3805e92ad9e8a7cd4f335a020" category="admonition">此ONTAP和MySQL数据库文档将取代先前发布的_TR-4722：《基于NetApp ONTAP的MySQL数据库最佳实践》。_</block>
  <block id="35701e1bcd40c8e1a520fc33d0e14842" category="doc">INNODB_FLUG_METHOD</block>
  <block id="138738e11d5fda5c496edaa92e32e158" category="paragraph">InnoDB_flush_方法 参数用于指定InnoDB如何打开和刷新日志和数据文件。</block>
  <block id="c262c8cd82b96f69fbbc058d7a35683b" category="section-title">优化</block>
  <block id="d1e67ebe6122765789852eb430c42c75" category="paragraph">在InnoDB优化中、如果适用、设置此参数会调整数据库性能。</block>
  <block id="51ca63a7fb332d4d18e7139ea5787c50" category="paragraph">以下选项用于通过InnoDB转储文件：</block>
  <block id="a9b8d4c72b58a9554274cba7904d47e2" category="list-text"><block ref="e590322920bebc1156ab585bd6597d76" prefix="" category="inline-code"></block>。InnoDB使用<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 系统调用以刷新数据和日志文件。此选项为默认设置。</block>
  <block id="8198b1fd4bf2fafa4f4e8ffb4a8ac900" category="list-text"><block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix="" category="inline-code"></block>。InnoDB使用<block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix=" " category="inline-code"></block> 选项打开并刷新日志文件，并使用fsync()刷新数据文件。InnoDB不使用<block ref="a48be70a21bca2cf4b3e481efed66ae4" prefix=" " category="inline-code"></block> 这是因为在许多UNIX版本上都存在问题。</block>
  <block id="f89f9147df5dde99a7944d2028b59e7e" category="list-text"><block ref="6a334fd488ef92b18584207148410cc4" prefix="" category="inline-code"></block>。InnoDB使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 选项(或<block ref="42d27f470f62deaad644fef8618b59bb" prefix=" " category="inline-code"></block> 在Solaris上)以打开数据文件并使用<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 刷新数据和日志文件。此选项在某些版本的GNU或Linux、FreEBSD,和Solaris上可用。</block>
  <block id="5e90100e134d805a66f8cda2e73f5298" category="list-text"><block ref="d66655d6d13113f23421f282ed1eaeb7" prefix="" category="inline-code"></block>。InnoDB使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 选项；但是、它会跳过<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 系统调用。此选项不适用于某些类型的文件系统(例如XFS)。如果不确定文件系统是否需要<block ref="4d0b2ade287f8f35e993511729bc75a1" prefix=" " category="inline-code"></block> 系统调用(例如、要保留所有文件元数据)、请使用<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 选项。</block>
  <block id="c680d437163cc6bab4f9bdb35c3073d0" category="section-title">观察结果</block>
  <block id="907dee0040812e8e7d1fd00b870b5063" category="paragraph">在NetApp实验室测试中、<block ref="e590322920bebc1156ab585bd6597d76" prefix=" " category="inline-code"></block> NFS和SAN上使用了默认选项、与相比、这是一个非常好的性能提升<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block>。将刷新方法用作时<block ref="6a334fd488ef92b18584207148410cc4" prefix=" " category="inline-code"></block> 通过使用ONTAP、我们发现客户端会以串行方式在4096块的边界处写入大量单字节写入。这些写入会增加网络延迟并降低性能。</block>
  <block id="2f0b9319cf6d59e07ea4b1ef65a12be1" category="doc">open_file_极限 值</block>
  <block id="11e52b21a9795b7dcf947027b0ec5d01" category="paragraph">。<block ref="2f0b9319cf6d59e07ea4b1ef65a12be1" prefix=" " category="inline-code"></block> 参数用于确定操作系统允许myqld打开的文件数。</block>
  <block id="e0732f22b2900006e8fcb6367fd162f7" category="paragraph">运行时此参数的值是系统允许的实际值、可能与服务器启动时指定的值不同。在MySQL无法更改打开文件数量的系统上、此值为0。有效<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 值基于系统启动时指定的值(如果有)和的值<block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix=" " category="inline-code"></block> 和<block ref="023a3b50ddf424c9a1d51984190a0c92" prefix=" " category="inline-code"></block> 使用以下公式：</block>
  <block id="6b840ff0a7667f4642a0844269657fc4" category="list-text">10 +<block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix=" " category="inline-code"></block> + <block ref="023a3b50ddf424c9a1d51984190a0c92" prefix="(" category="inline-code"></block> x 2)</block>
  <block id="d3de183489c20b8efa2947eeff3028d7" category="list-text"><block ref="0bc91339c0d774f560a9a38fc9dfac30" prefix="" category="inline-code"></block> x 5.</block>
  <block id="2c08922fbaba089e7c2982df43fd352a" category="list-text">操作系统限制(如果为正数)</block>
  <block id="8ca153937fcbdf56497ad779a91f31d1" category="list-text">如果操作系统限制为无限大：<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 值在启动时指定；如果无、则为5、000</block>
  <block id="98038bb4026a70f5ee4041522c6eebe4" category="paragraph">服务器将尝试使用这四个值中的最大值来获取文件描述符数量。如果无法获取多个描述符、则服务器会尝试获取系统允许的多个描述符。</block>
  <block id="3ee58d04a0dc9b2551698643e0421005" category="doc">InnoDB_LRU_SCAN_深度</block>
  <block id="29d0f4f8b383d39e73abd11ac73ca28a" category="paragraph">。<block ref="3ee58d04a0dc9b2551698643e0421005" prefix=" " category="inline-code"></block> 参数会影响InnoDB缓冲池的刷新操作的算法和启发式。</block>
  <block id="eeb16232629bd788f0d29c104105bba2" category="paragraph">调整I/O密集型工作负载的性能专家主要关注此参数。对于每个缓冲池实例、此参数用于指定页面清理程序线程应继续扫描的最近最少使用(Least Recently Used、LRU)页面列表中的下限、以查找要刷新的脏页面。此后台操作每秒执行一次。</block>
  <block id="39359bf2914e4e1cf84a9dea580fd20a" category="paragraph">您可以向上或向下调整该值、以最大程度地减少可用页数。不要将该值设置得比所需值高得多、因为扫描会产生显著的性能成本。此外、请考虑在更改缓冲池实例数时调整此参数、因为<block ref="f2c8312d381c16c6c95a727c3f61a4c7" prefix=" " category="inline-code"></block> 定义页面清理程序线程每秒执行的工作量。</block>
  <block id="513a275422fae2456617321a2f3fc0af" category="paragraph">小于默认值的设置适用于大多数工作负载。只有在典型工作负载下具有备用I/O容量时、才应考虑增加此值。相反、如果写入密集型工作负载使I/O容量饱和、请减小该值、尤其是在缓冲池较大的情况下。</block>
  <block id="62812b938ba1113b81bd7f612ad0e6f8" category="doc">InnoDB_buffer_pool_size</block>
  <block id="d7a8b502d05f5e477158eb80c1fb8dae" category="paragraph">InnoDB缓冲池是任何调整活动最重要的部分。</block>
  <block id="5cb6c45d18482180f34ae727b53379fb" category="paragraph">InnoDB在很大程度上依赖于缓冲区池来缓存索引并对数据、自适应哈希索引、插入缓冲区以及内部使用的许多其他数据结构进行分段。缓冲池还会缓冲对数据的更改、以便不必立即对存储执行写入操作、从而提高性能。缓冲池是InnoDB不可或缺的一部分、必须相应地调整其大小。设置缓冲池大小时、请考虑以下因素：</block>
  <block id="03f07291794c3b9cb00d04cb9f30be81" category="list-text">对于仅限InnoDB的专用计算机、请将缓冲池大小设置为可用RAM的80%或更多。</block>
  <block id="7b0119b7fa59f87d23d5c65da456b226" category="list-text">如果它不是MySQL专用服务器、请将大小设置为RAM的50%。</block>
  <block id="a6a9695e1464f5554c0006c55facfadf" category="doc">文件描述符</block>
  <block id="8e222c68dd214db9f8a1b5b572ee6267" category="paragraph">它使用这些表来打开新连接、将表存储在缓存中、创建临时表以解决复杂的查询、以及访问永久性查询。如果myqld无法在需要时打开新文件、则它可能会停止正常运行。此问题描述的一个常见现象是错误24："打开的文件太多"。 可以同时打开的文件描述符myqld的数量由定义<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 在配置文件中设置的选项 <block ref="86d0d007043d911697753b35e2c18f35" prefix="(" category="inline-code"></block>）。但是<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 也取决于操作系统的限制。这种依赖关系使变量的设置变得更加复杂。</block>
  <block id="07561a91f81dfe3c8e4364aac8bdbea4" category="paragraph">MySQL无法设置它<block ref="3d39e9c5aa2f78830dd6993cec18e93e" prefix=" " category="inline-code"></block> 选项高于下指定的值<block ref="dd1c6d8164dfd1cee0afa39b177e843b" prefix=" " category="inline-code"></block>。因此、您需要在操作系统级别明确设置这些限制、以使MySQL能够根据需要打开文件。有两种方法可在Linux中检查文件限制：</block>
  <block id="84e705ac120a887df441f4161dc29409" category="list-text">。<block ref="2eabb4efed7dffb32ea1170eab71b798" prefix=" " category="inline-code"></block> Command快速为您提供有关允许或锁定的参数的详细问题描述。运行此命令所做的更改不是永久的、将在系统重新启动后擦除。</block>
  <block id="a4c404dc92855948bc4c007a86091dbe" category="list-text">对进行的更改<block ref="b803f460349bd101b1de260021ef0e60" prefix=" " category="inline-code"></block> 文件是永久文件、不受系统重新启动的影响。</block>
  <block id="cbcab8220d4ffddbdc44f9936125d83d" category="paragraph">确保更改用户myql的硬限制和软限制。以下摘录来自此配置：</block>
  <block id="97dc47f90c600a96fac6642560ffaceb" category="paragraph">同时、在中更新相同的配置<block ref="90f16be5b82ca0aa94088c89fe00b3dd" prefix=" " category="inline-code"></block> 以充分利用打开文件的限制。</block>
  <block id="395ec860c9530814e94538b7121a8319" category="doc">INNODB_FLOG_AT_TRx_Commit</block>
  <block id="2f2c7742844f13de59d435b9099c78cc" category="paragraph">数据发生更改时、更改不会立即写入存储。</block>
  <block id="0b36b8f791a48c7b4692e7df069dabc8" category="paragraph">相反、数据会记录在日志缓冲区中、日志缓冲区是InnoDB分配给缓冲区的内存的一部分、用于缓冲日志文件中记录的更改。在提交事务时、缓冲区已满时或每秒一次(以先发生的事件为准)、InnoDB会将缓冲区转至日志文件。用于控制此过程的配置变量为InnoDB_F冲_LOG_AT_TRx_commit。值选项包括：</block>
  <block id="280a38864b81c14ba3db52801e087ed0" category="list-text">设置时<block ref="cab9a35054c49f0ba619a6e6943f461b" prefix=" " category="inline-code"></block>，InnoDB会将修改后的数据(位于InnoDB缓冲池中)写入日志文件(ib_logfile)，并每秒刷新日志文件(写入存储)。但是、提交事务时、它不会执行任何操作。如果发生电源故障或系统崩溃、则未转储的数据都不可恢复、因为它不会写入日志文件或驱动器。</block>
  <block id="5967bb5566cb7cd8bdb0b372ceb21565" category="list-text">设置时<block ref="1ab7a7611b59147e84a38b6f3e7d9d09" prefix=" " category="inline-code"></block>，则InnoDB会将日志缓冲区写入事务日志，并将每个事务转储到持久存储。例如、对于所有事务提交、InnoDB先写入日志、然后再写入存储。存储速度较慢会对性能产生负面影响；例如、每秒InnoDB事务数会减少。</block>
  <block id="9e9b3a43cb7a1b13c5ee3f6519d7f60e" category="list-text">设置时<block ref="44d4dfee9b1c95f8768bec989cd3baf5" prefix=" " category="inline-code"></block>，InnoDB会在每次提交时将日志缓冲区写入日志文件；但是，它不会将数据写入存储。InnoDB每秒刷新一次数据。即使出现电源故障或系统崩溃、选项2数据也会显示在日志文件中、并且可以恢复。</block>
  <block id="14f3e0328e25aa02b37bd6817a442a58" category="paragraph">如果性能是主要目标、请将该值设置为2。由于InnoDB每秒向驱动器写入一次、而不是每次提交事务、因此性能会显著提高。如果发生电源故障或崩溃、可以从事务日志中恢复数据。</block>
  <block id="4a34cbb1957909093a2e216fc1cd0962" category="paragraph">如果数据安全是主要目标、请将该值设置为1、以便每次提交事务时、InnoDB都会转至驱动器。但是、性能可能会受到影响。</block>
  <block id="53be3047aa6f8a62c640cc8b4d6089c6" category="admonition">* NetApp建议*将InnoDB_F冲_LOG_TRx_commit值设置为2以提高性能。</block>
  <block id="2199371f8380c97ad11a03fba3b501c9" category="doc">InnoDB_IO_Capacity</block>
  <block id="ac165f23bb7435219b226ed6e76c5fa4" category="paragraph">在InnoDB插件中、从MySQL 5.7中添加了一个名为InnoDB_io_Capacity的新参数。</block>
  <block id="b4f38c42ef968074288f239b42e92b7f" category="paragraph">它控制InnoDB执行的最大IOPS数(包括异常页面的转储速率以及插入缓冲区[ibuf]批大小)。InnoDB_IO_Capacity参数可通过InnoDB后台任务(例如从缓冲区池转储页面以及合并更改缓冲区中的数据)设置IOPS上限。</block>
  <block id="9679a08c293f29d9546c42207b09d418" category="paragraph">将InnoDB_IO_Capacity参数设置为系统每秒可执行的大约I/O操作数。理想情况下、应尽可能降低设置值、但不要太低、以免后台活动减慢。如果设置值过高、则会从缓冲池中删除数据、并且插入缓冲区的速度过快、无法缓存、因此无法提供显著优势。</block>
  <block id="668b6acc98c3469094062ed50b43e43a" category="admonition">* NetApp建议*如果通过NFS使用此设置、则分析IOPS (Sysbench/FIO)的测试结果并相应地设置参数。除非您在InnoDB缓冲池中看到的已修改或脏页面多于所需数量、否则请使用可能的最小值进行转储和清除以保持最新。</block>
  <block id="038b11d42ee14bd77b6370c575c63b16" category="admonition">请勿使用极值(如20、000或更多)、除非您已证明较低的值不足以满足工作负载要求。</block>
  <block id="62385f5ceb285bca676cb0561555d719" category="paragraph">InnoDB_IO_Capacity参数用于调节转储速率和相关I/O</block>
  <block id="c957ef06af970a7526a73e741b47fef1" category="admonition">如果将此参数或InnoDB_IO_capity_max参数设置得过高、并因过早转储而浪费I/O操作、可能会严重影响性能。</block>
  <block id="d32067c550345cae14e678b4def6aa22" category="doc">基于SAN的MySQL</block>
  <block id="b238d5dd75fe5ed855c5b3047e074050" category="paragraph">使用通常的双卷模式为MySQL配置SAN有两种选择。</block>
  <block id="58d94bb6e53e154e2f4b16efa09f4c0d" category="paragraph">只要I/O和容量需求不超过单个LUN文件系统的限制、就可以将较小的数据库放置在一对标准LUN上。例如、需要大约2K随机IOPS的数据库可以托管在单个LUN上的单个文件系统上。同样、大小仅为100 GB的数据库可以容纳在一个LUN上、而不会产生管理问题。</block>
  <block id="c33bcb4f520265bb106616e844397ffb" category="paragraph">大型数据库需要多个LUN。例如、需要100K IOPS的数据库最有可能至少需要八个LUN。由于驱动器的SCSI通道数量不足、单个LUN将成为瓶颈。同样、在一个10 TB LUN上管理一个10 TB数据库也很困难。逻辑卷管理器旨在将多个LUN的性能和容量功能绑定在一起、以提高性能和易管理性。</block>
  <block id="428e88a1415b00f5eb396829b4bd9a2c" category="paragraph">在这两种情况下、一对ONTAP卷都应足以满足要求。在简单的配置中、数据文件LUN会像日志LUN一样放置在一个专用卷中。使用逻辑卷管理器配置时、数据文件卷组中的所有LUN都将位于一个专用卷中、而日志卷组的LUN将位于另一个专用卷中。</block>
  <block id="e8c31916b755be39cb0a66804a1d8f8b" category="paragraph">*MySQL建议*在SAN上部署NetApp时使用两个文件系统：</block>
  <block id="fe9d8ca2c46747e16ed31f64638e66e6" category="list-text">第一个文件系统存储所有MySQL数据、包括表空间、数据和索引。</block>
  <block id="04d82ed32fa1eeaa6df117c178062441" category="list-text">第二个文件系统存储所有日志(二进制日志、慢速日志和事务日志)。</block>
  <block id="15bcb76b7e8b441c0d2a6e723f70c20c" category="paragraph">以这种方式分隔数据有多种原因、包括：</block>
  <block id="02774797d31a8f1c6d805860038c32a3" category="list-text">数据文件和日志文件的I/O模式不同。如果将它们分开、则可以使用QoS控制提供更多选项。</block>
  <block id="6cab2c793e807e2d0c57f5b0d96505c1" category="list-text">要充分利用Snapshot技术、需要能够独立还原数据文件。将数据文件与日志文件相结合会影响数据文件还原。</block>
  <block id="553ad1f7b6f5cfee021e5cf56e56a289" category="list-text">NetApp SnapMirror技术可用于为数据库提供简单的低RPO灾难恢复功能；但是、它需要为数据文件和日志制定不同的复制计划。</block>
  <block id="ff5f52a69a35dd41da3e3c4b810e4f94" category="admonition">使用此基本的双卷布局可使解决方案适应未来需要、以便在需要时可以使用所有ONTAP功能。</block>
  <block id="7b755794e9de5716b2d6305bd10bee1b" category="paragraph">* NetApp建议*使用ext4文件系统格式化驱动器，因为它具有以下功能：</block>
  <block id="fa92f58d5035dec5e24a787f76504783" category="list-text">日志文件系统(jfs)中使用的块管理功能的扩展方法以及扩展文件系统(xfs)的延迟分配功能。</block>
  <block id="a72d73cde02c10703b72dcae6bc7c812" category="list-text">ext4允许文件系统最多包含1个外部字节(2^60字节)、文件最多包含16个TB (16 * 2^40字节)。相比之下、ext3文件系统仅支持最大文件系统大小16 TB和最大文件大小2 TB。</block>
  <block id="56b4168424fa999bc383d24daf2da4eb" category="list-text">在ext4文件系统中、多块分配(mbALLO每次 操作)会为一个文件分配多个块、而不是像ext3那样逐个分配。此配置可减少多次调用块分配器的开销、并优化内存分配。</block>
  <block id="632635d22b347f0140fb15d0eb0ed09e" category="list-text">虽然XFS是许多Linux分发版的默认设置、但它管理元数据的方式不同、不适用于某些MySQL配置。</block>
  <block id="aff8b2ed0a4719f014e5baeb861ea7d4" category="paragraph">* NetApp建议*在mkfs实用程序中使用4k块大小选项、以便与现有块LUN大小保持一致。</block>
  <block id="0a24d0336b7b0b29a9daa97f88499884" category="paragraph"><block ref="018d13c1d8b9abcae080b8abbc7c2d8b" prefix="" category="inline-code"></block></block>
  <block id="86fc8cb3bf2cae621315896a94b35f67" category="paragraph">NetApp LUN将数据存储在4 KB物理块中、从而生成八个512字节逻辑块。</block>
  <block id="5f441ceabc94de2a9cced94d9f53a2d0" category="paragraph">如果未设置相同的块大小、I/O将无法与物理块正确对齐、并且可能会在RAID组中的两个不同驱动器中写入数据、从而导致延迟。</block>
  <block id="236ac851d05b8822524001920948f23d" category="admonition">请务必对齐I/O、以实现顺畅的读/写操作。但是、如果I/O从逻辑块开始、而逻辑块不是物理块的起始位置、则表示I/O未对齐。只有当I/O操作从逻辑块(即物理块中的第一个逻辑块)开始时、才会对齐。</block>
  <block id="282155126a94a0702cfd80daf38d4362" category="doc">配置概述</block>
  <block id="3225a10b07f1580f10dee4abc3779e6c" category="cell">Parameters</block>
  <block id="c82a6100dace2b41087ba6cf99a5976a" category="cell">值</block>
  <block id="b10db909b8fda84e70bf9b308d0938d9" category="cell">256 M</block>
  <block id="c81e728d9d4c2f636f067f89cc14862c" category="cell">2.</block>
  <block id="7ccc31934ae8244d8263d3c09bcee186" category="cell">InnoDB_doublewite</block>
  <block id="e590322920bebc1156ab585bd6597d76" category="cell">同步</block>
  <block id="adb0c1ec32461889a5093441599260eb" category="cell">11g</block>
  <block id="774412967f19ea61d448977ad9749078" category="cell">8192.</block>
  <block id="311887a53ec7390fc383fa2ad813f012" category="cell">InnoDB_buffer_pool_instances</block>
  <block id="c9f0f895fb98ab9159f51fd0297e236d" category="cell">8.</block>
  <block id="1006f82d8df7d2325439b28ea691737c" category="cell">open_file_Limit</block>
  <block id="3c9b5f1cd6a030bcb7bed9eac80589fb" category="cell">65535</block>
  <block id="c9f5a4d3ede4d084dda0a788ed06783c" category="paragraph">要设置本节中所述的参数、必须在MySQL配置文件(my.cnf)中进行更改。NetApp最佳实践是内部测试的结果。</block>
  <block id="6a554ff1dc93539a626e576bf0d28a02" category="paragraph">MySQL数据库容器化正在变得越来越普遍。</block>
  <block id="bcc002a9f2e2ade112438f50a6630498" category="paragraph">底层容器管理几乎始终通过Docker来执行。OpenShift和Kubnetes等容器管理平台使大型容器环境的管理变得更加简单。容器化的优势包括降低成本、因为无需为虚拟机管理程序授予许可证。此外、容器还允许多个数据库彼此隔离运行、同时共享同一个底层内核和操作系统。容器只需几微秒即可完成配置。</block>
  <block id="14d9b10c6196045941347a9e85704b50" category="inline-link-macro">Astra Trident 文档</block>
  <block id="d4f640fe6950a1baff001f5601c7fbd7" category="paragraph">NetApp提供了Asta三项功能来提供高级存储管理功能。例如、Asta三元数据可以使在Kubnetes中创建的容器自动在相应层上配置其存储、应用导出策略、设置NetApp Snapshot副本策略、甚至可以将一个容器克隆到另一个容器。对于追加信息，请参见 <block ref="2b8a155fc083396b96b18cee0ba5eab0" category="inline-link-macro-rx"></block>。</block>
  <block id="b8c3891a902a70c4f7f774363652f4b4" category="summary">MySQL文件结构</block>
  <block id="5713a921d815fd7d19875846450f8ea8" category="doc">文件结构</block>
  <block id="4955922857da5499a2f1be602a96b0ff" category="paragraph">InnoDB充当存储和MySQL服务器之间的中间层、它将数据存储到驱动器。</block>
  <block id="8a6fab0b8bb36427eda4071adfd7780b" category="inline-image-macro">错误：未找到图形图像</block>
  <block id="5d416cf65dd1e2c908bf430f957c89f8" category="paragraph">MySQL I/O分为两类：</block>
  <block id="e8a320970c929abda9ae744b0b9e8f5f" category="list-text">随机文件I/O</block>
  <block id="85430c0aa096ec282f2a14156baa312e" category="list-text">顺序文件I/O</block>
  <block id="b7b9a4c6983139a2673988826094a3cf" category="paragraph">数据文件会随机读取和覆盖、从而导致IOPS较高。因此、建议使用SSD存储。</block>
  <block id="322f79fd77365edecd173807cb429ca2" category="paragraph">重做日志文件和二进制日志文件是事务日志。它们会按顺序写入、因此、您可以通过写入缓存在HDD上获得良好的性能。恢复时会发生顺序读取、但很少会导致性能问题、因为日志文件大小通常小于数据文件、顺序读取比随机读取(发生在数据文件上)速度快。</block>
  <block id="a898d206a27508975fea2e241af2f04e" category="paragraph">双写缓冲区是InnoDB的一项特殊功能。InnoDB首先将已刷新的页面写入双写入缓冲区、然后将这些页面写入数据文件上的正确位置。此过程可防止页面损坏。如果没有双写入缓冲区、则在向驱动器写入的过程中发生电源故障时、页面可能会损坏。由于写入双写入缓冲区是顺序的、因此针对HDD进行了高度优化。恢复时进行顺序读取。</block>
  <block id="363512900e45bc17bdd6edfa50582862" category="paragraph">由于ONTAP NVRAM已提供写入保护、因此不需要双写缓冲。MySQL有一个参数、<block ref="02d3c518a4019ea00e34e16491d826b4" prefix=" " category="inline-code"></block>，禁用双写缓冲区。此功能可以显著提高性能。</block>
  <block id="49a7df723922bddb4df4002b51087a1c" category="paragraph">插入缓冲区也是InnoDB的一项特殊功能。如果内存中不存在非唯一的二级索引块、则InnoDB会将条目插入到插入缓冲区中、以避免随机I/O操作。插入缓冲区会定期合并到数据库中的二级索引树中。插入缓冲区通过将I/O请求合并到同一个块来减少I/O操作的数量；随机I/O操作可以是顺序的。插入缓冲区也针对HDD进行了高度优化。正常操作期间会同时进行顺序写入和读取。</block>
  <block id="6a0190340f27f29279bbfd319800289d" category="paragraph">撤消段是随机I/O导向的。为了保证多版本并发(MVCC)，InnoDB必须在撤消段中注册旧图像。从撤消段读取以前的图像需要随机读取。如果您运行具有可重复读取的长事务(例如、myq_dump—单个事务)或运行长查询、则可能会发生随机读取。因此、在这种情况下、最好在SSD上存储撤消区块。如果只运行短事务或查询、则随机读取不是问题描述。</block>
  <block id="a27e0d4b650aa6db30fdd95b54c94b27" category="paragraph">*由于InnoDB I/O的特性、NetApp建议*采用以下存储设计布局。</block>
  <block id="defc1bfda928f419df5e4af79c98343e" category="list-text">一个卷、用于存储面向MySQL的随机和顺序I/O文件</block>
  <block id="7fd750411093ebd1faa0d99dd2608514" category="list-text">另一个卷、用于存储MySQL的纯顺序I/O导向文件</block>
  <block id="0561a3b014eef0e5125fa63e1626cf57" category="paragraph">此布局还有助于您设计数据保护策略和策略。</block>
  <block id="9166d970028a28a614af39e6286371b7" category="paragraph">您可以使用关闭此参数<block ref="8cafbd8d9096941261e87f4f9152ab92" prefix=" " category="inline-code"></block> 适用于基准测试、或者您更关心最高性能而非数据完整性或可能出现的故障。InnoDB使用一种称为双写的文件转储技术。在将页面写入数据文件之前、InnoDB会将其写入一个称为双写入缓冲区的连续区域。在完成对双写缓冲区的写入和刷新后、InnoDB会将页面写入到其在数据文件中的正确位置。如果操作系统或myqld进程在页面写入期间崩溃、则InnoDB稍后可以在崩溃恢复期间从双写入缓冲区中找到一个良好的页面副本。</block>
  <block id="3dfd4b9a526f8a8cf17021e34638b375" category="admonition">* NetApp建议*禁用双写缓冲区。ONTAP NVRAM具有相同的功能。双重缓冲会不必要地损害性能。</block>
  <block id="dd5a2a602f713562e0f9f0fd8385660e" category="doc">基于NFS的MySQL</block>
  <block id="0e5e83102103fcdd25af430bf7327034" category="paragraph">MySQL文档建议您在NAS部署中使用NFSv4。</block>
  <block id="ca0d9fdc80b88e73b548638af421788f" category="section-title">ONTAP NFS传输大小</block>
  <block id="efcd0ba3fcbee9896a25804677e70b4b" category="paragraph">默认情况下、ONTAP会将NFS IO大小限制为64K。MySQL数据库的随机IO使用的块大小要小得多、远远低于64K的最大值。大型块IO通常会并行运行、因此最大64K也不是一个限制。</block>
  <block id="4655f686de75b23f16d530ed7351c447" category="paragraph">在某些工作负载中、最大64K会产生限制。特别是、如果数据库执行的IO数量较少而规模较大、则单线程操作(如完整表扫描备份操作)将更快、更高效地运行。具有数据库工作负载的ONTAP的最佳IO处理大小为256 K。下面列出的适用于特定操作系统的NFS挂载选项已相应地从64K更新为256K。</block>
  <block id="3ab93db30f3dded2c8d71859afbb53f6" category="admonition">请勿将ONTAP上允许的最大传输大小减小到低于当前挂载的NFS文件系统的rsize/wsize值。在某些操作系统中、这可能会导致挂起甚至数据损坏。例如、如果NFS客户端当前设置为rsize/wsize 65536,则ONTAP最大传输大小可以在65536- 1048576之间进行调整,但不会产生任何影响,因为客户端本身是有限的。将最大传输大小减小至65536,可能会损坏可用性或数据。</block>
  <block id="5ea0bb5d4dab46d7971fef94ccde9369" category="paragraph">* NetApp建议使用*</block>
  <block id="09c6aa928c90ba68a4e03deadfeaa644" category="paragraph">设置以下NFSv4 fstab (/etc/fstab)设置：</block>
  <block id="0ae3c9648bc2d8c33fa57415604da370" category="paragraph"><block ref="a63a3dc825ff52908de7c9dfcb29ffa5" prefix="" category="inline-code"></block></block>
  <block id="3e0b2c100b093560f63ad57c6849bc8a" category="admonition">NFSv3的一个常见问题描述是断电后锁定的InnoDB日志文件。使用时间或切换日志文件解决了此问题描述。但是、NFSv4具有锁定操作、并可跟踪打开的文件和委派。</block>
  <block id="62e4eb800d20b46085ccb975da78bafe" category="sidebar">ONTAP是许多企业级应用程序和数据库技术的数据管理和数据保护基础。以下几页提供了有关ONTAP以及企业级应用程序和基础架构的最佳实践和实施过程的指导。</block>
  <block id="78898e52fcbdc5337204a384f2456d4f" category="sidebar">Microsoft SQL Server</block>
  <block id="4f60acc41a8bf3fa75e7f74768637787" category="sidebar">Microsoft SQL Server数据保护</block>
  <block id="b8529ff730dcf8dd2178d72de271dc4d" category="sidebar">开源数据库</block>
  <block id="bb9a5a6fadabab849d2e87f0898d7601" category="sidebar">基于ONTAP的MariaDB和MySQL</block>
  <block id="5ad2a11eceac3ebd7cbf3b534ebdb1db" category="sidebar">ONTAP上的PostgreSQL</block>
  <block id="c30dd1a85cf86d95b11c1a08f70130ce" category="sidebar">Oracle 数据库</block>
  <block id="4948dede9f4e7c3dfe48c38f7902f6e5" category="sidebar">基于ONTAP的Oracle</block>
  <block id="d71074394b511143c8d1108e74a81abb" category="sidebar">Oracle数据保护</block>
  <block id="f4d8825927d11df25770df5e00d6a52e" category="sidebar">Oracle迁移</block>
  <block id="86083f3ea21c2385b4f013aae3c57858" category="sidebar">SAP HANA</block>
  <block id="677f2e7e550075f7bbbdac91e0918f2f" category="sidebar">SAP 解决方案</block>
  <block id="1b83f2b1c0b7fb3af048c2a59624fe3b" category="sidebar">采用AFF和FC的SAP HANA</block>
  <block id="6ab3c3f05076d213f0b1feff267607c6" category="sidebar">采用AFF和NFS的SAP HANA</block>
  <block id="56079badd056a19303cc26e6a4fcc7e0" category="sidebar">VMware</block>
  <block id="f07084a11252c9bca97503ea9a627c89" category="sidebar">使用ONTAP的虚拟卷(Virtual Volume、Virtual Volume、Virtual Volume、Virtual Volume)</block>
  <block id="2d90ac09cbf108bddad31dd341f8614e" category="sidebar">采用ONTAP的VMware Site Recovery Manager</block>
  <block id="b0dae11b82e63781abdc8f893c41b3c0" category="sidebar">企业级应用程序</block>
  <block id="999bc6b18351bbe817d26f559ba408ae" category="sidebar">SAP</block>
  <block id="2d2eef88dbdd0c34bde24e2632d9944f" category="sidebar">SAP HANA和AnyDB</block>
  <block id="399bd1ee587245ecac6f39beaa99886f" category="sidebar">PostgreSQL</block>
  <block id="f4f70727dc34561dfde1a3c529b6205c" category="sidebar">设置</block>
  <block id="c476a4701643b158f9f5d57bcc91951d" category="sidebar">Snapshot技术</block>
  <block id="35084d885dea7b061e6894c1cf3036d9" category="sidebar">工作负载</block>
  <block id="7d219314ccabde6609510141bb175a6c" category="sidebar">共享实例与专用实例</block>
  <block id="d5363ae19ecaede49e2ced297df7737a" category="sidebar">内存配置</block>
  <block id="500c09aa1bb9af431f2c18348e69bfd0" category="sidebar">tempdb文件</block>
  <block id="6fb6843bd9a214011969c02729c7d671" category="sidebar">存储注意事项</block>
  <block id="4c5d94eb4dc4bff93f6a96a08ab7b244" category="sidebar">数据安全性</block>
  <block id="cf91513c6fc63cebe4b63a6647238d6d" category="sidebar">RAID</block>
  <block id="83db97189c47f7bb4edd879e8756f6e6" category="sidebar">容量限制</block>
  <block id="4d2caccc34711835f6ff99da411ac04e" category="sidebar">Storage Virtual Machine</block>
  <block id="af81930661b267e8f1e68c4d66e9ee56" category="sidebar">故障转移和切换</block>
  <block id="dfd1f50170457b961c15bb13ad7e3bed" category="sidebar">数据文件和重做块大小</block>
  <block id="49f83bf3a15b8626eb91fde93c6b1788" category="sidebar">Oracle RAC</block>
  <block id="13d80777c8fd43e555c1f5b1b72d7ef0" category="sidebar">主机配置</block>
  <block id="7e6bb0931a72759d39514aa924b420bc" category="sidebar">AIX</block>
  <block id="6bb83af717367dd4a47f75801ae7a2b0" category="sidebar">带有ASMlib和AFC的Linux</block>
  <block id="619615da0f93507e22a6054ef2aea4f1" category="sidebar">逻辑接口</block>
  <block id="aca8e861c6f30fe2d42d0310a387312b" category="sidebar">以太网配置</block>
  <block id="63a5b8bd41978e8124f9ccdfa9063e9e" category="sidebar">FC SAN配置</block>
  <block id="c3f378ef942f6bf228a43aaacc628fea" category="sidebar">LVM拼花</block>
  <block id="254f642527b45bc260048e30704edb39" category="sidebar">Configuration</block>
  <block id="f3a78e25ce9f95fc3c61ccc39f32fb4d" category="sidebar">Oracle Direct NFS （ DNFS ）</block>
  <block id="989cefa74de0e10a575103f446258d99" category="sidebar">NFS租约和锁定</block>
  <block id="0d695ec265a3b0b5e7e32e33ffe4ed22" category="sidebar">NFS缓存</block>
  <block id="eb4d10d6eda7c9266cd36c4eb0a223cf" category="sidebar">ASM Recasation Utility</block>
  <block id="297e2ac2ec0bd88ad598062f4c07ee45" category="sidebar">分层策略</block>
  <block id="9af6f452cd88c83f2bde555de8f93690" category="sidebar">将数据发送到对象存储</block>
  <block id="08af6d4e6b562e2d0b418d7198f5a0f7" category="sidebar">正在从对象存储检索数据</block>
  <block id="02d01636975b3ae0c0ab22368cea8d54" category="sidebar">层策略</block>
  <block id="7fbd108e1fc6910c941094e95a677878" category="sidebar">整个文件</block>
  <block id="eb43c2427eb06b9f561363863b4a4f0b" category="sidebar">部分文件</block>
  <block id="1afe200fa26ba361f59b603b22ad6392" category="sidebar">选择文件</block>
  <block id="448d15345bb99c834095da225c529b8a" category="sidebar">数据可用性</block>
  <block id="5869e10a9dea6d88d61bb10040557f35" category="sidebar">数据完整性</block>
  <block id="7b68149402c05a52968bda6af0435c8a" category="sidebar">基于Snapshot的联机备份</block>
  <block id="49ba0ee205d016d8236db9c1e8c130e5" category="sidebar">Storage Snapshot优化的备份</block>
  <block id="2c6d98297c340e390e0783220b038545" category="sidebar">物理架构</block>
  <block id="13a854bdd11f8f57a0b25c00631f1430" category="sidebar">逻辑架构</block>
  <block id="5e7988aeba0e1d3c15c5c78a0db738d1" category="sidebar">SyncMirror</block>
  <block id="3f23f85f537c810b6eca3c767c3ff00c" category="sidebar">Oracle故障转移</block>
  <block id="5783cab279142a801ff0fd0a03b607d5" category="sidebar">MetroCluster上的单个实例</block>
  <block id="ea98d1b4d8c0f4b9e705df8dcdf77730" category="sidebar">SM-BC上的单个实例</block>
  <block id="39520db4a78ddf352897eac9b11c5890" category="sidebar">基于SM-BC的Oracle RAC</block>
  <block id="5ba8ee2f32815884475d1f2244ba16a6" category="sidebar">故障情形</block>
  <block id="e31593850dc03f8f10d036df5dc8633b" category="sidebar">Oracle数据库迁移</block>
  <block id="5102abd5a9cc202678054b832caf678d" category="sidebar">过程</block>
  <block id="1495d3ed3ebff783c0f480b583372450" category="sidebar">主机数据复制</block>
  <block id="d81ca5686c955ed50927409eb8c14bb0" category="sidebar">外部LUN导入</block>
  <block id="2fea59b7e470acac5ec1589d504da14e" category="sidebar">完成</block>
  <block id="e9cc85ef98d982c3c3e53d6b82293126" category="sidebar">协议转换</block>
  <block id="fbbd0e8905df3950eca4d1d8f55881ad" category="sidebar">附加说明</block>
  <block id="ac0465a970688dc3c326dcdd8fe2805e" category="sidebar">性能优化和基准测试</block>
  <block id="7cb9c3cd8b9873d39a1fe87c083cd55c" category="sidebar">过时的NFS锁定</block>
  <block id="c0916addb4f26afa58c5a6df4f463fa5" category="sidebar">统一存储</block>
  <block id="c0032c6bab44eeeb6886c7a4aa67cf77" category="sidebar">虚拟化工具</block>
  <block id="1c77ac70000b6804e930748d5df7be5e" category="sidebar">基于虚拟卷和存储策略的管理</block>
  <block id="217601d383b816e6a2548e57b5006f92" category="sidebar">克隆</block>
  <block id="8f2db90dd4a6fbd95ba8f0bc54fd6b27" category="sidebar">QoS</block>
  <block id="09b4a81ec7b05cbacc7cbfa13e006254" category="sidebar">基于存储策略的管理</block>
  <block id="2e8526cbe762cb1b8393d935a3b0bf16" category="sidebar">建议设置</block>
  <block id="10a764f91b59ce3c8931d55c2fd54222" category="sidebar">部署虚拟卷存储</block>
  <block id="30f6724a02fc69093960468c0a2fbcd4" category="sidebar">产品安全性</block>
  <block id="3390e3575b3e341afa2b7172ff5b33a7" category="sidebar">适用于 VMware vSphere 的 SnapCenter 插件</block>
  <block id="62a004b95946bb97541afa471dcca73a" category="sidebar">MySQL</block>
  <block id="7f1a6761f7160e33a32105202e47303b" category="sidebar">容器化</block>
  <block id="bd57f4f74ca087a92a48b23d45753729" category="paragraph">ONTAP 工具的VASA提供程序负责根据已发现的受管ESXi主机启动程序管理ONTAP 中的FCP和iSCSI igrou以及NVMe子系统。但是、它不会与光纤通道交换机集成来管理分区。必须先根据最佳实践进行分区、然后才能进行任何配置。以下是单个启动程序分区到四个ONTAP系统的示例：</block>
  <block id="6b14e3f4a37881185acf7a766f8f6272" category="paragraph">单个启动程序分区：</block>
  <block id="17ccf64e30cb518fd7ca87ce752ad738" category="paragraph"><block ref="17ccf64e30cb518fd7ca87ce752ad738" category="inline-image-macro-rx" type="image"></block></block>
  <block id="58b5cd2a94730c2e044c14891f1e0e87" category="paragraph">有关更多最佳实践、请参见以下文档：</block>
  <block id="fc9e4d789d968936f8ff5ae5a99847e0" category="paragraph"><block ref="fc9e4d789d968936f8ff5ae5a99847e0" category="inline-link-rx"></block></block>
  <block id="d748a2834a7220eef4ec4775a51632f9" category="paragraph"><block ref="d748a2834a7220eef4ec4775a51632f9" category="inline-link-rx"></block></block>
  <block id="4047245d73abc6e3ae8bf58ec063e52e" category="paragraph">随附的SRP适用于大多数通用用途、但您的要求可能有所不同。</block>
  <block id="80dad10df0d1a031764e7c648c46aa23" category="paragraph">*请考虑使用最大IOPS来控制未知或测试VM。*</block>
  <block id="93e4f73afe8b787b33161ec273ca087f" category="paragraph">最大IOPS首次在VASA Provider 7.1中推出、可用于将未知工作负载的IOPS限制为特定VVOR、以避免对其他更关键的工作负载产生影响。有关性能管理的详细信息、请参见表4。</block>
  <block id="bdbd10905a1446f944699405bca52654" category="paragraph">*确保您具有足够的数据Lifs。*
每个HA对的每个节点至少创建两个生命周期。根据您的工作负载、可能需要更多资源。</block>
  <block id="4e0d7e0587bf99c9b7a64a84fd42f6bd" category="paragraph">请参见NetApp和VMware针对您选择的协议提供的其他最佳实践指南。一般而言，除了上述情况外，没有任何其他变化。</block>
  <block id="97f87e9ab1d660463c63beb8745fd9e5" category="paragraph">*使用基于NFS v3*的Vvol的网络配置示例</block>
  <block id="c80b3cc8b5013bd4039769fb0f783e60" category="paragraph"><block ref="c80b3cc8b5013bd4039769fb0f783e60" category="inline-image-macro-rx" type="image"></block></block>
  <block id="dee28dd6d1a9ef7bf399f642fd9d588f" category="section-title">NFS传输大小</block>
  <block id="d8299d00f914e35b80644e5781e47a77" category="paragraph"><block ref="d8299d00f914e35b80644e5781e47a77" category="inline-image-macro-rx" type="image"></block></block>
  <block id="14ce62ac76fa34a51093e6bcf11a2fd1" category="paragraph">数据库备份的主要注意事项是利用NetApp Snapshot技术。应用程序一致的备份和数据库布局是实现可由NetApp SnapCenter协调的RTO和RPO的另一个重要考虑因素。</block>
  <block id="2c024bdc7d0e87e8ba0f473024d45a4e" category="paragraph">修改服务器和数据库设置有助于实现更好、更高效的数据库性能。</block>
  <block id="861f074a1ecd9d1cc088d2fe81903565" category="paragraph"><block ref="861f074a1ecd9d1cc088d2fe81903565" category="inline-image-macro-rx" type="image"></block></block>
  <block id="710e9cd79e3865d47122a799f425b31f" category="paragraph"><block ref="710e9cd79e3865d47122a799f425b31f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="5a656ddcc72bacc3a5900c23edf7a08e" category="paragraph"><block ref="5a656ddcc72bacc3a5900c23edf7a08e" category="inline-image-macro-rx" type="image"></block></block>
  <block id="073ce0a0568adc64d52dd9b1d8c02c54" category="paragraph"><block ref="073ce0a0568adc64d52dd9b1d8c02c54" category="inline-image-macro-rx" type="image"></block></block>
  <block id="d5e31e9b7075c2926dba10053509346b" category="paragraph">存储效率是RAID、配置(整体布局和利用率)、镜像和其他数据保护技术的组合。NetApp技术(如Snapshot副本、精简配置、FlexClone)可优化基础架构中的现有存储、推迟或避免未来的存储支出、从而帮助实现成本优势。将这些技术结合使用的次数越多、节省的空间就越大。</block>
  <block id="3401a9880dfc322da8a56c4d632361f6" category="paragraph"><block ref="3401a9880dfc322da8a56c4d632361f6" category="inline-image-macro-rx" type="image"></block></block>
  <block id="87f823f4f3b4258445d5af029afe5ad9" category="paragraph"><block ref="87f823f4f3b4258445d5af029afe5ad9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="9213fe9d391179276ff6c03552486255" category="paragraph"><block ref="9213fe9d391179276ff6c03552486255" category="inline-image-macro-rx" type="image"></block></block>
  <block id="3105b4c0642b9710179c18edcf8e8718" category="paragraph"><block ref="3105b4c0642b9710179c18edcf8e8718" category="inline-image-macro-rx" type="image"></block></block>
  <block id="1a43000eb9893bff7ab7b1ce1d3fd6a8" category="paragraph"><block ref="1a43000eb9893bff7ab7b1ce1d3fd6a8" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4b7a8562c98b8c652bdfb6aa79788222" category="paragraph"><block ref="4b7a8562c98b8c652bdfb6aa79788222" category="inline-image-macro-rx" type="image"></block></block>
  <block id="25cec91f17a8619119f76c8adbace583" category="paragraph">另请参见一节中有关数据压缩块对齐的讨论 <block ref="0faffd62be034c86d531acfee84d252e" category="inline-link-macro-rx"></block>。与8 KB压缩块边界对齐的任何布局也与4 KB边界对齐。</block>
  <block id="38ac6f4e1538397bd4f659237ec03ebf" category="paragraph"><block ref="38ac6f4e1538397bd4f659237ec03ebf" category="inline-image-macro-rx" type="image"></block></block>
  <block id="f01518e5f3b18a9ea241bc63a3475dbd" category="paragraph"><block ref="f01518e5f3b18a9ea241bc63a3475dbd" category="inline-image-macro-rx" type="image"></block></block>
  <block id="acce752526553bfa73c92799accd9cb8" category="summary">Oracle数据保护概述</block>
  <block id="deb8cb7644231cae002f5f37c725b86f" category="paragraph">远距离迁移通常需要更具创意的方法、例如中所述的日志传送过程 <block ref="86efe12ea0d3a769a4b7cfc2b6362f49" category="inline-link-macro-rx"></block>。远距离IP网络的带宽很少接近LAN或SAN速度。在一个案例中、NetApp以极高的归档日志生成速率协助远程迁移220 TB数据库。选择的数据传输方法是每天运送磁带、因为这种方法可提供最大可能的带宽。</block>
  <block id="055362c7082175c34483772a43b776cf" category="paragraph">例如、复制一个10 TB数据库通常需要大约7小时才能完成。如果业务需求允许中断七小时、则文件复制是一种简单安全的迁移选项。如果五个小时不可接受、则采用简单的日志传送流程(请参见 <block ref="eee8a7589b6555fc3411165c58a62ca5" category="inline-link-macro-rx"></block>)、只需极少的工作量即可完成设置、从而将转换时间缩短至大约15分钟。在此期间、数据库管理员可以完成此过程。如果15分钟不可接受、则可以通过脚本自动执行最终转换过程、将转换时间缩短为几分钟。您始终可以加快迁移速度、但这样做会耗费时间和精力。转换时间目标应基于业务部门可接受的内容。</block>
  <block id="911e63244fc82405263306a64e535c69" category="paragraph">只能在中的步骤之后创建zpool <block ref="e8673fdb712a2edcdf56742c7eec0045" category="inline-link-macro-rx"></block> 执行。如果操作步骤未正确执行、则可能会因I/O对齐而导致性能严重下降。要在ONTAP上获得最佳性能、需要将I/O与驱动器上的4K边界对齐。在zpool上创建的文件系统使用有效块大小、该大小通过名为的参数进行控制<block ref="81df978a8e3da4bee74b135548f390f3" prefix=" " category="inline-code"></block>，可通过运行命令来查看<block ref="1615297782a0dff59b20451e2ca97ea7" prefix=" " category="inline-code"></block>。</block>
  <block id="b2ca9da17ac7a0807fb313343c1ba9cb" category="list-text">创建分区时使用的是33扇区偏移、而不是默认的32扇区偏移。重复中所述的操作步骤 <block ref="6ba0f94fdd8f9504e3fef5712023fb85" category="inline-link-macro-rx"></block>。直方图显示如下：</block>
  <block id="eb7f9a88026c895932f70c650c364132" category="list-text">增加LUN的大小</block>
  <block id="0f11c45e6e7377b9d10a93534d0fa2f3" category="list-text">将LUN添加到现有卷组并增加包含的逻辑卷</block>
  <block id="e4da750cce448393b2597f8f66086894" category="paragraph">启动程序组(igroGroup)是ONTAP LUN屏蔽架构的一部分。除非先授予主机访问权限、否则无法访问新创建的LUN。为此、可创建一个igrop、其中列出应授予访问权限的FC WWN或iSCSI启动程序名称。编写此报告时、只有FC LUN支持FLI。但是、迁移后转换为iSCSI是一项简单的任务、如所示 <block ref="43085dc2a05784d4912331d1ed1db91d" category="inline-link-macro-rx"></block>。</block>
  <block id="525e71fb331412cd820122c3d51d453c" category="paragraph">这样、数据库管理器便可在删除数据后回收存储阵列上的空间。ONTAP会截获零并取消分配LUN中的空间。回收过程速度极快、因为存储系统中不会写入任何数据。</block>
  <block id="be17af715060572d2df93d7ffe4ce6dd" category="paragraph">ONTAP 存储系统可以非常灵活地为 VM 和虚拟磁盘创建数据存储库。尽管在使用 VSC 为 vSphere 配置数据存储库时会应用许多 ONTAP 最佳实践（在一节中列出） <block ref="2e24324ebf41be836715e1e0dd648f4f" category="inline-link-macro-rx"></block>），下面是需要考虑的其他一些准则：</block>
  <block id="141c3dc68be34b8f11c2a120b36a1eb8" category="list-text">在某些情况下，您甚至可能不需要数据存储库。为了获得最佳性能和易管理性，请避免对数据库和某些应用程序等高 I/O 应用程序使用数据存储库。而是考虑由子系统拥有的文件系统，例如由子系统管理或使用 RDM 管理的 NFS 或 iSCSI 文件系统。有关具体的应用指南，请参见适用于您的应用程序的 NetApp 技术报告。例如： <block ref="cfa0393f870bc70fd8973ae18376facc" category="inline-link-macro-rx"></block> 包含一个有关虚拟化的章节，其中包含有用的详细信息。</block>
  <block id="3cd9527ff0ddb17e00c08bdb4cd1a776" category="paragraph">在vSphere中、VM存储策略用于管理可选功能、例如存储I/O控制或vSphere加密。它们还可与Vvol结合使用、以便为VM应用特定的存储功能。使用"NetApp.Clustered.Data.ONTAP .VP.VVol"存储类型和"proFileName"规则通过使用此策略将特定SCP应用于VM。有关使用ONTAP工具VASA Provider的示例、请参见链接：vmware-vvols-ONTAP。html#Best Practices[使用基于NFS v3的VVOLs的网络配置示例]。"NetApp.Clustered.Data.ONTAP .VP.VASA10"存储的规则适用于非基于VVO尔 的数据存储库。</block>
  <block id="36ad91be49fdde7d3fadeba0fb782510" category="paragraph">创建存储策略后、即可在配置新VM时使用该策略、如中所示 <block ref="d202b3fe265f968d81802fcec9f3c381" category="inline-link-macro-rx"></block>。有关在VASA Provider 7.2中使用性能管理功能的准则、请参见 <block ref="8fdd8868d80d04eecf1b4189862f536c" category="inline-xref-macro-rx"></block>。</block>
  <block id="14bdf3569ec0024259b2b02c5a668eae" category="paragraph">时间<block ref="7ccc31934ae8244d8263d3c09bcee186" prefix=" " category="inline-code"></block> 处于启用状态(默认值)时、InnoDB会将所有数据存储两次：首先存储到双写入缓冲区、然后存储到实际数据文件。</block>
  <block id="394ad91b4701dbd32675896bed204755" category="sidebar">PostgreSQL的主机配置</block>
  <block id="9852487272d9b2aa9026d0fddc0616fc" category="sidebar">PostgreSQL的存储配置</block>
  <block id="bc237072428e0e4c415160b898946d4c" category="sidebar">PostgreSQL的数据保护</block>
  <block id="3423582eed75b4bd6632c18238fd78e4" category="sidebar">Microsoft SQL Server的数据库配置</block>
  <block id="6e97cf67ec5979ab5828852639efa208" category="sidebar">Microsoft SQL Server的存储配置</block>
  <block id="5a4517368fb2ab5498fc2108c2ea64c5" category="sidebar">Oracle数据库的数据库配置</block>
  <block id="e483c0ecf3a2b1a60f886d4a5ac553ff" category="sidebar">Oracle数据库的主机配置</block>
  <block id="06b078afa802a679ad4694d13a8a2495" category="sidebar">Oracle数据库的网络配置</block>
  <block id="f1991b28c5d48cb53798755acf9dfe62" category="sidebar">Oracle数据库的存储配置</block>
  <block id="ea9cdfcbfcf1906c15b6779f0f327028" category="sidebar">MySQL的数据库配置</block>
  <block id="308f8f580d0248ac023557cfd4b10d83" category="sidebar">MySQL的主机配置</block>
  <block id="830f353b3e6055499fac447b16b0c935" category="sidebar">MySQL的存储配置</block>
  <block id="3106f8f17f2974fe05da16fb0cc50505" category="summary">基于ONTAP使用SAN的PostgreSQL数据库</block>
  <block id="74cacb0c34a37e2859e3b054938a344d" category="doc">使用SAN文件系统的PostgreSQL</block>
  <block id="1758f5c81d60f1a0ac8600fddc99a919" category="paragraph">采用SAN的PostgreSQL数据库通常托管在xfs文件系统上、但如果操作系统供应商支持、则可以使用其他数据库</block>
  <block id="d73e7b56b7baa813a32c521ca074e7c4" category="paragraph">虽然一个LUN通常可支持高达10万次IOPS、但IO密集型数据库通常需要使用带区化LVM。</block>
  <block id="f7cc8c4234952826818ad4d0c2050ac9" category="paragraph">PostgreSQL数据库可以托管在NFSv3或NFSv4文件系统上。最佳选择取决于数据库以外的因素。</block>
  <block id="1482c42acc1dd31ee8496c71a805e73c" category="paragraph">例如、在某些集群环境中、NFSv4锁定行为可能更好。(请参见 <block ref="bc3a7e667477b8b3590fa1451dcb924c" category="inline-link-macro-rx"></block> 了解更多详细信息)</block>
  <block id="9674525687765646f35916d0e569eda9" category="paragraph">否则、数据库功能(包括性能)应接近相同。唯一的要求是使用<block ref="d64a84456adc959f56de6af685d0dadd" prefix=" " category="inline-code"></block> 挂载选项。要确保软超时不会产生不可恢复的IO错误、必须执行此操作。</block>
  <block id="0c6430fad6c643c444b5d6d52b18edb4" category="paragraph">如果选择NFSv4作为协议、NetApp建议使用NFSv4.1。在NFSv4.1中、NFSv4协议有一些功能增强功能、可提高NFSv4.0的故障恢复能力。</block>
  <block id="248212b04c23627e2719e106224d2eb3" category="paragraph">对常规数据库工作负载使用以下挂载选项：</block>
  <block id="9efbdff43e91279291e95690414bec95" category="paragraph">在ONTAP级别增加传输大小后、将使用以下挂载选项：</block>
  <block id="395201f6a339cc4cf6b345e0c259f383" category="section-title">NFSv3 TCP插槽表</block>
  <block id="1f8260aa2c5a5b35bf771c26828d2096" category="paragraph">如果在Linux中使用NFSv3、则正确设置TCP插槽表至关重要。</block>
  <block id="92d0a1aef2134a70d5c0f0279dc22ec6" category="doc">Snapshot 副本</block>
  <block id="0c47b4eb567b018e3d2e5882b88eaca9" category="paragraph">存储快照是目标数据的时间点副本。ONTAP的实施支持设置各种策略、并为每个卷存储多达1024个快照。ONTAP中的快照可节省空间。只有在原始数据集发生更改时、才会占用空间。它们也是只读的。快照可以删除、但不能更改。</block>
  <block id="7986a4827296ca9cd0b991ded9f8a10d" category="paragraph">在某些情况下、可以直接在ONTAP上计划快照。在其他情况下、可能需要SnapCenter等软件来编排应用程序或操作系统操作、然后再创建快照。无论哪种方法最适合您的工作负载、主动快照策略都可以通过频繁、轻松访问从启动LUN到任务关键型数据库的所有备份来确保数据安全。</block>
  <block id="210c45246ad11e0b53bdb20b64266780" category="paragraph">*注意*：ONTAP灵活卷或更简单地说、卷不是LUN的同义词。卷是文件或LUN等数据的管理容器。例如、数据库可能位于一个8 LUN条带集上、所有LUN都包含在一个卷中。</block>
  <block id="ad590deba1cd4423ee565e822c3a91d1" category="paragraph">有关快照的详细信息、请单击 <block ref="211d7effcac0cb0488144c6fc8b3cb7c" category="inline-link-macro-rx"></block></block>
  <block id="c4bf0f56feeec9a45e973768fbc4f47e" category="section-title">防篡改快照</block>
  <block id="d2e783db61d20da61c761d4d473bed14" category="paragraph">从ONTAP 9.12.1开始、快照不仅是只读的、还可以防止意外或故意删除。此功能称为防篡改快照。可以通过Snapshot策略设置和实施保留期限。生成的快照在达到到期日期之前无法删除。不会覆盖管理或支持中心。</block>
  <block id="38fef959179f8d3eb79a68a5ce747bdc" category="paragraph">这样可以确保即使侵入者、恶意内部人员甚至勒索软件攻击导致访问ONTAP系统本身、也不会影响备份。如果与频繁的快照计划结合使用、则可以提供极其强大的数据保护、并且RPO非常低。</block>
  <block id="c64db0c79e66c1c0e5b932c5d2dedfea" category="paragraph">有关防篡改快照的详细信息、请单击 <block ref="134603be635c039f9224bff191c6103c" category="inline-link-macro-rx"></block></block>
  <block id="a1f41e52e9ddbd9f87ecd032c237b1c0" category="section-title">SnapMirror 复制</block>
  <block id="1bb837ddfb635c39a6c6e23d847823f9" category="paragraph">也可以将快照复制到远程系统。这包括防篡改快照、其中会在远程系统上应用和实施保留期限。结果是、数据保护优势与本地快照相同、但数据位于另一个存储阵列上。这样可以确保销毁原始阵列不会影响备份。</block>
  <block id="18d315ae923785b3f9c5234724b0ab42" category="paragraph">第二个系统还为管理安全性打开了新的选项。例如、某些NetApp客户会隔离主存储系统和二级存储系统的身份验证凭据。没有一个管理用户可以同时访问这两个系统、这意味着恶意管理员无法删除所有数据副本。</block>
  <block id="e805272dcce51c35975e830e5ee9ecaf" category="paragraph">有关SnapMirror的详细信息、请单击 <block ref="9abdfd5d94773cf0a996248d1d722cac" category="inline-link-macro-rx"></block></block>
  <block id="500569e3cc0764260a592cb176921ca3" category="section-title">Storage Virtual Machine</block>
  <block id="d5174dd4c760ef1a826b3e5bc22215e5" category="paragraph">新配置的ONTAP存储系统与新配置的VMware ESX服务器类似、因为在创建虚拟机之前、这两个系统都不能支持任何用户。通过ONTAP、您可以创建一个Storage Virtual Machine (SVM)、此SVM将成为存储管理的最基本单元。每个SVM都有自己的存储资源、协议配置、IP地址和FCP WWN。  这是ONTAP多租户的基础。</block>
  <block id="597cb258dd509add7cd999794c60d430" category="paragraph">例如、您可以为关键生产工作负载配置一个SVM、为开发活动配置另一个SVM。然后、您可以限制某些管理员对生产SVM的访问、同时授予开发人员对开发SVM中存储资源的更广泛的控制权限。您可能还需要为财务和人力资源团队提供第三个SVM、以存储非常关键的只读数据。</block>
  <block id="18519d16720b1e13890c2639657b5bf8" category="paragraph">有关SVM的详细信息、请单击 <block ref="a06a0fd566387240178b1c926e07cb7b" category="inline-link-macro-rx"></block></block>
  <block id="7d0fc71fe28e011ca49b06214469d484" category="section-title">管理RBAC</block>
  <block id="4f0dae2ba2fd11c533349d6ade4f81de" category="paragraph">ONTAP为管理登录提供了功能强大的基于角色的访问控制(Role-Based Access Control、RBAC)。某些管理员可能需要完全集群访问权限、而其他管理员则可能只需要访问某些SVM。高级帮助台人员可能需要增加卷大小的能力。这样、您就可以为管理用户授予执行其工作职责所需的访问权限、而无需执行任何其他操作。此外、您还可以使用不同供应商提供的PKI来保护这些登录、限制对ssh密钥的访问、并强制执行失败登录尝试锁定。</block>
  <block id="6ae13b0198daa7d13d79a8631297e64d" category="paragraph">有关管理访问控制的详细信息、请单击 <block ref="db5be08b697b5ef26e0e94da1d5f4970" category="inline-link-macro-rx"></block></block>
  <block id="671a94a08dff3cf44fad087e2346c8b0" category="section-title">多因素身份验证</block>
  <block id="c6595c32ea3c4aa315aa5c66b88b0a54" category="paragraph">ONTAP和某些其他NetApp产品现在支持使用多种方法进行多因素身份验证。其结果是、用户名/密码被泄露本身并不是没有第二个因素(例如FOB或智能手机应用程序)的数据的安全线程。</block>
  <block id="945c88a63c229c39ee73ab5592b3ef63" category="paragraph">有关详细信息，请单击 <block ref="03628d0cd13b6640ef56c399aa1c2070" category="inline-link-macro-rx"></block></block>
  <block id="852741d2a7fb0a8a1a5dd748dbbd6734" category="section-title">API RBAC</block>
  <block id="bbbea5fec67f15424fa77aa563754c49" category="paragraph">自动化需要API调用、但并非所有工具都需要完全管理访问权限。为了帮助保护自动化系统的安全、还在API级别提供了RBAC。您可以将自动化用户帐户限制为所需的API调用。例如、监控软件不需要更改访问权限、只需要读取访问权限即可。配置存储的工作流不需要删除存储。</block>
  <block id="97ad75902b447ba6b23cabdb10252ce8" category="paragraph">要了解更多信息、请开始 <block ref="d3dd665f13f927a9546f36768f8407dd" category="inline-link-macro-rx"></block></block>
  <block id="cb93ad4589e6e6834d2627d2ef8c8456" category="section-title">多管理员验证</block>
  <block id="7604bad489eaec7e27d112c63d3e2936" category="paragraph">通过要求两个不同的管理员(每个管理员都有自己的凭据)批准某些活动、可以进一步实现多"因素"身份验证。其中包括更改登录权限、运行诊断命令和删除数据。</block>
  <block id="e890d04cd745ac382688bbb307655e81" category="paragraph">有关多管理员验证(MAV)的详细信息、请单击 <block ref="88f84d4fec0424d978600980bf11baf0" category="inline-link-macro-rx"></block></block>
  <block id="b39c0496b44447232912303246b46aaa" category="paragraph">如果预期顺序IO较多、则可以按下一节所述增加NFS传输大小。</block>
  <block id="f8fd5d7386ed935c8520d4e04b029e93" category="paragraph">以下各节将介绍一些关键内存配置设置。</block>
  <block id="959e8f746f4ff03f6225b95cf646e65f" category="admonition">本文档将取代先前发布的技术报告_TR-4590：《采用ONTAP的Microsoft SQL Server最佳实践指南》</block>
  <block id="1f6b7ed754cfe3488cf91c21c13ec49a" category="paragraph">保护数据库环境是一项多方面的工作、不仅限于管理数据库本身。NetApp提供了多种独特的功能、旨在保护数据库基础架构的存储方面。</block>
  <block id="15d2f797f7375b32cb5e92538291f2af" category="list-text"><block ref="15d2f797f7375b32cb5e92538291f2af" category="inline-link-rx"></block></block>
  <block id="36d72286c0ef70108b2f7791b73fdc6d" category="list-text">之前的指南建议创建LIF以定位数据。也就是说，始终使用物理拥有卷的节点上的 LIF 挂载数据存储库。在现代版本的 ONTAP 9 中，不再需要此功能。如果给定了集群范围的凭据、则ONTAP工具仍会尽可能选择在数据本地的各个LUN之间进行负载平衡、但这并不是高可用性或高性能的要求。</block>
  <block id="aa131b86ebd9f719bab1aba612ae3c3f" category="list-text">如果恢复计划中的数据存储库数量和保护组数量达到最低、则SRM的性能最佳。因此、您应考虑在受SRM保护的环境中优化虚拟机密度、在这种环境中、应使用最重要的是RTO。</block>
  <block id="afab42482b97a8b43c62320c373ded74" category="list-text">使用Distributed Resource Scheduler (DRS)帮助平衡受保护和恢复ESXi集群上的负载。请记住、如果您计划故障恢复、则在运行重新保护时、先前受保护的集群将成为新的恢复集群。DRS将有助于平衡两个方向的放置。</block>
  <block id="8ed6c5d9143eeb92cf75bb8a08bb7819" category="list-text">如有可能、请避免对SRM使用IP自定义、因为这会增加您的RTO。</block>
  <block id="8baa3b91d59f004ee489f4f3fd3dd4e4" category="paragraph">从SRM 8.3开始、支持使用Vvol数据存储库保护VM。在 ONTAP 工具设置菜单中启用 VVOL 复制后， VASA Provider 会将 SnapMirror 计划公开到 VM 存储策略中，如以下屏幕截图所示。</block>
  <block id="3c1a2fd7a7a41ca20efeae84dc73ba0a" category="paragraph">以下示例显示了已启用的卷复制。</block>
  <block id="fc7cd76ae57374916b5edd5a2dd19fee" category="paragraph">与以前的 VVOL 数据存储库不同，复制的 VVOL 数据存储库必须在启用复制的情况下从头开始创建，并且它们必须使用在具有 SnapMirror 关系的 ONTAP 系统上预创建的卷。这需要预先配置集群对等和 SVM 对等。这些活动应由ONTAP管理员执行、因为这样可以在管理多个站点的ONTAP系统的人员与主要负责vSphere操作的人员之间实现严格的职责分离。</block>
  <block id="e4ad04c89e34f6ca94c87cd68315b108" category="paragraph">这代表 vSphere 管理员提出了一项新要求。由于卷是在 ONTAP 工具的范围之外创建的，因此在定期计划的重新发现期间之前，它不会意识到 ONTAP 管理员所做的更改。因此，最好在创建要用于 VVol 的卷或 SnapMirror 关系时始终运行重新发现。只需右键单击主机或集群、然后选择NetApp ONTAP工具&gt;更新主机和存储数据、如以下屏幕截图所示。</block>
  <block id="e2e7245b1b3cf4a13a6b703ead49ebee" category="paragraph">系统会为每个阵列对创建一个阵列管理器。使用 SRM 和 ONTAP 工具，每个阵列配对都在 SVM 的范围内完成，即使您使用的是集群凭据也是如此。这样，您可以根据租户分配给他们管理的 SVM 在租户之间划分灾难恢复工作流。您可以为一个给定集群创建多个阵列管理器、这些阵列管理器可以是非对称的。您可以在不同的 ONTAP 9 集群之间扇出或扇入。例如，可以将集群 1 上的 SVMA 和 SVM-B 复制到集群 2 上的 SVM-C ，集群 3 上的 SVM-D ，反之亦然。</block>
  <block id="3233e61306af256f9de7fd3086bc08bf" category="paragraph">对于复制组以及如何在 FlexVol 卷之间分布虚拟机，需要考虑几个因素。对于缺少聚合级重复数据删除的旧版ONTAP系统、将相似的VM分组在同一个卷中可以提高存储效率、但分组会增加卷的大小并减少卷I/O并发性。在现代ONTAP系统中、可以通过在同一聚合中的FlexVol卷之间分布虚拟机、从而利用聚合级重复数据删除并在多个卷之间实现更大的I/O并行处理能力、从而在性能和存储效率之间实现最佳平衡。您可以同时恢复卷中的 VM ，因为一个保护组（如下所述）可以包含多个复制组。此布局的缺点是、由于卷SnapMirror不考虑聚合重复数据删除、数据块可能会通过缆线传输多次。</block>
  <block id="670ea4d89ef5c48c4f2d840baf48688c" category="paragraph">例如、您的公司可能拥有一个第1层业务关键型应用程序、该应用程序的数据库依赖于Microsoft SQL Server。因此，您决定将 VM 置于优先级组 1 中。在优先级组 1 中，您开始规划订单以启动服务。您可能希望 Microsoft Windows 域控制器在 Microsoft SQL 服务器之前启动，而该服务器需要在应用程序服务器之前联机，依此类推。您可以将所有这些VM添加到优先级组、然后设置依赖关系、因为依赖关系仅适用于给定优先级组。</block>
  <block id="512ee19e5020f3ee80a9e25f3f5a6468" category="paragraph">作为最佳实践，每当对受保护 VM 存储的配置进行更改时，始终执行测试故障转移。这样可以确保在发生灾难时、您可以相信Site Recovery Manager可以在预期的Recovery目标范围内还原服务。</block>
  <block id="4da3f855cd505741909cfd49d743e68e" category="paragraph">通过 SRM ，您还可以在虚拟机恢复后更改其网络配置。此重新配置包括IP地址、网关地址和DNS服务器设置等设置。恢复计划中VM的属性设置中可以指定不同的网络设置、这些设置会在恢复后应用于各个VM。</block>
  <block id="e409450ce49f3558b068c69a77a9623a" category="paragraph">在故障恢复之后、您应与所有利益相关方确认其服务已恢复正常、然后再再次运行重新保护。</block>
  <block id="a42cf9beb4788dddb7d317e05cc08e23" category="sidebar">数据库文件和文件组</block>
  <block id="8858bb6564a2efc189c9183c495ce545" category="sidebar">LUN对齐</block>
  <block id="02bc4ad8a694d41c8b598dfbcb12f069" category="sidebar">LUN计数和LUN大小</block>
  <block id="066f208a93617bd82090d42624ce63cc" category="sidebar">LUN大小调整</block>
  <block id="9eeba6fd02cf3b6d8aee35e0ce9bf8fe" category="sidebar">LVM条带化</block>
  <block id="183bdb28f19bee640319f68825827aea" category="sidebar">RPO、RTO和SLA</block>
  <block id="2172b5d51273924b537842b0db78bfd4" category="sidebar">备份和恢复基础知识</block>
  <block id="3403aac944f3cb6e2d2c7f7d52bc44b9" category="paragraph">随着数据呈指数级增长、企业的数据管理变得更加复杂。这种复杂性会增加许可、运营、支持和维护成本。要降低总体TCO、请考虑使用可靠的高性能后端存储从商用数据库切换到开源数据库。</block>
  <block id="dcac08882e3396bd30210108baa1641d" category="paragraph">ONTAP是理想的平台、因为ONTAP专为数据库而设计。随机IO延迟优化、高级服务质量(Quality of Service、QoS)和基本FlexClone功能等众多功能专为满足数据库工作负载的需求而创建。</block>
  <block id="1429a98a71e16287326edd7fc1f999fd" category="paragraph">无中断升级(包括更换存储)等其他功能可确保关键数据库始终可用。您还可以通过MetroCluster为大型环境实现即时灾难恢复、或者使用SnapMirror主动同步功能选择数据库。</block>
  <block id="8df3fb35ff15e02683bfb1bc7f852c93" category="paragraph">最重要的是、ONTAP提供无与伦比的性能、能够根据您的独特需求调整解决方案的大小。我们的高端系统可以提供超过100万次IOPS、延迟以微秒为单位。但是、如果您只需要10万次IOPS、则可以使用仍运行完全相同存储操作系统的小型控制器来调整存储解决方案的大小。</block>
  <block id="97b4cda00dd31f5be69440f48c4da149" category="summary">使用ONTAP的PostgreSQL数据库配置</block>
  <block id="c4f52498c0db572381512887d7584e53" category="summary">PostgreSQL数据库和存储快照</block>
  <block id="b0792163c858a7c221b236d84619b5ef" category="summary">PostgreSQL数据库NFS与ONTAP</block>
  <block id="189950ed46e5e8b7e92941531a5bb88b" category="doc">使用NFS文件系统的PostgreSQL数据库</block>
  <block id="504cd1fb60a8eb7918484270e743ae3a" category="summary">PostgreSQL数据管理P</block>
  <block id="6cabd4dcf3582d38c441228705da3bda" category="doc">PostgreSQL数据保护</block>
  <block id="383a6a5241ecfc558b9fec1d7cff5239" category="summary">PostgreSQL表空间</block>
  <block id="20d0e2519b3555a0a2927c8914c17280" category="summary">PostgreSQL数据保护软件</block>
  <block id="29e2aec511a8e307ecceacbd86c22f14" category="summary">PostgreSQL初始化参数</block>
  <block id="55e3f073b1864d9281d074e5b23effca" category="doc">Oracle性能优化和基准测试过程</block>
  <block id="035ecd1be6cacde993302b440e396bc2" category="paragraph">现在、大多数数据库客户都选择全闪存阵列、这就需要考虑一些额外的注意事项。例如、考虑在双节点AFF A900系统上进行性能测试：</block>
  <block id="33f545d041b93838074263c0efd2e9da" category="list-text">如果读/写比率为80/20、则两个A900节点可以在延迟甚至超过150µs微秒之前提供超过100万次的随机数据库IOPS。这远远超出了大多数数据库当前的性能需求、因此很难预测预期的改进。存储将作为瓶颈在很大程度上被消除。</block>
  <block id="0445195555faac96ebff962dbff126ea" category="summary">MySQL配置参数</block>
  <block id="c0b7708ffcd66fd65a9d2a4801091563" category="paragraph">NetApp建议使用一些重要的MySQL配置参数来获得最佳性能。</block>
  <block id="10eb8b7e75da1815860da31490513841" category="summary">使用NFS的MySQL</block>
  <block id="5249e05857621fbfae51371a73006c44" category="summary">MySQL和NFSv3插槽表</block>
  <block id="d058f95e3a8d4b7b46802139d6b95982" category="paragraph">Linux上的NFSv3性能取决于名为的参数<block ref="453f2cc2326f82af1053f4aa4b75400b" prefix=" " category="inline-code"></block>。</block>
  <block id="bf2bdc980948fb9084a63963398846b2" category="paragraph">ONTAP是MySQL数据库的理想平台、因为ONTAP实际上是为数据库设计的。随机IO延迟优化、高级服务质量(Quality of Service、QoS)和基本FlexClone功能等众多功能专为满足数据库工作负载的需求而创建。</block>
  <block id="1b3804b7e2292e18f5e66d54f7a9fafc" category="paragraph">最重要的是、ONTAP提供无与伦比的性能、能够根据您的独特需求调整解决方案的大小。我们的高端系统可以提供超过100万次IOPS、延迟以微秒为单位、但如果您只需要10万次IOPS、则可以使用仍运行完全相同存储操作系统的较小控制器来调整存储解决方案的大小。</block>
  <block id="1339877637a3f7f59745a00e04f304fd" category="summary">MySQL和InnoDB_log_file_size</block>
  <block id="c1c4e722764621d56a075e42ce48d0c0" category="summary">MySQL和InnoDB_buffer_pool_size</block>
  <block id="ae14ab6d1e5edd0e782d8897d1721eb4" category="summary">MySQL和InnoDB_doblewite</block>
  <block id="689c52e3f5db5d2dafccd7d93cf1abc4" category="summary">MySQL和InnoDB_FLOG_LOG_AT_TRx_COMI</block>
  <block id="639600080c225673dfdfa012fdbd6146" category="summary">MySQL和IO计划程序</block>
  <block id="32e3724e2b54692cbef969373fbfe040" category="doc">I/O计划程序和MySQL</block>
  <block id="72985ac51e91797345b2437088a4362e" category="summary">采用SAN的MySQL</block>
  <block id="d5ef0a45fe252b03f538bfd134b168db" category="summary">MySQL和InnoDB_LRU_SCAN_深度</block>
  <block id="df657260453f6ef228ee0ca22dd7a415" category="summary">MySQL容器化</block>
  <block id="885b1b5a90f898c89b664ec58a42121c" category="doc">MySQL容器化</block>
  <block id="2cbac38815d492c0afc5e7d7229601df" category="doc">MySQL和InnoDB</block>
  <block id="1115aaa86f0065e0a105795d33ef4731" category="summary">MySQL文件说明</block>
  <block id="2828450fc6669c8df75f937e227996f1" category="doc">MySQL文件描述符</block>
  <block id="9420010a756fb6d3ddeadfa63d2170f6" category="paragraph">要运行、MySQL服务器需要文件描述符、而默认值是不够的。</block>
  <block id="62414a5a9c0e2fc12a8d028ad29164b8" category="summary">MySQL和InnoDB_IO_Capacity</block>
  <block id="6219c45bc8c26437c0b7e1a69d4cbe58" category="summary">MySQL和InnoDB_F冲 方法</block>
  <block id="35d1a5d7b12999ec27f5233dccba043f" category="summary">MySQL和open_file_极限</block>
  <block id="c031febc35017c70bf3b526723756b2a" category="doc">iSCSI和NVMe/TCP</block>
  <block id="4da35d461815e71b97bda03476e89b7b" category="paragraph">使用iSCSI或NVMe/TCP的主机可以直接连接到存储系统并正常运行。原因是路径问题。直接连接到两个不同的存储控制器会产生两条独立的数据流路径。丢失路径、端口或控制器不会阻止使用另一个路径。</block>
  <block id="40715d81cea527f13cdf470773fc3a65" category="paragraph">可以使用直连NFS存储、但有一个重大限制—如果没有大量的脚本编写工作、故障转移将无法正常工作、这是客户的责任。</block>
  <block id="d0b13bfd23c05f64222869de30f81000" category="paragraph">直连NFS存储的无中断故障转移之所以复杂、是因为本地操作系统上会发生路由。例如、假设主机的IP地址为192.168.1.1/24、并且直接连接到IP地址为192.168.1.50/24的ONTAP控制器。在故障转移期间、该192.168.1.50地址可以故障转移到另一个控制器、并且该地址可供主机使用、但主机如何检测到它的存在？原来的192.168.1.1地址仍然位于不再连接到操作系统的主机NIC上。发往192.168.1.50的流量将继续发送到无法运行的网络端口。</block>
  <block id="288a0a5ebbc70fb3b968ec58d36d71ab" category="paragraph">第二个操作系统NIC可配置为19 2.168.1.2、并且能够与故障转移的192.168.1.50地址通信、但本地路由表默认使用一个*且仅一个*地址与192.168.1.0/24子网通信。sysadmin可以创建一个脚本框架、用于检测失败的网络连接并更改本地路由表或启动和关闭接口。确切的操作步骤取决于所使用的操作系统。</block>
  <block id="d6ce8522932df7ae76aa0b963ad9ef7d" category="paragraph">在实践中、NetApp客户确实使用直连NFS、但通常仅适用于故障转移期间IO暂停的工作负载。使用硬挂载时、暂停期间不应出现任何IO错误。在服务还原之前、IO应挂起、可以通过故障恢复或手动干预在主机上的NIC之间移动IP地址。</block>
  <block id="3436a7073ac9f4071820b6720a7789fc" category="section-title">FC直连</block>
  <block id="b7981516813a09695906aa429b07f48f" category="paragraph">不能使用FC协议将主机直接连接到ONTAP存储系统。原因是使用了NPIV。用于向FC网络标识ONTAP FC端口的WWN使用一种称为NPIV的虚拟化类型。连接到ONTAP系统的任何设备都必须能够识别NPIV WWN。目前没有HBA供应商提供可安装在能够支持NPIV目标的主机中的HBA。</block>
  <block id="97db606ac6781989ea3b189d7be28bf2" category="section-title">直连网络</block>
  <block id="d078ae9a339971900f939db9e82f253d" category="paragraph">存储管理员有时倾向于通过从配置中删除网络交换机来简化其基础架构。在某些情况下、可以支持此功能。</block>
  <block id="14a07a9c146c886f1cf8b6ebd4b2b418" category="summary">通过ONTAP直接建立网络连接</block>
  <block id="a4e0be5abb980518338c55619fbfa4df" category="doc">与TCP/IP和FC网络直接连接</block>
  <block id="e817ecc2f82a2b78d828ec8704031da3" category="section-title">直连网络</block>
  <block id="f437881fa7e42bf0e4563bbec8176f81" category="paragraph">运行 ONTAP 软件的系统可以使用 ONTAP 存储服务质量功能来限制文件， LUN ，卷或整个 SVM 等不同存储对象的吞吐量（以 MBps 和 / 或每秒 I/O 数（ IOPS ）为单位）。</block>
  <block id="87e6f97c8ec2f31df616ef84401ffaf4" category="paragraph">追加信息 提供了多种故障排除资源。</block>
  <block id="52d04863ac62a6fa67e1b49a31086928" category="paragraph">以下各节概述了VMware SRM和ONTAP存储的最佳操作实践。</block>
  <block id="30b34ee8f62b7bf57684faae3645acc4" category="summary">了解采用NetApp ONTAP的vSphere Metro Storage Cluster</block>
  <block id="f24ef4a42850a2b3e3d77e610ae46fee" category="doc">计划内和计划外事件的故障恢复能力</block>
  <block id="4bce11924453ef2ee7e40109f79dc66d" category="paragraph">NetApp MetroCluster和SnapMirror主动同步是功能强大的工具，可提高NetApp硬件和ONTAP®软件的高可用性和无中断运行。</block>
  <block id="52f49b6400100ac4558d31582b90ca4e" category="paragraph">这些工具可为整个存储环境提供站点范围的保护、确保数据始终可用。无论您使用的是独立服务器、高可用性服务器集群、Docker容器还是虚拟化服务器、NetApp技术都可以在因断电、散热或网络连接中断、存储阵列关闭或操作错误而导致全面中断时无缝保持存储可用性。</block>
  <block id="d267775072875ddbb24c16a41c22d8a2" category="paragraph">MetroCluster和SnapMirror主动同步提供了三种在发生计划内或计划外事件时保持数据连续性的基本方法：</block>
  <block id="1d3027d09fc1db3087f05f2163af2cb7" category="list-text">冗余组件、用于防止出现单组件故障</block>
  <block id="f3b83f3b77289efe3b53cf537b7b77f5" category="list-text">影响单个控制器的事件的本地HA接管</block>
  <block id="b6ed0cba165f6f9664dc1e57ac3419ec" category="list-text">全面的站点保护—通过将存储和客户端访问从源集群移动到目标集群、快速恢复服务</block>
  <block id="16afcbe8821dfa582521cd62c1ec130d" category="paragraph">这意味着在单个组件发生故障时可以无缝地继续运行、并在更换故障组件后自动恢复为冗余操作。</block>
  <block id="8fab78e8b214cad43d962b802bf568f8" category="paragraph">除单节点集群(通常为软件定义的版本、例如ONTAP Select)之外、所有ONTAP集群都具有称为接管和交还的内置HA功能。集群中的每个控制器都会与另一个控制器配对、形成一个HA对。这些对可确保每个节点在本地连接到存储。</block>
  <block id="83e1749664841043ce8b1e894769a201" category="paragraph">接管是一个自动化过程、其中一个节点接管另一个节点的存储以维护数据服务。相反、恢复过程会恢复正常操作。接管可以是计划内的(例如在执行硬件维护或ONTAP升级时)、也可以是计划外的(因节点崩溃或硬件故障而导致)。</block>
  <block id="834d83f4ff04b7e3948831f336559b7c" category="paragraph">在接管期间、MetroCluster配置中的网络连接存储逻辑接口(NAS LUN)会自动进行故障转移。但是、存储区域网络Lifs (SAN Lifs)不会进行故障转移；它们将继续使用逻辑单元号(Logical Unit Number、LUN)的直接路径。</block>
  <block id="0b0403a9258293da1f6a5fc84d24a18e" category="inline-link">HA对管理概述</block>
  <block id="df5ca9bc3ee60e70aa9fd870a1ce1065" category="paragraph">有关HA接管和交还的详细信息、请参见<block ref="5a72801b431f75b7489a0e7de50680bf" category="inline-link-rx"></block>。值得注意的是、此功能并不特定于MetroCluster或SnapMirror活动同步。</block>
  <block id="cf654073ce9eb8f38d3f05292ed83cc5" category="paragraph">如果一个站点脱机或作为计划内活动进行站点范围维护、则会使用MetroCluster进行站点切换。另一个站点接管脱机集群的存储资源(磁盘和聚合)的所有权、故障站点上的SVM将联机并在灾难站点上重新启动、从而保留其完整身份、以供客户端和主机访问。</block>
  <block id="4dd2305dcb9d7412784238dd42dcdc21" category="paragraph">使用SnapMirror主动同步时、由于两个副本会同时使用、因此现有主机将继续运行。要确保正确进行站点故障转移、需要使用NetApp调解器。</block>
  <block id="823bd5c6c005e340599d915e134d851c" category="summary">VMware vSphere解决方案概述</block>
  <block id="be26d39d86de44047c65c1fed157d529" category="paragraph">vCenter Server Appliance (VCCSA)是一款功能强大的集中式管理系统和适用于vSphere的单一管理平台、可使管理员有效地运行ESXi集群。它有助于实现关键功能、例如VM配置、vMotion操作、高可用性(HA)、分布式资源计划程序(DRS)、Tanzu Kubernetes Grid等。它是VMware云环境中的一个重要组件、在设计时应考虑服务可用性。</block>
  <block id="8ba8694e23f6560a60d85c4de549122b" category="section-title">vSphere高可用性</block>
  <block id="4b5543b81af03f01e26fcb74614f7062" category="paragraph">VMware的集群技术可将ESXi服务器分组到虚拟机的共享资源池中、并提供vSphere High Availability (HA)。vSphere HA可为虚拟机中运行的应用程序提供易于使用的高可用性。在集群上启用HA功能后、每个ESXi服务器都会与其他主机保持通信、以便在任何ESXi主机无响应或隔离时、 HA集群可以在集群中的无故障主机之间协商恢复该ESXi主机上运行的虚拟机。如果子操作系统发生故障、vSphere HA会在同一物理服务器上重新启动受影响的虚拟机。借助vSphere HA、可以减少计划内停机、防止计划外停机并从中断中快速恢复。</block>
  <block id="01036edb3159652090a3f7149fe1ce2f" category="paragraph">vSphere HA集群从故障服务器中恢复VM。</block>
  <block id="15496c3917565cea1f21bbc7e6eba996" category="image-alt">VMSC示意图</block>
  <block id="c1bb7aa3a002a819d935439c7e347826" category="paragraph">请务必了解、VMware vSphere不了解NetApp MetroCluster或SnapMirror活动同步、并且会根据主机和VM组关联性配置、将vSphere集群中的所有ESXi主机视为符合HA集群操作条件的主机。</block>
  <block id="dcff37ab37f2cb6a72aeb3c30e3ed5aa" category="section-title">主机故障检测</block>
  <block id="7069d861b63dd4095cfb7b2ee30587f5" category="paragraph">创建HA集群后、集群中的所有主机都会参与选择、其中一个主机将成为主主机。每个从节点对主节点执行网络检测信号、而主节点则对所有从节点主机执行网络检测信号。vSphere HA集群的主主机负责检测从主机的故障。</block>
  <block id="73b629afd8ef39d8d0147696412538c8" category="paragraph">根据检测到的故障类型、可能需要对主机上运行的虚拟机进行故障转移。</block>
  <block id="e12cf4015a45ff29f1f84ae1a3ee0390" category="paragraph">在vSphere HA集群中、检测到三种类型的主机故障：</block>
  <block id="4eac346eb6cdd3a1a98ee9bc71ebccaa" category="list-text">故障—主机停止运行。</block>
  <block id="3875a4c584a7715edf4a221ce53d45fc" category="list-text">隔离—主机变为网络隔离。</block>
  <block id="82fba11358d642111efbcf36273159f2" category="list-text">分区-主机与主主机断开网络连接。</block>
  <block id="5f72ceebd161159fe623ff01ac0cf1b4" category="paragraph">主主机监控集群中的从主机。此通信通过每秒交换一次网络检测信号来完成。当主主机停止从从从主机接收这些检测信号时、它会先检查主机活动性、然后再声明主机出现故障。主主机执行的活动性检查用于确定从主机是否正在与某个数据存储库交换检测搏。此外、主主机还会检查该主机是否对发送到其管理IP地址的ICMP ping做出响应、以检测它是仅与其主节点隔离还是与网络完全隔离。它通过对默认网关执行pinging来实现此目的。可以手动指定一个或多个隔离地址、以提高隔离验证的可靠性。</block>
  <block id="5546466ab10e5cbfbc4b286cd60b8b4a" category="section-title">_最佳实践_</block>
  <block id="0456a7ce7bf92fb68980571fdd2defa1" category="paragraph">NetApp建议至少指定两个额外的隔离地址、并且每个地址都是站点本地地址。这将提高隔离验证的可靠性。</block>
  <block id="19c262cd1e1bb07c491e359333f04a29" category="section-title">主机隔离响应</block>
  <block id="7a2723aad08de3c674693adf221e4a48" category="paragraph">隔离响应是vSphere HA中的一项设置、用于确定当vSphere HA集群中的主机丢失其管理网络连接但仍继续运行时在虚拟机上触发的操作。此设置有三个选项："Disabled (禁用)"、"Shut Down and Restart VMs"(关闭并重新启动VM)和"Power Off and Restart VMs"(关闭并重新启动VM)。</block>
  <block id="715e310d886b45856c3ab0f69b06241b" category="paragraph">"Shut down (关闭)"优于"Power Off (关闭)"、后者不会刷新最近对磁盘所做的更改或提交事务。如果虚拟机在300秒内未关闭、则会将其关闭。要更改等待时间、请使用高级选项as.isolationshutdowntimeout。</block>
  <block id="620b4ae663a26c98656d1c81bec1a6c2" category="paragraph">在HA启动隔离响应之前、它会首先检查vSphere HA主代理是否拥有包含VM配置文件的数据存储库。否则、主机将不会触发隔离响应、因为没有主节点可重新启动VM。主机将定期检查数据存储库状态、以确定是否由具有主角色的vSphere HA代理声明数据存储库。</block>
  <block id="6824ef1b1c5e58e8ea5ebc8b2cf94be2" category="paragraph">NetApp建议将"主机隔离响应"设置为"已禁用"。</block>
  <block id="6bd7b146f345eefac88b336a89aa3754" category="paragraph">如果主机与vSphere HA主主机隔离或分区、并且主主机无法通过检测信号数据存储库或ping进行通信、则可能发生脑裂情况。主节点会声明隔离的主机已停止运行、并在集群中的其他主机上重新启动VM。现在存在脑裂情况、因为虚拟机有两个实例正在运行、其中只有一个实例可以读取或写入虚拟磁盘。现在、可以通过配置虚拟机组件保护(VM Component Protection、VMCP)来避免脑裂情况。</block>
  <block id="df05a421ed8ba49f97f18dc085495ee4" category="section-title">VM组件保护(VMCP)</block>
  <block id="1418d127ee81cc7f3e114029e9ba6856" category="paragraph">vSphere 6中与HA相关的一项增强功能是VMCP。VMCP可针对块(FC、iSCSI、FCoE)和文件存储(NFS)提供增强的保护、使其免受所有路径关闭(APD)和永久设备丢失(PDL)情况的影响。</block>
  <block id="fc35e15d00ef5b037a1a56c77ef3e17c" category="section-title">永久设备丢失(永久设备丢失)(财产和财产</block>
  <block id="967b20f28092443585be2b9649d0ba93" category="paragraph">如果存储设备永久出现故障或被管理员删除、并且不希望返回、则会出现上述情况。NetApp存储阵列向ESXi发出SCSI检测代码、声明设备已永久丢失。在vSphere HA的故障条件和VM响应部分中、您可以配置检测到无效条件后的响应。</block>
  <block id="7cf4fdbfc8e1deb9f567848f2df19e91" category="paragraph">NetApp建议将"Response for Data with PCL"(使用数据存储库的响应)设置为"*关闭并重新启动VMS*"。检测到这种情况后、VM将在vSphere HA集群中运行正常的主机上立即重新启动。</block>
  <block id="6d623de2ea8c5007def6f2349d9ad8b9" category="section-title">所有路径已关闭(APD)</block>
  <block id="15d2d9b1f25022e7080482582e155265" category="paragraph">APD是指主机无法访问存储设备且没有指向阵列的路径时发生的情况。ESXi认为此问题是设备的临时问题、并希望它能够再次可用。</block>
  <block id="f89caca297ba86d190d90ef30c409ccf" category="paragraph">检测到APD情况时、计时器将启动。140秒后、系统将正式声明APD条件、并且设备会标记为APD超时。超过140秒后、HA将开始计算VM故障转移APD延迟中指定的分钟数。指定时间过后、HA将重新启动受影响的虚拟机。您可以根据需要将VMCP配置为以不同方式响应("Disabled (已禁用)"、"VM Events (问题描述事件)"或"Power Off and Restart VM (关闭并重新启动VM)")。</block>
  <block id="8f179a61d789dab9b994ecd0ca8c53cb" category="paragraph">NetApp建议将"Response for Data with APD"配置为"*关闭并重新启动VM (保守)*"。</block>
  <block id="76d29c3c5f57a16a7f080459356c3793" category="paragraph">保守是指HA能够重新启动VM的可能性。如果设置为保守、则只有在HA知道其他主机可以重新启动受APD影响的虚拟机时、它才会重新启动该虚拟机。如果发生主动、即使HA不知道其他主机的状态、也会尝试重新启动虚拟机。如果任何主机都无法访问虚拟机所在的数据存储库、则可能导致虚拟机无法重新启动。</block>
  <block id="c64ef72a18526e28efe7c08b3ff3889a" category="paragraph">如果APD状态为已解决、并且在超时之前还原了对存储的访问、则HA不会不必要地重新启动虚拟机、除非您明确对此虚拟机进行配置。如果即使环境已从APD条件中恢复、也需要响应、则应将APD超时后APD恢复的响应配置为重置VM。</block>
  <block id="580bc3953adcf3e3a20c5497f67f8b2c" category="paragraph">NetApp建议将APD超时后APD恢复的响应配置为已禁用。</block>
  <block id="a067a9a0e98c97f62fba4698bde30edc" category="section-title">适用于NetApp MetroCluster的VMware DRS实施</block>
  <block id="3bf3e67966e8b0e07b0812dae7b86ce7" category="paragraph">VMware DRS是一项将主机资源聚合到集群中的功能、主要用于在虚拟基础架构中的集群内进行负载平衡。VMware DRS主要计算在集群中执行负载平衡所需的CPU和内存资源。由于vSphere无法识别延伸型集群、因此在进行负载平衡时、它会考虑两个站点中的所有主机。为了避免跨站点流量、NetApp建议配置DRS关联性规则、以管理VM的逻辑隔离。这样可以确保、除非完全发生站点故障、否则HA和DRS将仅使用本地主机。</block>
  <block id="b9e04f46a88c8139fbb91780a2ff9064" category="paragraph">如果为集群创建DRS关联性规则、则可以指定vSphere在虚拟机故障转移期间如何应用该规则。</block>
  <block id="f903d43a0acb7412db93e8201ab12be3" category="paragraph">您可以通过两种类型的规则来指定vSphere HA故障转移行为：</block>
  <block id="a96c8bab3a450bb828e3093d16f7e32c" category="list-text">VM反关联性规则会强制指定的虚拟机在故障转移操作期间保持分离状态。</block>
  <block id="1fa3a04279011cbc6001c96c0f6f27fb" category="list-text">在故障转移操作期间、VM主机关联性规则会将指定的虚拟机放置在特定主机或已定义主机组的成员上。</block>
  <block id="225e3f7204b6e5bf6cd388af7bb16eb4" category="paragraph">使用VMware DRS中的VM主机关联性规则、可以在站点A和站点B之间进行逻辑隔离、以便VM与配置为给定数据存储库的主读/写控制器的阵列在同一站点的主机上运行。此外、VM主机关联性规则还可以使虚拟机保持在存储本地、从而确保在站点间发生网络故障时虚拟机连接。</block>
  <block id="db03e2255e35df6fa9719c800850c397" category="paragraph">以下是VM主机组和关联性规则的示例。</block>
  <block id="6c9bd967c46984c9e5e0d8a6e5ec81a0" category="image-alt">自动生成的计算机服务器问题描述示意图</block>
  <block id="d400b2cf908bc5f979847146ff8ac816" category="paragraph">NetApp建议实施"应该"规则、而不是"必须"规则、因为如果发生故障、vSphere HA会违反这些规则。使用"必须"规则可能会导致服务中断。</block>
  <block id="e9503bc9ad84f6517ddc938c85541dd5" category="paragraph">服务的可用性应始终高于性能。如果完整数据中心发生故障、则"必须"规则必须从VM主机关联性组中选择主机、并且当数据中心不可用时、虚拟机不会重新启动。</block>
  <block id="b3c45603f3738ac1e1f8e1e87569c00c" category="section-title">使用NetApp MetroCluster实施VMware存储DRS</block>
  <block id="b273633ed947791e90b7b83ad1bb2021" category="paragraph">通过VMware Storage DRS功能、可以将数据存储库聚合到一个单元中、并在超过存储I/O控制阈值时平衡虚拟机磁盘。</block>
  <block id="4669dbcf4d42583b3fae1c79fa228078" category="paragraph">默认情况下、启用了存储DRS的DRS集群会启用存储I/O控制。通过存储I/O控制、管理员可以控制在I/O拥塞期间分配给虚拟机的存储I/O量、这样、在分配I/O资源时、更重要的虚拟机就可以优先于不太重要的虚拟机。</block>
  <block id="f06483bf36a941eebbb2f78a89b6bf68" category="paragraph">存储DRS使用Storage vMotion将虚拟机迁移到数据存储库集群中的不同数据存储库。在NetApp MetroCluster环境中、需要在该站点的数据存储库中控制虚拟机迁移。例如、在站点A的主机上运行的虚拟机A最好在站点A的SVM数据存储库中进行迁移否则、虚拟机将继续运行、但性能会下降、因为虚拟磁盘读/写操作将通过站点间链路从站点B进行。</block>
  <block id="e607d8c3dc392e521065e5494d8c85c6" category="paragraph">NetApp建议创建与存储站点关联性相关的数据存储库集群；也就是说、与站点A具有站点关联性的数据存储库不应与与与站点B具有站点关联性的数据存储库的数据存储库集群混用</block>
  <block id="63fe88e257ae2d072b6920d6dbcf0818" category="paragraph">每当使用Storage vMotion新配置或迁移虚拟机时、NetApp建议相应地手动更新特定于这些虚拟机的所有VMware DRS规则。这样可以确定主机和数据存储库在站点级别的虚拟机关联性、从而降低网络和存储开销。</block>
  <block id="b6cd969550b5501b0f62a149fb7964ce" category="paragraph">ONTAP 9.8 增加了对 vSphere 中 FlexGroup 数据存储库的支持，并增加了适用于 VMware vSphere 9.8 版本的 ONTAP 工具。</block>
  <block id="4adcd8d9323839ff088dc4f8f0bdcce2" category="paragraph">为VM创建Vvol存储需要执行几个步骤。</block>
  <block id="2438f6a80b933cf058ad052d26ac0703" category="paragraph">通过克隆存储对象，您可以快速创建副本以供将来使用，例如配置其他 VM ，备份 / 恢复操作等。</block>
  <block id="1a795345e422d7dbcca8fe38671a9371" category="summary">《VMSC设计和实施准则》。</block>
  <block id="b73deaadc37ea1c7a13ad17af6730c42" category="doc">《VMSC设计和实施准则》</block>
  <block id="3512760e2d3fc1a9dd2116e83bb0cada" category="paragraph">本文档概述了使用ONTAP存储系统的VMSC的设计和实施指南。</block>
  <block id="556669df5b5073ab3d2ddcf638e942d9" category="section-title">NetApp存储配置</block>
  <block id="7f4d4fbe08a8a895671d05c4a82b0c85" category="inline-link">MetroCluster 文档</block>
  <block id="002eb41870df47521a2b59424d251f60" category="inline-link">SnapMirror 业务连续性概述</block>
  <block id="008c17a2bb74d3d9706c0f2c88499240" category="paragraph">有关NetApp MetroCluster (称为MCC配置)的设置说明、请参见<block ref="2c736bccede87dae47dcf61108f083c4" category="inline-link-rx"></block>。有关SnapMirror活动同步的说明、请参见<block ref="14203840309dd1b6e13f73373477bb9d" category="inline-link-rx"></block>。</block>
  <block id="447566f62201eb825a1f6fb7a570873f" category="paragraph">配置MetroCluster后、对其进行管理就像管理传统ONTAP环境一样。您可以使用命令行界面(CLI)、System Manager或Ans得 等各种工具设置Storage Virtual Machine (SVM)。配置SVM后、在集群上创建要用于正常操作的逻辑接口(Logical Interface、Li)、卷和逻辑单元号(Logical Unit Number、LUN)。这些对象将自动通过集群对等网络复制到另一个集群。</block>
  <block id="b5486be95ed9ae2e4681a39cf8fe8041" category="inline-link">一致性组概述</block>
  <block id="5440d8600dfca322be65444d14c4566f" category="paragraph">如果不使用MetroCluster、则可以使用SnapMirror主动同步、它可以在不同故障域的多个ONTAP集群之间提供数据存储库粒度保护和主动-主动访问。SnapMirror主动同步使用一致性组来确保一个或多个数据存储库之间的写入顺序一致性、您可以根据应用程序和数据存储库要求创建多个一致性组。对于需要在多个数据存储库之间同步数据的应用程序、一致性组尤其有用。SnapMirror主动同步还支持原始设备映射(Raw Device Mapping、RDM)以及子系统连接的存储(具有子系统内iSCSI启动程序)。有关一致性组的详细信息、请参见<block ref="8bba9b5b97dba092834d7a48a07f102d" category="inline-link-rx"></block>。</block>
  <block id="f9ac6f5e1bf01f1df914b714d5e6cb02" category="paragraph">与MetroCluster相比、使用SnapMirror活动同步管理VMSC配置有一些不同。首先、这是一种仅SAN配置、任何NFS数据存储库都无法通过SnapMirror主动同步进行保护。其次、您必须将两个LUN副本映射到ESXi主机、以使其能够访问这两个故障域中复制的数据存储库。</block>
  <block id="c972b11c861e42787c05a2ee24828e3a" category="section-title">VMware vSphere HA</block>
  <block id="57166da54d8751e1ed084f00b3f169e3" category="section-title">创建vSphere HA集群</block>
  <block id="829006223e7bdcfd478d2261f1d5ac40" category="inline-link">如何在docs.vmware.com上的vSphere Client中创建和配置集群</block>
  <block id="2bbae4763835d2e2dd123c1b4b0ae73d" category="paragraph">创建vSphere HA集群是一个多步骤过程、有关详细信息、请参见<block ref="dd51ccd863dd3c9fbca770681f8e68a9" category="inline-link-rx"></block>。简而言之、您必须先创建一个空集群、然后使用vCenter添加主机并指定集群的vSphere HA和其他设置。</block>
  <block id="d50e63b9f70efedde8dc093be8ec12b2" category="inline-link">VMware vSphere Metro Storage Cluster 建议的实践</block>
  <block id="33d532b774d7b67104f4749e25ba03ef" category="paragraph">*注：*本文档中的任何内容均不可取代<block ref="3a8301f60ad04eb873ae8dea15ee0495" category="inline-link-rx"></block></block>
  <block id="950954623b197b80e3ebb95b0adcc3de" category="paragraph">要配置HA集群、请完成以下步骤：</block>
  <block id="1073102bd8c6cbd17340f2a19043583f" category="list-text">连接到vCenter UI。</block>
  <block id="ebf69ea3a3e34739bde13d589e85ef10" category="list-text">在主机和集群中、浏览到要创建HA集群的数据中心。</block>
  <block id="d8fd85bbc0cd4746e5d80e291696b86c" category="list-text">右键单击数据中心对象、然后选择"New Cluster"(新建集群)。在基础下、确保已启用vSphere DRS和vSphere HA。完成向导。</block>
  <block id="f2c634ca704e26f96be1723db6dda32a" category="image-alt">自动生成的计算机问题描述的屏幕截图</block>
  <block id="f4f59bf1e324854573172ca2b5070d45" category="list-text">选择集群并转到配置选项卡。选择vSphere HA、然后单击编辑。</block>
  <block id="329c69e52a7de6215aa4dbfa19940f2d" category="list-text">在"Host Monitoring"(主机监控)下、选择"Enable Host Monitoring"(启用主机监控)选项。</block>
  <block id="9fc231ac455a53f2fabc59f29ab537ad" category="list-text">仍在故障和响应选项卡上的VM监控下、选择仅VM监控选项或VM和应用程序监控选项。</block>
  <block id="58aea8c81a7e8b8160584574af309fbb" category="list-text">在"Admission Control"(准入控制)下、将HA准入控制选项设置为"Cluster Resource resource"(集群资源预留)；使用50% CPU/MEM。</block>
  <block id="d94a9f01bee7dcc2643864bf92ab4e59" category="list-text">单击"OK"(确定)。</block>
  <block id="3f059eee365aa5c64c0be1d6dba81d69" category="list-text">选择DRS并单击编辑。</block>
  <block id="7b5f9be03fd1421a9da56c2c7677ad69" category="list-text">除非您的应用程序要求、否则请将自动化级别设置为手动。</block>
  <block id="a8ee10582e28e3623629963a88ff5ec9" category="image-alt">VMSC 3 5.</block>
  <block id="256164bb48582e5267e408f2e67e1939" category="inline-link">docs.vmware.com</block>
  <block id="91fb89f03b846483f7108d3f1bfb0156" category="list-text">启用VM组件保护、请参见<block ref="fc88c93ad20ad804a211f4e6fea63e56" category="inline-link-rx"></block>。</block>
  <block id="918c2d8e02dbd2c1f4cc3a0062690387" category="list-text">对于采用MCC的VMSC、建议使用以下附加vSphere HA设置：</block>
  <block id="d64ed3e9c10229648e069f56e32f4c8e" category="cell">响应</block>
  <block id="f3c1d0e4118d5d9501e1a7aeed19d224" category="cell">主机故障</block>
  <block id="45d583cd5692c76d45e96536edce2a0e" category="cell">重新启动VM</block>
  <block id="1c3a7ae924920b573baede481becd22f" category="cell">主机隔离</block>
  <block id="2e011e74abc75a2823c627b7ee9e22a7" category="cell">具有永久设备丢失(永久设备丢失)的数据存储库</block>
  <block id="49476a1ad365d5f8deb36464de7fe33b" category="cell">关闭并重新启动VM</block>
  <block id="e7bbd35db169028c75e7c8ae655bf6ae" category="cell">所有路径均已关闭的数据存储库(APD)</block>
  <block id="e7480b00a5e3efd904a08ca88804de45" category="cell">子系统不检测信号</block>
  <block id="e8896c595f3effde37ef29d7c6233703" category="cell">重置虚拟机</block>
  <block id="59695df3d45a3a21b8ff0bf57fda6a2b" category="cell">VM重新启动策略</block>
  <block id="a150f56b87fd99bf9bf019f8447ba68b" category="cell">由虚拟机的重要性决定</block>
  <block id="370a480458a8c63a838940f1241e14ee" category="cell">主机隔离响应</block>
  <block id="11f30f9be08cd4f9e500290222ddc552" category="cell">关闭并重新启动VM</block>
  <block id="fb53fafa45c0de9bd41d368c7455c9f1" category="cell">对使用了基于数据存储库的数据存储库的响应</block>
  <block id="d7c3b9f5568eb60f08076b29490afcaf" category="cell">使用APD响应数据存储库</block>
  <block id="423b2d98eae113ae3391aa0b12f11935" category="cell">关闭并重新启动VM (保守)</block>
  <block id="132bbe6dbceb01227dba5ab04db7202b" category="cell">APD的VM故障转移延迟</block>
  <block id="8d15ed7d27d83ed6229a66b1f44b7696" category="cell">3分钟</block>
  <block id="8c7b0644547f0ee3fe537e8ba441566d" category="cell">响应APD恢复并显示APD超时</block>
  <block id="4dea08318b2824f845e9b889a6e17778" category="cell">VM监控敏感度</block>
  <block id="f535a28adc173e28610c129d0dc578ae" category="cell">预设为高</block>
  <block id="83164803a765d1ea1f10d50dfdd26130" category="section-title">配置用于检测信号的存储库</block>
  <block id="22c81b09ec3086b2dce8f68867a221e0" category="paragraph">当管理网络出现故障时、vSphere HA使用数据存储库监控主机和虚拟机。您可以配置vCenter选择检测信号数据存储库的方式。要为数据存储库配置检测信号、请完成以下步骤：</block>
  <block id="64809e5386c9dc53f894f772f27d1b44" category="list-text">在数据存储库检测信号部分中、选择使用指定列表中的数据存储库并根据需要自动完成。</block>
  <block id="fc66ba7317ceb4220dc88aa267db085d" category="list-text">从两个站点中选择要vCenter使用的数据存储库、然后按OK。</block>
  <block id="1d2b14769d080b9214d9e407dfc92a64" category="section-title">配置高级选项</block>
  <block id="a22b9827e1a78c5fb9c939a78c116a05" category="paragraph">*主机故障检测*</block>
  <block id="a9316d69e5abcfaffc56fc8f5e645412" category="paragraph">如果HA集群中的主机与网络或集群中的其他主机断开连接、则会发生隔离事件。默认情况下、vSphere HA将使用其管理网络的默认网关作为默认隔离地址。但是、您可以为要执行ping操作的主机指定其他隔离地址、以确定是否应触发隔离响应。添加两个可执行ping操作的隔离IP、每个站点一个。请勿使用网关IP。使用的vSphere HA高级设置为"as.isolationaddress"。为此、您可以使用ONTAP或调解器IP地址。</block>
  <block id="102d7879ceca393c309ef492c958e19d" category="inline-link">core.vmware.com</block>
  <block id="27e2292ff6db48ed2e6d50b256eae43e" category="paragraph">请参见<block ref="43057df4f3a6b5f2fffe8b7c5a490646" category="inline-link-rx"></block> 有关详细信息__.__</block>
  <block id="3f44bb4a3b9420d495e400b9afbda2c7" category="paragraph">添加名为ds.heartbeatDsPerHost的高级设置可以增加检测信号数据存储库的数量。使用四个检测信号数据存储库(HB DSS)—每个站点两个。使用“从列表中选择但恭维”选项。这是必需的、因为如果一个站点发生故障、您仍需要两个HB DSS。但是、这些数据不必通过MCC或SnapMirror主动同步进行保护。</block>
  <block id="eaa1dfe3982e06655ce64e240c139b81" category="paragraph">适用于NetApp MetroCluster的VMware DRS关联</block>
  <block id="e32221c52eb3b0bbeb3ca79aad6c90f6" category="paragraph">在本节中、我们将为MetroCluster环境中每个站点\集群的VM和主机创建DRS组。然后、我们配置VM\Host规则、使VM主机与本地存储资源的关联性保持一致。例如、站点A的VM属于VM组sitea_vm、站点A的主机属于主机组sitea_hosts。接下来、在VM\Host规则中、我们说明site_vm应在sitea_hosts中的主机上运行。</block>
  <block id="5bfa0d712f66aef47f8a2ea582bc0b72" category="list-text">NetApp强烈建议使用规范“*应在组中的主机上运行”，而不是规范“必须在组中的主机上运行”。如果站点A主机发生故障、则需要通过vSphere HA在站点B的主机上重新启动站点A的VM、但后一种规范不允许HA重新启动站点B上的VM、因为这是一条硬规则。前一种规范是一种软规则、在发生HA时会违反该规范、从而实现可用性而非性能。</block>
  <block id="cc6a363013bd2a8c1e05304f1c6abd79" category="inline-link">vSphere监控和性能</block>
  <block id="db9540392e62211ad47ebec39232329e" category="paragraph">*注意：*您可以创建基于事件的警报，当虚拟机违反VM-主机关联性规则时触发该警报。在vSphere Client中、为虚拟机添加新警报、然后选择"VM is violating VM-Host Affinity Rule "作为事件触发器。有关创建和编辑警报的详细信息、请参见<block ref="d28eed239632aed40803fe0ed2311ba6" category="inline-link-rx"></block> 文档。</block>
  <block id="124de7d2bc72d75be9e481c1cc56ada2" category="section-title">创建DRS主机组</block>
  <block id="0759e9476d3bf1868f88356025adafb2" category="paragraph">要创建特定于站点A和站点B的DRS主机组、请完成以下步骤：</block>
  <block id="a69dff3dd4b284f60243dfd62fa4e57f" category="list-text">在vSphere Web Client中、右键单击清单中的集群、然后选择设置。</block>
  <block id="a130b4af254ead99e9ea83044e54ea1d" category="list-text">单击VM\Host Groups。</block>
  <block id="1bb250fbf1946dd1bd7ad228032f8803" category="list-text">单击添加。</block>
  <block id="62c4d1538f957af2951f2c93ee191d0b" category="list-text">键入组的名称(例如、sitea_hosts)。</block>
  <block id="df22605898fc890edbcb2a126aa202ce" category="list-text">从类型菜单中、选择主机组。</block>
  <block id="57c0028584902f6cee210dcc13bc9745" category="list-text">单击Add、然后从站点A中选择所需主机、然后单击OK。</block>
  <block id="583e6d8c3b1006b0561d4b360e58994f" category="list-text">重复上述步骤、为站点B添加另一个主机组</block>
  <block id="18d0ad44a1e563aaf9f5871e32535a6c" category="list-text">单击确定。</block>
  <block id="154964ee7fc6d3261ec55811b0ff9972" category="section-title">创建DRS VM组</block>
  <block id="40c1eaba5f178f243c57b595b6af4d5e" category="paragraph">要创建特定于站点A和站点B的DRS VM组、请完成以下步骤：</block>
  <block id="9a209a741c26968fc13ed8192523df15" category="list-text">键入组的名称(例如、sitea_VMs.)。</block>
  <block id="f947c7c9f173289b1c2565b3297095f0" category="list-text">从Type菜单中、选择VM Group。</block>
  <block id="40a2a21a084c8d16395113cb79a19ebb" category="list-text">单击添加并从站点A选择所需的VM、然后单击确定。</block>
  <block id="e2e7af699096077fe178ebf021fb2273" category="section-title">创建VM主机规则</block>
  <block id="0a6075f3d3fdbe7c133268face0f5c82" category="paragraph">要创建特定于站点A和站点B的DRS相关性规则、请完成以下步骤：</block>
  <block id="df4f9bcca0ceb7a67ba25d886a18743b" category="list-text">单击VM\Host Rule。</block>
  <block id="876a25c102b5c301814921d1a9c0e625" category="list-text">键入规则的名称(例如、sitea_affinity)。</block>
  <block id="d4b5f57f4e2bd5c357ad9b1fbdc2cf8e" category="list-text">验证是否已选中"Enable Rule (启用规则)"选项。</block>
  <block id="d1169f525bd934df7f1a7e3bcf401997" category="list-text">从类型菜单中、选择虚拟机到主机。</block>
  <block id="77328c16c697ce1d6c036c3f950e7542" category="list-text">选择VM组(例如、sitea_vm)。</block>
  <block id="b36943ce975d4c5c6e9481a4ca396270" category="list-text">选择主机组(例如、sitea_hosts)。</block>
  <block id="32fbcb32cfae9a0656233943c28f7c94" category="list-text">重复上述步骤、为站点B添加另一个VM\Host规则</block>
  <block id="ff0ded925b170243e5154c9a687bb925" category="section-title">适用于NetApp MetroCluster的VMware vSphere存储DRS</block>
  <block id="b0cb5ad168b84040eff8132c70e41fdb" category="section-title">创建数据存储库集群</block>
  <block id="488f70e76f3c9ddf155b693e31c5a1e1" category="paragraph">要为每个站点配置数据存储库集群、请完成以下步骤：</block>
  <block id="1dfbc2b980c0b56a5d9889c6d9a25460" category="list-text">使用vSphere Web Client、浏览到"Storage"(存储)下HA集群所在的数据中心。</block>
  <block id="dfc332b252ad3de167b6a336d7e70d46" category="list-text">右键单击数据中心对象、然后选择"Storage"(存储)&gt;"New Datastore Cluster"(新建数据存储库集群)。</block>
  <block id="7ce7f4ad7022187801efdf33d1fab92d" category="list-text">选择"Turn on Storage DRs"(打开存储DRS)选项、然后单击"Next"(下一步)。</block>
  <block id="6196801f8f77bab7132531adbb268512" category="list-text">将所有选项设置为无自动化(手动模式)、然后单击下一步。</block>
  <block id="cfcdd0a8a765af314fb460ad445fb375" category="list-text">NetApp建议在手动模式下配置存储DRS、以便管理员能够决定和控制何时需要进行迁移。</block>
  <block id="dfffe1ce0daeb61f9fbc153ae4945fd4" category="image-alt">自动生成文本问题描述的特写</block>
  <block id="51a3bc726f294f3376fcaa12ccdf8b3b" category="list-text">验证是否已选中为SDRS建议启用I/O指标复选框；指标设置可以保留默认值。</block>
  <block id="829b62dbd6a4923b66591b2bff38ed5b" category="list-text">选择HA集群、然后单击"Next"(下一步)。</block>
  <block id="30fe6cfa0a4c5fb23fccfe149cefc006" category="list-text">选择属于站点A的数据存储库、然后单击下一步。</block>
  <block id="4ea461b22638db4c94aa076d62a2065f" category="list-text">查看选项、然后单击完成。</block>
  <block id="7b79e97caff76847cf350f1197c49953" category="list-text">重复上述步骤以创建站点B数据存储库集群、并验证是否仅选择了站点B的数据存储库。</block>
  <block id="d8f83b09bd6b864f22076c109cfaae66" category="section-title">vCenter Server可用性</block>
  <block id="605b8c1efcf2de9164e5d5425c67bdcd" category="paragraph">您的vCenter Server设备(VCSA)应通过vCenter HA进行保护。通过vCenter HA、您可以在一个主动-被动HA对中部署两个VCSA。每个故障域一个。您可以在上阅读有关vCenter HA的更多信息<block ref="173ca8434bdf39dd0a60efe576d066cd" category="inline-link-rx"></block>。</block>
  <block id="2b6203f34def274ff7424bf1d64a9bca" category="paragraph">在将 vSphere 与运行 ONTAP 软件的系统结合使用时，配置网络设置非常简单，与其他网络配置类似。</block>
  <block id="70901a02a148fd2dfc1ff5736f4f5336" category="list-text">将存储网络流量与其他网络分开。可以通过使用专用 VLAN 或单独的存储交换机来实现单独的网络。如果存储网络共享上行链路等物理路径，您可能需要 QoS 或其他上行链路端口来确保带宽充足。请勿将主机直接连接到存储；使用交换机提供冗余路径、并允许VMware HA在没有干预的情况下运行。请参见 <block ref="2d54da766c3f840b00eab5923273fca5" category="inline-link-macro-rx"></block> 适用于追加信息 。</block>
  <block id="ed895c1c16c46a33c1fb8d980afb4d4b" category="list-text">当前支持的所有VMware vSphere版本均可同时使用NFS v3和v4.1。vSphere 8.0 Update 2 for NFS v3新增了对nconnect的官方支持。对于NFS v4.1、vSphere仍支持会话中继、Kerberos身份验证和具有完整性的Kerberos身份验证。请务必注意、会话中继需要ONTAP 9.14.1或更高版本。</block>
  <block id="83d007e105712dc05dcf363c7151dba1" category="paragraph">值得注意的是、NFSv3和NFSv4.1使用不同的锁定机制。NFSv3使用客户端锁定、而NFSv4.1使用服务器端锁定。虽然ONTAP卷可以通过这两种协议导出、但ESXi只能通过一种协议挂载数据存储库。但是、这并不意味着其他ESXi主机不能通过其他版本挂载同一数据存储库。为了避免出现任何问题、请务必指定挂载时要使用的协议版本、以确保所有主机使用相同版本、从而使用相同的锁定模式。请务必避免在主机之间混用NFS版本。如果可能、请使用主机配置文件检查合规性。
**由于NFSv3和NFSv4.1之间不会自动转换数据存储库，因此请创建一个新的NFSv4.1数据存储库并使用Storage vMotion将VM迁移到新数据存储库。
**请参阅中的NFS v4.1互操作性表说明<block ref="8813559f5b95abb5411182be29200aff" category="inline-link-rx"></block> 支持所需的特定 ESXi 修补程序级别。
* NFS导出策略用于控制vSphere主机的访问。您可以对多个卷（数据存储库）使用一个策略。对于 NFSv3 ， ESXi 使用 sys （ UNIX ）安全模式，并需要根挂载选项来执行 VM 。在 ONTAP 中，此选项称为超级用户，使用超级用户选项时，无需指定匿名用户 ID 。请注意、的导出策略规则具有不同的值<block ref="ea72d12ecaa06afdb0c8a3b15e485e95" prefix=" " category="inline-code"></block> 和<block ref="df809a941c1287d18c08bb5927b639dc" prefix=" " category="inline-code"></block> ONTAP 工具是否存在发生原因 SVM发现问题。下面是一个策略示例：
**访问协议：nfs3.
**客户端匹配规范：192.168.42.21
** RO访问规则：sys.
** RW访问规则：sys.
**匿名UID
**超级用户：sys
*如果使用适用于VMware VAAI的NetApp NFS插件、则此协议应设置为<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block> 创建或修改导出策略规则时。要使VAAI副本卸载正常工作、需要使用NFSv4协议、并将协议指定为<block ref="2521ef5d58fc027d3121662b7d8f9ac2" prefix=" " category="inline-code"></block> 自动包括NFSv3和NFSv4版本。
* NFS数据存储库卷从SVM的根卷接合；因此、ESXi还必须有权访问根卷以导航和挂载数据存储库卷。根卷以及嵌套了数据存储库卷接合的任何其他卷的导出策略必须包含一条或多条适用于ESXi服务器的规则、以便为其授予只读访问权限。下面是根卷的示例策略、该策略也使用VAAI插件：
**访问协议：NFS (包括nfs3和nfs4)
**客户端匹配规范：192.168.42.21
** RO访问规则：sys.
** RW Access Rule：Never (根卷的最佳安全性)
**匿名UID
**超级用户：sys (使用VAAI的根卷也需要此功能)
*使用适用于VMware vSphere的ONTAP工具(最重要的最佳实践)：
**使用适用于VMware vSphere的ONTAP工具配置数据存储库，因为它可以简化导出策略的自动管理。
**使用此插件为VMware集群创建数据存储库时，请选择此集群，而不是单个ESX服务器。选择此选项会将数据存储库自动挂载到集群中的所有主机。
**使用插件挂载功能将现有数据存储库应用于新服务器。
**如果不使用适用于VMware vSphere的ONTAP工具，请对所有服务器或需要额外访问控制的每个服务器群集使用一个导出策略。
*虽然ONTAP提供了一种灵活的卷命名空间结构、可通过接合将卷排列在树中、但此方法对于vSphere没有任何价值。无论存储的命名空间层次结构如何，它都会在数据存储库的根目录下为每个 VM 创建一个目录。因此，最佳实践是，只需将 vSphere 卷的接合路径挂载到 SVM 的根卷，即适用于 VMware vSphere 的 ONTAP 工具如何配置数据存储库。如果没有嵌套的接合路径，也意味着任何卷都不依赖于根卷以外的任何卷，即使有意使某个卷脱机或销毁该卷，也不会影响指向其他卷的路径。
*对于NFS数据存储库上的NTFS分区、块大小为4k即可。下图显示了从 vSphere 主机到 ONTAP NFS 数据存储库的连接。</block>
  <block id="59cfc5aaa0678bcb883492b4397c71b8" category="cell">是(ONTAP 9.14.1)</block>
  <block id="f37fed71aa90eb80f77d4f14b0ee295b" category="summary">采用NetApp ONTAP的vSphere Metro存储集群</block>
  <block id="a58c81d13cac4e9b37bba2bd7fc3a93d" category="paragraph">VMware行业领先的vSphere虚拟机管理程序可部署为延伸型集群、称为vSphere Metro Storage Cluster (VMSC)。</block>
  <block id="e5239709587bb3ebb34629be6c41ac7b" category="paragraph">NetApp®MetroCluster™和SnapMirror主动同步(以前称为SnapMirror业务连续性或SMBC)均支持VMSC解决方案，如果一个或多个故障域发生完全中断，则可以提供高级业务连续性。不同故障模式的故障恢复能力取决于您选择的配置选项。</block>
  <block id="e3224e391e08365c1593c07b9fe99cfa" category="section-title">适用于vSphere环境的持续可用性解决方案</block>
  <block id="e724bf1a385b292b55017a9963682b40" category="paragraph">NetApp ONTAP架构是一个灵活且可扩展的存储平台、可为数据存储库提供SAN (FCP、iSCSI和NVMe-oF)和NAS (NFS v3和v4.1)服务。NetApp AFF、ASA和FAS存储系统使用ONTAP操作系统为子系统存储访问提供其他协议、例如S3和SMB/CCIFS。</block>
  <block id="ffa76ec5527e36c51f49fe091541cca6" category="paragraph">NetApp MetroCluster使用NetApp的HA (控制器故障转移或CFO)功能来防止控制器发生故障。它还包括本地SyncMirror技术、灾难时集群故障转移(控制器按需故障转移或CFOD)、硬件冗余和地理分隔、以实现高可用性。SyncMirror通过将数据写入两个丛(本地磁盘架上主动提供数据的本地丛和通常不提供数据的远程丛)、在MetroCluster配置的两部分之间同步镜像数据。所有MetroCluster组件(例如控制器、存储、缆线、交换机(用于光纤MetroCluster)和适配器)都具有硬件冗余。</block>
  <block id="54823008c0a63d8491d2c84e13356f84" category="paragraph">NetApp SnapMirror主动同步可通过FCP和iSCSI SAN协议提供数据存储库粒度保护、从而使您可以有选择地仅保护高优先级工作负载。与主动-备用解决方案NetApp MetroCluster不同、它可以同时对本地和远程站点进行主动-主动访问。目前、主动同步是一种非对称解决方案、其中一方优先于另一方、可提供更好的性能。这可通过ALOA (非对称逻辑单元访问)功能来实现、ALOA功能会自动通知ESXi主机首选控制器。但是、NetApp已宣布活动同步很快将启用完全对称访问。</block>
  <block id="d3e911c902a6b066f9c31d471d16fb21" category="paragraph">要在两个站点之间创建VMware HA/DRS集群、需要使用vCenter Server Appliance (VCA)来管理ESXi主机。vSphere管理、vMotion®和虚拟机网络通过两个站点之间的冗余网络进行连接。管理HA/DRS集群的vCenter Server可以连接到两个站点上的ESXi主机、并且应使用vCenter HA进行配置。</block>
  <block id="da76be2bc20d4e043d9a2019b817214f" category="inline-link">如何在vSphere Client中创建和配置集群</block>
  <block id="e02f3e9258a23204655bd512ec53911d" category="paragraph">请参见<block ref="c06ae090600e7aa086edfa28514435e7" category="inline-link-rx"></block> 配置vCenter HA。</block>
  <block id="bdd88c75f085534f6e2cdc7726cf1dd6" category="paragraph">您还应参考<block ref="3a8301f60ad04eb873ae8dea15ee0495" category="inline-link-rx"></block>。</block>
  <block id="7ed2d453d67762a9f20ad13c2f472fcb" category="section-title">什么是vSphere Metro Storage Cluster？</block>
  <block id="38910d3dab2318849fd5f1a1dfbe0152" category="inline-link">《VMware存储兼容性指南》</block>
  <block id="eab65c9bc6c74eff9aee0d7f0c44276d" category="paragraph">vSphere Metro Storage Cluster (VMSC)是一种经过认证的配置、可保护虚拟机(VM)和容器免受故障的影响。这可以通过使用延伸型存储概念以及分布在不同故障域(例如机架、建筑物、园区甚至城市)中的ESXi主机集群来实现。NetApp MetroCluster和SnapMirror主动同步存储技术用于分别为主机集群提供RPO = 0或接近RPO = 0的保护。VMSC配置旨在确保数据始终可用、即使完整的物理或逻辑"站点"发生故障也是如此。在成功完成VMSC认证过程后、属于VMSC配置的存储设备必须经过认证。可在中找到所有受支持的存储设备<block ref="293ceee3268d7991d7fe245e02c1c5c9" category="inline-link-rx"></block>。</block>
  <block id="838b66b875df1b432ac420a98cba3db6" category="paragraph">如果您需要有关vSphere Metro Storage Cluster设计准则的详细信息、请参阅以下文档：</block>
  <block id="07aaf2aebfd07b8763284018d1ebbf57" category="inline-link">NetApp MetroCluster支持VMware vSphere</block>
  <block id="a4a5fd5b00daf98bd381d80257378acd" category="list-text"><block ref="a4a5fd5b00daf98bd381d80257378acd" category="inline-link-rx"></block></block>
  <block id="c3dc11e39d996a00b095022f4e56583d" category="inline-link">VMware vSphere支持NetApp SnapMirror业务连续性</block>
  <block id="8f675397d9c0ef95aa8b3f0ada9d601a" category="list-text"><block ref="f53214cfd764fa0267c92323be0d7337" category="inline-link-rx"></block> (现在称为SnapMirror活动同步)</block>
  <block id="ee0a206d2287c89b2a7b780e07929b81" category="paragraph">根据延迟注意事项、可以将NetApp MetroCluster部署在两种不同的配置中以用于vSphere：</block>
  <block id="b553530def78406c0977f70d5e90b9e8" category="list-text">延伸型MetroCluster</block>
  <block id="2d90abe978ed8084d304295ad0a8c8fd" category="list-text">光纤MetroCluster</block>
  <block id="b03023e82bda6a71adc49c4834e3b6ab" category="paragraph">下图展示了延伸型MetroCluster的高层面拓扑图。</block>
  <block id="b0c20dc8226bb49f35f0f68f7ef77bba" category="image-alt">带有MCC的VMSC示意图</block>
  <block id="119be031ef4485d20c7683d291d0e9f6" category="inline-link">MetroCluster 文档</block>
  <block id="ad9122c6d75ebaa024669fde1c0bdfb8" category="paragraph">请参见<block ref="d8a206747dbcec13122724b2aee18957" category="inline-link-rx"></block> 了解MetroCluster的特定设计和部署信息。</block>
  <block id="b47354fcd7d17ab4fbb3283f71677efe" category="paragraph">SnapMirror主动同步也可以通过两种不同的方式进行部署。</block>
  <block id="314084a577b998d8089dff72c98c58b0" category="list-text">非对称</block>
  <block id="40e2e641bad11918585c3dd4f76c2716" category="list-text">对称(ONTAP 9.14.1中的私有预览)</block>
  <block id="b9ca5ba97cf75d3dafb51f78e073770a" category="inline-link">NetApp文档</block>
  <block id="1c71125ba0668792e46d93c17dc6c428" category="paragraph">请参见<block ref="9ace5d3ebe2fe57037322de54ac9a869" category="inline-link-rx"></block> 有关SnapMirror活动同步的特定设计和部署信息、请参见。</block>
  <block id="bca8b52c503406abc3e9e50c5352d0a2" category="paragraph">本文档介绍了VMware行业领先的灾难恢复(Disaster Recovery、DR)软件ONTAP 解决方案for VMware Site Recovery Manager (SRM)、其中包括可简化部署、降低风险和简化日常管理的最新产品信息和最佳实践。</block>
  <block id="4f46fffb0ac7017fd2b42c10d6aa03fc" category="paragraph">备份虚拟机并快速恢复虚拟机是 ONTAP for vSphere 的一项强大优势，使用适用于 VMware vSphere 的 SnapCenter 插件在 vCenter 中轻松管理此功能。</block>
  <block id="3a021eaaeb6692340890af4de2f7514a" category="paragraph">以下各节将介绍VMware和ONTAP SRM的部署最佳实践。</block>
  <block id="ff53ee8001042abcefe5c912d0b5012f" category="doc">vSphere 数据存储库和协议功能</block>
  <block id="b69cd5a82aaf0c524a71d46ec6fdd29c" category="cell">NFS v4.1会话中继需要ONTAP 9.14.1及更高版本</block>
  <block id="80303385ad0f7147caa1af6d2162852b" category="paragraph">该插件也是适用于 ONTAP 的 VASA Provider 的许多功能的管理界面，支持使用 VVOL 进行基于存储策略的管理。注册适用于 VMware vSphere 的 ONTAP 工具后，可使用它创建存储功能配置文件，将其映射到存储，并确保数据存储库随时间的推移符合这些配置文件。VASA Provider 还提供了一个用于创建和管理 VVol 数据存储库的界面。</block>
  <block id="83fe2b10c55a47a84465ff5a93a3feda" category="list-text">从ONTAP 9.14.1开始、VMware和NetApp当前支持NFSv4.1会话中继。有关特定版本的详细信息、请参见NetApp NFS 4.1互操作性表说明。从vSphere 8.0U2开始、NFSv3不支持卷的多个物理路径、但支持nconnect。对于采用ONTAP 9.8的FlexGroup、我们建议的最佳实践是、让适用于VMware vSphere的ONTAP工具创建FlexGroup、但随后您应将其卸载、然后使用循环DNS重新挂载、以便在集群中分布负载。ONTAP工具在挂载数据存储库时仅使用一个LIF。重新挂载数据存储库后、可以使用ONTAP工具对其进行监控和管理。</block>
  <block id="d9c9eb44a58ee1ce90daa68527aa8930" category="summary">使用MCC的VMSC的故障情形</block>
  <block id="e7c7574b0826c9074f480de76c889ba8" category="paragraph">以下各节概述了VMSC和NetApp MetroCluster系统的各种故障情形的预期结果。</block>
  <block id="c8a2eebb480fef69e6ed917ea7f7a9d3" category="section-title">单个存储路径故障</block>
  <block id="b99e8e694b032f593bbd01f6205b4a98" category="paragraph">在这种情况下、如果组件(例如HBA端口、网络端口、前端数据交换机端口或FC或以太网缆线)发生故障、ESXi主机会将存储设备的特定路径标记为无活动。如果通过在HB/网络/交换机端口提供故障恢复能力来为存储设备配置多个路径、则ESXi最好执行路径切换。在此期间、虚拟机将保持运行状态、而不会受到影响、因为通过提供存储设备的多个路径、可以确保存储可用性。</block>
  <block id="1fff6650ef9c430da0f875c203d5dab0" category="paragraph">*注意：*在这种情况下、MetroCluster行为没有变化、所有数据存储库在其各自的站点中仍保持完好。</block>
  <block id="80fc15dd1deb985234440745e8a78d4c" category="paragraph">在使用NFS/iSCSI卷的环境中、NetApp建议为标准vSwitch中的NFS vmkernel端口至少配置两个网络上行链路、并且在为分布式vSwitch映射NFS vmkernel接口的端口组上配置相同的网络上行链路。NIC绑定可以配置为主动-主动或主动-备用。</block>
  <block id="0c8694e8ef7f8935edbfac605753bc95" category="paragraph">此外、对于iSCSI LUN、必须通过将vmkernel接口绑定到iSCSI网络适配器来配置多路径。有关详细信息、请参阅vSphere存储文档。</block>
  <block id="0fc808fdb968eb089fbc5124c0a8e15a" category="paragraph">在使用光纤通道LUN的环境中、NetApp建议至少配置两个HBA、以确保HHBA/Port级别的故障恢复能力。NetApp还建议配置分区的最佳做法是、为单个目标分区配置单个启动程序。</block>
  <block id="238c3d1c7bf8b5b42237392383a4c7ab" category="paragraph">应使用虚拟存储控制台(VSC)设置多路径策略、因为它会为所有新的和现有的NetApp存储设备设置策略。</block>
  <block id="217811709dfb096c78e73934de01271c" category="section-title">单个ESXi主机故障</block>
  <block id="93bc89a0478478dd84d8159a18f6c1a2" category="image-alt">单个主机故障。</block>
  <block id="15023af3b440b4004f509e961bfe1e30" category="paragraph">在这种情况下、如果ESXi主机发生故障、VMware HA集群中的主节点会检测到主机故障、因为它不再接收网络检测信号。为了确定主机是否确实已关闭或仅为网络分区、主节点会监控数据存储库检测点、如果没有检测点、它会对故障主机的管理IP地址执行屏显操作来执行最终检查。如果所有这些检查均为否定、则主节点会将此主机声明为故障主机、并且在此故障主机上运行的所有虚拟机都会在集群中的无故障主机上重新启动。</block>
  <block id="9a11158d52f71012ae8722b09bf8bf29" category="paragraph">如果已配置DRS VM和主机关联性规则(VM组site_VMs中的VM应运行主机组site_hosts中的主机)、则HA主节点会首先检查站点A上的可用资源如果站点A上没有可用主机、主节点将尝试重新启动站点B主机上的VM</block>
  <block id="7922c92ff860eb0508dc8cc8aae3ffdd" category="paragraph">如果本地站点存在资源限制、则虚拟机可能会在另一站点的ESXi主机上启动。但是、如果将虚拟机迁移回本地站点中任何无故障的ESXi主机时违反了任何规则、则定义的DRS VM和主机关联性规则将会进行更正。如果DRS设置为手动、则NetApp建议调用DRS并应用建议以更正虚拟机放置。</block>
  <block id="387b5a49326be3a47e081682e75e19b4" category="paragraph">在这种情况下、MetroCluster的行为没有变化、所有数据存储库在其各自的站点中仍保持完好。</block>
  <block id="a11ffa7d20dab792fe5aa9c27017493e" category="section-title">ESXi主机隔离</block>
  <block id="17e01652089acd413e26ea89cf98a2b8" category="image-alt">ESXi主机隔离</block>
  <block id="8a4b746274e9d7129602d54434624806" category="paragraph">在这种情况下、如果ESXi主机的管理网络关闭、HA集群中的主节点将不会收到任何检测信号、因此此主机将在网络中隔离。要确定数据存储库是发生故障还是仅被隔离、主节点会开始监控数据存储库检测信号。如果存在、则主节点会声明主机已隔离。根据配置的隔离响应、主机可以选择关闭电源、关闭虚拟机、甚至保持虚拟机处于打开状态。隔离响应的默认间隔为30秒。</block>
  <block id="a070f7923919fed39772c5d3f91bf482" category="section-title">磁盘架故障</block>
  <block id="e8acf0e4f25cdd641c9a047482d56ba5" category="paragraph">在这种情况下、出现两个以上磁盘或整个磁盘架故障。数据从无故障丛提供、而不会中断数据服务。磁盘故障可能会影响本地丛或远程丛。聚合将显示为降级模式、因为只有一个丛处于活动状态。更换故障磁盘后、受影响的聚合将自动重新同步以重建数据。重新同步后、聚合将自动恢复为正常镜像模式。如果一个RAID组中有两个以上的磁盘出现故障、则必须从头开始重建丛。</block>
  <block id="4f90d34a41c7ebc83024a5e3ca35ff3a" category="image-alt">单个磁盘架故障。</block>
  <block id="8af0b36d49baf198133a234e76b06445" category="paragraph">*注意：*在此期间、虚拟机I/O操作不会受到影响、但性能会下降、因为数据是通过ISL链路从远程磁盘架访问的。</block>
  <block id="1c872dcd4bcebb1d7567f383901dfc0d" category="section-title">单个存储控制器故障</block>
  <block id="68badb604dbd29653979fdc7083cbffe" category="paragraph">在这种情况下、一个站点上的两个存储控制器之一发生故障。由于每个站点都有一个HA对、因此一个节点发生故障会透明地自动触发故障转移到另一个节点。例如、如果节点A1发生故障、其存储和工作负载将自动传输到节点A2。虚拟机不会受到影响、因为所有的plexes都保持可用。第二个站点节点(B1和B2)不受影响。此外、vSphere HA不会执行任何操作、因为集群中的主节点仍将接收网络检测信号。</block>
  <block id="0ac25682ea568511724f2e0819127d89" category="image-alt">单节点故障</block>
  <block id="e7b4c0523308b3fd46189b6ab4867fe5" category="paragraph">如果故障转移是滚动灾难的一部分(节点A1故障转移到A2)、则在后续发生A2故障或站点A完全故障时、站点B可能会发生灾难后切换</block>
  <block id="7b590b52d9f3d4d40cda67758ff92ba1" category="section-title">交换机间链路故障</block>
  <block id="9df08f82abe35d87c6f7c96b18dab755" category="section-title">管理网络发生交换机间链路故障</block>
  <block id="ed0711cbc7a050952e0e370bab079bff" category="image-alt">管理网络发生交换机间链路故障</block>
  <block id="a32c6c77bb8d407cf5825aec175bab4b" category="paragraph">在这种情况下、如果前端主机管理网络的ISL链路发生故障、站点A的ESXi主机将无法与站点B的ESXi主机进行通信这将导致网络分区、因为特定站点上的ESXi主机将无法向HA集群中的主节点发送网络检测点。因此、由于分区、会有两个网段、每个网段中都有一个主节点、用于保护VM免受特定站点中主机故障的影响。</block>
  <block id="36974534f1a2014a3e7e229d795ef51b" category="paragraph">*注意：*在此期间、虚拟机将保持运行状态、MetroCluster行为在这种情况下没有变化。所有数据存储库在其各自的站点中仍保持完好。</block>
  <block id="628309883a8d1307131d205b200c56ae" category="section-title">存储网络发生交换机间链路故障</block>
  <block id="a9da7e2a43bcea673a22b949355e619d" category="image-alt">存储网络发生交换机间链路故障</block>
  <block id="625db96c5ee1e9b5197b6cb3c1715021" category="paragraph">在这种情况下、如果后端存储网络上的ISL链路发生故障、站点A的主机将无法访问站点B上集群B的存储卷或LUN、反之亦然。定义了VMware DRS规则、以便主机-存储站点关联性有利于虚拟机在站点内运行而不会受到影响。</block>
  <block id="8d9609f32cbee8fa5080f95d71a2a142" category="paragraph">在此期间、虚拟机会在其各自的站点上保持运行状态、并且在此情形下、MetroCluster的行为没有变化。所有数据存储库在其各自的站点中仍保持完好。</block>
  <block id="719831bfdda20be14c04e2b165cce85e" category="paragraph">如果出于某种原因违反了相关性规则(例如、VM1本应从站点A运行、而其磁盘位于本地集群A节点上、但却在站点B的主机上运行)、则可以通过ISL链路远程访问虚拟机的磁盘。由于ISL链路故障、在站点B上运行的VM1将无法向其磁盘写入数据、因为存储卷的路径已关闭、并且该特定虚拟机已关闭。在这些情况下、VMware HA不会执行任何操作、因为主机正在主动发送检测信号。这些虚拟机需要在其各自的站点中手动关闭和启动。下图显示了违反DRS关联性规则的虚拟机。</block>
  <block id="09ba89b1ea49214c15fbf8ea6f129cb0" category="image-alt">违反DRS相关性规则的VM无法在ISL出现故障后写入磁盘</block>
  <block id="49f26967af2ad76cacf7888cbeeb0590" category="section-title">所有交换机间故障或完整数据中心分区</block>
  <block id="bc331d84348670dff6731555166fa378" category="paragraph">在此场景中、两个站点之间的所有ISL链路均已关闭、并且两个站点彼此隔离。如前文所述(例如、管理网络和存储网络出现ISL故障)、虚拟机不会在完全ISL故障时受到影响。</block>
  <block id="a40e8cf2a5b5b1e22fec9f26cce85b9d" category="paragraph">在站点之间对ESXi主机进行分区后、vSphere HA代理将检查数据存储库检测点、并且在每个站点中、本地ESXi主机将能够将此数据存储库检测点更新到其各自的读写卷/LUN。站点A中的主机将假定站点B中的其他ESXi主机发生故障、因为不存在网络/数据存储库检测点。站点A的vSphere HA将尝试重新启动站点B的虚拟机、但此操作最终将失败、因为存储ISL故障将无法访问站点B的数据存储库。站点B也会出现类似情况</block>
  <block id="3543d47d1f3a8dc6989a32f62ce3ea77" category="image-alt">ISL全部发生故障或数据中心分区完整</block>
  <block id="3a096ef571101010add81b37081d3276" category="paragraph">NetApp建议确定是否有任何虚拟机违反了DRS规则。从远程站点运行的任何虚拟机都将关闭、因为它们将无法访问数据存储库、vSphere HA将在本地站点上重新启动该虚拟机。ISL链路恢复联机后、远程站点上运行的虚拟机将被终止、因为不能存在两个使用相同MAC地址运行的虚拟机实例。</block>
  <block id="87e9384cb464ff9a4ce385fc59a178a2" category="image-alt">VM1违反DRS关联性规则的数据中心分区</block>
  <block id="0951e388ebea20c49e71af25ef84947d" category="section-title">NetApp MetroCluster中的两个网络结构上的交换机间链路均出现故障</block>
  <block id="1e9be78885a356d1a2ec0ab0d4a4cecb" category="paragraph">如果一个或多个ISL发生故障、流量将继续通过其余链路。如果两个网络结构上的所有ISO都发生故障、以致于站点之间没有用于存储和NVRAM复制的链路、则每个控制器将继续提供其本地数据。在还原至少一个ISL时、将自动重新同步所有plexes。</block>
  <block id="715cbc6f6bcf5da6b73f10233847d3a1" category="paragraph">在所有ISL关闭后发生的任何写入操作都不会镜像到另一站点。因此、如果在配置处于此状态时发生灾难切换、则会丢失未同步的数据。在这种情况下、需要手动干预才能在切换后进行恢复。如果很可能在很长时间内不会有任何可用的CRL、则管理员可以选择关闭所有数据服务、以避免在发生灾难时需要切换时数据丢失的风险。在至少有一个ISL可用之前、应权衡执行此操作与发生灾难时需要切换的可能性。或者、如果在级联情形下、CRL发生故障、管理员可以在所有链路发生故障之前触发到某个站点的计划内切换。</block>
  <block id="89f375bfe8be0893bf175b89ce754b8e" category="image-alt">NetApp MetroCluster中两个网络结构上的交换机间链路故障。</block>
  <block id="bc813a6fdbbeebf4d230b7e33d8c3a76" category="section-title">对等集群链路故障</block>
  <block id="1919456d1613248a128c65a84b235fe5" category="paragraph">在对等集群链路故障情形下、由于网络结构的CRL仍处于活动状态、因此两个站点上的数据服务(读取和写入)将继续提供给两个plexs。任何集群配置更改(例如、添加新SVM、在现有SVM中配置卷或LUN)都无法传播到其他站点。这些卷保存在本地CRS元数据卷中、并在对等集群链路还原后自动传播到另一集群。如果需要强制切换才能还原对等集群链路、则在切换过程中、系统将从正常运行的站点上元数据卷的远程复制副本自动重做未完成的集群配置更改。</block>
  <block id="77130a0b52e4379c6b6667cf7f8e155c" category="image-alt">对等集群链路故障</block>
  <block id="9dc32d7afddc9a265c5c2713db55fc70" category="section-title">站点完全瘫痪</block>
  <block id="d0d6a03c382bc5412f1822e5c97d5142" category="paragraph">在完整站点A发生故障的情况下、站点B的ESXi主机无法从站点A的ESXi主机获取网络检测信号、因为它们已关闭。站点B的HA主节点将验证数据存储库检测点是否不存在、并声明站点A的主机出现故障、然后尝试在站点B中重新启动站点A虚拟机在此期间、存储管理员将执行切换以恢复运行正常的站点上故障节点的服务、从而恢复站点B上站点A的所有存储服务当站点A的卷或LUN在站点B上可用后、HA主代理将尝试在站点B中重新启动站点A的虚拟机</block>
  <block id="23e5761401326cc21bcf9d108b9e3e7f" category="paragraph">如果vSphere HA主代理尝试重新启动虚拟机(包括注册虚拟机并打开虚拟机电源)失败、则会在出现延迟后重试重新启动。重新启动之间的延迟最长可配置为30分钟。vSphere HA尝试这些重新启动的次数最多(默认为六次)。</block>
  <block id="641031c1f370e06434afd215f8610dae" category="paragraph">*注意：*除非布局管理器找到合适的存储、否则HA主节点不会开始尝试重新启动、因此、如果站点完全瘫痪、则应在执行切换后进行。</block>
  <block id="085a4a3eba6c30fa589bfee20eb0c294" category="paragraph">如果站点A已切换、则可以通过故障转移到运行正常的节点来无缝处理其中一个运行正常的站点B节点的后续故障。在这种情况下、四个节点的工作现在仅由一个节点执行。在这种情况下、恢复将包括向本地节点执行一次恢复。然后、在还原站点A后、将执行切回操作以还原配置的稳定状态操作。</block>
  <block id="2b9b713afb0d80ef371a0b55e58366b6" category="image-alt">站点完全瘫痪</block>
  <block id="e6364c2f5314a32cd95be04b4c2112e6" category="paragraph">以下各节概述了将VMware vvol与ONTAP存储结合使用的过程和最佳实践。</block>
  <block id="a9da618400fb93b20c20f5343efaefa7" category="sidebar">采用ONTAP的VMware vSphere Metro Storage Cluster</block>
  <block id="2f58fa882a22b5af5f0741f03abaf611" category="sidebar">采用ONTAP的vSphere Metro存储集群</block>
  <block id="4ed162a87c3bbcd728e66cd9365c7660" category="sidebar">VMSC概述</block>
  <block id="111464465e5bb57958d189842ad5e093" category="sidebar">vSphere HA解决方案</block>
  <block id="422fa84cbd2dc1a741d30fa40ad8284d" category="sidebar">VMSC设计</block>
  <block id="f6aef7af169e3878f32a39224e7a6cb8" category="sidebar">VMSC故障恢复能力</block>
  <block id="dfcccfecca566c55bd84119f294cde76" category="sidebar">使用MCC的VMSC场景</block>
</blocks>