---
sidebar: sidebar 
permalink: microsoft/win_deploy_hyperv_replica_oce.html 
keywords: Windows,Hyper-V,VHDX,VM,Virtual 
summary: 本附录介绍如何在集群环境之外部署Hyper-V副本。 
---
= 将Hyper-V副本部署到非群组环境中
:allow-uri-read: 


[role="lead"]
本附录介绍如何在集群环境之外部署Hyper-V副本。



== 前提条件

* 您需要将独立的Hyper-V服务器置于同一或不同的地理位置、用作主服务器和副本服务器。
* 如果使用不同的站点、则必须将每个站点的防火墙配置为允许主服务器和副本服务器之间进行通信。
* 副本服务器必须有足够的空间来存储复制的工作负载。




== 部署

. 配置副本服务器。
+
.. 为了使入站防火墙规则允许传入复制流量、请运行以下PowerShell cmdlet：
+
 Enable-Netfirewallrule -displayname "Hyper-V Replica HTTP Listener (TCP-In)"
.. 从Server Manager的Tools部分打开Hyper-V Manager。
.. 在操作中单击Hyper-V设置。
.. 单击复制配置并选择启用此计算机作为复本服务器。
.. 在身份验证和端口部分中、选择身份验证方法和端口。
.. 在授权和存储部分中、指定用于存储复制的VM和文件的位置。


. 为主服务器上的VM启用VM复制。VM复制按VM启用、而不是对整个Hyper-V服务器启用。
+
.. 在Hyper-V Manager中、右键单击某个虚拟机、然后单击启用复制以打开启用复制向导。
.. 提供必须复制VM的副本服务器的名称。
.. 提供身份验证类型以及配置为接收副本服务器上的复制流量的副本服务器端口。
.. 选择要复制的VHD。
.. 选择将更改发送到复本服务器的频率(持续时间)。
.. 配置恢复点以指定要在副本服务器上维护的恢复点数量。
.. 选择初始复制方法以指定将VM数据的初始副本传输到副本服务器的方法。
.. 查看摘要、然后单击完成。
.. 此过程会在副本服务器上创建VM副本。






== Replication

. 运行测试故障转移、以确保副本VM在副本服务器上正常运行。此测试将在副本服务器上创建一个临时VM。
+
.. 登录到复本服务器。
.. 在Hyper-V Manager中、右键单击副本虚拟机、单击复制、然后单击测试故障转移。
.. 选择要使用的恢复点。
.. 此过程将创建一个同名VM、并附加-Test。
.. 验证虚拟机以确保一切正常。
.. 故障转移后、如果为副本测试VM选择停止测试故障转移、则会将其删除。


. 运行计划内故障转移、将主VM上的最新更改复制到副本VM。
+
.. 登录到主服务器。
.. 关闭要进行故障转移的虚拟机。
.. 在Hyper-V Manager中、右键单击已关闭的虚拟机、单击复制、然后单击计划内故障转移。
.. 单击故障转移将最新的VM更改传输到副本服务器。


. 在主VM发生故障时运行计划外故障转移。
+
.. 登录到复本服务器。
.. 在Hyper-V Manager中、右键单击副本虚拟机、单击复制、然后单击故障转移。
.. 选择要使用的恢复点。
.. 单击故障转移对虚拟机进行故障转移。



