---
sidebar: sidebar 
permalink: microsoft/win_deploy_hyperv.html 
keywords: Windows,Hyper-V,VHDX,VM,Virtual 
summary: 本附录介绍如何在NetApp存储上部署高可用性Hyper-V集群。 
---
= 部署Hyper-V集群
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media


[role="lead"]
本附录介绍如何部署Hyper-V集群。



== 前提条件

* 至少有两个Hyper-V服务器相互连接。
* 在每个Hyper-V服务器上至少配置一个虚拟交换机。
* 故障转移集群功能已在每个Hyper-V服务器上启用。
* SMB共享或LV用作共享存储、用于存储Hyper-V集群中的虚拟机及其磁盘。
* 存储不应在不同集群之间共享。每个集群只应有一个CSV/CIFS共享。
* 如果SMB共享用作共享存储、则必须配置SMB共享上的权限、以授予对集群中所有Hyper-V服务器的计算机帐户的访问权限。




== 部署

. 以管理员组成员的身份登录到一个Windows Hyper-V服务器。
. 启动服务器管理器**.**
. 在工具部分中、单击故障转移集群管理器。
. 单击"Create Cluster from Actions"菜单。
. 提供此集群中Hyper-V服务器的详细信息。
. 验证集群配置。当系统提示您进行集群配置验证时、选择是、然后选择所需的测试、以验证Hyper-V服务器是否满足加入集群的前提条件。
. 验证成功后、将启动创建集群向导。在向导中、提供新集群的集群名称和集群IP地址。然后、为Hyper-V服务器创建新的故障转移集群。
. 在故障转移集群管理器中单击新创建的集群并对其进行管理。
. 定义集群要使用的共享存储。它可以是SMB共享或CSV。
. 使用SMB共享作为共享存储不需要执行任何特殊步骤。
+
** 在NetApp存储控制器上配置CIFS共享。要执行此操作，请参阅"link:win_smb.html["在SMB环境中配置"]"。


. 要使用CSV作为共享存储、请完成以下步骤：
+
.. 在NetApp存储控制器上配置LUN。为此、请参见"在SAN环境中配置"一节。
.. 确保故障转移集群中的所有Hyper-V服务器均可识别NetApp LUN。要对故障转移集群中的所有Hyper-V服务器执行此操作、请确保将其启动程序添加到NetApp存储上的启动程序组。此外、请确保发现其LUN并启用MPIO。
.. 在集群中的任一Hyper-V服务器上、完成以下步骤：
+
... 使LUN联机、初始化磁盘、创建一个新的简单卷、然后使用NTFS或ReFS对其进行格式化。
... 在故障转移集群管理器中、展开集群、展开存储、右键单击磁盘、然后单击添加磁盘。执行此操作会打开将磁盘添加到集群向导、其中会将LUN显示为磁盘。单击确定将LUN添加为磁盘。
... 现在、此LUN名为"Storageed"(已配置)、并在"Disk"(磁盘)下显示为"Available Storage"(可用存储)。


.. 右键单击LUN (集群模式磁盘)、然后单击添加到集群共享卷。现在、LUN显示为CSV。
.. CSV可同时从故障转移集群的所有Hyper-V服务器的本地位置C：\ClusterStorage\中查看和访问。


. 创建高可用性VM：
+
.. 在故障转移集群管理器中、选择并展开先前创建的集群。
.. 单击角色、然后单击操作中的虚拟机。单击新建虚拟机。
.. 从虚拟机应驻留的集群中选择节点。
.. 在虚拟机创建向导中、提供共享存储(SMB共享或CSV)作为存储虚拟机及其磁盘的路径。
.. 使用Hyper-V Manager将共享存储(SMB共享或CSV)设置为Hyper-V服务器存储虚拟机及其磁盘的默认路径。


. 测试计划内故障转移。通过实时迁移、快速迁移或存储迁移(移动)将VM移动到另一个节点。请查看 link:win_deploy_hyperv_lmce.html["在一个"已加入的环境中进行实时迁移""] 有关详细信息：
. 测试计划外故障转移。停止VM所属服务器上的集群服务。

