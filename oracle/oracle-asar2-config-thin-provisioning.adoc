---
sidebar: sidebar 
permalink: oracle/oracle-asar2-config-thin-provisioning.html 
keywords: thin provisioning, oracle, ASA r2 
summary: Oracle 和ONTAP与ASA r2 的精简配置 
searchtitle: 在ASA r2 上使用 Oracle 数据库进行精简配置 
---
= 精简配置
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
在ASA r2 上对 Oracle 数据库进行精简配置需要仔细规划，因为它涉及配置比物理可用空间更多的逻辑空间。如果实施得当，精简配置可以显著节省成本并提高可管理性。

精简配置是ASA r2 的组成部分，并且与ONTAP效率技术密切相关，因为两者都允许存储比系统物理容量更多的逻辑数据。ASA r2 系统仅限 SAN，精简配置适用于存储可用区 (SAZ) 内的存储单元和 LUN。


NOTE: ASA r2 存储单元默认采用精简配置。

几乎所有快照的使用都涉及精简配置。例如，一个典型的 10 TiB 数据库，包含 30 天的快照，可能会显示为 310 TiB 的逻辑数据，但实际上只占用 12 TiB 到 15 TiB 的物理空间，因为快照只存储已更改的数据块。

同样，克隆也是精简配置的另一种形式。一个开发环境，如果完全写入一个 80 TiB 数据库的 40 个克隆，则需要 3.2 PiB 的空间，但实际上消耗的空间要少得多，因为只存储更改。



== 空间管理

在应用环境中采用精简配置时必须格外小心，因为数据变更率可能会意外增加。例如，如果对数据库表进行重新索引，或者对 VMware 客户机进行大规模修补，则快照导致的空间消耗可能会迅速增长。备份文件丢失可能会在很短的时间内写入大量数据。最后，如果 LUN 意外耗尽可用空间，则某些应用程序可能难以恢复。

在ASA r2 中，这些风险是通过精简配置、主动监控和 LUN 调整大小策略来缓解的，而不是通过ONTAP 的卷自动增长或快照自动删除等功能来缓解的。管理员应该：

* 启用 LUN 上的精简配置 (`space-reserve disabled`这是ASA r2 中的默认设置。
* 使用系统管理器警报或基于 API 的自动化方式监控容量
* 使用计划或脚本化的 LUN 调整大小来适应增长
* 通过系统管理器（图形用户界面）配置快照保留和自动快照删除



CAUTION: 由于ASA r2 不支持自动卷增长或 CLI 驱动的快照删除，因此仔细规划空间阈值和自动化脚本至关重要。

ASA r2 不使用部分储备设置，因为它是一个仅支持 SAN 的架构，抽象了基于WAFL 的卷选项。相反，空间效率和覆盖保护是在 LUN 级别进行管理的。例如，如果您从存储单元配置了一个 250 GiB 的 LUN，快照会根据实际块更改消耗空间，而不是预先预留等量的空间。这样就无需进行大量的静态预留，而这种预留在传统的ONTAP环境中使用部分预留时很常见。


NOTE: 如果需要保证覆盖保护且监控不可行，管理员应在存储单元中提供足够的容量并适当设置快照保留。然而， ASA r2 的设计使得大多数工作负载不需要部分备用容量。



== 数据压缩和重复数据删除

ASA r2 中的压缩和去重是空间效率技术，而不是传统的精简配置机制。这些特性通过消除冗余数据和压缩数据块来减少物理存储占用空间，从而允许存储比原始容量所允许的更多的逻辑数据。

例如，一个 50 TiB 的数据集可以压缩到 30 TiB，从而节省 20 TiB 的物理空间。从应用程序的角度来看，虽然磁盘上只占用 30 TiB，但仍然有 50 TiB 的数据。


NOTE: 数据集的可压缩性会随时间变化，这可能会增加物理空间的消耗。因此，必须通过监控和容量规划来主动管理压缩和去重。



== 可用空间和LVM空间分配

在ASA r2 环境中，如果删除的数据块没有被回收，精简配置的效率会随着时间的推移而降低。除非使用 TRIM/UNMAP 释放空间或用零覆盖（通过 ASMRU - 自动空间管理和回收实用程序），否则已删除的数据将继续占用物理容量。在许多 Oracle 数据库环境中，精简配置的优势有限，因为数据文件通常在创建时就被预先分配到其全部大小。

精心规划 LVM 配置可以提高效率，并最大限度地减少存储配置和 LUN 调整大小的需求。当使用 Veritas VxVM 或 Oracle ASM 等 LVM 时，底层 LUN 被划分为仅在需要时才使用的扩展区。例如，如果一个数据集最初大小为 2 TiB，但随着时间的推移可能会增长到 10 TiB，则可以将此数据集放置在 10 TiB 的精简配置 LUN 上，这些 LUN 组织成一个 LVM 磁盘组。创建时仅占用 2 TiB 的空间，并且只有在分配扩展区以适应数据增长时才会占用额外的空间。只要对空间进行监控，这个过程就是安全的。
